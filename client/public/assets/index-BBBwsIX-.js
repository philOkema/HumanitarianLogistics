function MW(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const l=Object.getOwnPropertyDescriptor(r,i);l&&Object.defineProperty(t,i,l.get?l:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();var $0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $I(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var PW={exports:{}},qI={},DW={exports:{}},os={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gw=Symbol.for("react.element"),toe=Symbol.for("react.portal"),noe=Symbol.for("react.fragment"),roe=Symbol.for("react.strict_mode"),ioe=Symbol.for("react.profiler"),soe=Symbol.for("react.provider"),ooe=Symbol.for("react.context"),aoe=Symbol.for("react.forward_ref"),loe=Symbol.for("react.suspense"),coe=Symbol.for("react.memo"),uoe=Symbol.for("react.lazy"),l8=Symbol.iterator;function hoe(t){return t===null||typeof t!="object"?null:(t=l8&&t[l8]||t["@@iterator"],typeof t=="function"?t:null)}var kW={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},NW=Object.assign,OW={};function dx(t,e,n){this.props=t,this.context=e,this.refs=OW,this.updater=n||kW}dx.prototype.isReactComponent={};dx.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};dx.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function LW(){}LW.prototype=dx.prototype;function gO(t,e,n){this.props=t,this.context=e,this.refs=OW,this.updater=n||kW}var _O=gO.prototype=new LW;_O.constructor=gO;NW(_O,dx.prototype);_O.isPureReactComponent=!0;var c8=Array.isArray,FW=Object.prototype.hasOwnProperty,yO={current:null},BW={key:!0,ref:!0,__self:!0,__source:!0};function zW(t,e,n){var r,i={},l=null,u=null;if(e!=null)for(r in e.ref!==void 0&&(u=e.ref),e.key!==void 0&&(l=""+e.key),e)FW.call(e,r)&&!BW.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var v=Array(s),w=0;w<s;w++)v[w]=arguments[w+2];i.children=v}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:Gw,type:t,key:l,ref:u,props:i,_owner:yO.current}}function doe(t,e){return{$$typeof:Gw,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function xO(t){return typeof t=="object"&&t!==null&&t.$$typeof===Gw}function foe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var u8=/\/+/g;function UP(t,e){return typeof t=="object"&&t!==null&&t.key!=null?foe(""+t.key):e.toString(36)}function wT(t,e,n,r,i){var l=typeof t;(l==="undefined"||l==="boolean")&&(t=null);var u=!1;if(t===null)u=!0;else switch(l){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case Gw:case toe:u=!0}}if(u)return u=t,i=i(u),t=r===""?"."+UP(u,0):r,c8(i)?(n="",t!=null&&(n=t.replace(u8,"$&/")+"/"),wT(i,e,n,"",function(w){return w})):i!=null&&(xO(i)&&(i=doe(i,n+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(u8,"$&/")+"/")+t)),e.push(i)),1;if(u=0,r=r===""?".":r+":",c8(t))for(var s=0;s<t.length;s++){l=t[s];var v=r+UP(l,s);u+=wT(l,e,n,v,i)}else if(v=hoe(t),typeof v=="function")for(t=v.call(t),s=0;!(l=t.next()).done;)l=l.value,v=r+UP(l,s++),u+=wT(l,e,n,v,i);else if(l==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return u}function _S(t,e,n){if(t==null)return t;var r=[],i=0;return wT(t,r,"","",function(l){return e.call(n,l,i++)}),r}function poe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var vc={current:null},ET={transition:null},moe={ReactCurrentDispatcher:vc,ReactCurrentBatchConfig:ET,ReactCurrentOwner:yO};function jW(){throw Error("act(...) is not supported in production builds of React.")}os.Children={map:_S,forEach:function(t,e,n){_S(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return _S(t,function(){e++}),e},toArray:function(t){return _S(t,function(e){return e})||[]},only:function(t){if(!xO(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};os.Component=dx;os.Fragment=noe;os.Profiler=ioe;os.PureComponent=gO;os.StrictMode=roe;os.Suspense=loe;os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=moe;os.act=jW;os.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=NW({},t.props),i=t.key,l=t.ref,u=t._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,u=yO.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(v in e)FW.call(e,v)&&!BW.hasOwnProperty(v)&&(r[v]=e[v]===void 0&&s!==void 0?s[v]:e[v])}var v=arguments.length-2;if(v===1)r.children=n;else if(1<v){s=Array(v);for(var w=0;w<v;w++)s[w]=arguments[w+2];r.children=s}return{$$typeof:Gw,type:t.type,key:i,ref:l,props:r,_owner:u}};os.createContext=function(t){return t={$$typeof:ooe,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:soe,_context:t},t.Consumer=t};os.createElement=zW;os.createFactory=function(t){var e=zW.bind(null,t);return e.type=t,e};os.createRef=function(){return{current:null}};os.forwardRef=function(t){return{$$typeof:aoe,render:t}};os.isValidElement=xO;os.lazy=function(t){return{$$typeof:uoe,_payload:{_status:-1,_result:t},_init:poe}};os.memo=function(t,e){return{$$typeof:coe,type:t,compare:e===void 0?null:e}};os.startTransition=function(t){var e=ET.transition;ET.transition={};try{t()}finally{ET.transition=e}};os.unstable_act=jW;os.useCallback=function(t,e){return vc.current.useCallback(t,e)};os.useContext=function(t){return vc.current.useContext(t)};os.useDebugValue=function(){};os.useDeferredValue=function(t){return vc.current.useDeferredValue(t)};os.useEffect=function(t,e){return vc.current.useEffect(t,e)};os.useId=function(){return vc.current.useId()};os.useImperativeHandle=function(t,e,n){return vc.current.useImperativeHandle(t,e,n)};os.useInsertionEffect=function(t,e){return vc.current.useInsertionEffect(t,e)};os.useLayoutEffect=function(t,e){return vc.current.useLayoutEffect(t,e)};os.useMemo=function(t,e){return vc.current.useMemo(t,e)};os.useReducer=function(t,e,n){return vc.current.useReducer(t,e,n)};os.useRef=function(t){return vc.current.useRef(t)};os.useState=function(t){return vc.current.useState(t)};os.useSyncExternalStore=function(t,e,n){return vc.current.useSyncExternalStore(t,e,n)};os.useTransition=function(){return vc.current.useTransition()};os.version="18.3.1";DW.exports=os;var se=DW.exports;const fa=$I(se),Dy=MW({__proto__:null,default:fa},[se]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var goe=se,_oe=Symbol.for("react.element"),yoe=Symbol.for("react.fragment"),xoe=Object.prototype.hasOwnProperty,voe=goe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,boe={key:!0,ref:!0,__self:!0,__source:!0};function VW(t,e,n){var r,i={},l=null,u=null;n!==void 0&&(l=""+n),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(u=e.ref);for(r in e)xoe.call(e,r)&&!boe.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:_oe,type:t,key:l,ref:u,props:i,_owner:voe.current}}qI.Fragment=yoe;qI.jsx=VW;qI.jsxs=VW;PW.exports=qI;var R=PW.exports,A3={},UW={exports:{}},vu={},HW={exports:{}},WW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(wt,it){var nn=wt.length;wt.push(it);e:for(;0<nn;){var In=nn-1>>>1,wn=wt[In];if(0<i(wn,it))wt[In]=it,wt[nn]=wn,nn=In;else break e}}function n(wt){return wt.length===0?null:wt[0]}function r(wt){if(wt.length===0)return null;var it=wt[0],nn=wt.pop();if(nn!==it){wt[0]=nn;e:for(var In=0,wn=wt.length,Xt=wn>>>1;In<Xt;){var On=2*(In+1)-1,cr=wt[On],En=On+1,fn=wt[En];if(0>i(cr,nn))En<wn&&0>i(fn,cr)?(wt[In]=fn,wt[En]=nn,In=En):(wt[In]=cr,wt[On]=nn,In=On);else if(En<wn&&0>i(fn,nn))wt[In]=fn,wt[En]=nn,In=En;else break e}}return it}function i(wt,it){var nn=wt.sortIndex-it.sortIndex;return nn!==0?nn:wt.id-it.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var u=Date,s=u.now();t.unstable_now=function(){return u.now()-s}}var v=[],w=[],A=1,F=null,W=3,K=!1,Q=!1,Z=!1,oe=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,me=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function pe(wt){for(var it=n(w);it!==null;){if(it.callback===null)r(w);else if(it.startTime<=wt)r(w),it.sortIndex=it.expirationTime,e(v,it);else break;it=n(w)}}function _e(wt){if(Z=!1,pe(wt),!Q)if(n(v)!==null)Q=!0,bt(De);else{var it=n(w);it!==null&&Nt(_e,it.startTime-wt)}}function De(wt,it){Q=!1,Z&&(Z=!1,ae(fe),fe=-1),K=!0;var nn=W;try{for(pe(it),F=n(v);F!==null&&(!(F.expirationTime>it)||wt&&!Ie());){var In=F.callback;if(typeof In=="function"){F.callback=null,W=F.priorityLevel;var wn=In(F.expirationTime<=it);it=t.unstable_now(),typeof wn=="function"?F.callback=wn:F===n(v)&&r(v),pe(it)}else r(v);F=n(v)}if(F!==null)var Xt=!0;else{var On=n(w);On!==null&&Nt(_e,On.startTime-it),Xt=!1}return Xt}finally{F=null,W=nn,K=!1}}var Ae=!1,re=null,fe=-1,ye=5,ue=-1;function Ie(){return!(t.unstable_now()-ue<ye)}function Oe(){if(re!==null){var wt=t.unstable_now();ue=wt;var it=!0;try{it=re(!0,wt)}finally{it?ze():(Ae=!1,re=null)}}else Ae=!1}var ze;if(typeof me=="function")ze=function(){me(Oe)};else if(typeof MessageChannel<"u"){var ft=new MessageChannel,He=ft.port2;ft.port1.onmessage=Oe,ze=function(){He.postMessage(null)}}else ze=function(){oe(Oe,0)};function bt(wt){re=wt,Ae||(Ae=!0,ze())}function Nt(wt,it){fe=oe(function(){wt(t.unstable_now())},it)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(wt){wt.callback=null},t.unstable_continueExecution=function(){Q||K||(Q=!0,bt(De))},t.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ye=0<wt?Math.floor(1e3/wt):5},t.unstable_getCurrentPriorityLevel=function(){return W},t.unstable_getFirstCallbackNode=function(){return n(v)},t.unstable_next=function(wt){switch(W){case 1:case 2:case 3:var it=3;break;default:it=W}var nn=W;W=it;try{return wt()}finally{W=nn}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(wt,it){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var nn=W;W=wt;try{return it()}finally{W=nn}},t.unstable_scheduleCallback=function(wt,it,nn){var In=t.unstable_now();switch(typeof nn=="object"&&nn!==null?(nn=nn.delay,nn=typeof nn=="number"&&0<nn?In+nn:In):nn=In,wt){case 1:var wn=-1;break;case 2:wn=250;break;case 5:wn=1073741823;break;case 4:wn=1e4;break;default:wn=5e3}return wn=nn+wn,wt={id:A++,callback:it,priorityLevel:wt,startTime:nn,expirationTime:wn,sortIndex:-1},nn>In?(wt.sortIndex=nn,e(w,wt),n(v)===null&&wt===n(w)&&(Z?(ae(fe),fe=-1):Z=!0,Nt(_e,nn-In))):(wt.sortIndex=wn,e(v,wt),Q||K||(Q=!0,bt(De))),wt},t.unstable_shouldYield=Ie,t.unstable_wrapCallback=function(wt){var it=W;return function(){var nn=W;W=it;try{return wt.apply(this,arguments)}finally{W=nn}}}})(WW);HW.exports=WW;var woe=HW.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eoe=se,yu=woe;function Hn(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var $W=new Set,Gb={};function w_(t,e){ky(t,e),ky(t+"Capture",e)}function ky(t,e){for(Gb[t]=e,t=0;t<e.length;t++)$W.add(e[t])}var Ef=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),R3=Object.prototype.hasOwnProperty,Soe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h8={},d8={};function Toe(t){return R3.call(d8,t)?!0:R3.call(h8,t)?!1:Soe.test(t)?d8[t]=!0:(h8[t]=!0,!1)}function Coe(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Ioe(t,e,n,r){if(e===null||typeof e>"u"||Coe(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function bc(t,e,n,r,i,l,u){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=l,this.removeEmptyString=u}var Il={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Il[t]=new bc(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Il[e]=new bc(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Il[t]=new bc(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Il[t]=new bc(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Il[t]=new bc(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Il[t]=new bc(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Il[t]=new bc(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Il[t]=new bc(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Il[t]=new bc(t,5,!1,t.toLowerCase(),null,!1,!1)});var vO=/[\-:]([a-z])/g;function bO(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(vO,bO);Il[e]=new bc(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(vO,bO);Il[e]=new bc(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(vO,bO);Il[e]=new bc(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Il[t]=new bc(t,1,!1,t.toLowerCase(),null,!1,!1)});Il.xlinkHref=new bc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Il[t]=new bc(t,1,!1,t.toLowerCase(),null,!0,!0)});function wO(t,e,n,r){var i=Il.hasOwnProperty(e)?Il[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Ioe(e,n,i,r)&&(n=null),r||i===null?Toe(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var jf=Eoe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yS=Symbol.for("react.element"),Z0=Symbol.for("react.portal"),Q0=Symbol.for("react.fragment"),EO=Symbol.for("react.strict_mode"),M3=Symbol.for("react.profiler"),qW=Symbol.for("react.provider"),GW=Symbol.for("react.context"),SO=Symbol.for("react.forward_ref"),P3=Symbol.for("react.suspense"),D3=Symbol.for("react.suspense_list"),TO=Symbol.for("react.memo"),kp=Symbol.for("react.lazy"),YW=Symbol.for("react.offscreen"),f8=Symbol.iterator;function Ev(t){return t===null||typeof t!="object"?null:(t=f8&&t[f8]||t["@@iterator"],typeof t=="function"?t:null)}var Go=Object.assign,HP;function Kv(t){if(HP===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);HP=e&&e[1]||""}return`
`+HP+t}var WP=!1;function $P(t,e){if(!t||WP)return"";WP=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var r=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){r=w}t.call(e.prototype)}else{try{throw Error()}catch(w){r=w}t()}}catch(w){if(w&&r&&typeof w.stack=="string"){for(var i=w.stack.split(`
`),l=r.stack.split(`
`),u=i.length-1,s=l.length-1;1<=u&&0<=s&&i[u]!==l[s];)s--;for(;1<=u&&0<=s;u--,s--)if(i[u]!==l[s]){if(u!==1||s!==1)do if(u--,s--,0>s||i[u]!==l[s]){var v=`
`+i[u].replace(" at new "," at ");return t.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",t.displayName)),v}while(1<=u&&0<=s);break}}}finally{WP=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Kv(t):""}function Aoe(t){switch(t.tag){case 5:return Kv(t.type);case 16:return Kv("Lazy");case 13:return Kv("Suspense");case 19:return Kv("SuspenseList");case 0:case 2:case 15:return t=$P(t.type,!1),t;case 11:return t=$P(t.type.render,!1),t;case 1:return t=$P(t.type,!0),t;default:return""}}function k3(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Q0:return"Fragment";case Z0:return"Portal";case M3:return"Profiler";case EO:return"StrictMode";case P3:return"Suspense";case D3:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case GW:return(t.displayName||"Context")+".Consumer";case qW:return(t._context.displayName||"Context")+".Provider";case SO:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case TO:return e=t.displayName||null,e!==null?e:k3(t.type)||"Memo";case kp:e=t._payload,t=t._init;try{return k3(t(e))}catch{}}return null}function Roe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return k3(e);case 8:return e===EO?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function dm(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function XW(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Moe(t){var e=XW(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,l=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(u){r=""+u,l.call(this,u)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(u){r=""+u},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function xS(t){t._valueTracker||(t._valueTracker=Moe(t))}function KW(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=XW(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function cC(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function N3(t,e){var n=e.checked;return Go({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function p8(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=dm(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ZW(t,e){e=e.checked,e!=null&&wO(t,"checked",e,!1)}function O3(t,e){ZW(t,e);var n=dm(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?L3(t,e.type,n):e.hasOwnProperty("defaultValue")&&L3(t,e.type,dm(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function m8(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function L3(t,e,n){(e!=="number"||cC(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Zv=Array.isArray;function dy(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+dm(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function F3(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Hn(91));return Go({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function g8(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Hn(92));if(Zv(n)){if(1<n.length)throw Error(Hn(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:dm(n)}}function QW(t,e){var n=dm(e.value),r=dm(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function _8(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function JW(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function B3(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?JW(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var vS,e$=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(vS=vS||document.createElement("div"),vS.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=vS.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Yb(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var yb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Poe=["Webkit","ms","Moz","O"];Object.keys(yb).forEach(function(t){Poe.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),yb[e]=yb[t]})});function t$(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||yb.hasOwnProperty(t)&&yb[t]?(""+e).trim():e+"px"}function n$(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=t$(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Doe=Go({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function z3(t,e){if(e){if(Doe[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Hn(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Hn(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Hn(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Hn(62))}}function j3(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var V3=null;function CO(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var U3=null,fy=null,py=null;function y8(t){if(t=Kw(t)){if(typeof U3!="function")throw Error(Hn(280));var e=t.stateNode;e&&(e=ZI(e),U3(t.stateNode,t.type,e))}}function r$(t){fy?py?py.push(t):py=[t]:fy=t}function i$(){if(fy){var t=fy,e=py;if(py=fy=null,y8(t),e)for(t=0;t<e.length;t++)y8(e[t])}}function s$(t,e){return t(e)}function o$(){}var qP=!1;function a$(t,e,n){if(qP)return t(e,n);qP=!0;try{return s$(t,e,n)}finally{qP=!1,(fy!==null||py!==null)&&(o$(),i$())}}function Xb(t,e){var n=t.stateNode;if(n===null)return null;var r=ZI(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Hn(231,e,typeof n));return n}var H3=!1;if(Ef)try{var Sv={};Object.defineProperty(Sv,"passive",{get:function(){H3=!0}}),window.addEventListener("test",Sv,Sv),window.removeEventListener("test",Sv,Sv)}catch{H3=!1}function koe(t,e,n,r,i,l,u,s,v){var w=Array.prototype.slice.call(arguments,3);try{e.apply(n,w)}catch(A){this.onError(A)}}var xb=!1,uC=null,hC=!1,W3=null,Noe={onError:function(t){xb=!0,uC=t}};function Ooe(t,e,n,r,i,l,u,s,v){xb=!1,uC=null,koe.apply(Noe,arguments)}function Loe(t,e,n,r,i,l,u,s,v){if(Ooe.apply(this,arguments),xb){if(xb){var w=uC;xb=!1,uC=null}else throw Error(Hn(198));hC||(hC=!0,W3=w)}}function E_(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function l$(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function x8(t){if(E_(t)!==t)throw Error(Hn(188))}function Foe(t){var e=t.alternate;if(!e){if(e=E_(t),e===null)throw Error(Hn(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var l=i.alternate;if(l===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===l.child){for(l=i.child;l;){if(l===n)return x8(i),t;if(l===r)return x8(i),e;l=l.sibling}throw Error(Hn(188))}if(n.return!==r.return)n=i,r=l;else{for(var u=!1,s=i.child;s;){if(s===n){u=!0,n=i,r=l;break}if(s===r){u=!0,r=i,n=l;break}s=s.sibling}if(!u){for(s=l.child;s;){if(s===n){u=!0,n=l,r=i;break}if(s===r){u=!0,r=l,n=i;break}s=s.sibling}if(!u)throw Error(Hn(189))}}if(n.alternate!==r)throw Error(Hn(190))}if(n.tag!==3)throw Error(Hn(188));return n.stateNode.current===n?t:e}function c$(t){return t=Foe(t),t!==null?u$(t):null}function u$(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=u$(t);if(e!==null)return e;t=t.sibling}return null}var h$=yu.unstable_scheduleCallback,v8=yu.unstable_cancelCallback,Boe=yu.unstable_shouldYield,zoe=yu.unstable_requestPaint,pa=yu.unstable_now,joe=yu.unstable_getCurrentPriorityLevel,IO=yu.unstable_ImmediatePriority,d$=yu.unstable_UserBlockingPriority,dC=yu.unstable_NormalPriority,Voe=yu.unstable_LowPriority,f$=yu.unstable_IdlePriority,GI=null,bd=null;function Uoe(t){if(bd&&typeof bd.onCommitFiberRoot=="function")try{bd.onCommitFiberRoot(GI,t,void 0,(t.current.flags&128)===128)}catch{}}var Mh=Math.clz32?Math.clz32:$oe,Hoe=Math.log,Woe=Math.LN2;function $oe(t){return t>>>=0,t===0?32:31-(Hoe(t)/Woe|0)|0}var bS=64,wS=4194304;function Qv(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function fC(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,l=t.pingedLanes,u=n&268435455;if(u!==0){var s=u&~i;s!==0?r=Qv(s):(l&=u,l!==0&&(r=Qv(l)))}else u=n&~i,u!==0?r=Qv(u):l!==0&&(r=Qv(l));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,l=e&-e,i>=l||i===16&&(l&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Mh(e),i=1<<n,r|=t[n],e&=~i;return r}function qoe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Goe(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,l=t.pendingLanes;0<l;){var u=31-Mh(l),s=1<<u,v=i[u];v===-1?(!(s&n)||s&r)&&(i[u]=qoe(s,e)):v<=e&&(t.expiredLanes|=s),l&=~s}}function $3(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function p$(){var t=bS;return bS<<=1,!(bS&4194240)&&(bS=64),t}function GP(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Yw(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Mh(e),t[e]=n}function Yoe(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Mh(n),l=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~l}}function AO(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Mh(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Zs=0;function m$(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var g$,RO,_$,y$,x$,q3=!1,ES=[],Kp=null,Zp=null,Qp=null,Kb=new Map,Zb=new Map,Lp=[],Xoe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function b8(t,e){switch(t){case"focusin":case"focusout":Kp=null;break;case"dragenter":case"dragleave":Zp=null;break;case"mouseover":case"mouseout":Qp=null;break;case"pointerover":case"pointerout":Kb.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zb.delete(e.pointerId)}}function Tv(t,e,n,r,i,l){return t===null||t.nativeEvent!==l?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:l,targetContainers:[i]},e!==null&&(e=Kw(e),e!==null&&RO(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Koe(t,e,n,r,i){switch(e){case"focusin":return Kp=Tv(Kp,t,e,n,r,i),!0;case"dragenter":return Zp=Tv(Zp,t,e,n,r,i),!0;case"mouseover":return Qp=Tv(Qp,t,e,n,r,i),!0;case"pointerover":var l=i.pointerId;return Kb.set(l,Tv(Kb.get(l)||null,t,e,n,r,i)),!0;case"gotpointercapture":return l=i.pointerId,Zb.set(l,Tv(Zb.get(l)||null,t,e,n,r,i)),!0}return!1}function v$(t){var e=Bg(t.target);if(e!==null){var n=E_(e);if(n!==null){if(e=n.tag,e===13){if(e=l$(n),e!==null){t.blockedOn=e,x$(t.priority,function(){_$(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ST(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=G3(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);V3=r,n.target.dispatchEvent(r),V3=null}else return e=Kw(n),e!==null&&RO(e),t.blockedOn=n,!1;e.shift()}return!0}function w8(t,e,n){ST(t)&&n.delete(e)}function Zoe(){q3=!1,Kp!==null&&ST(Kp)&&(Kp=null),Zp!==null&&ST(Zp)&&(Zp=null),Qp!==null&&ST(Qp)&&(Qp=null),Kb.forEach(w8),Zb.forEach(w8)}function Cv(t,e){t.blockedOn===e&&(t.blockedOn=null,q3||(q3=!0,yu.unstable_scheduleCallback(yu.unstable_NormalPriority,Zoe)))}function Qb(t){function e(i){return Cv(i,t)}if(0<ES.length){Cv(ES[0],t);for(var n=1;n<ES.length;n++){var r=ES[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Kp!==null&&Cv(Kp,t),Zp!==null&&Cv(Zp,t),Qp!==null&&Cv(Qp,t),Kb.forEach(e),Zb.forEach(e),n=0;n<Lp.length;n++)r=Lp[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Lp.length&&(n=Lp[0],n.blockedOn===null);)v$(n),n.blockedOn===null&&Lp.shift()}var my=jf.ReactCurrentBatchConfig,pC=!0;function Qoe(t,e,n,r){var i=Zs,l=my.transition;my.transition=null;try{Zs=1,MO(t,e,n,r)}finally{Zs=i,my.transition=l}}function Joe(t,e,n,r){var i=Zs,l=my.transition;my.transition=null;try{Zs=4,MO(t,e,n,r)}finally{Zs=i,my.transition=l}}function MO(t,e,n,r){if(pC){var i=G3(t,e,n,r);if(i===null)rD(t,e,r,mC,n),b8(t,r);else if(Koe(i,t,e,n,r))r.stopPropagation();else if(b8(t,r),e&4&&-1<Xoe.indexOf(t)){for(;i!==null;){var l=Kw(i);if(l!==null&&g$(l),l=G3(t,e,n,r),l===null&&rD(t,e,r,mC,n),l===i)break;i=l}i!==null&&r.stopPropagation()}else rD(t,e,r,null,n)}}var mC=null;function G3(t,e,n,r){if(mC=null,t=CO(r),t=Bg(t),t!==null)if(e=E_(t),e===null)t=null;else if(n=e.tag,n===13){if(t=l$(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return mC=t,null}function b$(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(joe()){case IO:return 1;case d$:return 4;case dC:case Voe:return 16;case f$:return 536870912;default:return 16}default:return 16}}var Up=null,PO=null,TT=null;function w$(){if(TT)return TT;var t,e=PO,n=e.length,r,i="value"in Up?Up.value:Up.textContent,l=i.length;for(t=0;t<n&&e[t]===i[t];t++);var u=n-t;for(r=1;r<=u&&e[n-r]===i[l-r];r++);return TT=i.slice(t,1<r?1-r:void 0)}function CT(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function SS(){return!0}function E8(){return!1}function bu(t){function e(n,r,i,l,u){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=l,this.target=u,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(l):l[s]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?SS:E8,this.isPropagationStopped=E8,this}return Go(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=SS)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=SS)},persist:function(){},isPersistent:SS}),e}var fx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},DO=bu(fx),Xw=Go({},fx,{view:0,detail:0}),eae=bu(Xw),YP,XP,Iv,YI=Go({},Xw,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kO,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Iv&&(Iv&&t.type==="mousemove"?(YP=t.screenX-Iv.screenX,XP=t.screenY-Iv.screenY):XP=YP=0,Iv=t),YP)},movementY:function(t){return"movementY"in t?t.movementY:XP}}),S8=bu(YI),tae=Go({},YI,{dataTransfer:0}),nae=bu(tae),rae=Go({},Xw,{relatedTarget:0}),KP=bu(rae),iae=Go({},fx,{animationName:0,elapsedTime:0,pseudoElement:0}),sae=bu(iae),oae=Go({},fx,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),aae=bu(oae),lae=Go({},fx,{data:0}),T8=bu(lae),cae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uae={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dae(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=hae[t])?!!e[t]:!1}function kO(){return dae}var fae=Go({},Xw,{key:function(t){if(t.key){var e=cae[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=CT(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?uae[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kO,charCode:function(t){return t.type==="keypress"?CT(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?CT(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),pae=bu(fae),mae=Go({},YI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),C8=bu(mae),gae=Go({},Xw,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kO}),_ae=bu(gae),yae=Go({},fx,{propertyName:0,elapsedTime:0,pseudoElement:0}),xae=bu(yae),vae=Go({},YI,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),bae=bu(vae),wae=[9,13,27,32],NO=Ef&&"CompositionEvent"in window,vb=null;Ef&&"documentMode"in document&&(vb=document.documentMode);var Eae=Ef&&"TextEvent"in window&&!vb,E$=Ef&&(!NO||vb&&8<vb&&11>=vb),I8=" ",A8=!1;function S$(t,e){switch(t){case"keyup":return wae.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function T$(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var J0=!1;function Sae(t,e){switch(t){case"compositionend":return T$(e);case"keypress":return e.which!==32?null:(A8=!0,I8);case"textInput":return t=e.data,t===I8&&A8?null:t;default:return null}}function Tae(t,e){if(J0)return t==="compositionend"||!NO&&S$(t,e)?(t=w$(),TT=PO=Up=null,J0=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return E$&&e.locale!=="ko"?null:e.data;default:return null}}var Cae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function R8(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Cae[t.type]:e==="textarea"}function C$(t,e,n,r){r$(r),e=gC(e,"onChange"),0<e.length&&(n=new DO("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var bb=null,Jb=null;function Iae(t){F$(t,0)}function XI(t){var e=ny(t);if(KW(e))return t}function Aae(t,e){if(t==="change")return e}var I$=!1;if(Ef){var ZP;if(Ef){var QP="oninput"in document;if(!QP){var M8=document.createElement("div");M8.setAttribute("oninput","return;"),QP=typeof M8.oninput=="function"}ZP=QP}else ZP=!1;I$=ZP&&(!document.documentMode||9<document.documentMode)}function P8(){bb&&(bb.detachEvent("onpropertychange",A$),Jb=bb=null)}function A$(t){if(t.propertyName==="value"&&XI(Jb)){var e=[];C$(e,Jb,t,CO(t)),a$(Iae,e)}}function Rae(t,e,n){t==="focusin"?(P8(),bb=e,Jb=n,bb.attachEvent("onpropertychange",A$)):t==="focusout"&&P8()}function Mae(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return XI(Jb)}function Pae(t,e){if(t==="click")return XI(e)}function Dae(t,e){if(t==="input"||t==="change")return XI(e)}function kae(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Oh=typeof Object.is=="function"?Object.is:kae;function ew(t,e){if(Oh(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!R3.call(e,i)||!Oh(t[i],e[i]))return!1}return!0}function D8(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function k8(t,e){var n=D8(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=D8(n)}}function R$(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?R$(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function M$(){for(var t=window,e=cC();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=cC(t.document)}return e}function OO(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Nae(t){var e=M$(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&R$(n.ownerDocument.documentElement,n)){if(r!==null&&OO(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,l=Math.min(r.start,i);r=r.end===void 0?l:Math.min(r.end,i),!t.extend&&l>r&&(i=r,r=l,l=i),i=k8(n,l);var u=k8(n,r);i&&u&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==u.node||t.focusOffset!==u.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),l>r?(t.addRange(e),t.extend(u.node,u.offset)):(e.setEnd(u.node,u.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Oae=Ef&&"documentMode"in document&&11>=document.documentMode,ey=null,Y3=null,wb=null,X3=!1;function N8(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;X3||ey==null||ey!==cC(r)||(r=ey,"selectionStart"in r&&OO(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),wb&&ew(wb,r)||(wb=r,r=gC(Y3,"onSelect"),0<r.length&&(e=new DO("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ey)))}function TS(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ty={animationend:TS("Animation","AnimationEnd"),animationiteration:TS("Animation","AnimationIteration"),animationstart:TS("Animation","AnimationStart"),transitionend:TS("Transition","TransitionEnd")},JP={},P$={};Ef&&(P$=document.createElement("div").style,"AnimationEvent"in window||(delete ty.animationend.animation,delete ty.animationiteration.animation,delete ty.animationstart.animation),"TransitionEvent"in window||delete ty.transitionend.transition);function KI(t){if(JP[t])return JP[t];if(!ty[t])return t;var e=ty[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in P$)return JP[t]=e[n];return t}var D$=KI("animationend"),k$=KI("animationiteration"),N$=KI("animationstart"),O$=KI("transitionend"),L$=new Map,O8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pm(t,e){L$.set(t,e),w_(e,[t])}for(var eD=0;eD<O8.length;eD++){var tD=O8[eD],Lae=tD.toLowerCase(),Fae=tD[0].toUpperCase()+tD.slice(1);Pm(Lae,"on"+Fae)}Pm(D$,"onAnimationEnd");Pm(k$,"onAnimationIteration");Pm(N$,"onAnimationStart");Pm("dblclick","onDoubleClick");Pm("focusin","onFocus");Pm("focusout","onBlur");Pm(O$,"onTransitionEnd");ky("onMouseEnter",["mouseout","mouseover"]);ky("onMouseLeave",["mouseout","mouseover"]);ky("onPointerEnter",["pointerout","pointerover"]);ky("onPointerLeave",["pointerout","pointerover"]);w_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));w_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));w_("onBeforeInput",["compositionend","keypress","textInput","paste"]);w_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));w_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));w_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bae=new Set("cancel close invalid load scroll toggle".split(" ").concat(Jv));function L8(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Loe(r,e,void 0,t),t.currentTarget=null}function F$(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var l=void 0;if(e)for(var u=r.length-1;0<=u;u--){var s=r[u],v=s.instance,w=s.currentTarget;if(s=s.listener,v!==l&&i.isPropagationStopped())break e;L8(i,s,w),l=v}else for(u=0;u<r.length;u++){if(s=r[u],v=s.instance,w=s.currentTarget,s=s.listener,v!==l&&i.isPropagationStopped())break e;L8(i,s,w),l=v}}}if(hC)throw t=W3,hC=!1,W3=null,t}function So(t,e){var n=e[ek];n===void 0&&(n=e[ek]=new Set);var r=t+"__bubble";n.has(r)||(B$(e,t,2,!1),n.add(r))}function nD(t,e,n){var r=0;e&&(r|=4),B$(n,t,r,e)}var CS="_reactListening"+Math.random().toString(36).slice(2);function tw(t){if(!t[CS]){t[CS]=!0,$W.forEach(function(n){n!=="selectionchange"&&(Bae.has(n)||nD(n,!1,t),nD(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[CS]||(e[CS]=!0,nD("selectionchange",!1,e))}}function B$(t,e,n,r){switch(b$(e)){case 1:var i=Qoe;break;case 4:i=Joe;break;default:i=MO}n=i.bind(null,e,n,t),i=void 0,!H3||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function rD(t,e,n,r,i){var l=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var u=r.tag;if(u===3||u===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(u===4)for(u=r.return;u!==null;){var v=u.tag;if((v===3||v===4)&&(v=u.stateNode.containerInfo,v===i||v.nodeType===8&&v.parentNode===i))return;u=u.return}for(;s!==null;){if(u=Bg(s),u===null)return;if(v=u.tag,v===5||v===6){r=l=u;continue e}s=s.parentNode}}r=r.return}a$(function(){var w=l,A=CO(n),F=[];e:{var W=L$.get(t);if(W!==void 0){var K=DO,Q=t;switch(t){case"keypress":if(CT(n)===0)break e;case"keydown":case"keyup":K=pae;break;case"focusin":Q="focus",K=KP;break;case"focusout":Q="blur",K=KP;break;case"beforeblur":case"afterblur":K=KP;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":K=S8;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":K=nae;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":K=_ae;break;case D$:case k$:case N$:K=sae;break;case O$:K=xae;break;case"scroll":K=eae;break;case"wheel":K=bae;break;case"copy":case"cut":case"paste":K=aae;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":K=C8}var Z=(e&4)!==0,oe=!Z&&t==="scroll",ae=Z?W!==null?W+"Capture":null:W;Z=[];for(var me=w,pe;me!==null;){pe=me;var _e=pe.stateNode;if(pe.tag===5&&_e!==null&&(pe=_e,ae!==null&&(_e=Xb(me,ae),_e!=null&&Z.push(nw(me,_e,pe)))),oe)break;me=me.return}0<Z.length&&(W=new K(W,Q,null,n,A),F.push({event:W,listeners:Z}))}}if(!(e&7)){e:{if(W=t==="mouseover"||t==="pointerover",K=t==="mouseout"||t==="pointerout",W&&n!==V3&&(Q=n.relatedTarget||n.fromElement)&&(Bg(Q)||Q[Sf]))break e;if((K||W)&&(W=A.window===A?A:(W=A.ownerDocument)?W.defaultView||W.parentWindow:window,K?(Q=n.relatedTarget||n.toElement,K=w,Q=Q?Bg(Q):null,Q!==null&&(oe=E_(Q),Q!==oe||Q.tag!==5&&Q.tag!==6)&&(Q=null)):(K=null,Q=w),K!==Q)){if(Z=S8,_e="onMouseLeave",ae="onMouseEnter",me="mouse",(t==="pointerout"||t==="pointerover")&&(Z=C8,_e="onPointerLeave",ae="onPointerEnter",me="pointer"),oe=K==null?W:ny(K),pe=Q==null?W:ny(Q),W=new Z(_e,me+"leave",K,n,A),W.target=oe,W.relatedTarget=pe,_e=null,Bg(A)===w&&(Z=new Z(ae,me+"enter",Q,n,A),Z.target=pe,Z.relatedTarget=oe,_e=Z),oe=_e,K&&Q)t:{for(Z=K,ae=Q,me=0,pe=Z;pe;pe=P0(pe))me++;for(pe=0,_e=ae;_e;_e=P0(_e))pe++;for(;0<me-pe;)Z=P0(Z),me--;for(;0<pe-me;)ae=P0(ae),pe--;for(;me--;){if(Z===ae||ae!==null&&Z===ae.alternate)break t;Z=P0(Z),ae=P0(ae)}Z=null}else Z=null;K!==null&&F8(F,W,K,Z,!1),Q!==null&&oe!==null&&F8(F,oe,Q,Z,!0)}}e:{if(W=w?ny(w):window,K=W.nodeName&&W.nodeName.toLowerCase(),K==="select"||K==="input"&&W.type==="file")var De=Aae;else if(R8(W))if(I$)De=Dae;else{De=Mae;var Ae=Rae}else(K=W.nodeName)&&K.toLowerCase()==="input"&&(W.type==="checkbox"||W.type==="radio")&&(De=Pae);if(De&&(De=De(t,w))){C$(F,De,n,A);break e}Ae&&Ae(t,W,w),t==="focusout"&&(Ae=W._wrapperState)&&Ae.controlled&&W.type==="number"&&L3(W,"number",W.value)}switch(Ae=w?ny(w):window,t){case"focusin":(R8(Ae)||Ae.contentEditable==="true")&&(ey=Ae,Y3=w,wb=null);break;case"focusout":wb=Y3=ey=null;break;case"mousedown":X3=!0;break;case"contextmenu":case"mouseup":case"dragend":X3=!1,N8(F,n,A);break;case"selectionchange":if(Oae)break;case"keydown":case"keyup":N8(F,n,A)}var re;if(NO)e:{switch(t){case"compositionstart":var fe="onCompositionStart";break e;case"compositionend":fe="onCompositionEnd";break e;case"compositionupdate":fe="onCompositionUpdate";break e}fe=void 0}else J0?S$(t,n)&&(fe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(fe="onCompositionStart");fe&&(E$&&n.locale!=="ko"&&(J0||fe!=="onCompositionStart"?fe==="onCompositionEnd"&&J0&&(re=w$()):(Up=A,PO="value"in Up?Up.value:Up.textContent,J0=!0)),Ae=gC(w,fe),0<Ae.length&&(fe=new T8(fe,t,null,n,A),F.push({event:fe,listeners:Ae}),re?fe.data=re:(re=T$(n),re!==null&&(fe.data=re)))),(re=Eae?Sae(t,n):Tae(t,n))&&(w=gC(w,"onBeforeInput"),0<w.length&&(A=new T8("onBeforeInput","beforeinput",null,n,A),F.push({event:A,listeners:w}),A.data=re))}F$(F,e)})}function nw(t,e,n){return{instance:t,listener:e,currentTarget:n}}function gC(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,l=i.stateNode;i.tag===5&&l!==null&&(i=l,l=Xb(t,n),l!=null&&r.unshift(nw(t,l,i)),l=Xb(t,e),l!=null&&r.push(nw(t,l,i))),t=t.return}return r}function P0(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function F8(t,e,n,r,i){for(var l=e._reactName,u=[];n!==null&&n!==r;){var s=n,v=s.alternate,w=s.stateNode;if(v!==null&&v===r)break;s.tag===5&&w!==null&&(s=w,i?(v=Xb(n,l),v!=null&&u.unshift(nw(n,v,s))):i||(v=Xb(n,l),v!=null&&u.push(nw(n,v,s)))),n=n.return}u.length!==0&&t.push({event:e,listeners:u})}var zae=/\r\n?/g,jae=/\u0000|\uFFFD/g;function B8(t){return(typeof t=="string"?t:""+t).replace(zae,`
`).replace(jae,"")}function IS(t,e,n){if(e=B8(e),B8(t)!==e&&n)throw Error(Hn(425))}function _C(){}var K3=null,Z3=null;function Q3(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var J3=typeof setTimeout=="function"?setTimeout:void 0,Vae=typeof clearTimeout=="function"?clearTimeout:void 0,z8=typeof Promise=="function"?Promise:void 0,Uae=typeof queueMicrotask=="function"?queueMicrotask:typeof z8<"u"?function(t){return z8.resolve(null).then(t).catch(Hae)}:J3;function Hae(t){setTimeout(function(){throw t})}function iD(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Qb(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Qb(e)}function Jp(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function j8(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var px=Math.random().toString(36).slice(2),yd="__reactFiber$"+px,rw="__reactProps$"+px,Sf="__reactContainer$"+px,ek="__reactEvents$"+px,Wae="__reactListeners$"+px,$ae="__reactHandles$"+px;function Bg(t){var e=t[yd];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Sf]||n[yd]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=j8(t);t!==null;){if(n=t[yd])return n;t=j8(t)}return e}t=n,n=t.parentNode}return null}function Kw(t){return t=t[yd]||t[Sf],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ny(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Hn(33))}function ZI(t){return t[rw]||null}var tk=[],ry=-1;function Dm(t){return{current:t}}function Ro(t){0>ry||(t.current=tk[ry],tk[ry]=null,ry--)}function yo(t,e){ry++,tk[ry]=t.current,t.current=e}var fm={},tc=Dm(fm),$c=Dm(!1),t_=fm;function Ny(t,e){var n=t.type.contextTypes;if(!n)return fm;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},l;for(l in n)i[l]=e[l];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function qc(t){return t=t.childContextTypes,t!=null}function yC(){Ro($c),Ro(tc)}function V8(t,e,n){if(tc.current!==fm)throw Error(Hn(168));yo(tc,e),yo($c,n)}function z$(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Hn(108,Roe(t)||"Unknown",i));return Go({},n,r)}function xC(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||fm,t_=tc.current,yo(tc,t),yo($c,$c.current),!0}function U8(t,e,n){var r=t.stateNode;if(!r)throw Error(Hn(169));n?(t=z$(t,e,t_),r.__reactInternalMemoizedMergedChildContext=t,Ro($c),Ro(tc),yo(tc,t)):Ro($c),yo($c,n)}var af=null,QI=!1,sD=!1;function j$(t){af===null?af=[t]:af.push(t)}function qae(t){QI=!0,j$(t)}function km(){if(!sD&&af!==null){sD=!0;var t=0,e=Zs;try{var n=af;for(Zs=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}af=null,QI=!1}catch(i){throw af!==null&&(af=af.slice(t+1)),h$(IO,km),i}finally{Zs=e,sD=!1}}return null}var iy=[],sy=0,vC=null,bC=0,Bu=[],zu=0,n_=null,uf=1,hf="";function Rg(t,e){iy[sy++]=bC,iy[sy++]=vC,vC=t,bC=e}function V$(t,e,n){Bu[zu++]=uf,Bu[zu++]=hf,Bu[zu++]=n_,n_=t;var r=uf;t=hf;var i=32-Mh(r)-1;r&=~(1<<i),n+=1;var l=32-Mh(e)+i;if(30<l){var u=i-i%5;l=(r&(1<<u)-1).toString(32),r>>=u,i-=u,uf=1<<32-Mh(e)+i|n<<i|r,hf=l+t}else uf=1<<l|n<<i|r,hf=t}function LO(t){t.return!==null&&(Rg(t,1),V$(t,1,0))}function FO(t){for(;t===vC;)vC=iy[--sy],iy[sy]=null,bC=iy[--sy],iy[sy]=null;for(;t===n_;)n_=Bu[--zu],Bu[zu]=null,hf=Bu[--zu],Bu[zu]=null,uf=Bu[--zu],Bu[zu]=null}var pu=null,uu=null,ko=!1,Eh=null;function U$(t,e){var n=Vu(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function H8(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,pu=t,uu=Jp(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,pu=t,uu=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=n_!==null?{id:uf,overflow:hf}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Vu(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,pu=t,uu=null,!0):!1;default:return!1}}function nk(t){return(t.mode&1)!==0&&(t.flags&128)===0}function rk(t){if(ko){var e=uu;if(e){var n=e;if(!H8(t,e)){if(nk(t))throw Error(Hn(418));e=Jp(n.nextSibling);var r=pu;e&&H8(t,e)?U$(r,n):(t.flags=t.flags&-4097|2,ko=!1,pu=t)}}else{if(nk(t))throw Error(Hn(418));t.flags=t.flags&-4097|2,ko=!1,pu=t}}}function W8(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pu=t}function AS(t){if(t!==pu)return!1;if(!ko)return W8(t),ko=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Q3(t.type,t.memoizedProps)),e&&(e=uu)){if(nk(t))throw H$(),Error(Hn(418));for(;e;)U$(t,e),e=Jp(e.nextSibling)}if(W8(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Hn(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){uu=Jp(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}uu=null}}else uu=pu?Jp(t.stateNode.nextSibling):null;return!0}function H$(){for(var t=uu;t;)t=Jp(t.nextSibling)}function Oy(){uu=pu=null,ko=!1}function BO(t){Eh===null?Eh=[t]:Eh.push(t)}var Gae=jf.ReactCurrentBatchConfig;function Av(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Hn(309));var r=n.stateNode}if(!r)throw Error(Hn(147,t));var i=r,l=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===l?e.ref:(e=function(u){var s=i.refs;u===null?delete s[l]:s[l]=u},e._stringRef=l,e)}if(typeof t!="string")throw Error(Hn(284));if(!n._owner)throw Error(Hn(290,t))}return t}function RS(t,e){throw t=Object.prototype.toString.call(e),Error(Hn(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function $8(t){var e=t._init;return e(t._payload)}function W$(t){function e(ae,me){if(t){var pe=ae.deletions;pe===null?(ae.deletions=[me],ae.flags|=16):pe.push(me)}}function n(ae,me){if(!t)return null;for(;me!==null;)e(ae,me),me=me.sibling;return null}function r(ae,me){for(ae=new Map;me!==null;)me.key!==null?ae.set(me.key,me):ae.set(me.index,me),me=me.sibling;return ae}function i(ae,me){return ae=rm(ae,me),ae.index=0,ae.sibling=null,ae}function l(ae,me,pe){return ae.index=pe,t?(pe=ae.alternate,pe!==null?(pe=pe.index,pe<me?(ae.flags|=2,me):pe):(ae.flags|=2,me)):(ae.flags|=1048576,me)}function u(ae){return t&&ae.alternate===null&&(ae.flags|=2),ae}function s(ae,me,pe,_e){return me===null||me.tag!==6?(me=dD(pe,ae.mode,_e),me.return=ae,me):(me=i(me,pe),me.return=ae,me)}function v(ae,me,pe,_e){var De=pe.type;return De===Q0?A(ae,me,pe.props.children,_e,pe.key):me!==null&&(me.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===kp&&$8(De)===me.type)?(_e=i(me,pe.props),_e.ref=Av(ae,me,pe),_e.return=ae,_e):(_e=kT(pe.type,pe.key,pe.props,null,ae.mode,_e),_e.ref=Av(ae,me,pe),_e.return=ae,_e)}function w(ae,me,pe,_e){return me===null||me.tag!==4||me.stateNode.containerInfo!==pe.containerInfo||me.stateNode.implementation!==pe.implementation?(me=fD(pe,ae.mode,_e),me.return=ae,me):(me=i(me,pe.children||[]),me.return=ae,me)}function A(ae,me,pe,_e,De){return me===null||me.tag!==7?(me=Zg(pe,ae.mode,_e,De),me.return=ae,me):(me=i(me,pe),me.return=ae,me)}function F(ae,me,pe){if(typeof me=="string"&&me!==""||typeof me=="number")return me=dD(""+me,ae.mode,pe),me.return=ae,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case yS:return pe=kT(me.type,me.key,me.props,null,ae.mode,pe),pe.ref=Av(ae,null,me),pe.return=ae,pe;case Z0:return me=fD(me,ae.mode,pe),me.return=ae,me;case kp:var _e=me._init;return F(ae,_e(me._payload),pe)}if(Zv(me)||Ev(me))return me=Zg(me,ae.mode,pe,null),me.return=ae,me;RS(ae,me)}return null}function W(ae,me,pe,_e){var De=me!==null?me.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number")return De!==null?null:s(ae,me,""+pe,_e);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case yS:return pe.key===De?v(ae,me,pe,_e):null;case Z0:return pe.key===De?w(ae,me,pe,_e):null;case kp:return De=pe._init,W(ae,me,De(pe._payload),_e)}if(Zv(pe)||Ev(pe))return De!==null?null:A(ae,me,pe,_e,null);RS(ae,pe)}return null}function K(ae,me,pe,_e,De){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return ae=ae.get(pe)||null,s(me,ae,""+_e,De);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case yS:return ae=ae.get(_e.key===null?pe:_e.key)||null,v(me,ae,_e,De);case Z0:return ae=ae.get(_e.key===null?pe:_e.key)||null,w(me,ae,_e,De);case kp:var Ae=_e._init;return K(ae,me,pe,Ae(_e._payload),De)}if(Zv(_e)||Ev(_e))return ae=ae.get(pe)||null,A(me,ae,_e,De,null);RS(me,_e)}return null}function Q(ae,me,pe,_e){for(var De=null,Ae=null,re=me,fe=me=0,ye=null;re!==null&&fe<pe.length;fe++){re.index>fe?(ye=re,re=null):ye=re.sibling;var ue=W(ae,re,pe[fe],_e);if(ue===null){re===null&&(re=ye);break}t&&re&&ue.alternate===null&&e(ae,re),me=l(ue,me,fe),Ae===null?De=ue:Ae.sibling=ue,Ae=ue,re=ye}if(fe===pe.length)return n(ae,re),ko&&Rg(ae,fe),De;if(re===null){for(;fe<pe.length;fe++)re=F(ae,pe[fe],_e),re!==null&&(me=l(re,me,fe),Ae===null?De=re:Ae.sibling=re,Ae=re);return ko&&Rg(ae,fe),De}for(re=r(ae,re);fe<pe.length;fe++)ye=K(re,ae,fe,pe[fe],_e),ye!==null&&(t&&ye.alternate!==null&&re.delete(ye.key===null?fe:ye.key),me=l(ye,me,fe),Ae===null?De=ye:Ae.sibling=ye,Ae=ye);return t&&re.forEach(function(Ie){return e(ae,Ie)}),ko&&Rg(ae,fe),De}function Z(ae,me,pe,_e){var De=Ev(pe);if(typeof De!="function")throw Error(Hn(150));if(pe=De.call(pe),pe==null)throw Error(Hn(151));for(var Ae=De=null,re=me,fe=me=0,ye=null,ue=pe.next();re!==null&&!ue.done;fe++,ue=pe.next()){re.index>fe?(ye=re,re=null):ye=re.sibling;var Ie=W(ae,re,ue.value,_e);if(Ie===null){re===null&&(re=ye);break}t&&re&&Ie.alternate===null&&e(ae,re),me=l(Ie,me,fe),Ae===null?De=Ie:Ae.sibling=Ie,Ae=Ie,re=ye}if(ue.done)return n(ae,re),ko&&Rg(ae,fe),De;if(re===null){for(;!ue.done;fe++,ue=pe.next())ue=F(ae,ue.value,_e),ue!==null&&(me=l(ue,me,fe),Ae===null?De=ue:Ae.sibling=ue,Ae=ue);return ko&&Rg(ae,fe),De}for(re=r(ae,re);!ue.done;fe++,ue=pe.next())ue=K(re,ae,fe,ue.value,_e),ue!==null&&(t&&ue.alternate!==null&&re.delete(ue.key===null?fe:ue.key),me=l(ue,me,fe),Ae===null?De=ue:Ae.sibling=ue,Ae=ue);return t&&re.forEach(function(Oe){return e(ae,Oe)}),ko&&Rg(ae,fe),De}function oe(ae,me,pe,_e){if(typeof pe=="object"&&pe!==null&&pe.type===Q0&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case yS:e:{for(var De=pe.key,Ae=me;Ae!==null;){if(Ae.key===De){if(De=pe.type,De===Q0){if(Ae.tag===7){n(ae,Ae.sibling),me=i(Ae,pe.props.children),me.return=ae,ae=me;break e}}else if(Ae.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===kp&&$8(De)===Ae.type){n(ae,Ae.sibling),me=i(Ae,pe.props),me.ref=Av(ae,Ae,pe),me.return=ae,ae=me;break e}n(ae,Ae);break}else e(ae,Ae);Ae=Ae.sibling}pe.type===Q0?(me=Zg(pe.props.children,ae.mode,_e,pe.key),me.return=ae,ae=me):(_e=kT(pe.type,pe.key,pe.props,null,ae.mode,_e),_e.ref=Av(ae,me,pe),_e.return=ae,ae=_e)}return u(ae);case Z0:e:{for(Ae=pe.key;me!==null;){if(me.key===Ae)if(me.tag===4&&me.stateNode.containerInfo===pe.containerInfo&&me.stateNode.implementation===pe.implementation){n(ae,me.sibling),me=i(me,pe.children||[]),me.return=ae,ae=me;break e}else{n(ae,me);break}else e(ae,me);me=me.sibling}me=fD(pe,ae.mode,_e),me.return=ae,ae=me}return u(ae);case kp:return Ae=pe._init,oe(ae,me,Ae(pe._payload),_e)}if(Zv(pe))return Q(ae,me,pe,_e);if(Ev(pe))return Z(ae,me,pe,_e);RS(ae,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"?(pe=""+pe,me!==null&&me.tag===6?(n(ae,me.sibling),me=i(me,pe),me.return=ae,ae=me):(n(ae,me),me=dD(pe,ae.mode,_e),me.return=ae,ae=me),u(ae)):n(ae,me)}return oe}var Ly=W$(!0),$$=W$(!1),wC=Dm(null),EC=null,oy=null,zO=null;function jO(){zO=oy=EC=null}function VO(t){var e=wC.current;Ro(wC),t._currentValue=e}function ik(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function gy(t,e){EC=t,zO=oy=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Vc=!0),t.firstContext=null)}function qu(t){var e=t._currentValue;if(zO!==t)if(t={context:t,memoizedValue:e,next:null},oy===null){if(EC===null)throw Error(Hn(308));oy=t,EC.dependencies={lanes:0,firstContext:t}}else oy=oy.next=t;return e}var zg=null;function UO(t){zg===null?zg=[t]:zg.push(t)}function q$(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,UO(e)):(n.next=i.next,i.next=n),e.interleaved=n,Tf(t,r)}function Tf(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Np=!1;function HO(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function G$(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gf(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function em(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Ts&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Tf(t,n)}return i=r.interleaved,i===null?(e.next=e,UO(r)):(e.next=i.next,i.next=e),r.interleaved=e,Tf(t,n)}function IT(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,AO(t,n)}}function q8(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,l=null;if(n=n.firstBaseUpdate,n!==null){do{var u={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};l===null?i=l=u:l=l.next=u,n=n.next}while(n!==null);l===null?i=l=e:l=l.next=e}else i=l=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:l,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function SC(t,e,n,r){var i=t.updateQueue;Np=!1;var l=i.firstBaseUpdate,u=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var v=s,w=v.next;v.next=null,u===null?l=w:u.next=w,u=v;var A=t.alternate;A!==null&&(A=A.updateQueue,s=A.lastBaseUpdate,s!==u&&(s===null?A.firstBaseUpdate=w:s.next=w,A.lastBaseUpdate=v))}if(l!==null){var F=i.baseState;u=0,A=w=v=null,s=l;do{var W=s.lane,K=s.eventTime;if((r&W)===W){A!==null&&(A=A.next={eventTime:K,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var Q=t,Z=s;switch(W=e,K=n,Z.tag){case 1:if(Q=Z.payload,typeof Q=="function"){F=Q.call(K,F,W);break e}F=Q;break e;case 3:Q.flags=Q.flags&-65537|128;case 0:if(Q=Z.payload,W=typeof Q=="function"?Q.call(K,F,W):Q,W==null)break e;F=Go({},F,W);break e;case 2:Np=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,W=i.effects,W===null?i.effects=[s]:W.push(s))}else K={eventTime:K,lane:W,tag:s.tag,payload:s.payload,callback:s.callback,next:null},A===null?(w=A=K,v=F):A=A.next=K,u|=W;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;W=s,s=W.next,W.next=null,i.lastBaseUpdate=W,i.shared.pending=null}}while(!0);if(A===null&&(v=F),i.baseState=v,i.firstBaseUpdate=w,i.lastBaseUpdate=A,e=i.shared.interleaved,e!==null){i=e;do u|=i.lane,i=i.next;while(i!==e)}else l===null&&(i.shared.lanes=0);i_|=u,t.lanes=u,t.memoizedState=F}}function G8(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Hn(191,i));i.call(r)}}}var Zw={},wd=Dm(Zw),iw=Dm(Zw),sw=Dm(Zw);function jg(t){if(t===Zw)throw Error(Hn(174));return t}function WO(t,e){switch(yo(sw,e),yo(iw,t),yo(wd,Zw),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:B3(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=B3(e,t)}Ro(wd),yo(wd,e)}function Fy(){Ro(wd),Ro(iw),Ro(sw)}function Y$(t){jg(sw.current);var e=jg(wd.current),n=B3(e,t.type);e!==n&&(yo(iw,t),yo(wd,n))}function $O(t){iw.current===t&&(Ro(wd),Ro(iw))}var Ho=Dm(0);function TC(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var oD=[];function qO(){for(var t=0;t<oD.length;t++)oD[t]._workInProgressVersionPrimary=null;oD.length=0}var AT=jf.ReactCurrentDispatcher,aD=jf.ReactCurrentBatchConfig,r_=0,qo=null,Ga=null,rl=null,CC=!1,Eb=!1,ow=0,Yae=0;function Vl(){throw Error(Hn(321))}function GO(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Oh(t[n],e[n]))return!1;return!0}function YO(t,e,n,r,i,l){if(r_=l,qo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,AT.current=t===null||t.memoizedState===null?Qae:Jae,t=n(r,i),Eb){l=0;do{if(Eb=!1,ow=0,25<=l)throw Error(Hn(301));l+=1,rl=Ga=null,e.updateQueue=null,AT.current=ele,t=n(r,i)}while(Eb)}if(AT.current=IC,e=Ga!==null&&Ga.next!==null,r_=0,rl=Ga=qo=null,CC=!1,e)throw Error(Hn(300));return t}function XO(){var t=ow!==0;return ow=0,t}function hd(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rl===null?qo.memoizedState=rl=t:rl=rl.next=t,rl}function Gu(){if(Ga===null){var t=qo.alternate;t=t!==null?t.memoizedState:null}else t=Ga.next;var e=rl===null?qo.memoizedState:rl.next;if(e!==null)rl=e,Ga=t;else{if(t===null)throw Error(Hn(310));Ga=t,t={memoizedState:Ga.memoizedState,baseState:Ga.baseState,baseQueue:Ga.baseQueue,queue:Ga.queue,next:null},rl===null?qo.memoizedState=rl=t:rl=rl.next=t}return rl}function aw(t,e){return typeof e=="function"?e(t):e}function lD(t){var e=Gu(),n=e.queue;if(n===null)throw Error(Hn(311));n.lastRenderedReducer=t;var r=Ga,i=r.baseQueue,l=n.pending;if(l!==null){if(i!==null){var u=i.next;i.next=l.next,l.next=u}r.baseQueue=i=l,n.pending=null}if(i!==null){l=i.next,r=r.baseState;var s=u=null,v=null,w=l;do{var A=w.lane;if((r_&A)===A)v!==null&&(v=v.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),r=w.hasEagerState?w.eagerState:t(r,w.action);else{var F={lane:A,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};v===null?(s=v=F,u=r):v=v.next=F,qo.lanes|=A,i_|=A}w=w.next}while(w!==null&&w!==l);v===null?u=r:v.next=s,Oh(r,e.memoizedState)||(Vc=!0),e.memoizedState=r,e.baseState=u,e.baseQueue=v,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do l=i.lane,qo.lanes|=l,i_|=l,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function cD(t){var e=Gu(),n=e.queue;if(n===null)throw Error(Hn(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,l=e.memoizedState;if(i!==null){n.pending=null;var u=i=i.next;do l=t(l,u.action),u=u.next;while(u!==i);Oh(l,e.memoizedState)||(Vc=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),n.lastRenderedState=l}return[l,r]}function X$(){}function K$(t,e){var n=qo,r=Gu(),i=e(),l=!Oh(r.memoizedState,i);if(l&&(r.memoizedState=i,Vc=!0),r=r.queue,KO(J$.bind(null,n,r,t),[t]),r.getSnapshot!==e||l||rl!==null&&rl.memoizedState.tag&1){if(n.flags|=2048,lw(9,Q$.bind(null,n,r,i,e),void 0,null),al===null)throw Error(Hn(349));r_&30||Z$(n,e,i)}return i}function Z$(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=qo.updateQueue,e===null?(e={lastEffect:null,stores:null},qo.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Q$(t,e,n,r){e.value=n,e.getSnapshot=r,eq(e)&&tq(t)}function J$(t,e,n){return n(function(){eq(e)&&tq(t)})}function eq(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Oh(t,n)}catch{return!0}}function tq(t){var e=Tf(t,1);e!==null&&Ph(e,t,1,-1)}function Y8(t){var e=hd();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:aw,lastRenderedState:t},e.queue=t,t=t.dispatch=Zae.bind(null,qo,t),[e.memoizedState,t]}function lw(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=qo.updateQueue,e===null?(e={lastEffect:null,stores:null},qo.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function nq(){return Gu().memoizedState}function RT(t,e,n,r){var i=hd();qo.flags|=t,i.memoizedState=lw(1|e,n,void 0,r===void 0?null:r)}function JI(t,e,n,r){var i=Gu();r=r===void 0?null:r;var l=void 0;if(Ga!==null){var u=Ga.memoizedState;if(l=u.destroy,r!==null&&GO(r,u.deps)){i.memoizedState=lw(e,n,l,r);return}}qo.flags|=t,i.memoizedState=lw(1|e,n,l,r)}function X8(t,e){return RT(8390656,8,t,e)}function KO(t,e){return JI(2048,8,t,e)}function rq(t,e){return JI(4,2,t,e)}function iq(t,e){return JI(4,4,t,e)}function sq(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function oq(t,e,n){return n=n!=null?n.concat([t]):null,JI(4,4,sq.bind(null,e,t),n)}function ZO(){}function aq(t,e){var n=Gu();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&GO(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function lq(t,e){var n=Gu();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&GO(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function cq(t,e,n){return r_&21?(Oh(n,e)||(n=p$(),qo.lanes|=n,i_|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Vc=!0),t.memoizedState=n)}function Xae(t,e){var n=Zs;Zs=n!==0&&4>n?n:4,t(!0);var r=aD.transition;aD.transition={};try{t(!1),e()}finally{Zs=n,aD.transition=r}}function uq(){return Gu().memoizedState}function Kae(t,e,n){var r=nm(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},hq(t))dq(e,n);else if(n=q$(t,e,n,r),n!==null){var i=_c();Ph(n,t,r,i),fq(n,e,r)}}function Zae(t,e,n){var r=nm(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(hq(t))dq(e,i);else{var l=t.alternate;if(t.lanes===0&&(l===null||l.lanes===0)&&(l=e.lastRenderedReducer,l!==null))try{var u=e.lastRenderedState,s=l(u,n);if(i.hasEagerState=!0,i.eagerState=s,Oh(s,u)){var v=e.interleaved;v===null?(i.next=i,UO(e)):(i.next=v.next,v.next=i),e.interleaved=i;return}}catch{}finally{}n=q$(t,e,i,r),n!==null&&(i=_c(),Ph(n,t,r,i),fq(n,e,r))}}function hq(t){var e=t.alternate;return t===qo||e!==null&&e===qo}function dq(t,e){Eb=CC=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function fq(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,AO(t,n)}}var IC={readContext:qu,useCallback:Vl,useContext:Vl,useEffect:Vl,useImperativeHandle:Vl,useInsertionEffect:Vl,useLayoutEffect:Vl,useMemo:Vl,useReducer:Vl,useRef:Vl,useState:Vl,useDebugValue:Vl,useDeferredValue:Vl,useTransition:Vl,useMutableSource:Vl,useSyncExternalStore:Vl,useId:Vl,unstable_isNewReconciler:!1},Qae={readContext:qu,useCallback:function(t,e){return hd().memoizedState=[t,e===void 0?null:e],t},useContext:qu,useEffect:X8,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,RT(4194308,4,sq.bind(null,e,t),n)},useLayoutEffect:function(t,e){return RT(4194308,4,t,e)},useInsertionEffect:function(t,e){return RT(4,2,t,e)},useMemo:function(t,e){var n=hd();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=hd();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Kae.bind(null,qo,t),[r.memoizedState,t]},useRef:function(t){var e=hd();return t={current:t},e.memoizedState=t},useState:Y8,useDebugValue:ZO,useDeferredValue:function(t){return hd().memoizedState=t},useTransition:function(){var t=Y8(!1),e=t[0];return t=Xae.bind(null,t[1]),hd().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=qo,i=hd();if(ko){if(n===void 0)throw Error(Hn(407));n=n()}else{if(n=e(),al===null)throw Error(Hn(349));r_&30||Z$(r,e,n)}i.memoizedState=n;var l={value:n,getSnapshot:e};return i.queue=l,X8(J$.bind(null,r,l,t),[t]),r.flags|=2048,lw(9,Q$.bind(null,r,l,n,e),void 0,null),n},useId:function(){var t=hd(),e=al.identifierPrefix;if(ko){var n=hf,r=uf;n=(r&~(1<<32-Mh(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ow++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Yae++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Jae={readContext:qu,useCallback:aq,useContext:qu,useEffect:KO,useImperativeHandle:oq,useInsertionEffect:rq,useLayoutEffect:iq,useMemo:lq,useReducer:lD,useRef:nq,useState:function(){return lD(aw)},useDebugValue:ZO,useDeferredValue:function(t){var e=Gu();return cq(e,Ga.memoizedState,t)},useTransition:function(){var t=lD(aw)[0],e=Gu().memoizedState;return[t,e]},useMutableSource:X$,useSyncExternalStore:K$,useId:uq,unstable_isNewReconciler:!1},ele={readContext:qu,useCallback:aq,useContext:qu,useEffect:KO,useImperativeHandle:oq,useInsertionEffect:rq,useLayoutEffect:iq,useMemo:lq,useReducer:cD,useRef:nq,useState:function(){return cD(aw)},useDebugValue:ZO,useDeferredValue:function(t){var e=Gu();return Ga===null?e.memoizedState=t:cq(e,Ga.memoizedState,t)},useTransition:function(){var t=cD(aw)[0],e=Gu().memoizedState;return[t,e]},useMutableSource:X$,useSyncExternalStore:K$,useId:uq,unstable_isNewReconciler:!1};function xh(t,e){if(t&&t.defaultProps){e=Go({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function sk(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Go({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var eA={isMounted:function(t){return(t=t._reactInternals)?E_(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=_c(),i=nm(t),l=gf(r,i);l.payload=e,n!=null&&(l.callback=n),e=em(t,l,i),e!==null&&(Ph(e,t,i,r),IT(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=_c(),i=nm(t),l=gf(r,i);l.tag=1,l.payload=e,n!=null&&(l.callback=n),e=em(t,l,i),e!==null&&(Ph(e,t,i,r),IT(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=_c(),r=nm(t),i=gf(n,r);i.tag=2,e!=null&&(i.callback=e),e=em(t,i,r),e!==null&&(Ph(e,t,r,n),IT(e,t,r))}};function K8(t,e,n,r,i,l,u){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,l,u):e.prototype&&e.prototype.isPureReactComponent?!ew(n,r)||!ew(i,l):!0}function pq(t,e,n){var r=!1,i=fm,l=e.contextType;return typeof l=="object"&&l!==null?l=qu(l):(i=qc(e)?t_:tc.current,r=e.contextTypes,l=(r=r!=null)?Ny(t,i):fm),e=new e(n,l),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=eA,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=l),e}function Z8(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&eA.enqueueReplaceState(e,e.state,null)}function ok(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},HO(t);var l=e.contextType;typeof l=="object"&&l!==null?i.context=qu(l):(l=qc(e)?t_:tc.current,i.context=Ny(t,l)),i.state=t.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&(sk(t,e,l,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&eA.enqueueReplaceState(i,i.state,null),SC(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function By(t,e){try{var n="",r=e;do n+=Aoe(r),r=r.return;while(r);var i=n}catch(l){i=`
Error generating stack: `+l.message+`
`+l.stack}return{value:t,source:e,stack:i,digest:null}}function uD(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ak(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var tle=typeof WeakMap=="function"?WeakMap:Map;function mq(t,e,n){n=gf(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){RC||(RC=!0,_k=r),ak(t,e)},n}function gq(t,e,n){n=gf(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){ak(t,e)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(n.callback=function(){ak(t,e),typeof r!="function"&&(tm===null?tm=new Set([this]):tm.add(this));var u=e.stack;this.componentDidCatch(e.value,{componentStack:u!==null?u:""})}),n}function Q8(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new tle;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=mle.bind(null,t,e,n),e.then(t,t))}function J8(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function ej(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=gf(-1,1),e.tag=2,em(n,e,1))),n.lanes|=1),t)}var nle=jf.ReactCurrentOwner,Vc=!1;function mc(t,e,n,r){e.child=t===null?$$(e,null,n,r):Ly(e,t.child,n,r)}function tj(t,e,n,r,i){n=n.render;var l=e.ref;return gy(e,i),r=YO(t,e,n,r,l,i),n=XO(),t!==null&&!Vc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Cf(t,e,i)):(ko&&n&&LO(e),e.flags|=1,mc(t,e,r,i),e.child)}function nj(t,e,n,r,i){if(t===null){var l=n.type;return typeof l=="function"&&!sL(l)&&l.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=l,_q(t,e,l,r,i)):(t=kT(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(l=t.child,!(t.lanes&i)){var u=l.memoizedProps;if(n=n.compare,n=n!==null?n:ew,n(u,r)&&t.ref===e.ref)return Cf(t,e,i)}return e.flags|=1,t=rm(l,r),t.ref=e.ref,t.return=e,e.child=t}function _q(t,e,n,r,i){if(t!==null){var l=t.memoizedProps;if(ew(l,r)&&t.ref===e.ref)if(Vc=!1,e.pendingProps=r=l,(t.lanes&i)!==0)t.flags&131072&&(Vc=!0);else return e.lanes=t.lanes,Cf(t,e,i)}return lk(t,e,n,r,i)}function yq(t,e,n){var r=e.pendingProps,i=r.children,l=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},yo(ly,ou),ou|=n;else{if(!(n&1073741824))return t=l!==null?l.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,yo(ly,ou),ou|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=l!==null?l.baseLanes:n,yo(ly,ou),ou|=r}else l!==null?(r=l.baseLanes|n,e.memoizedState=null):r=n,yo(ly,ou),ou|=r;return mc(t,e,i,n),e.child}function xq(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function lk(t,e,n,r,i){var l=qc(n)?t_:tc.current;return l=Ny(e,l),gy(e,i),n=YO(t,e,n,r,l,i),r=XO(),t!==null&&!Vc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Cf(t,e,i)):(ko&&r&&LO(e),e.flags|=1,mc(t,e,n,i),e.child)}function rj(t,e,n,r,i){if(qc(n)){var l=!0;xC(e)}else l=!1;if(gy(e,i),e.stateNode===null)MT(t,e),pq(e,n,r),ok(e,n,r,i),r=!0;else if(t===null){var u=e.stateNode,s=e.memoizedProps;u.props=s;var v=u.context,w=n.contextType;typeof w=="object"&&w!==null?w=qu(w):(w=qc(n)?t_:tc.current,w=Ny(e,w));var A=n.getDerivedStateFromProps,F=typeof A=="function"||typeof u.getSnapshotBeforeUpdate=="function";F||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(s!==r||v!==w)&&Z8(e,u,r,w),Np=!1;var W=e.memoizedState;u.state=W,SC(e,r,u,i),v=e.memoizedState,s!==r||W!==v||$c.current||Np?(typeof A=="function"&&(sk(e,n,A,r),v=e.memoizedState),(s=Np||K8(e,n,s,r,W,v,w))?(F||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(e.flags|=4194308)):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=v),u.props=r,u.state=v,u.context=w,r=s):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{u=e.stateNode,G$(t,e),s=e.memoizedProps,w=e.type===e.elementType?s:xh(e.type,s),u.props=w,F=e.pendingProps,W=u.context,v=n.contextType,typeof v=="object"&&v!==null?v=qu(v):(v=qc(n)?t_:tc.current,v=Ny(e,v));var K=n.getDerivedStateFromProps;(A=typeof K=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(s!==F||W!==v)&&Z8(e,u,r,v),Np=!1,W=e.memoizedState,u.state=W,SC(e,r,u,i);var Q=e.memoizedState;s!==F||W!==Q||$c.current||Np?(typeof K=="function"&&(sk(e,n,K,r),Q=e.memoizedState),(w=Np||K8(e,n,w,r,W,Q,v)||!1)?(A||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(r,Q,v),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(r,Q,v)),typeof u.componentDidUpdate=="function"&&(e.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof u.componentDidUpdate!="function"||s===t.memoizedProps&&W===t.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&W===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=Q),u.props=r,u.state=Q,u.context=v,r=w):(typeof u.componentDidUpdate!="function"||s===t.memoizedProps&&W===t.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&W===t.memoizedState||(e.flags|=1024),r=!1)}return ck(t,e,n,r,l,i)}function ck(t,e,n,r,i,l){xq(t,e);var u=(e.flags&128)!==0;if(!r&&!u)return i&&U8(e,n,!1),Cf(t,e,l);r=e.stateNode,nle.current=e;var s=u&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&u?(e.child=Ly(e,t.child,null,l),e.child=Ly(e,null,s,l)):mc(t,e,s,l),e.memoizedState=r.state,i&&U8(e,n,!0),e.child}function vq(t){var e=t.stateNode;e.pendingContext?V8(t,e.pendingContext,e.pendingContext!==e.context):e.context&&V8(t,e.context,!1),WO(t,e.containerInfo)}function ij(t,e,n,r,i){return Oy(),BO(i),e.flags|=256,mc(t,e,n,r),e.child}var uk={dehydrated:null,treeContext:null,retryLane:0};function hk(t){return{baseLanes:t,cachePool:null,transitions:null}}function bq(t,e,n){var r=e.pendingProps,i=Ho.current,l=!1,u=(e.flags&128)!==0,s;if((s=u)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(l=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),yo(Ho,i&1),t===null)return rk(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(u=r.children,t=r.fallback,l?(r=e.mode,l=e.child,u={mode:"hidden",children:u},!(r&1)&&l!==null?(l.childLanes=0,l.pendingProps=u):l=rA(u,r,0,null),t=Zg(t,r,n,null),l.return=e,t.return=e,l.sibling=t,e.child=l,e.child.memoizedState=hk(n),e.memoizedState=uk,t):QO(e,u));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return rle(t,e,u,r,s,i,n);if(l){l=r.fallback,u=e.mode,i=t.child,s=i.sibling;var v={mode:"hidden",children:r.children};return!(u&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=v,e.deletions=null):(r=rm(i,v),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?l=rm(s,l):(l=Zg(l,u,n,null),l.flags|=2),l.return=e,r.return=e,r.sibling=l,e.child=r,r=l,l=e.child,u=t.child.memoizedState,u=u===null?hk(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},l.memoizedState=u,l.childLanes=t.childLanes&~n,e.memoizedState=uk,r}return l=t.child,t=l.sibling,r=rm(l,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function QO(t,e){return e=rA({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function MS(t,e,n,r){return r!==null&&BO(r),Ly(e,t.child,null,n),t=QO(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function rle(t,e,n,r,i,l,u){if(n)return e.flags&256?(e.flags&=-257,r=uD(Error(Hn(422))),MS(t,e,u,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(l=r.fallback,i=e.mode,r=rA({mode:"visible",children:r.children},i,0,null),l=Zg(l,i,u,null),l.flags|=2,r.return=e,l.return=e,r.sibling=l,e.child=r,e.mode&1&&Ly(e,t.child,null,u),e.child.memoizedState=hk(u),e.memoizedState=uk,l);if(!(e.mode&1))return MS(t,e,u,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,l=Error(Hn(419)),r=uD(l,r,void 0),MS(t,e,u,r)}if(s=(u&t.childLanes)!==0,Vc||s){if(r=al,r!==null){switch(u&-u){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|u)?0:i,i!==0&&i!==l.retryLane&&(l.retryLane=i,Tf(t,i),Ph(r,t,i,-1))}return iL(),r=uD(Error(Hn(421))),MS(t,e,u,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=gle.bind(null,t),i._reactRetry=e,null):(t=l.treeContext,uu=Jp(i.nextSibling),pu=e,ko=!0,Eh=null,t!==null&&(Bu[zu++]=uf,Bu[zu++]=hf,Bu[zu++]=n_,uf=t.id,hf=t.overflow,n_=e),e=QO(e,r.children),e.flags|=4096,e)}function sj(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),ik(t.return,e,n)}function hD(t,e,n,r,i){var l=t.memoizedState;l===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(l.isBackwards=e,l.rendering=null,l.renderingStartTime=0,l.last=r,l.tail=n,l.tailMode=i)}function wq(t,e,n){var r=e.pendingProps,i=r.revealOrder,l=r.tail;if(mc(t,e,r.children,n),r=Ho.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&sj(t,n,e);else if(t.tag===19)sj(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(yo(Ho,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&TC(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),hD(e,!1,i,n,l);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&TC(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}hD(e,!0,n,null,l);break;case"together":hD(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function MT(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Cf(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),i_|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Hn(153));if(e.child!==null){for(t=e.child,n=rm(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=rm(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ile(t,e,n){switch(e.tag){case 3:vq(e),Oy();break;case 5:Y$(e);break;case 1:qc(e.type)&&xC(e);break;case 4:WO(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;yo(wC,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(yo(Ho,Ho.current&1),e.flags|=128,null):n&e.child.childLanes?bq(t,e,n):(yo(Ho,Ho.current&1),t=Cf(t,e,n),t!==null?t.sibling:null);yo(Ho,Ho.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return wq(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),yo(Ho,Ho.current),r)break;return null;case 22:case 23:return e.lanes=0,yq(t,e,n)}return Cf(t,e,n)}var Eq,dk,Sq,Tq;Eq=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};dk=function(){};Sq=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,jg(wd.current);var l=null;switch(n){case"input":i=N3(t,i),r=N3(t,r),l=[];break;case"select":i=Go({},i,{value:void 0}),r=Go({},r,{value:void 0}),l=[];break;case"textarea":i=F3(t,i),r=F3(t,r),l=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=_C)}z3(n,r);var u;n=null;for(w in i)if(!r.hasOwnProperty(w)&&i.hasOwnProperty(w)&&i[w]!=null)if(w==="style"){var s=i[w];for(u in s)s.hasOwnProperty(u)&&(n||(n={}),n[u]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Gb.hasOwnProperty(w)?l||(l=[]):(l=l||[]).push(w,null));for(w in r){var v=r[w];if(s=i?.[w],r.hasOwnProperty(w)&&v!==s&&(v!=null||s!=null))if(w==="style")if(s){for(u in s)!s.hasOwnProperty(u)||v&&v.hasOwnProperty(u)||(n||(n={}),n[u]="");for(u in v)v.hasOwnProperty(u)&&s[u]!==v[u]&&(n||(n={}),n[u]=v[u])}else n||(l||(l=[]),l.push(w,n)),n=v;else w==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,s=s?s.__html:void 0,v!=null&&s!==v&&(l=l||[]).push(w,v)):w==="children"?typeof v!="string"&&typeof v!="number"||(l=l||[]).push(w,""+v):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Gb.hasOwnProperty(w)?(v!=null&&w==="onScroll"&&So("scroll",t),l||s===v||(l=[])):(l=l||[]).push(w,v))}n&&(l=l||[]).push("style",n);var w=l;(e.updateQueue=w)&&(e.flags|=4)}};Tq=function(t,e,n,r){n!==r&&(e.flags|=4)};function Rv(t,e){if(!ko)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ul(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function sle(t,e,n){var r=e.pendingProps;switch(FO(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ul(e),null;case 1:return qc(e.type)&&yC(),Ul(e),null;case 3:return r=e.stateNode,Fy(),Ro($c),Ro(tc),qO(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(AS(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Eh!==null&&(vk(Eh),Eh=null))),dk(t,e),Ul(e),null;case 5:$O(e);var i=jg(sw.current);if(n=e.type,t!==null&&e.stateNode!=null)Sq(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Hn(166));return Ul(e),null}if(t=jg(wd.current),AS(e)){r=e.stateNode,n=e.type;var l=e.memoizedProps;switch(r[yd]=e,r[rw]=l,t=(e.mode&1)!==0,n){case"dialog":So("cancel",r),So("close",r);break;case"iframe":case"object":case"embed":So("load",r);break;case"video":case"audio":for(i=0;i<Jv.length;i++)So(Jv[i],r);break;case"source":So("error",r);break;case"img":case"image":case"link":So("error",r),So("load",r);break;case"details":So("toggle",r);break;case"input":p8(r,l),So("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!l.multiple},So("invalid",r);break;case"textarea":g8(r,l),So("invalid",r)}z3(n,l),i=null;for(var u in l)if(l.hasOwnProperty(u)){var s=l[u];u==="children"?typeof s=="string"?r.textContent!==s&&(l.suppressHydrationWarning!==!0&&IS(r.textContent,s,t),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(l.suppressHydrationWarning!==!0&&IS(r.textContent,s,t),i=["children",""+s]):Gb.hasOwnProperty(u)&&s!=null&&u==="onScroll"&&So("scroll",r)}switch(n){case"input":xS(r),m8(r,l,!0);break;case"textarea":xS(r),_8(r);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(r.onclick=_C)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{u=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=JW(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=u.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=u.createElement(n,{is:r.is}):(t=u.createElement(n),n==="select"&&(u=t,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):t=u.createElementNS(t,n),t[yd]=e,t[rw]=r,Eq(t,e,!1,!1),e.stateNode=t;e:{switch(u=j3(n,r),n){case"dialog":So("cancel",t),So("close",t),i=r;break;case"iframe":case"object":case"embed":So("load",t),i=r;break;case"video":case"audio":for(i=0;i<Jv.length;i++)So(Jv[i],t);i=r;break;case"source":So("error",t),i=r;break;case"img":case"image":case"link":So("error",t),So("load",t),i=r;break;case"details":So("toggle",t),i=r;break;case"input":p8(t,r),i=N3(t,r),So("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Go({},r,{value:void 0}),So("invalid",t);break;case"textarea":g8(t,r),i=F3(t,r),So("invalid",t);break;default:i=r}z3(n,i),s=i;for(l in s)if(s.hasOwnProperty(l)){var v=s[l];l==="style"?n$(t,v):l==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&e$(t,v)):l==="children"?typeof v=="string"?(n!=="textarea"||v!=="")&&Yb(t,v):typeof v=="number"&&Yb(t,""+v):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Gb.hasOwnProperty(l)?v!=null&&l==="onScroll"&&So("scroll",t):v!=null&&wO(t,l,v,u))}switch(n){case"input":xS(t),m8(t,r,!1);break;case"textarea":xS(t),_8(t);break;case"option":r.value!=null&&t.setAttribute("value",""+dm(r.value));break;case"select":t.multiple=!!r.multiple,l=r.value,l!=null?dy(t,!!r.multiple,l,!1):r.defaultValue!=null&&dy(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=_C)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ul(e),null;case 6:if(t&&e.stateNode!=null)Tq(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Hn(166));if(n=jg(sw.current),jg(wd.current),AS(e)){if(r=e.stateNode,n=e.memoizedProps,r[yd]=e,(l=r.nodeValue!==n)&&(t=pu,t!==null))switch(t.tag){case 3:IS(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&IS(r.nodeValue,n,(t.mode&1)!==0)}l&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[yd]=e,e.stateNode=r}return Ul(e),null;case 13:if(Ro(Ho),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ko&&uu!==null&&e.mode&1&&!(e.flags&128))H$(),Oy(),e.flags|=98560,l=!1;else if(l=AS(e),r!==null&&r.dehydrated!==null){if(t===null){if(!l)throw Error(Hn(318));if(l=e.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(Hn(317));l[yd]=e}else Oy(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ul(e),l=!1}else Eh!==null&&(vk(Eh),Eh=null),l=!0;if(!l)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ho.current&1?Ya===0&&(Ya=3):iL())),e.updateQueue!==null&&(e.flags|=4),Ul(e),null);case 4:return Fy(),dk(t,e),t===null&&tw(e.stateNode.containerInfo),Ul(e),null;case 10:return VO(e.type._context),Ul(e),null;case 17:return qc(e.type)&&yC(),Ul(e),null;case 19:if(Ro(Ho),l=e.memoizedState,l===null)return Ul(e),null;if(r=(e.flags&128)!==0,u=l.rendering,u===null)if(r)Rv(l,!1);else{if(Ya!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(u=TC(t),u!==null){for(e.flags|=128,Rv(l,!1),r=u.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)l=n,t=r,l.flags&=14680066,u=l.alternate,u===null?(l.childLanes=0,l.lanes=t,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=u.childLanes,l.lanes=u.lanes,l.child=u.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=u.memoizedProps,l.memoizedState=u.memoizedState,l.updateQueue=u.updateQueue,l.type=u.type,t=u.dependencies,l.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return yo(Ho,Ho.current&1|2),e.child}t=t.sibling}l.tail!==null&&pa()>zy&&(e.flags|=128,r=!0,Rv(l,!1),e.lanes=4194304)}else{if(!r)if(t=TC(u),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Rv(l,!0),l.tail===null&&l.tailMode==="hidden"&&!u.alternate&&!ko)return Ul(e),null}else 2*pa()-l.renderingStartTime>zy&&n!==1073741824&&(e.flags|=128,r=!0,Rv(l,!1),e.lanes=4194304);l.isBackwards?(u.sibling=e.child,e.child=u):(n=l.last,n!==null?n.sibling=u:e.child=u,l.last=u)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=pa(),e.sibling=null,n=Ho.current,yo(Ho,r?n&1|2:n&1),e):(Ul(e),null);case 22:case 23:return rL(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ou&1073741824&&(Ul(e),e.subtreeFlags&6&&(e.flags|=8192)):Ul(e),null;case 24:return null;case 25:return null}throw Error(Hn(156,e.tag))}function ole(t,e){switch(FO(e),e.tag){case 1:return qc(e.type)&&yC(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Fy(),Ro($c),Ro(tc),qO(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return $O(e),null;case 13:if(Ro(Ho),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Hn(340));Oy()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ro(Ho),null;case 4:return Fy(),null;case 10:return VO(e.type._context),null;case 22:case 23:return rL(),null;case 24:return null;default:return null}}var PS=!1,Xl=!1,ale=typeof WeakSet=="function"?WeakSet:Set,Ar=null;function ay(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){na(t,e,r)}else n.current=null}function fk(t,e,n){try{n()}catch(r){na(t,e,r)}}var oj=!1;function lle(t,e){if(K3=pC,t=M$(),OO(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,l=r.focusNode;r=r.focusOffset;try{n.nodeType,l.nodeType}catch{n=null;break e}var u=0,s=-1,v=-1,w=0,A=0,F=t,W=null;t:for(;;){for(var K;F!==n||i!==0&&F.nodeType!==3||(s=u+i),F!==l||r!==0&&F.nodeType!==3||(v=u+r),F.nodeType===3&&(u+=F.nodeValue.length),(K=F.firstChild)!==null;)W=F,F=K;for(;;){if(F===t)break t;if(W===n&&++w===i&&(s=u),W===l&&++A===r&&(v=u),(K=F.nextSibling)!==null)break;F=W,W=F.parentNode}F=K}n=s===-1||v===-1?null:{start:s,end:v}}else n=null}n=n||{start:0,end:0}}else n=null;for(Z3={focusedElem:t,selectionRange:n},pC=!1,Ar=e;Ar!==null;)if(e=Ar,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ar=t;else for(;Ar!==null;){e=Ar;try{var Q=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(Q!==null){var Z=Q.memoizedProps,oe=Q.memoizedState,ae=e.stateNode,me=ae.getSnapshotBeforeUpdate(e.elementType===e.type?Z:xh(e.type,Z),oe);ae.__reactInternalSnapshotBeforeUpdate=me}break;case 3:var pe=e.stateNode.containerInfo;pe.nodeType===1?pe.textContent="":pe.nodeType===9&&pe.documentElement&&pe.removeChild(pe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Hn(163))}}catch(_e){na(e,e.return,_e)}if(t=e.sibling,t!==null){t.return=e.return,Ar=t;break}Ar=e.return}return Q=oj,oj=!1,Q}function Sb(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var l=i.destroy;i.destroy=void 0,l!==void 0&&fk(e,n,l)}i=i.next}while(i!==r)}}function tA(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function pk(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Cq(t){var e=t.alternate;e!==null&&(t.alternate=null,Cq(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[yd],delete e[rw],delete e[ek],delete e[Wae],delete e[$ae])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Iq(t){return t.tag===5||t.tag===3||t.tag===4}function aj(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Iq(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function mk(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=_C));else if(r!==4&&(t=t.child,t!==null))for(mk(t,e,n),t=t.sibling;t!==null;)mk(t,e,n),t=t.sibling}function gk(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(gk(t,e,n),t=t.sibling;t!==null;)gk(t,e,n),t=t.sibling}var yl=null,bh=!1;function Cp(t,e,n){for(n=n.child;n!==null;)Aq(t,e,n),n=n.sibling}function Aq(t,e,n){if(bd&&typeof bd.onCommitFiberUnmount=="function")try{bd.onCommitFiberUnmount(GI,n)}catch{}switch(n.tag){case 5:Xl||ay(n,e);case 6:var r=yl,i=bh;yl=null,Cp(t,e,n),yl=r,bh=i,yl!==null&&(bh?(t=yl,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):yl.removeChild(n.stateNode));break;case 18:yl!==null&&(bh?(t=yl,n=n.stateNode,t.nodeType===8?iD(t.parentNode,n):t.nodeType===1&&iD(t,n),Qb(t)):iD(yl,n.stateNode));break;case 4:r=yl,i=bh,yl=n.stateNode.containerInfo,bh=!0,Cp(t,e,n),yl=r,bh=i;break;case 0:case 11:case 14:case 15:if(!Xl&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var l=i,u=l.destroy;l=l.tag,u!==void 0&&(l&2||l&4)&&fk(n,e,u),i=i.next}while(i!==r)}Cp(t,e,n);break;case 1:if(!Xl&&(ay(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){na(n,e,s)}Cp(t,e,n);break;case 21:Cp(t,e,n);break;case 22:n.mode&1?(Xl=(r=Xl)||n.memoizedState!==null,Cp(t,e,n),Xl=r):Cp(t,e,n);break;default:Cp(t,e,n)}}function lj(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ale),e.forEach(function(r){var i=_le.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function _h(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var l=t,u=e,s=u;e:for(;s!==null;){switch(s.tag){case 5:yl=s.stateNode,bh=!1;break e;case 3:yl=s.stateNode.containerInfo,bh=!0;break e;case 4:yl=s.stateNode.containerInfo,bh=!0;break e}s=s.return}if(yl===null)throw Error(Hn(160));Aq(l,u,i),yl=null,bh=!1;var v=i.alternate;v!==null&&(v.return=null),i.return=null}catch(w){na(i,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Rq(e,t),e=e.sibling}function Rq(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(_h(e,t),sd(t),r&4){try{Sb(3,t,t.return),tA(3,t)}catch(Z){na(t,t.return,Z)}try{Sb(5,t,t.return)}catch(Z){na(t,t.return,Z)}}break;case 1:_h(e,t),sd(t),r&512&&n!==null&&ay(n,n.return);break;case 5:if(_h(e,t),sd(t),r&512&&n!==null&&ay(n,n.return),t.flags&32){var i=t.stateNode;try{Yb(i,"")}catch(Z){na(t,t.return,Z)}}if(r&4&&(i=t.stateNode,i!=null)){var l=t.memoizedProps,u=n!==null?n.memoizedProps:l,s=t.type,v=t.updateQueue;if(t.updateQueue=null,v!==null)try{s==="input"&&l.type==="radio"&&l.name!=null&&ZW(i,l),j3(s,u);var w=j3(s,l);for(u=0;u<v.length;u+=2){var A=v[u],F=v[u+1];A==="style"?n$(i,F):A==="dangerouslySetInnerHTML"?e$(i,F):A==="children"?Yb(i,F):wO(i,A,F,w)}switch(s){case"input":O3(i,l);break;case"textarea":QW(i,l);break;case"select":var W=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!l.multiple;var K=l.value;K!=null?dy(i,!!l.multiple,K,!1):W!==!!l.multiple&&(l.defaultValue!=null?dy(i,!!l.multiple,l.defaultValue,!0):dy(i,!!l.multiple,l.multiple?[]:"",!1))}i[rw]=l}catch(Z){na(t,t.return,Z)}}break;case 6:if(_h(e,t),sd(t),r&4){if(t.stateNode===null)throw Error(Hn(162));i=t.stateNode,l=t.memoizedProps;try{i.nodeValue=l}catch(Z){na(t,t.return,Z)}}break;case 3:if(_h(e,t),sd(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Qb(e.containerInfo)}catch(Z){na(t,t.return,Z)}break;case 4:_h(e,t),sd(t);break;case 13:_h(e,t),sd(t),i=t.child,i.flags&8192&&(l=i.memoizedState!==null,i.stateNode.isHidden=l,!l||i.alternate!==null&&i.alternate.memoizedState!==null||(tL=pa())),r&4&&lj(t);break;case 22:if(A=n!==null&&n.memoizedState!==null,t.mode&1?(Xl=(w=Xl)||A,_h(e,t),Xl=w):_h(e,t),sd(t),r&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!A&&t.mode&1)for(Ar=t,A=t.child;A!==null;){for(F=Ar=A;Ar!==null;){switch(W=Ar,K=W.child,W.tag){case 0:case 11:case 14:case 15:Sb(4,W,W.return);break;case 1:ay(W,W.return);var Q=W.stateNode;if(typeof Q.componentWillUnmount=="function"){r=W,n=W.return;try{e=r,Q.props=e.memoizedProps,Q.state=e.memoizedState,Q.componentWillUnmount()}catch(Z){na(r,n,Z)}}break;case 5:ay(W,W.return);break;case 22:if(W.memoizedState!==null){uj(F);continue}}K!==null?(K.return=W,Ar=K):uj(F)}A=A.sibling}e:for(A=null,F=t;;){if(F.tag===5){if(A===null){A=F;try{i=F.stateNode,w?(l=i.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(s=F.stateNode,v=F.memoizedProps.style,u=v!=null&&v.hasOwnProperty("display")?v.display:null,s.style.display=t$("display",u))}catch(Z){na(t,t.return,Z)}}}else if(F.tag===6){if(A===null)try{F.stateNode.nodeValue=w?"":F.memoizedProps}catch(Z){na(t,t.return,Z)}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===t)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===t)break e;for(;F.sibling===null;){if(F.return===null||F.return===t)break e;A===F&&(A=null),F=F.return}A===F&&(A=null),F.sibling.return=F.return,F=F.sibling}}break;case 19:_h(e,t),sd(t),r&4&&lj(t);break;case 21:break;default:_h(e,t),sd(t)}}function sd(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Iq(n)){var r=n;break e}n=n.return}throw Error(Hn(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Yb(i,""),r.flags&=-33);var l=aj(t);gk(t,l,i);break;case 3:case 4:var u=r.stateNode.containerInfo,s=aj(t);mk(t,s,u);break;default:throw Error(Hn(161))}}catch(v){na(t,t.return,v)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function cle(t,e,n){Ar=t,Mq(t)}function Mq(t,e,n){for(var r=(t.mode&1)!==0;Ar!==null;){var i=Ar,l=i.child;if(i.tag===22&&r){var u=i.memoizedState!==null||PS;if(!u){var s=i.alternate,v=s!==null&&s.memoizedState!==null||Xl;s=PS;var w=Xl;if(PS=u,(Xl=v)&&!w)for(Ar=i;Ar!==null;)u=Ar,v=u.child,u.tag===22&&u.memoizedState!==null?hj(i):v!==null?(v.return=u,Ar=v):hj(i);for(;l!==null;)Ar=l,Mq(l),l=l.sibling;Ar=i,PS=s,Xl=w}cj(t)}else i.subtreeFlags&8772&&l!==null?(l.return=i,Ar=l):cj(t)}}function cj(t){for(;Ar!==null;){var e=Ar;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Xl||tA(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Xl)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:xh(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var l=e.updateQueue;l!==null&&G8(e,l,r);break;case 3:var u=e.updateQueue;if(u!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}G8(e,u,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var v=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&n.focus();break;case"img":v.src&&(n.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var A=w.memoizedState;if(A!==null){var F=A.dehydrated;F!==null&&Qb(F)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Hn(163))}Xl||e.flags&512&&pk(e)}catch(W){na(e,e.return,W)}}if(e===t){Ar=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ar=n;break}Ar=e.return}}function uj(t){for(;Ar!==null;){var e=Ar;if(e===t){Ar=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ar=n;break}Ar=e.return}}function hj(t){for(;Ar!==null;){var e=Ar;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{tA(4,e)}catch(v){na(e,n,v)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(v){na(e,i,v)}}var l=e.return;try{pk(e)}catch(v){na(e,l,v)}break;case 5:var u=e.return;try{pk(e)}catch(v){na(e,u,v)}}}catch(v){na(e,e.return,v)}if(e===t){Ar=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Ar=s;break}Ar=e.return}}var ule=Math.ceil,AC=jf.ReactCurrentDispatcher,JO=jf.ReactCurrentOwner,Wu=jf.ReactCurrentBatchConfig,Ts=0,al=null,Na=null,Cl=0,ou=0,ly=Dm(0),Ya=0,cw=null,i_=0,nA=0,eL=0,Tb=null,Lc=null,tL=0,zy=1/0,of=null,RC=!1,_k=null,tm=null,DS=!1,Hp=null,MC=0,Cb=0,yk=null,PT=-1,DT=0;function _c(){return Ts&6?pa():PT!==-1?PT:PT=pa()}function nm(t){return t.mode&1?Ts&2&&Cl!==0?Cl&-Cl:Gae.transition!==null?(DT===0&&(DT=p$()),DT):(t=Zs,t!==0||(t=window.event,t=t===void 0?16:b$(t.type)),t):1}function Ph(t,e,n,r){if(50<Cb)throw Cb=0,yk=null,Error(Hn(185));Yw(t,n,r),(!(Ts&2)||t!==al)&&(t===al&&(!(Ts&2)&&(nA|=n),Ya===4&&Fp(t,Cl)),Gc(t,r),n===1&&Ts===0&&!(e.mode&1)&&(zy=pa()+500,QI&&km()))}function Gc(t,e){var n=t.callbackNode;Goe(t,e);var r=fC(t,t===al?Cl:0);if(r===0)n!==null&&v8(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&v8(n),e===1)t.tag===0?qae(dj.bind(null,t)):j$(dj.bind(null,t)),Uae(function(){!(Ts&6)&&km()}),n=null;else{switch(m$(r)){case 1:n=IO;break;case 4:n=d$;break;case 16:n=dC;break;case 536870912:n=f$;break;default:n=dC}n=Bq(n,Pq.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Pq(t,e){if(PT=-1,DT=0,Ts&6)throw Error(Hn(327));var n=t.callbackNode;if(_y()&&t.callbackNode!==n)return null;var r=fC(t,t===al?Cl:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=PC(t,r);else{e=r;var i=Ts;Ts|=2;var l=kq();(al!==t||Cl!==e)&&(of=null,zy=pa()+500,Kg(t,e));do try{fle();break}catch(s){Dq(t,s)}while(!0);jO(),AC.current=l,Ts=i,Na!==null?e=0:(al=null,Cl=0,e=Ya)}if(e!==0){if(e===2&&(i=$3(t),i!==0&&(r=i,e=xk(t,i))),e===1)throw n=cw,Kg(t,0),Fp(t,r),Gc(t,pa()),n;if(e===6)Fp(t,r);else{if(i=t.current.alternate,!(r&30)&&!hle(i)&&(e=PC(t,r),e===2&&(l=$3(t),l!==0&&(r=l,e=xk(t,l))),e===1))throw n=cw,Kg(t,0),Fp(t,r),Gc(t,pa()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(Hn(345));case 2:Mg(t,Lc,of);break;case 3:if(Fp(t,r),(r&130023424)===r&&(e=tL+500-pa(),10<e)){if(fC(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){_c(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=J3(Mg.bind(null,t,Lc,of),e);break}Mg(t,Lc,of);break;case 4:if(Fp(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var u=31-Mh(r);l=1<<u,u=e[u],u>i&&(i=u),r&=~l}if(r=i,r=pa()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ule(r/1960))-r,10<r){t.timeoutHandle=J3(Mg.bind(null,t,Lc,of),r);break}Mg(t,Lc,of);break;case 5:Mg(t,Lc,of);break;default:throw Error(Hn(329))}}}return Gc(t,pa()),t.callbackNode===n?Pq.bind(null,t):null}function xk(t,e){var n=Tb;return t.current.memoizedState.isDehydrated&&(Kg(t,e).flags|=256),t=PC(t,e),t!==2&&(e=Lc,Lc=n,e!==null&&vk(e)),t}function vk(t){Lc===null?Lc=t:Lc.push.apply(Lc,t)}function hle(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],l=i.getSnapshot;i=i.value;try{if(!Oh(l(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fp(t,e){for(e&=~eL,e&=~nA,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Mh(e),r=1<<n;t[n]=-1,e&=~r}}function dj(t){if(Ts&6)throw Error(Hn(327));_y();var e=fC(t,0);if(!(e&1))return Gc(t,pa()),null;var n=PC(t,e);if(t.tag!==0&&n===2){var r=$3(t);r!==0&&(e=r,n=xk(t,r))}if(n===1)throw n=cw,Kg(t,0),Fp(t,e),Gc(t,pa()),n;if(n===6)throw Error(Hn(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Mg(t,Lc,of),Gc(t,pa()),null}function nL(t,e){var n=Ts;Ts|=1;try{return t(e)}finally{Ts=n,Ts===0&&(zy=pa()+500,QI&&km())}}function s_(t){Hp!==null&&Hp.tag===0&&!(Ts&6)&&_y();var e=Ts;Ts|=1;var n=Wu.transition,r=Zs;try{if(Wu.transition=null,Zs=1,t)return t()}finally{Zs=r,Wu.transition=n,Ts=e,!(Ts&6)&&km()}}function rL(){ou=ly.current,Ro(ly)}function Kg(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Vae(n)),Na!==null)for(n=Na.return;n!==null;){var r=n;switch(FO(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&yC();break;case 3:Fy(),Ro($c),Ro(tc),qO();break;case 5:$O(r);break;case 4:Fy();break;case 13:Ro(Ho);break;case 19:Ro(Ho);break;case 10:VO(r.type._context);break;case 22:case 23:rL()}n=n.return}if(al=t,Na=t=rm(t.current,null),Cl=ou=e,Ya=0,cw=null,eL=nA=i_=0,Lc=Tb=null,zg!==null){for(e=0;e<zg.length;e++)if(n=zg[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,l=n.pending;if(l!==null){var u=l.next;l.next=i,r.next=u}n.pending=r}zg=null}return t}function Dq(t,e){do{var n=Na;try{if(jO(),AT.current=IC,CC){for(var r=qo.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}CC=!1}if(r_=0,rl=Ga=qo=null,Eb=!1,ow=0,JO.current=null,n===null||n.return===null){Ya=1,cw=e,Na=null;break}e:{var l=t,u=n.return,s=n,v=e;if(e=Cl,s.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var w=v,A=s,F=A.tag;if(!(A.mode&1)&&(F===0||F===11||F===15)){var W=A.alternate;W?(A.updateQueue=W.updateQueue,A.memoizedState=W.memoizedState,A.lanes=W.lanes):(A.updateQueue=null,A.memoizedState=null)}var K=J8(u);if(K!==null){K.flags&=-257,ej(K,u,s,l,e),K.mode&1&&Q8(l,w,e),e=K,v=w;var Q=e.updateQueue;if(Q===null){var Z=new Set;Z.add(v),e.updateQueue=Z}else Q.add(v);break e}else{if(!(e&1)){Q8(l,w,e),iL();break e}v=Error(Hn(426))}}else if(ko&&s.mode&1){var oe=J8(u);if(oe!==null){!(oe.flags&65536)&&(oe.flags|=256),ej(oe,u,s,l,e),BO(By(v,s));break e}}l=v=By(v,s),Ya!==4&&(Ya=2),Tb===null?Tb=[l]:Tb.push(l),l=u;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e;var ae=mq(l,v,e);q8(l,ae);break e;case 1:s=v;var me=l.type,pe=l.stateNode;if(!(l.flags&128)&&(typeof me.getDerivedStateFromError=="function"||pe!==null&&typeof pe.componentDidCatch=="function"&&(tm===null||!tm.has(pe)))){l.flags|=65536,e&=-e,l.lanes|=e;var _e=gq(l,s,e);q8(l,_e);break e}}l=l.return}while(l!==null)}Oq(n)}catch(De){e=De,Na===n&&n!==null&&(Na=n=n.return);continue}break}while(!0)}function kq(){var t=AC.current;return AC.current=IC,t===null?IC:t}function iL(){(Ya===0||Ya===3||Ya===2)&&(Ya=4),al===null||!(i_&268435455)&&!(nA&268435455)||Fp(al,Cl)}function PC(t,e){var n=Ts;Ts|=2;var r=kq();(al!==t||Cl!==e)&&(of=null,Kg(t,e));do try{dle();break}catch(i){Dq(t,i)}while(!0);if(jO(),Ts=n,AC.current=r,Na!==null)throw Error(Hn(261));return al=null,Cl=0,Ya}function dle(){for(;Na!==null;)Nq(Na)}function fle(){for(;Na!==null&&!Boe();)Nq(Na)}function Nq(t){var e=Fq(t.alternate,t,ou);t.memoizedProps=t.pendingProps,e===null?Oq(t):Na=e,JO.current=null}function Oq(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=ole(n,e),n!==null){n.flags&=32767,Na=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ya=6,Na=null;return}}else if(n=sle(n,e,ou),n!==null){Na=n;return}if(e=e.sibling,e!==null){Na=e;return}Na=e=t}while(e!==null);Ya===0&&(Ya=5)}function Mg(t,e,n){var r=Zs,i=Wu.transition;try{Wu.transition=null,Zs=1,ple(t,e,n,r)}finally{Wu.transition=i,Zs=r}return null}function ple(t,e,n,r){do _y();while(Hp!==null);if(Ts&6)throw Error(Hn(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Hn(177));t.callbackNode=null,t.callbackPriority=0;var l=n.lanes|n.childLanes;if(Yoe(t,l),t===al&&(Na=al=null,Cl=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||DS||(DS=!0,Bq(dC,function(){return _y(),null})),l=(n.flags&15990)!==0,n.subtreeFlags&15990||l){l=Wu.transition,Wu.transition=null;var u=Zs;Zs=1;var s=Ts;Ts|=4,JO.current=null,lle(t,n),Rq(n,t),Nae(Z3),pC=!!K3,Z3=K3=null,t.current=n,cle(n),zoe(),Ts=s,Zs=u,Wu.transition=l}else t.current=n;if(DS&&(DS=!1,Hp=t,MC=i),l=t.pendingLanes,l===0&&(tm=null),Uoe(n.stateNode),Gc(t,pa()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(RC)throw RC=!1,t=_k,_k=null,t;return MC&1&&t.tag!==0&&_y(),l=t.pendingLanes,l&1?t===yk?Cb++:(Cb=0,yk=t):Cb=0,km(),null}function _y(){if(Hp!==null){var t=m$(MC),e=Wu.transition,n=Zs;try{if(Wu.transition=null,Zs=16>t?16:t,Hp===null)var r=!1;else{if(t=Hp,Hp=null,MC=0,Ts&6)throw Error(Hn(331));var i=Ts;for(Ts|=4,Ar=t.current;Ar!==null;){var l=Ar,u=l.child;if(Ar.flags&16){var s=l.deletions;if(s!==null){for(var v=0;v<s.length;v++){var w=s[v];for(Ar=w;Ar!==null;){var A=Ar;switch(A.tag){case 0:case 11:case 15:Sb(8,A,l)}var F=A.child;if(F!==null)F.return=A,Ar=F;else for(;Ar!==null;){A=Ar;var W=A.sibling,K=A.return;if(Cq(A),A===w){Ar=null;break}if(W!==null){W.return=K,Ar=W;break}Ar=K}}}var Q=l.alternate;if(Q!==null){var Z=Q.child;if(Z!==null){Q.child=null;do{var oe=Z.sibling;Z.sibling=null,Z=oe}while(Z!==null)}}Ar=l}}if(l.subtreeFlags&2064&&u!==null)u.return=l,Ar=u;else e:for(;Ar!==null;){if(l=Ar,l.flags&2048)switch(l.tag){case 0:case 11:case 15:Sb(9,l,l.return)}var ae=l.sibling;if(ae!==null){ae.return=l.return,Ar=ae;break e}Ar=l.return}}var me=t.current;for(Ar=me;Ar!==null;){u=Ar;var pe=u.child;if(u.subtreeFlags&2064&&pe!==null)pe.return=u,Ar=pe;else e:for(u=me;Ar!==null;){if(s=Ar,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:tA(9,s)}}catch(De){na(s,s.return,De)}if(s===u){Ar=null;break e}var _e=s.sibling;if(_e!==null){_e.return=s.return,Ar=_e;break e}Ar=s.return}}if(Ts=i,km(),bd&&typeof bd.onPostCommitFiberRoot=="function")try{bd.onPostCommitFiberRoot(GI,t)}catch{}r=!0}return r}finally{Zs=n,Wu.transition=e}}return!1}function fj(t,e,n){e=By(n,e),e=mq(t,e,1),t=em(t,e,1),e=_c(),t!==null&&(Yw(t,1,e),Gc(t,e))}function na(t,e,n){if(t.tag===3)fj(t,t,n);else for(;e!==null;){if(e.tag===3){fj(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(tm===null||!tm.has(r))){t=By(n,t),t=gq(e,t,1),e=em(e,t,1),t=_c(),e!==null&&(Yw(e,1,t),Gc(e,t));break}}e=e.return}}function mle(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=_c(),t.pingedLanes|=t.suspendedLanes&n,al===t&&(Cl&n)===n&&(Ya===4||Ya===3&&(Cl&130023424)===Cl&&500>pa()-tL?Kg(t,0):eL|=n),Gc(t,e)}function Lq(t,e){e===0&&(t.mode&1?(e=wS,wS<<=1,!(wS&130023424)&&(wS=4194304)):e=1);var n=_c();t=Tf(t,e),t!==null&&(Yw(t,e,n),Gc(t,n))}function gle(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Lq(t,n)}function _le(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Hn(314))}r!==null&&r.delete(e),Lq(t,n)}var Fq;Fq=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||$c.current)Vc=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Vc=!1,ile(t,e,n);Vc=!!(t.flags&131072)}else Vc=!1,ko&&e.flags&1048576&&V$(e,bC,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;MT(t,e),t=e.pendingProps;var i=Ny(e,tc.current);gy(e,n),i=YO(null,e,r,t,i,n);var l=XO();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qc(r)?(l=!0,xC(e)):l=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,HO(e),i.updater=eA,e.stateNode=i,i._reactInternals=e,ok(e,r,t,n),e=ck(null,e,r,!0,l,n)):(e.tag=0,ko&&l&&LO(e),mc(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(MT(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=xle(r),t=xh(r,t),i){case 0:e=lk(null,e,r,t,n);break e;case 1:e=rj(null,e,r,t,n);break e;case 11:e=tj(null,e,r,t,n);break e;case 14:e=nj(null,e,r,xh(r.type,t),n);break e}throw Error(Hn(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xh(r,i),lk(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xh(r,i),rj(t,e,r,i,n);case 3:e:{if(vq(e),t===null)throw Error(Hn(387));r=e.pendingProps,l=e.memoizedState,i=l.element,G$(t,e),SC(e,r,null,n);var u=e.memoizedState;if(r=u.element,l.isDehydrated)if(l={element:r,isDehydrated:!1,cache:u.cache,pendingSuspenseBoundaries:u.pendingSuspenseBoundaries,transitions:u.transitions},e.updateQueue.baseState=l,e.memoizedState=l,e.flags&256){i=By(Error(Hn(423)),e),e=ij(t,e,r,n,i);break e}else if(r!==i){i=By(Error(Hn(424)),e),e=ij(t,e,r,n,i);break e}else for(uu=Jp(e.stateNode.containerInfo.firstChild),pu=e,ko=!0,Eh=null,n=$$(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Oy(),r===i){e=Cf(t,e,n);break e}mc(t,e,r,n)}e=e.child}return e;case 5:return Y$(e),t===null&&rk(e),r=e.type,i=e.pendingProps,l=t!==null?t.memoizedProps:null,u=i.children,Q3(r,i)?u=null:l!==null&&Q3(r,l)&&(e.flags|=32),xq(t,e),mc(t,e,u,n),e.child;case 6:return t===null&&rk(e),null;case 13:return bq(t,e,n);case 4:return WO(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ly(e,null,r,n):mc(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xh(r,i),tj(t,e,r,i,n);case 7:return mc(t,e,e.pendingProps,n),e.child;case 8:return mc(t,e,e.pendingProps.children,n),e.child;case 12:return mc(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,l=e.memoizedProps,u=i.value,yo(wC,r._currentValue),r._currentValue=u,l!==null)if(Oh(l.value,u)){if(l.children===i.children&&!$c.current){e=Cf(t,e,n);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var s=l.dependencies;if(s!==null){u=l.child;for(var v=s.firstContext;v!==null;){if(v.context===r){if(l.tag===1){v=gf(-1,n&-n),v.tag=2;var w=l.updateQueue;if(w!==null){w=w.shared;var A=w.pending;A===null?v.next=v:(v.next=A.next,A.next=v),w.pending=v}}l.lanes|=n,v=l.alternate,v!==null&&(v.lanes|=n),ik(l.return,n,e),s.lanes|=n;break}v=v.next}}else if(l.tag===10)u=l.type===e.type?null:l.child;else if(l.tag===18){if(u=l.return,u===null)throw Error(Hn(341));u.lanes|=n,s=u.alternate,s!==null&&(s.lanes|=n),ik(u,n,e),u=l.sibling}else u=l.child;if(u!==null)u.return=l;else for(u=l;u!==null;){if(u===e){u=null;break}if(l=u.sibling,l!==null){l.return=u.return,u=l;break}u=u.return}l=u}mc(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,gy(e,n),i=qu(i),r=r(i),e.flags|=1,mc(t,e,r,n),e.child;case 14:return r=e.type,i=xh(r,e.pendingProps),i=xh(r.type,i),nj(t,e,r,i,n);case 15:return _q(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xh(r,i),MT(t,e),e.tag=1,qc(r)?(t=!0,xC(e)):t=!1,gy(e,n),pq(e,r,i),ok(e,r,i,n),ck(null,e,r,!0,t,n);case 19:return wq(t,e,n);case 22:return yq(t,e,n)}throw Error(Hn(156,e.tag))};function Bq(t,e){return h$(t,e)}function yle(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vu(t,e,n,r){return new yle(t,e,n,r)}function sL(t){return t=t.prototype,!(!t||!t.isReactComponent)}function xle(t){if(typeof t=="function")return sL(t)?1:0;if(t!=null){if(t=t.$$typeof,t===SO)return 11;if(t===TO)return 14}return 2}function rm(t,e){var n=t.alternate;return n===null?(n=Vu(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function kT(t,e,n,r,i,l){var u=2;if(r=t,typeof t=="function")sL(t)&&(u=1);else if(typeof t=="string")u=5;else e:switch(t){case Q0:return Zg(n.children,i,l,e);case EO:u=8,i|=8;break;case M3:return t=Vu(12,n,e,i|2),t.elementType=M3,t.lanes=l,t;case P3:return t=Vu(13,n,e,i),t.elementType=P3,t.lanes=l,t;case D3:return t=Vu(19,n,e,i),t.elementType=D3,t.lanes=l,t;case YW:return rA(n,i,l,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case qW:u=10;break e;case GW:u=9;break e;case SO:u=11;break e;case TO:u=14;break e;case kp:u=16,r=null;break e}throw Error(Hn(130,t==null?t:typeof t,""))}return e=Vu(u,n,e,i),e.elementType=t,e.type=r,e.lanes=l,e}function Zg(t,e,n,r){return t=Vu(7,t,r,e),t.lanes=n,t}function rA(t,e,n,r){return t=Vu(22,t,r,e),t.elementType=YW,t.lanes=n,t.stateNode={isHidden:!1},t}function dD(t,e,n){return t=Vu(6,t,null,e),t.lanes=n,t}function fD(t,e,n){return e=Vu(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function vle(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=GP(0),this.expirationTimes=GP(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=GP(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function oL(t,e,n,r,i,l,u,s,v){return t=new vle(t,e,n,s,v),e===1?(e=1,l===!0&&(e|=8)):e=0,l=Vu(3,null,null,e),t.current=l,l.stateNode=t,l.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},HO(l),t}function ble(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Z0,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function zq(t){if(!t)return fm;t=t._reactInternals;e:{if(E_(t)!==t||t.tag!==1)throw Error(Hn(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qc(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Hn(171))}if(t.tag===1){var n=t.type;if(qc(n))return z$(t,n,e)}return e}function jq(t,e,n,r,i,l,u,s,v){return t=oL(n,r,!0,t,i,l,u,s,v),t.context=zq(null),n=t.current,r=_c(),i=nm(n),l=gf(r,i),l.callback=e??null,em(n,l,i),t.current.lanes=i,Yw(t,i,r),Gc(t,r),t}function iA(t,e,n,r){var i=e.current,l=_c(),u=nm(i);return n=zq(n),e.context===null?e.context=n:e.pendingContext=n,e=gf(l,u),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=em(i,e,u),t!==null&&(Ph(t,i,u,l),IT(t,i,u)),u}function DC(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function pj(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function aL(t,e){pj(t,e),(t=t.alternate)&&pj(t,e)}function wle(){return null}var Vq=typeof reportError=="function"?reportError:function(t){console.error(t)};function lL(t){this._internalRoot=t}sA.prototype.render=lL.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Hn(409));iA(t,e,null,null)};sA.prototype.unmount=lL.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;s_(function(){iA(null,t,null,null)}),e[Sf]=null}};function sA(t){this._internalRoot=t}sA.prototype.unstable_scheduleHydration=function(t){if(t){var e=y$();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Lp.length&&e!==0&&e<Lp[n].priority;n++);Lp.splice(n,0,t),n===0&&v$(t)}};function cL(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function oA(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function mj(){}function Ele(t,e,n,r,i){if(i){if(typeof r=="function"){var l=r;r=function(){var w=DC(u);l.call(w)}}var u=jq(e,r,t,0,null,!1,!1,"",mj);return t._reactRootContainer=u,t[Sf]=u.current,tw(t.nodeType===8?t.parentNode:t),s_(),u}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var w=DC(v);s.call(w)}}var v=oL(t,0,!1,null,null,!1,!1,"",mj);return t._reactRootContainer=v,t[Sf]=v.current,tw(t.nodeType===8?t.parentNode:t),s_(function(){iA(e,v,n,r)}),v}function aA(t,e,n,r,i){var l=n._reactRootContainer;if(l){var u=l;if(typeof i=="function"){var s=i;i=function(){var v=DC(u);s.call(v)}}iA(e,u,t,i)}else u=Ele(n,e,t,i,r);return DC(u)}g$=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Qv(e.pendingLanes);n!==0&&(AO(e,n|1),Gc(e,pa()),!(Ts&6)&&(zy=pa()+500,km()))}break;case 13:s_(function(){var r=Tf(t,1);if(r!==null){var i=_c();Ph(r,t,1,i)}}),aL(t,1)}};RO=function(t){if(t.tag===13){var e=Tf(t,134217728);if(e!==null){var n=_c();Ph(e,t,134217728,n)}aL(t,134217728)}};_$=function(t){if(t.tag===13){var e=nm(t),n=Tf(t,e);if(n!==null){var r=_c();Ph(n,t,e,r)}aL(t,e)}};y$=function(){return Zs};x$=function(t,e){var n=Zs;try{return Zs=t,e()}finally{Zs=n}};U3=function(t,e,n){switch(e){case"input":if(O3(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=ZI(r);if(!i)throw Error(Hn(90));KW(r),O3(r,i)}}}break;case"textarea":QW(t,n);break;case"select":e=n.value,e!=null&&dy(t,!!n.multiple,e,!1)}};s$=nL;o$=s_;var Sle={usingClientEntryPoint:!1,Events:[Kw,ny,ZI,r$,i$,nL]},Mv={findFiberByHostInstance:Bg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Tle={bundleType:Mv.bundleType,version:Mv.version,rendererPackageName:Mv.rendererPackageName,rendererConfig:Mv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jf.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=c$(t),t===null?null:t.stateNode},findFiberByHostInstance:Mv.findFiberByHostInstance||wle,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kS.isDisabled&&kS.supportsFiber)try{GI=kS.inject(Tle),bd=kS}catch{}}vu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sle;vu.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cL(e))throw Error(Hn(200));return ble(t,e,null,n)};vu.createRoot=function(t,e){if(!cL(t))throw Error(Hn(299));var n=!1,r="",i=Vq;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=oL(t,1,!1,null,null,n,!1,r,i),t[Sf]=e.current,tw(t.nodeType===8?t.parentNode:t),new lL(e)};vu.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Hn(188)):(t=Object.keys(t).join(","),Error(Hn(268,t)));return t=c$(e),t=t===null?null:t.stateNode,t};vu.flushSync=function(t){return s_(t)};vu.hydrate=function(t,e,n){if(!oA(e))throw Error(Hn(200));return aA(null,t,e,!0,n)};vu.hydrateRoot=function(t,e,n){if(!cL(t))throw Error(Hn(405));var r=n!=null&&n.hydratedSources||null,i=!1,l="",u=Vq;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(u=n.onRecoverableError)),e=jq(e,null,t,1,n??null,i,!1,l,u),t[Sf]=e.current,tw(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new sA(e)};vu.render=function(t,e,n){if(!oA(e))throw Error(Hn(200));return aA(null,t,e,!1,n)};vu.unmountComponentAtNode=function(t){if(!oA(t))throw Error(Hn(40));return t._reactRootContainer?(s_(function(){aA(null,null,t,!1,function(){t._reactRootContainer=null,t[Sf]=null})}),!0):!1};vu.unstable_batchedUpdates=nL;vu.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!oA(n))throw Error(Hn(200));if(t==null||t._reactInternals===void 0)throw Error(Hn(38));return aA(t,e,n,!1,r)};vu.version="18.3.1-next-f1338f8080-20240426";function Uq(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Uq)}catch(t){console.error(t)}}Uq(),UW.exports=vu;var Nm=UW.exports;const eb=$I(Nm);var gj=Nm;A3.createRoot=gj.createRoot,A3.hydrateRoot=gj.hydrateRoot;function Cle(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,r,i,l,u=[],s="",v=t.split("/");for(v[0]||v.shift();i=v.shift();)n=i[0],n==="*"?(u.push(n),s+=i[1]==="?"?"(?:/(.*))?":"/(.*)"):n===":"?(r=i.indexOf("?",1),l=i.indexOf(".",1),u.push(i.substring(1,~r?r:~l?l:i.length)),s+=~r&&!~l?"(?:/([^/]+?))?":"/([^/]+?)",~l&&(s+=(~r?"?":"")+"\\"+i.substring(l))):s+="/"+i;return{keys:u,pattern:new RegExp("^"+s+(e?"(?=$|/)":"/?$"),"i")}}var Hq={exports:{}},Wq={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jy=se;function Ile(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ale=typeof Object.is=="function"?Object.is:Ile,Rle=jy.useState,Mle=jy.useEffect,Ple=jy.useLayoutEffect,Dle=jy.useDebugValue;function kle(t,e){var n=e(),r=Rle({inst:{value:n,getSnapshot:e}}),i=r[0].inst,l=r[1];return Ple(function(){i.value=n,i.getSnapshot=e,pD(i)&&l({inst:i})},[t,n,e]),Mle(function(){return pD(i)&&l({inst:i}),t(function(){pD(i)&&l({inst:i})})},[t]),Dle(n),n}function pD(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ale(t,n)}catch{return!0}}function Nle(t,e){return e()}var Ole=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Nle:kle;Wq.useSyncExternalStore=jy.useSyncExternalStore!==void 0?jy.useSyncExternalStore:Ole;Hq.exports=Wq;var $q=Hq.exports;const Lle=Dy.useInsertionEffect,Fle=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qq=Fle?se.useLayoutEffect:se.useEffect,Ble=Lle||qq,uL=t=>{const e=se.useRef([t,(...n)=>e[0](...n)]).current;return Ble(()=>{e[0]=t}),e[1]},zle="popstate",hL="pushState",dL="replaceState",jle="hashchange",_j=[zle,hL,dL,jle],Vle=t=>{for(const e of _j)addEventListener(e,t);return()=>{for(const e of _j)removeEventListener(e,t)}},Gq=(t,e)=>$q.useSyncExternalStore(Vle,t,e),Ule=()=>location.search,Hle=({ssrSearch:t=""}={})=>Gq(Ule,()=>t),yj=()=>location.pathname,Wle=({ssrPath:t}={})=>Gq(yj,t?()=>t:yj),$le=(t,{replace:e=!1,state:n=null}={})=>history[e?dL:hL](n,"",t),qle=(t={})=>[Wle(t),$le],xj=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[xj]>"u"){for(const t of[hL,dL]){const e=history[t];history[t]=function(){const n=e.apply(this,arguments),r=new Event(t);return r.arguments=arguments,dispatchEvent(r),n}}Object.defineProperty(window,xj,{value:!0})}const Gle=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",Yq=(t="")=>t==="/"?"":t,Yle=(t,e)=>t[0]==="~"?t.slice(1):Yq(e)+t,Xle=(t="",e)=>Gle(vj(Yq(t)),vj(e)),vj=t=>{try{return decodeURI(t)}catch{return t}},Xq={hook:qle,searchHook:Hle,parser:Cle,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:t=>t},Kq=se.createContext(Xq),mx=()=>se.useContext(Kq),Zq={},Qq=se.createContext(Zq),Jq=()=>se.useContext(Qq),Qw=t=>{const[e,n]=t.hook(t);return[Xle(t.base,e),uL((r,i)=>n(Yle(r,t.base),i))]},xu=()=>Qw(mx()),eG=(t,e,n,r)=>{const{pattern:i,keys:l}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",r),u=i.exec(n)||[],[s,...v]=u;return s!==void 0?[!0,(()=>{const w=l!==!1?Object.fromEntries(l.map((F,W)=>[F,v[W]])):u.groups;let A={...v};return w&&Object.assign(A,w),A})(),...r?[s]:[]]:[!1,null]},Kle=({children:t,...e})=>{const n=mx(),r=e.hook?Xq:n;let i=r;const[l,u]=e.ssrPath?.split("?")??[];u&&(e.ssrSearch=u,e.ssrPath=l),e.hrefs=e.hrefs??e.hook?.hrefs;let s=se.useRef({}),v=s.current,w=v;for(let A in r){const F=A==="base"?r[A]+(e[A]||""):e[A]||r[A];v===w&&F!==w[A]&&(s.current=w={...w}),w[A]=F,F!==r[A]&&(i=w)}return se.createElement(Kq.Provider,{value:i,children:t})},bj=({children:t,component:e},n)=>e?se.createElement(e,{params:n}):typeof t=="function"?t(n):t,Zle=t=>{let e=se.useRef(Zq);const n=e.current;return e.current=Object.keys(t).length!==Object.keys(n).length||Object.entries(t).some(([r,i])=>i!==n[r])?t:n},Uo=({path:t,nest:e,match:n,...r})=>{const i=mx(),[l]=Qw(i),[u,s,v]=n??eG(i.parser,t,l,e),w=Zle({...Jq(),...s});if(!u)return null;const A=v?se.createElement(Kle,{base:v},bj(r,w)):bj(r,w);return se.createElement(Qq.Provider,{value:w,children:A})},hu=se.forwardRef((t,e)=>{const n=mx(),[r,i]=Qw(n),{to:l="",href:u=l,onClick:s,asChild:v,children:w,className:A,replace:F,state:W,...K}=t,Q=uL(oe=>{oe.ctrlKey||oe.metaKey||oe.altKey||oe.shiftKey||oe.button!==0||(s?.(oe),oe.defaultPrevented||(oe.preventDefault(),i(u,t)))}),Z=n.hrefs(u[0]==="~"?u.slice(1):n.base+u,n);return v&&se.isValidElement(w)?se.cloneElement(w,{onClick:Q,href:Z}):se.createElement("a",{...K,onClick:Q,href:Z,className:A?.call?A(r===u):A,children:w,ref:e})}),tG=t=>Array.isArray(t)?t.flatMap(e=>tG(e&&e.type===se.Fragment?e.props.children:e)):[t],Qle=({children:t,location:e})=>{const n=mx(),[r]=Qw(n);for(const i of tG(t)){let l=0;if(se.isValidElement(i)&&(l=eG(n.parser,i.props.path,e||r,i.props.nest))[0])return se.cloneElement(i,{match:l})}return null},pm=t=>{const{to:e,href:n=e}=t,r=mx(),[,i]=Qw(r),l=uL(()=>i(e||n,t)),{ssrContext:u}=r;return qq(()=>{l()},[]),u&&(u.redirectTo=e),null},Jle=()=>{};var wj={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nG={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr=function(t,e){if(!t)throw gx(e)},gx=function(t){return new Error("Firebase Database ("+nG.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rG=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},ece=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const l=t[n++];e[r++]=String.fromCharCode((i&31)<<6|l&63)}else if(i>239&&i<365){const l=t[n++],u=t[n++],s=t[n++],v=((i&7)<<18|(l&63)<<12|(u&63)<<6|s&63)-65536;e[r++]=String.fromCharCode(55296+(v>>10)),e[r++]=String.fromCharCode(56320+(v&1023))}else{const l=t[n++],u=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(l&63)<<6|u&63)}}return e.join("")},fL={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const l=t[i],u=i+1<t.length,s=u?t[i+1]:0,v=i+2<t.length,w=v?t[i+2]:0,A=l>>2,F=(l&3)<<4|s>>4;let W=(s&15)<<2|w>>6,K=w&63;v||(K=64,u||(W=64)),r.push(n[A],n[F],n[W],n[K])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(rG(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):ece(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const l=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0;++i;const w=i<t.length?n[t.charAt(i)]:64;++i;const F=i<t.length?n[t.charAt(i)]:64;if(++i,l==null||s==null||w==null||F==null)throw new tce;const W=l<<2|s>>4;if(r.push(W),w!==64){const K=s<<4&240|w>>2;if(r.push(K),F!==64){const Q=w<<6&192|F;r.push(Q)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class tce extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const iG=function(t){const e=rG(t);return fL.encodeByteArray(e,!0)},kC=function(t){return iG(t).replace(/\./g,"")},NC=function(t){try{return fL.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nce(t){return sG(void 0,t)}function sG(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!rce(n)||(t[n]=sG(t[n],e[n]));return t}function rce(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ice(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sce=()=>ice().__FIREBASE_DEFAULTS__,oce=()=>{if(typeof process>"u"||typeof wj>"u")return;const t=wj.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},ace=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&NC(t[1]);return e&&JSON.parse(e)},lA=()=>{try{return Jle()||sce()||oce()||ace()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},oG=t=>{var e,n;return(n=(e=lA())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},pL=t=>{const e=oG(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},aG=()=>{var t;return(t=lA())===null||t===void 0?void 0:t.config},lG=t=>{var e;return(e=lA())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cG(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,l=t.sub||t.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}}},t);return[kC(JSON.stringify(n)),kC(JSON.stringify(u)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mL(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nc())}function lce(){var t;const e=(t=lA())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cce(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function uce(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function uG(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hce(){const t=nc();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function dce(){return nG.NODE_ADMIN===!0}function fce(){return!lce()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pce(){try{return typeof indexedDB=="object"}catch{return!1}}function mce(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var l;e(((l=i.error)===null||l===void 0?void 0:l.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gce="FirebaseError";class Nd extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=gce,Object.setPrototypeOf(this,Nd.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jw.prototype.create)}}class Jw{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,l=this.errors[e],u=l?_ce(l,r):"Error",s=`${this.serviceName}: ${u} (${i}).`;return new Nd(i,s,r)}}function _ce(t,e){return t.replace(yce,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const yce=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(t){return JSON.parse(t)}function sl(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hG=function(t){let e={},n={},r={},i="";try{const l=t.split(".");e=uw(NC(l[0])||""),n=uw(NC(l[1])||""),i=l[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:i}},xce=function(t){const e=hG(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},vce=function(t){const e=hG(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Od(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Vy(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function OC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function LC(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function mm(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const l=t[i],u=e[i];if(Ej(l)&&Ej(u)){if(!mm(l,u))return!1}else if(l!==u)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Ej(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _x(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function tb(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,l]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(l)}}),e}function nb(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bce{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let F=0;F<16;F++)r[F]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let F=0;F<16;F++)r[F]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let F=16;F<80;F++){const W=r[F-3]^r[F-8]^r[F-14]^r[F-16];r[F]=(W<<1|W>>>31)&4294967295}let i=this.chain_[0],l=this.chain_[1],u=this.chain_[2],s=this.chain_[3],v=this.chain_[4],w,A;for(let F=0;F<80;F++){F<40?F<20?(w=s^l&(u^s),A=1518500249):(w=l^u^s,A=1859775393):F<60?(w=l&u|s&(l|u),A=2400959708):(w=l^u^s,A=3395469782);const W=(i<<5|i>>>27)+w+v+A+r[F]&4294967295;v=s,s=u,u=(l<<30|l>>>2)&4294967295,l=i,i=W}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+s&4294967295,this.chain_[4]=this.chain_[4]+v&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let i=0;const l=this.buf_;let u=this.inbuf_;for(;i<n;){if(u===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(l[u]=e.charCodeAt(i),++u,++i,u===this.blockSize){this.compress_(l),u=0;break}}else for(;i<n;)if(l[u]=e[i],++u,++i,u===this.blockSize){this.compress_(l),u=0;break}}this.inbuf_=u,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let l=24;l>=0;l-=8)e[r]=this.chain_[i]>>l&255,++r;return e}}function wce(t,e){const n=new Ece(t,e);return n.subscribe.bind(n)}class Ece{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Sce(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=mD),i.error===void 0&&(i.error=mD),i.complete===void 0&&(i.complete=mD);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Sce(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function mD(){}function Uy(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tce=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const l=i-55296;r++,tr(r<t.length,"Surrogate pair missing trail surrogate.");const u=t.charCodeAt(r)-56320;i=65536+(l<<10)+u}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},cA=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function no(t){return t&&t._delegate?t._delegate:t}class If{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pg="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cce=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new cf;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e?.identifier),i=(n=e?.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(l){if(i)return null;throw l}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ace(e))try{this.getOrInitializeService({instanceIdentifier:Pg})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const l=this.getOrInitializeService({instanceIdentifier:i});r.resolve(l)}catch{}}}}clearInstance(e=Pg){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Pg){return this.instances.has(e)}getOptions(e=Pg){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[l,u]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(l);r===s&&u.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),l=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;l.add(e),this.onInitCallbacks.set(i,l);const u=this.instances.get(i);return u&&e(u,i),()=>{l.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ice(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Pg){return this.component?this.component.multipleInstances?e:Pg:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Ice(t){return t===Pg?void 0:t}function Ace(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rce{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Cce(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ss;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ss||(ss={}));const Mce={debug:ss.DEBUG,verbose:ss.VERBOSE,info:ss.INFO,warn:ss.WARN,error:ss.ERROR,silent:ss.SILENT},Pce=ss.INFO,Dce={[ss.DEBUG]:"log",[ss.VERBOSE]:"log",[ss.INFO]:"info",[ss.WARN]:"warn",[ss.ERROR]:"error"},kce=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=Dce[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class uA{constructor(e){this.name=e,this._logLevel=Pce,this._logHandler=kce,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ss))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Mce[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ss.DEBUG,...e),this._logHandler(this,ss.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ss.VERBOSE,...e),this._logHandler(this,ss.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ss.INFO,...e),this._logHandler(this,ss.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ss.WARN,...e),this._logHandler(this,ss.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ss.ERROR,...e),this._logHandler(this,ss.ERROR,...e)}}const Nce=(t,e)=>e.some(n=>t instanceof n);let Sj,Tj;function Oce(){return Sj||(Sj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Lce(){return Tj||(Tj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const dG=new WeakMap,bk=new WeakMap,fG=new WeakMap,gD=new WeakMap,gL=new WeakMap;function Fce(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",l),t.removeEventListener("error",u)},l=()=>{n(im(t.result)),i()},u=()=>{r(t.error),i()};t.addEventListener("success",l),t.addEventListener("error",u)});return e.then(n=>{n instanceof IDBCursor&&dG.set(n,t)}).catch(()=>{}),gL.set(e,t),e}function Bce(t){if(bk.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",u),t.removeEventListener("abort",u)},l=()=>{n(),i()},u=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",l),t.addEventListener("error",u),t.addEventListener("abort",u)});bk.set(t,e)}let wk={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return bk.get(t);if(e==="objectStoreNames")return t.objectStoreNames||fG.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return im(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function zce(t){wk=t(wk)}function jce(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(_D(this),e,...n);return fG.set(r,e.sort?e.sort():[e]),im(r)}:Lce().includes(t)?function(...e){return t.apply(_D(this),e),im(dG.get(this))}:function(...e){return im(t.apply(_D(this),e))}}function Vce(t){return typeof t=="function"?jce(t):(t instanceof IDBTransaction&&Bce(t),Nce(t,Oce())?new Proxy(t,wk):t)}function im(t){if(t instanceof IDBRequest)return Fce(t);if(gD.has(t))return gD.get(t);const e=Vce(t);return e!==t&&(gD.set(t,e),gL.set(e,t)),e}const _D=t=>gL.get(t);function Uce(t,e,{blocked:n,upgrade:r,blocking:i,terminated:l}={}){const u=indexedDB.open(t,e),s=im(u);return r&&u.addEventListener("upgradeneeded",v=>{r(im(u.result),v.oldVersion,v.newVersion,im(u.transaction),v)}),n&&u.addEventListener("blocked",v=>n(v.oldVersion,v.newVersion,v)),s.then(v=>{l&&v.addEventListener("close",()=>l()),i&&v.addEventListener("versionchange",w=>i(w.oldVersion,w.newVersion,w))}).catch(()=>{}),s}const Hce=["get","getKey","getAll","getAllKeys","count"],Wce=["put","add","delete","clear"],yD=new Map;function Cj(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(yD.get(e))return yD.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=Wce.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Hce.includes(n)))return;const l=async function(u,...s){const v=this.transaction(u,i?"readwrite":"readonly");let w=v.store;return r&&(w=w.index(s.shift())),(await Promise.all([w[n](...s),i&&v.done]))[0]};return yD.set(e,l),l}zce(t=>({...t,get:(e,n,r)=>Cj(e,n)||t.get(e,n,r),has:(e,n)=>!!Cj(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(qce(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function qce(t){const e=t.getComponent();return e?.type==="VERSION"}const Ek="@firebase/app",Ij="0.11.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Af=new uA("@firebase/app"),Gce="@firebase/app-compat",Yce="@firebase/analytics-compat",Xce="@firebase/analytics",Kce="@firebase/app-check-compat",Zce="@firebase/app-check",Qce="@firebase/auth",Jce="@firebase/auth-compat",eue="@firebase/database",tue="@firebase/data-connect",nue="@firebase/database-compat",rue="@firebase/functions",iue="@firebase/functions-compat",sue="@firebase/installations",oue="@firebase/installations-compat",aue="@firebase/messaging",lue="@firebase/messaging-compat",cue="@firebase/performance",uue="@firebase/performance-compat",hue="@firebase/remote-config",due="@firebase/remote-config-compat",fue="@firebase/storage",pue="@firebase/storage-compat",mue="@firebase/firestore",gue="@firebase/vertexai",_ue="@firebase/firestore-compat",yue="firebase",xue="11.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk="[DEFAULT]",vue={[Ek]:"fire-core",[Gce]:"fire-core-compat",[Xce]:"fire-analytics",[Yce]:"fire-analytics-compat",[Zce]:"fire-app-check",[Kce]:"fire-app-check-compat",[Qce]:"fire-auth",[Jce]:"fire-auth-compat",[eue]:"fire-rtdb",[tue]:"fire-data-connect",[nue]:"fire-rtdb-compat",[rue]:"fire-fn",[iue]:"fire-fn-compat",[sue]:"fire-iid",[oue]:"fire-iid-compat",[aue]:"fire-fcm",[lue]:"fire-fcm-compat",[cue]:"fire-perf",[uue]:"fire-perf-compat",[hue]:"fire-rc",[due]:"fire-rc-compat",[fue]:"fire-gcs",[pue]:"fire-gcs-compat",[mue]:"fire-fst",[_ue]:"fire-fst-compat",[gue]:"fire-vertex","fire-js":"fire-js",[yue]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hw=new Map,bue=new Map,Tk=new Map;function Aj(t,e){try{t.container.addComponent(e)}catch(n){Af.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function gm(t){const e=t.name;if(Tk.has(e))return Af.debug(`There were multiple attempts to register component ${e}.`),!1;Tk.set(e,t);for(const n of hw.values())Aj(n,t);for(const n of bue.values())Aj(n,t);return!0}function e2(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Bc(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wue={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sm=new Jw("app","Firebase",wue);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eue{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new If("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S_=xue;function _L(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Sk,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw sm.create("bad-app-name",{appName:String(i)});if(n||(n=aG()),!n)throw sm.create("no-options");const l=hw.get(i);if(l){if(mm(n,l.options)&&mm(r,l.config))return l;throw sm.create("duplicate-app",{appName:i})}const u=new Rce(i);for(const v of Tk.values())u.addComponent(v);const s=new Eue(n,r,u);return hw.set(i,s),s}function t2(t=Sk){const e=hw.get(t);if(!e&&t===Sk&&aG())return _L();if(!e)throw sm.create("no-app",{appName:t});return e}function Ck(){return Array.from(hw.values())}function $u(t,e,n){var r;let i=(r=vue[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const l=i.match(/\s|\//),u=e.match(/\s|\//);if(l||u){const s=[`Unable to register library "${i}" with version "${e}":`];l&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),l&&u&&s.push("and"),u&&s.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Af.warn(s.join(" "));return}gm(new If(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sue="firebase-heartbeat-database",Tue=1,dw="firebase-heartbeat-store";let xD=null;function pG(){return xD||(xD=Uce(Sue,Tue,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(dw)}catch(n){console.warn(n)}}}}).catch(t=>{throw sm.create("idb-open",{originalErrorMessage:t.message})})),xD}async function Cue(t){try{const n=(await pG()).transaction(dw),r=await n.objectStore(dw).get(mG(t));return await n.done,r}catch(e){if(e instanceof Nd)Af.warn(e.message);else{const n=sm.create("idb-get",{originalErrorMessage:e?.message});Af.warn(n.message)}}}async function Rj(t,e){try{const r=(await pG()).transaction(dw,"readwrite");await r.objectStore(dw).put(e,mG(t)),await r.done}catch(n){if(n instanceof Nd)Af.warn(n.message);else{const r=sm.create("idb-set",{originalErrorMessage:n?.message});Af.warn(r.message)}}}function mG(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iue=1024,Aue=30;class Rue{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Pue(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=Mj();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(u=>u.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:i}),this._heartbeatsCache.heartbeats.length>Aue){const u=Due(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(u,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Af.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Mj(),{heartbeatsToSend:r,unsentEntries:i}=Mue(this._heartbeatsCache.heartbeats),l=kC(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(n){return Af.warn(n),""}}}function Mj(){return new Date().toISOString().substring(0,10)}function Mue(t,e=Iue){const n=[];let r=t.slice();for(const i of t){const l=n.find(u=>u.agent===i.agent);if(l){if(l.dates.push(i.date),Pj(n)>e){l.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Pj(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Pue{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pce()?mce().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Cue(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return Rj(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return Rj(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Pj(t){return kC(JSON.stringify({version:2,heartbeats:t})).length}function Due(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kue(t){gm(new If("platform-logger",e=>new $ce(e),"PRIVATE")),gm(new If("heartbeat",e=>new Rue(e),"PRIVATE")),$u(Ek,Ij,t),$u(Ek,Ij,"esm2017"),$u("fire-js","")}kue("");var Dj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var om,gG;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(re,fe){function ye(){}ye.prototype=fe.prototype,re.D=fe.prototype,re.prototype=new ye,re.prototype.constructor=re,re.C=function(ue,Ie,Oe){for(var ze=Array(arguments.length-2),ft=2;ft<arguments.length;ft++)ze[ft-2]=arguments[ft];return fe.prototype[Ie].apply(ue,ze)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(re,fe,ye){ye||(ye=0);var ue=Array(16);if(typeof fe=="string")for(var Ie=0;16>Ie;++Ie)ue[Ie]=fe.charCodeAt(ye++)|fe.charCodeAt(ye++)<<8|fe.charCodeAt(ye++)<<16|fe.charCodeAt(ye++)<<24;else for(Ie=0;16>Ie;++Ie)ue[Ie]=fe[ye++]|fe[ye++]<<8|fe[ye++]<<16|fe[ye++]<<24;fe=re.g[0],ye=re.g[1],Ie=re.g[2];var Oe=re.g[3],ze=fe+(Oe^ye&(Ie^Oe))+ue[0]+3614090360&4294967295;fe=ye+(ze<<7&4294967295|ze>>>25),ze=Oe+(Ie^fe&(ye^Ie))+ue[1]+3905402710&4294967295,Oe=fe+(ze<<12&4294967295|ze>>>20),ze=Ie+(ye^Oe&(fe^ye))+ue[2]+606105819&4294967295,Ie=Oe+(ze<<17&4294967295|ze>>>15),ze=ye+(fe^Ie&(Oe^fe))+ue[3]+3250441966&4294967295,ye=Ie+(ze<<22&4294967295|ze>>>10),ze=fe+(Oe^ye&(Ie^Oe))+ue[4]+4118548399&4294967295,fe=ye+(ze<<7&4294967295|ze>>>25),ze=Oe+(Ie^fe&(ye^Ie))+ue[5]+1200080426&4294967295,Oe=fe+(ze<<12&4294967295|ze>>>20),ze=Ie+(ye^Oe&(fe^ye))+ue[6]+2821735955&4294967295,Ie=Oe+(ze<<17&4294967295|ze>>>15),ze=ye+(fe^Ie&(Oe^fe))+ue[7]+4249261313&4294967295,ye=Ie+(ze<<22&4294967295|ze>>>10),ze=fe+(Oe^ye&(Ie^Oe))+ue[8]+1770035416&4294967295,fe=ye+(ze<<7&4294967295|ze>>>25),ze=Oe+(Ie^fe&(ye^Ie))+ue[9]+2336552879&4294967295,Oe=fe+(ze<<12&4294967295|ze>>>20),ze=Ie+(ye^Oe&(fe^ye))+ue[10]+4294925233&4294967295,Ie=Oe+(ze<<17&4294967295|ze>>>15),ze=ye+(fe^Ie&(Oe^fe))+ue[11]+2304563134&4294967295,ye=Ie+(ze<<22&4294967295|ze>>>10),ze=fe+(Oe^ye&(Ie^Oe))+ue[12]+1804603682&4294967295,fe=ye+(ze<<7&4294967295|ze>>>25),ze=Oe+(Ie^fe&(ye^Ie))+ue[13]+4254626195&4294967295,Oe=fe+(ze<<12&4294967295|ze>>>20),ze=Ie+(ye^Oe&(fe^ye))+ue[14]+2792965006&4294967295,Ie=Oe+(ze<<17&4294967295|ze>>>15),ze=ye+(fe^Ie&(Oe^fe))+ue[15]+1236535329&4294967295,ye=Ie+(ze<<22&4294967295|ze>>>10),ze=fe+(Ie^Oe&(ye^Ie))+ue[1]+4129170786&4294967295,fe=ye+(ze<<5&4294967295|ze>>>27),ze=Oe+(ye^Ie&(fe^ye))+ue[6]+3225465664&4294967295,Oe=fe+(ze<<9&4294967295|ze>>>23),ze=Ie+(fe^ye&(Oe^fe))+ue[11]+643717713&4294967295,Ie=Oe+(ze<<14&4294967295|ze>>>18),ze=ye+(Oe^fe&(Ie^Oe))+ue[0]+3921069994&4294967295,ye=Ie+(ze<<20&4294967295|ze>>>12),ze=fe+(Ie^Oe&(ye^Ie))+ue[5]+3593408605&4294967295,fe=ye+(ze<<5&4294967295|ze>>>27),ze=Oe+(ye^Ie&(fe^ye))+ue[10]+38016083&4294967295,Oe=fe+(ze<<9&4294967295|ze>>>23),ze=Ie+(fe^ye&(Oe^fe))+ue[15]+3634488961&4294967295,Ie=Oe+(ze<<14&4294967295|ze>>>18),ze=ye+(Oe^fe&(Ie^Oe))+ue[4]+3889429448&4294967295,ye=Ie+(ze<<20&4294967295|ze>>>12),ze=fe+(Ie^Oe&(ye^Ie))+ue[9]+568446438&4294967295,fe=ye+(ze<<5&4294967295|ze>>>27),ze=Oe+(ye^Ie&(fe^ye))+ue[14]+3275163606&4294967295,Oe=fe+(ze<<9&4294967295|ze>>>23),ze=Ie+(fe^ye&(Oe^fe))+ue[3]+4107603335&4294967295,Ie=Oe+(ze<<14&4294967295|ze>>>18),ze=ye+(Oe^fe&(Ie^Oe))+ue[8]+1163531501&4294967295,ye=Ie+(ze<<20&4294967295|ze>>>12),ze=fe+(Ie^Oe&(ye^Ie))+ue[13]+2850285829&4294967295,fe=ye+(ze<<5&4294967295|ze>>>27),ze=Oe+(ye^Ie&(fe^ye))+ue[2]+4243563512&4294967295,Oe=fe+(ze<<9&4294967295|ze>>>23),ze=Ie+(fe^ye&(Oe^fe))+ue[7]+1735328473&4294967295,Ie=Oe+(ze<<14&4294967295|ze>>>18),ze=ye+(Oe^fe&(Ie^Oe))+ue[12]+2368359562&4294967295,ye=Ie+(ze<<20&4294967295|ze>>>12),ze=fe+(ye^Ie^Oe)+ue[5]+4294588738&4294967295,fe=ye+(ze<<4&4294967295|ze>>>28),ze=Oe+(fe^ye^Ie)+ue[8]+2272392833&4294967295,Oe=fe+(ze<<11&4294967295|ze>>>21),ze=Ie+(Oe^fe^ye)+ue[11]+1839030562&4294967295,Ie=Oe+(ze<<16&4294967295|ze>>>16),ze=ye+(Ie^Oe^fe)+ue[14]+4259657740&4294967295,ye=Ie+(ze<<23&4294967295|ze>>>9),ze=fe+(ye^Ie^Oe)+ue[1]+2763975236&4294967295,fe=ye+(ze<<4&4294967295|ze>>>28),ze=Oe+(fe^ye^Ie)+ue[4]+1272893353&4294967295,Oe=fe+(ze<<11&4294967295|ze>>>21),ze=Ie+(Oe^fe^ye)+ue[7]+4139469664&4294967295,Ie=Oe+(ze<<16&4294967295|ze>>>16),ze=ye+(Ie^Oe^fe)+ue[10]+3200236656&4294967295,ye=Ie+(ze<<23&4294967295|ze>>>9),ze=fe+(ye^Ie^Oe)+ue[13]+681279174&4294967295,fe=ye+(ze<<4&4294967295|ze>>>28),ze=Oe+(fe^ye^Ie)+ue[0]+3936430074&4294967295,Oe=fe+(ze<<11&4294967295|ze>>>21),ze=Ie+(Oe^fe^ye)+ue[3]+3572445317&4294967295,Ie=Oe+(ze<<16&4294967295|ze>>>16),ze=ye+(Ie^Oe^fe)+ue[6]+76029189&4294967295,ye=Ie+(ze<<23&4294967295|ze>>>9),ze=fe+(ye^Ie^Oe)+ue[9]+3654602809&4294967295,fe=ye+(ze<<4&4294967295|ze>>>28),ze=Oe+(fe^ye^Ie)+ue[12]+3873151461&4294967295,Oe=fe+(ze<<11&4294967295|ze>>>21),ze=Ie+(Oe^fe^ye)+ue[15]+530742520&4294967295,Ie=Oe+(ze<<16&4294967295|ze>>>16),ze=ye+(Ie^Oe^fe)+ue[2]+3299628645&4294967295,ye=Ie+(ze<<23&4294967295|ze>>>9),ze=fe+(Ie^(ye|~Oe))+ue[0]+4096336452&4294967295,fe=ye+(ze<<6&4294967295|ze>>>26),ze=Oe+(ye^(fe|~Ie))+ue[7]+1126891415&4294967295,Oe=fe+(ze<<10&4294967295|ze>>>22),ze=Ie+(fe^(Oe|~ye))+ue[14]+2878612391&4294967295,Ie=Oe+(ze<<15&4294967295|ze>>>17),ze=ye+(Oe^(Ie|~fe))+ue[5]+4237533241&4294967295,ye=Ie+(ze<<21&4294967295|ze>>>11),ze=fe+(Ie^(ye|~Oe))+ue[12]+1700485571&4294967295,fe=ye+(ze<<6&4294967295|ze>>>26),ze=Oe+(ye^(fe|~Ie))+ue[3]+2399980690&4294967295,Oe=fe+(ze<<10&4294967295|ze>>>22),ze=Ie+(fe^(Oe|~ye))+ue[10]+4293915773&4294967295,Ie=Oe+(ze<<15&4294967295|ze>>>17),ze=ye+(Oe^(Ie|~fe))+ue[1]+2240044497&4294967295,ye=Ie+(ze<<21&4294967295|ze>>>11),ze=fe+(Ie^(ye|~Oe))+ue[8]+1873313359&4294967295,fe=ye+(ze<<6&4294967295|ze>>>26),ze=Oe+(ye^(fe|~Ie))+ue[15]+4264355552&4294967295,Oe=fe+(ze<<10&4294967295|ze>>>22),ze=Ie+(fe^(Oe|~ye))+ue[6]+2734768916&4294967295,Ie=Oe+(ze<<15&4294967295|ze>>>17),ze=ye+(Oe^(Ie|~fe))+ue[13]+1309151649&4294967295,ye=Ie+(ze<<21&4294967295|ze>>>11),ze=fe+(Ie^(ye|~Oe))+ue[4]+4149444226&4294967295,fe=ye+(ze<<6&4294967295|ze>>>26),ze=Oe+(ye^(fe|~Ie))+ue[11]+3174756917&4294967295,Oe=fe+(ze<<10&4294967295|ze>>>22),ze=Ie+(fe^(Oe|~ye))+ue[2]+718787259&4294967295,Ie=Oe+(ze<<15&4294967295|ze>>>17),ze=ye+(Oe^(Ie|~fe))+ue[9]+3951481745&4294967295,re.g[0]=re.g[0]+fe&4294967295,re.g[1]=re.g[1]+(Ie+(ze<<21&4294967295|ze>>>11))&4294967295,re.g[2]=re.g[2]+Ie&4294967295,re.g[3]=re.g[3]+Oe&4294967295}r.prototype.u=function(re,fe){fe===void 0&&(fe=re.length);for(var ye=fe-this.blockSize,ue=this.B,Ie=this.h,Oe=0;Oe<fe;){if(Ie==0)for(;Oe<=ye;)i(this,re,Oe),Oe+=this.blockSize;if(typeof re=="string"){for(;Oe<fe;)if(ue[Ie++]=re.charCodeAt(Oe++),Ie==this.blockSize){i(this,ue),Ie=0;break}}else for(;Oe<fe;)if(ue[Ie++]=re[Oe++],Ie==this.blockSize){i(this,ue),Ie=0;break}}this.h=Ie,this.o+=fe},r.prototype.v=function(){var re=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);re[0]=128;for(var fe=1;fe<re.length-8;++fe)re[fe]=0;var ye=8*this.o;for(fe=re.length-8;fe<re.length;++fe)re[fe]=ye&255,ye/=256;for(this.u(re),re=Array(16),fe=ye=0;4>fe;++fe)for(var ue=0;32>ue;ue+=8)re[ye++]=this.g[fe]>>>ue&255;return re};function l(re,fe){var ye=s;return Object.prototype.hasOwnProperty.call(ye,re)?ye[re]:ye[re]=fe(re)}function u(re,fe){this.h=fe;for(var ye=[],ue=!0,Ie=re.length-1;0<=Ie;Ie--){var Oe=re[Ie]|0;ue&&Oe==fe||(ye[Ie]=Oe,ue=!1)}this.g=ye}var s={};function v(re){return-128<=re&&128>re?l(re,function(fe){return new u([fe|0],0>fe?-1:0)}):new u([re|0],0>re?-1:0)}function w(re){if(isNaN(re)||!isFinite(re))return F;if(0>re)return oe(w(-re));for(var fe=[],ye=1,ue=0;re>=ye;ue++)fe[ue]=re/ye|0,ye*=4294967296;return new u(fe,0)}function A(re,fe){if(re.length==0)throw Error("number format error: empty string");if(fe=fe||10,2>fe||36<fe)throw Error("radix out of range: "+fe);if(re.charAt(0)=="-")return oe(A(re.substring(1),fe));if(0<=re.indexOf("-"))throw Error('number format error: interior "-" character');for(var ye=w(Math.pow(fe,8)),ue=F,Ie=0;Ie<re.length;Ie+=8){var Oe=Math.min(8,re.length-Ie),ze=parseInt(re.substring(Ie,Ie+Oe),fe);8>Oe?(Oe=w(Math.pow(fe,Oe)),ue=ue.j(Oe).add(w(ze))):(ue=ue.j(ye),ue=ue.add(w(ze)))}return ue}var F=v(0),W=v(1),K=v(16777216);t=u.prototype,t.m=function(){if(Z(this))return-oe(this).m();for(var re=0,fe=1,ye=0;ye<this.g.length;ye++){var ue=this.i(ye);re+=(0<=ue?ue:4294967296+ue)*fe,fe*=4294967296}return re},t.toString=function(re){if(re=re||10,2>re||36<re)throw Error("radix out of range: "+re);if(Q(this))return"0";if(Z(this))return"-"+oe(this).toString(re);for(var fe=w(Math.pow(re,6)),ye=this,ue="";;){var Ie=_e(ye,fe).g;ye=ae(ye,Ie.j(fe));var Oe=((0<ye.g.length?ye.g[0]:ye.h)>>>0).toString(re);if(ye=Ie,Q(ye))return Oe+ue;for(;6>Oe.length;)Oe="0"+Oe;ue=Oe+ue}},t.i=function(re){return 0>re?0:re<this.g.length?this.g[re]:this.h};function Q(re){if(re.h!=0)return!1;for(var fe=0;fe<re.g.length;fe++)if(re.g[fe]!=0)return!1;return!0}function Z(re){return re.h==-1}t.l=function(re){return re=ae(this,re),Z(re)?-1:Q(re)?0:1};function oe(re){for(var fe=re.g.length,ye=[],ue=0;ue<fe;ue++)ye[ue]=~re.g[ue];return new u(ye,~re.h).add(W)}t.abs=function(){return Z(this)?oe(this):this},t.add=function(re){for(var fe=Math.max(this.g.length,re.g.length),ye=[],ue=0,Ie=0;Ie<=fe;Ie++){var Oe=ue+(this.i(Ie)&65535)+(re.i(Ie)&65535),ze=(Oe>>>16)+(this.i(Ie)>>>16)+(re.i(Ie)>>>16);ue=ze>>>16,Oe&=65535,ze&=65535,ye[Ie]=ze<<16|Oe}return new u(ye,ye[ye.length-1]&-2147483648?-1:0)};function ae(re,fe){return re.add(oe(fe))}t.j=function(re){if(Q(this)||Q(re))return F;if(Z(this))return Z(re)?oe(this).j(oe(re)):oe(oe(this).j(re));if(Z(re))return oe(this.j(oe(re)));if(0>this.l(K)&&0>re.l(K))return w(this.m()*re.m());for(var fe=this.g.length+re.g.length,ye=[],ue=0;ue<2*fe;ue++)ye[ue]=0;for(ue=0;ue<this.g.length;ue++)for(var Ie=0;Ie<re.g.length;Ie++){var Oe=this.i(ue)>>>16,ze=this.i(ue)&65535,ft=re.i(Ie)>>>16,He=re.i(Ie)&65535;ye[2*ue+2*Ie]+=ze*He,me(ye,2*ue+2*Ie),ye[2*ue+2*Ie+1]+=Oe*He,me(ye,2*ue+2*Ie+1),ye[2*ue+2*Ie+1]+=ze*ft,me(ye,2*ue+2*Ie+1),ye[2*ue+2*Ie+2]+=Oe*ft,me(ye,2*ue+2*Ie+2)}for(ue=0;ue<fe;ue++)ye[ue]=ye[2*ue+1]<<16|ye[2*ue];for(ue=fe;ue<2*fe;ue++)ye[ue]=0;return new u(ye,0)};function me(re,fe){for(;(re[fe]&65535)!=re[fe];)re[fe+1]+=re[fe]>>>16,re[fe]&=65535,fe++}function pe(re,fe){this.g=re,this.h=fe}function _e(re,fe){if(Q(fe))throw Error("division by zero");if(Q(re))return new pe(F,F);if(Z(re))return fe=_e(oe(re),fe),new pe(oe(fe.g),oe(fe.h));if(Z(fe))return fe=_e(re,oe(fe)),new pe(oe(fe.g),fe.h);if(30<re.g.length){if(Z(re)||Z(fe))throw Error("slowDivide_ only works with positive integers.");for(var ye=W,ue=fe;0>=ue.l(re);)ye=De(ye),ue=De(ue);var Ie=Ae(ye,1),Oe=Ae(ue,1);for(ue=Ae(ue,2),ye=Ae(ye,2);!Q(ue);){var ze=Oe.add(ue);0>=ze.l(re)&&(Ie=Ie.add(ye),Oe=ze),ue=Ae(ue,1),ye=Ae(ye,1)}return fe=ae(re,Ie.j(fe)),new pe(Ie,fe)}for(Ie=F;0<=re.l(fe);){for(ye=Math.max(1,Math.floor(re.m()/fe.m())),ue=Math.ceil(Math.log(ye)/Math.LN2),ue=48>=ue?1:Math.pow(2,ue-48),Oe=w(ye),ze=Oe.j(fe);Z(ze)||0<ze.l(re);)ye-=ue,Oe=w(ye),ze=Oe.j(fe);Q(Oe)&&(Oe=W),Ie=Ie.add(Oe),re=ae(re,ze)}return new pe(Ie,re)}t.A=function(re){return _e(this,re).h},t.and=function(re){for(var fe=Math.max(this.g.length,re.g.length),ye=[],ue=0;ue<fe;ue++)ye[ue]=this.i(ue)&re.i(ue);return new u(ye,this.h&re.h)},t.or=function(re){for(var fe=Math.max(this.g.length,re.g.length),ye=[],ue=0;ue<fe;ue++)ye[ue]=this.i(ue)|re.i(ue);return new u(ye,this.h|re.h)},t.xor=function(re){for(var fe=Math.max(this.g.length,re.g.length),ye=[],ue=0;ue<fe;ue++)ye[ue]=this.i(ue)^re.i(ue);return new u(ye,this.h^re.h)};function De(re){for(var fe=re.g.length+1,ye=[],ue=0;ue<fe;ue++)ye[ue]=re.i(ue)<<1|re.i(ue-1)>>>31;return new u(ye,re.h)}function Ae(re,fe){var ye=fe>>5;fe%=32;for(var ue=re.g.length-ye,Ie=[],Oe=0;Oe<ue;Oe++)Ie[Oe]=0<fe?re.i(Oe+ye)>>>fe|re.i(Oe+ye+1)<<32-fe:re.i(Oe+ye);return new u(Ie,re.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,gG=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=w,u.fromString=A,om=u}).apply(typeof Dj<"u"?Dj:typeof self<"u"?self:typeof window<"u"?window:{});var NS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var _G,rb,yG,NT,Ik,xG,vG,bG;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(q,ve,ke){return q==Array.prototype||q==Object.prototype||(q[ve]=ke.value),q};function n(q){q=[typeof globalThis=="object"&&globalThis,q,typeof window=="object"&&window,typeof self=="object"&&self,typeof NS=="object"&&NS];for(var ve=0;ve<q.length;++ve){var ke=q[ve];if(ke&&ke.Math==Math)return ke}throw Error("Cannot find global object")}var r=n(this);function i(q,ve){if(ve)e:{var ke=r;q=q.split(".");for(var et=0;et<q.length-1;et++){var Gt=q[et];if(!(Gt in ke))break e;ke=ke[Gt]}q=q[q.length-1],et=ke[q],ve=ve(et),ve!=et&&ve!=null&&e(ke,q,{configurable:!0,writable:!0,value:ve})}}function l(q,ve){q instanceof String&&(q+="");var ke=0,et=!1,Gt={next:function(){if(!et&&ke<q.length){var en=ke++;return{value:ve(en,q[en]),done:!1}}return et=!0,{done:!0,value:void 0}}};return Gt[Symbol.iterator]=function(){return Gt},Gt}i("Array.prototype.values",function(q){return q||function(){return l(this,function(ve,ke){return ke})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var u=u||{},s=this||self;function v(q){var ve=typeof q;return ve=ve!="object"?ve:q?Array.isArray(q)?"array":ve:"null",ve=="array"||ve=="object"&&typeof q.length=="number"}function w(q){var ve=typeof q;return ve=="object"&&q!=null||ve=="function"}function A(q,ve,ke){return q.call.apply(q.bind,arguments)}function F(q,ve,ke){if(!q)throw Error();if(2<arguments.length){var et=Array.prototype.slice.call(arguments,2);return function(){var Gt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Gt,et),q.apply(ve,Gt)}}return function(){return q.apply(ve,arguments)}}function W(q,ve,ke){return W=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?A:F,W.apply(null,arguments)}function K(q,ve){var ke=Array.prototype.slice.call(arguments,1);return function(){var et=ke.slice();return et.push.apply(et,arguments),q.apply(this,et)}}function Q(q,ve){function ke(){}ke.prototype=ve.prototype,q.aa=ve.prototype,q.prototype=new ke,q.prototype.constructor=q,q.Qb=function(et,Gt,en){for(var Kn=Array(arguments.length-2),ji=2;ji<arguments.length;ji++)Kn[ji-2]=arguments[ji];return ve.prototype[Gt].apply(et,Kn)}}function Z(q){const ve=q.length;if(0<ve){const ke=Array(ve);for(let et=0;et<ve;et++)ke[et]=q[et];return ke}return[]}function oe(q,ve){for(let ke=1;ke<arguments.length;ke++){const et=arguments[ke];if(v(et)){const Gt=q.length||0,en=et.length||0;q.length=Gt+en;for(let Kn=0;Kn<en;Kn++)q[Gt+Kn]=et[Kn]}else q.push(et)}}class ae{constructor(ve,ke){this.i=ve,this.j=ke,this.h=0,this.g=null}get(){let ve;return 0<this.h?(this.h--,ve=this.g,this.g=ve.next,ve.next=null):ve=this.i(),ve}}function me(q){return/^[\s\xa0]*$/.test(q)}function pe(){var q=s.navigator;return q&&(q=q.userAgent)?q:""}function _e(q){return _e[" "](q),q}_e[" "]=function(){};var De=pe().indexOf("Gecko")!=-1&&!(pe().toLowerCase().indexOf("webkit")!=-1&&pe().indexOf("Edge")==-1)&&!(pe().indexOf("Trident")!=-1||pe().indexOf("MSIE")!=-1)&&pe().indexOf("Edge")==-1;function Ae(q,ve,ke){for(const et in q)ve.call(ke,q[et],et,q)}function re(q,ve){for(const ke in q)ve.call(void 0,q[ke],ke,q)}function fe(q){const ve={};for(const ke in q)ve[ke]=q[ke];return ve}const ye="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(q,ve){let ke,et;for(let Gt=1;Gt<arguments.length;Gt++){et=arguments[Gt];for(ke in et)q[ke]=et[ke];for(let en=0;en<ye.length;en++)ke=ye[en],Object.prototype.hasOwnProperty.call(et,ke)&&(q[ke]=et[ke])}}function Ie(q){var ve=1;q=q.split(":");const ke=[];for(;0<ve&&q.length;)ke.push(q.shift()),ve--;return q.length&&ke.push(q.join(":")),ke}function Oe(q){s.setTimeout(()=>{throw q},0)}function ze(){var q=it;let ve=null;return q.g&&(ve=q.g,q.g=q.g.next,q.g||(q.h=null),ve.next=null),ve}class ft{constructor(){this.h=this.g=null}add(ve,ke){const et=He.get();et.set(ve,ke),this.h?this.h.next=et:this.g=et,this.h=et}}var He=new ae(()=>new bt,q=>q.reset());class bt{constructor(){this.next=this.g=this.h=null}set(ve,ke){this.h=ve,this.g=ke,this.next=null}reset(){this.next=this.g=this.h=null}}let Nt,wt=!1,it=new ft,nn=()=>{const q=s.Promise.resolve(void 0);Nt=()=>{q.then(In)}};var In=()=>{for(var q;q=ze();){try{q.h.call(q.g)}catch(ke){Oe(ke)}var ve=He;ve.j(q),100>ve.h&&(ve.h++,q.next=ve.g,ve.g=q)}wt=!1};function wn(){this.s=this.s,this.C=this.C}wn.prototype.s=!1,wn.prototype.ma=function(){this.s||(this.s=!0,this.N())},wn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Xt(q,ve){this.type=q,this.g=this.target=ve,this.defaultPrevented=!1}Xt.prototype.h=function(){this.defaultPrevented=!0};var On=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var q=!1,ve=Object.defineProperty({},"passive",{get:function(){q=!0}});try{const ke=()=>{};s.addEventListener("test",ke,ve),s.removeEventListener("test",ke,ve)}catch{}return q}();function cr(q,ve){if(Xt.call(this,q?q.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,q){var ke=this.type=q.type,et=q.changedTouches&&q.changedTouches.length?q.changedTouches[0]:null;if(this.target=q.target||q.srcElement,this.g=ve,ve=q.relatedTarget){if(De){e:{try{_e(ve.nodeName);var Gt=!0;break e}catch{}Gt=!1}Gt||(ve=null)}}else ke=="mouseover"?ve=q.fromElement:ke=="mouseout"&&(ve=q.toElement);this.relatedTarget=ve,et?(this.clientX=et.clientX!==void 0?et.clientX:et.pageX,this.clientY=et.clientY!==void 0?et.clientY:et.pageY,this.screenX=et.screenX||0,this.screenY=et.screenY||0):(this.clientX=q.clientX!==void 0?q.clientX:q.pageX,this.clientY=q.clientY!==void 0?q.clientY:q.pageY,this.screenX=q.screenX||0,this.screenY=q.screenY||0),this.button=q.button,this.key=q.key||"",this.ctrlKey=q.ctrlKey,this.altKey=q.altKey,this.shiftKey=q.shiftKey,this.metaKey=q.metaKey,this.pointerId=q.pointerId||0,this.pointerType=typeof q.pointerType=="string"?q.pointerType:En[q.pointerType]||"",this.state=q.state,this.i=q,q.defaultPrevented&&cr.aa.h.call(this)}}Q(cr,Xt);var En={2:"touch",3:"pen",4:"mouse"};cr.prototype.h=function(){cr.aa.h.call(this);var q=this.i;q.preventDefault?q.preventDefault():q.returnValue=!1};var fn="closure_listenable_"+(1e6*Math.random()|0),ur=0;function br(q,ve,ke,et,Gt){this.listener=q,this.proxy=null,this.src=ve,this.type=ke,this.capture=!!et,this.ha=Gt,this.key=++ur,this.da=this.fa=!1}function Pe(q){q.da=!0,q.listener=null,q.proxy=null,q.src=null,q.ha=null}function jn(q){this.src=q,this.g={},this.h=0}jn.prototype.add=function(q,ve,ke,et,Gt){var en=q.toString();q=this.g[en],q||(q=this.g[en]=[],this.h++);var Kn=Yn(q,ve,et,Gt);return-1<Kn?(ve=q[Kn],ke||(ve.fa=!1)):(ve=new br(ve,this.src,en,!!et,Gt),ve.fa=ke,q.push(ve)),ve};function rr(q,ve){var ke=ve.type;if(ke in q.g){var et=q.g[ke],Gt=Array.prototype.indexOf.call(et,ve,void 0),en;(en=0<=Gt)&&Array.prototype.splice.call(et,Gt,1),en&&(Pe(ve),q.g[ke].length==0&&(delete q.g[ke],q.h--))}}function Yn(q,ve,ke,et){for(var Gt=0;Gt<q.length;++Gt){var en=q[Gt];if(!en.da&&en.listener==ve&&en.capture==!!ke&&en.ha==et)return Gt}return-1}var Ot="closure_lm_"+(1e6*Math.random()|0),Sr={};function fi(q,ve,ke,et,Gt){if(Array.isArray(ve)){for(var en=0;en<ve.length;en++)fi(q,ve[en],ke,et,Gt);return null}return ke=Es(ke),q&&q[fn]?q.K(ve,ke,w(et)?!!et.capture:!1,Gt):Wr(q,ve,ke,!1,et,Gt)}function Wr(q,ve,ke,et,Gt,en){if(!ve)throw Error("Invalid event type");var Kn=w(Gt)?!!Gt.capture:!!Gt,ji=Ni(q);if(ji||(q[Ot]=ji=new jn(q)),ke=ji.add(ve,ke,et,Kn,en),ke.proxy)return ke;if(et=Mn(),ke.proxy=et,et.src=q,et.listener=ke,q.addEventListener)On||(Gt=Kn),Gt===void 0&&(Gt=!1),q.addEventListener(ve.toString(),et,Gt);else if(q.attachEvent)q.attachEvent(un(ve.toString()),et);else if(q.addListener&&q.removeListener)q.addListener(et);else throw Error("addEventListener and attachEvent are unavailable.");return ke}function Mn(){function q(ke){return ve.call(q.src,q.listener,ke)}const ve=Xn;return q}function jt(q,ve,ke,et,Gt){if(Array.isArray(ve))for(var en=0;en<ve.length;en++)jt(q,ve[en],ke,et,Gt);else et=w(et)?!!et.capture:!!et,ke=Es(ke),q&&q[fn]?(q=q.i,ve=String(ve).toString(),ve in q.g&&(en=q.g[ve],ke=Yn(en,ke,et,Gt),-1<ke&&(Pe(en[ke]),Array.prototype.splice.call(en,ke,1),en.length==0&&(delete q.g[ve],q.h--)))):q&&(q=Ni(q))&&(ve=q.g[ve.toString()],q=-1,ve&&(q=Yn(ve,ke,et,Gt)),(ke=-1<q?ve[q]:null)&&Ln(ke))}function Ln(q){if(typeof q!="number"&&q&&!q.da){var ve=q.src;if(ve&&ve[fn])rr(ve.i,q);else{var ke=q.type,et=q.proxy;ve.removeEventListener?ve.removeEventListener(ke,et,q.capture):ve.detachEvent?ve.detachEvent(un(ke),et):ve.addListener&&ve.removeListener&&ve.removeListener(et),(ke=Ni(ve))?(rr(ke,q),ke.h==0&&(ke.src=null,ve[Ot]=null)):Pe(q)}}}function un(q){return q in Sr?Sr[q]:Sr[q]="on"+q}function Xn(q,ve){if(q.da)q=!0;else{ve=new cr(ve,this);var ke=q.listener,et=q.ha||q.src;q.fa&&Ln(q),q=ke.call(et,ve)}return q}function Ni(q){return q=q[Ot],q instanceof jn?q:null}var Bn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Es(q){return typeof q=="function"?q:(q[Bn]||(q[Bn]=function(ve){return q.handleEvent(ve)}),q[Bn])}function Si(){wn.call(this),this.i=new jn(this),this.M=this,this.F=null}Q(Si,wn),Si.prototype[fn]=!0,Si.prototype.removeEventListener=function(q,ve,ke,et){jt(this,q,ve,ke,et)};function cs(q,ve){var ke,et=q.F;if(et)for(ke=[];et;et=et.F)ke.push(et);if(q=q.M,et=ve.type||ve,typeof ve=="string")ve=new Xt(ve,q);else if(ve instanceof Xt)ve.target=ve.target||q;else{var Gt=ve;ve=new Xt(et,q),ue(ve,Gt)}if(Gt=!0,ke)for(var en=ke.length-1;0<=en;en--){var Kn=ve.g=ke[en];Gt=Oi(Kn,et,!0,ve)&&Gt}if(Kn=ve.g=q,Gt=Oi(Kn,et,!0,ve)&&Gt,Gt=Oi(Kn,et,!1,ve)&&Gt,ke)for(en=0;en<ke.length;en++)Kn=ve.g=ke[en],Gt=Oi(Kn,et,!1,ve)&&Gt}Si.prototype.N=function(){if(Si.aa.N.call(this),this.i){var q=this.i,ve;for(ve in q.g){for(var ke=q.g[ve],et=0;et<ke.length;et++)Pe(ke[et]);delete q.g[ve],q.h--}}this.F=null},Si.prototype.K=function(q,ve,ke,et){return this.i.add(String(q),ve,!1,ke,et)},Si.prototype.L=function(q,ve,ke,et){return this.i.add(String(q),ve,!0,ke,et)};function Oi(q,ve,ke,et){if(ve=q.i.g[String(ve)],!ve)return!0;ve=ve.concat();for(var Gt=!0,en=0;en<ve.length;++en){var Kn=ve[en];if(Kn&&!Kn.da&&Kn.capture==ke){var ji=Kn.listener,nr=Kn.ha||Kn.src;Kn.fa&&rr(q.i,Kn),Gt=ji.call(nr,et)!==!1&&Gt}}return Gt&&!et.defaultPrevented}function mn(q,ve,ke){if(typeof q=="function")ke&&(q=W(q,ke));else if(q&&typeof q.handleEvent=="function")q=W(q.handleEvent,q);else throw Error("Invalid listener argument");return 2147483647<Number(ve)?-1:s.setTimeout(q,ve||0)}function hr(q){q.g=mn(()=>{q.g=null,q.i&&(q.i=!1,hr(q))},q.l);const ve=q.h;q.h=null,q.m.apply(null,ve)}class Tr extends wn{constructor(ve,ke){super(),this.m=ve,this.l=ke,this.h=null,this.i=!1,this.g=null}j(ve){this.h=arguments,this.g?this.i=!0:hr(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Li(q){wn.call(this),this.h=q,this.g={}}Q(Li,wn);var pi=[];function rn(q){Ae(q.g,function(ve,ke){this.g.hasOwnProperty(ke)&&Ln(ve)},q),q.g={}}Li.prototype.N=function(){Li.aa.N.call(this),rn(this)},Li.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rr=s.JSON.stringify,$r=s.JSON.parse,Nr=class{stringify(q){return s.JSON.stringify(q,void 0)}parse(q){return s.JSON.parse(q,void 0)}};function ri(){}ri.prototype.h=null;function Ec(q){return q.h||(q.h=q.i())}function Sc(){}var Zr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ra(){Xt.call(this,"d")}Q(ra,Xt);function Tc(){Xt.call(this,"c")}Q(Tc,Xt);var za={},ia=null;function sc(){return ia=ia||new Si}za.La="serverreachability";function io(q){Xt.call(this,za.La,q)}Q(io,Xt);function It(q){const ve=sc();cs(ve,new io(ve))}za.STAT_EVENT="statevent";function Te(q,ve){Xt.call(this,za.STAT_EVENT,q),this.stat=ve}Q(Te,Xt);function Me(q){const ve=sc();cs(ve,new Te(ve,q))}za.Ma="timingevent";function qe(q,ve){Xt.call(this,za.Ma,q),this.size=ve}Q(qe,Xt);function nt(q,ve){if(typeof q!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){q()},ve)}function rt(){this.g=!0}rt.prototype.xa=function(){this.g=!1};function ct(q,ve,ke,et,Gt,en){q.info(function(){if(q.g)if(en)for(var Kn="",ji=en.split("&"),nr=0;nr<ji.length;nr++){var gn=ji[nr].split("=");if(1<gn.length){var As=gn[0];gn=gn[1];var Un=As.split("_");Kn=2<=Un.length&&Un[1]=="type"?Kn+(As+"="+gn+"&"):Kn+(As+"=redacted&")}}else Kn=null;else Kn=en;return"XMLHTTP REQ ("+et+") [attempt "+Gt+"]: "+ve+`
`+ke+`
`+Kn})}function Tt(q,ve,ke,et,Gt,en,Kn){q.info(function(){return"XMLHTTP RESP ("+et+") [ attempt "+Gt+"]: "+ve+`
`+ke+`
`+en+" "+Kn})}function ut(q,ve,ke,et){q.info(function(){return"XMLHTTP TEXT ("+ve+"): "+Dt(q,ke)+(et?" "+et:"")})}function ht(q,ve){q.info(function(){return"TIMEOUT: "+ve})}rt.prototype.info=function(){};function Dt(q,ve){if(!q.g)return ve;if(!ve)return null;try{var ke=JSON.parse(ve);if(ke){for(q=0;q<ke.length;q++)if(Array.isArray(ke[q])){var et=ke[q];if(!(2>et.length)){var Gt=et[1];if(Array.isArray(Gt)&&!(1>Gt.length)){var en=Gt[0];if(en!="noop"&&en!="stop"&&en!="close")for(var Kn=1;Kn<Gt.length;Kn++)Gt[Kn]=""}}}}return Rr(ke)}catch{return ve}}var Mt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Kt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},hn;function yn(){}Q(yn,ri),yn.prototype.g=function(){return new XMLHttpRequest},yn.prototype.i=function(){return{}},hn=new yn;function Jn(q,ve,ke,et){this.j=q,this.i=ve,this.l=ke,this.R=et||1,this.U=new Li(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ir}function ir(){this.i=null,this.g="",this.h=!1}var xr={},vr={};function ii(q,ve,ke){q.L=1,q.v=zi(Ii(ve)),q.m=ke,q.P=!0,si(q,null)}function si(q,ve){q.F=Date.now(),zr(q),q.A=Ii(q.v);var ke=q.A,et=q.R;Array.isArray(et)||(et=[String(et)]),fo(ke.i,"t",et),q.C=0,ke=q.j.J,q.h=new ir,q.g=Hf(q.j,ke?ve:null,!q.m),0<q.O&&(q.M=new Tr(W(q.Y,q,q.g),q.O)),ve=q.U,ke=q.g,et=q.ca;var Gt="readystatechange";Array.isArray(Gt)||(Gt&&(pi[0]=Gt.toString()),Gt=pi);for(var en=0;en<Gt.length;en++){var Kn=fi(ke,Gt[en],et||ve.handleEvent,!1,ve.h||ve);if(!Kn)break;ve.g[Kn.key]=Kn}ve=q.H?fe(q.H):{},q.m?(q.u||(q.u="POST"),ve["Content-Type"]="application/x-www-form-urlencoded",q.g.ea(q.A,q.u,q.m,ve)):(q.u="GET",q.g.ea(q.A,q.u,null,ve)),It(),ct(q.i,q.u,q.A,q.l,q.R,q.m)}Jn.prototype.ca=function(q){q=q.target;const ve=this.M;ve&&Rs(q)==3?ve.j():this.Y(q)},Jn.prototype.Y=function(q){try{if(q==this.g)e:{const Un=Rs(this.g);var ve=this.g.Ba();const Ms=this.g.Z();if(!(3>Un)&&(Un!=3||this.g&&(this.h.h||this.g.oa()||hl(this.g)))){this.J||Un!=4||ve==7||(ve==8||0>=Ms?It(3):It(2)),an(this);var ke=this.g.Z();this.X=ke;t:if(er(this)){var et=hl(this.g);q="";var Gt=et.length,en=Rs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ci(this),Bs(this);var Kn="";break t}this.h.i=new s.TextDecoder}for(ve=0;ve<Gt;ve++)this.h.h=!0,q+=this.h.i.decode(et[ve],{stream:!(en&&ve==Gt-1)});et.length=0,this.h.g+=q,this.C=0,Kn=this.h.g}else Kn=this.g.oa();if(this.o=ke==200,Tt(this.i,this.u,this.A,this.l,this.R,Un,ke),this.o){if(this.T&&!this.K){t:{if(this.g){var ji,nr=this.g;if((ji=nr.g?nr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!me(ji)){var gn=ji;break t}}gn=null}if(ke=gn)ut(this.i,this.l,ke,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,xo(this,ke);else{this.o=!1,this.s=3,Me(12),ci(this),Bs(this);break e}}if(this.P){ke=!0;let Bo;for(;!this.J&&this.C<Kn.length;)if(Bo=li(this,Kn),Bo==vr){Un==4&&(this.s=4,Me(14),ke=!1),ut(this.i,this.l,null,"[Incomplete Response]");break}else if(Bo==xr){this.s=4,Me(15),ut(this.i,this.l,Kn,"[Invalid Chunk]"),ke=!1;break}else ut(this.i,this.l,Bo,null),xo(this,Bo);if(er(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Un!=4||Kn.length!=0||this.h.h||(this.s=1,Me(16),ke=!1),this.o=this.o&&ke,!ke)ut(this.i,this.l,Kn,"[Invalid Chunked Response]"),ci(this),Bs(this);else if(0<Kn.length&&!this.W){this.W=!0;var As=this.j;As.g==this&&As.ba&&!As.M&&(As.j.info("Great, no buffering proxy detected. Bytes received: "+Kn.length),Ua(As),As.M=!0,Me(11))}}else ut(this.i,this.l,Kn,null),xo(this,Kn);Un==4&&ci(this),this.o&&!this.J&&(Un==4?Mi(this.j,this):(this.o=!1,zr(this)))}else hi(this.g),ke==400&&0<Kn.indexOf("Unknown SID")?(this.s=3,Me(12)):(this.s=0,Me(13)),ci(this),Bs(this)}}}catch{}finally{}};function er(q){return q.g?q.u=="GET"&&q.L!=2&&q.j.Ca:!1}function li(q,ve){var ke=q.C,et=ve.indexOf(`
`,ke);return et==-1?vr:(ke=Number(ve.substring(ke,et)),isNaN(ke)?xr:(et+=1,et+ke>ve.length?vr:(ve=ve.slice(et,et+ke),q.C=et+ke,ve)))}Jn.prototype.cancel=function(){this.J=!0,ci(this)};function zr(q){q.S=Date.now()+q.I,oi(q,q.I)}function oi(q,ve){if(q.B!=null)throw Error("WatchDog timer not null");q.B=nt(W(q.ba,q),ve)}function an(q){q.B&&(s.clearTimeout(q.B),q.B=null)}Jn.prototype.ba=function(){this.B=null;const q=Date.now();0<=q-this.S?(ht(this.i,this.A),this.L!=2&&(It(),Me(17)),ci(this),this.s=2,Bs(this)):oi(this,this.S-q)};function Bs(q){q.j.G==0||q.J||Mi(q.j,q)}function ci(q){an(q);var ve=q.M;ve&&typeof ve.ma=="function"&&ve.ma(),q.M=null,rn(q.U),q.g&&(ve=q.g,q.g=null,ve.abort(),ve.ma())}function xo(q,ve){try{var ke=q.j;if(ke.G!=0&&(ke.g==q||Ko(ke.h,q))){if(!q.K&&Ko(ke.h,q)&&ke.G==3){try{var et=ke.Da.g.parse(ve)}catch{et=null}if(Array.isArray(et)&&et.length==3){var Gt=et;if(Gt[0]==0){e:if(!ke.u){if(ke.g)if(ke.g.F+3e3<q.F)ac(ke),Gs(ke);else break e;zd(ke),Me(18)}}else ke.za=Gt[1],0<ke.za-ke.T&&37500>Gt[2]&&ke.F&&ke.v==0&&!ke.C&&(ke.C=nt(W(ke.Za,ke),6e3));if(1>=Ti(ke.h)&&ke.ca){try{ke.ca()}catch{}ke.ca=void 0}}else bo(ke,11)}else if((q.K||ke.g==q)&&ac(ke),!me(ve))for(Gt=ke.Da.g.parse(ve),ve=0;ve<Gt.length;ve++){let gn=Gt[ve];if(ke.T=gn[0],gn=gn[1],ke.G==2)if(gn[0]=="c"){ke.K=gn[1],ke.ia=gn[2];const As=gn[3];As!=null&&(ke.la=As,ke.j.info("VER="+ke.la));const Un=gn[4];Un!=null&&(ke.Aa=Un,ke.j.info("SVER="+ke.Aa));const Ms=gn[5];Ms!=null&&typeof Ms=="number"&&0<Ms&&(et=1.5*Ms,ke.L=et,ke.j.info("backChannelRequestTimeoutMs_="+et)),et=ke;const Bo=q.g;if(Bo){const qn=Bo.g?Bo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qn){var en=et.h;en.g||qn.indexOf("spdy")==-1&&qn.indexOf("quic")==-1&&qn.indexOf("h2")==-1||(en.j=en.l,en.g=new Set,en.h&&(xa(en,en.h),en.h=null))}if(et.D){const eh=Bo.g?Bo.g.getResponseHeader("X-HTTP-Session-Id"):null;eh&&(et.ya=eh,Fn(et.I,et.D,eh))}}ke.G=3,ke.l&&ke.l.ua(),ke.ba&&(ke.R=Date.now()-q.F,ke.j.info("Handshake RTT: "+ke.R+"ms")),et=ke;var Kn=q;if(et.qa=Lr(et,et.J?et.ia:null,et.W),Kn.K){Eu(et.h,Kn);var ji=Kn,nr=et.L;nr&&(ji.I=nr),ji.B&&(an(ji),zr(ji)),et.g=Kn}else kl(et);0<ke.i.length&&_r(ke)}else gn[0]!="stop"&&gn[0]!="close"||bo(ke,7);else ke.G==3&&(gn[0]=="stop"||gn[0]=="close"?gn[0]=="stop"?bo(ke,7):Ki(ke):gn[0]!="noop"&&ke.l&&ke.l.ta(gn),ke.v=0)}}It(4)}catch{}}var Xo=class{constructor(q,ve){this.g=q,this.map=ve}};function qr(q){this.l=q||10,s.PerformanceNavigationTiming?(q=s.performance.getEntriesByType("navigation"),q=0<q.length&&(q[0].nextHopProtocol=="hq"||q[0].nextHopProtocol=="h2")):q=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=q?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Gr(q){return q.h?!0:q.g?q.g.size>=q.j:!1}function Ti(q){return q.h?1:q.g?q.g.size:0}function Ko(q,ve){return q.h?q.h==ve:q.g?q.g.has(ve):!1}function xa(q,ve){q.g?q.g.add(ve):q.h=ve}function Eu(q,ve){q.h&&q.h==ve?q.h=null:q.g&&q.g.has(ve)&&q.g.delete(ve)}qr.prototype.cancel=function(){if(this.i=$s(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const q of this.g.values())q.cancel();this.g.clear()}};function $s(q){if(q.h!=null)return q.i.concat(q.h.D);if(q.g!=null&&q.g.size!==0){let ve=q.i;for(const ke of q.g.values())ve=ve.concat(ke.D);return ve}return Z(q.i)}function Ka(q){if(q.V&&typeof q.V=="function")return q.V();if(typeof Map<"u"&&q instanceof Map||typeof Set<"u"&&q instanceof Set)return Array.from(q.values());if(typeof q=="string")return q.split("");if(v(q)){for(var ve=[],ke=q.length,et=0;et<ke;et++)ve.push(q[et]);return ve}ve=[],ke=0;for(et in q)ve[ke++]=q[et];return ve}function Su(q){if(q.na&&typeof q.na=="function")return q.na();if(!q.V||typeof q.V!="function"){if(typeof Map<"u"&&q instanceof Map)return Array.from(q.keys());if(!(typeof Set<"u"&&q instanceof Set)){if(v(q)||typeof q=="string"){var ve=[];q=q.length;for(var ke=0;ke<q;ke++)ve.push(ke);return ve}ve=[],ke=0;for(const et in q)ve[ke++]=et;return ve}}}function zs(q,ve){if(q.forEach&&typeof q.forEach=="function")q.forEach(ve,void 0);else if(v(q)||typeof q=="string")Array.prototype.forEach.call(q,ve,void 0);else for(var ke=Su(q),et=Ka(q),Gt=et.length,en=0;en<Gt;en++)ve.call(void 0,et[en],ke&&ke[en],q)}var Ml=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Uf(q,ve){if(q){q=q.split("&");for(var ke=0;ke<q.length;ke++){var et=q[ke].indexOf("="),Gt=null;if(0<=et){var en=q[ke].substring(0,et);Gt=q[ke].substring(et+1)}else en=q[ke];ve(en,Gt?decodeURIComponent(Gt.replace(/\+/g," ")):"")}}}function va(q){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,q instanceof va){this.h=q.h,ns(this,q.j),this.o=q.o,this.g=q.g,Vt(this,q.s),this.l=q.l;var ve=q.i,ke=new Qr;ke.i=ve.i,ve.g&&(ke.g=new Map(ve.g),ke.h=ve.h),ot(this,ke),this.m=q.m}else q&&(ve=String(q).match(Ml))?(this.h=!1,ns(this,ve[1]||"",!0),this.o=so(ve[2]||""),this.g=so(ve[3]||"",!0),Vt(this,ve[4]),this.l=so(ve[5]||"",!0),ot(this,ve[6]||"",!0),this.m=so(ve[7]||"")):(this.h=!1,this.i=new Qr(null,this.h))}va.prototype.toString=function(){var q=[],ve=this.j;ve&&q.push(Zc(ve,qs,!0),":");var ke=this.g;return(ke||ve=="file")&&(q.push("//"),(ve=this.o)&&q.push(Zc(ve,qs,!0),"@"),q.push(encodeURIComponent(String(ke)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ke=this.s,ke!=null&&q.push(":",String(ke))),(ke=this.l)&&(this.g&&ke.charAt(0)!="/"&&q.push("/"),q.push(Zc(ke,ke.charAt(0)=="/"?js:mr,!0))),(ke=this.i.toString())&&q.push("?",ke),(ke=this.m)&&q.push("#",Zc(ke,Za)),q.join("")};function Ii(q){return new va(q)}function ns(q,ve,ke){q.j=ke?so(ve,!0):ve,q.j&&(q.j=q.j.replace(/:$/,""))}function Vt(q,ve){if(ve){if(ve=Number(ve),isNaN(ve)||0>ve)throw Error("Bad port number "+ve);q.s=ve}else q.s=null}function ot(q,ve,ke){ve instanceof Qr?(q.i=ve,Or(q.i,q.h)):(ke||(ve=Zc(ve,Wh)),q.i=new Qr(ve,q.h))}function Fn(q,ve,ke){q.i.set(ve,ke)}function zi(q){return Fn(q,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),q}function so(q,ve){return q?ve?decodeURI(q.replace(/%25/g,"%2525")):decodeURIComponent(q):""}function Zc(q,ve,ke){return typeof q=="string"?(q=encodeURI(q).replace(ve,Tu),ke&&(q=q.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),q):null}function Tu(q){return q=q.charCodeAt(0),"%"+(q>>4&15).toString(16)+(q&15).toString(16)}var qs=/[#\/\?@]/g,mr=/[#\?:]/g,js=/[#\?]/g,Wh=/[#\?@]/g,Za=/#/g;function Qr(q,ve){this.h=this.g=null,this.i=q||null,this.j=!!ve}function ja(q){q.g||(q.g=new Map,q.h=0,q.i&&Uf(q.i,function(ve,ke){q.add(decodeURIComponent(ve.replace(/\+/g," ")),ke)}))}t=Qr.prototype,t.add=function(q,ve){ja(this),this.i=null,q=ba(this,q);var ke=this.g.get(q);return ke||this.g.set(q,ke=[]),ke.push(ve),this.h+=1,this};function Wn(q,ve){ja(q),ve=ba(q,ve),q.g.has(ve)&&(q.i=null,q.h-=q.g.get(ve).length,q.g.delete(ve))}function Bd(q,ve){return ja(q),ve=ba(q,ve),q.g.has(ve)}t.forEach=function(q,ve){ja(this),this.g.forEach(function(ke,et){ke.forEach(function(Gt){q.call(ve,Gt,et,this)},this)},this)},t.na=function(){ja(this);const q=Array.from(this.g.values()),ve=Array.from(this.g.keys()),ke=[];for(let et=0;et<ve.length;et++){const Gt=q[et];for(let en=0;en<Gt.length;en++)ke.push(ve[et])}return ke},t.V=function(q){ja(this);let ve=[];if(typeof q=="string")Bd(this,q)&&(ve=ve.concat(this.g.get(ba(this,q))));else{q=Array.from(this.g.values());for(let ke=0;ke<q.length;ke++)ve=ve.concat(q[ke])}return ve},t.set=function(q,ve){return ja(this),this.i=null,q=ba(this,q),Bd(this,q)&&(this.h-=this.g.get(q).length),this.g.set(q,[ve]),this.h+=1,this},t.get=function(q,ve){return q?(q=this.V(q),0<q.length?String(q[0]):ve):ve};function fo(q,ve,ke){Wn(q,ve),0<ke.length&&(q.i=null,q.g.set(ba(q,ve),Z(ke)),q.h+=ke.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const q=[],ve=Array.from(this.g.keys());for(var ke=0;ke<ve.length;ke++){var et=ve[ke];const en=encodeURIComponent(String(et)),Kn=this.V(et);for(et=0;et<Kn.length;et++){var Gt=en;Kn[et]!==""&&(Gt+="="+encodeURIComponent(String(Kn[et]))),q.push(Gt)}}return this.i=q.join("&")};function ba(q,ve){return ve=String(ve),q.j&&(ve=ve.toLowerCase()),ve}function Or(q,ve){ve&&!q.j&&(ja(q),q.i=null,q.g.forEach(function(ke,et){var Gt=et.toLowerCase();et!=Gt&&(Wn(this,et),fo(this,Gt,ke))},q)),q.j=ve}function Ir(q,ve){const ke=new rt;if(s.Image){const et=new Image;et.onload=K(Vr,ke,"TestLoadImage: loaded",!0,ve,et),et.onerror=K(Vr,ke,"TestLoadImage: error",!1,ve,et),et.onabort=K(Vr,ke,"TestLoadImage: abort",!1,ve,et),et.ontimeout=K(Vr,ke,"TestLoadImage: timeout",!1,ve,et),s.setTimeout(function(){et.ontimeout&&et.ontimeout()},1e4),et.src=q}else ve(!1)}function $h(q,ve){const ke=new rt,et=new AbortController,Gt=setTimeout(()=>{et.abort(),Vr(ke,"TestPingServer: timeout",!1,ve)},1e4);fetch(q,{signal:et.signal}).then(en=>{clearTimeout(Gt),en.ok?Vr(ke,"TestPingServer: ok",!0,ve):Vr(ke,"TestPingServer: server error",!1,ve)}).catch(()=>{clearTimeout(Gt),Vr(ke,"TestPingServer: error",!1,ve)})}function Vr(q,ve,ke,et,Gt){try{Gt&&(Gt.onload=null,Gt.onerror=null,Gt.onabort=null,Gt.ontimeout=null),et(ke)}catch{}}function vn(){this.g=new Nr}function ui(q,ve,ke){const et=ke||"";try{zs(q,function(Gt,en){let Kn=Gt;w(Gt)&&(Kn=Rr(Gt)),ve.push(et+en+"="+encodeURIComponent(Kn))})}catch(Gt){throw ve.push(et+"type="+encodeURIComponent("_badmap")),Gt}}function Ur(q){this.l=q.Ub||null,this.j=q.eb||!1}Q(Ur,ri),Ur.prototype.g=function(){return new oo(this.l,this.j)},Ur.prototype.i=function(q){return function(){return q}}({});function oo(q,ve){Si.call(this),this.D=q,this.o=ve,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(oo,Si),t=oo.prototype,t.open=function(q,ve){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=q,this.A=ve,this.readyState=1,Oo(this)},t.send=function(q){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const ve={headers:this.u,method:this.B,credentials:this.m,cache:void 0};q&&(ve.body=q),(this.D||s).fetch(new Request(this.A,ve)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Yr(this)),this.readyState=0},t.Sa=function(q){if(this.g&&(this.l=q,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=q.headers,this.readyState=2,Oo(this)),this.g&&(this.readyState=3,Oo(this),this.g)))if(this.responseType==="arraybuffer")q.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in q){if(this.j=q.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Va(this)}else q.text().then(this.Ra.bind(this),this.ga.bind(this))};function Va(q){q.j.read().then(q.Pa.bind(q)).catch(q.ga.bind(q))}t.Pa=function(q){if(this.g){if(this.o&&q.value)this.response.push(q.value);else if(!this.o){var ve=q.value?q.value:new Uint8Array(0);(ve=this.v.decode(ve,{stream:!q.done}))&&(this.response=this.responseText+=ve)}q.done?Yr(this):Oo(this),this.readyState==3&&Va(this)}},t.Ra=function(q){this.g&&(this.response=this.responseText=q,Yr(this))},t.Qa=function(q){this.g&&(this.response=q,Yr(this))},t.ga=function(){this.g&&Yr(this)};function Yr(q){q.readyState=4,q.l=null,q.j=null,q.v=null,Oo(q)}t.setRequestHeader=function(q,ve){this.u.append(q,ve)},t.getResponseHeader=function(q){return this.h&&this.h.get(q.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const q=[],ve=this.h.entries();for(var ke=ve.next();!ke.done;)ke=ke.value,q.push(ke[0]+": "+ke[1]),ke=ve.next();return q.join(`\r
`)};function Oo(q){q.onreadystatechange&&q.onreadystatechange.call(q)}Object.defineProperty(oo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(q){this.m=q?"include":"same-origin"}});function Pl(q){let ve="";return Ae(q,function(ke,et){ve+=et,ve+=":",ve+=ke,ve+=`\r
`}),ve}function sa(q,ve,ke){e:{for(et in ke){var et=!1;break e}et=!0}et||(ke=Pl(ke),typeof q=="string"?ke!=null&&encodeURIComponent(String(ke)):Fn(q,ve,ke))}function Ci(q){Si.call(this),this.headers=new Map,this.o=q||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(Ci,Si);var us=/^https?$/i,oa=["POST","PUT"];t=Ci.prototype,t.Ha=function(q){this.J=q},t.ea=function(q,ve,ke,et){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+q);ve=ve?ve.toUpperCase():"GET",this.D=q,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():hn.g(),this.v=this.o?Ec(this.o):Ec(hn),this.g.onreadystatechange=W(this.Ea,this);try{this.B=!0,this.g.open(ve,String(q),!0),this.B=!1}catch(en){po(this,en);return}if(q=ke||"",ke=new Map(this.headers),et)if(Object.getPrototypeOf(et)===Object.prototype)for(var Gt in et)ke.set(Gt,et[Gt]);else if(typeof et.keys=="function"&&typeof et.get=="function")for(const en of et.keys())ke.set(en,et.get(en));else throw Error("Unknown input type for opt_headers: "+String(et));et=Array.from(ke.keys()).find(en=>en.toLowerCase()=="content-type"),Gt=s.FormData&&q instanceof s.FormData,!(0<=Array.prototype.indexOf.call(oa,ve,void 0))||et||Gt||ke.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[en,Kn]of ke)this.g.setRequestHeader(en,Kn);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Cu(this),this.u=!0,this.g.send(q),this.u=!1}catch(en){po(this,en)}};function po(q,ve){q.h=!1,q.g&&(q.j=!0,q.g.abort(),q.j=!1),q.l=ve,q.m=5,Qu(q),Ic(q)}function Qu(q){q.A||(q.A=!0,cs(q,"complete"),cs(q,"error"))}t.abort=function(q){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=q||7,cs(this,"complete"),cs(this,"abort"),Ic(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ic(this,!0)),Ci.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Cc(this):this.bb())},t.bb=function(){Cc(this)};function Cc(q){if(q.h&&typeof u<"u"&&(!q.v[1]||Rs(q)!=4||q.Z()!=2)){if(q.u&&Rs(q)==4)mn(q.Ea,0,q);else if(cs(q,"readystatechange"),Rs(q)==4){q.h=!1;try{const Kn=q.Z();e:switch(Kn){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ve=!0;break e;default:ve=!1}var ke;if(!(ke=ve)){var et;if(et=Kn===0){var Gt=String(q.D).match(Ml)[1]||null;!Gt&&s.self&&s.self.location&&(Gt=s.self.location.protocol.slice(0,-1)),et=!us.test(Gt?Gt.toLowerCase():"")}ke=et}if(ke)cs(q,"complete"),cs(q,"success");else{q.m=6;try{var en=2<Rs(q)?q.g.statusText:""}catch{en=""}q.l=en+" ["+q.Z()+"]",Qu(q)}}finally{Ic(q)}}}}function Ic(q,ve){if(q.g){Cu(q);const ke=q.g,et=q.v[0]?()=>{}:null;q.g=null,q.v=null,ve||cs(q,"ready");try{ke.onreadystatechange=et}catch{}}}function Cu(q){q.I&&(s.clearTimeout(q.I),q.I=null)}t.isActive=function(){return!!this.g};function Rs(q){return q.g?q.g.readyState:0}t.Z=function(){try{return 2<Rs(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(q){if(this.g){var ve=this.g.responseText;return q&&ve.indexOf(q)==0&&(ve=ve.substring(q.length)),$r(ve)}};function hl(q){try{if(!q.g)return null;if("response"in q.g)return q.g.response;switch(q.H){case"":case"text":return q.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in q.g)return q.g.mozResponseArrayBuffer}return null}catch{return null}}function hi(q){const ve={};q=(q.g&&2<=Rs(q)&&q.g.getAllResponseHeaders()||"").split(`\r
`);for(let et=0;et<q.length;et++){if(me(q[et]))continue;var ke=Ie(q[et]);const Gt=ke[0];if(ke=ke[1],typeof ke!="string")continue;ke=ke.trim();const en=ve[Gt]||[];ve[Gt]=en,en.push(ke)}re(ve,function(et){return et.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Dl(q,ve,ke){return ke&&ke.internalChannelParams&&ke.internalChannelParams[q]||ve}function aa(q){this.Aa=0,this.i=[],this.j=new rt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Dl("failFast",!1,q),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Dl("baseRetryDelayMs",5e3,q),this.cb=Dl("retryDelaySeedMs",1e4,q),this.Wa=Dl("forwardChannelMaxRetries",2,q),this.wa=Dl("forwardChannelRequestTimeoutMs",2e4,q),this.pa=q&&q.xmlHttpFactory||void 0,this.Xa=q&&q.Tb||void 0,this.Ca=q&&q.useFetchStreams||!1,this.L=void 0,this.J=q&&q.supportsCrossDomainXhr||!1,this.K="",this.h=new qr(q&&q.concurrentRequestLimit),this.Da=new vn,this.P=q&&q.fastHandshake||!1,this.O=q&&q.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=q&&q.Rb||!1,q&&q.xa&&this.j.xa(),q&&q.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&q&&q.detectBufferingProxy||!1,this.ja=void 0,q&&q.longPollingTimeout&&0<q.longPollingTimeout&&(this.ja=q.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=aa.prototype,t.la=8,t.G=1,t.connect=function(q,ve,ke,et){Me(0),this.W=q,this.H=ve||{},ke&&et!==void 0&&(this.H.OSID=ke,this.H.OAID=et),this.F=this.X,this.I=Lr(this,null,this.W),_r(this)};function Ki(q){if(Zt(q),q.G==3){var ve=q.U++,ke=Ii(q.I);if(Fn(ke,"SID",q.K),Fn(ke,"RID",ve),Fn(ke,"TYPE","terminate"),dl(q,ke),ve=new Jn(q,q.j,ve),ve.L=2,ve.v=zi(Ii(ke)),ke=!1,s.navigator&&s.navigator.sendBeacon)try{ke=s.navigator.sendBeacon(ve.v.toString(),"")}catch{}!ke&&s.Image&&(new Image().src=ve.v,ke=!0),ke||(ve.g=Hf(ve.j,null),ve.g.ea(ve.v)),ve.F=Date.now(),zr(ve)}fs(q)}function Gs(q){q.g&&(Ua(q),q.g.cancel(),q.g=null)}function Zt(q){Gs(q),q.u&&(s.clearTimeout(q.u),q.u=null),ac(q),q.h.cancel(),q.s&&(typeof q.s=="number"&&s.clearTimeout(q.s),q.s=null)}function _r(q){if(!Gr(q.h)&&!q.s){q.s=!0;var ve=q.Ga;Nt||nn(),wt||(Nt(),wt=!0),it.add(ve,q),q.B=0}}function vo(q,ve){return Ti(q.h)>=q.h.j-(q.s?1:0)?!1:q.s?(q.i=ve.D.concat(q.i),!0):q.G==1||q.G==2||q.B>=(q.Va?0:q.Wa)?!1:(q.s=nt(W(q.Ga,q,ve),Ju(q,q.B)),q.B++,!0)}t.Ga=function(q){if(this.s)if(this.s=null,this.G==1){if(!q){this.U=Math.floor(1e5*Math.random()),q=this.U++;const Gt=new Jn(this,this.j,q);let en=this.o;if(this.S&&(en?(en=fe(en),ue(en,this.S)):en=this.S),this.m!==null||this.O||(Gt.H=en,en=null),this.P)e:{for(var ve=0,ke=0;ke<this.i.length;ke++){t:{var et=this.i[ke];if("__data__"in et.map&&(et=et.map.__data__,typeof et=="string")){et=et.length;break t}et=void 0}if(et===void 0)break;if(ve+=et,4096<ve){ve=ke;break e}if(ve===4096||ke===this.i.length-1){ve=ke+1;break e}}ve=1e3}else ve=1e3;ve=oc(this,Gt,ve),ke=Ii(this.I),Fn(ke,"RID",q),Fn(ke,"CVER",22),this.D&&Fn(ke,"X-HTTP-Session-Id",this.D),dl(this,ke),en&&(this.O?ve="headers="+encodeURIComponent(String(Pl(en)))+"&"+ve:this.m&&sa(ke,this.m,en)),xa(this.h,Gt),this.Ua&&Fn(ke,"TYPE","init"),this.P?(Fn(ke,"$req",ve),Fn(ke,"SID","null"),Gt.T=!0,ii(Gt,ke,null)):ii(Gt,ke,ve),this.G=2}}else this.G==3&&(q?Lo(this,q):this.i.length==0||Gr(this.h)||Lo(this))};function Lo(q,ve){var ke;ve?ke=ve.l:ke=q.U++;const et=Ii(q.I);Fn(et,"SID",q.K),Fn(et,"RID",ke),Fn(et,"AID",q.T),dl(q,et),q.m&&q.o&&sa(et,q.m,q.o),ke=new Jn(q,q.j,ke,q.B+1),q.m===null&&(ke.H=q.o),ve&&(q.i=ve.D.concat(q.i)),ve=oc(q,ke,1e3),ke.I=Math.round(.5*q.wa)+Math.round(.5*q.wa*Math.random()),xa(q.h,ke),ii(ke,et,ve)}function dl(q,ve){q.H&&Ae(q.H,function(ke,et){Fn(ve,et,ke)}),q.l&&zs({},function(ke,et){Fn(ve,et,ke)})}function oc(q,ve,ke){ke=Math.min(q.i.length,ke);var et=q.l?W(q.l.Na,q.l,q):null;e:{var Gt=q.i;let en=-1;for(;;){const Kn=["count="+ke];en==-1?0<ke?(en=Gt[0].g,Kn.push("ofs="+en)):en=0:Kn.push("ofs="+en);let ji=!0;for(let nr=0;nr<ke;nr++){let gn=Gt[nr].g;const As=Gt[nr].map;if(gn-=en,0>gn)en=Math.max(0,Gt[nr].g-100),ji=!1;else try{ui(As,Kn,"req"+gn+"_")}catch{et&&et(As)}}if(ji){et=Kn.join("&");break e}}}return q=q.i.splice(0,ke),ve.D=q,et}function kl(q){if(!q.g&&!q.u){q.Y=1;var ve=q.Fa;Nt||nn(),wt||(Nt(),wt=!0),it.add(ve,q),q.v=0}}function zd(q){return q.g||q.u||3<=q.v?!1:(q.Y++,q.u=nt(W(q.Fa,q),Ju(q,q.v)),q.v++,!0)}t.Fa=function(){if(this.u=null,mo(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var q=2*this.R;this.j.info("BP detection timer enabled: "+q),this.A=nt(W(this.ab,this),q)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Me(10),Gs(this),mo(this))};function Ua(q){q.A!=null&&(s.clearTimeout(q.A),q.A=null)}function mo(q){q.g=new Jn(q,q.j,"rpc",q.Y),q.m===null&&(q.g.H=q.o),q.g.O=0;var ve=Ii(q.qa);Fn(ve,"RID","rpc"),Fn(ve,"SID",q.K),Fn(ve,"AID",q.T),Fn(ve,"CI",q.F?"0":"1"),!q.F&&q.ja&&Fn(ve,"TO",q.ja),Fn(ve,"TYPE","xmlhttp"),dl(q,ve),q.m&&q.o&&sa(ve,q.m,q.o),q.L&&(q.g.I=q.L);var ke=q.g;q=q.ia,ke.L=1,ke.v=zi(Ii(ve)),ke.m=null,ke.P=!0,si(ke,q)}t.Za=function(){this.C!=null&&(this.C=null,Gs(this),zd(this),Me(19))};function ac(q){q.C!=null&&(s.clearTimeout(q.C),q.C=null)}function Mi(q,ve){var ke=null;if(q.g==ve){ac(q),Ua(q),q.g=null;var et=2}else if(Ko(q.h,ve))ke=ve.D,Eu(q.h,ve),et=1;else return;if(q.G!=0){if(ve.o)if(et==1){ke=ve.m?ve.m.length:0,ve=Date.now()-ve.F;var Gt=q.B;et=sc(),cs(et,new qe(et,ke)),_r(q)}else kl(q);else if(Gt=ve.s,Gt==3||Gt==0&&0<ve.X||!(et==1&&vo(q,ve)||et==2&&zd(q)))switch(ke&&0<ke.length&&(ve=q.h,ve.i=ve.i.concat(ke)),Gt){case 1:bo(q,5);break;case 4:bo(q,10);break;case 3:bo(q,6);break;default:bo(q,2)}}}function Ju(q,ve){let ke=q.Ta+Math.floor(Math.random()*q.cb);return q.isActive()||(ke*=2),ke*ve}function bo(q,ve){if(q.j.info("Error code "+ve),ve==2){var ke=W(q.fb,q),et=q.Xa;const Gt=!et;et=new va(et||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||ns(et,"https"),zi(et),Gt?Ir(et.toString(),ke):$h(et.toString(),ke)}else Me(2);q.G=0,q.l&&q.l.sa(ve),fs(q),Zt(q)}t.fb=function(q){q?(this.j.info("Successfully pinged google.com"),Me(2)):(this.j.info("Failed to ping google.com"),Me(1))};function fs(q){if(q.G=0,q.ka=[],q.l){const ve=$s(q.h);(ve.length!=0||q.i.length!=0)&&(oe(q.ka,ve),oe(q.ka,q.i),q.h.i.length=0,Z(q.i),q.i.length=0),q.l.ra()}}function Lr(q,ve,ke){var et=ke instanceof va?Ii(ke):new va(ke);if(et.g!="")ve&&(et.g=ve+"."+et.g),Vt(et,et.s);else{var Gt=s.location;et=Gt.protocol,ve=ve?ve+"."+Gt.hostname:Gt.hostname,Gt=+Gt.port;var en=new va(null);et&&ns(en,et),ve&&(en.g=ve),Gt&&Vt(en,Gt),ke&&(en.l=ke),et=en}return ke=q.D,ve=q.ya,ke&&ve&&Fn(et,ke,ve),Fn(et,"VER",q.la),dl(q,et),et}function Hf(q,ve,ke){if(ve&&!q.J)throw Error("Can't create secondary domain capable XhrIo object.");return ve=q.Ca&&!q.pa?new Ci(new Ur({eb:ke})):new Ci(q.pa),ve.Ha(q.J),ve}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Is(){}t=Is.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function wa(){}wa.prototype.g=function(q,ve){return new eo(q,ve)};function eo(q,ve){Si.call(this),this.g=new aa(ve),this.l=q,this.h=ve&&ve.messageUrlParams||null,q=ve&&ve.messageHeaders||null,ve&&ve.clientProtocolHeaderRequired&&(q?q["X-Client-Protocol"]="webchannel":q={"X-Client-Protocol":"webchannel"}),this.g.o=q,q=ve&&ve.initMessageHeaders||null,ve&&ve.messageContentType&&(q?q["X-WebChannel-Content-Type"]=ve.messageContentType:q={"X-WebChannel-Content-Type":ve.messageContentType}),ve&&ve.va&&(q?q["X-WebChannel-Client-Profile"]=ve.va:q={"X-WebChannel-Client-Profile":ve.va}),this.g.S=q,(q=ve&&ve.Sb)&&!me(q)&&(this.g.m=q),this.v=ve&&ve.supportsCrossDomainXhr||!1,this.u=ve&&ve.sendRawJson||!1,(ve=ve&&ve.httpSessionIdParam)&&!me(ve)&&(this.g.D=ve,q=this.h,q!==null&&ve in q&&(q=this.h,ve in q&&delete q[ve])),this.j=new Ea(this)}Q(eo,Si),eo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},eo.prototype.close=function(){Ki(this.g)},eo.prototype.o=function(q){var ve=this.g;if(typeof q=="string"){var ke={};ke.__data__=q,q=ke}else this.u&&(ke={},ke.__data__=Rr(q),q=ke);ve.i.push(new Xo(ve.Ya++,q)),ve.G==3&&_r(ve)},eo.prototype.N=function(){this.g.l=null,delete this.j,Ki(this.g),delete this.g,eo.aa.N.call(this)};function Wf(q){ra.call(this),q.__headers__&&(this.headers=q.__headers__,this.statusCode=q.__status__,delete q.__headers__,delete q.__status__);var ve=q.__sm__;if(ve){e:{for(const ke in ve){q=ke;break e}q=void 0}(this.i=q)&&(q=this.i,ve=ve!==null&&q in ve?ve[q]:void 0),this.data=ve}else this.data=q}Q(Wf,ra);function Fo(){Tc.call(this),this.status=1}Q(Fo,Tc);function Ea(q){this.g=q}Q(Ea,Is),Ea.prototype.ua=function(){cs(this.g,"a")},Ea.prototype.ta=function(q){cs(this.g,new Wf(q))},Ea.prototype.sa=function(q){cs(this.g,new Fo)},Ea.prototype.ra=function(){cs(this.g,"b")},wa.prototype.createWebChannel=wa.prototype.g,eo.prototype.send=eo.prototype.o,eo.prototype.open=eo.prototype.m,eo.prototype.close=eo.prototype.close,bG=function(){return new wa},vG=function(){return sc()},xG=za,Ik={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Mt.NO_ERROR=0,Mt.TIMEOUT=8,Mt.HTTP_ERROR=6,NT=Mt,Kt.COMPLETE="complete",yG=Kt,Sc.EventType=Zr,Zr.OPEN="a",Zr.CLOSE="b",Zr.ERROR="c",Zr.MESSAGE="d",Si.prototype.listen=Si.prototype.K,rb=Sc,Ci.prototype.listenOnce=Ci.prototype.L,Ci.prototype.getLastError=Ci.prototype.Ka,Ci.prototype.getLastErrorCode=Ci.prototype.Ba,Ci.prototype.getStatus=Ci.prototype.Z,Ci.prototype.getResponseJson=Ci.prototype.Oa,Ci.prototype.getResponseText=Ci.prototype.oa,Ci.prototype.send=Ci.prototype.ea,Ci.prototype.setWithCredentials=Ci.prototype.Ha,_G=Ci}).apply(typeof NS<"u"?NS:typeof self<"u"?self:typeof window<"u"?window:{});const kj="@firebase/firestore",Nj="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Yl.UNAUTHENTICATED=new Yl(null),Yl.GOOGLE_CREDENTIALS=new Yl("google-credentials-uid"),Yl.FIRST_PARTY=new Yl("first-party-uid"),Yl.MOCK_USER=new Yl("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yx="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o_=new uA("@firebase/firestore");function q0(){return o_.logLevel}function wr(t,...e){if(o_.logLevel<=ss.DEBUG){const n=e.map(yL);o_.debug(`Firestore (${yx}): ${t}`,...n)}}function Rf(t,...e){if(o_.logLevel<=ss.ERROR){const n=e.map(yL);o_.error(`Firestore (${yx}): ${t}`,...n)}}function Hy(t,...e){if(o_.logLevel<=ss.WARN){const n=e.map(yL);o_.warn(`Firestore (${yx}): ${t}`,...n)}}function yL(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(t="Unexpected state"){const e=`FIRESTORE (${yx}) INTERNAL ASSERTION FAILED: `+t;throw Rf(e),new Error(e)}function Ws(t,e){t||Ei()}function ki(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const An={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Er extends Nd{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wG{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Nue{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Yl.UNAUTHENTICATED))}shutdown(){}}class Oue{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class Lue{constructor(e){this.t=e,this.currentUser=Yl.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ws(this.o===void 0);let r=this.i;const i=v=>this.i!==r?(r=this.i,n(v)):Promise.resolve();let l=new _f;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new _f,e.enqueueRetryable(()=>i(this.currentUser))};const u=()=>{const v=l;e.enqueueRetryable(async()=>{await v.promise,await i(this.currentUser)})},s=v=>{wr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(v=>s(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?s(v):(wr("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new _f)}},0),u()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(wr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ws(typeof r.accessToken=="string"),new wG(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ws(e===null||typeof e=="string"),new Yl(e)}}class Fue{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Yl.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Bue{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new Fue(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Yl.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Oj{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zue{constructor(e,n){this.A=n,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Bc(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,n){Ws(this.o===void 0);const r=l=>{l.error!=null&&wr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const u=l.token!==this.R;return this.R=l.token,wr("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?n(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable(()=>r(l))};const i=l=>{wr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(l=>i(l)),setTimeout(()=>{if(!this.appCheck){const l=this.A.getImmediate({optional:!0});l?i(l):wr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Oj(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ws(typeof n.token=="string"),this.R=n.token,new Oj(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jue(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EG(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SG{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=jue(40);for(let l=0;l<i.length;++l)r.length<20&&i[l]<n&&(r+=e.charAt(i[l]%62))}return r}}function Gi(t,e){return t<e?-1:t>e?1:0}function Ak(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=t.codePointAt(n),i=e.codePointAt(n);if(r!==i){if(r<128&&i<128)return Gi(r,i);{const l=EG(),u=Vue(l.encode(Lj(t,n)),l.encode(Lj(e,n)));return u!==0?u:Gi(r,i)}}n+=r>65535?2:1}return Gi(t.length,e.length)}function Lj(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function Vue(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return Gi(t[n],e[n]);return Gi(t.length,e.length)}function Wy(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fj=-62135596800,Bj=1e6;class Fa{static now(){return Fa.fromMillis(Date.now())}static fromDate(e){return Fa.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Bj);return new Fa(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Er(An.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Er(An.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Fj)throw new Er(An.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Er(An.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Bj}_compareTo(e){return this.seconds===e.seconds?Gi(this.nanoseconds,e.nanoseconds):Gi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Fj;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{static fromTimestamp(e){return new Ri(e)}static min(){return new Ri(new Fa(0,0))}static max(){return new Ri(new Fa(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zj="__name__";class pd{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ei(),r===void 0?r=e.length-n:r>e.length-n&&Ei(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return pd.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof pd?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const l=pd.compareSegments(e.get(i),n.get(i));if(l!==0)return l}return Gi(e.length,n.length)}static compareSegments(e,n){const r=pd.isNumericId(e),i=pd.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?pd.extractNumericId(e).compare(pd.extractNumericId(n)):Ak(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return om.fromString(e.substring(4,e.length-2))}}class Ao extends pd{construct(e,n,r){return new Ao(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Er(An.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new Ao(n)}static emptyPath(){return new Ao([])}}const Uue=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wl extends pd{construct(e,n,r){return new wl(e,n,r)}static isValidIdentifier(e){return Uue.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wl.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===zj}static keyField(){return new wl([zj])}static fromServerFormat(e){const n=[];let r="",i=0;const l=()=>{if(r.length===0)throw new Er(An.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let u=!1;for(;i<e.length;){const s=e[i];if(s==="\\"){if(i+1===e.length)throw new Er(An.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const v=e[i+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new Er(An.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=v,i+=2}else s==="`"?(u=!u,i++):s!=="."||u?(r+=s,i++):(l(),i++)}if(l(),u)throw new Er(An.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wl(n)}static emptyPath(){return new wl([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e){this.path=e}static fromPath(e){return new ni(Ao.fromString(e))}static fromName(e){return new ni(Ao.fromString(e).popFirst(5))}static empty(){return new ni(Ao.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ao.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ao.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ni(new Ao(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw=-1;function Hue(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Ri.fromTimestamp(r===1e9?new Fa(n+1,0):new Fa(n,r));return new _m(i,ni.empty(),e)}function Wue(t){return new _m(t.readTime,t.key,fw)}class _m{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new _m(Ri.min(),ni.empty(),fw)}static max(){return new _m(Ri.max(),ni.empty(),fw)}}function $ue(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ni.comparator(t.documentKey,e.documentKey),n!==0?n:Gi(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const que="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Gue{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xx(t){if(t.code!==An.FAILED_PRECONDITION||t.message!==que)throw t;wr("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ei(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Rn((r,i)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(r,i)},this.catchCallback=l=>{this.wrapFailure(n,l).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof Rn?n:Rn.resolve(n)}catch(n){return Rn.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):Rn.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):Rn.reject(n)}static resolve(e){return new Rn((n,r)=>{n(e)})}static reject(e){return new Rn((n,r)=>{r(e)})}static waitFor(e){return new Rn((n,r)=>{let i=0,l=0,u=!1;e.forEach(s=>{++i,s.next(()=>{++l,u&&l===i&&n()},v=>r(v))}),u=!0,l===i&&n()})}static or(e){let n=Rn.resolve(!1);for(const r of e)n=n.next(i=>i?Rn.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,l)=>{r.push(n.call(this,i,l))}),this.waitFor(r)}static mapArray(e,n){return new Rn((r,i)=>{const l=e.length,u=new Array(l);let s=0;for(let v=0;v<l;v++){const w=v;n(e[w]).next(A=>{u[w]=A,++s,s===l&&r(u)},A=>i(A))}})}static doWhile(e,n){return new Rn((r,i)=>{const l=()=>{e()===!0?n().next(()=>{l()},i):r()};l()})}}function Yue(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function vx(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.oe(r),this._e=r=>n.writeSequenceNumber(r))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}hA.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xL=-1;function dA(t){return t==null}function FC(t){return t===0&&1/t==-1/0}function Xue(t){return typeof t=="number"&&Number.isInteger(t)&&!FC(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TG="";function Kue(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=jj(e)),e=Zue(t.get(n),e);return jj(e)}function Zue(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const l=t.charAt(i);switch(l){case"\0":n+="";break;case TG:n+="";break;default:n+=l}}return n}function jj(t){return t+TG+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vj(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Om(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function CG(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ba=class Rk{constructor(e,n){this.comparator=e,this.root=n||am.EMPTY}insert(e,n){return new Rk(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,am.BLACK,null,null))}remove(e){return new Rk(this.comparator,this.root.remove(e,this.comparator).copy(null,null,am.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new OS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new OS(this.root,e,this.comparator,!1)}getReverseIterator(){return new OS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new OS(this.root,e,this.comparator,!0)}},OS=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=n?r(e.key,n):1,n&&i&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},am=class nf{constructor(e,n,r,i,l){this.key=e,this.value=n,this.color=r??nf.RED,this.left=i??nf.EMPTY,this.right=l??nf.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,l){return new nf(e??this.key,n??this.value,r??this.color,i??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const l=r(e,i.key);return i=l<0?i.copy(null,null,null,i.left.insert(e,n,r),null):l===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return nf.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return nf.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nf.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nf.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ei();const e=this.left.check();if(e!==this.right.check())throw Ei();return e+(this.isRed()?0:1)}};am.EMPTY=null,am.RED=!0,am.BLACK=!1;am.EMPTY=new class{constructor(){this.size=0}get key(){throw Ei()}get value(){throw Ei()}get color(){throw Ei()}get left(){throw Ei()}get right(){throw Ei()}copy(e,n,r,i,l){return this}insert(e,n,r){return new am(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e){this.comparator=e,this.data=new Ba(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Uj(this.data.getIterator())}getIteratorFrom(e){return new Uj(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Xa)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,l=r.getNext().key;if(this.comparator(i,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Xa(this.comparator);return n.data=e,n}}class Uj{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e){this.fields=e,e.sort(wl.comparator)}static empty(){return new du([])}unionWith(e){let n=new Xa(wl.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new du(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Wy(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new IG("Invalid base64 string: "+l):l}}(e);return new Al(n)}static fromUint8Array(e){const n=function(i){let l="";for(let u=0;u<i.length;++u)l+=String.fromCharCode(i[u]);return l}(e);return new Al(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Gi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Al.EMPTY_BYTE_STRING=new Al("");const Que=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ym(t){if(Ws(!!t),typeof t=="string"){let e=0;const n=Que.exec(t);if(Ws(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:da(t.seconds),nanos:da(t.nanos)}}function da(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function xm(t){return typeof t=="string"?Al.fromBase64String(t):Al.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AG="server_timestamp",RG="__type__",MG="__previous_value__",PG="__local_write_time__";function vL(t){var e,n;return((n=(((e=t?.mapValue)===null||e===void 0?void 0:e.fields)||{})[RG])===null||n===void 0?void 0:n.stringValue)===AG}function fA(t){const e=t.mapValue.fields[MG];return vL(e)?fA(e):e}function pw(t){const e=ym(t.mapValue.fields[PG].timestampValue);return new Fa(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jue{constructor(e,n,r,i,l,u,s,v,w){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=l,this.forceLongPolling=u,this.autoDetectLongPolling=s,this.longPollingOptions=v,this.useFetchStreams=w}}const BC="(default)";class mw{constructor(e,n){this.projectId=e,this.database=n||BC}static empty(){return new mw("","")}get isDefaultDatabase(){return this.database===BC}isEqual(e){return e instanceof mw&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DG="__type__",ehe="__max__",LS={mapValue:{}},kG="__vector__",zC="value";function vm(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vL(t)?4:nhe(t)?9007199254740991:the(t)?10:11:Ei()}function Pd(t,e){if(t===e)return!0;const n=vm(t);if(n!==vm(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return pw(t).isEqual(pw(e));case 3:return function(i,l){if(typeof i.timestampValue=="string"&&typeof l.timestampValue=="string"&&i.timestampValue.length===l.timestampValue.length)return i.timestampValue===l.timestampValue;const u=ym(i.timestampValue),s=ym(l.timestampValue);return u.seconds===s.seconds&&u.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,l){return xm(i.bytesValue).isEqual(xm(l.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,l){return da(i.geoPointValue.latitude)===da(l.geoPointValue.latitude)&&da(i.geoPointValue.longitude)===da(l.geoPointValue.longitude)}(t,e);case 2:return function(i,l){if("integerValue"in i&&"integerValue"in l)return da(i.integerValue)===da(l.integerValue);if("doubleValue"in i&&"doubleValue"in l){const u=da(i.doubleValue),s=da(l.doubleValue);return u===s?FC(u)===FC(s):isNaN(u)&&isNaN(s)}return!1}(t,e);case 9:return Wy(t.arrayValue.values||[],e.arrayValue.values||[],Pd);case 10:case 11:return function(i,l){const u=i.mapValue.fields||{},s=l.mapValue.fields||{};if(Vj(u)!==Vj(s))return!1;for(const v in u)if(u.hasOwnProperty(v)&&(s[v]===void 0||!Pd(u[v],s[v])))return!1;return!0}(t,e);default:return Ei()}}function gw(t,e){return(t.values||[]).find(n=>Pd(n,e))!==void 0}function $y(t,e){if(t===e)return 0;const n=vm(t),r=vm(e);if(n!==r)return Gi(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Gi(t.booleanValue,e.booleanValue);case 2:return function(l,u){const s=da(l.integerValue||l.doubleValue),v=da(u.integerValue||u.doubleValue);return s<v?-1:s>v?1:s===v?0:isNaN(s)?isNaN(v)?0:-1:1}(t,e);case 3:return Hj(t.timestampValue,e.timestampValue);case 4:return Hj(pw(t),pw(e));case 5:return Ak(t.stringValue,e.stringValue);case 6:return function(l,u){const s=xm(l),v=xm(u);return s.compareTo(v)}(t.bytesValue,e.bytesValue);case 7:return function(l,u){const s=l.split("/"),v=u.split("/");for(let w=0;w<s.length&&w<v.length;w++){const A=Gi(s[w],v[w]);if(A!==0)return A}return Gi(s.length,v.length)}(t.referenceValue,e.referenceValue);case 8:return function(l,u){const s=Gi(da(l.latitude),da(u.latitude));return s!==0?s:Gi(da(l.longitude),da(u.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Wj(t.arrayValue,e.arrayValue);case 10:return function(l,u){var s,v,w,A;const F=l.fields||{},W=u.fields||{},K=(s=F[zC])===null||s===void 0?void 0:s.arrayValue,Q=(v=W[zC])===null||v===void 0?void 0:v.arrayValue,Z=Gi(((w=K?.values)===null||w===void 0?void 0:w.length)||0,((A=Q?.values)===null||A===void 0?void 0:A.length)||0);return Z!==0?Z:Wj(K,Q)}(t.mapValue,e.mapValue);case 11:return function(l,u){if(l===LS.mapValue&&u===LS.mapValue)return 0;if(l===LS.mapValue)return 1;if(u===LS.mapValue)return-1;const s=l.fields||{},v=Object.keys(s),w=u.fields||{},A=Object.keys(w);v.sort(),A.sort();for(let F=0;F<v.length&&F<A.length;++F){const W=Ak(v[F],A[F]);if(W!==0)return W;const K=$y(s[v[F]],w[A[F]]);if(K!==0)return K}return Gi(v.length,A.length)}(t.mapValue,e.mapValue);default:throw Ei()}}function Hj(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Gi(t,e);const n=ym(t),r=ym(e),i=Gi(n.seconds,r.seconds);return i!==0?i:Gi(n.nanos,r.nanos)}function Wj(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const l=$y(n[i],r[i]);if(l)return l}return Gi(n.length,r.length)}function qy(t){return Mk(t)}function Mk(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=ym(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return xm(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return ni.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const l of n.values||[])i?i=!1:r+=",",r+=Mk(l);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",l=!0;for(const u of r)l?l=!1:i+=",",i+=`${u}:${Mk(n.fields[u])}`;return i+"}"}(t.mapValue):Ei()}function OT(t){switch(vm(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fA(t);return e?16+OT(e):16;case 5:return 2*t.stringValue.length;case 6:return xm(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,l)=>i+OT(l),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return Om(r.fields,(l,u)=>{i+=l.length+OT(u)}),i}(t.mapValue);default:throw Ei()}}function $j(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Pk(t){return!!t&&"integerValue"in t}function bL(t){return!!t&&"arrayValue"in t}function qj(t){return!!t&&"nullValue"in t}function Gj(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function LT(t){return!!t&&"mapValue"in t}function the(t){var e,n;return((n=(((e=t?.mapValue)===null||e===void 0?void 0:e.fields)||{})[DG])===null||n===void 0?void 0:n.stringValue)===kG}function Ib(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Om(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Ib(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ib(t.arrayValue.values[n]);return e}return Object.assign({},t)}function nhe(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===ehe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc{constructor(e){this.value=e}static empty(){return new zc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!LT(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ib(n)}setAll(e){let n=wl.emptyPath(),r={},i=[];e.forEach((u,s)=>{if(!n.isImmediateParentOf(s)){const v=this.getFieldsMap(n);this.applyChanges(v,r,i),r={},i=[],n=s.popLast()}u?r[s.lastSegment()]=Ib(u):i.push(s.lastSegment())});const l=this.getFieldsMap(n);this.applyChanges(l,r,i)}delete(e){const n=this.field(e.popLast());LT(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Pd(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];LT(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Om(n,(i,l)=>e[i]=l);for(const i of r)delete e[i]}clone(){return new zc(Ib(this.value))}}function NG(t){const e=[];return Om(t.fields,(n,r)=>{const i=new wl([n]);if(LT(r)){const l=NG(r.mapValue).fields;if(l.length===0)e.push(i);else for(const u of l)e.push(i.child(u))}else e.push(i)}),new du(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{constructor(e,n,r,i,l,u,s){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=l,this.data=u,this.documentState=s}static newInvalidDocument(e){return new Kl(e,0,Ri.min(),Ri.min(),Ri.min(),zc.empty(),0)}static newFoundDocument(e,n,r,i){return new Kl(e,1,n,Ri.min(),r,i,0)}static newNoDocument(e,n){return new Kl(e,2,n,Ri.min(),Ri.min(),zc.empty(),0)}static newUnknownDocument(e,n){return new Kl(e,3,n,Ri.min(),Ri.min(),zc.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ri.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=zc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=zc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ri.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Kl&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Kl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC{constructor(e,n){this.position=e,this.inclusive=n}}function Yj(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const l=e[i],u=t.position[i];if(l.field.isKeyField()?r=ni.comparator(ni.fromName(u.referenceValue),n.key):r=$y(u,n.data.field(l.field)),l.dir==="desc"&&(r*=-1),r!==0)break}return r}function Xj(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Pd(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e,n="asc"){this.field=e,this.dir=n}}function rhe(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OG{}class Oa extends OG{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new she(e,n,r):n==="array-contains"?new lhe(e,r):n==="in"?new che(e,r):n==="not-in"?new uhe(e,r):n==="array-contains-any"?new hhe(e,r):new Oa(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new ohe(e,r):new ahe(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison($y(n,this.value)):n!==null&&vm(this.value)===vm(n)&&this.matchesComparison($y(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ei()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Lh extends OG{constructor(e,n){super(),this.filters=e,this.op=n,this.ce=null}static create(e,n){return new Lh(e,n)}matches(e){return LG(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function LG(t){return t.op==="and"}function FG(t){return ihe(t)&&LG(t)}function ihe(t){for(const e of t.filters)if(e instanceof Lh)return!1;return!0}function Dk(t){if(t instanceof Oa)return t.field.canonicalString()+t.op.toString()+qy(t.value);if(FG(t))return t.filters.map(e=>Dk(e)).join(",");{const e=t.filters.map(n=>Dk(n)).join(",");return`${t.op}(${e})`}}function BG(t,e){return t instanceof Oa?function(r,i){return i instanceof Oa&&r.op===i.op&&r.field.isEqual(i.field)&&Pd(r.value,i.value)}(t,e):t instanceof Lh?function(r,i){return i instanceof Lh&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((l,u,s)=>l&&BG(u,i.filters[s]),!0):!1}(t,e):void Ei()}function zG(t){return t instanceof Oa?function(n){return`${n.field.canonicalString()} ${n.op} ${qy(n.value)}`}(t):t instanceof Lh?function(n){return n.op.toString()+" {"+n.getFilters().map(zG).join(" ,")+"}"}(t):"Filter"}class she extends Oa{constructor(e,n,r){super(e,n,r),this.key=ni.fromName(r.referenceValue)}matches(e){const n=ni.comparator(e.key,this.key);return this.matchesComparison(n)}}class ohe extends Oa{constructor(e,n){super(e,"in",n),this.keys=jG("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class ahe extends Oa{constructor(e,n){super(e,"not-in",n),this.keys=jG("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function jG(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>ni.fromName(r.referenceValue))}class lhe extends Oa{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return bL(n)&&gw(n.arrayValue,this.value)}}class che extends Oa{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&gw(this.value.arrayValue,n)}}class uhe extends Oa{constructor(e,n){super(e,"not-in",n)}matches(e){if(gw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!gw(this.value.arrayValue,n)}}class hhe extends Oa{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!bL(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>gw(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dhe{constructor(e,n=null,r=[],i=[],l=null,u=null,s=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=l,this.startAt=u,this.endAt=s,this.le=null}}function Kj(t,e=null,n=[],r=[],i=null,l=null,u=null){return new dhe(t,e,n,r,i,l,u)}function wL(t){const e=ki(t);if(e.le===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Dk(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(l){return l.field.canonicalString()+l.dir}(r)).join(","),dA(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>qy(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>qy(r)).join(",")),e.le=n}return e.le}function EL(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!rhe(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!BG(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Xj(t.startAt,e.startAt)&&Xj(t.endAt,e.endAt)}function kk(t){return ni.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx{constructor(e,n=null,r=[],i=[],l=null,u="F",s=null,v=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=l,this.limitType=u,this.startAt=s,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function fhe(t,e,n,r,i,l,u,s){return new bx(t,e,n,r,i,l,u,s)}function SL(t){return new bx(t)}function Zj(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function VG(t){return t.collectionGroup!==null}function Ab(t){const e=ki(t);if(e.he===null){e.he=[];const n=new Set;for(const l of e.explicitOrderBy)e.he.push(l),n.add(l.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let s=new Xa(wl.comparator);return u.filters.forEach(v=>{v.getFlattenedFilters().forEach(w=>{w.isInequality()&&(s=s.add(w.field))})}),s})(e).forEach(l=>{n.has(l.canonicalString())||l.isKeyField()||e.he.push(new _w(l,r))}),n.has(wl.keyField().canonicalString())||e.he.push(new _w(wl.keyField(),r))}return e.he}function Ed(t){const e=ki(t);return e.Pe||(e.Pe=phe(e,Ab(t))),e.Pe}function phe(t,e){if(t.limitType==="F")return Kj(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const l=i.dir==="desc"?"asc":"desc";return new _w(i.field,l)});const n=t.endAt?new jC(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new jC(t.startAt.position,t.startAt.inclusive):null;return Kj(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Nk(t,e){const n=t.filters.concat([e]);return new bx(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Ok(t,e,n){return new bx(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function pA(t,e){return EL(Ed(t),Ed(e))&&t.limitType===e.limitType}function UG(t){return`${wL(Ed(t))}|lt:${t.limitType}`}function G0(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>zG(i)).join(", ")}]`),dA(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(u){return`${u.field.canonicalString()} (${u.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>qy(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>qy(i)).join(",")),`Target(${r})`}(Ed(t))}; limitType=${t.limitType})`}function mA(t,e){return e.isFoundDocument()&&function(r,i){const l=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(l):ni.isDocumentKey(r.path)?r.path.isEqual(l):r.path.isImmediateParentOf(l)}(t,e)&&function(r,i){for(const l of Ab(r))if(!l.field.isKeyField()&&i.data.field(l.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const l of r.filters)if(!l.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(u,s,v){const w=Yj(u,s,v);return u.inclusive?w<=0:w<0}(r.startAt,Ab(r),i)||r.endAt&&!function(u,s,v){const w=Yj(u,s,v);return u.inclusive?w>=0:w>0}(r.endAt,Ab(r),i))}(t,e)}function mhe(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function HG(t){return(e,n)=>{let r=!1;for(const i of Ab(t)){const l=ghe(i,e,n);if(l!==0)return l;r=r||i.field.isKeyField()}return 0}}function ghe(t,e,n){const r=t.field.isKeyField()?ni.comparator(e.key,n.key):function(l,u,s){const v=u.data.field(l),w=s.data.field(l);return v!==null&&w!==null?$y(v,w):Ei()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ei()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,l]of r)if(this.equalsFn(i,e))return l}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let l=0;l<i.length;l++)if(this.equalsFn(i[l][0],e))return void(i[l]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Om(this.inner,(n,r)=>{for(const[i,l]of r)e(i,l)})}isEmpty(){return CG(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _he=new Ba(ni.comparator);function Mf(){return _he}const WG=new Ba(ni.comparator);function ib(...t){let e=WG;for(const n of t)e=e.insert(n.key,n);return e}function $G(t){let e=WG;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Vg(){return Rb()}function qG(){return Rb()}function Rb(){return new T_(t=>t.toString(),(t,e)=>t.isEqual(e))}const yhe=new Ba(ni.comparator),xhe=new Xa(ni.comparator);function ds(...t){let e=xhe;for(const n of t)e=e.add(n);return e}const vhe=new Xa(Gi);function bhe(){return vhe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TL(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:FC(e)?"-0":e}}function GG(t){return{integerValue:""+t}}function whe(t,e){return Xue(e)?GG(e):TL(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gA{constructor(){this._=void 0}}function Ehe(t,e,n){return t instanceof yw?function(i,l){const u={fields:{[RG]:{stringValue:AG},[PG]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return l&&vL(l)&&(l=fA(l)),l&&(u.fields[MG]=l),{mapValue:u}}(n,e):t instanceof xw?XG(t,e):t instanceof vw?KG(t,e):function(i,l){const u=YG(i,l),s=Qj(u)+Qj(i.Ie);return Pk(u)&&Pk(i.Ie)?GG(s):TL(i.serializer,s)}(t,e)}function She(t,e,n){return t instanceof xw?XG(t,e):t instanceof vw?KG(t,e):n}function YG(t,e){return t instanceof VC?function(r){return Pk(r)||function(l){return!!l&&"doubleValue"in l}(r)}(e)?e:{integerValue:0}:null}class yw extends gA{}class xw extends gA{constructor(e){super(),this.elements=e}}function XG(t,e){const n=ZG(e);for(const r of t.elements)n.some(i=>Pd(i,r))||n.push(r);return{arrayValue:{values:n}}}class vw extends gA{constructor(e){super(),this.elements=e}}function KG(t,e){let n=ZG(e);for(const r of t.elements)n=n.filter(i=>!Pd(i,r));return{arrayValue:{values:n}}}class VC extends gA{constructor(e,n){super(),this.serializer=e,this.Ie=n}}function Qj(t){return da(t.integerValue||t.doubleValue)}function ZG(t){return bL(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class The{constructor(e,n){this.field=e,this.transform=n}}function Che(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof xw&&i instanceof xw||r instanceof vw&&i instanceof vw?Wy(r.elements,i.elements,Pd):r instanceof VC&&i instanceof VC?Pd(r.Ie,i.Ie):r instanceof yw&&i instanceof yw}(t.transform,e.transform)}class Ihe{constructor(e,n){this.version=e,this.transformResults=n}}class Dh{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Dh}static exists(e){return new Dh(void 0,e)}static updateTime(e){return new Dh(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function FT(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}let _A=class{};function QG(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new eY(t.key,Dh.none()):new n2(t.key,t.data,Dh.none());{const n=t.data,r=zc.empty();let i=new Xa(wl.comparator);for(let l of e.fields)if(!i.has(l)){let u=n.field(l);u===null&&l.length>1&&(l=l.popLast(),u=n.field(l)),u===null?r.delete(l):r.set(l,u),i=i.add(l)}return new Lm(t.key,r,new du(i.toArray()),Dh.none())}}function Ahe(t,e,n){t instanceof n2?function(i,l,u){const s=i.value.clone(),v=eV(i.fieldTransforms,l,u.transformResults);s.setAll(v),l.convertToFoundDocument(u.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Lm?function(i,l,u){if(!FT(i.precondition,l))return void l.convertToUnknownDocument(u.version);const s=eV(i.fieldTransforms,l,u.transformResults),v=l.data;v.setAll(JG(i)),v.setAll(s),l.convertToFoundDocument(u.version,v).setHasCommittedMutations()}(t,e,n):function(i,l,u){l.convertToNoDocument(u.version).setHasCommittedMutations()}(0,e,n)}function Mb(t,e,n,r){return t instanceof n2?function(l,u,s,v){if(!FT(l.precondition,u))return s;const w=l.value.clone(),A=tV(l.fieldTransforms,v,u);return w.setAll(A),u.convertToFoundDocument(u.version,w).setHasLocalMutations(),null}(t,e,n,r):t instanceof Lm?function(l,u,s,v){if(!FT(l.precondition,u))return s;const w=tV(l.fieldTransforms,v,u),A=u.data;return A.setAll(JG(l)),A.setAll(w),u.convertToFoundDocument(u.version,A).setHasLocalMutations(),s===null?null:s.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map(F=>F.field))}(t,e,n,r):function(l,u,s){return FT(l.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):s}(t,e,n)}function Rhe(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),l=YG(r.transform,i||null);l!=null&&(n===null&&(n=zc.empty()),n.set(r.field,l))}return n||null}function Jj(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Wy(r,i,(l,u)=>Che(l,u))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class n2 extends _A{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Lm extends _A{constructor(e,n,r,i,l=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function JG(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function eV(t,e,n){const r=new Map;Ws(t.length===n.length);for(let i=0;i<n.length;i++){const l=t[i],u=l.transform,s=e.data.field(l.field);r.set(l.field,She(u,s,n[i]))}return r}function tV(t,e,n){const r=new Map;for(const i of t){const l=i.transform,u=n.data.field(i.field);r.set(i.field,Ehe(l,u,e))}return r}class eY extends _A{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mhe extends _A{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Phe{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const l=this.mutations[i];l.key.isEqual(e.key)&&Ahe(l,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Mb(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Mb(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=qG();return this.mutations.forEach(i=>{const l=e.get(i.key),u=l.overlayedDocument;let s=this.applyToLocalView(u,l.mutatedFields);s=n.has(i.key)?null:s;const v=QG(u,s);v!==null&&r.set(i.key,v),u.isValidDocument()||u.convertToNoDocument(Ri.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),ds())}isEqual(e){return this.batchId===e.batchId&&Wy(this.mutations,e.mutations,(n,r)=>Jj(n,r))&&Wy(this.baseMutations,e.baseMutations,(n,r)=>Jj(n,r))}}class CL{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Ws(e.mutations.length===r.length);let i=function(){return yhe}();const l=e.mutations;for(let u=0;u<l.length;u++)i=i.insert(l[u].key,r[u].version);return new CL(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dhe=class{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class khe{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pa,ws;function Nhe(t){switch(t){case An.OK:return Ei();case An.CANCELLED:case An.UNKNOWN:case An.DEADLINE_EXCEEDED:case An.RESOURCE_EXHAUSTED:case An.INTERNAL:case An.UNAVAILABLE:case An.UNAUTHENTICATED:return!1;case An.INVALID_ARGUMENT:case An.NOT_FOUND:case An.ALREADY_EXISTS:case An.PERMISSION_DENIED:case An.FAILED_PRECONDITION:case An.ABORTED:case An.OUT_OF_RANGE:case An.UNIMPLEMENTED:case An.DATA_LOSS:return!0;default:return Ei()}}function tY(t){if(t===void 0)return Rf("GRPC error has no .code"),An.UNKNOWN;switch(t){case Pa.OK:return An.OK;case Pa.CANCELLED:return An.CANCELLED;case Pa.UNKNOWN:return An.UNKNOWN;case Pa.DEADLINE_EXCEEDED:return An.DEADLINE_EXCEEDED;case Pa.RESOURCE_EXHAUSTED:return An.RESOURCE_EXHAUSTED;case Pa.INTERNAL:return An.INTERNAL;case Pa.UNAVAILABLE:return An.UNAVAILABLE;case Pa.UNAUTHENTICATED:return An.UNAUTHENTICATED;case Pa.INVALID_ARGUMENT:return An.INVALID_ARGUMENT;case Pa.NOT_FOUND:return An.NOT_FOUND;case Pa.ALREADY_EXISTS:return An.ALREADY_EXISTS;case Pa.PERMISSION_DENIED:return An.PERMISSION_DENIED;case Pa.FAILED_PRECONDITION:return An.FAILED_PRECONDITION;case Pa.ABORTED:return An.ABORTED;case Pa.OUT_OF_RANGE:return An.OUT_OF_RANGE;case Pa.UNIMPLEMENTED:return An.UNIMPLEMENTED;case Pa.DATA_LOSS:return An.DATA_LOSS;default:return Ei()}}(ws=Pa||(Pa={}))[ws.OK=0]="OK",ws[ws.CANCELLED=1]="CANCELLED",ws[ws.UNKNOWN=2]="UNKNOWN",ws[ws.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ws[ws.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ws[ws.NOT_FOUND=5]="NOT_FOUND",ws[ws.ALREADY_EXISTS=6]="ALREADY_EXISTS",ws[ws.PERMISSION_DENIED=7]="PERMISSION_DENIED",ws[ws.UNAUTHENTICATED=16]="UNAUTHENTICATED",ws[ws.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ws[ws.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ws[ws.ABORTED=10]="ABORTED",ws[ws.OUT_OF_RANGE=11]="OUT_OF_RANGE",ws[ws.UNIMPLEMENTED=12]="UNIMPLEMENTED",ws[ws.INTERNAL=13]="INTERNAL",ws[ws.UNAVAILABLE=14]="UNAVAILABLE",ws[ws.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ohe=new om([4294967295,4294967295],0);function nV(t){const e=EG().encode(t),n=new gG;return n.update(e),new Uint8Array(n.digest())}function rV(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new om([n,r],0),new om([i,l],0)]}class IL{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new sb(`Invalid padding: ${n}`);if(r<0)throw new sb(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new sb(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new sb(`Invalid padding when bitmap length is 0: ${n}`);this.Ee=8*e.length-n,this.de=om.fromNumber(this.Ee)}Ae(e,n,r){let i=e.add(n.multiply(om.fromNumber(r)));return i.compare(Ohe)===1&&(i=new om([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const n=nV(e),[r,i]=rV(n);for(let l=0;l<this.hashCount;l++){const u=this.Ae(r,i,l);if(!this.Re(u))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),u=new IL(l,i,n);return r.forEach(s=>u.insert(s)),u}insert(e){if(this.Ee===0)return;const n=nV(e),[r,i]=rV(n);for(let l=0;l<this.hashCount;l++){const u=this.Ae(r,i,l);this.Ve(u)}}Ve(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class sb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yA{constructor(e,n,r,i,l){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,r2.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new yA(Ri.min(),i,new Ba(Gi),Mf(),ds())}}class r2{constructor(e,n,r,i,l){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new r2(r,n,ds(),ds(),ds())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BT{constructor(e,n,r,i){this.me=e,this.removedTargetIds=n,this.key=r,this.fe=i}}class nY{constructor(e,n){this.targetId=e,this.ge=n}}class rY{constructor(e,n,r=Al.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class iV{constructor(){this.pe=0,this.ye=sV(),this.we=Al.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=ds(),n=ds(),r=ds();return this.ye.forEach((i,l)=>{switch(l){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ei()}}),new r2(this.we,this.Se,e,n,r)}Me(){this.be=!1,this.ye=sV()}xe(e,n){this.be=!0,this.ye=this.ye.insert(e,n)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,Ws(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class Lhe{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Mf(),this.$e=FS(),this.Ue=FS(),this.Ke=new Ba(Gi)}We(e){for(const n of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(n,e.fe):this.ze(n,e.key,e.fe);for(const n of e.removedTargetIds)this.ze(n,e.key,e.fe)}je(e){this.forEachTarget(e,n=>{const r=this.He(n);switch(e.state){case 0:this.Je(n)&&r.Ce(e.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(e.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(n);break;case 3:this.Je(n)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.Je(n)&&(this.Ye(n),r.Ce(e.resumeToken));break;default:Ei()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.qe.forEach((r,i)=>{this.Je(i)&&n(i)})}Ze(e){const n=e.targetId,r=e.ge.count,i=this.Xe(n);if(i){const l=i.target;if(kk(l))if(r===0){const u=new ni(l.path);this.ze(n,u,Kl.newNoDocument(u,Ri.min()))}else Ws(r===1);else{const u=this.et(n);if(u!==r){const s=this.tt(e),v=s?this.nt(s,e,u):1;if(v!==0){this.Ye(n);const w=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,w)}}}}}tt(e){const n=e.ge.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:l=0}=n;let u,s;try{u=xm(r).toUint8Array()}catch(v){if(v instanceof IG)return Hy("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{s=new IL(u,i,l)}catch(v){return Hy(v instanceof sb?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return s.Ee===0?null:s}nt(e,n,r){return n.ge.count===r-this.st(e,n.targetId)?0:2}st(e,n){const r=this.ke.getRemoteKeysForTarget(n);let i=0;return r.forEach(l=>{const u=this.ke.it(),s=`projects/${u.projectId}/databases/${u.database}/documents/${l.path.canonicalString()}`;e.mightContain(s)||(this.ze(n,l,null),i++)}),i}ot(e){const n=new Map;this.qe.forEach((l,u)=>{const s=this.Xe(u);if(s){if(l.current&&kk(s.target)){const v=new ni(s.target.path);this._t(v).has(u)||this.ut(u,v)||this.ze(u,v,Kl.newNoDocument(v,e))}l.ve&&(n.set(u,l.Fe()),l.Me())}});let r=ds();this.Ue.forEach((l,u)=>{let s=!0;u.forEachWhile(v=>{const w=this.Xe(v);return!w||w.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)}),s&&(r=r.add(l))}),this.Qe.forEach((l,u)=>u.setReadTime(e));const i=new yA(e,n,this.Ke,this.Qe,r);return this.Qe=Mf(),this.$e=FS(),this.Ue=FS(),this.Ke=new Ba(Gi),i}Ge(e,n){if(!this.Je(e))return;const r=this.ut(e,n.key)?2:0;this.He(e).xe(n.key,r),this.Qe=this.Qe.insert(n.key,n),this.$e=this.$e.insert(n.key,this._t(n.key).add(e)),this.Ue=this.Ue.insert(n.key,this.ct(n.key).add(e))}ze(e,n,r){if(!this.Je(e))return;const i=this.He(e);this.ut(e,n)?i.xe(n,1):i.Oe(n),this.Ue=this.Ue.insert(n,this.ct(n).delete(e)),this.Ue=this.Ue.insert(n,this.ct(n).add(e)),r&&(this.Qe=this.Qe.insert(n,r))}removeTarget(e){this.qe.delete(e)}et(e){const n=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let n=this.qe.get(e);return n||(n=new iV,this.qe.set(e,n)),n}ct(e){let n=this.Ue.get(e);return n||(n=new Xa(Gi),this.Ue=this.Ue.insert(e,n)),n}_t(e){let n=this.$e.get(e);return n||(n=new Xa(Gi),this.$e=this.$e.insert(e,n)),n}Je(e){const n=this.Xe(e)!==null;return n||wr("WatchChangeAggregator","Detected inactive target",e),n}Xe(e){const n=this.qe.get(e);return n&&n.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new iV),this.ke.getRemoteKeysForTarget(e).forEach(n=>{this.ze(e,n,null)})}ut(e,n){return this.ke.getRemoteKeysForTarget(e).has(n)}}function FS(){return new Ba(ni.comparator)}function sV(){return new Ba(ni.comparator)}const Fhe={asc:"ASCENDING",desc:"DESCENDING"},Bhe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zhe={and:"AND",or:"OR"};class jhe{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Lk(t,e){return t.useProto3Json||dA(e)?e:{value:e}}function UC(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function iY(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Vhe(t,e){return UC(t,e.toTimestamp())}function Sd(t){return Ws(!!t),Ri.fromTimestamp(function(n){const r=ym(n);return new Fa(r.seconds,r.nanos)}(t))}function AL(t,e){return Fk(t,e).canonicalString()}function Fk(t,e){const n=function(i){return new Ao(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function sY(t){const e=Ao.fromString(t);return Ws(uY(e)),e}function Bk(t,e){return AL(t.databaseId,e.path)}function vD(t,e){const n=sY(e);if(n.get(1)!==t.databaseId.projectId)throw new Er(An.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Er(An.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ni(aY(n))}function oY(t,e){return AL(t.databaseId,e)}function Uhe(t){const e=sY(t);return e.length===4?Ao.emptyPath():aY(e)}function zk(t){return new Ao(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function aY(t){return Ws(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function oV(t,e,n){return{name:Bk(t,e),fields:n.value.mapValue.fields}}function Hhe(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:Ei()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],l=function(w,A){return w.useProto3Json?(Ws(A===void 0||typeof A=="string"),Al.fromBase64String(A||"")):(Ws(A===void 0||A instanceof Buffer||A instanceof Uint8Array),Al.fromUint8Array(A||new Uint8Array))}(t,e.targetChange.resumeToken),u=e.targetChange.cause,s=u&&function(w){const A=w.code===void 0?An.UNKNOWN:tY(w.code);return new Er(A,w.message||"")}(u);n=new rY(r,i,l,s||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=vD(t,r.document.name),l=Sd(r.document.updateTime),u=r.document.createTime?Sd(r.document.createTime):Ri.min(),s=new zc({mapValue:{fields:r.document.fields}}),v=Kl.newFoundDocument(i,l,u,s),w=r.targetIds||[],A=r.removedTargetIds||[];n=new BT(w,A,v.key,v)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=vD(t,r.document),l=r.readTime?Sd(r.readTime):Ri.min(),u=Kl.newNoDocument(i,l),s=r.removedTargetIds||[];n=new BT([],s,u.key,u)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=vD(t,r.document),l=r.removedTargetIds||[];n=new BT([],l,i,null)}else{if(!("filter"in e))return Ei();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:l}=r,u=new khe(i,l),s=r.targetId;n=new nY(s,u)}}return n}function Whe(t,e){let n;if(e instanceof n2)n={update:oV(t,e.key,e.value)};else if(e instanceof eY)n={delete:Bk(t,e.key)};else if(e instanceof Lm)n={update:oV(t,e.key,e.data),updateMask:Jhe(e.fieldMask)};else{if(!(e instanceof Mhe))return Ei();n={verify:Bk(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(l,u){const s=u.transform;if(s instanceof yw)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof xw)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof vw)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof VC)return{fieldPath:u.field.canonicalString(),increment:s.Ie};throw Ei()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,l){return l.updateTime!==void 0?{updateTime:Vhe(i,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Ei()}(t,e.precondition)),n}function $he(t,e){return t&&t.length>0?(Ws(e!==void 0),t.map(n=>function(i,l){let u=i.updateTime?Sd(i.updateTime):Sd(l);return u.isEqual(Ri.min())&&(u=Sd(l)),new Ihe(u,i.transformResults||[])}(n,e))):[]}function qhe(t,e){return{documents:[oY(t,e.path)]}}function Ghe(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=oY(t,i);const l=function(w){if(w.length!==0)return cY(Lh.create(w,"and"))}(e.filters);l&&(n.structuredQuery.where=l);const u=function(w){if(w.length!==0)return w.map(A=>function(W){return{field:Y0(W.field),direction:Khe(W.dir)}}(A))}(e.orderBy);u&&(n.structuredQuery.orderBy=u);const s=Lk(t,e.limit);return s!==null&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=function(w){return{before:w.inclusive,values:w.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(w){return{before:!w.inclusive,values:w.position}}(e.endAt)),{ht:n,parent:i}}function Yhe(t){let e=Uhe(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Ws(r===1);const A=n.from[0];A.allDescendants?i=A.collectionId:e=e.child(A.collectionId)}let l=[];n.where&&(l=function(F){const W=lY(F);return W instanceof Lh&&FG(W)?W.getFilters():[W]}(n.where));let u=[];n.orderBy&&(u=function(F){return F.map(W=>function(Q){return new _w(X0(Q.field),function(oe){switch(oe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Q.direction))}(W))}(n.orderBy));let s=null;n.limit&&(s=function(F){let W;return W=typeof F=="object"?F.value:F,dA(W)?null:W}(n.limit));let v=null;n.startAt&&(v=function(F){const W=!!F.before,K=F.values||[];return new jC(K,W)}(n.startAt));let w=null;return n.endAt&&(w=function(F){const W=!F.before,K=F.values||[];return new jC(K,W)}(n.endAt)),fhe(e,i,u,l,s,"F",v,w)}function Xhe(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ei()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function lY(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=X0(n.unaryFilter.field);return Oa.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=X0(n.unaryFilter.field);return Oa.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=X0(n.unaryFilter.field);return Oa.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=X0(n.unaryFilter.field);return Oa.create(u,"!=",{nullValue:"NULL_VALUE"});default:return Ei()}}(t):t.fieldFilter!==void 0?function(n){return Oa.create(X0(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ei()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Lh.create(n.compositeFilter.filters.map(r=>lY(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ei()}}(n.compositeFilter.op))}(t):Ei()}function Khe(t){return Fhe[t]}function Zhe(t){return Bhe[t]}function Qhe(t){return zhe[t]}function Y0(t){return{fieldPath:t.canonicalString()}}function X0(t){return wl.fromServerFormat(t.fieldPath)}function cY(t){return t instanceof Oa?function(n){if(n.op==="=="){if(Gj(n.value))return{unaryFilter:{field:Y0(n.field),op:"IS_NAN"}};if(qj(n.value))return{unaryFilter:{field:Y0(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Gj(n.value))return{unaryFilter:{field:Y0(n.field),op:"IS_NOT_NAN"}};if(qj(n.value))return{unaryFilter:{field:Y0(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Y0(n.field),op:Zhe(n.op),value:n.value}}}(t):t instanceof Lh?function(n){const r=n.getFilters().map(i=>cY(i));return r.length===1?r[0]:{compositeFilter:{op:Qhe(n.op),filters:r}}}(t):Ei()}function Jhe(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function uY(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e,n,r,i,l=Ri.min(),u=Ri.min(),s=Al.EMPTY_BYTE_STRING,v=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=s,this.expectedCount=v}withSequenceNumber(e){return new Wp(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Wp(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Wp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Wp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ede{constructor(e){this.Tt=e}}function tde(t){const e=Yhe({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ok(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nde{constructor(){this.Tn=new rde}addToCollectionParentIndex(e,n){return this.Tn.add(n),Rn.resolve()}getCollectionParents(e,n){return Rn.resolve(this.Tn.getEntries(n))}addFieldIndex(e,n){return Rn.resolve()}deleteFieldIndex(e,n){return Rn.resolve()}deleteAllFieldIndexes(e){return Rn.resolve()}createTargetIndexes(e,n){return Rn.resolve()}getDocumentsMatchingTarget(e,n){return Rn.resolve(null)}getIndexType(e,n){return Rn.resolve(0)}getFieldIndexes(e,n){return Rn.resolve([])}getNextCollectionGroupToUpdate(e){return Rn.resolve(null)}getMinOffset(e,n){return Rn.resolve(_m.min())}getMinOffsetFromCollectionGroup(e,n){return Rn.resolve(_m.min())}updateCollectionGroup(e,n,r){return Rn.resolve()}updateIndexEntries(e,n){return Rn.resolve()}}class rde{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Xa(Ao.comparator),l=!i.has(r);return this.index[n]=i.add(r),l}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Xa(Ao.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aV={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hY=41943040;class Oc{static withCacheSize(e){return new Oc(e,Oc.DEFAULT_COLLECTION_PERCENTILE,Oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Oc.DEFAULT_COLLECTION_PERCENTILE=10,Oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oc.DEFAULT=new Oc(hY,Oc.DEFAULT_COLLECTION_PERCENTILE,Oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oc.DISABLED=new Oc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new Gy(0)}static Kn(){return new Gy(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lV="LruGarbageCollector",ide=1048576;function cV([t,e],[n,r]){const i=Gi(t,n);return i===0?Gi(e,r):i}class sde{constructor(e){this.Hn=e,this.buffer=new Xa(cV),this.Jn=0}Yn(){return++this.Jn}Zn(e){const n=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();cV(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class ode{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){wr(lV,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){vx(n)?wr(lV,"Ignoring IndexedDB error during garbage collection: ",n):await xx(n)}await this.er(3e5)})}}class ade{constructor(e,n){this.tr=e,this.params=n}calculateTargetCount(e,n){return this.tr.nr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return Rn.resolve(hA.ae);const r=new sde(n);return this.tr.forEachTarget(e,i=>r.Zn(i.sequenceNumber)).next(()=>this.tr.rr(e,i=>r.Zn(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.tr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.tr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(wr("LruGarbageCollector","Garbage collection skipped; disabled"),Rn.resolve(aV)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(wr("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aV):this.ir(e,n))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,n){let r,i,l,u,s,v,w;const A=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(F=>(F>this.params.maximumSequenceNumbersToCollect?(wr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${F}`),i=this.params.maximumSequenceNumbersToCollect):i=F,u=Date.now(),this.nthSequenceNumber(e,i))).next(F=>(r=F,s=Date.now(),this.removeTargets(e,r,n))).next(F=>(l=F,v=Date.now(),this.removeOrphanedDocuments(e,r))).next(F=>(w=Date.now(),q0()<=ss.DEBUG&&wr("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-A}ms
	Determined least recently used ${i} in `+(s-u)+`ms
	Removed ${l} targets in `+(v-s)+`ms
	Removed ${F} documents in `+(w-v)+`ms
Total Duration: ${w-A}ms`),Rn.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:l,documentsRemoved:F})))}}function lde(t,e){return new ade(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cde{constructor(){this.changes=new T_(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Kl.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?Rn.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ude{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hde{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Mb(r.mutation,i,du.empty(),Fa.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,ds()).next(()=>r))}getLocalViewOfDocuments(e,n,r=ds()){const i=Vg();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(l=>{let u=ib();return l.forEach((s,v)=>{u=u.insert(s,v.overlayedDocument)}),u}))}getOverlayedDocuments(e,n){const r=Vg();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,ds()))}populateOverlays(e,n,r){const i=[];return r.forEach(l=>{n.has(l)||i.push(l)}),this.documentOverlayCache.getOverlays(e,i).next(l=>{l.forEach((u,s)=>{n.set(u,s)})})}computeViews(e,n,r,i){let l=Mf();const u=Rb(),s=function(){return Rb()}();return n.forEach((v,w)=>{const A=r.get(w.key);i.has(w.key)&&(A===void 0||A.mutation instanceof Lm)?l=l.insert(w.key,w):A!==void 0?(u.set(w.key,A.mutation.getFieldMask()),Mb(A.mutation,w,A.mutation.getFieldMask(),Fa.now())):u.set(w.key,du.empty())}),this.recalculateAndSaveOverlays(e,l).next(v=>(v.forEach((w,A)=>u.set(w,A)),n.forEach((w,A)=>{var F;return s.set(w,new ude(A,(F=u.get(w))!==null&&F!==void 0?F:null))}),s))}recalculateAndSaveOverlays(e,n){const r=Rb();let i=new Ba((u,s)=>u-s),l=ds();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(u=>{for(const s of u)s.keys().forEach(v=>{const w=n.get(v);if(w===null)return;let A=r.get(v)||du.empty();A=s.applyToLocalView(w,A),r.set(v,A);const F=(i.get(s.batchId)||ds()).add(v);i=i.insert(s.batchId,F)})}).next(()=>{const u=[],s=i.getReverseIterator();for(;s.hasNext();){const v=s.getNext(),w=v.key,A=v.value,F=qG();A.forEach(W=>{if(!l.has(W)){const K=QG(n.get(W),r.get(W));K!==null&&F.set(W,K),l=l.add(W)}}),u.push(this.documentOverlayCache.saveOverlays(e,w,F))}return Rn.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(u){return ni.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):VG(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(l=>{const u=i-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-l.size):Rn.resolve(Vg());let s=fw,v=l;return u.next(w=>Rn.forEach(w,(A,F)=>(s<F.largestBatchId&&(s=F.largestBatchId),l.get(A)?Rn.resolve():this.remoteDocumentCache.getEntry(e,A).next(W=>{v=v.insert(A,W)}))).next(()=>this.populateOverlays(e,w,l)).next(()=>this.computeViews(e,v,w,ds())).next(A=>({batchId:s,changes:$G(A)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ni(n)).next(r=>{let i=ib();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const l=n.collectionGroup;let u=ib();return this.indexManager.getCollectionParents(e,l).next(s=>Rn.forEach(s,v=>{const w=function(F,W){return new bx(W,null,F.explicitOrderBy.slice(),F.filters.slice(),F.limit,F.limitType,F.startAt,F.endAt)}(n,v.child(l));return this.getDocumentsMatchingCollectionQuery(e,w,r,i).next(A=>{A.forEach((F,W)=>{u=u.insert(F,W)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(e,n,r,i){let l;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(u=>(l=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,l,i))).next(u=>{l.forEach((v,w)=>{const A=w.getKey();u.get(A)===null&&(u=u.insert(A,Kl.newInvalidDocument(A)))});let s=ib();return u.forEach((v,w)=>{const A=l.get(v);A!==void 0&&Mb(A.mutation,w,du.empty(),Fa.now()),mA(n,w)&&(s=s.insert(v,w))}),s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dde{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,n){return Rn.resolve(this.dr.get(n))}saveBundleMetadata(e,n){return this.dr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Sd(i.createTime)}}(n)),Rn.resolve()}getNamedQuery(e,n){return Rn.resolve(this.Ar.get(n))}saveNamedQuery(e,n){return this.Ar.set(n.name,function(i){return{name:i.name,query:tde(i.bundledQuery),readTime:Sd(i.readTime)}}(n)),Rn.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fde{constructor(){this.overlays=new Ba(ni.comparator),this.Rr=new Map}getOverlay(e,n){return Rn.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Vg();return Rn.forEach(n,i=>this.getOverlay(e,i).next(l=>{l!==null&&r.set(i,l)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,l)=>{this.Et(e,n,l)}),Rn.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Rr.get(r);return i!==void 0&&(i.forEach(l=>this.overlays=this.overlays.remove(l)),this.Rr.delete(r)),Rn.resolve()}getOverlaysForCollection(e,n,r){const i=Vg(),l=n.length+1,u=new ni(n.child("")),s=this.overlays.getIteratorFrom(u);for(;s.hasNext();){const v=s.getNext().value,w=v.getKey();if(!n.isPrefixOf(w.path))break;w.path.length===l&&v.largestBatchId>r&&i.set(v.getKey(),v)}return Rn.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let l=new Ba((w,A)=>w-A);const u=this.overlays.getIterator();for(;u.hasNext();){const w=u.getNext().value;if(w.getKey().getCollectionGroup()===n&&w.largestBatchId>r){let A=l.get(w.largestBatchId);A===null&&(A=Vg(),l=l.insert(w.largestBatchId,A)),A.set(w.getKey(),w)}}const s=Vg(),v=l.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((w,A)=>s.set(w,A)),!(s.size()>=i)););return Rn.resolve(s)}Et(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const u=this.Rr.get(i.largestBatchId).delete(r.key);this.Rr.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new Dhe(n,r));let l=this.Rr.get(n);l===void 0&&(l=ds(),this.Rr.set(n,l)),this.Rr.set(n,l.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pde{constructor(){this.sessionToken=Al.EMPTY_BYTE_STRING}getSessionToken(e){return Rn.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Rn.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(){this.Vr=new Xa(nl.mr),this.gr=new Xa(nl.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,n){const r=new nl(e,n);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.wr(new nl(e,n))}Sr(e,n){e.forEach(r=>this.removeReference(r,n))}br(e){const n=new ni(new Ao([])),r=new nl(n,e),i=new nl(n,e+1),l=[];return this.gr.forEachInRange([r,i],u=>{this.wr(u),l.push(u.key)}),l}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const n=new ni(new Ao([])),r=new nl(n,e),i=new nl(n,e+1);let l=ds();return this.gr.forEachInRange([r,i],u=>{l=l.add(u.key)}),l}containsKey(e){const n=new nl(e,0),r=this.Vr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class nl{constructor(e,n){this.key=e,this.Cr=n}static mr(e,n){return ni.comparator(e.key,n.key)||Gi(e.Cr,n.Cr)}static pr(e,n){return Gi(e.Cr,n.Cr)||ni.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mde{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Fr=1,this.Mr=new Xa(nl.mr)}checkEmpty(e){return Rn.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const l=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new Phe(l,n,r,i);this.mutationQueue.push(u);for(const s of i)this.Mr=this.Mr.add(new nl(s.key,l)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return Rn.resolve(u)}lookupMutationBatch(e,n){return Rn.resolve(this.Or(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.Nr(r),l=i<0?0:i;return Rn.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return Rn.resolve(this.mutationQueue.length===0?xL:this.Fr-1)}getAllMutationBatches(e){return Rn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new nl(n,0),i=new nl(n,Number.POSITIVE_INFINITY),l=[];return this.Mr.forEachInRange([r,i],u=>{const s=this.Or(u.Cr);l.push(s)}),Rn.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Xa(Gi);return n.forEach(i=>{const l=new nl(i,0),u=new nl(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([l,u],s=>{r=r.add(s.Cr)})}),Rn.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let l=r;ni.isDocumentKey(l)||(l=l.child(""));const u=new nl(new ni(l),0);let s=new Xa(Gi);return this.Mr.forEachWhile(v=>{const w=v.key.path;return!!r.isPrefixOf(w)&&(w.length===i&&(s=s.add(v.Cr)),!0)},u),Rn.resolve(this.Br(s))}Br(e){const n=[];return e.forEach(r=>{const i=this.Or(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Ws(this.Lr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return Rn.forEach(n.mutations,i=>{const l=new nl(i.key,n.batchId);return r=r.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Mr=r})}qn(e){}containsKey(e,n){const r=new nl(n,0),i=this.Mr.firstAfterOrEqual(r);return Rn.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Rn.resolve()}Lr(e,n){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const n=this.Nr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gde{constructor(e){this.kr=e,this.docs=function(){return new Ba(ni.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),l=i?i.size:0,u=this.kr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:u}),this.size+=u-l,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return Rn.resolve(r?r.document.mutableCopy():Kl.newInvalidDocument(n))}getEntries(e,n){let r=Mf();return n.forEach(i=>{const l=this.docs.get(i);r=r.insert(i,l?l.document.mutableCopy():Kl.newInvalidDocument(i))}),Rn.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let l=Mf();const u=n.path,s=new ni(u.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(s);for(;v.hasNext();){const{key:w,value:{document:A}}=v.getNext();if(!u.isPrefixOf(w.path))break;w.path.length>u.length+1||$ue(Wue(A),r)<=0||(i.has(A.key)||mA(n,A))&&(l=l.insert(A.key,A.mutableCopy()))}return Rn.resolve(l)}getAllFromCollectionGroup(e,n,r,i){Ei()}qr(e,n){return Rn.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new _de(this)}getSize(e){return Rn.resolve(this.size)}}class _de extends cde{constructor(e){super(),this.Ir=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Ir.addEntry(e,i)):this.Ir.removeEntry(r)}),Rn.waitFor(n)}getFromCache(e,n){return this.Ir.getEntry(e,n)}getAllFromCache(e,n){return this.Ir.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yde{constructor(e){this.persistence=e,this.Qr=new T_(n=>wL(n),EL),this.lastRemoteSnapshotVersion=Ri.min(),this.highestTargetId=0,this.$r=0,this.Ur=new RL,this.targetCount=0,this.Kr=Gy.Un()}forEachTarget(e,n){return this.Qr.forEach((r,i)=>n(i)),Rn.resolve()}getLastRemoteSnapshotVersion(e){return Rn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Rn.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Rn.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.$r&&(this.$r=n),Rn.resolve()}zn(e){this.Qr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Kr=new Gy(n),this.highestTargetId=n),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,n){return this.zn(n),this.targetCount+=1,Rn.resolve()}updateTargetData(e,n){return this.zn(n),Rn.resolve()}removeTargetData(e,n){return this.Qr.delete(n.target),this.Ur.br(n.targetId),this.targetCount-=1,Rn.resolve()}removeTargets(e,n,r){let i=0;const l=[];return this.Qr.forEach((u,s)=>{s.sequenceNumber<=n&&r.get(s.targetId)===null&&(this.Qr.delete(u),l.push(this.removeMatchingKeysForTargetId(e,s.targetId)),i++)}),Rn.waitFor(l).next(()=>i)}getTargetCount(e){return Rn.resolve(this.targetCount)}getTargetData(e,n){const r=this.Qr.get(n)||null;return Rn.resolve(r)}addMatchingKeys(e,n,r){return this.Ur.yr(n,r),Rn.resolve()}removeMatchingKeys(e,n,r){this.Ur.Sr(n,r);const i=this.persistence.referenceDelegate,l=[];return i&&n.forEach(u=>{l.push(i.markPotentiallyOrphaned(e,u))}),Rn.waitFor(l)}removeMatchingKeysForTargetId(e,n){return this.Ur.br(n),Rn.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Ur.vr(n);return Rn.resolve(r)}containsKey(e,n){return Rn.resolve(this.Ur.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dY{constructor(e,n){this.Wr={},this.overlays={},this.Gr=new hA(0),this.zr=!1,this.zr=!0,this.jr=new pde,this.referenceDelegate=e(this),this.Hr=new yde(this),this.indexManager=new nde,this.remoteDocumentCache=function(i){return new gde(i)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new ede(n),this.Yr=new dde(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new fde,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Wr[e.toKey()];return r||(r=new mde(n,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,n,r){wr("MemoryPersistence","Starting transaction:",e);const i=new xde(this.Gr.next());return this.referenceDelegate.Zr(),r(i).next(l=>this.referenceDelegate.Xr(i).next(()=>l)).toPromise().then(l=>(i.raiseOnCommittedEvent(),l))}ei(e,n){return Rn.or(Object.values(this.Wr).map(r=>()=>r.containsKey(e,n)))}}class xde extends Gue{constructor(e){super(),this.currentSequenceNumber=e}}class ML{constructor(e){this.persistence=e,this.ti=new RL,this.ni=null}static ri(e){return new ML(e)}get ii(){if(this.ni)return this.ni;throw Ei()}addReference(e,n,r){return this.ti.addReference(r,n),this.ii.delete(r.toString()),Rn.resolve()}removeReference(e,n,r){return this.ti.removeReference(r,n),this.ii.add(r.toString()),Rn.resolve()}markPotentiallyOrphaned(e,n){return this.ii.add(n.toString()),Rn.resolve()}removeTarget(e,n){this.ti.br(n.targetId).forEach(i=>this.ii.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(l=>this.ii.add(l.toString()))}).next(()=>r.removeTargetData(e,n))}Zr(){this.ni=new Set}Xr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Rn.forEach(this.ii,r=>{const i=ni.fromPath(r);return this.si(e,i).next(l=>{l||n.removeEntry(i,Ri.min())})}).next(()=>(this.ni=null,n.apply(e)))}updateLimboDocument(e,n){return this.si(e,n).next(r=>{r?this.ii.delete(n.toString()):this.ii.add(n.toString())})}Jr(e){return 0}si(e,n){return Rn.or([()=>Rn.resolve(this.ti.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.ei(e,n)])}}class HC{constructor(e,n){this.persistence=e,this.oi=new T_(r=>Kue(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=lde(this,n)}static ri(e,n){return new HC(e,n)}Zr(){}Xr(e){return Rn.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}nr(e){const n=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}sr(e){let n=0;return this.rr(e,r=>{n++}).next(()=>n)}rr(e,n){return Rn.forEach(this.oi,(r,i)=>this.ar(e,r,i).next(l=>l?Rn.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),l=i.newChangeBuffer();return i.qr(e,u=>this.ar(e,u,n).next(s=>{s||(r++,l.removeEntry(u,Ri.min()))})).next(()=>l.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.oi.set(n,e.currentSequenceNumber),Rn.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.oi.set(r,e.currentSequenceNumber),Rn.resolve()}removeReference(e,n,r){return this.oi.set(r,e.currentSequenceNumber),Rn.resolve()}updateLimboDocument(e,n){return this.oi.set(n,e.currentSequenceNumber),Rn.resolve()}Jr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=OT(e.data.value)),n}ar(e,n,r){return Rn.or([()=>this.persistence.ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.oi.get(n);return Rn.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PL{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Hi=r,this.Ji=i}static Yi(e,n){let r=ds(),i=ds();for(const l of n.docChanges)switch(l.type){case 0:r=r.add(l.doc.key);break;case 1:i=i.add(l.doc.key)}return new PL(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vde{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bde{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return fce()?8:Yue(nc())>0?6:4}()}initialize(e,n){this.ns=e,this.indexManager=n,this.Zi=!0}getDocumentsMatchingQuery(e,n,r,i){const l={result:null};return this.rs(e,n).next(u=>{l.result=u}).next(()=>{if(!l.result)return this.ss(e,n,i,r).next(u=>{l.result=u})}).next(()=>{if(l.result)return;const u=new vde;return this._s(e,n,u).next(s=>{if(l.result=s,this.Xi)return this.us(e,n,u,s.size)})}).next(()=>l.result)}us(e,n,r,i){return r.documentReadCount<this.es?(q0()<=ss.DEBUG&&wr("QueryEngine","SDK will not create cache indexes for query:",G0(n),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Rn.resolve()):(q0()<=ss.DEBUG&&wr("QueryEngine","Query:",G0(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ts*i?(q0()<=ss.DEBUG&&wr("QueryEngine","The SDK decides to create cache indexes for query:",G0(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ed(n))):Rn.resolve())}rs(e,n){if(Zj(n))return Rn.resolve(null);let r=Ed(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=Ok(n,null,"F"),r=Ed(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(l=>{const u=ds(...l);return this.ns.getDocuments(e,u).next(s=>this.indexManager.getMinOffset(e,r).next(v=>{const w=this.cs(n,s);return this.ls(n,w,u,v.readTime)?this.rs(e,Ok(n,null,"F")):this.hs(e,w,n,v)}))})))}ss(e,n,r,i){return Zj(n)||i.isEqual(Ri.min())?Rn.resolve(null):this.ns.getDocuments(e,r).next(l=>{const u=this.cs(n,l);return this.ls(n,u,r,i)?Rn.resolve(null):(q0()<=ss.DEBUG&&wr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),G0(n)),this.hs(e,u,n,Hue(i,fw)).next(s=>s))})}cs(e,n){let r=new Xa(HG(e));return n.forEach((i,l)=>{mA(e,l)&&(r=r.add(l))}),r}ls(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const l=e.limitType==="F"?n.last():n.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(i)>0)}_s(e,n,r){return q0()<=ss.DEBUG&&wr("QueryEngine","Using full collection scan to execute query:",G0(n)),this.ns.getDocumentsMatchingQuery(e,n,_m.min(),r)}hs(e,n,r,i){return this.ns.getDocumentsMatchingQuery(e,r,i).next(l=>(n.forEach(u=>{l=l.insert(u.key,u)}),l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DL="LocalStore",wde=3e8;class Ede{constructor(e,n,r,i){this.persistence=e,this.Ps=n,this.serializer=i,this.Ts=new Ba(Gi),this.Is=new T_(l=>wL(l),EL),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hde(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ts))}}function Sde(t,e,n,r){return new Ede(t,e,n,r)}async function fY(t,e){const n=ki(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(l=>(i=l,n.As(e),n.mutationQueue.getAllMutationBatches(r))).next(l=>{const u=[],s=[];let v=ds();for(const w of i){u.push(w.batchId);for(const A of w.mutations)v=v.add(A.key)}for(const w of l){s.push(w.batchId);for(const A of w.mutations)v=v.add(A.key)}return n.localDocuments.getDocuments(r,v).next(w=>({Rs:w,removedBatchIds:u,addedBatchIds:s}))})})}function Tde(t,e){const n=ki(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),l=n.ds.newChangeBuffer({trackRemovals:!0});return function(s,v,w,A){const F=w.batch,W=F.keys();let K=Rn.resolve();return W.forEach(Q=>{K=K.next(()=>A.getEntry(v,Q)).next(Z=>{const oe=w.docVersions.get(Q);Ws(oe!==null),Z.version.compareTo(oe)<0&&(F.applyToRemoteDocument(Z,w),Z.isValidDocument()&&(Z.setReadTime(w.commitVersion),A.addEntry(Z)))})}),K.next(()=>s.mutationQueue.removeMutationBatch(v,F))}(n,r,e,l).next(()=>l.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(s){let v=ds();for(let w=0;w<s.mutationResults.length;++w)s.mutationResults[w].transformResults.length>0&&(v=v.add(s.batch.mutations[w].key));return v}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function pY(t){const e=ki(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Hr.getLastRemoteSnapshotVersion(n))}function Cde(t,e){const n=ki(t),r=e.snapshotVersion;let i=n.Ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",l=>{const u=n.ds.newChangeBuffer({trackRemovals:!0});i=n.Ts;const s=[];e.targetChanges.forEach((A,F)=>{const W=i.get(F);if(!W)return;s.push(n.Hr.removeMatchingKeys(l,A.removedDocuments,F).next(()=>n.Hr.addMatchingKeys(l,A.addedDocuments,F)));let K=W.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(F)!==null?K=K.withResumeToken(Al.EMPTY_BYTE_STRING,Ri.min()).withLastLimboFreeSnapshotVersion(Ri.min()):A.resumeToken.approximateByteSize()>0&&(K=K.withResumeToken(A.resumeToken,r)),i=i.insert(F,K),function(Z,oe,ae){return Z.resumeToken.approximateByteSize()===0||oe.snapshotVersion.toMicroseconds()-Z.snapshotVersion.toMicroseconds()>=wde?!0:ae.addedDocuments.size+ae.modifiedDocuments.size+ae.removedDocuments.size>0}(W,K,A)&&s.push(n.Hr.updateTargetData(l,K))});let v=Mf(),w=ds();if(e.documentUpdates.forEach(A=>{e.resolvedLimboDocuments.has(A)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(l,A))}),s.push(Ide(l,u,e.documentUpdates).next(A=>{v=A.Vs,w=A.fs})),!r.isEqual(Ri.min())){const A=n.Hr.getLastRemoteSnapshotVersion(l).next(F=>n.Hr.setTargetsMetadata(l,l.currentSequenceNumber,r));s.push(A)}return Rn.waitFor(s).next(()=>u.apply(l)).next(()=>n.localDocuments.getLocalViewOfDocuments(l,v,w)).next(()=>v)}).then(l=>(n.Ts=i,l))}function Ide(t,e,n){let r=ds(),i=ds();return n.forEach(l=>r=r.add(l)),e.getEntries(t,r).next(l=>{let u=Mf();return n.forEach((s,v)=>{const w=l.get(s);v.isFoundDocument()!==w.isFoundDocument()&&(i=i.add(s)),v.isNoDocument()&&v.version.isEqual(Ri.min())?(e.removeEntry(s,v.readTime),u=u.insert(s,v)):!w.isValidDocument()||v.version.compareTo(w.version)>0||v.version.compareTo(w.version)===0&&w.hasPendingWrites?(e.addEntry(v),u=u.insert(s,v)):wr(DL,"Ignoring outdated watch update for ",s,". Current version:",w.version," Watch version:",v.version)}),{Vs:u,fs:i}})}function Ade(t,e){const n=ki(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=xL),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Rde(t,e){const n=ki(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Hr.getTargetData(r,e).next(l=>l?(i=l,Rn.resolve(i)):n.Hr.allocateTargetId(r).next(u=>(i=new Wp(e,u,"TargetPurposeListen",r.currentSequenceNumber),n.Hr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.Ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ts=n.Ts.insert(r.targetId,r),n.Is.set(e,r.targetId)),r})}async function jk(t,e,n){const r=ki(t),i=r.Ts.get(e),l=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",l,u=>r.persistence.referenceDelegate.removeTarget(u,i))}catch(u){if(!vx(u))throw u;wr(DL,`Failed to update sequence numbers for target ${e}: ${u}`)}r.Ts=r.Ts.remove(e),r.Is.delete(i.target)}function uV(t,e,n){const r=ki(t);let i=Ri.min(),l=ds();return r.persistence.runTransaction("Execute query","readwrite",u=>function(v,w,A){const F=ki(v),W=F.Is.get(A);return W!==void 0?Rn.resolve(F.Ts.get(W)):F.Hr.getTargetData(w,A)}(r,u,Ed(e)).next(s=>{if(s)return i=s.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(u,s.targetId).next(v=>{l=v})}).next(()=>r.Ps.getDocumentsMatchingQuery(u,e,n?i:Ri.min(),n?l:ds())).next(s=>(Mde(r,mhe(e),s),{documents:s,gs:l})))}function Mde(t,e,n){let r=t.Es.get(e)||Ri.min();n.forEach((i,l)=>{l.readTime.compareTo(r)>0&&(r=l.readTime)}),t.Es.set(e,r)}class hV{constructor(){this.activeTargetIds=bhe()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pde{constructor(){this.ho=new hV,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,n,r){this.Po[e]=n}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new hV,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dde{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dV="ConnectivityMonitor";class fV{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){wr(dV,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){wr(dV,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let BS=null;function Vk(){return BS===null?BS=function(){return 268435456+Math.round(2147483648*Math.random())}():BS++,"0x"+BS.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bD="RestConnection",kde={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Nde{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=n+"://"+e.host,this.yo=`projects/${r}/databases/${i}`,this.wo=this.databaseId.database===BC?`project_id=${r}`:`project_id=${r}&database_id=${i}`}So(e,n,r,i,l){const u=Vk(),s=this.bo(e,n.toUriEncodedString());wr(bD,`Sending RPC '${e}' ${u}:`,s,r);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,i,l),this.vo(e,s,v,r).then(w=>(wr(bD,`Received RPC '${e}' ${u}: `,w),w),w=>{throw Hy(bD,`RPC '${e}' ${u} failed with error: `,w,"url: ",s,"request:",r),w})}Co(e,n,r,i,l,u){return this.So(e,n,r,i,l)}Do(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+yx}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,l)=>e[l]=i),r&&r.headers.forEach((i,l)=>e[l]=i)}bo(e,n){const r=kde[e];return`${this.po}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ode{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hl="WebChannelConnection";class Lde extends Nde{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,n,r,i){const l=Vk();return new Promise((u,s)=>{const v=new _G;v.setWithCredentials(!0),v.listenOnce(yG.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case NT.NO_ERROR:const A=v.getResponseJson();wr(Hl,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(A)),u(A);break;case NT.TIMEOUT:wr(Hl,`RPC '${e}' ${l} timed out`),s(new Er(An.DEADLINE_EXCEEDED,"Request time out"));break;case NT.HTTP_ERROR:const F=v.getStatus();if(wr(Hl,`RPC '${e}' ${l} failed with status:`,F,"response text:",v.getResponseText()),F>0){let W=v.getResponseJson();Array.isArray(W)&&(W=W[0]);const K=W?.error;if(K&&K.status&&K.message){const Q=function(oe){const ae=oe.toLowerCase().replace(/_/g,"-");return Object.values(An).indexOf(ae)>=0?ae:An.UNKNOWN}(K.status);s(new Er(Q,K.message))}else s(new Er(An.UNKNOWN,"Server responded with status "+v.getStatus()))}else s(new Er(An.UNAVAILABLE,"Connection failed."));break;default:Ei()}}finally{wr(Hl,`RPC '${e}' ${l} completed.`)}});const w=JSON.stringify(i);wr(Hl,`RPC '${e}' ${l} sending request:`,i),v.send(n,"POST",w,r,15)})}Wo(e,n,r){const i=Vk(),l=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=bG(),s=vG(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},w=this.longPollingOptions.timeoutSeconds;w!==void 0&&(v.longPollingTimeout=Math.round(1e3*w)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,n,r),v.encodeInitMessageHeaders=!0;const A=l.join("");wr(Hl,`Creating RPC '${e}' stream ${i}: ${A}`,v);const F=u.createWebChannel(A,v);let W=!1,K=!1;const Q=new Ode({Fo:oe=>{K?wr(Hl,`Not sending because RPC '${e}' stream ${i} is closed:`,oe):(W||(wr(Hl,`Opening RPC '${e}' stream ${i} transport.`),F.open(),W=!0),wr(Hl,`RPC '${e}' stream ${i} sending:`,oe),F.send(oe))},Mo:()=>F.close()}),Z=(oe,ae,me)=>{oe.listen(ae,pe=>{try{me(pe)}catch(_e){setTimeout(()=>{throw _e},0)}})};return Z(F,rb.EventType.OPEN,()=>{K||(wr(Hl,`RPC '${e}' stream ${i} transport opened.`),Q.Qo())}),Z(F,rb.EventType.CLOSE,()=>{K||(K=!0,wr(Hl,`RPC '${e}' stream ${i} transport closed`),Q.Uo())}),Z(F,rb.EventType.ERROR,oe=>{K||(K=!0,Hy(Hl,`RPC '${e}' stream ${i} transport errored:`,oe),Q.Uo(new Er(An.UNAVAILABLE,"The operation could not be completed")))}),Z(F,rb.EventType.MESSAGE,oe=>{var ae;if(!K){const me=oe.data[0];Ws(!!me);const pe=me,_e=pe?.error||((ae=pe[0])===null||ae===void 0?void 0:ae.error);if(_e){wr(Hl,`RPC '${e}' stream ${i} received error:`,_e);const De=_e.status;let Ae=function(ye){const ue=Pa[ye];if(ue!==void 0)return tY(ue)}(De),re=_e.message;Ae===void 0&&(Ae=An.INTERNAL,re="Unknown error status: "+De+" with message "+_e.message),K=!0,Q.Uo(new Er(Ae,re)),F.close()}else wr(Hl,`RPC '${e}' stream ${i} received:`,me),Q.Ko(me)}}),Z(s,xG.STAT_EVENT,oe=>{oe.stat===Ik.PROXY?wr(Hl,`RPC '${e}' stream ${i} detected buffering proxy`):oe.stat===Ik.NOPROXY&&wr(Hl,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{Q.$o()},0),Q}}function wD(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xA(t){return new jhe(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mY{constructor(e,n,r=1e3,i=1.5,l=6e4){this.Ti=e,this.timerId=n,this.Go=r,this.zo=i,this.jo=l,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const n=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),i=Math.max(0,n-r);i>0&&wr("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pV="PersistentStream";class gY{constructor(e,n,r,i,l,u,s,v){this.Ti=e,this.n_=r,this.r_=i,this.connection=l,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=s,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new mY(e,n)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,n){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():n&&n.code===An.RESOURCE_EXHAUSTED?(Rf(n.toString()),Rf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):n&&n.code===An.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(n)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),n=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.i_===n&&this.V_(r,i)},r=>{e(()=>{const i=new Er(An.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(i)})})}V_(e,n){const r=this.R_(this.i_);this.stream=this.f_(e,n),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{r(()=>this.m_(i))}),this.stream.onMessage(i=>{r(()=>++this.__==1?this.g_(i):this.onNext(i))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return wr(pV,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return n=>{this.Ti.enqueueAndForget(()=>this.i_===e?n():(wr(pV,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Fde extends gY{constructor(e,n,r,i,l,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,u),this.serializer=l}f_(e,n){return this.connection.Wo("Listen",e,n)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const n=Hhe(this.serializer,e),r=function(l){if(!("targetChange"in l))return Ri.min();const u=l.targetChange;return u.targetIds&&u.targetIds.length?Ri.min():u.readTime?Sd(u.readTime):Ri.min()}(e);return this.listener.p_(n,r)}y_(e){const n={};n.database=zk(this.serializer),n.addTarget=function(l,u){let s;const v=u.target;if(s=kk(v)?{documents:qhe(l,v)}:{query:Ghe(l,v).ht},s.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){s.resumeToken=iY(l,u.resumeToken);const w=Lk(l,u.expectedCount);w!==null&&(s.expectedCount=w)}else if(u.snapshotVersion.compareTo(Ri.min())>0){s.readTime=UC(l,u.snapshotVersion.toTimestamp());const w=Lk(l,u.expectedCount);w!==null&&(s.expectedCount=w)}return s}(this.serializer,e);const r=Xhe(this.serializer,e);r&&(n.labels=r),this.I_(n)}w_(e){const n={};n.database=zk(this.serializer),n.removeTarget=e,this.I_(n)}}class Bde extends gY{constructor(e,n,r,i,l,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,u),this.serializer=l}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,n){return this.connection.Wo("Write",e,n)}g_(e){return Ws(!!e.streamToken),this.lastStreamToken=e.streamToken,Ws(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){Ws(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const n=$he(e.writeResults,e.commitTime),r=Sd(e.commitTime);return this.listener.v_(r,n)}C_(){const e={};e.database=zk(this.serializer),this.I_(e)}b_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>Whe(this.serializer,r))};this.I_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zde{}class jde extends zde{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new Er(An.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,n,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,u])=>this.connection.So(e,Fk(n,r),i,l,u)).catch(l=>{throw l.name==="FirebaseError"?(l.code===An.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Er(An.UNKNOWN,l.toString())})}Co(e,n,r,i,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,s])=>this.connection.Co(e,Fk(n,r),i,u,s,l)).catch(u=>{throw u.name==="FirebaseError"?(u.code===An.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Er(An.UNKNOWN,u.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Vde{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Rf(n),this.N_=!1):wr("OnlineStateTracker",n)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a_="RemoteStore";class Ude{constructor(e,n,r,i,l){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=l,this.z_.To(u=>{r.enqueueAndForget(async()=>{C_(this)&&(wr(a_,"Restarting streams for network reachability change."),await async function(v){const w=ki(v);w.W_.add(4),await i2(w),w.j_.set("Unknown"),w.W_.delete(4),await vA(w)}(this))})}),this.j_=new Vde(r,i)}}async function vA(t){if(C_(t))for(const e of t.G_)await e(!0)}async function i2(t){for(const e of t.G_)await e(!1)}function _Y(t,e){const n=ki(t);n.K_.has(e.targetId)||(n.K_.set(e.targetId,e),LL(n)?OL(n):wx(n).c_()&&NL(n,e))}function kL(t,e){const n=ki(t),r=wx(n);n.K_.delete(e),r.c_()&&yY(n,e),n.K_.size===0&&(r.c_()?r.P_():C_(n)&&n.j_.set("Unknown"))}function NL(t,e){if(t.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ri.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}wx(t).y_(e)}function yY(t,e){t.H_.Ne(e),wx(t).w_(e)}function OL(t){t.H_=new Lhe({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>t.K_.get(e)||null,it:()=>t.datastore.serializer.databaseId}),wx(t).start(),t.j_.B_()}function LL(t){return C_(t)&&!wx(t).u_()&&t.K_.size>0}function C_(t){return ki(t).W_.size===0}function xY(t){t.H_=void 0}async function Hde(t){t.j_.set("Online")}async function Wde(t){t.K_.forEach((e,n)=>{NL(t,e)})}async function $de(t,e){xY(t),LL(t)?(t.j_.q_(e),OL(t)):t.j_.set("Unknown")}async function qde(t,e,n){if(t.j_.set("Online"),e instanceof rY&&e.state===2&&e.cause)try{await async function(i,l){const u=l.cause;for(const s of l.targetIds)i.K_.has(s)&&(await i.remoteSyncer.rejectListen(s,u),i.K_.delete(s),i.H_.removeTarget(s))}(t,e)}catch(r){wr(a_,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await WC(t,r)}else if(e instanceof BT?t.H_.We(e):e instanceof nY?t.H_.Ze(e):t.H_.je(e),!n.isEqual(Ri.min()))try{const r=await pY(t.localStore);n.compareTo(r)>=0&&await function(l,u){const s=l.H_.ot(u);return s.targetChanges.forEach((v,w)=>{if(v.resumeToken.approximateByteSize()>0){const A=l.K_.get(w);A&&l.K_.set(w,A.withResumeToken(v.resumeToken,u))}}),s.targetMismatches.forEach((v,w)=>{const A=l.K_.get(v);if(!A)return;l.K_.set(v,A.withResumeToken(Al.EMPTY_BYTE_STRING,A.snapshotVersion)),yY(l,v);const F=new Wp(A.target,v,w,A.sequenceNumber);NL(l,F)}),l.remoteSyncer.applyRemoteEvent(s)}(t,n)}catch(r){wr(a_,"Failed to raise snapshot:",r),await WC(t,r)}}async function WC(t,e,n){if(!vx(e))throw e;t.W_.add(1),await i2(t),t.j_.set("Offline"),n||(n=()=>pY(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{wr(a_,"Retrying IndexedDB access"),await n(),t.W_.delete(1),await vA(t)})}function vY(t,e){return e().catch(n=>WC(t,n,e))}async function bA(t){const e=ki(t),n=bm(e);let r=e.U_.length>0?e.U_[e.U_.length-1].batchId:xL;for(;Gde(e);)try{const i=await Ade(e.localStore,r);if(i===null){e.U_.length===0&&n.P_();break}r=i.batchId,Yde(e,i)}catch(i){await WC(e,i)}bY(e)&&wY(e)}function Gde(t){return C_(t)&&t.U_.length<10}function Yde(t,e){t.U_.push(e);const n=bm(t);n.c_()&&n.S_&&n.b_(e.mutations)}function bY(t){return C_(t)&&!bm(t).u_()&&t.U_.length>0}function wY(t){bm(t).start()}async function Xde(t){bm(t).C_()}async function Kde(t){const e=bm(t);for(const n of t.U_)e.b_(n.mutations)}async function Zde(t,e,n){const r=t.U_.shift(),i=CL.from(r,e,n);await vY(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await bA(t)}async function Qde(t,e){e&&bm(t).S_&&await async function(r,i){if(function(u){return Nhe(u)&&u!==An.ABORTED}(i.code)){const l=r.U_.shift();bm(r).h_(),await vY(r,()=>r.remoteSyncer.rejectFailedWrite(l.batchId,i)),await bA(r)}}(t,e),bY(t)&&wY(t)}async function mV(t,e){const n=ki(t);n.asyncQueue.verifyOperationInProgress(),wr(a_,"RemoteStore received new credentials");const r=C_(n);n.W_.add(3),await i2(n),r&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.W_.delete(3),await vA(n)}async function Jde(t,e){const n=ki(t);e?(n.W_.delete(2),await vA(n)):e||(n.W_.add(2),await i2(n),n.j_.set("Unknown"))}function wx(t){return t.J_||(t.J_=function(n,r,i){const l=ki(n);return l.M_(),new Fde(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)}(t.datastore,t.asyncQueue,{xo:Hde.bind(null,t),No:Wde.bind(null,t),Lo:$de.bind(null,t),p_:qde.bind(null,t)}),t.G_.push(async e=>{e?(t.J_.h_(),LL(t)?OL(t):t.j_.set("Unknown")):(await t.J_.stop(),xY(t))})),t.J_}function bm(t){return t.Y_||(t.Y_=function(n,r,i){const l=ki(n);return l.M_(),new Bde(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)}(t.datastore,t.asyncQueue,{xo:()=>Promise.resolve(),No:Xde.bind(null,t),Lo:Qde.bind(null,t),D_:Kde.bind(null,t),v_:Zde.bind(null,t)}),t.G_.push(async e=>{e?(t.Y_.h_(),await bA(t)):(await t.Y_.stop(),t.U_.length>0&&(wr(a_,`Stopping write stream with ${t.U_.length} pending writes`),t.U_=[]))})),t.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FL{constructor(e,n,r,i,l){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=l,this.deferred=new _f,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,l){const u=Date.now()+r,s=new FL(e,n,u,i,l);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Er(An.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function BL(t,e){if(Rf("AsyncQueue",`${e}: ${t}`),vx(t))return new Er(An.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{static emptySet(e){return new yy(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||ni.comparator(n.key,r.key):(n,r)=>ni.comparator(n.key,r.key),this.keyedMap=ib(),this.sortedSet=new Ba(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof yy)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,l=r.getNext().key;if(!i.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new yy;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gV{constructor(){this.Z_=new Ba(ni.comparator)}track(e){const n=e.doc.key,r=this.Z_.get(n);r?e.type!==0&&r.type===3?this.Z_=this.Z_.insert(n,e):e.type===3&&r.type!==1?this.Z_=this.Z_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Z_=this.Z_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Z_=this.Z_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Z_=this.Z_.remove(n):e.type===1&&r.type===2?this.Z_=this.Z_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Z_=this.Z_.insert(n,{type:2,doc:e.doc}):Ei():this.Z_=this.Z_.insert(n,e)}X_(){const e=[];return this.Z_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Yy{constructor(e,n,r,i,l,u,s,v,w){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=l,this.fromCache=u,this.syncStateChanged=s,this.excludesMetadataChanges=v,this.hasCachedResults=w}static fromInitialDocuments(e,n,r,i,l){const u=[];return n.forEach(s=>{u.push({type:0,doc:s})}),new Yy(e,n,yy.emptySet(n),u,r,i,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pA(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class efe{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class tfe{constructor(){this.queries=_V(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(n,r){const i=ki(n),l=i.queries;i.queries=_V(),l.forEach((u,s)=>{for(const v of s.ta)v.onError(r)})})(this,new Er(An.ABORTED,"Firestore shutting down"))}}function _V(){return new T_(t=>UG(t),pA)}async function EY(t,e){const n=ki(t);let r=3;const i=e.query;let l=n.queries.get(i);l?!l.na()&&e.ra()&&(r=2):(l=new efe,r=e.ra()?0:1);try{switch(r){case 0:l.ea=await n.onListen(i,!0);break;case 1:l.ea=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(u){const s=BL(u,`Initialization of query '${G0(e.query)}' failed`);return void e.onError(s)}n.queries.set(i,l),l.ta.push(e),e.sa(n.onlineState),l.ea&&e.oa(l.ea)&&zL(n)}async function SY(t,e){const n=ki(t),r=e.query;let i=3;const l=n.queries.get(r);if(l){const u=l.ta.indexOf(e);u>=0&&(l.ta.splice(u,1),l.ta.length===0?i=e.ra()?0:1:!l.na()&&e.ra()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function nfe(t,e){const n=ki(t);let r=!1;for(const i of e){const l=i.query,u=n.queries.get(l);if(u){for(const s of u.ta)s.oa(i)&&(r=!0);u.ea=i}}r&&zL(n)}function rfe(t,e,n){const r=ki(t),i=r.queries.get(e);if(i)for(const l of i.ta)l.onError(n);r.queries.delete(e)}function zL(t){t.ia.forEach(e=>{e.next()})}var Uk,yV;(yV=Uk||(Uk={}))._a="default",yV.Cache="cache";class TY{constructor(e,n,r){this.query=e,this.aa=n,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Yy(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.ua?this.la(e)&&(this.aa.next(e),n=!0):this.ha(e,this.onlineState)&&(this.Pa(e),n=!0),this.ca=e,n}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let n=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),n=!0),n}ha(e,n){if(!e.fromCache||!this.ra())return!0;const r=n!=="Offline";return(!this.options.Ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}la(e){if(e.docChanges.length>0)return!0;const n=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Pa(e){e=Yy.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==Uk.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CY{constructor(e){this.key=e}}class IY{constructor(e){this.key=e}}class ife{constructor(e,n){this.query=e,this.fa=n,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=ds(),this.mutatedKeys=ds(),this.ya=HG(e),this.wa=new yy(this.ya)}get Sa(){return this.fa}ba(e,n){const r=n?n.Da:new gV,i=n?n.wa:this.wa;let l=n?n.mutatedKeys:this.mutatedKeys,u=i,s=!1;const v=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,w=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((A,F)=>{const W=i.get(A),K=mA(this.query,F)?F:null,Q=!!W&&this.mutatedKeys.has(W.key),Z=!!K&&(K.hasLocalMutations||this.mutatedKeys.has(K.key)&&K.hasCommittedMutations);let oe=!1;W&&K?W.data.isEqual(K.data)?Q!==Z&&(r.track({type:3,doc:K}),oe=!0):this.va(W,K)||(r.track({type:2,doc:K}),oe=!0,(v&&this.ya(K,v)>0||w&&this.ya(K,w)<0)&&(s=!0)):!W&&K?(r.track({type:0,doc:K}),oe=!0):W&&!K&&(r.track({type:1,doc:W}),oe=!0,(v||w)&&(s=!0)),oe&&(K?(u=u.add(K),l=Z?l.add(A):l.delete(A)):(u=u.delete(A),l=l.delete(A)))}),this.query.limit!==null)for(;u.size>this.query.limit;){const A=this.query.limitType==="F"?u.last():u.first();u=u.delete(A.key),l=l.delete(A.key),r.track({type:1,doc:A})}return{wa:u,Da:r,ls:s,mutatedKeys:l}}va(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const l=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const u=e.Da.X_();u.sort((A,F)=>function(K,Q){const Z=oe=>{switch(oe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ei()}};return Z(K)-Z(Q)}(A.type,F.type)||this.ya(A.doc,F.doc)),this.Ca(r),i=i!=null&&i;const s=n&&!i?this.Fa():[],v=this.pa.size===0&&this.current&&!i?1:0,w=v!==this.ga;return this.ga=v,u.length!==0||w?{snapshot:new Yy(this.query,e.wa,l,u,e.mutatedKeys,v===0,w,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:s}:{Ma:s}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new gV,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(n=>this.fa=this.fa.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.fa=this.fa.delete(n)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=ds(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const n=[];return e.forEach(r=>{this.pa.has(r)||n.push(new IY(r))}),this.pa.forEach(r=>{e.has(r)||n.push(new CY(r))}),n}Oa(e){this.fa=e.gs,this.pa=ds();const n=this.ba(e.documents);return this.applyChanges(n,!0)}Na(){return Yy.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const jL="SyncEngine";class sfe{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class ofe{constructor(e){this.key=e,this.Ba=!1}}class afe{constructor(e,n,r,i,l,u){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=l,this.maxConcurrentLimboResolutions=u,this.La={},this.ka=new T_(s=>UG(s),pA),this.qa=new Map,this.Qa=new Set,this.$a=new Ba(ni.comparator),this.Ua=new Map,this.Ka=new RL,this.Wa={},this.Ga=new Map,this.za=Gy.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function lfe(t,e,n=!0){const r=kY(t);let i;const l=r.ka.get(e);return l?(r.sharedClientState.addLocalQueryTarget(l.targetId),i=l.view.Na()):i=await AY(r,e,n,!0),i}async function cfe(t,e){const n=kY(t);await AY(n,e,!0,!1)}async function AY(t,e,n,r){const i=await Rde(t.localStore,Ed(e)),l=i.targetId,u=t.sharedClientState.addLocalQueryTarget(l,n);let s;return r&&(s=await ufe(t,e,l,u==="current",i.resumeToken)),t.isPrimaryClient&&n&&_Y(t.remoteStore,i),s}async function ufe(t,e,n,r,i){t.Ha=(F,W,K)=>async function(Z,oe,ae,me){let pe=oe.view.ba(ae);pe.ls&&(pe=await uV(Z.localStore,oe.query,!1).then(({documents:re})=>oe.view.ba(re,pe)));const _e=me&&me.targetChanges.get(oe.targetId),De=me&&me.targetMismatches.get(oe.targetId)!=null,Ae=oe.view.applyChanges(pe,Z.isPrimaryClient,_e,De);return vV(Z,oe.targetId,Ae.Ma),Ae.snapshot}(t,F,W,K);const l=await uV(t.localStore,e,!0),u=new ife(e,l.gs),s=u.ba(l.documents),v=r2.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),w=u.applyChanges(s,t.isPrimaryClient,v);vV(t,n,w.Ma);const A=new sfe(e,n,u);return t.ka.set(e,A),t.qa.has(n)?t.qa.get(n).push(e):t.qa.set(n,[e]),w.snapshot}async function hfe(t,e,n){const r=ki(t),i=r.ka.get(e),l=r.qa.get(i.targetId);if(l.length>1)return r.qa.set(i.targetId,l.filter(u=>!pA(u,e))),void r.ka.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await jk(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&kL(r.remoteStore,i.targetId),Hk(r,i.targetId)}).catch(xx)):(Hk(r,i.targetId),await jk(r.localStore,i.targetId,!0))}async function dfe(t,e){const n=ki(t),r=n.ka.get(e),i=n.qa.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),kL(n.remoteStore,r.targetId))}async function ffe(t,e,n){const r=vfe(t);try{const i=await function(u,s){const v=ki(u),w=Fa.now(),A=s.reduce((K,Q)=>K.add(Q.key),ds());let F,W;return v.persistence.runTransaction("Locally write mutations","readwrite",K=>{let Q=Mf(),Z=ds();return v.ds.getEntries(K,A).next(oe=>{Q=oe,Q.forEach((ae,me)=>{me.isValidDocument()||(Z=Z.add(ae))})}).next(()=>v.localDocuments.getOverlayedDocuments(K,Q)).next(oe=>{F=oe;const ae=[];for(const me of s){const pe=Rhe(me,F.get(me.key).overlayedDocument);pe!=null&&ae.push(new Lm(me.key,pe,NG(pe.value.mapValue),Dh.exists(!0)))}return v.mutationQueue.addMutationBatch(K,w,ae,s)}).next(oe=>{W=oe;const ae=oe.applyToLocalDocumentSet(F,Z);return v.documentOverlayCache.saveOverlays(K,oe.batchId,ae)})}).then(()=>({batchId:W.batchId,changes:$G(F)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(u,s,v){let w=u.Wa[u.currentUser.toKey()];w||(w=new Ba(Gi)),w=w.insert(s,v),u.Wa[u.currentUser.toKey()]=w}(r,i.batchId,n),await s2(r,i.changes),await bA(r.remoteStore)}catch(i){const l=BL(i,"Failed to persist write");n.reject(l)}}async function RY(t,e){const n=ki(t);try{const r=await Cde(n.localStore,e);e.targetChanges.forEach((i,l)=>{const u=n.Ua.get(l);u&&(Ws(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?u.Ba=!0:i.modifiedDocuments.size>0?Ws(u.Ba):i.removedDocuments.size>0&&(Ws(u.Ba),u.Ba=!1))}),await s2(n,r,e)}catch(r){await xx(r)}}function xV(t,e,n){const r=ki(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.ka.forEach((l,u)=>{const s=u.view.sa(e);s.snapshot&&i.push(s.snapshot)}),function(u,s){const v=ki(u);v.onlineState=s;let w=!1;v.queries.forEach((A,F)=>{for(const W of F.ta)W.sa(s)&&(w=!0)}),w&&zL(v)}(r.eventManager,e),i.length&&r.La.p_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function pfe(t,e,n){const r=ki(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Ua.get(e),l=i&&i.key;if(l){let u=new Ba(ni.comparator);u=u.insert(l,Kl.newNoDocument(l,Ri.min()));const s=ds().add(l),v=new yA(Ri.min(),new Map,new Ba(Gi),u,s);await RY(r,v),r.$a=r.$a.remove(l),r.Ua.delete(e),VL(r)}else await jk(r.localStore,e,!1).then(()=>Hk(r,e,n)).catch(xx)}async function mfe(t,e){const n=ki(t),r=e.batch.batchId;try{const i=await Tde(n.localStore,e);PY(n,r,null),MY(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await s2(n,i)}catch(i){await xx(i)}}async function gfe(t,e,n){const r=ki(t);try{const i=await function(u,s){const v=ki(u);return v.persistence.runTransaction("Reject batch","readwrite-primary",w=>{let A;return v.mutationQueue.lookupMutationBatch(w,s).next(F=>(Ws(F!==null),A=F.keys(),v.mutationQueue.removeMutationBatch(w,F))).next(()=>v.mutationQueue.performConsistencyCheck(w)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(w,A,s)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(w,A)).next(()=>v.localDocuments.getDocuments(w,A))})}(r.localStore,e);PY(r,e,n),MY(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await s2(r,i)}catch(i){await xx(i)}}function MY(t,e){(t.Ga.get(e)||[]).forEach(n=>{n.resolve()}),t.Ga.delete(e)}function PY(t,e,n){const r=ki(t);let i=r.Wa[r.currentUser.toKey()];if(i){const l=i.get(e);l&&(n?l.reject(n):l.resolve(),i=i.remove(e)),r.Wa[r.currentUser.toKey()]=i}}function Hk(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.qa.get(e))t.ka.delete(r),n&&t.La.Ja(r,n);t.qa.delete(e),t.isPrimaryClient&&t.Ka.br(e).forEach(r=>{t.Ka.containsKey(r)||DY(t,r)})}function DY(t,e){t.Qa.delete(e.path.canonicalString());const n=t.$a.get(e);n!==null&&(kL(t.remoteStore,n),t.$a=t.$a.remove(e),t.Ua.delete(n),VL(t))}function vV(t,e,n){for(const r of n)r instanceof CY?(t.Ka.addReference(r.key,e),_fe(t,r)):r instanceof IY?(wr(jL,"Document no longer in limbo: "+r.key),t.Ka.removeReference(r.key,e),t.Ka.containsKey(r.key)||DY(t,r.key)):Ei()}function _fe(t,e){const n=e.key,r=n.path.canonicalString();t.$a.get(n)||t.Qa.has(r)||(wr(jL,"New document in limbo: "+n),t.Qa.add(r),VL(t))}function VL(t){for(;t.Qa.size>0&&t.$a.size<t.maxConcurrentLimboResolutions;){const e=t.Qa.values().next().value;t.Qa.delete(e);const n=new ni(Ao.fromString(e)),r=t.za.next();t.Ua.set(r,new ofe(n)),t.$a=t.$a.insert(n,r),_Y(t.remoteStore,new Wp(Ed(SL(n.path)),r,"TargetPurposeLimboResolution",hA.ae))}}async function s2(t,e,n){const r=ki(t),i=[],l=[],u=[];r.ka.isEmpty()||(r.ka.forEach((s,v)=>{u.push(r.Ha(v,e,n).then(w=>{var A;if((w||n)&&r.isPrimaryClient){const F=w?!w.fromCache:(A=n?.targetChanges.get(v.targetId))===null||A===void 0?void 0:A.current;r.sharedClientState.updateQueryState(v.targetId,F?"current":"not-current")}if(w){i.push(w);const F=PL.Yi(v.targetId,w);l.push(F)}}))}),await Promise.all(u),r.La.p_(i),await async function(v,w){const A=ki(v);try{await A.persistence.runTransaction("notifyLocalViewChanges","readwrite",F=>Rn.forEach(w,W=>Rn.forEach(W.Hi,K=>A.persistence.referenceDelegate.addReference(F,W.targetId,K)).next(()=>Rn.forEach(W.Ji,K=>A.persistence.referenceDelegate.removeReference(F,W.targetId,K)))))}catch(F){if(!vx(F))throw F;wr(DL,"Failed to update sequence numbers: "+F)}for(const F of w){const W=F.targetId;if(!F.fromCache){const K=A.Ts.get(W),Q=K.snapshotVersion,Z=K.withLastLimboFreeSnapshotVersion(Q);A.Ts=A.Ts.insert(W,Z)}}}(r.localStore,l))}async function yfe(t,e){const n=ki(t);if(!n.currentUser.isEqual(e)){wr(jL,"User change. New user:",e.toKey());const r=await fY(n.localStore,e);n.currentUser=e,function(l,u){l.Ga.forEach(s=>{s.forEach(v=>{v.reject(new Er(An.CANCELLED,u))})}),l.Ga.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await s2(n,r.Rs)}}function xfe(t,e){const n=ki(t),r=n.Ua.get(e);if(r&&r.Ba)return ds().add(r.key);{let i=ds();const l=n.qa.get(e);if(!l)return i;for(const u of l){const s=n.ka.get(u);i=i.unionWith(s.view.Sa)}return i}}function kY(t){const e=ki(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=RY.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xfe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=pfe.bind(null,e),e.La.p_=nfe.bind(null,e.eventManager),e.La.Ja=rfe.bind(null,e.eventManager),e}function vfe(t){const e=ki(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=mfe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=gfe.bind(null,e),e}class $C{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=xA(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,n){return null}nu(e,n){return null}eu(e){return Sde(this.persistence,new bde,e.initialUser,this.serializer)}Xa(e){return new dY(ML.ri,this.serializer)}Za(e){return new Pde}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}$C.provider={build:()=>new $C};class bfe extends $C{constructor(e){super(),this.cacheSizeBytes=e}tu(e,n){Ws(this.persistence.referenceDelegate instanceof HC);const r=this.persistence.referenceDelegate.garbageCollector;return new ode(r,e.asyncQueue,n)}Xa(e){const n=this.cacheSizeBytes!==void 0?Oc.withCacheSize(this.cacheSizeBytes):Oc.DEFAULT;return new dY(r=>HC.ri(r,n),this.serializer)}}class Wk{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>xV(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=yfe.bind(null,this.syncEngine),await Jde(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new tfe}()}createDatastore(e){const n=xA(e.databaseInfo.databaseId),r=function(l){return new Lde(l)}(e.databaseInfo);return function(l,u,s,v){return new jde(l,u,s,v)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,l,u,s){return new Ude(r,i,l,u,s)}(this.localStore,this.datastore,e.asyncQueue,n=>xV(this.syncEngine,n,0),function(){return fV.D()?new fV:new Dde}())}createSyncEngine(e,n){return function(i,l,u,s,v,w,A){const F=new afe(i,l,u,s,v,w);return A&&(F.ja=!0),F}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const l=ki(i);wr(a_,"RemoteStore shutting down."),l.W_.add(5),await i2(l),l.z_.shutdown(),l.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Wk.provider={build:()=>new Wk};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NY{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Rf("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wm="FirestoreClient";class wfe{constructor(e,n,r,i,l){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Yl.UNAUTHENTICATED,this.clientId=SG.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(r,async u=>{wr(wm,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u}),this.appCheckCredentials.start(r,u=>(wr(wm,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new _f;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=BL(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function ED(t,e){t.asyncQueue.verifyOperationInProgress(),wr(wm,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await fY(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function bV(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Efe(t);wr(wm,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>mV(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>mV(e.remoteStore,i)),t._onlineComponents=e}async function Efe(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){wr(wm,"Using user provided OfflineComponentProvider");try{await ED(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===An.FAILED_PRECONDITION||i.code===An.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;Hy("Error using user provided cache. Falling back to memory cache: "+n),await ED(t,new $C)}}else wr(wm,"Using default OfflineComponentProvider"),await ED(t,new bfe(void 0));return t._offlineComponents}async function OY(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(wr(wm,"Using user provided OnlineComponentProvider"),await bV(t,t._uninitializedComponentsProvider._online)):(wr(wm,"Using default OnlineComponentProvider"),await bV(t,new Wk))),t._onlineComponents}function Sfe(t){return OY(t).then(e=>e.syncEngine)}async function LY(t){const e=await OY(t),n=e.eventManager;return n.onListen=lfe.bind(null,e.syncEngine),n.onUnlisten=hfe.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=cfe.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=dfe.bind(null,e.syncEngine),n}function Tfe(t,e,n={}){const r=new _f;return t.asyncQueue.enqueueAndForget(async()=>function(l,u,s,v,w){const A=new NY({next:W=>{A.su(),u.enqueueAndForget(()=>SY(l,F));const K=W.docs.has(s);!K&&W.fromCache?w.reject(new Er(An.UNAVAILABLE,"Failed to get document because the client is offline.")):K&&W.fromCache&&v&&v.source==="server"?w.reject(new Er(An.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):w.resolve(W)},error:W=>w.reject(W)}),F=new TY(SL(s.path),A,{includeMetadataChanges:!0,Ta:!0});return EY(l,F)}(await LY(t),t.asyncQueue,e,n,r)),r.promise}function Cfe(t,e,n={}){const r=new _f;return t.asyncQueue.enqueueAndForget(async()=>function(l,u,s,v,w){const A=new NY({next:W=>{A.su(),u.enqueueAndForget(()=>SY(l,F)),W.fromCache&&v.source==="server"?w.reject(new Er(An.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):w.resolve(W)},error:W=>w.reject(W)}),F=new TY(s,A,{includeMetadataChanges:!0,Ta:!0});return EY(l,F)}(await LY(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FY(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wV=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BY(t,e,n){if(!n)throw new Er(An.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Ife(t,e,n,r){if(e===!0&&r===!0)throw new Er(An.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function EV(t){if(!ni.isDocumentKey(t))throw new Er(An.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function SV(t){if(ni.isDocumentKey(t))throw new Er(An.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function wA(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ei()}function Dd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Er(An.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=wA(t);throw new Er(An.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zY="firestore.googleapis.com",TV=!0;class CV{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Er(An.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=zY,this.ssl=TV}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:TV;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=hY;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ide)throw new Er(An.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ife("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=FY((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(l){if(l.timeoutSeconds!==void 0){if(isNaN(l.timeoutSeconds))throw new Er(An.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (must not be NaN)`);if(l.timeoutSeconds<5)throw new Er(An.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (minimum allowed value is 5)`);if(l.timeoutSeconds>30)throw new Er(An.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class EA{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new CV({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Er(An.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Er(An.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new CV(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Nue;switch(r.type){case"firstParty":return new Bue(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Er(An.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=wV.get(n);r&&(wr("ComponentProvider","Removing Datastore"),wV.delete(n),r.terminate())}(this),Promise.resolve()}}function Afe(t,e,n,r={}){var i;const l=(t=Dd(t,EA))._getSettings(),u=Object.assign(Object.assign({},l),{emulatorOptions:t._getEmulatorOptions()}),s=`${e}:${n}`;l.host!==zY&&l.host!==s&&Hy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},l),{host:s,ssl:!1,emulatorOptions:r});if(!mm(v,u)&&(t._setSettings(v),r.mockUserToken)){let w,A;if(typeof r.mockUserToken=="string")w=r.mockUserToken,A=Yl.MOCK_USER;else{w=cG(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const F=r.mockUserToken.sub||r.mockUserToken.user_id;if(!F)throw new Er(An.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");A=new Yl(F)}t._authCredentials=new Oue(new wG(w,A))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let o2=class jY{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new jY(this.firestore,e,this._query)}};class yc{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yc(this.firestore,e,this._key)}}class lm extends o2{constructor(e,n,r){super(e,n,SL(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yc(this.firestore,null,new ni(e))}withConverter(e){return new lm(this.firestore,e,this._path)}}function Td(t,e,...n){if(t=no(t),BY("collection","path",e),t instanceof EA){const r=Ao.fromString(e,...n);return SV(r),new lm(t,null,r)}{if(!(t instanceof yc||t instanceof lm))throw new Er(An.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ao.fromString(e,...n));return SV(r),new lm(t.firestore,null,r)}}function yf(t,e,...n){if(t=no(t),arguments.length===1&&(e=SG.newId()),BY("doc","path",e),t instanceof EA){const r=Ao.fromString(e,...n);return EV(r),new yc(t,null,new ni(r))}{if(!(t instanceof yc||t instanceof lm))throw new Er(An.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ao.fromString(e,...n));return EV(r),new yc(t.firestore,t instanceof lm?t.converter:null,new ni(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IV="AsyncQueue";class AV{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new mY(this,"async_queue_retry"),this.Su=()=>{const r=wD();r&&wr(IV,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.bu=e;const n=wD();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const n=wD();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const n=new _f;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!vx(e))throw e;wr(IV,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const n=this.bu.then(()=>(this.pu=!0,e().catch(r=>{this.gu=r,this.pu=!1;const i=function(u){let s=u.message||"";return u.stack&&(s=u.stack.includes(u.message)?u.stack:u.message+`
`+u.stack),s}(r);throw Rf("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.pu=!1,r))));return this.bu=n,n}enqueueAfterDelay(e,n,r){this.Du(),this.wu.indexOf(e)>-1&&(n=0);const i=FL.createAndSchedule(this,e,n,r,l=>this.Fu(l));return this.fu.push(i),i}Du(){this.gu&&Ei()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const n of this.fu)if(n.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.fu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const n=this.fu.indexOf(e);this.fu.splice(n,1)}}class Ex extends EA{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new AV,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new AV(e),this._firestoreClient=void 0,await e}}}function VY(t,e){const n=typeof t=="object"?t:t2(),r=typeof t=="string"?t:BC,i=e2(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const l=pL("firestore");l&&Afe(i,...l)}return i}function UL(t){if(t._terminated)throw new Er(An.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Rfe(t),t._firestoreClient}function Rfe(t){var e,n,r;const i=t._freezeSettings(),l=function(s,v,w,A){return new Jue(s,v,w,A.host,A.ssl,A.experimentalForceLongPolling,A.experimentalAutoDetectLongPolling,FY(A.experimentalLongPollingOptions),A.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new wfe(t._authCredentials,t._appCheckCredentials,t._queue,l,t._componentsProvider&&function(s){const v=s?._online.build();return{_offline:s?._offline.build(v),_online:v}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xy(Al.fromBase64String(e))}catch(n){throw new Er(An.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Xy(Al.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Er(An.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HL{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Er(An.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Er(An.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Gi(this._lat,e._lat)||Gi(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WL{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let l=0;l<r.length;++l)if(r[l]!==i[l])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mfe=/^__.*__$/;class Pfe{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Lm(e,this.data,this.fieldMask,n,this.fieldTransforms):new n2(e,this.data,n,this.fieldTransforms)}}class UY{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Lm(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function HY(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ei()}}class $L{constructor(e,n,r,i,l,u){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,l===void 0&&this.Bu(),this.fieldTransforms=l||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new $L(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ku({path:r,Qu:!1});return i.$u(e),i}Uu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ku({path:r,Qu:!1});return i.Bu(),i}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return qC(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(HY(this.Lu)&&Mfe.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class Dfe{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||xA(e)}ju(e,n,r,i=!1){return new $L({Lu:e,methodName:n,zu:r,path:wl.emptyPath(),Qu:!1,Gu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function CA(t){const e=t._freezeSettings(),n=xA(t._databaseId);return new Dfe(t._databaseId,!!e.ignoreUndefinedProperties,n)}function WY(t,e,n,r,i,l={}){const u=t.ju(l.merge||l.mergeFields?2:0,e,n,i);GL("Data must be an object, but it was:",u,r);const s=$Y(r,u);let v,w;if(l.merge)v=new du(u.fieldMask),w=u.fieldTransforms;else if(l.mergeFields){const A=[];for(const F of l.mergeFields){const W=$k(e,F,n);if(!u.contains(W))throw new Er(An.INVALID_ARGUMENT,`Field '${W}' is specified in your field mask but missing from your input data.`);GY(A,W)||A.push(W)}v=new du(A),w=u.fieldTransforms.filter(F=>v.covers(F.field))}else v=null,w=u.fieldTransforms;return new Pfe(new zc(s),v,w)}class IA extends TA{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof IA}}class qL extends TA{_toFieldTransform(e){return new The(e.path,new yw)}isEqual(e){return e instanceof qL}}function kfe(t,e,n,r){const i=t.ju(1,e,n);GL("Data must be an object, but it was:",i,r);const l=[],u=zc.empty();Om(r,(v,w)=>{const A=YL(e,v,n);w=no(w);const F=i.Uu(A);if(w instanceof IA)l.push(A);else{const W=a2(w,F);W!=null&&(l.push(A),u.set(A,W))}});const s=new du(l);return new UY(u,s,i.fieldTransforms)}function Nfe(t,e,n,r,i,l){const u=t.ju(1,e,n),s=[$k(e,r,n)],v=[i];if(l.length%2!=0)throw new Er(An.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let W=0;W<l.length;W+=2)s.push($k(e,l[W])),v.push(l[W+1]);const w=[],A=zc.empty();for(let W=s.length-1;W>=0;--W)if(!GY(w,s[W])){const K=s[W];let Q=v[W];Q=no(Q);const Z=u.Uu(K);if(Q instanceof IA)w.push(K);else{const oe=a2(Q,Z);oe!=null&&(w.push(K),A.set(K,oe))}}const F=new du(w);return new UY(A,F,u.fieldTransforms)}function Ofe(t,e,n,r=!1){return a2(n,t.ju(r?4:3,e))}function a2(t,e){if(qY(t=no(t)))return GL("Unsupported field value:",e,t),$Y(t,e);if(t instanceof TA)return function(r,i){if(!HY(i.Lu))throw i.Wu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Wu(`${r._methodName}() is not currently supported inside arrays`);const l=r._toFieldTransform(i);l&&i.fieldTransforms.push(l)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(r,i){const l=[];let u=0;for(const s of r){let v=a2(s,i.Ku(u));v==null&&(v={nullValue:"NULL_VALUE"}),l.push(v),u++}return{arrayValue:{values:l}}}(t,e)}return function(r,i){if((r=no(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return whe(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const l=Fa.fromDate(r);return{timestampValue:UC(i.serializer,l)}}if(r instanceof Fa){const l=new Fa(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:UC(i.serializer,l)}}if(r instanceof HL)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xy)return{bytesValue:iY(i.serializer,r._byteString)};if(r instanceof yc){const l=i.databaseId,u=r.firestore._databaseId;if(!u.isEqual(l))throw i.Wu(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:AL(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof WL)return function(u,s){return{mapValue:{fields:{[DG]:{stringValue:kG},[zC]:{arrayValue:{values:u.toArray().map(w=>{if(typeof w!="number")throw s.Wu("VectorValues must only contain numeric values.");return TL(s.serializer,w)})}}}}}}(r,i);throw i.Wu(`Unsupported field value: ${wA(r)}`)}(t,e)}function $Y(t,e){const n={};return CG(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Om(t,(r,i)=>{const l=a2(i,e.qu(r));l!=null&&(n[r]=l)}),{mapValue:{fields:n}}}function qY(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Fa||t instanceof HL||t instanceof Xy||t instanceof yc||t instanceof TA||t instanceof WL)}function GL(t,e,n){if(!qY(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const r=wA(n);throw r==="an object"?e.Wu(t+" a custom object"):e.Wu(t+" "+r)}}function $k(t,e,n){if((e=no(e))instanceof SA)return e._internalPath;if(typeof e=="string")return YL(t,e);throw qC("Field path arguments must be of type string or ",t,!1,void 0,n)}const Lfe=new RegExp("[~\\*/\\[\\]]");function YL(t,e,n){if(e.search(Lfe)>=0)throw qC(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new SA(...e.split("."))._internalPath}catch{throw qC(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function qC(t,e,n,r,i){const l=r&&!r.isEmpty(),u=i!==void 0;let s=`Function ${e}() called with invalid data`;n&&(s+=" (via `toFirestore()`)"),s+=". ";let v="";return(l||u)&&(v+=" (found",l&&(v+=` in field ${r}`),u&&(v+=` in document ${i}`),v+=")"),new Er(An.INVALID_ARGUMENT,s+t+v)}function GY(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YY{constructor(e,n,r,i,l){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new yc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ffe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(AA("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Ffe extends YY{data(){return super.data()}}function AA(t,e){return typeof e=="string"?YL(t,e):e instanceof SA?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bfe(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Er(An.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class XL{}class XY extends XL{}function Ky(t,e,...n){let r=[];e instanceof XL&&r.push(e),r=r.concat(n),function(l){const u=l.filter(v=>v instanceof KL).length,s=l.filter(v=>v instanceof RA).length;if(u>1||u>0&&s>0)throw new Er(An.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class RA extends XY{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new RA(e,n,r)}_apply(e){const n=this._parse(e);return ZY(e._query,n),new o2(e.firestore,e.converter,Nk(e._query,n))}_parse(e){const n=CA(e.firestore);return function(l,u,s,v,w,A,F){let W;if(w.isKeyField()){if(A==="array-contains"||A==="array-contains-any")throw new Er(An.INVALID_ARGUMENT,`Invalid Query. You can't perform '${A}' queries on documentId().`);if(A==="in"||A==="not-in"){MV(F,A);const Q=[];for(const Z of F)Q.push(RV(v,l,Z));W={arrayValue:{values:Q}}}else W=RV(v,l,F)}else A!=="in"&&A!=="not-in"&&A!=="array-contains-any"||MV(F,A),W=Ofe(s,u,F,A==="in"||A==="not-in");return Oa.create(w,A,W)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function GC(t,e,n){const r=e,i=AA("where",t);return RA._create(i,r,n)}class KL extends XL{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new KL(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Lh.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,l){let u=i;const s=l.getFlattenedFilters();for(const v of s)ZY(u,v),u=Nk(u,v)}(e._query,n),new o2(e.firestore,e.converter,Nk(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ZL extends XY{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new ZL(e,n)}_apply(e){const n=function(i,l,u){if(i.startAt!==null)throw new Er(An.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new Er(An.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _w(l,u)}(e._query,this._field,this._direction);return new o2(e.firestore,e.converter,function(i,l){const u=i.explicitOrderBy.concat([l]);return new bx(i.path,i.collectionGroup,u,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}}function KY(t,e="asc"){const n=e,r=AA("orderBy",t);return ZL._create(r,n)}function RV(t,e,n){if(typeof(n=no(n))=="string"){if(n==="")throw new Er(An.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!VG(e)&&n.indexOf("/")!==-1)throw new Er(An.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ao.fromString(n));if(!ni.isDocumentKey(r))throw new Er(An.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return $j(t,new ni(r))}if(n instanceof yc)return $j(t,n._key);throw new Er(An.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${wA(n)}.`)}function MV(t,e){if(!Array.isArray(t)||t.length===0)throw new Er(An.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ZY(t,e){const n=function(i,l){for(const u of i)for(const s of u.getFlattenedFilters())if(l.indexOf(s.op)>=0)return s.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Er(An.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Er(An.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class zfe{convertValue(e,n="none"){switch(vm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return da(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(xm(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ei()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Om(e,(i,l)=>{r[i]=this.convertValue(l,n)}),r}convertVectorValue(e){var n,r,i;const l=(i=(r=(n=e.fields)===null||n===void 0?void 0:n[zC].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(u=>da(u.doubleValue));return new WL(l)}convertGeoPoint(e){return new HL(da(e.latitude),da(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=fA(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(pw(e));default:return null}}convertTimestamp(e){const n=ym(e);return new Fa(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ao.fromString(e);Ws(uY(r));const i=new mw(r.get(1),r.get(3)),l=new ni(r.popFirst(5));return i.isEqual(n)||Rf(`Document ${l} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QY(t,e,n){let r;return r=t?t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class JY extends YY{constructor(e,n,r,i,l,u){super(e,n,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new zT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(AA("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class zT extends JY{data(e={}){return super.data(e)}}class jfe{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new ob(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new zT(this._firestore,this._userDataWriter,r.key,r,new ob(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Er(An.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,l){if(i._snapshot.oldDocs.isEmpty()){let u=0;return i._snapshot.docChanges.map(s=>{const v=new zT(i._firestore,i._userDataWriter,s.doc.key,s.doc,new ob(i._snapshot.mutatedKeys.has(s.doc.key),i._snapshot.fromCache),i.query.converter);return s.doc,{type:"added",doc:v,oldIndex:-1,newIndex:u++}})}{let u=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(s=>l||s.type!==3).map(s=>{const v=new zT(i._firestore,i._userDataWriter,s.doc.key,s.doc,new ob(i._snapshot.mutatedKeys.has(s.doc.key),i._snapshot.fromCache),i.query.converter);let w=-1,A=-1;return s.type!==0&&(w=u.indexOf(s.doc.key),u=u.delete(s.doc.key)),s.type!==1&&(u=u.add(s.doc),A=u.indexOf(s.doc.key)),{type:Vfe(s.type),doc:v,oldIndex:w,newIndex:A}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Vfe(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ei()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(t){t=Dd(t,yc);const e=Dd(t.firestore,Ex);return Tfe(UL(e),t._key).then(n=>Hfe(e,t,n))}class eX extends zfe{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xy(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new yc(this.firestore,null,n)}}function xf(t){t=Dd(t,o2);const e=Dd(t.firestore,Ex),n=UL(e),r=new eX(e);return Bfe(t._query),Cfe(n,t._query).then(i=>new jfe(e,r,t,i))}function Ufe(t,e,n){t=Dd(t,yc);const r=Dd(t.firestore,Ex),i=QY(t.converter,e);return QL(r,[WY(CA(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,Dh.none())])}function YC(t,e,n,...r){t=Dd(t,yc);const i=Dd(t.firestore,Ex),l=CA(i);let u;return u=typeof(e=no(e))=="string"||e instanceof SA?Nfe(l,"updateDoc",t._key,e,n,r):kfe(l,"updateDoc",t._key,e),QL(i,[u.toMutation(t._key,Dh.exists(!0))])}function tX(t,e){const n=Dd(t.firestore,Ex),r=yf(t),i=QY(t.converter,e);return QL(n,[WY(CA(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,Dh.exists(!1))]).then(()=>r)}function QL(t,e){return function(r,i){const l=new _f;return r.asyncQueue.enqueueAndForget(async()=>ffe(await Sfe(r),i,l)),l.promise}(UL(t),e)}function Hfe(t,e,n){const r=n.docs.get(e._key),i=new eX(t);return new JY(t,i,e._key,r,new ob(n.hasPendingWrites,n.fromCache),e.converter)}function bw(){return new qL("serverTimestamp")}(function(e,n=!0){(function(i){yx=i})(S_),gm(new If("firestore",(r,{instanceIdentifier:i,options:l})=>{const u=r.getProvider("app").getImmediate(),s=new Ex(new Lue(r.getProvider("auth-internal")),new zue(u,r.getProvider("app-check-internal")),function(w,A){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new Er(An.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mw(w.options.projectId,A)}(u,i),u);return l=Object.assign({useFetchStreams:n},l),s._setSettings(l),s},"PUBLIC").setMultipleInstances(!0)),$u(kj,Nj,e),$u(kj,Nj,"esm2017")})();var Wfe="firebase",$fe="11.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$u(Wfe,$fe,"app");var xd=function(){return xd=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},xd.apply(this,arguments)};function l2(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function qfe(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,l;r<i;r++)(l||!(r in e))&&(l||(l=Array.prototype.slice.call(e,0,r)),l[r]=e[r]);return t.concat(l||Array.prototype.slice.call(e))}function nX(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Gfe=nX,rX=new Jw("auth","Firebase",nX());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC=new uA("@firebase/auth");function Yfe(t,...e){XC.logLevel<=ss.WARN&&XC.warn(`Auth (${S_}): ${t}`,...e)}function jT(t,...e){XC.logLevel<=ss.ERROR&&XC.error(`Auth (${S_}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fh(t,...e){throw JL(t,...e)}function Cd(t,...e){return JL(t,...e)}function iX(t,e,n){const r=Object.assign(Object.assign({},Gfe()),{[e]:n});return new Jw("auth","Firebase",r).create(e,{appName:t.name})}function vf(t){return iX(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function JL(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return rX.create(t,...e)}function _i(t,e,...n){if(!t)throw JL(e,...n)}function df(t){const e="INTERNAL ASSERTION FAILED: "+t;throw jT(e),new Error(e)}function Pf(t,e){t||df(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gk(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Xfe(){return PV()==="http:"||PV()==="https:"}function PV(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kfe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Xfe()||uce()||"connection"in navigator)?navigator.onLine:!0}function Zfe(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c2{constructor(e,n){this.shortDelay=e,this.longDelay=n,Pf(n>e,"Short delay should be less than long delay!"),this.isMobile=mL()||uG()}get(){return Kfe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e4(t,e){Pf(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sX{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;df("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;df("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;df("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qfe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jfe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],epe=new c2(3e4,6e4);function Fm(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Vf(t,e,n,r,i={}){return oX(t,i,async()=>{let l={},u={};r&&(e==="GET"?u=r:l={body:JSON.stringify(r)});const s=_x(Object.assign({key:t.config.apiKey},u)).slice(1),v=await t._getAdditionalHeaders();v["Content-Type"]="application/json",t.languageCode&&(v["X-Firebase-Locale"]=t.languageCode);const w=Object.assign({method:e,headers:v},l);return cce()||(w.referrerPolicy="no-referrer"),sX.fetch()(await aX(t,t.config.apiHost,n,s),w)})}async function oX(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},Qfe),e);try{const i=new npe(t),l=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const u=await l.json();if("needConfirmation"in u)throw zS(t,"account-exists-with-different-credential",u);if(l.ok&&!("errorMessage"in u))return u;{const s=l.ok?u.errorMessage:u.error.message,[v,w]=s.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw zS(t,"credential-already-in-use",u);if(v==="EMAIL_EXISTS")throw zS(t,"email-already-in-use",u);if(v==="USER_DISABLED")throw zS(t,"user-disabled",u);const A=r[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(w)throw iX(t,A,w);Fh(t,A)}}catch(i){if(i instanceof Nd)throw i;Fh(t,"network-request-failed",{message:String(i)})}}async function u2(t,e,n,r,i={}){const l=await Vf(t,e,n,r,i);return"mfaPendingCredential"in l&&Fh(t,"multi-factor-auth-required",{_serverResponse:l}),l}async function aX(t,e,n,r){const i=`${e}${n}?${r}`,l=t,u=l.config.emulator?e4(t.config,i):`${t.config.apiScheme}://${i}`;return Jfe.includes(n)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(u).toString():u}function tpe(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class npe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Cd(this.auth,"network-request-failed")),epe.get())})}}function zS(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Cd(t,e,r);return i.customData._tokenResponse=n,i}function DV(t){return t!==void 0&&t.enterprise!==void 0}class rpe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return tpe(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ipe(t,e){return Vf(t,"GET","/v2/recaptchaConfig",Fm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function spe(t,e){return Vf(t,"POST","/v1/accounts:delete",e)}async function KC(t,e){return Vf(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pb(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ope(t,e=!1){const n=no(t),r=await n.getIdToken(e),i=t4(r);_i(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const l=typeof i.firebase=="object"?i.firebase:void 0,u=l?.sign_in_provider;return{claims:i,token:r,authTime:Pb(SD(i.auth_time)),issuedAtTime:Pb(SD(i.iat)),expirationTime:Pb(SD(i.exp)),signInProvider:u||null,signInSecondFactor:l?.sign_in_second_factor||null}}function SD(t){return Number(t)*1e3}function t4(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return jT("JWT malformed, contained fewer than 3 sections"),null;try{const i=NC(n);return i?JSON.parse(i):(jT("Failed to decode base64 JWT payload"),null)}catch(i){return jT("Caught error parsing JWT payload as JSON",i?.toString()),null}}function kV(t){const e=t4(t);return _i(e,"internal-error"),_i(typeof e.exp<"u","internal-error"),_i(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zy(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Nd&&ape(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function ape({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lpe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pb(this.lastLoginAt),this.creationTime=Pb(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZC(t){var e;const n=t.auth,r=await t.getIdToken(),i=await Zy(t,KC(n,{idToken:r}));_i(i?.users.length,n,"internal-error");const l=i.users[0];t._notifyReloadListener(l);const u=!((e=l.providerUserInfo)===null||e===void 0)&&e.length?lX(l.providerUserInfo):[],s=upe(t.providerData,u),v=t.isAnonymous,w=!(t.email&&l.passwordHash)&&!s?.length,A=v?w:!1,F={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:s,metadata:new Yk(l.createdAt,l.lastLoginAt),isAnonymous:A};Object.assign(t,F)}async function cpe(t){const e=no(t);await ZC(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function upe(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function lX(t){return t.map(e=>{var{providerId:n}=e,r=l2(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hpe(t,e){const n=await oX(t,{},async()=>{const r=_x({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:l}=t.config,u=await aX(t,i,"/v1/token",`key=${l}`),s=await t._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",sX.fetch()(u,{method:"POST",headers:s,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function dpe(t,e){return Vf(t,"POST","/v2/accounts:revokeToken",Fm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_i(e.idToken,"internal-error"),_i(typeof e.idToken<"u","internal-error"),_i(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):kV(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){_i(e.length!==0,"internal-error");const n=kV(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(_i(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:l}=await hpe(e,n);this.updateTokensAndExpiration(r,i,Number(l))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:l}=n,u=new xy;return r&&(_i(typeof r=="string","internal-error",{appName:e}),u.refreshToken=r),i&&(_i(typeof i=="string","internal-error",{appName:e}),u.accessToken=i),l&&(_i(typeof l=="number","internal-error",{appName:e}),u.expirationTime=l),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xy,this.toJSON())}_performRefresh(){return df("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ip(t,e){_i(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Ch{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,l=l2(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new lpe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=l.displayName||null,this.email=l.email||null,this.emailVerified=l.emailVerified||!1,this.phoneNumber=l.phoneNumber||null,this.photoURL=l.photoURL||null,this.isAnonymous=l.isAnonymous||!1,this.tenantId=l.tenantId||null,this.providerData=l.providerData?[...l.providerData]:[],this.metadata=new Yk(l.createdAt||void 0,l.lastLoginAt||void 0)}async getIdToken(e){const n=await Zy(this,this.stsTokenManager.getToken(this.auth,e));return _i(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return ope(this,e)}reload(){return cpe(this)}_assign(e){this!==e&&(_i(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Ch(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){_i(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await ZC(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Bc(this.auth.app))return Promise.reject(vf(this.auth));const e=await this.getIdToken();return await Zy(this,spe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,l,u,s,v,w,A;const F=(r=n.displayName)!==null&&r!==void 0?r:void 0,W=(i=n.email)!==null&&i!==void 0?i:void 0,K=(l=n.phoneNumber)!==null&&l!==void 0?l:void 0,Q=(u=n.photoURL)!==null&&u!==void 0?u:void 0,Z=(s=n.tenantId)!==null&&s!==void 0?s:void 0,oe=(v=n._redirectEventId)!==null&&v!==void 0?v:void 0,ae=(w=n.createdAt)!==null&&w!==void 0?w:void 0,me=(A=n.lastLoginAt)!==null&&A!==void 0?A:void 0,{uid:pe,emailVerified:_e,isAnonymous:De,providerData:Ae,stsTokenManager:re}=n;_i(pe&&re,e,"internal-error");const fe=xy.fromJSON(this.name,re);_i(typeof pe=="string",e,"internal-error"),Ip(F,e.name),Ip(W,e.name),_i(typeof _e=="boolean",e,"internal-error"),_i(typeof De=="boolean",e,"internal-error"),Ip(K,e.name),Ip(Q,e.name),Ip(Z,e.name),Ip(oe,e.name),Ip(ae,e.name),Ip(me,e.name);const ye=new Ch({uid:pe,auth:e,email:W,emailVerified:_e,displayName:F,isAnonymous:De,photoURL:Q,phoneNumber:K,tenantId:Z,stsTokenManager:fe,createdAt:ae,lastLoginAt:me});return Ae&&Array.isArray(Ae)&&(ye.providerData=Ae.map(ue=>Object.assign({},ue))),oe&&(ye._redirectEventId=oe),ye}static async _fromIdTokenResponse(e,n,r=!1){const i=new xy;i.updateFromServerResponse(n);const l=new Ch({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await ZC(l),l}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];_i(i.localId!==void 0,"internal-error");const l=i.providerUserInfo!==void 0?lX(i.providerUserInfo):[],u=!(i.email&&i.passwordHash)&&!l?.length,s=new xy;s.updateFromIdToken(r);const v=new Ch({uid:i.localId,auth:e,stsTokenManager:s,isAnonymous:u}),w={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Yk(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!l?.length};return Object.assign(v,w),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NV=new Map;function ff(t){Pf(t instanceof Function,"Expected a class definition");let e=NV.get(t);return e?(Pf(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,NV.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cX{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}cX.type="NONE";const OV=cX;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VT(t,e,n){return`firebase:${t}:${e}:${n}`}class vy{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:l}=this.auth;this.fullUserKey=VT(this.userKey,i.apiKey,l),this.fullPersistenceKey=VT("persistence",i.apiKey,l),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await KC(this.auth,{idToken:e}).catch(()=>{});return n?Ch._fromGetAccountInfoResponse(this.auth,n,e):null}return Ch._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new vy(ff(OV),e,r);const i=(await Promise.all(n.map(async w=>{if(await w._isAvailable())return w}))).filter(w=>w);let l=i[0]||ff(OV);const u=VT(r,e.config.apiKey,e.name);let s=null;for(const w of n)try{const A=await w._get(u);if(A){let F;if(typeof A=="string"){const W=await KC(e,{idToken:A}).catch(()=>{});if(!W)break;F=await Ch._fromGetAccountInfoResponse(e,W,A)}else F=Ch._fromJSON(e,A);w!==l&&(s=F),l=w;break}}catch{}const v=i.filter(w=>w._shouldAllowMigration);return!l._shouldAllowMigration||!v.length?new vy(l,e,r):(l=v[0],s&&await l._set(u,s.toJSON()),await Promise.all(n.map(async w=>{if(w!==l)try{await w._remove(u)}catch{}})),new vy(l,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LV(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fX(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(uX(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(mX(e))return"Blackberry";if(gX(e))return"Webos";if(hX(e))return"Safari";if((e.includes("chrome/")||dX(e))&&!e.includes("edge/"))return"Chrome";if(pX(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function uX(t=nc()){return/firefox\//i.test(t)}function hX(t=nc()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function dX(t=nc()){return/crios\//i.test(t)}function fX(t=nc()){return/iemobile/i.test(t)}function pX(t=nc()){return/android/i.test(t)}function mX(t=nc()){return/blackberry/i.test(t)}function gX(t=nc()){return/webos/i.test(t)}function n4(t=nc()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function fpe(t=nc()){var e;return n4(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ppe(){return hce()&&document.documentMode===10}function _X(t=nc()){return n4(t)||pX(t)||gX(t)||mX(t)||/windows phone/i.test(t)||fX(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yX(t,e=[]){let n;switch(t){case"Browser":n=LV(nc());break;case"Worker":n=`${LV(nc())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${S_}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mpe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=l=>new Promise((u,s)=>{try{const v=e(l);u(v)}catch(v){s(v)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gpe(t,e={}){return Vf(t,"GET","/v2/passwordPolicy",Fm(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _pe=6;class ype{constructor(e){var n,r,i,l;const u=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=u.minPasswordLength)!==null&&n!==void 0?n:_pe,u.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=u.maxPasswordLength),u.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=u.containsLowercaseCharacter),u.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=u.containsUppercaseCharacter),u.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=u.containsNumericCharacter),u.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=u.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(l=e.forceUpgradeOnSignin)!==null&&l!==void 0?l:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,i,l,u,s;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,v),this.validatePasswordCharacterOptions(e,v),v.isValid&&(v.isValid=(n=v.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),v.isValid&&(v.isValid=(r=v.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),v.isValid&&(v.isValid=(i=v.containsLowercaseLetter)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(l=v.containsUppercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(u=v.containsNumericCharacter)!==null&&u!==void 0?u:!0),v.isValid&&(v.isValid=(s=v.containsNonAlphanumericCharacter)!==null&&s!==void 0?s:!0),v}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xpe{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new FV(this),this.idTokenSubscription=new FV(this),this.beforeStateQueue=new mpe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rX,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ff(n)),this._initializationPromise=this.queue(async()=>{var r,i,l;if(!this._deleted&&(this.persistenceManager=await vy.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await KC(this,{idToken:e}),r=await Ch._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Bc(this.app)){const u=this.app.settings.authIdToken;return u?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(u).then(s,s))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,l=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const u=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,s=i?._redirectEventId,v=await this.tryRedirectSignIn(e);(!u||u===s)&&v?.user&&(i=v.user,l=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(l)try{await this.beforeStateQueue.runMiddleware(i)}catch(u){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(u))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return _i(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await ZC(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Zfe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Bc(this.app))return Promise.reject(vf(this));const n=e?no(e):null;return n&&_i(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&_i(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Bc(this.app)?Promise.reject(vf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Bc(this.app)?Promise.reject(vf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ff(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await gpe(this),n=new ype(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Jw("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await dpe(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ff(e)||this._popupRedirectResolver;_i(n,this,"argument-error"),this.redirectPersistenceManager=await vy.create(this,[ff(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const l=typeof n=="function"?n:n.next.bind(n);let u=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(_i(s,this,"internal-error"),s.then(()=>{u||l(this.currentUser)}),typeof n=="function"){const v=e.addObserver(n,r,i);return()=>{u=!0,v()}}else{const v=e.addObserver(n);return()=>{u=!0,v()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _i(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yX(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;if(Bc(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n?.error&&Yfe(`Error while retrieving App Check token: ${n.error}`),n?.token}}function I_(t){return no(t)}class FV{constructor(e){this.auth=e,this.observer=null,this.addObserver=wce(n=>this.observer=n)}get next(){return _i(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MA={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function vpe(t){MA=t}function xX(t){return MA.loadJS(t)}function bpe(){return MA.recaptchaEnterpriseScript}function wpe(){return MA.gapiScript}function Epe(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Spe{constructor(){this.enterprise=new Tpe}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Tpe{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Cpe="recaptcha-enterprise",vX="NO_RECAPTCHA";class Ipe{constructor(e){this.type=Cpe,this.auth=I_(e)}async verify(e="verify",n=!1){async function r(l){if(!n){if(l.tenantId==null&&l._agentRecaptchaConfig!=null)return l._agentRecaptchaConfig.siteKey;if(l.tenantId!=null&&l._tenantRecaptchaConfigs[l.tenantId]!==void 0)return l._tenantRecaptchaConfigs[l.tenantId].siteKey}return new Promise(async(u,s)=>{ipe(l,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const w=new rpe(v);return l.tenantId==null?l._agentRecaptchaConfig=w:l._tenantRecaptchaConfigs[l.tenantId]=w,u(w.siteKey)}}).catch(v=>{s(v)})})}function i(l,u,s){const v=window.grecaptcha;DV(v)?v.enterprise.ready(()=>{v.enterprise.execute(l,{action:e}).then(w=>{u(w)}).catch(()=>{u(vX)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Spe().execute("siteKey",{action:"verify"}):new Promise((l,u)=>{r(this.auth).then(s=>{if(!n&&DV(window.grecaptcha))i(s,l,u);else{if(typeof window>"u"){u(new Error("RecaptchaVerifier is only supported in browser"));return}let v=bpe();v.length!==0&&(v+=s),xX(v).then(()=>{i(s,l,u)}).catch(w=>{u(w)})}}).catch(s=>{u(s)})})}}async function BV(t,e,n,r=!1,i=!1){const l=new Ipe(t);let u;if(i)u=vX;else try{u=await l.verify(n)}catch{u=await l.verify(n,!0)}const s=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in s){const v=s.phoneEnrollmentInfo.phoneNumber,w=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:w,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const v=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return r?Object.assign(s,{captchaResp:u}):Object.assign(s,{captchaResponse:u}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function Xk(t,e,n,r,i){var l;if(!((l=t._getRecaptchaConfig())===null||l===void 0)&&l.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const u=await BV(t,e,n,n==="getOobCode");return r(t,u)}else return r(t,e).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await BV(t,e,n,n==="getOobCode");return r(t,s)}else return Promise.reject(u)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ape(t,e){const n=e2(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),l=n.getOptions();if(mm(l,e??{}))return i;Fh(i,"already-initialized")}return n.initialize({options:e})}function Rpe(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(ff);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function Mpe(t,e,n){const r=I_(t);_i(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,l=bX(e),{host:u,port:s}=Ppe(e),v=s===null?"":`:${s}`,w={url:`${l}//${u}${v}/`},A=Object.freeze({host:u,port:s,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){_i(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),_i(mm(w,r.config.emulator)&&mm(A,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=w,r.emulatorConfig=A,r.settings.appVerificationDisabledForTesting=!0,Dpe()}function bX(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Ppe(t){const e=bX(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const l=i[1];return{host:l,port:zV(r.substr(l.length+1))}}else{const[l,u]=r.split(":");return{host:l,port:zV(u)}}}function zV(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Dpe(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return df("not implemented")}_getIdTokenResponse(e){return df("not implemented")}_linkToIdToken(e,n){return df("not implemented")}_getReauthenticationResolver(e){return df("not implemented")}}async function kpe(t,e){return Vf(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Npe(t,e){return u2(t,"POST","/v1/accounts:signInWithPassword",Fm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ope(t,e){return u2(t,"POST","/v1/accounts:signInWithEmailLink",Fm(t,e))}async function Lpe(t,e){return u2(t,"POST","/v1/accounts:signInWithEmailLink",Fm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww extends r4{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new ww(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new ww(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xk(e,n,"signInWithPassword",Npe);case"emailLink":return Ope(e,{email:this._email,oobCode:this._password});default:Fh(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xk(e,r,"signUpPassword",kpe);case"emailLink":return Lpe(e,{idToken:n,email:this._email,oobCode:this._password});default:Fh(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function by(t,e){return u2(t,"POST","/v1/accounts:signInWithIdp",Fm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fpe="http://localhost";class l_ extends r4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new l_(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Fh("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=n,l=l2(n,["providerId","signInMethod"]);if(!r||!i)return null;const u=new l_(r,i);return u.idToken=l.idToken||void 0,u.accessToken=l.accessToken||void 0,u.secret=l.secret,u.nonce=l.nonce,u.pendingToken=l.pendingToken||null,u}_getIdTokenResponse(e){const n=this.buildRequest();return by(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,by(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,by(e,n)}buildRequest(){const e={requestUri:Fpe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=_x(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bpe(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function zpe(t){const e=tb(nb(t)).link,n=e?tb(nb(e)).deep_link_id:null,r=tb(nb(t)).deep_link_id;return(r?tb(nb(r)).link:null)||r||n||e||t}class i4{constructor(e){var n,r,i,l,u,s;const v=tb(nb(e)),w=(n=v.apiKey)!==null&&n!==void 0?n:null,A=(r=v.oobCode)!==null&&r!==void 0?r:null,F=Bpe((i=v.mode)!==null&&i!==void 0?i:null);_i(w&&A&&F,"argument-error"),this.apiKey=w,this.operation=F,this.code=A,this.continueUrl=(l=v.continueUrl)!==null&&l!==void 0?l:null,this.languageCode=(u=v.languageCode)!==null&&u!==void 0?u:null,this.tenantId=(s=v.tenantId)!==null&&s!==void 0?s:null}static parseLink(e){const n=zpe(e);try{return new i4(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(){this.providerId=Sx.PROVIDER_ID}static credential(e,n){return ww._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=i4.parseLink(n);return _i(r,"argument-error"),ww._fromEmailAndCode(e,r.code,r.tenantId)}}Sx.PROVIDER_ID="password";Sx.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Sx.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wX{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h2 extends wX{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp extends h2{constructor(){super("facebook.com")}static credential(e){return l_._fromParams({providerId:Bp.PROVIDER_ID,signInMethod:Bp.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Bp.credentialFromTaggedObject(e)}static credentialFromError(e){return Bp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Bp.credential(e.oauthAccessToken)}catch{return null}}}Bp.FACEBOOK_SIGN_IN_METHOD="facebook.com";Bp.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp extends h2{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return l_._fromParams({providerId:zp.PROVIDER_ID,signInMethod:zp.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return zp.credentialFromTaggedObject(e)}static credentialFromError(e){return zp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return zp.credential(n,r)}catch{return null}}}zp.GOOGLE_SIGN_IN_METHOD="google.com";zp.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp extends h2{constructor(){super("github.com")}static credential(e){return l_._fromParams({providerId:jp.PROVIDER_ID,signInMethod:jp.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jp.credentialFromTaggedObject(e)}static credentialFromError(e){return jp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return jp.credential(e.oauthAccessToken)}catch{return null}}}jp.GITHUB_SIGN_IN_METHOD="github.com";jp.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp extends h2{constructor(){super("twitter.com")}static credential(e,n){return l_._fromParams({providerId:Vp.PROVIDER_ID,signInMethod:Vp.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Vp.credentialFromTaggedObject(e)}static credentialFromError(e){return Vp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Vp.credential(n,r)}catch{return null}}}Vp.TWITTER_SIGN_IN_METHOD="twitter.com";Vp.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jpe(t,e){return u2(t,"POST","/v1/accounts:signUp",Fm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const l=await Ch._fromIdTokenResponse(e,r,i),u=jV(r);return new c_({user:l,providerId:u,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=jV(r);return new c_({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function jV(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC extends Nd{constructor(e,n,r,i){var l;super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,QC.prototype),this.customData={appName:e.name,tenantId:(l=e.tenantId)!==null&&l!==void 0?l:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new QC(e,n,r,i)}}function EX(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?QC._fromErrorAndOperation(t,l,e,r):l})}async function Vpe(t,e,n=!1){const r=await Zy(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return c_._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Upe(t,e,n=!1){const{auth:r}=t;if(Bc(r.app))return Promise.reject(vf(r));const i="reauthenticate";try{const l=await Zy(t,EX(r,i,e,t),n);_i(l.idToken,r,"internal-error");const u=t4(l.idToken);_i(u,r,"internal-error");const{sub:s}=u;return _i(t.uid===s,r,"user-mismatch"),c_._forOperation(t,i,l)}catch(l){throw l?.code==="auth/user-not-found"&&Fh(r,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SX(t,e,n=!1){if(Bc(t.app))return Promise.reject(vf(t));const r="signIn",i=await EX(t,r,e),l=await c_._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(l.user),l}async function Hpe(t,e){return SX(I_(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TX(t){const e=I_(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Wpe(t,e,n){if(Bc(t.app))return Promise.reject(vf(t));const r=I_(t),u=await Xk(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",jpe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&TX(t),v}),s=await c_._fromIdTokenResponse(r,"signIn",u);return await r._updateCurrentUser(s.user),s}function $pe(t,e,n){return Bc(t.app)?Promise.reject(vf(t)):Hpe(no(t),Sx.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&TX(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qpe(t,e){return Vf(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CX(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=no(t),l={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},u=await Zy(r,qpe(r.auth,l));r.displayName=u.displayName||null,r.photoURL=u.photoUrl||null;const s=r.providerData.find(({providerId:v})=>v==="password");s&&(s.displayName=r.displayName,s.photoURL=r.photoURL),await r._updateTokensIfNecessary(u)}function Gpe(t,e,n,r){return no(t).onIdTokenChanged(e,n,r)}function Ype(t,e,n){return no(t).beforeAuthStateChanged(e,n)}function Xpe(t,e,n,r){return no(t).onAuthStateChanged(e,n,r)}function Kpe(t){return no(t).signOut()}const JC="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IX{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(JC,"1"),this.storage.removeItem(JC),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zpe=1e3,Qpe=10;class AX extends IX{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_X(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((u,s,v)=>{this.notifyListeners(u,v)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const u=this.storage.getItem(r);!n&&this.localCache[r]===u||this.notifyListeners(r,u)},l=this.storage.getItem(r);ppe()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Qpe):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Zpe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}AX.type="LOCAL";const Jpe=AX;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RX extends IX{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}RX.type="SESSION";const MX=RX;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eme(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new PA(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:l}=n.data,u=this.handlersMap[i];if(!u?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const s=Array.from(u).map(async w=>w(n.origin,l)),v=await eme(s);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:v})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}PA.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s4(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tme{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let l,u;return new Promise((s,v)=>{const w=s4("",20);i.port1.start();const A=setTimeout(()=>{v(new Error("unsupported_event"))},r);u={messageChannel:i,onMessage(F){const W=F;if(W.data.eventId===w)switch(W.data.status){case"ack":clearTimeout(A),l=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),s(W.data.response);break;default:clearTimeout(A),clearTimeout(l),v(new Error("invalid_response"));break}}},this.handlers.add(u),i.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:w,data:n},[i.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(){return window}function nme(t){Id().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PX(){return typeof Id().WorkerGlobalScope<"u"&&typeof Id().importScripts=="function"}async function rme(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ime(){var t;return((t=navigator?.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function sme(){return PX()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DX="firebaseLocalStorageDb",ome=1,eI="firebaseLocalStorage",kX="fbase_key";class d2{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function DA(t,e){return t.transaction([eI],e?"readwrite":"readonly").objectStore(eI)}function ame(){const t=indexedDB.deleteDatabase(DX);return new d2(t).toPromise()}function Kk(){const t=indexedDB.open(DX,ome);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(eI,{keyPath:kX})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(eI)?e(r):(r.close(),await ame(),e(await Kk()))})})}async function VV(t,e,n){const r=DA(t,!0).put({[kX]:e,value:n});return new d2(r).toPromise()}async function lme(t,e){const n=DA(t,!1).get(e),r=await new d2(n).toPromise();return r===void 0?null:r.value}function UV(t,e){const n=DA(t,!0).delete(e);return new d2(n).toPromise()}const cme=800,ume=3;class NX{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Kk(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>ume)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return PX()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=PA._getInstance(sme()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await rme(),!this.activeServiceWorker)return;this.sender=new tme(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ime()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Kk();return await VV(e,JC,"1"),await UV(e,JC),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>VV(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>lme(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>UV(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const l=DA(i,!1).getAll();return new d2(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:l}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(l)&&(this.notifyListeners(i,l),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),cme)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}NX.type="LOCAL";const hme=NX;new c2(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dme(t,e){return e?ff(e):(_i(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4 extends r4{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return by(e,this._buildIdpRequest())}_linkToIdToken(e,n){return by(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return by(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function fme(t){return SX(t.auth,new o4(t),t.bypassAuthState)}function pme(t){const{auth:e,user:n}=t;return _i(n,e,"internal-error"),Upe(n,new o4(t),t.bypassAuthState)}async function mme(t){const{auth:e,user:n}=t;return _i(n,e,"internal-error"),Vpe(n,new o4(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OX{constructor(e,n,r,i,l=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:l,error:u,type:s}=e;if(u){this.reject(u);return}const v={auth:this.auth,requestUri:n,sessionId:r,tenantId:l||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(v))}catch(w){this.reject(w)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fme;case"linkViaPopup":case"linkViaRedirect":return mme;case"reauthViaPopup":case"reauthViaRedirect":return pme;default:Fh(this.auth,"internal-error")}}resolve(e){Pf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Pf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gme=new c2(2e3,1e4);class cy extends OX{constructor(e,n,r,i,l){super(e,n,i,l),this.provider=r,this.authWindow=null,this.pollId=null,cy.currentPopupAction&&cy.currentPopupAction.cancel(),cy.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _i(e,this.auth,"internal-error"),e}async onExecution(){Pf(this.filter.length===1,"Popup operations only handle one event");const e=s4();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Cd(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Cd(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,cy.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Cd(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,gme.get())};e()}}cy.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _me="pendingRedirect",UT=new Map;class yme extends OX{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=UT.get(this.auth._key());if(!e){try{const r=await xme(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}UT.set(this.auth._key(),e)}return this.bypassAuthState||UT.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function xme(t,e){const n=wme(e),r=bme(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function vme(t,e){UT.set(t._key(),e)}function bme(t){return ff(t._redirectPersistence)}function wme(t){return VT(_me,t.config.apiKey,t.name)}async function Eme(t,e,n=!1){if(Bc(t.app))return Promise.reject(vf(t));const r=I_(t),i=dme(r,e),u=await new yme(r,i,n).execute();return u&&!n&&(delete u.user._redirectEventId,await r._persistUserIfCurrent(u.user),await r._setRedirectUser(null,e)),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sme=10*60*1e3;class Tme{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Cme(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!LX(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Cd(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Sme&&this.cachedEventUids.clear(),this.cachedEventUids.has(HV(e))}saveEventToCache(e){this.cachedEventUids.add(HV(e)),this.lastProcessedEventTime=Date.now()}}function HV(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function LX({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function Cme(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return LX(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ime(t,e={}){return Vf(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ame=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Rme=/^https?/;async function Mme(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Ime(t);for(const n of e)try{if(Pme(n))return}catch{}Fh(t,"unauthorized-domain")}function Pme(t){const e=Gk(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const u=new URL(t);return u.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&u.hostname===r}if(!Rme.test(n))return!1;if(Ame.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dme=new c2(3e4,6e4);function WV(){const t=Id().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function kme(t){return new Promise((e,n)=>{var r,i,l;function u(){WV(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{WV(),n(Cd(t,"network-request-failed"))},timeout:Dme.get()})}if(!((i=(r=Id().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((l=Id().gapi)===null||l===void 0)&&l.load)u();else{const s=Epe("iframefcb");return Id()[s]=()=>{gapi.load?u():n(Cd(t,"network-request-failed"))},xX(`${wpe()}?onload=${s}`).catch(v=>n(v))}}).catch(e=>{throw HT=null,e})}let HT=null;function Nme(t){return HT=HT||kme(t),HT}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ome=new c2(5e3,15e3),Lme="__/auth/iframe",Fme="emulator/auth/iframe",Bme={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},zme=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function jme(t){const e=t.config;_i(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?e4(e,Fme):`https://${t.config.authDomain}/${Lme}`,r={apiKey:e.apiKey,appName:t.name,v:S_},i=zme.get(t.config.apiHost);i&&(r.eid=i);const l=t._getFrameworks();return l.length&&(r.fw=l.join(",")),`${n}?${_x(r).slice(1)}`}async function Vme(t){const e=await Nme(t),n=Id().gapi;return _i(n,t,"internal-error"),e.open({where:document.body,url:jme(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Bme,dontclear:!0},r=>new Promise(async(i,l)=>{await r.restyle({setHideOnLeave:!1});const u=Cd(t,"network-request-failed"),s=Id().setTimeout(()=>{l(u)},Ome.get());function v(){Id().clearTimeout(s),i(r)}r.ping(v).then(v,()=>{l(u)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ume={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Hme=500,Wme=600,$me="_blank",qme="http://localhost";class $V{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Gme(t,e,n,r=Hme,i=Wme){const l=Math.max((window.screen.availHeight-i)/2,0).toString(),u=Math.max((window.screen.availWidth-r)/2,0).toString();let s="";const v=Object.assign(Object.assign({},Ume),{width:r.toString(),height:i.toString(),top:l,left:u}),w=nc().toLowerCase();n&&(s=dX(w)?$me:n),uX(w)&&(e=e||qme,v.scrollbars="yes");const A=Object.entries(v).reduce((W,[K,Q])=>`${W}${K}=${Q},`,"");if(fpe(w)&&s!=="_self")return Yme(e||"",s),new $V(null);const F=window.open(e||"",s,A);_i(F,t,"popup-blocked");try{F.focus()}catch{}return new $V(F)}function Yme(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xme="__/auth/handler",Kme="emulator/auth/handler",Zme=encodeURIComponent("fac");async function qV(t,e,n,r,i,l){_i(t.config.authDomain,t,"auth-domain-config-required"),_i(t.config.apiKey,t,"invalid-api-key");const u={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:S_,eventId:i};if(e instanceof wX){e.setDefaultLanguage(t.languageCode),u.providerId=e.providerId||"",OC(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[A,F]of Object.entries({}))u[A]=F}if(e instanceof h2){const A=e.getScopes().filter(F=>F!=="");A.length>0&&(u.scopes=A.join(","))}t.tenantId&&(u.tid=t.tenantId);const s=u;for(const A of Object.keys(s))s[A]===void 0&&delete s[A];const v=await t._getAppCheckToken(),w=v?`#${Zme}=${encodeURIComponent(v)}`:"";return`${Qme(t)}?${_x(s).slice(1)}${w}`}function Qme({config:t}){return t.emulator?e4(t,Kme):`https://${t.authDomain}/${Xme}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD="webStorageSupport";class Jme{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=MX,this._completeRedirectFn=Eme,this._overrideRedirectResult=vme}async _openPopup(e,n,r,i){var l;Pf((l=this.eventManagers[e._key()])===null||l===void 0?void 0:l.manager,"_initialize() not called before _openPopup()");const u=await qV(e,n,r,Gk(),i);return Gme(e,u,s4())}async _openRedirect(e,n,r,i){await this._originValidation(e);const l=await qV(e,n,r,Gk(),i);return nme(l),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:l}=this.eventManagers[n];return i?Promise.resolve(i):(Pf(l,"If manager is not set, promise should be"),l)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Vme(e),r=new Tme(e);return n.register("authEvent",i=>(_i(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(TD,{type:TD},i=>{var l;const u=(l=i?.[0])===null||l===void 0?void 0:l[TD];u!==void 0&&n(!!u),Fh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Mme(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return _X()||hX()||n4()}}const ege=Jme;var GV="@firebase/auth",YV="1.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tge{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){_i(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nge(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rge(t){gm(new If("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:u,authDomain:s}=r.options;_i(u&&!u.includes(":"),"invalid-api-key",{appName:r.name});const v={apiKey:u,authDomain:s,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yX(t)},w=new xpe(r,i,l,v);return Rpe(w,n),w},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),gm(new If("auth-internal",e=>{const n=I_(e.getProvider("auth").getImmediate());return(r=>new tge(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),$u(GV,YV,nge(t)),$u(GV,YV,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ige=5*60,sge=lG("authIdTokenMaxAge")||ige;let XV=null;const oge=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>sge)return;const i=n?.token;XV!==i&&(XV=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function kA(t=t2()){const e=e2(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Ape(t,{popupRedirectResolver:ege,persistence:[hme,Jpe,MX]}),r=lG("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(r,location.origin);if(location.origin===l.origin){const u=oge(l.toString());Ype(n,u,()=>u(n.currentUser)),Gpe(n,s=>u(s))}}const i=oG("auth");return i&&Mpe(n,`http://${i}`),n}function age(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}vpe({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const l=Cd("internal-error");l.customData=i,n(l)},r.type="text/javascript",r.charset="UTF-8",age().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rge("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lge="type.googleapis.com/google.protobuf.Int64Value",cge="type.googleapis.com/google.protobuf.UInt64Value";function FX(t,e){const n={};for(const r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}function tI(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>tI(e));if(typeof t=="function"||typeof t=="object")return FX(t,e=>tI(e));throw new Error("Data cannot be encoded in JSON: "+t)}function Qy(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case lge:case cge:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>Qy(e)):typeof t=="function"||typeof t=="object"?FX(t,e=>Qy(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a4="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KV={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Uc extends Nd{constructor(e,n,r){super(`${a4}/${e}`,n||""),this.details=r,Object.setPrototypeOf(this,Uc.prototype)}}function uge(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function nI(t,e){let n=uge(t),r=n,i;try{const l=e&&e.error;if(l){const u=l.status;if(typeof u=="string"){if(!KV[u])return new Uc("internal","internal");n=KV[u],r=u}const s=l.message;typeof s=="string"&&(r=s),i=l.details,i!==void 0&&(i=Qy(i))}}catch{}return n==="ok"?null:new Uc(n,r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hge{constructor(e,n,r,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Bc(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=n.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||n.get().then(l=>this.auth=l,()=>{}),this.messaging||r.get().then(l=>this.messaging=l,()=>{}),this.appCheck||i?.get().then(l=>this.appCheck=l,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const n=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(e){const n=await this.getAuthToken(),r=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:n,messagingToken:r,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zk="us-central1",dge=/^data: (.*?)(?:\n|$)/;function fge(t){let e=null;return{promise:new Promise((n,r)=>{e=setTimeout(()=>{r(new Uc("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class pge{constructor(e,n,r,i,l=Zk,u=(...s)=>fetch(...s)){this.app=e,this.fetchImpl=u,this.emulatorOrigin=null,this.contextProvider=new hge(e,n,r,i),this.cancelAllRequests=new Promise(s=>{this.deleteService=()=>Promise.resolve(s())});try{const s=new URL(l);this.customDomain=s.origin+(s.pathname==="/"?"":s.pathname),this.region=Zk}catch{this.customDomain=null,this.region=l}}_delete(){return this.deleteService()}_url(e){const n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${n}.cloudfunctions.net/${e}`}}function mge(t,e,n){t.emulatorOrigin=`http://${e}:${n}`}function gge(t,e,n){const r=i=>yge(t,e,i,{});return r.stream=(i,l)=>vge(t,e,i,l),r}async function _ge(t,e,n,r){n["Content-Type"]="application/json";let i;try{i=await r(t,{method:"POST",body:JSON.stringify(e),headers:n})}catch{return{status:0,json:null}}let l=null;try{l=await i.json()}catch{}return{status:i.status,json:l}}async function BX(t,e){const n={},r=await t.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(n["X-Firebase-AppCheck"]=r.appCheckToken),n}function yge(t,e,n,r){const i=t._url(e);return xge(t,i,n,r)}async function xge(t,e,n,r){n=tI(n);const i={data:n},l=await BX(t,r),u=r.timeout||7e4,s=fge(u),v=await Promise.race([_ge(e,i,l,t.fetchImpl),s.promise,t.cancelAllRequests]);if(s.cancel(),!v)throw new Uc("cancelled","Firebase Functions instance was deleted.");const w=nI(v.status,v.json);if(w)throw w;if(!v.json)throw new Uc("internal","Response is not valid JSON object.");let A=v.json.data;if(typeof A>"u"&&(A=v.json.result),typeof A>"u")throw new Uc("internal","Response is missing data field.");return{data:Qy(A)}}function vge(t,e,n,r){const i=t._url(e);return bge(t,i,n,r||{})}async function bge(t,e,n,r){var i;n=tI(n);const l={data:n},u=await BX(t,r);u["Content-Type"]="application/json",u.Accept="text/event-stream";let s;try{s=await t.fetchImpl(e,{method:"POST",body:JSON.stringify(l),headers:u,signal:r?.signal})}catch(K){if(K instanceof Error&&K.name==="AbortError"){const Z=new Uc("cancelled","Request was cancelled.");return{data:Promise.reject(Z),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(Z)}}}}}}const Q=nI(0,null);return{data:Promise.reject(Q),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(Q)}}}}}}let v,w;const A=new Promise((K,Q)=>{v=K,w=Q});(i=r?.signal)===null||i===void 0||i.addEventListener("abort",()=>{const K=new Uc("cancelled","Request was cancelled.");w(K)});const F=s.body.getReader(),W=wge(F,v,w,r?.signal);return{stream:{[Symbol.asyncIterator](){const K=W.getReader();return{async next(){const{value:Q,done:Z}=await K.read();return{value:Q,done:Z}},async return(){return await K.cancel(),{done:!0,value:void 0}}}}},data:A}}function wge(t,e,n,r){const i=(u,s)=>{const v=u.match(dge);if(!v)return;const w=v[1];try{const A=JSON.parse(w);if("result"in A){e(Qy(A.result));return}if("message"in A){s.enqueue(Qy(A.message));return}if("error"in A){const F=nI(0,A);s.error(F),n(F);return}}catch(A){if(A instanceof Uc){s.error(A),n(A);return}}},l=new TextDecoder;return new ReadableStream({start(u){let s="";return v();async function v(){if(r?.aborted){const w=new Uc("cancelled","Request was cancelled");return u.error(w),n(w),Promise.resolve()}try{const{value:w,done:A}=await t.read();if(A){s.trim()&&i(s.trim(),u),u.close();return}if(r?.aborted){const W=new Uc("cancelled","Request was cancelled");u.error(W),n(W),await t.cancel();return}s+=l.decode(w,{stream:!0});const F=s.split(`
`);s=F.pop()||"";for(const W of F)W.trim()&&i(W.trim(),u);return v()}catch(w){const A=w instanceof Uc?w:nI(0,null);u.error(A),n(A)}}},cancel(){return t.cancel()}})}const ZV="@firebase/functions",QV="0.12.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ege="auth-internal",Sge="app-check-internal",Tge="messaging-internal";function Cge(t){const e=(n,{instanceIdentifier:r})=>{const i=n.getProvider("app").getImmediate(),l=n.getProvider(Ege),u=n.getProvider(Tge),s=n.getProvider(Sge);return new pge(i,l,u,s,r)};gm(new If(a4,e,"PUBLIC").setMultipleInstances(!0)),$u(ZV,QV,t),$u(ZV,QV,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l4(t=t2(),e=Zk){const r=e2(no(t),a4).getImmediate({identifier:e}),i=pL("functions");return i&&Ige(r,...i),r}function Ige(t,e,n){mge(no(t),e,n)}function Age(t,e,n){return gge(no(t),e)}Cge();const zX={apiKey:"AIzaSyCECE4RoYlRls-jED9DWI3HGvnOqC2VxQ4",authDomain:"humanitarianlogistics-d0b77.firebaseapp.com",projectId:"humanitarianlogistics-d0b77",storageBucket:"humanitarianlogistics-d0b77.firebasestorage.app",messagingSenderId:"874559986585",appId:"1:874559986585:web:cf16f3b1ed7a495f7bd108",measurementId:"G-G7CXG3Q4LL",databaseURL:"https://humanitarianlogistics-d0b77-default-rtdb.europe-west1.firebasedatabase.app"},c4=Ck().length===0?_L(zX):t2();kA(c4);VY(c4);l4(c4);const u4=Ck().length===0?_L(zX,"client-app"):Ck()[0],Fc=kA(u4),ol=VY(u4),f2=u4;class p2{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){const n={listener:e};return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const h4=typeof window>"u"||"Deno"in window;function vh(){}function Rge(t,e){return typeof t=="function"?t(e):t}function Mge(t){return typeof t=="number"&&t>=0&&t!==1/0}function Pge(t,e){return Math.max(t+(e||0)-Date.now(),0)}function jS(t,e,n){return m2(t)?typeof e=="function"?{...n,queryKey:t,queryFn:e}:{...e,queryKey:t}:t}function Dge(t,e,n){return m2(t)?{...e,mutationKey:t}:typeof t=="function"?{...e,mutationFn:t}:{...t}}function Op(t,e,n){return m2(t)?[{...e,queryKey:t},n]:[t||{},e]}function JV(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:l,queryKey:u,stale:s}=t;if(m2(u)){if(r){if(e.queryHash!==d4(u,e.options))return!1}else if(!rI(e.queryKey,u))return!1}if(n!=="all"){const v=e.isActive();if(n==="active"&&!v||n==="inactive"&&v)return!1}return!(typeof s=="boolean"&&e.isStale()!==s||typeof i<"u"&&i!==e.state.fetchStatus||l&&!l(e))}function eU(t,e){const{exact:n,fetching:r,predicate:i,mutationKey:l}=t;if(m2(l)){if(!e.options.mutationKey)return!1;if(n){if(Ug(e.options.mutationKey)!==Ug(l))return!1}else if(!rI(e.options.mutationKey,l))return!1}return!(typeof r=="boolean"&&e.state.status==="loading"!==r||i&&!i(e))}function d4(t,e){return(e?.queryKeyHashFn||Ug)(t)}function Ug(t){return JSON.stringify(t,(e,n)=>Qk(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function rI(t,e){return jX(t,e)}function jX(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(n=>!jX(t[n],e[n])):!1}function VX(t,e){if(t===e)return t;const n=tU(t)&&tU(e);if(n||Qk(t)&&Qk(e)){const r=n?t.length:Object.keys(t).length,i=n?e:Object.keys(e),l=i.length,u=n?[]:{};let s=0;for(let v=0;v<l;v++){const w=n?v:i[v];u[w]=VX(t[w],e[w]),u[w]===t[w]&&s++}return r===l&&s===r?t:u}return e}function kge(t,e){if(t&&!e||e&&!t)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function tU(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Qk(t){if(!nU(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const n=e.prototype;return!(!nU(n)||!n.hasOwnProperty("isPrototypeOf"))}function nU(t){return Object.prototype.toString.call(t)==="[object Object]"}function m2(t){return Array.isArray(t)}function UX(t){return new Promise(e=>{setTimeout(e,t)})}function rU(t){UX(0).then(t)}function Nge(){if(typeof AbortController=="function")return new AbortController}function Oge(t,e,n){return n.isDataEqual!=null&&n.isDataEqual(t,e)?t:typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?VX(t,e):e}class Lge extends p2{constructor(){super(),this.setup=e=>{if(!h4&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),window.addEventListener("focus",n,!1),()=>{window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var n;this.setup=e,(n=this.cleanup)==null||n.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()})}setFocused(e){this.focused!==e&&(this.focused=e,this.onFocus())}onFocus(){this.listeners.forEach(({listener:e})=>{e()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const Jk=new Lge,iU=["online","offline"];class Fge extends p2{constructor(){super(),this.setup=e=>{if(!h4&&window.addEventListener){const n=()=>e();return iU.forEach(r=>{window.addEventListener(r,n,!1)}),()=>{iU.forEach(r=>{window.removeEventListener(r,n)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var n;this.setup=e,(n=this.cleanup)==null||n.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setOnline(r):this.onOnline()})}setOnline(e){this.online!==e&&(this.online=e,this.onOnline())}onOnline(){this.listeners.forEach(({listener:e})=>{e()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const iI=new Fge;function Bge(t){return Math.min(1e3*2**t,3e4)}function f4(t){return(t??"online")==="online"?iI.isOnline():!0}class HX{constructor(e){this.revert=e?.revert,this.silent=e?.silent}}function CD(t){return t instanceof HX}function WX(t){let e=!1,n=0,r=!1,i,l,u;const s=new Promise((oe,ae)=>{l=oe,u=ae}),v=oe=>{r||(K(new HX(oe)),t.abort==null||t.abort())},w=()=>{e=!0},A=()=>{e=!1},F=()=>!Jk.isFocused()||t.networkMode!=="always"&&!iI.isOnline(),W=oe=>{r||(r=!0,t.onSuccess==null||t.onSuccess(oe),i?.(),l(oe))},K=oe=>{r||(r=!0,t.onError==null||t.onError(oe),i?.(),u(oe))},Q=()=>new Promise(oe=>{i=ae=>{const me=r||!F();return me&&oe(ae),me},t.onPause==null||t.onPause()}).then(()=>{i=void 0,r||t.onContinue==null||t.onContinue()}),Z=()=>{if(r)return;let oe;try{oe=t.fn()}catch(ae){oe=Promise.reject(ae)}Promise.resolve(oe).then(W).catch(ae=>{var me,pe;if(r)return;const _e=(me=t.retry)!=null?me:3,De=(pe=t.retryDelay)!=null?pe:Bge,Ae=typeof De=="function"?De(n,ae):De,re=_e===!0||typeof _e=="number"&&n<_e||typeof _e=="function"&&_e(n,ae);if(e||!re){K(ae);return}n++,t.onFail==null||t.onFail(n,ae),UX(Ae).then(()=>{if(F())return Q()}).then(()=>{e?K(ae):Z()})})};return f4(t.networkMode)?Z():Q().then(Z),{promise:s,cancel:v,continue:()=>i?.()?s:Promise.resolve(),cancelRetry:w,continueRetry:A}}const p4=console;function zge(){let t=[],e=0,n=A=>{A()},r=A=>{A()};const i=A=>{let F;e++;try{F=A()}finally{e--,e||s()}return F},l=A=>{e?t.push(A):rU(()=>{n(A)})},u=A=>(...F)=>{l(()=>{A(...F)})},s=()=>{const A=t;t=[],A.length&&rU(()=>{r(()=>{A.forEach(F=>{n(F)})})})};return{batch:i,batchCalls:u,schedule:l,setNotifyFunction:A=>{n=A},setBatchNotifyFunction:A=>{r=A}}}const vl=zge();class $X{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Mge(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(e){this.cacheTime=Math.max(this.cacheTime||0,e??(h4?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class jge extends $X{constructor(e){super(),this.abortSignalConsumed=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.logger=e.logger||p4,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||Vge(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(e,n){const r=Oge(this.state.data,e,this.options);return this.dispatch({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.dispatch({type:"setState",state:e,setStateOptions:n})}cancel(e){var n;const r=this.promise;return(n=this.retryer)==null||n.cancel(e),r?r.then(vh).catch(vh):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(e=>e.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(e=>e.getCurrentResult().isStale)}isStaleByTime(e=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!Pge(this.state.dataUpdatedAt,e)}onFocus(){var e;const n=this.observers.find(r=>r.shouldFetchOnWindowFocus());n&&n.refetch({cancelRefetch:!1}),(e=this.retryer)==null||e.continue()}onOnline(){var e;const n=this.observers.find(r=>r.shouldFetchOnReconnect());n&&n.refetch({cancelRefetch:!1}),(e=this.retryer)==null||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(e,n){var r,i;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&n!=null&&n.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var l;return(l=this.retryer)==null||l.continueRetry(),this.promise}}if(e&&this.setOptions(e),!this.options.queryFn){const K=this.observers.find(Q=>Q.options.queryFn);K&&this.setOptions(K.options)}const u=Nge(),s={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},v=K=>{Object.defineProperty(K,"signal",{enumerable:!0,get:()=>{if(u)return this.abortSignalConsumed=!0,u.signal}})};v(s);const w=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(s)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),A={fetchOptions:n,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:w};if(v(A),(r=this.options.behavior)==null||r.onFetch(A),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((i=A.fetchOptions)==null?void 0:i.meta)){var F;this.dispatch({type:"fetch",meta:(F=A.fetchOptions)==null?void 0:F.meta})}const W=K=>{if(CD(K)&&K.silent||this.dispatch({type:"error",error:K}),!CD(K)){var Q,Z,oe,ae;(Q=(Z=this.cache.config).onError)==null||Q.call(Z,K,this),(oe=(ae=this.cache.config).onSettled)==null||oe.call(ae,this.state.data,K,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=WX({fn:A.fetchFn,abort:u?.abort.bind(u),onSuccess:K=>{var Q,Z,oe,ae;if(typeof K>"u"){W(new Error(this.queryHash+" data is undefined"));return}this.setData(K),(Q=(Z=this.cache.config).onSuccess)==null||Q.call(Z,K,this),(oe=(ae=this.cache.config).onSettled)==null||oe.call(ae,K,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:W,onFail:(K,Q)=>{this.dispatch({type:"failed",failureCount:K,error:Q})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:A.options.retry,retryDelay:A.options.retryDelay,networkMode:A.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(e){const n=r=>{var i,l;switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(i=e.meta)!=null?i:null,fetchStatus:f4(this.options.networkMode)?"fetching":"paused",...!r.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:(l=e.dataUpdatedAt)!=null?l:Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const u=e.error;return CD(u)&&u.revert&&this.revertState?{...this.revertState,fetchStatus:"idle"}:{...r,error:u,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),vl.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate(e)}),this.cache.notify({query:this,type:"updated",action:e})})}}function Vge(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=typeof e<"u",r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"loading",fetchStatus:"idle"}}class Uge extends p2{constructor(e){super(),this.config=e||{},this.queries=[],this.queriesMap={}}build(e,n,r){var i;const l=n.queryKey,u=(i=n.queryHash)!=null?i:d4(l,n);let s=this.get(u);return s||(s=new jge({cache:this,logger:e.getLogger(),queryKey:l,queryHash:u,options:e.defaultQueryOptions(n),state:r,defaultOptions:e.getQueryDefaults(l)}),this.add(s)),s}add(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"added",query:e}))}remove(e){const n=this.queriesMap[e.queryHash];n&&(e.destroy(),this.queries=this.queries.filter(r=>r!==e),n===e&&delete this.queriesMap[e.queryHash],this.notify({type:"removed",query:e}))}clear(){vl.batch(()=>{this.queries.forEach(e=>{this.remove(e)})})}get(e){return this.queriesMap[e]}getAll(){return this.queries}find(e,n){const[r]=Op(e,n);return typeof r.exact>"u"&&(r.exact=!0),this.queries.find(i=>JV(r,i))}findAll(e,n){const[r]=Op(e,n);return Object.keys(r).length>0?this.queries.filter(i=>JV(r,i)):this.queries}notify(e){vl.batch(()=>{this.listeners.forEach(({listener:n})=>{n(e)})})}onFocus(){vl.batch(()=>{this.queries.forEach(e=>{e.onFocus()})})}onOnline(){vl.batch(()=>{this.queries.forEach(e=>{e.onOnline()})})}}class Hge extends $X{constructor(e){super(),this.defaultOptions=e.defaultOptions,this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.logger=e.logger||p4,this.observers=[],this.state=e.state||qX(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(e){this.dispatch({type:"setState",state:e})}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.observers=this.observers.filter(n=>n!==e),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var e,n;return(e=(n=this.retryer)==null?void 0:n.continue())!=null?e:this.execute()}async execute(){const e=()=>{var re;return this.retryer=WX({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(fe,ye)=>{this.dispatch({type:"failed",failureCount:fe,error:ye})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(re=this.options.retry)!=null?re:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},n=this.state.status==="loading";try{var r,i,l,u,s,v,w,A;if(!n){var F,W,K,Q;this.dispatch({type:"loading",variables:this.options.variables}),await((F=(W=this.mutationCache.config).onMutate)==null?void 0:F.call(W,this.state.variables,this));const fe=await((K=(Q=this.options).onMutate)==null?void 0:K.call(Q,this.state.variables));fe!==this.state.context&&this.dispatch({type:"loading",context:fe,variables:this.state.variables})}const re=await e();return await((r=(i=this.mutationCache.config).onSuccess)==null?void 0:r.call(i,re,this.state.variables,this.state.context,this)),await((l=(u=this.options).onSuccess)==null?void 0:l.call(u,re,this.state.variables,this.state.context)),await((s=(v=this.mutationCache.config).onSettled)==null?void 0:s.call(v,re,null,this.state.variables,this.state.context,this)),await((w=(A=this.options).onSettled)==null?void 0:w.call(A,re,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:re}),re}catch(re){try{var Z,oe,ae,me,pe,_e,De,Ae;throw await((Z=(oe=this.mutationCache.config).onError)==null?void 0:Z.call(oe,re,this.state.variables,this.state.context,this)),await((ae=(me=this.options).onError)==null?void 0:ae.call(me,re,this.state.variables,this.state.context)),await((pe=(_e=this.mutationCache.config).onSettled)==null?void 0:pe.call(_e,void 0,re,this.state.variables,this.state.context,this)),await((De=(Ae=this.options).onSettled)==null?void 0:De.call(Ae,void 0,re,this.state.variables,this.state.context)),re}finally{this.dispatch({type:"error",error:re})}}}dispatch(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"loading":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!f4(this.options.networkMode),status:"loading",variables:e.variables};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"};case"setState":return{...r,...e.state}}};this.state=n(this.state),vl.batch(()=>{this.observers.forEach(r=>{r.onMutationUpdate(e)}),this.mutationCache.notify({mutation:this,type:"updated",action:e})})}}function qX(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class Wge extends p2{constructor(e){super(),this.config=e||{},this.mutations=[],this.mutationId=0}build(e,n,r){const i=new Hge({mutationCache:this,logger:e.getLogger(),mutationId:++this.mutationId,options:e.defaultMutationOptions(n),state:r,defaultOptions:n.mutationKey?e.getMutationDefaults(n.mutationKey):void 0});return this.add(i),i}add(e){this.mutations.push(e),this.notify({type:"added",mutation:e})}remove(e){this.mutations=this.mutations.filter(n=>n!==e),this.notify({type:"removed",mutation:e})}clear(){vl.batch(()=>{this.mutations.forEach(e=>{this.remove(e)})})}getAll(){return this.mutations}find(e){return typeof e.exact>"u"&&(e.exact=!0),this.mutations.find(n=>eU(e,n))}findAll(e){return this.mutations.filter(n=>eU(e,n))}notify(e){vl.batch(()=>{this.listeners.forEach(({listener:n})=>{n(e)})})}resumePausedMutations(){var e;return this.resuming=((e=this.resuming)!=null?e:Promise.resolve()).then(()=>{const n=this.mutations.filter(r=>r.state.isPaused);return vl.batch(()=>n.reduce((r,i)=>r.then(()=>i.continue().catch(vh)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function $ge(){return{onFetch:t=>{t.fetchFn=()=>{var e,n,r,i,l,u;const s=(e=t.fetchOptions)==null||(n=e.meta)==null?void 0:n.refetchPage,v=(r=t.fetchOptions)==null||(i=r.meta)==null?void 0:i.fetchMore,w=v?.pageParam,A=v?.direction==="forward",F=v?.direction==="backward",W=((l=t.state.data)==null?void 0:l.pages)||[],K=((u=t.state.data)==null?void 0:u.pageParams)||[];let Q=K,Z=!1;const oe=Ae=>{Object.defineProperty(Ae,"signal",{enumerable:!0,get:()=>{var re;if((re=t.signal)!=null&&re.aborted)Z=!0;else{var fe;(fe=t.signal)==null||fe.addEventListener("abort",()=>{Z=!0})}return t.signal}})},ae=t.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+t.options.queryHash+"'")),me=(Ae,re,fe,ye)=>(Q=ye?[re,...Q]:[...Q,re],ye?[fe,...Ae]:[...Ae,fe]),pe=(Ae,re,fe,ye)=>{if(Z)return Promise.reject("Cancelled");if(typeof fe>"u"&&!re&&Ae.length)return Promise.resolve(Ae);const ue={queryKey:t.queryKey,pageParam:fe,meta:t.options.meta};oe(ue);const Ie=ae(ue);return Promise.resolve(Ie).then(ze=>me(Ae,fe,ze,ye))};let _e;if(!W.length)_e=pe([]);else if(A){const Ae=typeof w<"u",re=Ae?w:sU(t.options,W);_e=pe(W,Ae,re)}else if(F){const Ae=typeof w<"u",re=Ae?w:qge(t.options,W);_e=pe(W,Ae,re,!0)}else{Q=[];const Ae=typeof t.options.getNextPageParam>"u";_e=(s&&W[0]?s(W[0],0,W):!0)?pe([],Ae,K[0]):Promise.resolve(me([],K[0],W[0]));for(let fe=1;fe<W.length;fe++)_e=_e.then(ye=>{if(s&&W[fe]?s(W[fe],fe,W):!0){const Ie=Ae?K[fe]:sU(t.options,ye);return pe(ye,Ae,Ie)}return Promise.resolve(me(ye,K[fe],W[fe]))})}return _e.then(Ae=>({pages:Ae,pageParams:Q}))}}}}function sU(t,e){return t.getNextPageParam==null?void 0:t.getNextPageParam(e[e.length-1],e)}function qge(t,e){return t.getPreviousPageParam==null?void 0:t.getPreviousPageParam(e[0],e)}class Gge{constructor(e={}){this.queryCache=e.queryCache||new Uge,this.mutationCache=e.mutationCache||new Wge,this.logger=e.logger||p4,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=Jk.subscribe(()=>{Jk.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=iI.subscribe(()=>{iI.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var e,n;this.mountCount--,this.mountCount===0&&((e=this.unsubscribeFocus)==null||e.call(this),this.unsubscribeFocus=void 0,(n=this.unsubscribeOnline)==null||n.call(this),this.unsubscribeOnline=void 0)}isFetching(e,n){const[r]=Op(e,n);return r.fetchStatus="fetching",this.queryCache.findAll(r).length}isMutating(e){return this.mutationCache.findAll({...e,fetching:!0}).length}getQueryData(e,n){var r;return(r=this.queryCache.find(e,n))==null?void 0:r.state.data}ensureQueryData(e,n,r){const i=jS(e,n,r),l=this.getQueryData(i.queryKey);return l?Promise.resolve(l):this.fetchQuery(i)}getQueriesData(e){return this.getQueryCache().findAll(e).map(({queryKey:n,state:r})=>{const i=r.data;return[n,i]})}setQueryData(e,n,r){const i=this.queryCache.find(e),l=i?.state.data,u=Rge(n,l);if(typeof u>"u")return;const s=jS(e),v=this.defaultQueryOptions(s);return this.queryCache.build(this,v).setData(u,{...r,manual:!0})}setQueriesData(e,n,r){return vl.batch(()=>this.getQueryCache().findAll(e).map(({queryKey:i})=>[i,this.setQueryData(i,n,r)]))}getQueryState(e,n){var r;return(r=this.queryCache.find(e,n))==null?void 0:r.state}removeQueries(e,n){const[r]=Op(e,n),i=this.queryCache;vl.batch(()=>{i.findAll(r).forEach(l=>{i.remove(l)})})}resetQueries(e,n,r){const[i,l]=Op(e,n,r),u=this.queryCache,s={type:"active",...i};return vl.batch(()=>(u.findAll(i).forEach(v=>{v.reset()}),this.refetchQueries(s,l)))}cancelQueries(e,n,r){const[i,l={}]=Op(e,n,r);typeof l.revert>"u"&&(l.revert=!0);const u=vl.batch(()=>this.queryCache.findAll(i).map(s=>s.cancel(l)));return Promise.all(u).then(vh).catch(vh)}invalidateQueries(e,n,r){const[i,l]=Op(e,n,r);return vl.batch(()=>{var u,s;if(this.queryCache.findAll(i).forEach(w=>{w.invalidate()}),i.refetchType==="none")return Promise.resolve();const v={...i,type:(u=(s=i.refetchType)!=null?s:i.type)!=null?u:"active"};return this.refetchQueries(v,l)})}refetchQueries(e,n,r){const[i,l]=Op(e,n,r),u=vl.batch(()=>this.queryCache.findAll(i).filter(v=>!v.isDisabled()).map(v=>{var w;return v.fetch(void 0,{...l,cancelRefetch:(w=l?.cancelRefetch)!=null?w:!0,meta:{refetchPage:i.refetchPage}})}));let s=Promise.all(u).then(vh);return l!=null&&l.throwOnError||(s=s.catch(vh)),s}fetchQuery(e,n,r){const i=jS(e,n,r),l=this.defaultQueryOptions(i);typeof l.retry>"u"&&(l.retry=!1);const u=this.queryCache.build(this,l);return u.isStaleByTime(l.staleTime)?u.fetch(l):Promise.resolve(u.state.data)}prefetchQuery(e,n,r){return this.fetchQuery(e,n,r).then(vh).catch(vh)}fetchInfiniteQuery(e,n,r){const i=jS(e,n,r);return i.behavior=$ge(),this.fetchQuery(i)}prefetchInfiniteQuery(e,n,r){return this.fetchInfiniteQuery(e,n,r).then(vh).catch(vh)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(e){this.defaultOptions=e}setQueryDefaults(e,n){const r=this.queryDefaults.find(i=>Ug(e)===Ug(i.queryKey));r?r.defaultOptions=n:this.queryDefaults.push({queryKey:e,defaultOptions:n})}getQueryDefaults(e){if(!e)return;const n=this.queryDefaults.find(r=>rI(e,r.queryKey));return n?.defaultOptions}setMutationDefaults(e,n){const r=this.mutationDefaults.find(i=>Ug(e)===Ug(i.mutationKey));r?r.defaultOptions=n:this.mutationDefaults.push({mutationKey:e,defaultOptions:n})}getMutationDefaults(e){if(!e)return;const n=this.mutationDefaults.find(r=>rI(e,r.mutationKey));return n?.defaultOptions}defaultQueryOptions(e){if(e!=null&&e._defaulted)return e;const n={...this.defaultOptions.queries,...this.getQueryDefaults(e?.queryKey),...e,_defaulted:!0};return!n.queryHash&&n.queryKey&&(n.queryHash=d4(n.queryKey,n)),typeof n.refetchOnReconnect>"u"&&(n.refetchOnReconnect=n.networkMode!=="always"),typeof n.useErrorBoundary>"u"&&(n.useErrorBoundary=!!n.suspense),n}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...this.defaultOptions.mutations,...this.getMutationDefaults(e?.mutationKey),...e,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}let Yge=class extends p2{constructor(e,n){super(),this.client=e,this.setOptions(n),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var n;const r=this.options;this.options=this.client.defaultMutationOptions(e),kge(r,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(n=this.currentMutation)==null||n.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.currentMutation)==null||e.removeObserver(this)}}onMutationUpdate(e){this.updateResult();const n={listeners:!0};e.type==="success"?n.onSuccess=!0:e.type==="error"&&(n.onError=!0),this.notify(n)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(e,n){return this.mutateOptions=n,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof e<"u"?e:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const e=this.currentMutation?this.currentMutation.state:qX(),n={...e,isLoading:e.status==="loading",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=n}notify(e){vl.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(e.onSuccess){var n,r,i,l;(n=(r=this.mutateOptions).onSuccess)==null||n.call(r,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(i=(l=this.mutateOptions).onSettled)==null||i.call(l,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(e.onError){var u,s,v,w;(u=(s=this.mutateOptions).onError)==null||u.call(s,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(v=(w=this.mutateOptions).onSettled)==null||v.call(w,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}e.listeners&&this.listeners.forEach(({listener:A})=>{A(this.currentResult)})})}};const Xge=$q.useSyncExternalStore,oU=se.createContext(void 0),GX=se.createContext(!1);function YX(t,e){return t||(e&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=oU),window.ReactQueryClientContext):oU)}const XX=({context:t}={})=>{const e=se.useContext(YX(t,se.useContext(GX)));if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Kge=({client:t,children:e,context:n,contextSharing:r=!1})=>{se.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]);const i=YX(n,r);return se.createElement(GX.Provider,{value:!n&&r},se.createElement(i.Provider,{value:t},e))};function Zge(t,e){return typeof t=="function"?t(...e):!!t}function ID(t,e,n){const r=Dge(t,e),i=XX({context:r.context}),[l]=se.useState(()=>new Yge(i,r));se.useEffect(()=>{l.setOptions(r)},[l,r]);const u=Xge(se.useCallback(v=>l.subscribe(vl.batchCalls(v)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),s=se.useCallback((v,w)=>{l.mutate(v,w).catch(Qge)},[l]);if(u.error&&Zge(l.options.useErrorBoundary,[u.error]))throw u.error;return{...u,mutate:s,mutateAsync:u.mutate}}function Qge(){}const Jge=1,e_e=1e6;let AD=0;function t_e(){return AD=(AD+1)%Number.MAX_SAFE_INTEGER,AD.toString()}const RD=new Map,aU=t=>{if(RD.has(t))return;const e=setTimeout(()=>{RD.delete(t),Db({type:"REMOVE_TOAST",toastId:t})},e_e);RD.set(t,e)},n_e=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,Jge)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===e.toast.id?{...n,...e.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=e;return n?aU(n):t.toasts.forEach(r=>{aU(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===n||n===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==e.toastId)}}},WT=[];let $T={toasts:[]};function Db(t){$T=n_e($T,t),WT.forEach(e=>{e($T)})}function r_e({...t}){const e=t_e(),n=i=>Db({type:"UPDATE_TOAST",toast:{...i,id:e}}),r=()=>Db({type:"DISMISS_TOAST",toastId:e});return Db({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:i=>{i||r()}}}),{id:e,dismiss:r,update:n}}function wc(){const[t,e]=se.useState($T);return se.useEffect(()=>(WT.push(e),()=>{const n=WT.indexOf(e);n>-1&&WT.splice(n,1)}),[t]),{...t,toast:r_e,dismiss:n=>Db({type:"DISMISS_TOAST",toastId:n})}}function KX(t,e){return function(){return t.apply(e,arguments)}}const{toString:i_e}=Object.prototype,{getPrototypeOf:m4}=Object,NA=(t=>e=>{const n=i_e.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Vh=t=>(t=t.toLowerCase(),e=>NA(e)===t),OA=t=>e=>typeof e===t,{isArray:Tx}=Array,Ew=OA("undefined");function s_e(t){return t!==null&&!Ew(t)&&t.constructor!==null&&!Ew(t.constructor)&&mu(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const ZX=Vh("ArrayBuffer");function o_e(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&ZX(t.buffer),e}const a_e=OA("string"),mu=OA("function"),QX=OA("number"),LA=t=>t!==null&&typeof t=="object",l_e=t=>t===!0||t===!1,qT=t=>{if(NA(t)!=="object")return!1;const e=m4(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},c_e=Vh("Date"),u_e=Vh("File"),h_e=Vh("Blob"),d_e=Vh("FileList"),f_e=t=>LA(t)&&mu(t.pipe),p_e=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||mu(t.append)&&((e=NA(t))==="formdata"||e==="object"&&mu(t.toString)&&t.toString()==="[object FormData]"))},m_e=Vh("URLSearchParams"),[g_e,__e,y_e,x_e]=["ReadableStream","Request","Response","Headers"].map(Vh),v_e=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function g2(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,i;if(typeof t!="object"&&(t=[t]),Tx(t))for(r=0,i=t.length;r<i;r++)e.call(null,t[r],r,t);else{const l=n?Object.getOwnPropertyNames(t):Object.keys(t),u=l.length;let s;for(r=0;r<u;r++)s=l[r],e.call(null,t[s],s,t)}}function JX(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,i;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Hg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,eK=t=>!Ew(t)&&t!==Hg;function eN(){const{caseless:t}=eK(this)&&this||{},e={},n=(r,i)=>{const l=t&&JX(e,i)||i;qT(e[l])&&qT(r)?e[l]=eN(e[l],r):qT(r)?e[l]=eN({},r):Tx(r)?e[l]=r.slice():e[l]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&g2(arguments[r],n);return e}const b_e=(t,e,n,{allOwnKeys:r}={})=>(g2(e,(i,l)=>{n&&mu(i)?t[l]=KX(i,n):t[l]=i},{allOwnKeys:r}),t),w_e=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),E_e=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},S_e=(t,e,n,r)=>{let i,l,u;const s={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),l=i.length;l-- >0;)u=i[l],(!r||r(u,t,e))&&!s[u]&&(e[u]=t[u],s[u]=!0);t=n!==!1&&m4(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},T_e=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},C_e=t=>{if(!t)return null;if(Tx(t))return t;let e=t.length;if(!QX(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},I_e=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&m4(Uint8Array)),A_e=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=r.next())&&!i.done;){const l=i.value;e.call(t,l[0],l[1])}},R_e=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},M_e=Vh("HTMLFormElement"),P_e=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,i){return r.toUpperCase()+i}),lU=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),D_e=Vh("RegExp"),tK=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};g2(n,(i,l)=>{let u;(u=e(i,l,t))!==!1&&(r[l]=u||i)}),Object.defineProperties(t,r)},k_e=t=>{tK(t,(e,n)=>{if(mu(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(mu(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},N_e=(t,e)=>{const n={},r=i=>{i.forEach(l=>{n[l]=!0})};return Tx(t)?r(t):r(String(t).split(e)),n},O_e=()=>{},L_e=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function F_e(t){return!!(t&&mu(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const B_e=t=>{const e=new Array(10),n=(r,i)=>{if(LA(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const l=Tx(r)?[]:{};return g2(r,(u,s)=>{const v=n(u,i+1);!Ew(v)&&(l[s]=v)}),e[i]=void 0,l}}return r};return n(t,0)},z_e=Vh("AsyncFunction"),j_e=t=>t&&(LA(t)||mu(t))&&mu(t.then)&&mu(t.catch),nK=((t,e)=>t?setImmediate:e?((n,r)=>(Hg.addEventListener("message",({source:i,data:l})=>{i===Hg&&l===n&&r.length&&r.shift()()},!1),i=>{r.push(i),Hg.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",mu(Hg.postMessage)),V_e=typeof queueMicrotask<"u"?queueMicrotask.bind(Hg):typeof process<"u"&&process.nextTick||nK,cn={isArray:Tx,isArrayBuffer:ZX,isBuffer:s_e,isFormData:p_e,isArrayBufferView:o_e,isString:a_e,isNumber:QX,isBoolean:l_e,isObject:LA,isPlainObject:qT,isReadableStream:g_e,isRequest:__e,isResponse:y_e,isHeaders:x_e,isUndefined:Ew,isDate:c_e,isFile:u_e,isBlob:h_e,isRegExp:D_e,isFunction:mu,isStream:f_e,isURLSearchParams:m_e,isTypedArray:I_e,isFileList:d_e,forEach:g2,merge:eN,extend:b_e,trim:v_e,stripBOM:w_e,inherits:E_e,toFlatObject:S_e,kindOf:NA,kindOfTest:Vh,endsWith:T_e,toArray:C_e,forEachEntry:A_e,matchAll:R_e,isHTMLForm:M_e,hasOwnProperty:lU,hasOwnProp:lU,reduceDescriptors:tK,freezeMethods:k_e,toObjectSet:N_e,toCamelCase:P_e,noop:O_e,toFiniteNumber:L_e,findKey:JX,global:Hg,isContextDefined:eK,isSpecCompliantForm:F_e,toJSONObject:B_e,isAsyncFn:z_e,isThenable:j_e,setImmediate:nK,asap:V_e};function Fi(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}cn.inherits(Fi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:cn.toJSONObject(this.config),code:this.code,status:this.status}}});const rK=Fi.prototype,iK={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{iK[t]={value:t}});Object.defineProperties(Fi,iK);Object.defineProperty(rK,"isAxiosError",{value:!0});Fi.from=(t,e,n,r,i,l)=>{const u=Object.create(rK);return cn.toFlatObject(t,u,function(v){return v!==Error.prototype},s=>s!=="isAxiosError"),Fi.call(u,t.message,e,n,r,i),u.cause=t,u.name=t.name,l&&Object.assign(u,l),u};const U_e=null;function tN(t){return cn.isPlainObject(t)||cn.isArray(t)}function sK(t){return cn.endsWith(t,"[]")?t.slice(0,-2):t}function cU(t,e,n){return t?t.concat(e).map(function(i,l){return i=sK(i),!n&&l?"["+i+"]":i}).join(n?".":""):e}function H_e(t){return cn.isArray(t)&&!t.some(tN)}const W_e=cn.toFlatObject(cn,{},null,function(e){return/^is[A-Z]/.test(e)});function FA(t,e,n){if(!cn.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=cn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Z,oe){return!cn.isUndefined(oe[Z])});const r=n.metaTokens,i=n.visitor||A,l=n.dots,u=n.indexes,v=(n.Blob||typeof Blob<"u"&&Blob)&&cn.isSpecCompliantForm(e);if(!cn.isFunction(i))throw new TypeError("visitor must be a function");function w(Q){if(Q===null)return"";if(cn.isDate(Q))return Q.toISOString();if(!v&&cn.isBlob(Q))throw new Fi("Blob is not supported. Use a Buffer instead.");return cn.isArrayBuffer(Q)||cn.isTypedArray(Q)?v&&typeof Blob=="function"?new Blob([Q]):Buffer.from(Q):Q}function A(Q,Z,oe){let ae=Q;if(Q&&!oe&&typeof Q=="object"){if(cn.endsWith(Z,"{}"))Z=r?Z:Z.slice(0,-2),Q=JSON.stringify(Q);else if(cn.isArray(Q)&&H_e(Q)||(cn.isFileList(Q)||cn.endsWith(Z,"[]"))&&(ae=cn.toArray(Q)))return Z=sK(Z),ae.forEach(function(pe,_e){!(cn.isUndefined(pe)||pe===null)&&e.append(u===!0?cU([Z],_e,l):u===null?Z:Z+"[]",w(pe))}),!1}return tN(Q)?!0:(e.append(cU(oe,Z,l),w(Q)),!1)}const F=[],W=Object.assign(W_e,{defaultVisitor:A,convertValue:w,isVisitable:tN});function K(Q,Z){if(!cn.isUndefined(Q)){if(F.indexOf(Q)!==-1)throw Error("Circular reference detected in "+Z.join("."));F.push(Q),cn.forEach(Q,function(ae,me){(!(cn.isUndefined(ae)||ae===null)&&i.call(e,ae,cn.isString(me)?me.trim():me,Z,W))===!0&&K(ae,Z?Z.concat(me):[me])}),F.pop()}}if(!cn.isObject(t))throw new TypeError("data must be an object");return K(t),e}function uU(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function g4(t,e){this._pairs=[],t&&FA(t,this,e)}const oK=g4.prototype;oK.append=function(e,n){this._pairs.push([e,n])};oK.toString=function(e){const n=e?function(r){return e.call(this,r,uU)}:uU;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function $_e(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aK(t,e,n){if(!e)return t;const r=n&&n.encode||$_e;cn.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let l;if(i?l=i(e,n):l=cn.isURLSearchParams(e)?e.toString():new g4(e,n).toString(r),l){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+l}return t}class hU{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){cn.forEach(this.handlers,function(r){r!==null&&e(r)})}}const lK={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},q_e=typeof URLSearchParams<"u"?URLSearchParams:g4,G_e=typeof FormData<"u"?FormData:null,Y_e=typeof Blob<"u"?Blob:null,X_e={isBrowser:!0,classes:{URLSearchParams:q_e,FormData:G_e,Blob:Y_e},protocols:["http","https","file","blob","url","data"]},_4=typeof window<"u"&&typeof document<"u",nN=typeof navigator=="object"&&navigator||void 0,K_e=_4&&(!nN||["ReactNative","NativeScript","NS"].indexOf(nN.product)<0),Z_e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Q_e=_4&&window.location.href||"http://localhost",J_e=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:_4,hasStandardBrowserEnv:K_e,hasStandardBrowserWebWorkerEnv:Z_e,navigator:nN,origin:Q_e},Symbol.toStringTag,{value:"Module"})),Zl={...J_e,...X_e};function e0e(t,e){return FA(t,new Zl.classes.URLSearchParams,Object.assign({visitor:function(n,r,i,l){return Zl.isNode&&cn.isBuffer(n)?(this.append(r,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function t0e(t){return cn.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function n0e(t){const e={},n=Object.keys(t);let r;const i=n.length;let l;for(r=0;r<i;r++)l=n[r],e[l]=t[l];return e}function cK(t){function e(n,r,i,l){let u=n[l++];if(u==="__proto__")return!0;const s=Number.isFinite(+u),v=l>=n.length;return u=!u&&cn.isArray(i)?i.length:u,v?(cn.hasOwnProp(i,u)?i[u]=[i[u],r]:i[u]=r,!s):((!i[u]||!cn.isObject(i[u]))&&(i[u]=[]),e(n,r,i[u],l)&&cn.isArray(i[u])&&(i[u]=n0e(i[u])),!s)}if(cn.isFormData(t)&&cn.isFunction(t.entries)){const n={};return cn.forEachEntry(t,(r,i)=>{e(t0e(r),i,n,0)}),n}return null}function r0e(t,e,n){if(cn.isString(t))try{return(e||JSON.parse)(t),cn.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(t)}const _2={transitional:lK,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const r=n.getContentType()||"",i=r.indexOf("application/json")>-1,l=cn.isObject(e);if(l&&cn.isHTMLForm(e)&&(e=new FormData(e)),cn.isFormData(e))return i?JSON.stringify(cK(e)):e;if(cn.isArrayBuffer(e)||cn.isBuffer(e)||cn.isStream(e)||cn.isFile(e)||cn.isBlob(e)||cn.isReadableStream(e))return e;if(cn.isArrayBufferView(e))return e.buffer;if(cn.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(l){if(r.indexOf("application/x-www-form-urlencoded")>-1)return e0e(e,this.formSerializer).toString();if((s=cn.isFileList(e))||r.indexOf("multipart/form-data")>-1){const v=this.env&&this.env.FormData;return FA(s?{"files[]":e}:e,v&&new v,this.formSerializer)}}return l||i?(n.setContentType("application/json",!1),r0e(e)):e}],transformResponse:[function(e){const n=this.transitional||_2.transitional,r=n&&n.forcedJSONParsing,i=this.responseType==="json";if(cn.isResponse(e)||cn.isReadableStream(e))return e;if(e&&cn.isString(e)&&(r&&!this.responseType||i)){const u=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(s){if(u)throw s.name==="SyntaxError"?Fi.from(s,Fi.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Zl.classes.FormData,Blob:Zl.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};cn.forEach(["delete","get","head","post","put","patch"],t=>{_2.headers[t]={}});const i0e=cn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),s0e=t=>{const e={};let n,r,i;return t&&t.split(`
`).forEach(function(u){i=u.indexOf(":"),n=u.substring(0,i).trim().toLowerCase(),r=u.substring(i+1).trim(),!(!n||e[n]&&i0e[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},dU=Symbol("internals");function Pv(t){return t&&String(t).trim().toLowerCase()}function GT(t){return t===!1||t==null?t:cn.isArray(t)?t.map(GT):String(t)}function o0e(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const a0e=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function MD(t,e,n,r,i){if(cn.isFunction(r))return r.call(this,e,n);if(i&&(e=n),!!cn.isString(e)){if(cn.isString(r))return e.indexOf(r)!==-1;if(cn.isRegExp(r))return r.test(e)}}function l0e(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function c0e(t,e){const n=cn.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(i,l,u){return this[r].call(this,e,i,l,u)},configurable:!0})})}let Yc=class{constructor(e){e&&this.set(e)}set(e,n,r){const i=this;function l(s,v,w){const A=Pv(v);if(!A)throw new Error("header name must be a non-empty string");const F=cn.findKey(i,A);(!F||i[F]===void 0||w===!0||w===void 0&&i[F]!==!1)&&(i[F||v]=GT(s))}const u=(s,v)=>cn.forEach(s,(w,A)=>l(w,A,v));if(cn.isPlainObject(e)||e instanceof this.constructor)u(e,n);else if(cn.isString(e)&&(e=e.trim())&&!a0e(e))u(s0e(e),n);else if(cn.isHeaders(e))for(const[s,v]of e.entries())l(v,s,r);else e!=null&&l(n,e,r);return this}get(e,n){if(e=Pv(e),e){const r=cn.findKey(this,e);if(r){const i=this[r];if(!n)return i;if(n===!0)return o0e(i);if(cn.isFunction(n))return n.call(this,i,r);if(cn.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Pv(e),e){const r=cn.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||MD(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let i=!1;function l(u){if(u=Pv(u),u){const s=cn.findKey(r,u);s&&(!n||MD(r,r[s],s,n))&&(delete r[s],i=!0)}}return cn.isArray(e)?e.forEach(l):l(e),i}clear(e){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const l=n[r];(!e||MD(this,this[l],l,e,!0))&&(delete this[l],i=!0)}return i}normalize(e){const n=this,r={};return cn.forEach(this,(i,l)=>{const u=cn.findKey(r,l);if(u){n[u]=GT(i),delete n[l];return}const s=e?l0e(l):String(l).trim();s!==l&&delete n[l],n[s]=GT(i),r[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return cn.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=e&&cn.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[dU]=this[dU]={accessors:{}}).accessors,i=this.prototype;function l(u){const s=Pv(u);r[s]||(c0e(i,u),r[s]=!0)}return cn.isArray(e)?e.forEach(l):l(e),this}};Yc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);cn.reduceDescriptors(Yc.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});cn.freezeMethods(Yc);function PD(t,e){const n=this||_2,r=e||n,i=Yc.from(r.headers);let l=r.data;return cn.forEach(t,function(s){l=s.call(n,l,i.normalize(),e?e.status:void 0)}),i.normalize(),l}function uK(t){return!!(t&&t.__CANCEL__)}function Cx(t,e,n){Fi.call(this,t??"canceled",Fi.ERR_CANCELED,e,n),this.name="CanceledError"}cn.inherits(Cx,Fi,{__CANCEL__:!0});function hK(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Fi("Request failed with status code "+n.status,[Fi.ERR_BAD_REQUEST,Fi.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function u0e(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function h0e(t,e){t=t||10;const n=new Array(t),r=new Array(t);let i=0,l=0,u;return e=e!==void 0?e:1e3,function(v){const w=Date.now(),A=r[l];u||(u=w),n[i]=v,r[i]=w;let F=l,W=0;for(;F!==i;)W+=n[F++],F=F%t;if(i=(i+1)%t,i===l&&(l=(l+1)%t),w-u<e)return;const K=A&&w-A;return K?Math.round(W*1e3/K):void 0}}function d0e(t,e){let n=0,r=1e3/e,i,l;const u=(w,A=Date.now())=>{n=A,i=null,l&&(clearTimeout(l),l=null),t.apply(null,w)};return[(...w)=>{const A=Date.now(),F=A-n;F>=r?u(w,A):(i=w,l||(l=setTimeout(()=>{l=null,u(i)},r-F)))},()=>i&&u(i)]}const sI=(t,e,n=3)=>{let r=0;const i=h0e(50,250);return d0e(l=>{const u=l.loaded,s=l.lengthComputable?l.total:void 0,v=u-r,w=i(v),A=u<=s;r=u;const F={loaded:u,total:s,progress:s?u/s:void 0,bytes:v,rate:w||void 0,estimated:w&&s&&A?(s-u)/w:void 0,event:l,lengthComputable:s!=null,[e?"download":"upload"]:!0};t(F)},n)},fU=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},pU=t=>(...e)=>cn.asap(()=>t(...e)),f0e=Zl.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,Zl.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(Zl.origin),Zl.navigator&&/(msie|trident)/i.test(Zl.navigator.userAgent)):()=>!0,p0e=Zl.hasStandardBrowserEnv?{write(t,e,n,r,i,l){const u=[t+"="+encodeURIComponent(e)];cn.isNumber(n)&&u.push("expires="+new Date(n).toGMTString()),cn.isString(r)&&u.push("path="+r),cn.isString(i)&&u.push("domain="+i),l===!0&&u.push("secure"),document.cookie=u.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function m0e(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function g0e(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function dK(t,e,n){let r=!m0e(e);return t&&(r||n==!1)?g0e(t,e):e}const mU=t=>t instanceof Yc?{...t}:t;function u_(t,e){e=e||{};const n={};function r(w,A,F,W){return cn.isPlainObject(w)&&cn.isPlainObject(A)?cn.merge.call({caseless:W},w,A):cn.isPlainObject(A)?cn.merge({},A):cn.isArray(A)?A.slice():A}function i(w,A,F,W){if(cn.isUndefined(A)){if(!cn.isUndefined(w))return r(void 0,w,F,W)}else return r(w,A,F,W)}function l(w,A){if(!cn.isUndefined(A))return r(void 0,A)}function u(w,A){if(cn.isUndefined(A)){if(!cn.isUndefined(w))return r(void 0,w)}else return r(void 0,A)}function s(w,A,F){if(F in e)return r(w,A);if(F in t)return r(void 0,w)}const v={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:s,headers:(w,A,F)=>i(mU(w),mU(A),F,!0)};return cn.forEach(Object.keys(Object.assign({},t,e)),function(A){const F=v[A]||i,W=F(t[A],e[A],A);cn.isUndefined(W)&&F!==s||(n[A]=W)}),n}const fK=t=>{const e=u_({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:l,headers:u,auth:s}=e;e.headers=u=Yc.from(u),e.url=aK(dK(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),s&&u.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let v;if(cn.isFormData(n)){if(Zl.hasStandardBrowserEnv||Zl.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((v=u.getContentType())!==!1){const[w,...A]=v?v.split(";").map(F=>F.trim()).filter(Boolean):[];u.setContentType([w||"multipart/form-data",...A].join("; "))}}if(Zl.hasStandardBrowserEnv&&(r&&cn.isFunction(r)&&(r=r(e)),r||r!==!1&&f0e(e.url))){const w=i&&l&&p0e.read(l);w&&u.set(i,w)}return e},_0e=typeof XMLHttpRequest<"u",y0e=_0e&&function(t){return new Promise(function(n,r){const i=fK(t);let l=i.data;const u=Yc.from(i.headers).normalize();let{responseType:s,onUploadProgress:v,onDownloadProgress:w}=i,A,F,W,K,Q;function Z(){K&&K(),Q&&Q(),i.cancelToken&&i.cancelToken.unsubscribe(A),i.signal&&i.signal.removeEventListener("abort",A)}let oe=new XMLHttpRequest;oe.open(i.method.toUpperCase(),i.url,!0),oe.timeout=i.timeout;function ae(){if(!oe)return;const pe=Yc.from("getAllResponseHeaders"in oe&&oe.getAllResponseHeaders()),De={data:!s||s==="text"||s==="json"?oe.responseText:oe.response,status:oe.status,statusText:oe.statusText,headers:pe,config:t,request:oe};hK(function(re){n(re),Z()},function(re){r(re),Z()},De),oe=null}"onloadend"in oe?oe.onloadend=ae:oe.onreadystatechange=function(){!oe||oe.readyState!==4||oe.status===0&&!(oe.responseURL&&oe.responseURL.indexOf("file:")===0)||setTimeout(ae)},oe.onabort=function(){oe&&(r(new Fi("Request aborted",Fi.ECONNABORTED,t,oe)),oe=null)},oe.onerror=function(){r(new Fi("Network Error",Fi.ERR_NETWORK,t,oe)),oe=null},oe.ontimeout=function(){let _e=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const De=i.transitional||lK;i.timeoutErrorMessage&&(_e=i.timeoutErrorMessage),r(new Fi(_e,De.clarifyTimeoutError?Fi.ETIMEDOUT:Fi.ECONNABORTED,t,oe)),oe=null},l===void 0&&u.setContentType(null),"setRequestHeader"in oe&&cn.forEach(u.toJSON(),function(_e,De){oe.setRequestHeader(De,_e)}),cn.isUndefined(i.withCredentials)||(oe.withCredentials=!!i.withCredentials),s&&s!=="json"&&(oe.responseType=i.responseType),w&&([W,Q]=sI(w,!0),oe.addEventListener("progress",W)),v&&oe.upload&&([F,K]=sI(v),oe.upload.addEventListener("progress",F),oe.upload.addEventListener("loadend",K)),(i.cancelToken||i.signal)&&(A=pe=>{oe&&(r(!pe||pe.type?new Cx(null,t,oe):pe),oe.abort(),oe=null)},i.cancelToken&&i.cancelToken.subscribe(A),i.signal&&(i.signal.aborted?A():i.signal.addEventListener("abort",A)));const me=u0e(i.url);if(me&&Zl.protocols.indexOf(me)===-1){r(new Fi("Unsupported protocol "+me+":",Fi.ERR_BAD_REQUEST,t));return}oe.send(l||null)})},x0e=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,i;const l=function(w){if(!i){i=!0,s();const A=w instanceof Error?w:this.reason;r.abort(A instanceof Fi?A:new Cx(A instanceof Error?A.message:A))}};let u=e&&setTimeout(()=>{u=null,l(new Fi(`timeout ${e} of ms exceeded`,Fi.ETIMEDOUT))},e);const s=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(w=>{w.unsubscribe?w.unsubscribe(l):w.removeEventListener("abort",l)}),t=null)};t.forEach(w=>w.addEventListener("abort",l));const{signal:v}=r;return v.unsubscribe=()=>cn.asap(s),v}},v0e=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,i;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},b0e=async function*(t,e){for await(const n of w0e(t))yield*v0e(n,e)},w0e=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},gU=(t,e,n,r)=>{const i=b0e(t,e);let l=0,u,s=v=>{u||(u=!0,r&&r(v))};return new ReadableStream({async pull(v){try{const{done:w,value:A}=await i.next();if(w){s(),v.close();return}let F=A.byteLength;if(n){let W=l+=F;n(W)}v.enqueue(new Uint8Array(A))}catch(w){throw s(w),w}},cancel(v){return s(v),i.return()}},{highWaterMark:2})},BA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",pK=BA&&typeof ReadableStream=="function",E0e=BA&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),mK=(t,...e)=>{try{return!!t(...e)}catch{return!1}},S0e=pK&&mK(()=>{let t=!1;const e=new Request(Zl.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),_U=64*1024,rN=pK&&mK(()=>cn.isReadableStream(new Response("").body)),oI={stream:rN&&(t=>t.body)};BA&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!oI[e]&&(oI[e]=cn.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new Fi(`Response type '${e}' is not supported`,Fi.ERR_NOT_SUPPORT,r)})})})(new Response);const T0e=async t=>{if(t==null)return 0;if(cn.isBlob(t))return t.size;if(cn.isSpecCompliantForm(t))return(await new Request(Zl.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(cn.isArrayBufferView(t)||cn.isArrayBuffer(t))return t.byteLength;if(cn.isURLSearchParams(t)&&(t=t+""),cn.isString(t))return(await E0e(t)).byteLength},C0e=async(t,e)=>{const n=cn.toFiniteNumber(t.getContentLength());return n??T0e(e)},I0e=BA&&(async t=>{let{url:e,method:n,data:r,signal:i,cancelToken:l,timeout:u,onDownloadProgress:s,onUploadProgress:v,responseType:w,headers:A,withCredentials:F="same-origin",fetchOptions:W}=fK(t);w=w?(w+"").toLowerCase():"text";let K=x0e([i,l&&l.toAbortSignal()],u),Q;const Z=K&&K.unsubscribe&&(()=>{K.unsubscribe()});let oe;try{if(v&&S0e&&n!=="get"&&n!=="head"&&(oe=await C0e(A,r))!==0){let De=new Request(e,{method:"POST",body:r,duplex:"half"}),Ae;if(cn.isFormData(r)&&(Ae=De.headers.get("content-type"))&&A.setContentType(Ae),De.body){const[re,fe]=fU(oe,sI(pU(v)));r=gU(De.body,_U,re,fe)}}cn.isString(F)||(F=F?"include":"omit");const ae="credentials"in Request.prototype;Q=new Request(e,{...W,signal:K,method:n.toUpperCase(),headers:A.normalize().toJSON(),body:r,duplex:"half",credentials:ae?F:void 0});let me=await fetch(Q);const pe=rN&&(w==="stream"||w==="response");if(rN&&(s||pe&&Z)){const De={};["status","statusText","headers"].forEach(ye=>{De[ye]=me[ye]});const Ae=cn.toFiniteNumber(me.headers.get("content-length")),[re,fe]=s&&fU(Ae,sI(pU(s),!0))||[];me=new Response(gU(me.body,_U,re,()=>{fe&&fe(),Z&&Z()}),De)}w=w||"text";let _e=await oI[cn.findKey(oI,w)||"text"](me,t);return!pe&&Z&&Z(),await new Promise((De,Ae)=>{hK(De,Ae,{data:_e,headers:Yc.from(me.headers),status:me.status,statusText:me.statusText,config:t,request:Q})})}catch(ae){throw Z&&Z(),ae&&ae.name==="TypeError"&&/fetch/i.test(ae.message)?Object.assign(new Fi("Network Error",Fi.ERR_NETWORK,t,Q),{cause:ae.cause||ae}):Fi.from(ae,ae&&ae.code,t,Q)}}),iN={http:U_e,xhr:y0e,fetch:I0e};cn.forEach(iN,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const yU=t=>`- ${t}`,A0e=t=>cn.isFunction(t)||t===null||t===!1,gK={getAdapter:t=>{t=cn.isArray(t)?t:[t];const{length:e}=t;let n,r;const i={};for(let l=0;l<e;l++){n=t[l];let u;if(r=n,!A0e(n)&&(r=iN[(u=String(n)).toLowerCase()],r===void 0))throw new Fi(`Unknown adapter '${u}'`);if(r)break;i[u||"#"+l]=r}if(!r){const l=Object.entries(i).map(([s,v])=>`adapter ${s} `+(v===!1?"is not supported by the environment":"is not available in the build"));let u=e?l.length>1?`since :
`+l.map(yU).join(`
`):" "+yU(l[0]):"as no adapter specified";throw new Fi("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return r},adapters:iN};function DD(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Cx(null,t)}function xU(t){return DD(t),t.headers=Yc.from(t.headers),t.data=PD.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),gK.getAdapter(t.adapter||_2.adapter)(t).then(function(r){return DD(t),r.data=PD.call(t,t.transformResponse,r),r.headers=Yc.from(r.headers),r},function(r){return uK(r)||(DD(t),r&&r.response&&(r.response.data=PD.call(t,t.transformResponse,r.response),r.response.headers=Yc.from(r.response.headers))),Promise.reject(r)})}const _K="1.8.4",zA={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{zA[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const vU={};zA.transitional=function(e,n,r){function i(l,u){return"[Axios v"+_K+"] Transitional option '"+l+"'"+u+(r?". "+r:"")}return(l,u,s)=>{if(e===!1)throw new Fi(i(u," has been removed"+(n?" in "+n:"")),Fi.ERR_DEPRECATED);return n&&!vU[u]&&(vU[u]=!0,console.warn(i(u," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(l,u,s):!0}};zA.spelling=function(e){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function R0e(t,e,n){if(typeof t!="object")throw new Fi("options must be an object",Fi.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let i=r.length;for(;i-- >0;){const l=r[i],u=e[l];if(u){const s=t[l],v=s===void 0||u(s,l,t);if(v!==!0)throw new Fi("option "+l+" must be "+v,Fi.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Fi("Unknown option "+l,Fi.ERR_BAD_OPTION)}}const YT={assertOptions:R0e,validators:zA},od=YT.validators;let Qg=class{constructor(e){this.defaults=e,this.interceptors={request:new hU,response:new hU}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const l=i.stack?i.stack.replace(/^.+\n/,""):"";try{r.stack?l&&!String(r.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+l):r.stack=l}catch{}}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=u_(this.defaults,n);const{transitional:r,paramsSerializer:i,headers:l}=n;r!==void 0&&YT.assertOptions(r,{silentJSONParsing:od.transitional(od.boolean),forcedJSONParsing:od.transitional(od.boolean),clarifyTimeoutError:od.transitional(od.boolean)},!1),i!=null&&(cn.isFunction(i)?n.paramsSerializer={serialize:i}:YT.assertOptions(i,{encode:od.function,serialize:od.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),YT.assertOptions(n,{baseUrl:od.spelling("baseURL"),withXsrfToken:od.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=l&&cn.merge(l.common,l[n.method]);l&&cn.forEach(["delete","get","head","post","put","patch","common"],Q=>{delete l[Q]}),n.headers=Yc.concat(u,l);const s=[];let v=!0;this.interceptors.request.forEach(function(Z){typeof Z.runWhen=="function"&&Z.runWhen(n)===!1||(v=v&&Z.synchronous,s.unshift(Z.fulfilled,Z.rejected))});const w=[];this.interceptors.response.forEach(function(Z){w.push(Z.fulfilled,Z.rejected)});let A,F=0,W;if(!v){const Q=[xU.bind(this),void 0];for(Q.unshift.apply(Q,s),Q.push.apply(Q,w),W=Q.length,A=Promise.resolve(n);F<W;)A=A.then(Q[F++],Q[F++]);return A}W=s.length;let K=n;for(F=0;F<W;){const Q=s[F++],Z=s[F++];try{K=Q(K)}catch(oe){Z.call(this,oe);break}}try{A=xU.call(this,K)}catch(Q){return Promise.reject(Q)}for(F=0,W=w.length;F<W;)A=A.then(w[F++],w[F++]);return A}getUri(e){e=u_(this.defaults,e);const n=dK(e.baseURL,e.url,e.allowAbsoluteUrls);return aK(n,e.params,e.paramsSerializer)}};cn.forEach(["delete","get","head","options"],function(e){Qg.prototype[e]=function(n,r){return this.request(u_(r||{},{method:e,url:n,data:(r||{}).data}))}});cn.forEach(["post","put","patch"],function(e){function n(r){return function(l,u,s){return this.request(u_(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:l,data:u}))}}Qg.prototype[e]=n(),Qg.prototype[e+"Form"]=n(!0)});let M0e=class yK{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const r=this;this.promise.then(i=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](i);r._listeners=null}),this.promise.then=i=>{let l;const u=new Promise(s=>{r.subscribe(s),l=s}).then(i);return u.cancel=function(){r.unsubscribe(l)},u},e(function(l,u,s){r.reason||(r.reason=new Cx(l,u,s),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new yK(function(i){e=i}),cancel:e}}};function P0e(t){return function(n){return t.apply(null,n)}}function D0e(t){return cn.isObject(t)&&t.isAxiosError===!0}const sN={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(sN).forEach(([t,e])=>{sN[e]=t});function xK(t){const e=new Qg(t),n=KX(Qg.prototype.request,e);return cn.extend(n,Qg.prototype,e,{allOwnKeys:!0}),cn.extend(n,e,null,{allOwnKeys:!0}),n.create=function(i){return xK(u_(t,i))},n}const _a=xK(_2);_a.Axios=Qg;_a.CanceledError=Cx;_a.CancelToken=M0e;_a.isCancel=uK;_a.VERSION=_K;_a.toFormData=FA;_a.AxiosError=Fi;_a.Cancel=_a.CanceledError;_a.all=function(e){return Promise.all(e)};_a.spread=P0e;_a.isAxiosError=D0e;_a.mergeConfig=u_;_a.AxiosHeaders=Yc;_a.formToJSON=t=>cK(cn.isHTMLForm(t)?new FormData(t):t);_a.getAdapter=gK.getAdapter;_a.HttpStatusCode=sN;_a.default=_a;const{Axios:M5e,AxiosError:P5e,CanceledError:D5e,isCancel:k5e,CancelToken:N5e,VERSION:O5e,all:L5e,Cancel:F5e,isAxiosError:B5e,spread:z5e,toFormData:j5e,AxiosHeaders:V5e,HttpStatusCode:U5e,formToJSON:H5e,getAdapter:W5e,mergeConfig:$5e}=_a,k0e=["donor","beneficiary","volunteer"],vK=se.createContext(null);function N0e({children:t}){const{toast:e}=wc();XX();const[,n]=xu(),r=se.useMemo(()=>kA(f2),[]),[i,l]=se.useState(null),[u,s]=se.useState(!0),[v,w]=se.useState(null),[A,F]=se.useState(!1),[W,K]=se.useState(!0);se.useEffect(()=>{(async()=>{try{const re=r.currentUser;re&&(await re.getIdToken(!0),l(re))}catch(re){console.error("Error checking persisted auth:",re)}finally{K(!1)}})()},[r]),se.useEffect(()=>{let Ae=!0;console.log("AuthProvider: Setting up auth state listener");const re=Xpe(r,async fe=>{if(Ae)try{fe?.uid!==i?.uid&&(console.log("AuthProvider: Auth state changed:",{currentUser:fe}),l(fe)),fe&&await new Promise(ye=>setTimeout(ye,100)),s(!1),F(!0)}catch(ye){console.error("Auth state change error:",ye),w(ye instanceof Error?ye:new Error("Auth state change failed")),s(!1),F(!0)}},fe=>{Ae&&(console.error("Auth state listener error:",fe),w(fe),s(!1),F(!0))});return()=>{Ae=!1,console.log("AuthProvider: Cleaning up auth state listener"),re()}},[r,i?.uid]);const Q=ID({mutationFn:async({email:Ae,password:re})=>{try{console.log("Attempting login with email:",Ae);const fe=await $pe(r,Ae,re);return console.log("Login successful:",fe.user),fe.user}catch(fe){if(console.error("Login error:",fe),fe instanceof Error){if(fe.message.includes("auth/invalid-login-credentials"))throw new Error("Invalid email or password. Please check your credentials and try again.");if(fe.message.includes("auth/user-not-found"))throw new Error("No account found with this email. Please register first.");if(fe.message.includes("auth/wrong-password"))throw new Error("Incorrect password. Please try again.")}throw new Error(fe instanceof Error?fe.message:"Login failed")}},onSuccess:Ae=>{e({title:"Login successful",description:`Welcome back, ${Ae.email}!`}),setTimeout(()=>{const re=sessionStorage.getItem("redirectAfterLogin")||"/home";sessionStorage.removeItem("redirectAfterLogin"),n(re)},100)},onError:Ae=>{w(Ae),e({title:"Login failed",description:Ae.message,variant:"destructive"})}}),Z=ID({mutationFn:async({email:Ae,password:re,name:fe,role:ye})=>{try{if(!k0e.includes(ye))throw new Error("Invalid role selected. Please choose a valid role.");console.log("Attempting registration with email:",Ae);const ue=await Wpe(r,Ae,re);return console.log("Registration successful:",ue.user),await CX(ue.user,{displayName:`${fe}:${ye}`}),console.log("Profile updated successfully"),await Ufe(yf(ol,"users",ue.user.uid),{email:ue.user.email,name:fe,role:ye,createdAt:bw(),lastLogin:bw(),permissions:O0e(ye)}),console.log("Firestore document created successfully"),ue.user}catch(ue){if(console.error("Registration error:",ue),ue instanceof Error){if(ue.message.includes("auth/email-already-in-use"))throw new Error("An account with this email already exists. Please login instead.");if(ue.message.includes("auth/weak-password"))throw new Error("Password is too weak. Please use a stronger password.")}throw new Error(ue instanceof Error?ue.message:"Registration failed")}},onSuccess:Ae=>{e({title:"Registration successful",description:"Your account has been created successfully."});const re=sessionStorage.getItem("redirectAfterLogin")||"/home";sessionStorage.removeItem("redirectAfterLogin"),n(re)},onError:Ae=>{w(Ae),e({title:"Registration failed",description:Ae.message,variant:"destructive"})}}),oe=ID({mutationFn:async()=>{try{await Kpe(r),l(null)}catch(Ae){throw new Error(Ae instanceof Error?Ae.message:"Logout failed")}},onSuccess:()=>{e({title:"Logout successful",description:"You have been logged out."}),n("/")},onError:Ae=>{e({title:"Logout failed",description:Ae.message,variant:"destructive"})}}),ae=se.useCallback(Ae=>{if(!i?.displayName)return!1;const[,re]=i.displayName.split(":");return re===Ae},[i]),me=se.useCallback(async(Ae,re)=>{await Q.mutateAsync({email:Ae,password:re})},[Q]),pe=se.useCallback(async(Ae,re,fe)=>{await Z.mutateAsync({email:Ae,password:re,name:"",role:fe})},[Z]),_e=se.useCallback(async()=>{await oe.mutateAsync()},[oe]),De=se.useMemo(()=>({user:i,loading:u||W,error:v,isInitialized:A,loginMutation:Q,registerMutation:Z,logoutMutation:oe,hasRole:ae,login:me,register:pe,logout:_e}),[i,u,W,v,A,Q,Z,oe,ae,me,pe,_e]);return R.jsx(vK.Provider,{value:De,children:t})}function A_(){const t=se.useContext(vK);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}function O0e(t){switch(t){case"admin":return["*"];case"staff":return["read","write","manage_inventory","manage_distributions"];case"donor":return["read","create_donation","view_donations"];case"volunteer":return["read","create_distribution","view_distributions","manage_distributions"];case"beneficiary":return["read","view_aid_requests","create_aid_request"];default:return["read"]}}_a.interceptors.request.use(async t=>{const n=kA(f2).currentUser;if(n){const r=await n.getIdToken();t.headers.Authorization=`Bearer ${r}`}return t});const $n={ADMIN:"admin",STAFF:"staff",DONOR:"donor",BENEFICIARY:"beneficiary",VOLUNTEER:"volunteer",GUEST:"guest"},bK=se.createContext(void 0),L0e=({children:t})=>{const{user:e,loading:n,error:r,logout:i}=A_(),[l,u]=se.useState(null),[s,v]=se.useState(!0),[w,A]=se.useState(null);se.useEffect(()=>{A(r||null)},[r]),se.useEffect(()=>{let Z=!0;return(async()=>{if(!n){if(!e){Z&&(u(null),v(!1));return}try{const ae=await qk(yf(ol,"users",e.uid));if(!Z)return;if(ae.exists()){const me=ae.data(),pe={...e,role:me.role||"donor",createdAt:me.createdAt?.toDate()||new Date,lastLogin:me.lastLogin?.toDate()||new Date,permissions:me.permissions||F0e(me.role||"donor")};u(pe),A(null)}else console.error("User document not found in Firestore"),A(new Error("User data not found")),u(null)}catch(ae){console.error("Error fetching user data:",ae),Z&&(A(ae instanceof Error?ae:new Error("Failed to fetch user data")),u(null))}finally{Z&&v(!1)}}})(),()=>{Z=!1}},[e,n]);const F=se.useMemo(()=>Z=>l?.role===Z,[l]),W=se.useMemo(()=>Z=>{if(!l)return!1;if(l.permissions?.includes(Z)||l.permissions?.includes("*"))return!0;switch(l.role){case"admin":return!0;case"staff":return["read","write","manage_inventory","manage_distributions","create_aid_request","view_aid_requests"].includes(Z);case"donor":return["read","create_donation","view_donations"].includes(Z);case"volunteer":return["read","create_distribution","view_distributions","manage_distributions"].includes(Z);case"beneficiary":return["read","view_aid_requests","create_aid_request"].includes(Z);default:return["read"].includes(Z)}},[l]),K=async Z=>{if(!l)return{success:!1,message:"No user logged in"};try{await YC(yf(ol,"users",l.uid),Z),(Z.displayName||Z.photoURL)&&await CX(l,{displayName:Z.displayName,photoURL:Z.photoURL});const oe=await qk(yf(ol,"users",l.uid));if(oe.exists()){const ae=oe.data();u({...l,...ae})}return{success:!0,message:"Profile updated successfully"}}catch(oe){return console.error("Error updating profile:",oe),{success:!1,message:oe.message||"Failed to update profile"}}},Q=se.useMemo(()=>({user:l,loading:s,error:w,hasRole:F,hasPermission:W,logout:i,updateProfile:K}),[l,s,w,F,W,i]);return R.jsx(bK.Provider,{value:Q,children:t})},Yo=()=>{const t=se.useContext(bK);if(t===void 0)throw new Error("useUser must be used within a UserProvider");return t};function F0e(t){switch(t){case"admin":return["*"];case"staff":return["read","write","manage_inventory","manage_distributions","create_aid_request","view_aid_requests"];case"donor":return["read","create_donation","view_donations"];case"volunteer":return["read","create_distribution","view_distributions","manage_distributions"];case"beneficiary":return["read","view_aid_requests","create_aid_request"];default:return["read"]}}const wK=se.createContext(),B0e=({children:t})=>{const{currentUser:e}=Yo();wc();const[n,r]=se.useState([]),[i,l]=se.useState(!0),[u,s]=se.useState(null),[v,w]=se.useState(null),[A,F]=se.useState([]),[W,K]=se.useState(null),[Q,Z]=se.useState(!1),oe=se.useCallback(()=>{W&&W.readyState===WebSocket.OPEN&&W.close();const ft=new WebSocket("ws://localhost:3000/ws");return ft.onopen=()=>{console.log("WebSocket connection established"),Z(!0)},ft.onmessage=He=>{try{JSON.parse(He.data).type==="inventory_updated"&&(ae(),me())}catch(bt){console.error("Error parsing WebSocket message:",bt)}},ft.onclose=()=>{console.log("WebSocket connection closed"),Z(!1),setTimeout(()=>{document.visibilityState==="visible"&&oe()},5e3)},ft.onerror=He=>{console.error("WebSocket error:",He)},K(ft),()=>{ft&&ft.close()}},[]),ae=se.useCallback(async()=>{try{l(!0);const ft=await fetch("/api/inventory");if(!ft.ok)throw new Error(`API Error: ${ft.status} ${ft.statusText}`);const He=await ft.json();r(He.items||[]),w(new Date),s(null)}catch(ft){console.error("Error fetching inventory:",ft),s("Failed to load inventory. Please try again later.");const He=JSON.parse(localStorage.getItem("inventory"))||[];He.length>0&&r(He)}finally{l(!1)}},[]),me=se.useCallback(async()=>{try{const ft=await fetch("/api/aid-items");if(!ft.ok)throw new Error(`API Error: ${ft.status} ${ft.statusText}`);const He=await ft.json();F(He.items||[])}catch(ft){console.error("Error fetching aid items:",ft)}},[]);se.useEffect(()=>{ae(),me(),oe()},[ae,me,oe]),se.useEffect(()=>{const ft=()=>{document.visibilityState==="visible"&&(!W||W.readyState!==WebSocket.OPEN)&&oe()};return document.addEventListener("visibilitychange",ft),()=>{document.removeEventListener("visibilitychange",ft)}},[oe]);const pe=se.useCallback(async ft=>{const He=n.find(bt=>bt.id===parseInt(ft));if(He)return He;try{const bt=await fetch(`/api/inventory/${ft}`);if(!bt.ok)throw new Error("Item not found");return(await bt.json()).item}catch(bt){return console.error("Error fetching inventory item:",bt),null}},[n]),_e=se.useCallback(async ft=>{try{const He={action:"create",timestamp:new Date().toISOString(),change:ft,user:e};let bt=null;Fc.currentUser&&(bt=await Fc.currentUser.getIdToken());const Nt=await fetch("/api/inventory",{method:"POST",headers:{"Content-Type":"application/json",...bt?{Authorization:`Bearer ${bt}`}:{}},body:JSON.stringify({...ft,locationId:ft.locationId||ft.location||"",history:[He]})});if(!Nt.ok){const it=await Nt.json();throw new Error(it.message||"Failed to create inventory item")}const wt=await Nt.json();return r(it=>[...it,wt.item]),w(new Date),{success:!0,item:wt.item}}catch(He){return console.error("Error adding inventory item:",He),{success:!1,error:He.message||"Failed to add inventory item. Please try again."}}},[e]),De=se.useCallback(async(ft,He)=>{try{const bt=n.find(wn=>String(wn.id)===String(ft));if(!bt)throw new Error("Item not found");const Nt={};Object.keys(He).forEach(wn=>{He[wn]!==bt[wn]&&(Nt[wn]={from:bt[wn],to:He[wn]})});const wt={action:"update",timestamp:new Date().toISOString(),change:Nt,user:e};let it=null;Fc.currentUser&&(it=await Fc.currentUser.getIdToken());const nn=await fetch(`/api/inventory/${ft}`,{method:"PATCH",headers:{"Content-Type":"application/json",...it?{Authorization:`Bearer ${it}`}:{}},body:JSON.stringify({...He,history:[...bt.history||[],wt]})});if(!nn.ok){const wn=await nn.json();throw new Error(wn.message||"Failed to update inventory item")}const In=await nn.json();return r(wn=>wn.map(Xt=>String(Xt.id)===String(ft)?In.item:Xt)),w(new Date),{success:!0,item:In.item}}catch(bt){return console.error("Error updating inventory item:",bt),{success:!1,error:bt.message||"Failed to update inventory item. Please try again."}}},[n,e]),Ae=se.useCallback(async ft=>{try{console.log("removeInventoryItem called with itemId:",ft),console.log("Current inventory:",n);const He=n.find(it=>String(it.id)===String(ft));if(!He)throw new Error("Item not found");const bt={action:"delete",timestamp:new Date().toISOString(),change:"Item deleted",user:e};let Nt=null;Fc.currentUser&&(Nt=await Fc.currentUser.getIdToken());const wt=await fetch(`/api/inventory/${ft}`,{method:"DELETE",headers:{"Content-Type":"application/json",...Nt?{Authorization:`Bearer ${Nt}`}:{}},body:JSON.stringify({history:[...He.history||[],bt]})});if(!wt.ok){const it=await wt.json();throw new Error(it.message||"Failed to delete inventory item")}return r(it=>it.filter(nn=>String(nn.id)!==String(ft))),w(new Date),{success:!0}}catch(He){return console.error("Error removing inventory item:",He),{success:!1,error:He.message||"Failed to remove inventory item. Please try again."}}},[n,e]),re=se.useCallback(async(ft,He,bt)=>{try{const Nt=n.find(nn=>nn.id===parseInt(ft));if(!Nt)throw new Error("Item not found");const wt=Nt.quantity+He;if(wt<0)throw new Error("Insufficient quantity available");const it={action:"adjust",timestamp:new Date().toISOString(),change:{quantity:{from:Nt.quantity,to:wt,change:He},reason:bt},user:e};return await De(ft,{quantity:wt,history:[...Nt.history||[],it]})}catch(Nt){return console.error("Error adjusting inventory quantity:",Nt),{success:!1,error:Nt.message||"Failed to adjust inventory quantity. Please try again."}}},[n,e,De]),fe=se.useCallback(ft=>n.filter(He=>He.category===ft),[n]),ye=se.useCallback(ft=>n.filter(He=>He.locationId===ft),[n]),ue=se.useCallback(()=>n.filter(ft=>ft.quantity<10),[n]),Ie=se.useCallback((ft=30)=>{const He=new Date;return He.setDate(He.getDate()+ft),n.filter(bt=>bt.expiryDate&&new Date(bt.expiryDate)<=He)},[n]),Oe=se.useCallback(()=>e?["admin","staff"].includes(e.role):!1,[e]),ze={inventory:n,aidItems:A,loading:i,error:u,lastUpdate:v,getInventoryItem:pe,addInventoryItem:_e,updateInventoryItem:De,removeInventoryItem:Ae,adjustQuantity:re,getItemsByCategory:fe,getItemsByLocation:ye,getItemsBelowThreshold:ue,getExpiringItems:Ie,canManageInventory:Oe,refresh:ae,socket:W,isConnected:Q};return R.jsx(wK.Provider,{value:ze,children:t})};function y2(){const t=se.useContext(wK);if(!t)throw new Error("useInventory must be used within an InventoryProvider");return t}const ai={PENDING:"pending",APPROVED:"approved",IN_PROGRESS:"in_progress",READY_FOR_PICKUP:"ready_for_pickup",IN_TRANSIT:"in_transit",DELIVERED:"delivered",DENIED:"denied",CANCELLED:"cancelled"},EK=se.createContext();function z0e({children:t}){const{user:e}=Yo();wc();const[n,r]=se.useState([]),[i,l]=se.useState(!0),[u,s]=se.useState(null),[v,w]=se.useState(null),[A,F]=se.useState(null),[W,K]=se.useState(!1),Q=se.useCallback(()=>{A&&A.readyState===WebSocket.OPEN&&A.close();const ye=new WebSocket("ws://localhost:3000/ws");return ye.onopen=()=>{console.log("WebSocket connection established"),K(!0)},ye.onmessage=ue=>{try{JSON.parse(ue.data).type==="aid_request_updated"&&Z()}catch(Ie){console.error("Error parsing WebSocket message:",Ie)}},ye.onclose=()=>{console.log("WebSocket connection closed"),K(!1),setTimeout(()=>{document.visibilityState==="visible"&&Q()},5e3)},ye.onerror=ue=>{console.error("WebSocket error:",ue)},F(ye),()=>{ye&&ye.close()}},[]),Z=se.useCallback(async()=>{if(!e){r([]),l(!1);return}try{l(!0),s(null);let ye=null;Fc.currentUser&&(ye=await Fc.currentUser.getIdToken());const ue=await fetch("/api/aid-requests",{headers:{Authorization:`Bearer ${ye}`}});if(!ue.ok){const Oe=await ue.json();throw new Error(Oe.message||`API Error: ${ue.status} ${ue.statusText}`)}const Ie=await ue.json();r(Ie.requests||[]),w(new Date),localStorage.setItem("aidRequests",JSON.stringify(Ie.requests||[]))}catch(ye){console.error("Error fetching aid requests:",ye),s("Failed to load aid requests. Please try again later.");try{const ue=JSON.parse(localStorage.getItem("aidRequests"));ue&&Array.isArray(ue)&&r(ue)}catch(ue){console.error("Error reading cached requests:",ue),r([])}}finally{l(!1)}},[e]);se.useEffect(()=>{Z(),e&&Q()},[Z,e]),se.useEffect(()=>{const ye=()=>{document.visibilityState==="visible"&&(!A||A.readyState!==WebSocket.OPEN)&&Q()};return document.addEventListener("visibilitychange",ye),()=>{document.removeEventListener("visibilitychange",ye)}},[Q]);const oe=se.useCallback(async ye=>{const ue=n.find(Ie=>Ie.id===parseInt(ye));if(ue)return ue;try{const Ie=await fetch(`/api/aid-requests/${ye}`);if(!Ie.ok)throw new Error("Request not found");return(await Ie.json()).request}catch(Ie){return console.error("Error fetching aid request:",Ie),null}},[n]),ae=se.useCallback(async ye=>{try{let ue=null;Fc.currentUser&&(ue=await Fc.currentUser.getIdToken());const Ie=await fetch("/api/aid-requests",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ue}`},body:JSON.stringify(ye)});if(!Ie.ok){const ze=await Ie.json();throw new Error(ze.message||"Failed to create aid request")}const Oe=await Ie.json();return r(ze=>[...ze,Oe.request]),w(new Date),{success:!0,request:Oe.request}}catch(ue){return console.error("Error creating aid request:",ue),{success:!1,error:ue.message||"Failed to create aid request. Please try again."}}},[]),me=se.useCallback(async(ye,ue)=>{try{return console.warn("Full aid request updates not implemented in API yet"),ue.status?await pe(ye,ue.status):{success:!1,error:"Full request updates not implemented"}}catch(Ie){return console.error("Error updating aid request:",Ie),{success:!1,error:Ie.message||"Failed to update aid request. Please try again."}}},[]),pe=se.useCallback(async(ye,ue)=>{try{let Ie=null;Fc.currentUser&&(Ie=await Fc.currentUser.getIdToken());const Oe=await fetch(`/api/aid-requests/${ye}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ie}`},body:JSON.stringify({status:ue})});if(!Oe.ok){const ft=await Oe.json();throw new Error(ft.message||"Failed to update request status")}const ze=await Oe.json();return r(ft=>ft.map(He=>He.id===ye?ze.request:He)),w(new Date),{success:!0,request:ze.request}}catch(Ie){return console.error("Error updating request status:",Ie),{success:!1,error:Ie.message||"Failed to update request status. Please try again."}}},[]),_e=se.useCallback(async ye=>(console.warn("Delete aid request not implemented in API yet"),{success:!1,error:"Delete requests not implemented"}),[]),De=se.useCallback(ye=>n.filter(ue=>ue.userId===ye),[n]),Ae=se.useCallback(ye=>n.filter(ue=>ue.status===ye),[n]),re=se.useCallback(()=>e?["admin","staff"].includes(e.role):!1,[e]),fe={aidRequests:n,loading:i,error:u,lastUpdate:v,getAidRequestById:oe,createAidRequest:ae,updateAidRequest:me,updateRequestStatus:pe,deleteAidRequest:_e,getRequestsByBeneficiary:De,getRequestsByStatus:Ae,canManageRequests:re,refresh:Z,socket:A,isConnected:W};return R.jsx(EK.Provider,{value:fe,children:t})}function R_(){const t=se.useContext(EK);if(!t)throw new Error("useAidRequest must be used within an AidRequestProvider");return t}const Zd={PENDING:"pending",APPROVED:"approved",IN_PROGRESS:"in_progress",READY_FOR_PICKUP:"ready_for_pickup",IN_TRANSIT:"in_transit",DELIVERED:"delivered",DENIED:"denied",CANCELLED:"cancelled"},SK=se.createContext(),j0e=({children:t})=>{const{currentUser:e}=Yo(),{inventory:n,adjustQuantity:r}=y2(),{updateRequestStatus:i}=R_();wc();const[l,u]=se.useState([]),[s,v]=se.useState(!0),[w,A]=se.useState(null),[F,W]=se.useState(null),K=se.useCallback(async()=>{try{v(!0),A(null);const Ae=await fetch("/api/distributions");if(!Ae.ok)throw new Error("Failed to fetch distributions");const re=await Ae.json();u(re.distributions||[]),W(new Date)}catch(Ae){console.error("Error fetching distributions:",Ae),A("Failed to load distributions. Please try again later.")}finally{v(!1)}},[]);se.useEffect(()=>{K()},[K]);const Q=se.useCallback(Ae=>l.find(re=>re.id===Ae),[l]),Z=se.useCallback(Ae=>l.filter(re=>re.requestId===Ae),[l]),oe=se.useCallback(async Ae=>{try{let re=null;Fc.currentUser&&(re=await Fc.currentUser.getIdToken());const fe=Ae.items.filter(Ie=>{const Oe=n.find(ze=>ze.id===Ie.itemId);return!Oe||Oe.quantity<Ie.quantity});if(fe.length>0)return{success:!1,error:`Insufficient inventory for: ${fe.map(Oe=>Oe.name).join(", ")}`};const ye=await fetch("/api/distributions",{method:"POST",headers:{"Content-Type":"application/json",...re?{Authorization:`Bearer ${re}`}:{}},body:JSON.stringify(Ae)});if(!ye.ok){const Ie=await ye.json();throw new Error(Ie.message||"Failed to create distribution")}const ue=await ye.json();return u(Ie=>[...Ie,ue.distribution]),W(new Date),await i(Ae.requestId,ai.IN_PROGRESS),Ae.items.forEach(Ie=>{r(Ie.itemId,-Ie.quantity,`Reserved for distribution #${ue.distribution.id}`)}),{success:!0,distribution:ue.distribution}}catch(re){return console.error("Error creating distribution:",re),{success:!1,error:re.message||"Failed to create distribution. Please try again."}}},[n,i,r]),ae=se.useCallback(async(Ae,re)=>{try{const fe=await fetch(`/api/distributions/${Ae}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:re})});if(!fe.ok){const Ie=await fe.json();throw new Error(Ie.message||"Failed to update distribution status")}const ye=await fe.json();u(Ie=>Ie.map(Oe=>Oe.id===Ae?ye.distribution:Oe)),W(new Date);let ue;switch(re){case Zd.APPROVED:ue=ai.APPROVED;break;case Zd.IN_PROGRESS:ue=ai.IN_PROGRESS;break;case Zd.READY_FOR_PICKUP:ue=ai.READY_FOR_PICKUP;break;case Zd.IN_TRANSIT:ue=ai.IN_TRANSIT;break;case Zd.DELIVERED:ue=ai.DELIVERED;break;case Zd.DENIED:ue=ai.DENIED;break;case Zd.CANCELLED:ue=ai.CANCELLED;break;default:ue=null}return ue&&await i(ye.distribution.requestId,ue),{success:!0,distribution:ye.distribution}}catch(fe){return console.error("Error updating distribution status:",fe),{success:!1,error:fe.message||"Failed to update distribution status. Please try again."}}},[i]),me=se.useCallback(async Ae=>{try{const re=await ae(Ae,Zd.CANCELLED);if(re.success){const fe=re.distribution;fe.status!==Zd.DELIVERED&&fe.items&&fe.items.forEach(ye=>{r(ye.itemId,ye.quantity,`Returned from cancelled distribution #${Ae}`)})}return re}catch(re){return console.error("Error cancelling distribution:",re),{success:!1,error:re.message||"Failed to cancel distribution. Please try again."}}},[ae,r]),pe=se.useCallback(Ae=>l.filter(re=>re.status===Ae),[l]),_e=se.useCallback(()=>e?["admin","staff"].includes(e.role):!1,[e]),De={distributions:l,loading:s,error:w,lastUpdate:F,getDistributionById:Q,getDistributionsByRequestId:Z,getDistributionsByStatus:pe,createDistribution:oe,updateDistributionStatus:ae,cancelDistribution:me,canCreateDistribution:_e,refresh:K};return R.jsx(SK.Provider,{value:De,children:t})},TK=()=>{const t=se.useContext(SK);if(!t)throw new Error("useDistribution must be used within a DistributionProvider");return t};/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V0e=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),U0e=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),bU=t=>{const e=U0e(t);return e.charAt(0).toUpperCase()+e.slice(1)},CK=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim(),H0e=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var W0e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0e=se.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:l,iconNode:u,...s},v)=>se.createElement("svg",{ref:v,...W0e,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:CK("lucide",i),...!l&&!H0e(s)&&{"aria-hidden":"true"},...s},[...u.map(([w,A])=>se.createElement(w,A)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=(t,e)=>{const n=se.forwardRef(({className:r,...i},l)=>se.createElement($0e,{ref:l,iconNode:e,className:CK(`lucide-${V0e(bU(t))}`,`lucide-${t}`,r),...i}));return n.displayName=bU(t),n};/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0e=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],G0e=Cs("activity",q0e);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0e=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],X0e=Cs("arrow-right",Y0e);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0e=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],IK=Cs("chart-column",K0e);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z0e=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],Q0e=Cs("chart-no-axes-column",Z0e);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J0e=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],eye=Cs("check",J0e);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tye=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],AK=Cs("chevron-down",tye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nye=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],rye=Cs("chevron-up",nye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iye=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],sye=Cs("circle-check-big",iye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],aye=Cs("circle-x",oye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],cye=Cs("clock",lye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uye=[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]],hye=Cs("cog",uye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dye=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],wU=Cs("dollar-sign",dye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fye=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],pye=Cs("file-text",fye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],RK=Cs("globe",mye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gye=[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]],_ye=Cs("handshake",gye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yye=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],y4=Cs("heart",yye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xye=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],vye=Cs("house",xye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],wye=Cs("info",bye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Sye=Cs("layout-dashboard",Eye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tye=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],bf=Cs("loader-circle",Tye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cye=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],MK=Cs("log-out",Cye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iye=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Aye=Cs("map-pin",Iye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rye=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],Mye=Cs("menu",Rye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pye=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],PK=Cs("message-square",Pye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dye=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],kye=Cs("navigation",Dye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nye=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Jy=Cs("package",Nye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oye=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],oN=Cs("plus",Oye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lye=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],DK=Cs("settings",Lye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fye=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],kK=Cs("shield-alert",Fye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bye=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],x4=Cs("shield",Bye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zye=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],jye=Cs("truck",zye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vye=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],Sw=Cs("users",Vye);/**
 * @license lucide-react v0.501.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uye=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],v4=Cs("x",Uye),_l=({component:t,requiredRoles:e,...n})=>{const{user:r,loading:i}=Yo();return xu(),se.useEffect(()=>{if(!r&&!i){const l=window.location.pathname;l!=="/auth"&&l!=="/login"&&l!=="/register"&&sessionStorage.setItem("redirectAfterLogin",l)}},[r,i]),i?R.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):r?e&&e.length>0&&!e.includes(r.role)?(sessionStorage.setItem("unauthorizedFrom",window.location.pathname),R.jsx(pm,{to:"/unauthorized"})):R.jsx(t,{...n}):R.jsx(pm,{to:"/login"})},EU=({component:t,...e})=>{const{user:n,loading:r}=Yo(),[i]=xu(),[l,u]=se.useState(!1),[s,v]=se.useState(""),[w,A]=se.useState(!0);return console.log("UnauthenticatedRoute:",{user:n,loading:r,location:i}),se.useEffect(()=>{if(r){A(!0);return}if(A(!1),n&&!l){if(console.log("UnauthenticatedRoute: User is authenticated, setting redirect"),i==="/login"||i==="/register"){console.log("UnauthenticatedRoute: Allowing access to auth pages even when authenticated");return}const F=sessionStorage.getItem("redirectAfterLogin")||"/home";sessionStorage.removeItem("redirectAfterLogin"),v(F),u(!0)}},[n,r,i,l]),w?(console.log("UnauthenticatedRoute: Loading state"),R.jsx("div",{className:"flex justify-center items-center h-screen",children:R.jsx(bf,{className:"h-8 w-8 animate-spin text-primary"})})):i==="/auth"?(console.log("UnauthenticatedRoute: Redirecting from /auth to /login"),R.jsx(pm,{to:"/login"})):l?(console.log("UnauthenticatedRoute: Redirecting to",s),R.jsx(pm,{to:s})):(console.log("UnauthenticatedRoute: Rendering component for unauthenticated user"),R.jsx(t,{...e}))},x2=()=>{const{user:t}=Yo(),e=t?.role||$n.GUEST;return{canManageUsers:e===$n.ADMIN,canManageInventory:[$n.ADMIN,$n.STAFF,$n.VOLUNTEER].includes(e),canManageDonations:[$n.ADMIN,$n.STAFF,$n.DONOR].includes(e),canRequestAid:[$n.ADMIN,$n.STAFF,$n.BENEFICIARY].includes(e),canViewAnalytics:[$n.ADMIN,$n.STAFF].includes(e),canManageDistributions:[$n.ADMIN,$n.STAFF].includes(e),canViewSettings:e===$n.ADMIN}},kD=768;function Hye(){const[t,e]=se.useState(void 0);return se.useEffect(()=>{const n=window.matchMedia(`(max-width: ${kD-1}px)`),r=()=>{e(window.innerWidth<kD)};return n.addEventListener("change",r),e(window.innerWidth<kD),()=>n.removeEventListener("change",r)},[]),!!t}const Wye=()=>{const[t]=xu(),{user:e}=Yo(),{logout:n}=A_(),r=Hye(),[i,l]=se.useState(!r),{canManageInventory:u,canManageDistributions:s,canViewAnalytics:v,canViewSettings:w}=x2();se.useEffect(()=>{console.log("Current user:",e),console.log("User role:",e?.role),console.log("USER_ROLES.VOLUNTEER:",$n.VOLUNTEER),console.log("Is volunteer?",e?.role===$n.VOLUNTEER)},[e]),se.useEffect(()=>{l(!r)},[r]);const A=ae=>t===ae,F=[{path:"/home",icon:R.jsx(vye,{className:"w-5 h-5"}),label:"Home",roles:[$n.ADMIN,$n.STAFF,$n.DONOR,$n.BENEFICIARY,$n.VOLUNTEER,$n.GUEST]},{path:"/dashboard",icon:R.jsx(Sye,{className:"w-5 h-5"}),label:"Dashboard",roles:[$n.ADMIN,$n.STAFF,$n.DONOR,$n.BENEFICIARY,$n.VOLUNTEER]},{path:"/admin-dashboard",icon:R.jsx(x4,{className:"w-5 h-5"}),label:"Admin Dashboard",roles:[$n.ADMIN]},{path:"/distribution",icon:R.jsx(jye,{className:"w-5 h-5"}),label:"Distribution",roles:[$n.ADMIN,$n.STAFF,$n.VOLUNTEER],permission:s},{path:"/beneficiaries",icon:R.jsx(Sw,{className:"w-5 h-5"}),label:"Beneficiaries",roles:[$n.ADMIN,$n.STAFF]},{path:"/analytics",icon:R.jsx(Q0e,{className:"w-5 h-5"}),label:"Reports & Analytics",roles:[$n.ADMIN,$n.STAFF],permission:v},{path:"/inventory",icon:R.jsx(Jy,{className:"w-5 h-5"}),label:"Inventory",roles:[$n.ADMIN,$n.STAFF,$n.VOLUNTEER],permission:u},{path:"/staff/location",icon:R.jsx(Aye,{className:"w-5 h-5"}),label:"Location Tracking",roles:[$n.STAFF,$n.VOLUNTEER]},{path:"/delivery/123/track",icon:R.jsx(kye,{className:"w-5 h-5"}),label:"Track Delivery",roles:[$n.ADMIN,$n.STAFF,$n.BENEFICIARY,$n.VOLUNTEER]},{path:"/settings",icon:R.jsx(DK,{className:"w-5 h-5"}),label:"Settings",roles:[$n.ADMIN],permission:w}],W=[{path:"/feedback",icon:R.jsx(PK,{className:"w-5 h-5"}),label:"Feedback",roles:[$n.ADMIN,$n.STAFF,$n.DONOR,$n.BENEFICIARY,$n.VOLUNTEER,$n.GUEST]},{path:"/about",icon:R.jsx(wye,{className:"w-5 h-5"}),label:"About Us",roles:[$n.ADMIN,$n.STAFF,$n.DONOR,$n.BENEFICIARY,$n.VOLUNTEER,$n.GUEST]}],K=F.filter(ae=>{const me=e?.role||$n.GUEST,pe=ae.roles.includes(me),_e=!ae.permission||ae.permission;return ae.path==="/dashboard"&&(console.log("Dashboard item:",ae),console.log("User role:",me),console.log("Has role?",pe),console.log("Has permission?",_e)),pe&&_e}),Q=W.filter(ae=>{const me=e?.role||$n.GUEST;return ae.roles.includes(me)}),Z=()=>{r&&l(!1)},oe=()=>R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"flex items-center justify-between h-16 border-b border-gray-200 dark:border-gray-700 px-4",children:[R.jsx("div",{className:"flex-1 flex justify-center",children:R.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"HADS"})}),r&&R.jsx("button",{onClick:()=>l(!1),className:"p-2 rounded-md text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 absolute right-4",children:R.jsx(v4,{className:"w-5 h-5"})})]}),R.jsx("div",{className:"flex-1 overflow-y-auto py-4",children:R.jsx("nav",{className:"space-y-1 px-2",children:K.map(ae=>R.jsxs(hu,{to:ae.path,onClick:Z,className:`flex items-center px-4 py-2 text-sm font-medium rounded-md ${A(ae.path)?"bg-primary-50 text-primary-600 dark:bg-primary-900 dark:text-primary-100":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[ae.icon,R.jsx("span",{className:"ml-3",children:ae.label})]},ae.path))})}),R.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4",children:[R.jsx("div",{className:"space-y-1",children:Q.map(ae=>R.jsxs(hu,{to:ae.path,onClick:Z,className:`flex items-center px-4 py-2 text-sm font-medium rounded-md ${A(ae.path)?"bg-primary-50 text-primary-600 dark:bg-primary-900 dark:text-primary-100":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[ae.icon,R.jsx("span",{className:"ml-3",children:ae.label})]},ae.path))}),R.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[R.jsxs("div",{className:"flex items-center px-4 py-2",children:[R.jsx("div",{className:"flex-shrink-0",children:R.jsx("div",{className:"h-8 w-8 rounded-full bg-primary-500 flex items-center justify-center text-white",children:e?.name?.charAt(0)||"U"})}),R.jsxs("div",{className:"ml-3",children:[R.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e?.name||"User"}),R.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e?.role||"Guest"})]})]}),R.jsxs("button",{onClick:n,className:"w-full flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded-md mt-2",children:[R.jsx(MK,{className:"w-5 h-5 mr-3"}),"Logout"]})]})]})]});return R.jsxs(R.Fragment,{children:[r&&R.jsx("button",{onClick:()=>l(!0),className:"fixed top-4 left-4 z-50 p-2 rounded-md text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 bg-white dark:bg-gray-800 shadow-md",children:R.jsx(Mye,{className:"w-5 h-5"})}),R.jsx("div",{className:`${r?`fixed inset-y-0 left-0 z-40 transform ${i?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out`:"relative"} flex flex-col w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700`,children:R.jsx(oe,{})}),r&&i&&R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>l(!1)})]})},$ye=()=>{const[t]=xu(),[,e]=xu(),{user:n}=Yo(),{logout:r}=A_(),[i,l]=se.useState(!1),[u,s]=se.useState(!1),v=se.useRef(null),w=se.useRef(null),{canManageInventory:A,canManageDistributions:F,canRequestAid:W,canViewAnalytics:K,canViewSettings:Q}=x2();se.useEffect(()=>{console.log("Header - Current user:",n),console.log("Header - User role:",n?.role),console.log("Header - USER_ROLES.VOLUNTEER:",$n.VOLUNTEER),console.log("Header - Is volunteer?",n?.role===$n.VOLUNTEER)},[n]);const Z=_e=>t===_e,oe=[{path:"/home",label:"Home",roles:[$n.ADMIN,$n.STAFF,$n.DONOR,$n.BENEFICIARY,$n.VOLUNTEER,$n.GUEST]},{path:"/dashboard",label:"Dashboard",roles:[$n.ADMIN,$n.STAFF,$n.DONOR,$n.BENEFICIARY,$n.VOLUNTEER]},{path:"/admin-dashboard",label:"Admin Dashboard",roles:[$n.ADMIN]},{path:"/distribution",label:"Distribution",roles:[$n.ADMIN,$n.STAFF,$n.VOLUNTEER],permission:F},{path:"/deliveries",label:"My Deliveries",roles:[$n.VOLUNTEER]},{path:"/request",label:"Requests",roles:[$n.ADMIN,$n.STAFF,$n.BENEFICIARY],permission:W},{path:"/inventory",label:"Inventory",roles:[$n.ADMIN,$n.STAFF,$n.VOLUNTEER],permission:A},{path:"/analytics",label:"Analytics",roles:[$n.ADMIN,$n.STAFF],permission:K}];se.useEffect(()=>{const _e=De=>{i&&v.current&&!v.current.contains(De.target)&&l(!1)};return document.addEventListener("mousedown",_e),()=>{document.removeEventListener("mousedown",_e)}},[i]),se.useEffect(()=>{const _e=De=>{u&&w.current&&!w.current.contains(De.target)&&s(!1)};return document.addEventListener("mousedown",_e),()=>{document.removeEventListener("mousedown",_e)}},[u]);const ae=()=>{r(),l(!1),s(!1)},me=_e=>{if(!_e)return"?";try{return _e.split(" ").map(De=>De[0]).join("").toUpperCase()}catch{return _e.charAt(0).toUpperCase()}},pe=oe.filter(_e=>{const De=n?.role||$n.GUEST,Ae=_e.roles.includes(De),re=!_e.permission||_e.permission;return _e.path==="/dashboard"&&(console.log("Header - Dashboard item:",_e),console.log("Header - User role:",De),console.log("Header - Has role?",Ae),console.log("Header - Has permission?",re)),Ae&&re});return R.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:R.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:R.jsxs("div",{className:"flex justify-between h-16",children:[R.jsx("div",{className:"flex-1 flex justify-center",children:R.jsx("nav",{className:"hidden sm:ml-6 sm:flex sm:space-x-4 lg:space-x-8",children:pe.map(_e=>R.jsx(hu,{to:_e.path,className:`inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium whitespace-nowrap ${Z(_e.path)?"border-primary-500 text-gray-900 dark:text-white":"border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-700 dark:hover:text-gray-200"}`,children:_e.label},_e.path))})}),R.jsx("div",{className:"hidden sm:ml-6 sm:flex sm:items-center",children:R.jsxs("div",{className:"ml-3 relative",ref:v,children:[R.jsx("div",{children:R.jsxs("button",{onClick:()=>l(!i),className:"max-w-xs bg-white dark:bg-gray-800 rounded-full flex items-center text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[R.jsx("span",{className:"sr-only",children:"Open user menu"}),R.jsx("div",{className:"h-8 w-8 rounded-full bg-primary-500 flex items-center justify-center text-white",children:me(n?.name||n?.email||"")})]})}),i&&R.jsxs("div",{className:"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-50",children:[R.jsx(hu,{to:"/profile",className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>setTimeout(()=>l(!1),100),children:"Your Profile"}),Q&&R.jsx(hu,{to:"/settings",className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>setTimeout(()=>l(!1),100),children:"Settings"}),R.jsx("button",{onClick:ae,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Sign out"})]})]})}),R.jsx("div",{className:"flex items-center sm:hidden",children:R.jsxs("div",{className:"relative",ref:w,children:[R.jsxs("button",{onClick:()=>s(!u),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500",children:[R.jsx("span",{className:"sr-only",children:"Open main menu"}),R.jsx("div",{className:"h-8 w-8 rounded-full bg-primary-500 flex items-center justify-center text-white",children:me(n?.name||n?.email||"")})]}),u&&R.jsxs("div",{className:"absolute right-0 top-12 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-50",children:[R.jsx("button",{className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",onClick:()=>{e("/profile"),s(!1)},children:"Your Profile"}),Q&&R.jsx("button",{className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",onClick:()=>{e("/settings"),s(!1)},children:"Settings"}),R.jsx("button",{onClick:ae,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Sign out"})]})]})})]})})})},qye=({children:t})=>{const[e]=xu();return["/login","/register","/"].includes(e)?R.jsx(R.Fragment,{children:t}):R.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:R.jsxs("div",{className:"flex h-screen overflow-hidden",children:[R.jsx(Wye,{}),R.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[R.jsx($ye,{}),R.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900 p-3 sm:p-4 md:p-6",children:R.jsx("div",{className:"max-w-7xl mx-auto w-full",children:R.jsx("div",{className:"px-2 sm:px-4 md:px-6",children:t})})})]})]})})};function Di(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function Gye(t,e){const n=se.createContext(e),r=l=>{const{children:u,...s}=l,v=se.useMemo(()=>s,Object.values(s));return R.jsx(n.Provider,{value:v,children:u})};r.displayName=t+"Provider";function i(l){const u=se.useContext(n);if(u)return u;if(e!==void 0)return e;throw new Error(`\`${l}\` must be used within \`${t}\``)}return[r,i]}function M_(t,e=[]){let n=[];function r(l,u){const s=se.createContext(u),v=n.length;n=[...n,u];const w=F=>{const{scope:W,children:K,...Q}=F,Z=W?.[t]?.[v]||s,oe=se.useMemo(()=>Q,Object.values(Q));return R.jsx(Z.Provider,{value:oe,children:K})};w.displayName=l+"Provider";function A(F,W){const K=W?.[t]?.[v]||s,Q=se.useContext(K);if(Q)return Q;if(u!==void 0)return u;throw new Error(`\`${F}\` must be used within \`${l}\``)}return[w,A]}const i=()=>{const l=n.map(u=>se.createContext(u));return function(s){const v=s?.[t]||l;return se.useMemo(()=>({[`__scope${t}`]:{...s,[t]:v}}),[s,v])}};return i.scopeName=t,[r,Yye(i,...e)]}function Yye(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(l){const u=r.reduce((s,{useScope:v,scopeName:w})=>{const F=v(l)[`__scope${w}`];return{...s,...F}},{});return se.useMemo(()=>({[`__scope${e.scopeName}`]:u}),[u])}};return n.scopeName=e.scopeName,n}function SU(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function NK(...t){return e=>{let n=!1;const r=t.map(i=>{const l=SU(i,e);return!n&&typeof l=="function"&&(n=!0),l});if(n)return()=>{for(let i=0;i<r.length;i++){const l=r[i];typeof l=="function"?l():SU(t[i],null)}}}}function No(...t){return se.useCallback(NK(...t),t)}function ex(t){const e=Kye(t),n=se.forwardRef((r,i)=>{const{children:l,...u}=r,s=se.Children.toArray(l),v=s.find(Qye);if(v){const w=v.props.children,A=s.map(F=>F===v?se.Children.count(w)>1?se.Children.only(null):se.isValidElement(w)?w.props.children:null:F);return R.jsx(e,{...u,ref:i,children:se.isValidElement(w)?se.cloneElement(w,void 0,A):null})}return R.jsx(e,{...u,ref:i,children:l})});return n.displayName=`${t}.Slot`,n}var Xye=ex("Slot");function Kye(t){const e=se.forwardRef((n,r)=>{const{children:i,...l}=n;if(se.isValidElement(i)){const u=exe(i),s=Jye(l,i.props);return i.type!==se.Fragment&&(s.ref=r?NK(r,u):u),se.cloneElement(i,s)}return se.Children.count(i)>1?se.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Zye=Symbol("radix.slottable");function Qye(t){return se.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Zye}function Jye(t,e){const n={...e};for(const r in e){const i=t[r],l=e[r];/^on[A-Z]/.test(r)?i&&l?n[r]=(...s)=>{l(...s),i(...s)}:i&&(n[r]=i):r==="style"?n[r]={...i,...l}:r==="className"&&(n[r]=[i,l].filter(Boolean).join(" "))}return{...t,...n}}function exe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function b4(t){const e=t+"CollectionProvider",[n,r]=M_(e),[i,l]=n(e,{collectionRef:{current:null},itemMap:new Map}),u=Z=>{const{scope:oe,children:ae}=Z,me=fa.useRef(null),pe=fa.useRef(new Map).current;return R.jsx(i,{scope:oe,itemMap:pe,collectionRef:me,children:ae})};u.displayName=e;const s=t+"CollectionSlot",v=ex(s),w=fa.forwardRef((Z,oe)=>{const{scope:ae,children:me}=Z,pe=l(s,ae),_e=No(oe,pe.collectionRef);return R.jsx(v,{ref:_e,children:me})});w.displayName=s;const A=t+"CollectionItemSlot",F="data-radix-collection-item",W=ex(A),K=fa.forwardRef((Z,oe)=>{const{scope:ae,children:me,...pe}=Z,_e=fa.useRef(null),De=No(oe,_e),Ae=l(A,ae);return fa.useEffect(()=>(Ae.itemMap.set(_e,{ref:_e,...pe}),()=>void Ae.itemMap.delete(_e))),R.jsx(W,{[F]:"",ref:De,children:me})});K.displayName=A;function Q(Z){const oe=l(t+"CollectionConsumer",Z);return fa.useCallback(()=>{const me=oe.collectionRef.current;if(!me)return[];const pe=Array.from(me.querySelectorAll(`[${F}]`));return Array.from(oe.itemMap.values()).sort((Ae,re)=>pe.indexOf(Ae.ref.current)-pe.indexOf(re.ref.current))},[oe.collectionRef,oe.itemMap])}return[{Provider:u,Slot:w,ItemSlot:K},Q,r]}var Rl=globalThis?.document?se.useLayoutEffect:()=>{},txe=Dy[" useId ".trim().toString()]||(()=>{}),nxe=0;function cm(t){const[e,n]=se.useState(txe());return Rl(()=>{n(r=>r??String(nxe++))},[t]),e?`radix-${e}`:""}var rxe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Xi=rxe.reduce((t,e)=>{const n=ex(`Primitive.${e}`),r=se.forwardRef((i,l)=>{const{asChild:u,...s}=i,v=u?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),R.jsx(v,{...s,ref:l})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function OK(t,e){t&&Nm.flushSync(()=>t.dispatchEvent(e))}function Yu(t){const e=se.useRef(t);return se.useEffect(()=>{e.current=t}),se.useMemo(()=>(...n)=>e.current?.(...n),[])}var ixe=Dy[" useInsertionEffect ".trim().toString()]||Rl;function tx({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[i,l,u]=sxe({defaultProp:e,onChange:n}),s=t!==void 0,v=s?t:i;{const A=se.useRef(t!==void 0);se.useEffect(()=>{const F=A.current;F!==s&&console.warn(`${r} is changing from ${F?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),A.current=s},[s,r])}const w=se.useCallback(A=>{if(s){const F=oxe(A)?A(t):A;F!==t&&u.current?.(F)}else l(A)},[s,t,l,u]);return[v,w]}function sxe({defaultProp:t,onChange:e}){const[n,r]=se.useState(t),i=se.useRef(n),l=se.useRef(e);return ixe(()=>{l.current=e},[e]),se.useEffect(()=>{i.current!==n&&(l.current?.(n),i.current=n)},[n,i]),[n,r,l]}function oxe(t){return typeof t=="function"}var axe=se.createContext(void 0);function w4(t){const e=se.useContext(axe);return t||e||"ltr"}var ND="rovingFocusGroup.onEntryFocus",lxe={bubbles:!1,cancelable:!0},v2="RovingFocusGroup",[aN,LK,cxe]=b4(v2),[uxe,FK]=M_(v2,[cxe]),[hxe,dxe]=uxe(v2),BK=se.forwardRef((t,e)=>R.jsx(aN.Provider,{scope:t.__scopeRovingFocusGroup,children:R.jsx(aN.Slot,{scope:t.__scopeRovingFocusGroup,children:R.jsx(fxe,{...t,ref:e})})}));BK.displayName=v2;var fxe=se.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:l,currentTabStopId:u,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:v,onEntryFocus:w,preventScrollOnEntryFocus:A=!1,...F}=t,W=se.useRef(null),K=No(e,W),Q=w4(l),[Z,oe]=tx({prop:u,defaultProp:s??null,onChange:v,caller:v2}),[ae,me]=se.useState(!1),pe=Yu(w),_e=LK(n),De=se.useRef(!1),[Ae,re]=se.useState(0);return se.useEffect(()=>{const fe=W.current;if(fe)return fe.addEventListener(ND,pe),()=>fe.removeEventListener(ND,pe)},[pe]),R.jsx(hxe,{scope:n,orientation:r,dir:Q,loop:i,currentTabStopId:Z,onItemFocus:se.useCallback(fe=>oe(fe),[oe]),onItemShiftTab:se.useCallback(()=>me(!0),[]),onFocusableItemAdd:se.useCallback(()=>re(fe=>fe+1),[]),onFocusableItemRemove:se.useCallback(()=>re(fe=>fe-1),[]),children:R.jsx(Xi.div,{tabIndex:ae||Ae===0?-1:0,"data-orientation":r,...F,ref:K,style:{outline:"none",...t.style},onMouseDown:Di(t.onMouseDown,()=>{De.current=!0}),onFocus:Di(t.onFocus,fe=>{const ye=!De.current;if(fe.target===fe.currentTarget&&ye&&!ae){const ue=new CustomEvent(ND,lxe);if(fe.currentTarget.dispatchEvent(ue),!ue.defaultPrevented){const Ie=_e().filter(bt=>bt.focusable),Oe=Ie.find(bt=>bt.active),ze=Ie.find(bt=>bt.id===Z),He=[Oe,ze,...Ie].filter(Boolean).map(bt=>bt.ref.current);VK(He,A)}}De.current=!1}),onBlur:Di(t.onBlur,()=>me(!1))})})}),zK="RovingFocusGroupItem",jK=se.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:l,children:u,...s}=t,v=cm(),w=l||v,A=dxe(zK,n),F=A.currentTabStopId===w,W=LK(n),{onFocusableItemAdd:K,onFocusableItemRemove:Q,currentTabStopId:Z}=A;return se.useEffect(()=>{if(r)return K(),()=>Q()},[r,K,Q]),R.jsx(aN.ItemSlot,{scope:n,id:w,focusable:r,active:i,children:R.jsx(Xi.span,{tabIndex:F?0:-1,"data-orientation":A.orientation,...s,ref:e,onMouseDown:Di(t.onMouseDown,oe=>{r?A.onItemFocus(w):oe.preventDefault()}),onFocus:Di(t.onFocus,()=>A.onItemFocus(w)),onKeyDown:Di(t.onKeyDown,oe=>{if(oe.key==="Tab"&&oe.shiftKey){A.onItemShiftTab();return}if(oe.target!==oe.currentTarget)return;const ae=gxe(oe,A.orientation,A.dir);if(ae!==void 0){if(oe.metaKey||oe.ctrlKey||oe.altKey||oe.shiftKey)return;oe.preventDefault();let pe=W().filter(_e=>_e.focusable).map(_e=>_e.ref.current);if(ae==="last")pe.reverse();else if(ae==="prev"||ae==="next"){ae==="prev"&&pe.reverse();const _e=pe.indexOf(oe.currentTarget);pe=A.loop?_xe(pe,_e+1):pe.slice(_e+1)}setTimeout(()=>VK(pe))}}),children:typeof u=="function"?u({isCurrentTabStop:F,hasTabStop:Z!=null}):u})})});jK.displayName=zK;var pxe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function mxe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function gxe(t,e,n){const r=mxe(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return pxe[r]}function VK(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function _xe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var yxe=BK,xxe=jK;function vxe(t,e){return se.useReducer((n,r)=>e[n][r]??n,t)}var Ix=t=>{const{present:e,children:n}=t,r=bxe(e),i=typeof n=="function"?n({present:r.isPresent}):se.Children.only(n),l=No(r.ref,wxe(i));return typeof n=="function"||r.isPresent?se.cloneElement(i,{ref:l}):null};Ix.displayName="Presence";function bxe(t){const[e,n]=se.useState(),r=se.useRef({}),i=se.useRef(t),l=se.useRef("none"),u=t?"mounted":"unmounted",[s,v]=vxe(u,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return se.useEffect(()=>{const w=VS(r.current);l.current=s==="mounted"?w:"none"},[s]),Rl(()=>{const w=r.current,A=i.current;if(A!==t){const W=l.current,K=VS(w);t?v("MOUNT"):K==="none"||w?.display==="none"?v("UNMOUNT"):v(A&&W!==K?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,v]),Rl(()=>{if(e){let w;const A=e.ownerDocument.defaultView??window,F=K=>{const Z=VS(r.current).includes(K.animationName);if(K.target===e&&Z&&(v("ANIMATION_END"),!i.current)){const oe=e.style.animationFillMode;e.style.animationFillMode="forwards",w=A.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=oe)})}},W=K=>{K.target===e&&(l.current=VS(r.current))};return e.addEventListener("animationstart",W),e.addEventListener("animationcancel",F),e.addEventListener("animationend",F),()=>{A.clearTimeout(w),e.removeEventListener("animationstart",W),e.removeEventListener("animationcancel",F),e.removeEventListener("animationend",F)}}else v("ANIMATION_END")},[e,v]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:se.useCallback(w=>{w&&(r.current=getComputedStyle(w)),n(w)},[])}}function VS(t){return t?.animationName||"none"}function wxe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var jA="Tabs",[Exe,q5e]=M_(jA,[FK]),UK=FK(),[Sxe,E4]=Exe(jA),HK=se.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,onValueChange:i,defaultValue:l,orientation:u="horizontal",dir:s,activationMode:v="automatic",...w}=t,A=w4(s),[F,W]=tx({prop:r,onChange:i,defaultProp:l??"",caller:jA});return R.jsx(Sxe,{scope:n,baseId:cm(),value:F,onValueChange:W,orientation:u,dir:A,activationMode:v,children:R.jsx(Xi.div,{dir:A,"data-orientation":u,...w,ref:e})})});HK.displayName=jA;var WK="TabsList",$K=se.forwardRef((t,e)=>{const{__scopeTabs:n,loop:r=!0,...i}=t,l=E4(WK,n),u=UK(n);return R.jsx(yxe,{asChild:!0,...u,orientation:l.orientation,dir:l.dir,loop:r,children:R.jsx(Xi.div,{role:"tablist","aria-orientation":l.orientation,...i,ref:e})})});$K.displayName=WK;var qK="TabsTrigger",GK=se.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,disabled:i=!1,...l}=t,u=E4(qK,n),s=UK(n),v=KK(u.baseId,r),w=ZK(u.baseId,r),A=r===u.value;return R.jsx(xxe,{asChild:!0,...s,focusable:!i,active:A,children:R.jsx(Xi.button,{type:"button",role:"tab","aria-selected":A,"aria-controls":w,"data-state":A?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:v,...l,ref:e,onMouseDown:Di(t.onMouseDown,F=>{!i&&F.button===0&&F.ctrlKey===!1?u.onValueChange(r):F.preventDefault()}),onKeyDown:Di(t.onKeyDown,F=>{[" ","Enter"].includes(F.key)&&u.onValueChange(r)}),onFocus:Di(t.onFocus,()=>{const F=u.activationMode!=="manual";!A&&!i&&F&&u.onValueChange(r)})})})});GK.displayName=qK;var YK="TabsContent",XK=se.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,forceMount:i,children:l,...u}=t,s=E4(YK,n),v=KK(s.baseId,r),w=ZK(s.baseId,r),A=r===s.value,F=se.useRef(A);return se.useEffect(()=>{const W=requestAnimationFrame(()=>F.current=!1);return()=>cancelAnimationFrame(W)},[]),R.jsx(Ix,{present:i||A,children:({present:W})=>R.jsx(Xi.div,{"data-state":A?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":v,hidden:!W,id:w,tabIndex:0,...u,ref:e,style:{...t.style,animationDuration:F.current?"0s":void 0},children:W&&l})})});XK.displayName=YK;function KK(t,e){return`${t}-trigger-${e}`}function ZK(t,e){return`${t}-content-${e}`}var Txe=HK,QK=$K,JK=GK,eZ=XK;function tZ(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=tZ(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Fr(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=tZ(t))&&(r&&(r+=" "),r+=e);return r}const S4="-",Cxe=t=>{const e=Axe(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:u=>{const s=u.split(S4);return s[0]===""&&s.length!==1&&s.shift(),nZ(s,e)||Ixe(u)},getConflictingClassGroupIds:(u,s)=>{const v=n[u]||[];return s&&r[u]?[...v,...r[u]]:v}}},nZ=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),i=r?nZ(t.slice(1),r):void 0;if(i)return i;if(e.validators.length===0)return;const l=t.join(S4);return e.validators.find(({validator:u})=>u(l))?.classGroupId},TU=/^\[(.+)\]$/,Ixe=t=>{if(TU.test(t)){const e=TU.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},Axe=t=>{const{theme:e,classGroups:n}=t,r={nextPart:new Map,validators:[]};for(const i in n)lN(n[i],r,i,e);return r},lN=(t,e,n,r)=>{t.forEach(i=>{if(typeof i=="string"){const l=i===""?e:CU(e,i);l.classGroupId=n;return}if(typeof i=="function"){if(Rxe(i)){lN(i(r),e,n,r);return}e.validators.push({validator:i,classGroupId:n});return}Object.entries(i).forEach(([l,u])=>{lN(u,CU(e,l),n,r)})})},CU=(t,e)=>{let n=t;return e.split(S4).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},Rxe=t=>t.isThemeGetter,Mxe=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const i=(l,u)=>{n.set(l,u),e++,e>t&&(e=0,r=n,n=new Map)};return{get(l){let u=n.get(l);if(u!==void 0)return u;if((u=r.get(l))!==void 0)return i(l,u),u},set(l,u){n.has(l)?n.set(l,u):i(l,u)}}},cN="!",uN=":",Pxe=uN.length,Dxe=t=>{const{prefix:e,experimentalParseClassName:n}=t;let r=i=>{const l=[];let u=0,s=0,v=0,w;for(let Q=0;Q<i.length;Q++){let Z=i[Q];if(u===0&&s===0){if(Z===uN){l.push(i.slice(v,Q)),v=Q+Pxe;continue}if(Z==="/"){w=Q;continue}}Z==="["?u++:Z==="]"?u--:Z==="("?s++:Z===")"&&s--}const A=l.length===0?i:i.substring(v),F=kxe(A),W=F!==A,K=w&&w>v?w-v:void 0;return{modifiers:l,hasImportantModifier:W,baseClassName:F,maybePostfixModifierPosition:K}};if(e){const i=e+uN,l=r;r=u=>u.startsWith(i)?l(u.substring(i.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:u,maybePostfixModifierPosition:void 0}}if(n){const i=r;r=l=>n({className:l,parseClassName:i})}return r},kxe=t=>t.endsWith(cN)?t.substring(0,t.length-1):t.startsWith(cN)?t.substring(1):t,Nxe=t=>{const e=Object.fromEntries(t.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const i=[];let l=[];return r.forEach(u=>{u[0]==="["||e[u]?(i.push(...l.sort(),u),l=[]):l.push(u)}),i.push(...l.sort()),i}},Oxe=t=>({cache:Mxe(t.cacheSize),parseClassName:Dxe(t),sortModifiers:Nxe(t),...Cxe(t)}),Lxe=/\s+/,Fxe=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:i,sortModifiers:l}=e,u=[],s=t.trim().split(Lxe);let v="";for(let w=s.length-1;w>=0;w-=1){const A=s[w],{isExternal:F,modifiers:W,hasImportantModifier:K,baseClassName:Q,maybePostfixModifierPosition:Z}=n(A);if(F){v=A+(v.length>0?" "+v:v);continue}let oe=!!Z,ae=r(oe?Q.substring(0,Z):Q);if(!ae){if(!oe){v=A+(v.length>0?" "+v:v);continue}if(ae=r(Q),!ae){v=A+(v.length>0?" "+v:v);continue}oe=!1}const me=l(W).join(":"),pe=K?me+cN:me,_e=pe+ae;if(u.includes(_e))continue;u.push(_e);const De=i(ae,oe);for(let Ae=0;Ae<De.length;++Ae){const re=De[Ae];u.push(pe+re)}v=A+(v.length>0?" "+v:v)}return v};function Bxe(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=rZ(e))&&(r&&(r+=" "),r+=n);return r}const rZ=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=rZ(t[r]))&&(n&&(n+=" "),n+=e);return n};function zxe(t,...e){let n,r,i,l=u;function u(v){const w=e.reduce((A,F)=>F(A),t());return n=Oxe(w),r=n.cache.get,i=n.cache.set,l=s,s(v)}function s(v){const w=r(v);if(w)return w;const A=Fxe(v,n);return i(v,A),A}return function(){return l(Bxe.apply(null,arguments))}}const qa=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},iZ=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,sZ=/^\((?:(\w[\w-]*):)?(.+)\)$/i,jxe=/^\d+\/\d+$/,Vxe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Uxe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Hxe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Wxe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,$xe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,D0=t=>jxe.test(t),qi=t=>!!t&&!Number.isNaN(Number(t)),Ap=t=>!!t&&Number.isInteger(Number(t)),OD=t=>t.endsWith("%")&&qi(t.slice(0,-1)),Qd=t=>Vxe.test(t),qxe=()=>!0,Gxe=t=>Uxe.test(t)&&!Hxe.test(t),oZ=()=>!1,Yxe=t=>Wxe.test(t),Xxe=t=>$xe.test(t),Kxe=t=>!Dr(t)&&!kr(t),Zxe=t=>Ax(t,cZ,oZ),Dr=t=>iZ.test(t),Eg=t=>Ax(t,uZ,Gxe),LD=t=>Ax(t,n1e,qi),IU=t=>Ax(t,aZ,oZ),Qxe=t=>Ax(t,lZ,Xxe),US=t=>Ax(t,hZ,Yxe),kr=t=>sZ.test(t),Dv=t=>Rx(t,uZ),Jxe=t=>Rx(t,r1e),AU=t=>Rx(t,aZ),e1e=t=>Rx(t,cZ),t1e=t=>Rx(t,lZ),HS=t=>Rx(t,hZ,!0),Ax=(t,e,n)=>{const r=iZ.exec(t);return r?r[1]?e(r[1]):n(r[2]):!1},Rx=(t,e,n=!1)=>{const r=sZ.exec(t);return r?r[1]?e(r[1]):n:!1},aZ=t=>t==="position"||t==="percentage",lZ=t=>t==="image"||t==="url",cZ=t=>t==="length"||t==="size"||t==="bg-size",uZ=t=>t==="length",n1e=t=>t==="number",r1e=t=>t==="family-name",hZ=t=>t==="shadow",i1e=()=>{const t=qa("color"),e=qa("font"),n=qa("text"),r=qa("font-weight"),i=qa("tracking"),l=qa("leading"),u=qa("breakpoint"),s=qa("container"),v=qa("spacing"),w=qa("radius"),A=qa("shadow"),F=qa("inset-shadow"),W=qa("text-shadow"),K=qa("drop-shadow"),Q=qa("blur"),Z=qa("perspective"),oe=qa("aspect"),ae=qa("ease"),me=qa("animate"),pe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],_e=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],De=()=>[..._e(),kr,Dr],Ae=()=>["auto","hidden","clip","visible","scroll"],re=()=>["auto","contain","none"],fe=()=>[kr,Dr,v],ye=()=>[D0,"full","auto",...fe()],ue=()=>[Ap,"none","subgrid",kr,Dr],Ie=()=>["auto",{span:["full",Ap,kr,Dr]},Ap,kr,Dr],Oe=()=>[Ap,"auto",kr,Dr],ze=()=>["auto","min","max","fr",kr,Dr],ft=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],He=()=>["start","end","center","stretch","center-safe","end-safe"],bt=()=>["auto",...fe()],Nt=()=>[D0,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...fe()],wt=()=>[t,kr,Dr],it=()=>[..._e(),AU,IU,{position:[kr,Dr]}],nn=()=>["no-repeat",{repeat:["","x","y","space","round"]}],In=()=>["auto","cover","contain",e1e,Zxe,{size:[kr,Dr]}],wn=()=>[OD,Dv,Eg],Xt=()=>["","none","full",w,kr,Dr],On=()=>["",qi,Dv,Eg],cr=()=>["solid","dashed","dotted","double"],En=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],fn=()=>[qi,OD,AU,IU],ur=()=>["","none",Q,kr,Dr],br=()=>["none",qi,kr,Dr],Pe=()=>["none",qi,kr,Dr],jn=()=>[qi,kr,Dr],rr=()=>[D0,"full",...fe()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Qd],breakpoint:[Qd],color:[qxe],container:[Qd],"drop-shadow":[Qd],ease:["in","out","in-out"],font:[Kxe],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Qd],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Qd],shadow:[Qd],spacing:["px",qi],text:[Qd],"text-shadow":[Qd],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",D0,Dr,kr,oe]}],container:["container"],columns:[{columns:[qi,Dr,kr,s]}],"break-after":[{"break-after":pe()}],"break-before":[{"break-before":pe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:De()}],overflow:[{overflow:Ae()}],"overflow-x":[{"overflow-x":Ae()}],"overflow-y":[{"overflow-y":Ae()}],overscroll:[{overscroll:re()}],"overscroll-x":[{"overscroll-x":re()}],"overscroll-y":[{"overscroll-y":re()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:ye()}],"inset-x":[{"inset-x":ye()}],"inset-y":[{"inset-y":ye()}],start:[{start:ye()}],end:[{end:ye()}],top:[{top:ye()}],right:[{right:ye()}],bottom:[{bottom:ye()}],left:[{left:ye()}],visibility:["visible","invisible","collapse"],z:[{z:[Ap,"auto",kr,Dr]}],basis:[{basis:[D0,"full","auto",s,...fe()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[qi,D0,"auto","initial","none",Dr]}],grow:[{grow:["",qi,kr,Dr]}],shrink:[{shrink:["",qi,kr,Dr]}],order:[{order:[Ap,"first","last","none",kr,Dr]}],"grid-cols":[{"grid-cols":ue()}],"col-start-end":[{col:Ie()}],"col-start":[{"col-start":Oe()}],"col-end":[{"col-end":Oe()}],"grid-rows":[{"grid-rows":ue()}],"row-start-end":[{row:Ie()}],"row-start":[{"row-start":Oe()}],"row-end":[{"row-end":Oe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ze()}],"auto-rows":[{"auto-rows":ze()}],gap:[{gap:fe()}],"gap-x":[{"gap-x":fe()}],"gap-y":[{"gap-y":fe()}],"justify-content":[{justify:[...ft(),"normal"]}],"justify-items":[{"justify-items":[...He(),"normal"]}],"justify-self":[{"justify-self":["auto",...He()]}],"align-content":[{content:["normal",...ft()]}],"align-items":[{items:[...He(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...He(),{baseline:["","last"]}]}],"place-content":[{"place-content":ft()}],"place-items":[{"place-items":[...He(),"baseline"]}],"place-self":[{"place-self":["auto",...He()]}],p:[{p:fe()}],px:[{px:fe()}],py:[{py:fe()}],ps:[{ps:fe()}],pe:[{pe:fe()}],pt:[{pt:fe()}],pr:[{pr:fe()}],pb:[{pb:fe()}],pl:[{pl:fe()}],m:[{m:bt()}],mx:[{mx:bt()}],my:[{my:bt()}],ms:[{ms:bt()}],me:[{me:bt()}],mt:[{mt:bt()}],mr:[{mr:bt()}],mb:[{mb:bt()}],ml:[{ml:bt()}],"space-x":[{"space-x":fe()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":fe()}],"space-y-reverse":["space-y-reverse"],size:[{size:Nt()}],w:[{w:[s,"screen",...Nt()]}],"min-w":[{"min-w":[s,"screen","none",...Nt()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[u]},...Nt()]}],h:[{h:["screen",...Nt()]}],"min-h":[{"min-h":["screen","none",...Nt()]}],"max-h":[{"max-h":["screen",...Nt()]}],"font-size":[{text:["base",n,Dv,Eg]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,kr,LD]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",OD,Dr]}],"font-family":[{font:[Jxe,Dr,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,kr,Dr]}],"line-clamp":[{"line-clamp":[qi,"none",kr,LD]}],leading:[{leading:[l,...fe()]}],"list-image":[{"list-image":["none",kr,Dr]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",kr,Dr]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:wt()}],"text-color":[{text:wt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...cr(),"wavy"]}],"text-decoration-thickness":[{decoration:[qi,"from-font","auto",kr,Eg]}],"text-decoration-color":[{decoration:wt()}],"underline-offset":[{"underline-offset":[qi,"auto",kr,Dr]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:fe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",kr,Dr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",kr,Dr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:it()}],"bg-repeat":[{bg:nn()}],"bg-size":[{bg:In()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Ap,kr,Dr],radial:["",kr,Dr],conic:[Ap,kr,Dr]},t1e,Qxe]}],"bg-color":[{bg:wt()}],"gradient-from-pos":[{from:wn()}],"gradient-via-pos":[{via:wn()}],"gradient-to-pos":[{to:wn()}],"gradient-from":[{from:wt()}],"gradient-via":[{via:wt()}],"gradient-to":[{to:wt()}],rounded:[{rounded:Xt()}],"rounded-s":[{"rounded-s":Xt()}],"rounded-e":[{"rounded-e":Xt()}],"rounded-t":[{"rounded-t":Xt()}],"rounded-r":[{"rounded-r":Xt()}],"rounded-b":[{"rounded-b":Xt()}],"rounded-l":[{"rounded-l":Xt()}],"rounded-ss":[{"rounded-ss":Xt()}],"rounded-se":[{"rounded-se":Xt()}],"rounded-ee":[{"rounded-ee":Xt()}],"rounded-es":[{"rounded-es":Xt()}],"rounded-tl":[{"rounded-tl":Xt()}],"rounded-tr":[{"rounded-tr":Xt()}],"rounded-br":[{"rounded-br":Xt()}],"rounded-bl":[{"rounded-bl":Xt()}],"border-w":[{border:On()}],"border-w-x":[{"border-x":On()}],"border-w-y":[{"border-y":On()}],"border-w-s":[{"border-s":On()}],"border-w-e":[{"border-e":On()}],"border-w-t":[{"border-t":On()}],"border-w-r":[{"border-r":On()}],"border-w-b":[{"border-b":On()}],"border-w-l":[{"border-l":On()}],"divide-x":[{"divide-x":On()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":On()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...cr(),"hidden","none"]}],"divide-style":[{divide:[...cr(),"hidden","none"]}],"border-color":[{border:wt()}],"border-color-x":[{"border-x":wt()}],"border-color-y":[{"border-y":wt()}],"border-color-s":[{"border-s":wt()}],"border-color-e":[{"border-e":wt()}],"border-color-t":[{"border-t":wt()}],"border-color-r":[{"border-r":wt()}],"border-color-b":[{"border-b":wt()}],"border-color-l":[{"border-l":wt()}],"divide-color":[{divide:wt()}],"outline-style":[{outline:[...cr(),"none","hidden"]}],"outline-offset":[{"outline-offset":[qi,kr,Dr]}],"outline-w":[{outline:["",qi,Dv,Eg]}],"outline-color":[{outline:wt()}],shadow:[{shadow:["","none",A,HS,US]}],"shadow-color":[{shadow:wt()}],"inset-shadow":[{"inset-shadow":["none",F,HS,US]}],"inset-shadow-color":[{"inset-shadow":wt()}],"ring-w":[{ring:On()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:wt()}],"ring-offset-w":[{"ring-offset":[qi,Eg]}],"ring-offset-color":[{"ring-offset":wt()}],"inset-ring-w":[{"inset-ring":On()}],"inset-ring-color":[{"inset-ring":wt()}],"text-shadow":[{"text-shadow":["none",W,HS,US]}],"text-shadow-color":[{"text-shadow":wt()}],opacity:[{opacity:[qi,kr,Dr]}],"mix-blend":[{"mix-blend":[...En(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":En()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[qi]}],"mask-image-linear-from-pos":[{"mask-linear-from":fn()}],"mask-image-linear-to-pos":[{"mask-linear-to":fn()}],"mask-image-linear-from-color":[{"mask-linear-from":wt()}],"mask-image-linear-to-color":[{"mask-linear-to":wt()}],"mask-image-t-from-pos":[{"mask-t-from":fn()}],"mask-image-t-to-pos":[{"mask-t-to":fn()}],"mask-image-t-from-color":[{"mask-t-from":wt()}],"mask-image-t-to-color":[{"mask-t-to":wt()}],"mask-image-r-from-pos":[{"mask-r-from":fn()}],"mask-image-r-to-pos":[{"mask-r-to":fn()}],"mask-image-r-from-color":[{"mask-r-from":wt()}],"mask-image-r-to-color":[{"mask-r-to":wt()}],"mask-image-b-from-pos":[{"mask-b-from":fn()}],"mask-image-b-to-pos":[{"mask-b-to":fn()}],"mask-image-b-from-color":[{"mask-b-from":wt()}],"mask-image-b-to-color":[{"mask-b-to":wt()}],"mask-image-l-from-pos":[{"mask-l-from":fn()}],"mask-image-l-to-pos":[{"mask-l-to":fn()}],"mask-image-l-from-color":[{"mask-l-from":wt()}],"mask-image-l-to-color":[{"mask-l-to":wt()}],"mask-image-x-from-pos":[{"mask-x-from":fn()}],"mask-image-x-to-pos":[{"mask-x-to":fn()}],"mask-image-x-from-color":[{"mask-x-from":wt()}],"mask-image-x-to-color":[{"mask-x-to":wt()}],"mask-image-y-from-pos":[{"mask-y-from":fn()}],"mask-image-y-to-pos":[{"mask-y-to":fn()}],"mask-image-y-from-color":[{"mask-y-from":wt()}],"mask-image-y-to-color":[{"mask-y-to":wt()}],"mask-image-radial":[{"mask-radial":[kr,Dr]}],"mask-image-radial-from-pos":[{"mask-radial-from":fn()}],"mask-image-radial-to-pos":[{"mask-radial-to":fn()}],"mask-image-radial-from-color":[{"mask-radial-from":wt()}],"mask-image-radial-to-color":[{"mask-radial-to":wt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":_e()}],"mask-image-conic-pos":[{"mask-conic":[qi]}],"mask-image-conic-from-pos":[{"mask-conic-from":fn()}],"mask-image-conic-to-pos":[{"mask-conic-to":fn()}],"mask-image-conic-from-color":[{"mask-conic-from":wt()}],"mask-image-conic-to-color":[{"mask-conic-to":wt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:it()}],"mask-repeat":[{mask:nn()}],"mask-size":[{mask:In()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",kr,Dr]}],filter:[{filter:["","none",kr,Dr]}],blur:[{blur:ur()}],brightness:[{brightness:[qi,kr,Dr]}],contrast:[{contrast:[qi,kr,Dr]}],"drop-shadow":[{"drop-shadow":["","none",K,HS,US]}],"drop-shadow-color":[{"drop-shadow":wt()}],grayscale:[{grayscale:["",qi,kr,Dr]}],"hue-rotate":[{"hue-rotate":[qi,kr,Dr]}],invert:[{invert:["",qi,kr,Dr]}],saturate:[{saturate:[qi,kr,Dr]}],sepia:[{sepia:["",qi,kr,Dr]}],"backdrop-filter":[{"backdrop-filter":["","none",kr,Dr]}],"backdrop-blur":[{"backdrop-blur":ur()}],"backdrop-brightness":[{"backdrop-brightness":[qi,kr,Dr]}],"backdrop-contrast":[{"backdrop-contrast":[qi,kr,Dr]}],"backdrop-grayscale":[{"backdrop-grayscale":["",qi,kr,Dr]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[qi,kr,Dr]}],"backdrop-invert":[{"backdrop-invert":["",qi,kr,Dr]}],"backdrop-opacity":[{"backdrop-opacity":[qi,kr,Dr]}],"backdrop-saturate":[{"backdrop-saturate":[qi,kr,Dr]}],"backdrop-sepia":[{"backdrop-sepia":["",qi,kr,Dr]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":fe()}],"border-spacing-x":[{"border-spacing-x":fe()}],"border-spacing-y":[{"border-spacing-y":fe()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",kr,Dr]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[qi,"initial",kr,Dr]}],ease:[{ease:["linear","initial",ae,kr,Dr]}],delay:[{delay:[qi,kr,Dr]}],animate:[{animate:["none",me,kr,Dr]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Z,kr,Dr]}],"perspective-origin":[{"perspective-origin":De()}],rotate:[{rotate:br()}],"rotate-x":[{"rotate-x":br()}],"rotate-y":[{"rotate-y":br()}],"rotate-z":[{"rotate-z":br()}],scale:[{scale:Pe()}],"scale-x":[{"scale-x":Pe()}],"scale-y":[{"scale-y":Pe()}],"scale-z":[{"scale-z":Pe()}],"scale-3d":["scale-3d"],skew:[{skew:jn()}],"skew-x":[{"skew-x":jn()}],"skew-y":[{"skew-y":jn()}],transform:[{transform:[kr,Dr,"","none","gpu","cpu"]}],"transform-origin":[{origin:De()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:rr()}],"translate-x":[{"translate-x":rr()}],"translate-y":[{"translate-y":rr()}],"translate-z":[{"translate-z":rr()}],"translate-none":["translate-none"],accent:[{accent:wt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:wt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",kr,Dr]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":fe()}],"scroll-mx":[{"scroll-mx":fe()}],"scroll-my":[{"scroll-my":fe()}],"scroll-ms":[{"scroll-ms":fe()}],"scroll-me":[{"scroll-me":fe()}],"scroll-mt":[{"scroll-mt":fe()}],"scroll-mr":[{"scroll-mr":fe()}],"scroll-mb":[{"scroll-mb":fe()}],"scroll-ml":[{"scroll-ml":fe()}],"scroll-p":[{"scroll-p":fe()}],"scroll-px":[{"scroll-px":fe()}],"scroll-py":[{"scroll-py":fe()}],"scroll-ps":[{"scroll-ps":fe()}],"scroll-pe":[{"scroll-pe":fe()}],"scroll-pt":[{"scroll-pt":fe()}],"scroll-pr":[{"scroll-pr":fe()}],"scroll-pb":[{"scroll-pb":fe()}],"scroll-pl":[{"scroll-pl":fe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",kr,Dr]}],fill:[{fill:["none",...wt()]}],"stroke-w":[{stroke:[qi,Dv,Eg,LD]}],stroke:[{stroke:["none",...wt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},s1e=zxe(i1e);function Fs(...t){return s1e(Fr(t))}const o1e=Txe,dZ=se.forwardRef(({className:t,...e},n)=>R.jsx(QK,{ref:n,className:Fs("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));dZ.displayName=QK.displayName;const hN=se.forwardRef(({className:t,...e},n)=>R.jsx(JK,{ref:n,className:Fs("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...e}));hN.displayName=JK.displayName;const dN=se.forwardRef(({className:t,...e},n)=>R.jsx(eZ,{ref:n,className:Fs("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));dN.displayName=eZ.displayName;const RU=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,MU=Fr,T4=(t,e)=>n=>{var r;if(e?.variants==null)return MU(t,n?.class,n?.className);const{variants:i,defaultVariants:l}=e,u=Object.keys(i).map(w=>{const A=n?.[w],F=l?.[w];if(A===null)return null;const W=RU(A)||RU(F);return i[w][W]}),s=n&&Object.entries(n).reduce((w,A)=>{let[F,W]=A;return W===void 0||(w[F]=W),w},{}),v=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((w,A)=>{let{class:F,className:W,...K}=A;return Object.entries(K).every(Q=>{let[Z,oe]=Q;return Array.isArray(oe)?oe.includes({...l,...s}[Z]):{...l,...s}[Z]===oe})?[...w,F,W]:w},[]);return MU(t,u,v,n?.class,n?.className)},a1e=T4("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Bi=se.forwardRef(({className:t,variant:e,size:n,asChild:r=!1,...i},l)=>{const u=r?Xye:"button";return R.jsx(u,{className:Fs(a1e({variant:e,size:n,className:t})),ref:l,...i})});Bi.displayName="Button";const Sh=se.forwardRef(({className:t,type:e,...n},r)=>R.jsx("input",{type:e,className:Fs("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n}));Sh.displayName="Input";var l1e="Label",fZ=se.forwardRef((t,e)=>R.jsx(Xi.label,{...t,ref:e,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(t.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));fZ.displayName=l1e;var pZ=fZ;const c1e=T4("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),gc=se.forwardRef(({className:t,...e},n)=>R.jsx(pZ,{ref:n,className:Fs(c1e(),t),...e}));gc.displayName=pZ.displayName;const El=se.forwardRef(({className:t,...e},n)=>R.jsx("div",{ref:n,className:Fs("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));El.displayName="Card";const Sl=se.forwardRef(({className:t,...e},n)=>R.jsx("div",{ref:n,className:Fs("flex flex-col space-y-1.5 p-6",t),...e}));Sl.displayName="CardHeader";const Tl=se.forwardRef(({className:t,...e},n)=>R.jsx("h3",{ref:n,className:Fs("text-2xl font-semibold leading-none tracking-tight",t),...e}));Tl.displayName="CardTitle";const $p=se.forwardRef(({className:t,...e},n)=>R.jsx("p",{ref:n,className:Fs("text-sm text-muted-foreground",t),...e}));$p.displayName="CardDescription";const Ql=se.forwardRef(({className:t,...e},n)=>R.jsx("div",{ref:n,className:Fs("p-6 pt-0",t),...e}));Ql.displayName="CardContent";const u1e=se.forwardRef(({className:t,...e},n)=>R.jsx("div",{ref:n,className:Fs("flex items-center p-6 pt-0",t),...e}));u1e.displayName="CardFooter";function PU(t,[e,n]){return Math.min(n,Math.max(e,t))}function h1e(t,e=globalThis?.document){const n=Yu(t);se.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var d1e="DismissableLayer",fN="dismissableLayer.update",f1e="dismissableLayer.pointerDownOutside",p1e="dismissableLayer.focusOutside",DU,mZ=se.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),VA=se.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:l,onInteractOutside:u,onDismiss:s,...v}=t,w=se.useContext(mZ),[A,F]=se.useState(null),W=A?.ownerDocument??globalThis?.document,[,K]=se.useState({}),Q=No(e,re=>F(re)),Z=Array.from(w.layers),[oe]=[...w.layersWithOutsidePointerEventsDisabled].slice(-1),ae=Z.indexOf(oe),me=A?Z.indexOf(A):-1,pe=w.layersWithOutsidePointerEventsDisabled.size>0,_e=me>=ae,De=g1e(re=>{const fe=re.target,ye=[...w.branches].some(ue=>ue.contains(fe));!_e||ye||(i?.(re),u?.(re),re.defaultPrevented||s?.())},W),Ae=_1e(re=>{const fe=re.target;[...w.branches].some(ue=>ue.contains(fe))||(l?.(re),u?.(re),re.defaultPrevented||s?.())},W);return h1e(re=>{me===w.layers.size-1&&(r?.(re),!re.defaultPrevented&&s&&(re.preventDefault(),s()))},W),se.useEffect(()=>{if(A)return n&&(w.layersWithOutsidePointerEventsDisabled.size===0&&(DU=W.body.style.pointerEvents,W.body.style.pointerEvents="none"),w.layersWithOutsidePointerEventsDisabled.add(A)),w.layers.add(A),kU(),()=>{n&&w.layersWithOutsidePointerEventsDisabled.size===1&&(W.body.style.pointerEvents=DU)}},[A,W,n,w]),se.useEffect(()=>()=>{A&&(w.layers.delete(A),w.layersWithOutsidePointerEventsDisabled.delete(A),kU())},[A,w]),se.useEffect(()=>{const re=()=>K({});return document.addEventListener(fN,re),()=>document.removeEventListener(fN,re)},[]),R.jsx(Xi.div,{...v,ref:Q,style:{pointerEvents:pe?_e?"auto":"none":void 0,...t.style},onFocusCapture:Di(t.onFocusCapture,Ae.onFocusCapture),onBlurCapture:Di(t.onBlurCapture,Ae.onBlurCapture),onPointerDownCapture:Di(t.onPointerDownCapture,De.onPointerDownCapture)})});VA.displayName=d1e;var m1e="DismissableLayerBranch",gZ=se.forwardRef((t,e)=>{const n=se.useContext(mZ),r=se.useRef(null),i=No(e,r);return se.useEffect(()=>{const l=r.current;if(l)return n.branches.add(l),()=>{n.branches.delete(l)}},[n.branches]),R.jsx(Xi.div,{...t,ref:i})});gZ.displayName=m1e;function g1e(t,e=globalThis?.document){const n=Yu(t),r=se.useRef(!1),i=se.useRef(()=>{});return se.useEffect(()=>{const l=s=>{if(s.target&&!r.current){let v=function(){_Z(f1e,n,w,{discrete:!0})};const w={originalEvent:s};s.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=v,e.addEventListener("click",i.current,{once:!0})):v()}else e.removeEventListener("click",i.current);r.current=!1},u=window.setTimeout(()=>{e.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(u),e.removeEventListener("pointerdown",l),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function _1e(t,e=globalThis?.document){const n=Yu(t),r=se.useRef(!1);return se.useEffect(()=>{const i=l=>{l.target&&!r.current&&_Z(p1e,n,{originalEvent:l},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function kU(){const t=new CustomEvent(fN);document.dispatchEvent(t)}function _Z(t,e,n,{discrete:r}){const i=n.originalEvent.target,l=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?OK(i,l):i.dispatchEvent(l)}var y1e=VA,x1e=gZ,FD=0;function yZ(){se.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??NU()),document.body.insertAdjacentElement("beforeend",t[1]??NU()),FD++,()=>{FD===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),FD--}},[])}function NU(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var BD="focusScope.autoFocusOnMount",zD="focusScope.autoFocusOnUnmount",OU={bubbles:!1,cancelable:!0},v1e="FocusScope",C4=se.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:l,...u}=t,[s,v]=se.useState(null),w=Yu(i),A=Yu(l),F=se.useRef(null),W=No(e,Z=>v(Z)),K=se.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;se.useEffect(()=>{if(r){let Z=function(pe){if(K.paused||!s)return;const _e=pe.target;s.contains(_e)?F.current=_e:Dp(F.current,{select:!0})},oe=function(pe){if(K.paused||!s)return;const _e=pe.relatedTarget;_e!==null&&(s.contains(_e)||Dp(F.current,{select:!0}))},ae=function(pe){if(document.activeElement===document.body)for(const De of pe)De.removedNodes.length>0&&Dp(s)};document.addEventListener("focusin",Z),document.addEventListener("focusout",oe);const me=new MutationObserver(ae);return s&&me.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Z),document.removeEventListener("focusout",oe),me.disconnect()}}},[r,s,K.paused]),se.useEffect(()=>{if(s){FU.add(K);const Z=document.activeElement;if(!s.contains(Z)){const ae=new CustomEvent(BD,OU);s.addEventListener(BD,w),s.dispatchEvent(ae),ae.defaultPrevented||(b1e(C1e(xZ(s)),{select:!0}),document.activeElement===Z&&Dp(s))}return()=>{s.removeEventListener(BD,w),setTimeout(()=>{const ae=new CustomEvent(zD,OU);s.addEventListener(zD,A),s.dispatchEvent(ae),ae.defaultPrevented||Dp(Z??document.body,{select:!0}),s.removeEventListener(zD,A),FU.remove(K)},0)}}},[s,w,A,K]);const Q=se.useCallback(Z=>{if(!n&&!r||K.paused)return;const oe=Z.key==="Tab"&&!Z.altKey&&!Z.ctrlKey&&!Z.metaKey,ae=document.activeElement;if(oe&&ae){const me=Z.currentTarget,[pe,_e]=w1e(me);pe&&_e?!Z.shiftKey&&ae===_e?(Z.preventDefault(),n&&Dp(pe,{select:!0})):Z.shiftKey&&ae===pe&&(Z.preventDefault(),n&&Dp(_e,{select:!0})):ae===me&&Z.preventDefault()}},[n,r,K.paused]);return R.jsx(Xi.div,{tabIndex:-1,...u,ref:W,onKeyDown:Q})});C4.displayName=v1e;function b1e(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Dp(r,{select:e}),document.activeElement!==n)return}function w1e(t){const e=xZ(t),n=LU(e,t),r=LU(e.reverse(),t);return[n,r]}function xZ(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function LU(t,e){for(const n of t)if(!E1e(n,{upTo:e}))return n}function E1e(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function S1e(t){return t instanceof HTMLInputElement&&"select"in t}function Dp(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&S1e(t)&&e&&t.select()}}var FU=T1e();function T1e(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=BU(t,e),t.unshift(e)},remove(e){t=BU(t,e),t[0]?.resume()}}}function BU(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function C1e(t){return t.filter(e=>e.tagName!=="A")}const I1e=["top","right","bottom","left"],Em=Math.min,au=Math.max,aI=Math.round,WS=Math.floor,Ad=t=>({x:t,y:t}),A1e={left:"right",right:"left",bottom:"top",top:"bottom"},R1e={start:"end",end:"start"};function pN(t,e,n){return au(t,Em(e,n))}function Df(t,e){return typeof t=="function"?t(e):t}function kf(t){return t.split("-")[0]}function Mx(t){return t.split("-")[1]}function I4(t){return t==="x"?"y":"x"}function A4(t){return t==="y"?"height":"width"}function Sm(t){return["top","bottom"].includes(kf(t))?"y":"x"}function R4(t){return I4(Sm(t))}function M1e(t,e,n){n===void 0&&(n=!1);const r=Mx(t),i=R4(t),l=A4(i);let u=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[l]>e.floating[l]&&(u=lI(u)),[u,lI(u)]}function P1e(t){const e=lI(t);return[mN(t),e,mN(e)]}function mN(t){return t.replace(/start|end/g,e=>R1e[e])}function D1e(t,e,n){const r=["left","right"],i=["right","left"],l=["top","bottom"],u=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:r:e?r:i;case"left":case"right":return e?l:u;default:return[]}}function k1e(t,e,n,r){const i=Mx(t);let l=D1e(kf(t),n==="start",r);return i&&(l=l.map(u=>u+"-"+i),e&&(l=l.concat(l.map(mN)))),l}function lI(t){return t.replace(/left|right|bottom|top/g,e=>A1e[e])}function N1e(t){return{top:0,right:0,bottom:0,left:0,...t}}function vZ(t){return typeof t!="number"?N1e(t):{top:t,right:t,bottom:t,left:t}}function cI(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}function zU(t,e,n){let{reference:r,floating:i}=t;const l=Sm(e),u=R4(e),s=A4(u),v=kf(e),w=l==="y",A=r.x+r.width/2-i.width/2,F=r.y+r.height/2-i.height/2,W=r[s]/2-i[s]/2;let K;switch(v){case"top":K={x:A,y:r.y-i.height};break;case"bottom":K={x:A,y:r.y+r.height};break;case"right":K={x:r.x+r.width,y:F};break;case"left":K={x:r.x-i.width,y:F};break;default:K={x:r.x,y:r.y}}switch(Mx(e)){case"start":K[u]-=W*(n&&w?-1:1);break;case"end":K[u]+=W*(n&&w?-1:1);break}return K}const O1e=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:l=[],platform:u}=n,s=l.filter(Boolean),v=await(u.isRTL==null?void 0:u.isRTL(e));let w=await u.getElementRects({reference:t,floating:e,strategy:i}),{x:A,y:F}=zU(w,r,v),W=r,K={},Q=0;for(let Z=0;Z<s.length;Z++){const{name:oe,fn:ae}=s[Z],{x:me,y:pe,data:_e,reset:De}=await ae({x:A,y:F,initialPlacement:r,placement:W,strategy:i,middlewareData:K,rects:w,platform:u,elements:{reference:t,floating:e}});A=me??A,F=pe??F,K={...K,[oe]:{...K[oe],..._e}},De&&Q<=50&&(Q++,typeof De=="object"&&(De.placement&&(W=De.placement),De.rects&&(w=De.rects===!0?await u.getElementRects({reference:t,floating:e,strategy:i}):De.rects),{x:A,y:F}=zU(w,W,v)),Z=-1)}return{x:A,y:F,placement:W,strategy:i,middlewareData:K}};async function Tw(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:l,rects:u,elements:s,strategy:v}=t,{boundary:w="clippingAncestors",rootBoundary:A="viewport",elementContext:F="floating",altBoundary:W=!1,padding:K=0}=Df(e,t),Q=vZ(K),oe=s[W?F==="floating"?"reference":"floating":F],ae=cI(await l.getClippingRect({element:(n=await(l.isElement==null?void 0:l.isElement(oe)))==null||n?oe:oe.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(s.floating)),boundary:w,rootBoundary:A,strategy:v})),me=F==="floating"?{x:r,y:i,width:u.floating.width,height:u.floating.height}:u.reference,pe=await(l.getOffsetParent==null?void 0:l.getOffsetParent(s.floating)),_e=await(l.isElement==null?void 0:l.isElement(pe))?await(l.getScale==null?void 0:l.getScale(pe))||{x:1,y:1}:{x:1,y:1},De=cI(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:me,offsetParent:pe,strategy:v}):me);return{top:(ae.top-De.top+Q.top)/_e.y,bottom:(De.bottom-ae.bottom+Q.bottom)/_e.y,left:(ae.left-De.left+Q.left)/_e.x,right:(De.right-ae.right+Q.right)/_e.x}}const L1e=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:l,platform:u,elements:s,middlewareData:v}=e,{element:w,padding:A=0}=Df(t,e)||{};if(w==null)return{};const F=vZ(A),W={x:n,y:r},K=R4(i),Q=A4(K),Z=await u.getDimensions(w),oe=K==="y",ae=oe?"top":"left",me=oe?"bottom":"right",pe=oe?"clientHeight":"clientWidth",_e=l.reference[Q]+l.reference[K]-W[K]-l.floating[Q],De=W[K]-l.reference[K],Ae=await(u.getOffsetParent==null?void 0:u.getOffsetParent(w));let re=Ae?Ae[pe]:0;(!re||!await(u.isElement==null?void 0:u.isElement(Ae)))&&(re=s.floating[pe]||l.floating[Q]);const fe=_e/2-De/2,ye=re/2-Z[Q]/2-1,ue=Em(F[ae],ye),Ie=Em(F[me],ye),Oe=ue,ze=re-Z[Q]-Ie,ft=re/2-Z[Q]/2+fe,He=pN(Oe,ft,ze),bt=!v.arrow&&Mx(i)!=null&&ft!==He&&l.reference[Q]/2-(ft<Oe?ue:Ie)-Z[Q]/2<0,Nt=bt?ft<Oe?ft-Oe:ft-ze:0;return{[K]:W[K]+Nt,data:{[K]:He,centerOffset:ft-He-Nt,...bt&&{alignmentOffset:Nt}},reset:bt}}}),F1e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:l,rects:u,initialPlacement:s,platform:v,elements:w}=e,{mainAxis:A=!0,crossAxis:F=!0,fallbackPlacements:W,fallbackStrategy:K="bestFit",fallbackAxisSideDirection:Q="none",flipAlignment:Z=!0,...oe}=Df(t,e);if((n=l.arrow)!=null&&n.alignmentOffset)return{};const ae=kf(i),me=Sm(s),pe=kf(s)===s,_e=await(v.isRTL==null?void 0:v.isRTL(w.floating)),De=W||(pe||!Z?[lI(s)]:P1e(s)),Ae=Q!=="none";!W&&Ae&&De.push(...k1e(s,Z,Q,_e));const re=[s,...De],fe=await Tw(e,oe),ye=[];let ue=((r=l.flip)==null?void 0:r.overflows)||[];if(A&&ye.push(fe[ae]),F){const ft=M1e(i,u,_e);ye.push(fe[ft[0]],fe[ft[1]])}if(ue=[...ue,{placement:i,overflows:ye}],!ye.every(ft=>ft<=0)){var Ie,Oe;const ft=(((Ie=l.flip)==null?void 0:Ie.index)||0)+1,He=re[ft];if(He)return{data:{index:ft,overflows:ue},reset:{placement:He}};let bt=(Oe=ue.filter(Nt=>Nt.overflows[0]<=0).sort((Nt,wt)=>Nt.overflows[1]-wt.overflows[1])[0])==null?void 0:Oe.placement;if(!bt)switch(K){case"bestFit":{var ze;const Nt=(ze=ue.filter(wt=>{if(Ae){const it=Sm(wt.placement);return it===me||it==="y"}return!0}).map(wt=>[wt.placement,wt.overflows.filter(it=>it>0).reduce((it,nn)=>it+nn,0)]).sort((wt,it)=>wt[1]-it[1])[0])==null?void 0:ze[0];Nt&&(bt=Nt);break}case"initialPlacement":bt=s;break}if(i!==bt)return{reset:{placement:bt}}}return{}}}};function jU(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function VU(t){return I1e.some(e=>t[e]>=0)}const B1e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=Df(t,e);switch(r){case"referenceHidden":{const l=await Tw(e,{...i,elementContext:"reference"}),u=jU(l,n.reference);return{data:{referenceHiddenOffsets:u,referenceHidden:VU(u)}}}case"escaped":{const l=await Tw(e,{...i,altBoundary:!0}),u=jU(l,n.floating);return{data:{escapedOffsets:u,escaped:VU(u)}}}default:return{}}}}};async function z1e(t,e){const{placement:n,platform:r,elements:i}=t,l=await(r.isRTL==null?void 0:r.isRTL(i.floating)),u=kf(n),s=Mx(n),v=Sm(n)==="y",w=["left","top"].includes(u)?-1:1,A=l&&v?-1:1,F=Df(e,t);let{mainAxis:W,crossAxis:K,alignmentAxis:Q}=typeof F=="number"?{mainAxis:F,crossAxis:0,alignmentAxis:null}:{mainAxis:F.mainAxis||0,crossAxis:F.crossAxis||0,alignmentAxis:F.alignmentAxis};return s&&typeof Q=="number"&&(K=s==="end"?Q*-1:Q),v?{x:K*A,y:W*w}:{x:W*w,y:K*A}}const j1e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:l,placement:u,middlewareData:s}=e,v=await z1e(e,t);return u===((n=s.offset)==null?void 0:n.placement)&&(r=s.arrow)!=null&&r.alignmentOffset?{}:{x:i+v.x,y:l+v.y,data:{...v,placement:u}}}}},V1e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:l=!0,crossAxis:u=!1,limiter:s={fn:oe=>{let{x:ae,y:me}=oe;return{x:ae,y:me}}},...v}=Df(t,e),w={x:n,y:r},A=await Tw(e,v),F=Sm(kf(i)),W=I4(F);let K=w[W],Q=w[F];if(l){const oe=W==="y"?"top":"left",ae=W==="y"?"bottom":"right",me=K+A[oe],pe=K-A[ae];K=pN(me,K,pe)}if(u){const oe=F==="y"?"top":"left",ae=F==="y"?"bottom":"right",me=Q+A[oe],pe=Q-A[ae];Q=pN(me,Q,pe)}const Z=s.fn({...e,[W]:K,[F]:Q});return{...Z,data:{x:Z.x-n,y:Z.y-r,enabled:{[W]:l,[F]:u}}}}}},U1e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:l,middlewareData:u}=e,{offset:s=0,mainAxis:v=!0,crossAxis:w=!0}=Df(t,e),A={x:n,y:r},F=Sm(i),W=I4(F);let K=A[W],Q=A[F];const Z=Df(s,e),oe=typeof Z=="number"?{mainAxis:Z,crossAxis:0}:{mainAxis:0,crossAxis:0,...Z};if(v){const pe=W==="y"?"height":"width",_e=l.reference[W]-l.floating[pe]+oe.mainAxis,De=l.reference[W]+l.reference[pe]-oe.mainAxis;K<_e?K=_e:K>De&&(K=De)}if(w){var ae,me;const pe=W==="y"?"width":"height",_e=["top","left"].includes(kf(i)),De=l.reference[F]-l.floating[pe]+(_e&&((ae=u.offset)==null?void 0:ae[F])||0)+(_e?0:oe.crossAxis),Ae=l.reference[F]+l.reference[pe]+(_e?0:((me=u.offset)==null?void 0:me[F])||0)-(_e?oe.crossAxis:0);Q<De?Q=De:Q>Ae&&(Q=Ae)}return{[W]:K,[F]:Q}}}},H1e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:l,platform:u,elements:s}=e,{apply:v=()=>{},...w}=Df(t,e),A=await Tw(e,w),F=kf(i),W=Mx(i),K=Sm(i)==="y",{width:Q,height:Z}=l.floating;let oe,ae;F==="top"||F==="bottom"?(oe=F,ae=W===(await(u.isRTL==null?void 0:u.isRTL(s.floating))?"start":"end")?"left":"right"):(ae=F,oe=W==="end"?"top":"bottom");const me=Z-A.top-A.bottom,pe=Q-A.left-A.right,_e=Em(Z-A[oe],me),De=Em(Q-A[ae],pe),Ae=!e.middlewareData.shift;let re=_e,fe=De;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(fe=pe),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(re=me),Ae&&!W){const ue=au(A.left,0),Ie=au(A.right,0),Oe=au(A.top,0),ze=au(A.bottom,0);K?fe=Q-2*(ue!==0||Ie!==0?ue+Ie:au(A.left,A.right)):re=Z-2*(Oe!==0||ze!==0?Oe+ze:au(A.top,A.bottom))}await v({...e,availableWidth:fe,availableHeight:re});const ye=await u.getDimensions(s.floating);return Q!==ye.width||Z!==ye.height?{reset:{rects:!0}}:{}}}};function UA(){return typeof window<"u"}function Px(t){return bZ(t)?(t.nodeName||"").toLowerCase():"#document"}function gu(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Ld(t){var e;return(e=(bZ(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function bZ(t){return UA()?t instanceof Node||t instanceof gu(t).Node:!1}function Bh(t){return UA()?t instanceof Element||t instanceof gu(t).Element:!1}function kd(t){return UA()?t instanceof HTMLElement||t instanceof gu(t).HTMLElement:!1}function UU(t){return!UA()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof gu(t).ShadowRoot}function b2(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=zh(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function W1e(t){return["table","td","th"].includes(Px(t))}function HA(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function M4(t){const e=P4(),n=Bh(t)?zh(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function $1e(t){let e=Tm(t);for(;kd(e)&&!nx(e);){if(M4(e))return e;if(HA(e))return null;e=Tm(e)}return null}function P4(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function nx(t){return["html","body","#document"].includes(Px(t))}function zh(t){return gu(t).getComputedStyle(t)}function WA(t){return Bh(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Tm(t){if(Px(t)==="html")return t;const e=t.assignedSlot||t.parentNode||UU(t)&&t.host||Ld(t);return UU(e)?e.host:e}function wZ(t){const e=Tm(t);return nx(e)?t.ownerDocument?t.ownerDocument.body:t.body:kd(e)&&b2(e)?e:wZ(e)}function Cw(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=wZ(t),l=i===((r=t.ownerDocument)==null?void 0:r.body),u=gu(i);if(l){const s=gN(u);return e.concat(u,u.visualViewport||[],b2(i)?i:[],s&&n?Cw(s):[])}return e.concat(i,Cw(i,[],n))}function gN(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function EZ(t){const e=zh(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=kd(t),l=i?t.offsetWidth:n,u=i?t.offsetHeight:r,s=aI(n)!==l||aI(r)!==u;return s&&(n=l,r=u),{width:n,height:r,$:s}}function D4(t){return Bh(t)?t:t.contextElement}function wy(t){const e=D4(t);if(!kd(e))return Ad(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:l}=EZ(e);let u=(l?aI(n.width):n.width)/r,s=(l?aI(n.height):n.height)/i;return(!u||!Number.isFinite(u))&&(u=1),(!s||!Number.isFinite(s))&&(s=1),{x:u,y:s}}const q1e=Ad(0);function SZ(t){const e=gu(t);return!P4()||!e.visualViewport?q1e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function G1e(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==gu(t)?!1:e}function h_(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),l=D4(t);let u=Ad(1);e&&(r?Bh(r)&&(u=wy(r)):u=wy(t));const s=G1e(l,n,r)?SZ(l):Ad(0);let v=(i.left+s.x)/u.x,w=(i.top+s.y)/u.y,A=i.width/u.x,F=i.height/u.y;if(l){const W=gu(l),K=r&&Bh(r)?gu(r):r;let Q=W,Z=gN(Q);for(;Z&&r&&K!==Q;){const oe=wy(Z),ae=Z.getBoundingClientRect(),me=zh(Z),pe=ae.left+(Z.clientLeft+parseFloat(me.paddingLeft))*oe.x,_e=ae.top+(Z.clientTop+parseFloat(me.paddingTop))*oe.y;v*=oe.x,w*=oe.y,A*=oe.x,F*=oe.y,v+=pe,w+=_e,Q=gu(Z),Z=gN(Q)}}return cI({width:A,height:F,x:v,y:w})}function k4(t,e){const n=WA(t).scrollLeft;return e?e.left+n:h_(Ld(t)).left+n}function TZ(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),i=r.left+e.scrollLeft-(n?0:k4(t,r)),l=r.top+e.scrollTop;return{x:i,y:l}}function Y1e(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const l=i==="fixed",u=Ld(r),s=e?HA(e.floating):!1;if(r===u||s&&l)return n;let v={scrollLeft:0,scrollTop:0},w=Ad(1);const A=Ad(0),F=kd(r);if((F||!F&&!l)&&((Px(r)!=="body"||b2(u))&&(v=WA(r)),kd(r))){const K=h_(r);w=wy(r),A.x=K.x+r.clientLeft,A.y=K.y+r.clientTop}const W=u&&!F&&!l?TZ(u,v,!0):Ad(0);return{width:n.width*w.x,height:n.height*w.y,x:n.x*w.x-v.scrollLeft*w.x+A.x+W.x,y:n.y*w.y-v.scrollTop*w.y+A.y+W.y}}function X1e(t){return Array.from(t.getClientRects())}function K1e(t){const e=Ld(t),n=WA(t),r=t.ownerDocument.body,i=au(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),l=au(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let u=-n.scrollLeft+k4(t);const s=-n.scrollTop;return zh(r).direction==="rtl"&&(u+=au(e.clientWidth,r.clientWidth)-i),{width:i,height:l,x:u,y:s}}function Z1e(t,e){const n=gu(t),r=Ld(t),i=n.visualViewport;let l=r.clientWidth,u=r.clientHeight,s=0,v=0;if(i){l=i.width,u=i.height;const w=P4();(!w||w&&e==="fixed")&&(s=i.offsetLeft,v=i.offsetTop)}return{width:l,height:u,x:s,y:v}}function Q1e(t,e){const n=h_(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,l=kd(t)?wy(t):Ad(1),u=t.clientWidth*l.x,s=t.clientHeight*l.y,v=i*l.x,w=r*l.y;return{width:u,height:s,x:v,y:w}}function HU(t,e,n){let r;if(e==="viewport")r=Z1e(t,n);else if(e==="document")r=K1e(Ld(t));else if(Bh(e))r=Q1e(e,n);else{const i=SZ(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return cI(r)}function CZ(t,e){const n=Tm(t);return n===e||!Bh(n)||nx(n)?!1:zh(n).position==="fixed"||CZ(n,e)}function J1e(t,e){const n=e.get(t);if(n)return n;let r=Cw(t,[],!1).filter(s=>Bh(s)&&Px(s)!=="body"),i=null;const l=zh(t).position==="fixed";let u=l?Tm(t):t;for(;Bh(u)&&!nx(u);){const s=zh(u),v=M4(u);!v&&s.position==="fixed"&&(i=null),(l?!v&&!i:!v&&s.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||b2(u)&&!v&&CZ(t,u))?r=r.filter(A=>A!==u):i=s,u=Tm(u)}return e.set(t,r),r}function eve(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const u=[...n==="clippingAncestors"?HA(e)?[]:J1e(e,this._c):[].concat(n),r],s=u[0],v=u.reduce((w,A)=>{const F=HU(e,A,i);return w.top=au(F.top,w.top),w.right=Em(F.right,w.right),w.bottom=Em(F.bottom,w.bottom),w.left=au(F.left,w.left),w},HU(e,s,i));return{width:v.right-v.left,height:v.bottom-v.top,x:v.left,y:v.top}}function tve(t){const{width:e,height:n}=EZ(t);return{width:e,height:n}}function nve(t,e,n){const r=kd(e),i=Ld(e),l=n==="fixed",u=h_(t,!0,l,e);let s={scrollLeft:0,scrollTop:0};const v=Ad(0);if(r||!r&&!l)if((Px(e)!=="body"||b2(i))&&(s=WA(e)),r){const W=h_(e,!0,l,e);v.x=W.x+e.clientLeft,v.y=W.y+e.clientTop}else i&&(v.x=k4(i));const w=i&&!r&&!l?TZ(i,s):Ad(0),A=u.left+s.scrollLeft-v.x-w.x,F=u.top+s.scrollTop-v.y-w.y;return{x:A,y:F,width:u.width,height:u.height}}function jD(t){return zh(t).position==="static"}function WU(t,e){if(!kd(t)||zh(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Ld(t)===n&&(n=n.ownerDocument.body),n}function IZ(t,e){const n=gu(t);if(HA(t))return n;if(!kd(t)){let i=Tm(t);for(;i&&!nx(i);){if(Bh(i)&&!jD(i))return i;i=Tm(i)}return n}let r=WU(t,e);for(;r&&W1e(r)&&jD(r);)r=WU(r,e);return r&&nx(r)&&jD(r)&&!M4(r)?n:r||$1e(t)||n}const rve=async function(t){const e=this.getOffsetParent||IZ,n=this.getDimensions,r=await n(t.floating);return{reference:nve(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function ive(t){return zh(t).direction==="rtl"}const sve={convertOffsetParentRelativeRectToViewportRelativeRect:Y1e,getDocumentElement:Ld,getClippingRect:eve,getOffsetParent:IZ,getElementRects:rve,getClientRects:X1e,getDimensions:tve,getScale:wy,isElement:Bh,isRTL:ive};function AZ(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function ove(t,e){let n=null,r;const i=Ld(t);function l(){var s;clearTimeout(r),(s=n)==null||s.disconnect(),n=null}function u(s,v){s===void 0&&(s=!1),v===void 0&&(v=1),l();const w=t.getBoundingClientRect(),{left:A,top:F,width:W,height:K}=w;if(s||e(),!W||!K)return;const Q=WS(F),Z=WS(i.clientWidth-(A+W)),oe=WS(i.clientHeight-(F+K)),ae=WS(A),pe={rootMargin:-Q+"px "+-Z+"px "+-oe+"px "+-ae+"px",threshold:au(0,Em(1,v))||1};let _e=!0;function De(Ae){const re=Ae[0].intersectionRatio;if(re!==v){if(!_e)return u();re?u(!1,re):r=setTimeout(()=>{u(!1,1e-7)},1e3)}re===1&&!AZ(w,t.getBoundingClientRect())&&u(),_e=!1}try{n=new IntersectionObserver(De,{...pe,root:i.ownerDocument})}catch{n=new IntersectionObserver(De,pe)}n.observe(t)}return u(!0),l}function ave(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:l=!0,elementResize:u=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:v=!1}=r,w=D4(t),A=i||l?[...w?Cw(w):[],...Cw(e)]:[];A.forEach(ae=>{i&&ae.addEventListener("scroll",n,{passive:!0}),l&&ae.addEventListener("resize",n)});const F=w&&s?ove(w,n):null;let W=-1,K=null;u&&(K=new ResizeObserver(ae=>{let[me]=ae;me&&me.target===w&&K&&(K.unobserve(e),cancelAnimationFrame(W),W=requestAnimationFrame(()=>{var pe;(pe=K)==null||pe.observe(e)})),n()}),w&&!v&&K.observe(w),K.observe(e));let Q,Z=v?h_(t):null;v&&oe();function oe(){const ae=h_(t);Z&&!AZ(Z,ae)&&n(),Z=ae,Q=requestAnimationFrame(oe)}return n(),()=>{var ae;A.forEach(me=>{i&&me.removeEventListener("scroll",n),l&&me.removeEventListener("resize",n)}),F?.(),(ae=K)==null||ae.disconnect(),K=null,v&&cancelAnimationFrame(Q)}}const lve=j1e,cve=V1e,uve=F1e,hve=H1e,dve=B1e,$U=L1e,fve=U1e,pve=(t,e,n)=>{const r=new Map,i={platform:sve,...n},l={...i.platform,_c:r};return O1e(t,e,{...i,platform:l})};var XT=typeof document<"u"?se.useLayoutEffect:se.useEffect;function uI(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!uI(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const l=i[r];if(!(l==="_owner"&&t.$$typeof)&&!uI(t[l],e[l]))return!1}return!0}return t!==t&&e!==e}function RZ(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function qU(t,e){const n=RZ(t);return Math.round(e*n)/n}function VD(t){const e=se.useRef(t);return XT(()=>{e.current=t}),e}function mve(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:l,floating:u}={},transform:s=!0,whileElementsMounted:v,open:w}=t,[A,F]=se.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[W,K]=se.useState(r);uI(W,r)||K(r);const[Q,Z]=se.useState(null),[oe,ae]=se.useState(null),me=se.useCallback(wt=>{wt!==Ae.current&&(Ae.current=wt,Z(wt))},[]),pe=se.useCallback(wt=>{wt!==re.current&&(re.current=wt,ae(wt))},[]),_e=l||Q,De=u||oe,Ae=se.useRef(null),re=se.useRef(null),fe=se.useRef(A),ye=v!=null,ue=VD(v),Ie=VD(i),Oe=VD(w),ze=se.useCallback(()=>{if(!Ae.current||!re.current)return;const wt={placement:e,strategy:n,middleware:W};Ie.current&&(wt.platform=Ie.current),pve(Ae.current,re.current,wt).then(it=>{const nn={...it,isPositioned:Oe.current!==!1};ft.current&&!uI(fe.current,nn)&&(fe.current=nn,Nm.flushSync(()=>{F(nn)}))})},[W,e,n,Ie,Oe]);XT(()=>{w===!1&&fe.current.isPositioned&&(fe.current.isPositioned=!1,F(wt=>({...wt,isPositioned:!1})))},[w]);const ft=se.useRef(!1);XT(()=>(ft.current=!0,()=>{ft.current=!1}),[]),XT(()=>{if(_e&&(Ae.current=_e),De&&(re.current=De),_e&&De){if(ue.current)return ue.current(_e,De,ze);ze()}},[_e,De,ze,ue,ye]);const He=se.useMemo(()=>({reference:Ae,floating:re,setReference:me,setFloating:pe}),[me,pe]),bt=se.useMemo(()=>({reference:_e,floating:De}),[_e,De]),Nt=se.useMemo(()=>{const wt={position:n,left:0,top:0};if(!bt.floating)return wt;const it=qU(bt.floating,A.x),nn=qU(bt.floating,A.y);return s?{...wt,transform:"translate("+it+"px, "+nn+"px)",...RZ(bt.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:it,top:nn}},[n,s,bt.floating,A.x,A.y]);return se.useMemo(()=>({...A,update:ze,refs:He,elements:bt,floatingStyles:Nt}),[A,ze,He,bt,Nt])}const gve=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:i}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?$U({element:r.current,padding:i}).fn(n):{}:r?$U({element:r,padding:i}).fn(n):{}}}},_ve=(t,e)=>({...lve(t),options:[t,e]}),yve=(t,e)=>({...cve(t),options:[t,e]}),xve=(t,e)=>({...fve(t),options:[t,e]}),vve=(t,e)=>({...uve(t),options:[t,e]}),bve=(t,e)=>({...hve(t),options:[t,e]}),wve=(t,e)=>({...dve(t),options:[t,e]}),Eve=(t,e)=>({...gve(t),options:[t,e]});var Sve="Arrow",MZ=se.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...l}=t;return R.jsx(Xi.svg,{...l,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:R.jsx("polygon",{points:"0,0 30,0 15,10"})})});MZ.displayName=Sve;var Tve=MZ;function Cve(t){const[e,n]=se.useState(void 0);return Rl(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const l=i[0];let u,s;if("borderBoxSize"in l){const v=l.borderBoxSize,w=Array.isArray(v)?v[0]:v;u=w.inlineSize,s=w.blockSize}else u=t.offsetWidth,s=t.offsetHeight;n({width:u,height:s})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var N4="Popper",[PZ,DZ]=M_(N4),[Ive,kZ]=PZ(N4),NZ=t=>{const{__scopePopper:e,children:n}=t,[r,i]=se.useState(null);return R.jsx(Ive,{scope:e,anchor:r,onAnchorChange:i,children:n})};NZ.displayName=N4;var OZ="PopperAnchor",LZ=se.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,l=kZ(OZ,n),u=se.useRef(null),s=No(e,u);return se.useEffect(()=>{l.onAnchorChange(r?.current||u.current)}),r?null:R.jsx(Xi.div,{...i,ref:s})});LZ.displayName=OZ;var O4="PopperContent",[Ave,Rve]=PZ(O4),FZ=se.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:l="center",alignOffset:u=0,arrowPadding:s=0,avoidCollisions:v=!0,collisionBoundary:w=[],collisionPadding:A=0,sticky:F="partial",hideWhenDetached:W=!1,updatePositionStrategy:K="optimized",onPlaced:Q,...Z}=t,oe=kZ(O4,n),[ae,me]=se.useState(null),pe=No(e,fn=>me(fn)),[_e,De]=se.useState(null),Ae=Cve(_e),re=Ae?.width??0,fe=Ae?.height??0,ye=r+(l!=="center"?"-"+l:""),ue=typeof A=="number"?A:{top:0,right:0,bottom:0,left:0,...A},Ie=Array.isArray(w)?w:[w],Oe=Ie.length>0,ze={padding:ue,boundary:Ie.filter(Pve),altBoundary:Oe},{refs:ft,floatingStyles:He,placement:bt,isPositioned:Nt,middlewareData:wt}=mve({strategy:"fixed",placement:ye,whileElementsMounted:(...fn)=>ave(...fn,{animationFrame:K==="always"}),elements:{reference:oe.anchor},middleware:[_ve({mainAxis:i+fe,alignmentAxis:u}),v&&yve({mainAxis:!0,crossAxis:!1,limiter:F==="partial"?xve():void 0,...ze}),v&&vve({...ze}),bve({...ze,apply:({elements:fn,rects:ur,availableWidth:br,availableHeight:Pe})=>{const{width:jn,height:rr}=ur.reference,Yn=fn.floating.style;Yn.setProperty("--radix-popper-available-width",`${br}px`),Yn.setProperty("--radix-popper-available-height",`${Pe}px`),Yn.setProperty("--radix-popper-anchor-width",`${jn}px`),Yn.setProperty("--radix-popper-anchor-height",`${rr}px`)}}),_e&&Eve({element:_e,padding:s}),Dve({arrowWidth:re,arrowHeight:fe}),W&&wve({strategy:"referenceHidden",...ze})]}),[it,nn]=jZ(bt),In=Yu(Q);Rl(()=>{Nt&&In?.()},[Nt,In]);const wn=wt.arrow?.x,Xt=wt.arrow?.y,On=wt.arrow?.centerOffset!==0,[cr,En]=se.useState();return Rl(()=>{ae&&En(window.getComputedStyle(ae).zIndex)},[ae]),R.jsx("div",{ref:ft.setFloating,"data-radix-popper-content-wrapper":"",style:{...He,transform:Nt?He.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:cr,"--radix-popper-transform-origin":[wt.transformOrigin?.x,wt.transformOrigin?.y].join(" "),...wt.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:R.jsx(Ave,{scope:n,placedSide:it,onArrowChange:De,arrowX:wn,arrowY:Xt,shouldHideArrow:On,children:R.jsx(Xi.div,{"data-side":it,"data-align":nn,...Z,ref:pe,style:{...Z.style,animation:Nt?void 0:"none"}})})})});FZ.displayName=O4;var BZ="PopperArrow",Mve={top:"bottom",right:"left",bottom:"top",left:"right"},zZ=se.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,l=Rve(BZ,r),u=Mve[l.placedSide];return R.jsx("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[u]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0},children:R.jsx(Tve,{...i,ref:n,style:{...i.style,display:"block"}})})});zZ.displayName=BZ;function Pve(t){return t!==null}var Dve=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,u=i.arrow?.centerOffset!==0,s=u?0:t.arrowWidth,v=u?0:t.arrowHeight,[w,A]=jZ(n),F={start:"0%",center:"50%",end:"100%"}[A],W=(i.arrow?.x??0)+s/2,K=(i.arrow?.y??0)+v/2;let Q="",Z="";return w==="bottom"?(Q=u?F:`${W}px`,Z=`${-v}px`):w==="top"?(Q=u?F:`${W}px`,Z=`${r.floating.height+v}px`):w==="right"?(Q=`${-v}px`,Z=u?F:`${K}px`):w==="left"&&(Q=`${r.floating.width+v}px`,Z=u?F:`${K}px`),{data:{x:Q,y:Z}}}});function jZ(t){const[e,n="center"]=t.split("-");return[e,n]}var kve=NZ,Nve=LZ,Ove=FZ,Lve=zZ,Fve="Portal",$A=se.forwardRef((t,e)=>{const{container:n,...r}=t,[i,l]=se.useState(!1);Rl(()=>l(!0),[]);const u=n||i&&globalThis?.document?.body;return u?eb.createPortal(R.jsx(Xi.div,{...r,ref:e}),u):null});$A.displayName=Fve;function Bve(t){const e=se.useRef({value:t,previous:t});return se.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var VZ=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),zve="VisuallyHidden",L4=se.forwardRef((t,e)=>R.jsx(Xi.span,{...t,ref:e,style:{...VZ,...t.style}}));L4.displayName=zve;var jve=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},k0=new WeakMap,$S=new WeakMap,qS={},UD=0,UZ=function(t){return t&&(t.host||UZ(t.parentNode))},Vve=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=UZ(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Uve=function(t,e,n,r){var i=Vve(e,Array.isArray(t)?t:[t]);qS[n]||(qS[n]=new WeakMap);var l=qS[n],u=[],s=new Set,v=new Set(i),w=function(F){!F||s.has(F)||(s.add(F),w(F.parentNode))};i.forEach(w);var A=function(F){!F||v.has(F)||Array.prototype.forEach.call(F.children,function(W){if(s.has(W))A(W);else try{var K=W.getAttribute(r),Q=K!==null&&K!=="false",Z=(k0.get(W)||0)+1,oe=(l.get(W)||0)+1;k0.set(W,Z),l.set(W,oe),u.push(W),Z===1&&Q&&$S.set(W,!0),oe===1&&W.setAttribute(n,"true"),Q||W.setAttribute(r,"true")}catch(ae){console.error("aria-hidden: cannot operate on ",W,ae)}})};return A(e),s.clear(),UD++,function(){u.forEach(function(F){var W=k0.get(F)-1,K=l.get(F)-1;k0.set(F,W),l.set(F,K),W||($S.has(F)||F.removeAttribute(r),$S.delete(F)),K||F.removeAttribute(n)}),UD--,UD||(k0=new WeakMap,k0=new WeakMap,$S=new WeakMap,qS={})}},HZ=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=jve(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),Uve(r,i,n,"aria-hidden")):function(){return null}},KT="right-scroll-bar-position",ZT="width-before-scroll-bar",Hve="with-scroll-bars-hidden",Wve="--removed-body-scroll-bar-size";function HD(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function $ve(t,e){var n=se.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}var qve=typeof window<"u"?se.useLayoutEffect:se.useEffect,GU=new WeakMap;function Gve(t,e){var n=$ve(null,function(r){return t.forEach(function(i){return HD(i,r)})});return qve(function(){var r=GU.get(n);if(r){var i=new Set(r),l=new Set(t),u=n.current;i.forEach(function(s){l.has(s)||HD(s,null)}),l.forEach(function(s){i.has(s)||HD(s,u)})}GU.set(n,t)},[t]),n}function Yve(t){return t}function Xve(t,e){e===void 0&&(e=Yve);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(l){var u=e(l,r);return n.push(u),function(){n=n.filter(function(s){return s!==u})}},assignSyncMedium:function(l){for(r=!0;n.length;){var u=n;n=[],u.forEach(l)}n={push:function(s){return l(s)},filter:function(){return n}}},assignMedium:function(l){r=!0;var u=[];if(n.length){var s=n;n=[],s.forEach(l),u=n}var v=function(){var A=u;u=[],A.forEach(l)},w=function(){return Promise.resolve().then(v)};w(),n={push:function(A){u.push(A),w()},filter:function(A){return u=u.filter(A),n}}}};return i}function Kve(t){t===void 0&&(t={});var e=Xve(null);return e.options=xd({async:!0,ssr:!1},t),e}var WZ=function(t){var e=t.sideCar,n=l2(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return se.createElement(r,xd({},n))};WZ.isSideCarExport=!0;function Zve(t,e){return t.useMedium(e),WZ}var $Z=Kve(),WD=function(){},qA=se.forwardRef(function(t,e){var n=se.useRef(null),r=se.useState({onScrollCapture:WD,onWheelCapture:WD,onTouchMoveCapture:WD}),i=r[0],l=r[1],u=t.forwardProps,s=t.children,v=t.className,w=t.removeScrollBar,A=t.enabled,F=t.shards,W=t.sideCar,K=t.noIsolation,Q=t.inert,Z=t.allowPinchZoom,oe=t.as,ae=oe===void 0?"div":oe,me=t.gapMode,pe=l2(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),_e=W,De=Gve([n,e]),Ae=xd(xd({},pe),i);return se.createElement(se.Fragment,null,A&&se.createElement(_e,{sideCar:$Z,removeScrollBar:w,shards:F,noIsolation:K,inert:Q,setCallbacks:l,allowPinchZoom:!!Z,lockRef:n,gapMode:me}),u?se.cloneElement(se.Children.only(s),xd(xd({},Ae),{ref:De})):se.createElement(ae,xd({},Ae,{className:v,ref:De}),s))});qA.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};qA.classNames={fullWidth:ZT,zeroRight:KT};var Qve=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Jve(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Qve();return e&&t.setAttribute("nonce",e),t}function ebe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function tbe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var nbe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Jve())&&(ebe(e,n),tbe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},rbe=function(){var t=nbe();return function(e,n){se.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},qZ=function(){var t=rbe(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},ibe={left:0,top:0,right:0,gap:0},$D=function(t){return parseInt(t||"",10)||0},sbe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[$D(n),$D(r),$D(i)]},obe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return ibe;var e=sbe(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},abe=qZ(),Ey="data-scroll-locked",lbe=function(t,e,n,r){var i=t.left,l=t.top,u=t.right,s=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(Hve,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(s,"px ").concat(r,`;
  }
  body[`).concat(Ey,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(u,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(KT,` {
    right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(ZT,` {
    margin-right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(KT," .").concat(KT,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(ZT," .").concat(ZT,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Ey,`] {
    `).concat(Wve,": ").concat(s,`px;
  }
`)},YU=function(){var t=parseInt(document.body.getAttribute(Ey)||"0",10);return isFinite(t)?t:0},cbe=function(){se.useEffect(function(){return document.body.setAttribute(Ey,(YU()+1).toString()),function(){var t=YU()-1;t<=0?document.body.removeAttribute(Ey):document.body.setAttribute(Ey,t.toString())}},[])},ube=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r;cbe();var l=se.useMemo(function(){return obe(i)},[i]);return se.createElement(abe,{styles:lbe(l,!e,i,n?"":"!important")})},_N=!1;if(typeof window<"u")try{var GS=Object.defineProperty({},"passive",{get:function(){return _N=!0,!0}});window.addEventListener("test",GS,GS),window.removeEventListener("test",GS,GS)}catch{_N=!1}var N0=_N?{passive:!1}:!1,hbe=function(t){return t.tagName==="TEXTAREA"},GZ=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!hbe(t)&&n[e]==="visible")},dbe=function(t){return GZ(t,"overflowY")},fbe=function(t){return GZ(t,"overflowX")},XU=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=YZ(t,r);if(i){var l=XZ(t,r),u=l[1],s=l[2];if(u>s)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},pbe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},mbe=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},YZ=function(t,e){return t==="v"?dbe(e):fbe(e)},XZ=function(t,e){return t==="v"?pbe(e):mbe(e)},gbe=function(t,e){return t==="h"&&e==="rtl"?-1:1},_be=function(t,e,n,r,i){var l=gbe(t,window.getComputedStyle(e).direction),u=l*r,s=n.target,v=e.contains(s),w=!1,A=u>0,F=0,W=0;do{var K=XZ(t,s),Q=K[0],Z=K[1],oe=K[2],ae=Z-oe-l*Q;(Q||ae)&&YZ(t,s)&&(F+=ae,W+=Q),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!v&&s!==document.body||v&&(e.contains(s)||e===s));return(A&&Math.abs(F)<1||!A&&Math.abs(W)<1)&&(w=!0),w},YS=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},KU=function(t){return[t.deltaX,t.deltaY]},ZU=function(t){return t&&"current"in t?t.current:t},ybe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},xbe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},vbe=0,O0=[];function bbe(t){var e=se.useRef([]),n=se.useRef([0,0]),r=se.useRef(),i=se.useState(vbe++)[0],l=se.useState(qZ)[0],u=se.useRef(t);se.useEffect(function(){u.current=t},[t]),se.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var Z=qfe([t.lockRef.current],(t.shards||[]).map(ZU),!0).filter(Boolean);return Z.forEach(function(oe){return oe.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),Z.forEach(function(oe){return oe.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var s=se.useCallback(function(Z,oe){if("touches"in Z&&Z.touches.length===2||Z.type==="wheel"&&Z.ctrlKey)return!u.current.allowPinchZoom;var ae=YS(Z),me=n.current,pe="deltaX"in Z?Z.deltaX:me[0]-ae[0],_e="deltaY"in Z?Z.deltaY:me[1]-ae[1],De,Ae=Z.target,re=Math.abs(pe)>Math.abs(_e)?"h":"v";if("touches"in Z&&re==="h"&&Ae.type==="range")return!1;var fe=XU(re,Ae);if(!fe)return!0;if(fe?De=re:(De=re==="v"?"h":"v",fe=XU(re,Ae)),!fe)return!1;if(!r.current&&"changedTouches"in Z&&(pe||_e)&&(r.current=De),!De)return!0;var ye=r.current||De;return _be(ye,oe,Z,ye==="h"?pe:_e)},[]),v=se.useCallback(function(Z){var oe=Z;if(!(!O0.length||O0[O0.length-1]!==l)){var ae="deltaY"in oe?KU(oe):YS(oe),me=e.current.filter(function(De){return De.name===oe.type&&(De.target===oe.target||oe.target===De.shadowParent)&&ybe(De.delta,ae)})[0];if(me&&me.should){oe.cancelable&&oe.preventDefault();return}if(!me){var pe=(u.current.shards||[]).map(ZU).filter(Boolean).filter(function(De){return De.contains(oe.target)}),_e=pe.length>0?s(oe,pe[0]):!u.current.noIsolation;_e&&oe.cancelable&&oe.preventDefault()}}},[]),w=se.useCallback(function(Z,oe,ae,me){var pe={name:Z,delta:oe,target:ae,should:me,shadowParent:wbe(ae)};e.current.push(pe),setTimeout(function(){e.current=e.current.filter(function(_e){return _e!==pe})},1)},[]),A=se.useCallback(function(Z){n.current=YS(Z),r.current=void 0},[]),F=se.useCallback(function(Z){w(Z.type,KU(Z),Z.target,s(Z,t.lockRef.current))},[]),W=se.useCallback(function(Z){w(Z.type,YS(Z),Z.target,s(Z,t.lockRef.current))},[]);se.useEffect(function(){return O0.push(l),t.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:W}),document.addEventListener("wheel",v,N0),document.addEventListener("touchmove",v,N0),document.addEventListener("touchstart",A,N0),function(){O0=O0.filter(function(Z){return Z!==l}),document.removeEventListener("wheel",v,N0),document.removeEventListener("touchmove",v,N0),document.removeEventListener("touchstart",A,N0)}},[]);var K=t.removeScrollBar,Q=t.inert;return se.createElement(se.Fragment,null,Q?se.createElement(l,{styles:xbe(i)}):null,K?se.createElement(ube,{gapMode:t.gapMode}):null)}function wbe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Ebe=Zve($Z,bbe);var F4=se.forwardRef(function(t,e){return se.createElement(qA,xd({},t,{ref:e,sideCar:Ebe}))});F4.classNames=qA.classNames;var Sbe=[" ","Enter","ArrowUp","ArrowDown"],Tbe=[" ","Enter"],d_="Select",[GA,YA,Cbe]=b4(d_),[Dx,G5e]=M_(d_,[Cbe,DZ]),XA=DZ(),[Ibe,Bm]=Dx(d_),[Abe,Rbe]=Dx(d_),KZ=t=>{const{__scopeSelect:e,children:n,open:r,defaultOpen:i,onOpenChange:l,value:u,defaultValue:s,onValueChange:v,dir:w,name:A,autoComplete:F,disabled:W,required:K,form:Q}=t,Z=XA(e),[oe,ae]=se.useState(null),[me,pe]=se.useState(null),[_e,De]=se.useState(!1),Ae=w4(w),[re,fe]=tx({prop:r,defaultProp:i??!1,onChange:l,caller:d_}),[ye,ue]=tx({prop:u,defaultProp:s,onChange:v,caller:d_}),Ie=se.useRef(null),Oe=oe?Q||!!oe.closest("form"):!0,[ze,ft]=se.useState(new Set),He=Array.from(ze).map(bt=>bt.props.value).join(";");return R.jsx(kve,{...Z,children:R.jsxs(Ibe,{required:K,scope:e,trigger:oe,onTriggerChange:ae,valueNode:me,onValueNodeChange:pe,valueNodeHasChildren:_e,onValueNodeHasChildrenChange:De,contentId:cm(),value:ye,onValueChange:ue,open:re,onOpenChange:fe,dir:Ae,triggerPointerDownPosRef:Ie,disabled:W,children:[R.jsx(GA.Provider,{scope:e,children:R.jsx(Abe,{scope:t.__scopeSelect,onNativeOptionAdd:se.useCallback(bt=>{ft(Nt=>new Set(Nt).add(bt))},[]),onNativeOptionRemove:se.useCallback(bt=>{ft(Nt=>{const wt=new Set(Nt);return wt.delete(bt),wt})},[]),children:n})}),Oe?R.jsxs(vQ,{"aria-hidden":!0,required:K,tabIndex:-1,name:A,autoComplete:F,value:ye,onChange:bt=>ue(bt.target.value),disabled:W,form:Q,children:[ye===void 0?R.jsx("option",{value:""}):null,Array.from(ze)]},He):null]})})};KZ.displayName=d_;var ZZ="SelectTrigger",QZ=se.forwardRef((t,e)=>{const{__scopeSelect:n,disabled:r=!1,...i}=t,l=XA(n),u=Bm(ZZ,n),s=u.disabled||r,v=No(e,u.onTriggerChange),w=YA(n),A=se.useRef("touch"),[F,W,K]=wQ(Z=>{const oe=w().filter(pe=>!pe.disabled),ae=oe.find(pe=>pe.value===u.value),me=EQ(oe,Z,ae);me!==void 0&&u.onValueChange(me.value)}),Q=Z=>{s||(u.onOpenChange(!0),K()),Z&&(u.triggerPointerDownPosRef.current={x:Math.round(Z.pageX),y:Math.round(Z.pageY)})};return R.jsx(Nve,{asChild:!0,...l,children:R.jsx(Xi.button,{type:"button",role:"combobox","aria-controls":u.contentId,"aria-expanded":u.open,"aria-required":u.required,"aria-autocomplete":"none",dir:u.dir,"data-state":u.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":bQ(u.value)?"":void 0,...i,ref:v,onClick:Di(i.onClick,Z=>{Z.currentTarget.focus(),A.current!=="mouse"&&Q(Z)}),onPointerDown:Di(i.onPointerDown,Z=>{A.current=Z.pointerType;const oe=Z.target;oe.hasPointerCapture(Z.pointerId)&&oe.releasePointerCapture(Z.pointerId),Z.button===0&&Z.ctrlKey===!1&&Z.pointerType==="mouse"&&(Q(Z),Z.preventDefault())}),onKeyDown:Di(i.onKeyDown,Z=>{const oe=F.current!=="";!(Z.ctrlKey||Z.altKey||Z.metaKey)&&Z.key.length===1&&W(Z.key),!(oe&&Z.key===" ")&&Sbe.includes(Z.key)&&(Q(),Z.preventDefault())})})})});QZ.displayName=ZZ;var JZ="SelectValue",eQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,className:r,style:i,children:l,placeholder:u="",...s}=t,v=Bm(JZ,n),{onValueNodeHasChildrenChange:w}=v,A=l!==void 0,F=No(e,v.onValueNodeChange);return Rl(()=>{w(A)},[w,A]),R.jsx(Xi.span,{...s,ref:F,style:{pointerEvents:"none"},children:bQ(v.value)?R.jsx(R.Fragment,{children:u}):l})});eQ.displayName=JZ;var Mbe="SelectIcon",tQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,children:r,...i}=t;return R.jsx(Xi.span,{"aria-hidden":!0,...i,ref:e,children:r||""})});tQ.displayName=Mbe;var Pbe="SelectPortal",nQ=t=>R.jsx($A,{asChild:!0,...t});nQ.displayName=Pbe;var f_="SelectContent",rQ=se.forwardRef((t,e)=>{const n=Bm(f_,t.__scopeSelect),[r,i]=se.useState();if(Rl(()=>{i(new DocumentFragment)},[]),!n.open){const l=r;return l?Nm.createPortal(R.jsx(iQ,{scope:t.__scopeSelect,children:R.jsx(GA.Slot,{scope:t.__scopeSelect,children:R.jsx("div",{children:t.children})})}),l):null}return R.jsx(sQ,{...t,ref:e})});rQ.displayName=f_;var yh=10,[iQ,zm]=Dx(f_),Dbe="SelectContentImpl",kbe=ex("SelectContent.RemoveScroll"),sQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:i,onEscapeKeyDown:l,onPointerDownOutside:u,side:s,sideOffset:v,align:w,alignOffset:A,arrowPadding:F,collisionBoundary:W,collisionPadding:K,sticky:Q,hideWhenDetached:Z,avoidCollisions:oe,...ae}=t,me=Bm(f_,n),[pe,_e]=se.useState(null),[De,Ae]=se.useState(null),re=No(e,fn=>_e(fn)),[fe,ye]=se.useState(null),[ue,Ie]=se.useState(null),Oe=YA(n),[ze,ft]=se.useState(!1),He=se.useRef(!1);se.useEffect(()=>{if(pe)return HZ(pe)},[pe]),yZ();const bt=se.useCallback(fn=>{const[ur,...br]=Oe().map(rr=>rr.ref.current),[Pe]=br.slice(-1),jn=document.activeElement;for(const rr of fn)if(rr===jn||(rr?.scrollIntoView({block:"nearest"}),rr===ur&&De&&(De.scrollTop=0),rr===Pe&&De&&(De.scrollTop=De.scrollHeight),rr?.focus(),document.activeElement!==jn))return},[Oe,De]),Nt=se.useCallback(()=>bt([fe,pe]),[bt,fe,pe]);se.useEffect(()=>{ze&&Nt()},[ze,Nt]);const{onOpenChange:wt,triggerPointerDownPosRef:it}=me;se.useEffect(()=>{if(pe){let fn={x:0,y:0};const ur=Pe=>{fn={x:Math.abs(Math.round(Pe.pageX)-(it.current?.x??0)),y:Math.abs(Math.round(Pe.pageY)-(it.current?.y??0))}},br=Pe=>{fn.x<=10&&fn.y<=10?Pe.preventDefault():pe.contains(Pe.target)||wt(!1),document.removeEventListener("pointermove",ur),it.current=null};return it.current!==null&&(document.addEventListener("pointermove",ur),document.addEventListener("pointerup",br,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ur),document.removeEventListener("pointerup",br,{capture:!0})}}},[pe,wt,it]),se.useEffect(()=>{const fn=()=>wt(!1);return window.addEventListener("blur",fn),window.addEventListener("resize",fn),()=>{window.removeEventListener("blur",fn),window.removeEventListener("resize",fn)}},[wt]);const[nn,In]=wQ(fn=>{const ur=Oe().filter(jn=>!jn.disabled),br=ur.find(jn=>jn.ref.current===document.activeElement),Pe=EQ(ur,fn,br);Pe&&setTimeout(()=>Pe.ref.current.focus())}),wn=se.useCallback((fn,ur,br)=>{const Pe=!He.current&&!br;(me.value!==void 0&&me.value===ur||Pe)&&(ye(fn),Pe&&(He.current=!0))},[me.value]),Xt=se.useCallback(()=>pe?.focus(),[pe]),On=se.useCallback((fn,ur,br)=>{const Pe=!He.current&&!br;(me.value!==void 0&&me.value===ur||Pe)&&Ie(fn)},[me.value]),cr=r==="popper"?yN:oQ,En=cr===yN?{side:s,sideOffset:v,align:w,alignOffset:A,arrowPadding:F,collisionBoundary:W,collisionPadding:K,sticky:Q,hideWhenDetached:Z,avoidCollisions:oe}:{};return R.jsx(iQ,{scope:n,content:pe,viewport:De,onViewportChange:Ae,itemRefCallback:wn,selectedItem:fe,onItemLeave:Xt,itemTextRefCallback:On,focusSelectedItem:Nt,selectedItemText:ue,position:r,isPositioned:ze,searchRef:nn,children:R.jsx(F4,{as:kbe,allowPinchZoom:!0,children:R.jsx(C4,{asChild:!0,trapped:me.open,onMountAutoFocus:fn=>{fn.preventDefault()},onUnmountAutoFocus:Di(i,fn=>{me.trigger?.focus({preventScroll:!0}),fn.preventDefault()}),children:R.jsx(VA,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:fn=>fn.preventDefault(),onDismiss:()=>me.onOpenChange(!1),children:R.jsx(cr,{role:"listbox",id:me.contentId,"data-state":me.open?"open":"closed",dir:me.dir,onContextMenu:fn=>fn.preventDefault(),...ae,...En,onPlaced:()=>ft(!0),ref:re,style:{display:"flex",flexDirection:"column",outline:"none",...ae.style},onKeyDown:Di(ae.onKeyDown,fn=>{const ur=fn.ctrlKey||fn.altKey||fn.metaKey;if(fn.key==="Tab"&&fn.preventDefault(),!ur&&fn.key.length===1&&In(fn.key),["ArrowUp","ArrowDown","Home","End"].includes(fn.key)){let Pe=Oe().filter(jn=>!jn.disabled).map(jn=>jn.ref.current);if(["ArrowUp","End"].includes(fn.key)&&(Pe=Pe.slice().reverse()),["ArrowUp","ArrowDown"].includes(fn.key)){const jn=fn.target,rr=Pe.indexOf(jn);Pe=Pe.slice(rr+1)}setTimeout(()=>bt(Pe)),fn.preventDefault()}})})})})})})});sQ.displayName=Dbe;var Nbe="SelectItemAlignedPosition",oQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,onPlaced:r,...i}=t,l=Bm(f_,n),u=zm(f_,n),[s,v]=se.useState(null),[w,A]=se.useState(null),F=No(e,re=>A(re)),W=YA(n),K=se.useRef(!1),Q=se.useRef(!0),{viewport:Z,selectedItem:oe,selectedItemText:ae,focusSelectedItem:me}=u,pe=se.useCallback(()=>{if(l.trigger&&l.valueNode&&s&&w&&Z&&oe&&ae){const re=l.trigger.getBoundingClientRect(),fe=w.getBoundingClientRect(),ye=l.valueNode.getBoundingClientRect(),ue=ae.getBoundingClientRect();if(l.dir!=="rtl"){const jn=ue.left-fe.left,rr=ye.left-jn,Yn=re.left-rr,Ot=re.width+Yn,Sr=Math.max(Ot,fe.width),fi=window.innerWidth-yh,Wr=PU(rr,[yh,Math.max(yh,fi-Sr)]);s.style.minWidth=Ot+"px",s.style.left=Wr+"px"}else{const jn=fe.right-ue.right,rr=window.innerWidth-ye.right-jn,Yn=window.innerWidth-re.right-rr,Ot=re.width+Yn,Sr=Math.max(Ot,fe.width),fi=window.innerWidth-yh,Wr=PU(rr,[yh,Math.max(yh,fi-Sr)]);s.style.minWidth=Ot+"px",s.style.right=Wr+"px"}const Ie=W(),Oe=window.innerHeight-yh*2,ze=Z.scrollHeight,ft=window.getComputedStyle(w),He=parseInt(ft.borderTopWidth,10),bt=parseInt(ft.paddingTop,10),Nt=parseInt(ft.borderBottomWidth,10),wt=parseInt(ft.paddingBottom,10),it=He+bt+ze+wt+Nt,nn=Math.min(oe.offsetHeight*5,it),In=window.getComputedStyle(Z),wn=parseInt(In.paddingTop,10),Xt=parseInt(In.paddingBottom,10),On=re.top+re.height/2-yh,cr=Oe-On,En=oe.offsetHeight/2,fn=oe.offsetTop+En,ur=He+bt+fn,br=it-ur;if(ur<=On){const jn=Ie.length>0&&oe===Ie[Ie.length-1].ref.current;s.style.bottom="0px";const rr=w.clientHeight-Z.offsetTop-Z.offsetHeight,Yn=Math.max(cr,En+(jn?Xt:0)+rr+Nt),Ot=ur+Yn;s.style.height=Ot+"px"}else{const jn=Ie.length>0&&oe===Ie[0].ref.current;s.style.top="0px";const Yn=Math.max(On,He+Z.offsetTop+(jn?wn:0)+En)+br;s.style.height=Yn+"px",Z.scrollTop=ur-On+Z.offsetTop}s.style.margin=`${yh}px 0`,s.style.minHeight=nn+"px",s.style.maxHeight=Oe+"px",r?.(),requestAnimationFrame(()=>K.current=!0)}},[W,l.trigger,l.valueNode,s,w,Z,oe,ae,l.dir,r]);Rl(()=>pe(),[pe]);const[_e,De]=se.useState();Rl(()=>{w&&De(window.getComputedStyle(w).zIndex)},[w]);const Ae=se.useCallback(re=>{re&&Q.current===!0&&(pe(),me?.(),Q.current=!1)},[pe,me]);return R.jsx(Lbe,{scope:n,contentWrapper:s,shouldExpandOnScrollRef:K,onScrollButtonChange:Ae,children:R.jsx("div",{ref:v,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:_e},children:R.jsx(Xi.div,{...i,ref:F,style:{boxSizing:"border-box",maxHeight:"100%",...i.style}})})})});oQ.displayName=Nbe;var Obe="SelectPopperPosition",yN=se.forwardRef((t,e)=>{const{__scopeSelect:n,align:r="start",collisionPadding:i=yh,...l}=t,u=XA(n);return R.jsx(Ove,{...u,...l,ref:e,align:r,collisionPadding:i,style:{boxSizing:"border-box",...l.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});yN.displayName=Obe;var[Lbe,B4]=Dx(f_,{}),xN="SelectViewport",aQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,nonce:r,...i}=t,l=zm(xN,n),u=B4(xN,n),s=No(e,l.onViewportChange),v=se.useRef(0);return R.jsxs(R.Fragment,{children:[R.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),R.jsx(GA.Slot,{scope:n,children:R.jsx(Xi.div,{"data-radix-select-viewport":"",role:"presentation",...i,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...i.style},onScroll:Di(i.onScroll,w=>{const A=w.currentTarget,{contentWrapper:F,shouldExpandOnScrollRef:W}=u;if(W?.current&&F){const K=Math.abs(v.current-A.scrollTop);if(K>0){const Q=window.innerHeight-yh*2,Z=parseFloat(F.style.minHeight),oe=parseFloat(F.style.height),ae=Math.max(Z,oe);if(ae<Q){const me=ae+K,pe=Math.min(Q,me),_e=me-pe;F.style.height=pe+"px",F.style.bottom==="0px"&&(A.scrollTop=_e>0?_e:0,F.style.justifyContent="flex-end")}}}v.current=A.scrollTop})})})]})});aQ.displayName=xN;var lQ="SelectGroup",[Fbe,Bbe]=Dx(lQ),zbe=se.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t,i=cm();return R.jsx(Fbe,{scope:n,id:i,children:R.jsx(Xi.div,{role:"group","aria-labelledby":i,...r,ref:e})})});zbe.displayName=lQ;var cQ="SelectLabel",uQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t,i=Bbe(cQ,n);return R.jsx(Xi.div,{id:i.id,...r,ref:e})});uQ.displayName=cQ;var hI="SelectItem",[jbe,hQ]=Dx(hI),dQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,value:r,disabled:i=!1,textValue:l,...u}=t,s=Bm(hI,n),v=zm(hI,n),w=s.value===r,[A,F]=se.useState(l??""),[W,K]=se.useState(!1),Q=No(e,me=>v.itemRefCallback?.(me,r,i)),Z=cm(),oe=se.useRef("touch"),ae=()=>{i||(s.onValueChange(r),s.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return R.jsx(jbe,{scope:n,value:r,disabled:i,textId:Z,isSelected:w,onItemTextChange:se.useCallback(me=>{F(pe=>pe||(me?.textContent??"").trim())},[]),children:R.jsx(GA.ItemSlot,{scope:n,value:r,disabled:i,textValue:A,children:R.jsx(Xi.div,{role:"option","aria-labelledby":Z,"data-highlighted":W?"":void 0,"aria-selected":w&&W,"data-state":w?"checked":"unchecked","aria-disabled":i||void 0,"data-disabled":i?"":void 0,tabIndex:i?void 0:-1,...u,ref:Q,onFocus:Di(u.onFocus,()=>K(!0)),onBlur:Di(u.onBlur,()=>K(!1)),onClick:Di(u.onClick,()=>{oe.current!=="mouse"&&ae()}),onPointerUp:Di(u.onPointerUp,()=>{oe.current==="mouse"&&ae()}),onPointerDown:Di(u.onPointerDown,me=>{oe.current=me.pointerType}),onPointerMove:Di(u.onPointerMove,me=>{oe.current=me.pointerType,i?v.onItemLeave?.():oe.current==="mouse"&&me.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Di(u.onPointerLeave,me=>{me.currentTarget===document.activeElement&&v.onItemLeave?.()}),onKeyDown:Di(u.onKeyDown,me=>{v.searchRef?.current!==""&&me.key===" "||(Tbe.includes(me.key)&&ae(),me.key===" "&&me.preventDefault())})})})})});dQ.displayName=hI;var ab="SelectItemText",fQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,className:r,style:i,...l}=t,u=Bm(ab,n),s=zm(ab,n),v=hQ(ab,n),w=Rbe(ab,n),[A,F]=se.useState(null),W=No(e,ae=>F(ae),v.onItemTextChange,ae=>s.itemTextRefCallback?.(ae,v.value,v.disabled)),K=A?.textContent,Q=se.useMemo(()=>R.jsx("option",{value:v.value,disabled:v.disabled,children:K},v.value),[v.disabled,v.value,K]),{onNativeOptionAdd:Z,onNativeOptionRemove:oe}=w;return Rl(()=>(Z(Q),()=>oe(Q)),[Z,oe,Q]),R.jsxs(R.Fragment,{children:[R.jsx(Xi.span,{id:v.textId,...l,ref:W}),v.isSelected&&u.valueNode&&!u.valueNodeHasChildren?Nm.createPortal(l.children,u.valueNode):null]})});fQ.displayName=ab;var pQ="SelectItemIndicator",mQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t;return hQ(pQ,n).isSelected?R.jsx(Xi.span,{"aria-hidden":!0,...r,ref:e}):null});mQ.displayName=pQ;var vN="SelectScrollUpButton",gQ=se.forwardRef((t,e)=>{const n=zm(vN,t.__scopeSelect),r=B4(vN,t.__scopeSelect),[i,l]=se.useState(!1),u=No(e,r.onScrollButtonChange);return Rl(()=>{if(n.viewport&&n.isPositioned){let s=function(){const w=v.scrollTop>0;l(w)};const v=n.viewport;return s(),v.addEventListener("scroll",s),()=>v.removeEventListener("scroll",s)}},[n.viewport,n.isPositioned]),i?R.jsx(yQ,{...t,ref:u,onAutoScroll:()=>{const{viewport:s,selectedItem:v}=n;s&&v&&(s.scrollTop=s.scrollTop-v.offsetHeight)}}):null});gQ.displayName=vN;var bN="SelectScrollDownButton",_Q=se.forwardRef((t,e)=>{const n=zm(bN,t.__scopeSelect),r=B4(bN,t.__scopeSelect),[i,l]=se.useState(!1),u=No(e,r.onScrollButtonChange);return Rl(()=>{if(n.viewport&&n.isPositioned){let s=function(){const w=v.scrollHeight-v.clientHeight,A=Math.ceil(v.scrollTop)<w;l(A)};const v=n.viewport;return s(),v.addEventListener("scroll",s),()=>v.removeEventListener("scroll",s)}},[n.viewport,n.isPositioned]),i?R.jsx(yQ,{...t,ref:u,onAutoScroll:()=>{const{viewport:s,selectedItem:v}=n;s&&v&&(s.scrollTop=s.scrollTop+v.offsetHeight)}}):null});_Q.displayName=bN;var yQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,onAutoScroll:r,...i}=t,l=zm("SelectScrollButton",n),u=se.useRef(null),s=YA(n),v=se.useCallback(()=>{u.current!==null&&(window.clearInterval(u.current),u.current=null)},[]);return se.useEffect(()=>()=>v(),[v]),Rl(()=>{s().find(A=>A.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[s]),R.jsx(Xi.div,{"aria-hidden":!0,...i,ref:e,style:{flexShrink:0,...i.style},onPointerDown:Di(i.onPointerDown,()=>{u.current===null&&(u.current=window.setInterval(r,50))}),onPointerMove:Di(i.onPointerMove,()=>{l.onItemLeave?.(),u.current===null&&(u.current=window.setInterval(r,50))}),onPointerLeave:Di(i.onPointerLeave,()=>{v()})})}),Vbe="SelectSeparator",xQ=se.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t;return R.jsx(Xi.div,{"aria-hidden":!0,...r,ref:e})});xQ.displayName=Vbe;var wN="SelectArrow",Ube=se.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t,i=XA(n),l=Bm(wN,n),u=zm(wN,n);return l.open&&u.position==="popper"?R.jsx(Lve,{...i,...r,ref:e}):null});Ube.displayName=wN;var Hbe="SelectBubbleInput",vQ=se.forwardRef(({__scopeSelect:t,value:e,...n},r)=>{const i=se.useRef(null),l=No(r,i),u=Bve(e);return se.useEffect(()=>{const s=i.current;if(!s)return;const v=window.HTMLSelectElement.prototype,A=Object.getOwnPropertyDescriptor(v,"value").set;if(u!==e&&A){const F=new Event("change",{bubbles:!0});A.call(s,e),s.dispatchEvent(F)}},[u,e]),R.jsx(Xi.select,{...n,style:{...VZ,...n.style},ref:l,defaultValue:e})});vQ.displayName=Hbe;function bQ(t){return t===""||t===void 0}function wQ(t){const e=Yu(t),n=se.useRef(""),r=se.useRef(0),i=se.useCallback(u=>{const s=n.current+u;e(s),function v(w){n.current=w,window.clearTimeout(r.current),w!==""&&(r.current=window.setTimeout(()=>v(""),1e3))}(s)},[e]),l=se.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return se.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,i,l]}function EQ(t,e,n){const i=e.length>1&&Array.from(e).every(w=>w===e[0])?e[0]:e,l=n?t.indexOf(n):-1;let u=Wbe(t,Math.max(l,0));i.length===1&&(u=u.filter(w=>w!==n));const v=u.find(w=>w.textValue.toLowerCase().startsWith(i.toLowerCase()));return v!==n?v:void 0}function Wbe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var $be=KZ,SQ=QZ,qbe=eQ,Gbe=tQ,Ybe=nQ,TQ=rQ,Xbe=aQ,CQ=uQ,IQ=dQ,Kbe=fQ,Zbe=mQ,AQ=gQ,RQ=_Q,MQ=xQ;const QT=$be,JT=qbe,kb=se.forwardRef(({className:t,children:e,...n},r)=>R.jsxs(SQ,{ref:r,className:Fs("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[e,R.jsx(Gbe,{asChild:!0,children:R.jsx(AK,{className:"h-4 w-4 opacity-50"})})]}));kb.displayName=SQ.displayName;const PQ=se.forwardRef(({className:t,...e},n)=>R.jsx(AQ,{ref:n,className:Fs("flex cursor-default items-center justify-center py-1",t),...e,children:R.jsx(rye,{className:"h-4 w-4"})}));PQ.displayName=AQ.displayName;const DQ=se.forwardRef(({className:t,...e},n)=>R.jsx(RQ,{ref:n,className:Fs("flex cursor-default items-center justify-center py-1",t),...e,children:R.jsx(AK,{className:"h-4 w-4"})}));DQ.displayName=RQ.displayName;const Nb=se.forwardRef(({className:t,children:e,position:n="popper",...r},i)=>R.jsx(Ybe,{children:R.jsxs(TQ,{ref:i,className:Fs("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...r,children:[R.jsx(PQ,{}),R.jsx(Xbe,{className:Fs("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),R.jsx(DQ,{})]})}));Nb.displayName=TQ.displayName;const Qbe=se.forwardRef(({className:t,...e},n)=>R.jsx(CQ,{ref:n,className:Fs("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));Qbe.displayName=CQ.displayName;const ql=se.forwardRef(({className:t,children:e,...n},r)=>R.jsxs(IQ,{ref:r,className:Fs("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[R.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:R.jsx(Zbe,{children:R.jsx(eye,{className:"h-4 w-4"})})}),R.jsx(Kbe,{children:e})]}));ql.displayName=IQ.displayName;const Jbe=se.forwardRef(({className:t,...e},n)=>R.jsx(MQ,{ref:n,className:Fs("-mx-1 my-1 h-px bg-muted",t),...e}));Jbe.displayName=MQ.displayName;function QU(){const{user:t,loginMutation:e,registerMutation:n,loading:r,logout:i}=A_(),[l,u]=xu(),[s,v]=se.useState("login"),[w,A]=se.useState(!1),[F,W]=se.useState(!1);console.log("AuthPage:",{user:t,loading:r,location:l,activeTab:s}),se.useEffect(()=>{t&&!F&&(console.log("AuthPage: User is authenticated, setting redirect flag"),W(!0))},[t,F]),se.useEffect(()=>{const ye=l.split("/")[1];console.log("AuthPage: Setting active tab based on path:",ye),(ye==="login"||ye==="register")&&v(ye)},[l]);const K=se.useCallback(ye=>{console.log("AuthPage: Tab changed to:",ye),v(ye),u(`/${ye}`)},[u]),[Q,Z]=se.useState({email:"",password:""}),[oe,ae]=se.useState({email:"",username:"",password:"",confirmPassword:"",role:$n.BENEFICIARY,organization:""}),[me,pe]=se.useState({}),_e=se.useCallback(async ye=>{ye.preventDefault(),A(!0),pe({});try{await e.mutateAsync({email:Q.email,password:Q.password})}catch(ue){pe(Ie=>({...Ie,login:ue.message}))}finally{A(!1)}},[Q,e]),De=se.useCallback(async ye=>{if(ye.preventDefault(),A(!0),pe({}),oe.password!==oe.confirmPassword){pe(ue=>({...ue,confirmPassword:"Passwords do not match"})),A(!1);return}try{await n.mutateAsync({email:oe.email,password:oe.password,name:oe.username,role:oe.role})}catch(ue){pe(Ie=>({...Ie,register:ue.message}))}finally{A(!1)}},[oe,n]),Ae=se.useCallback(ye=>ue=>{Z(Ie=>({...Ie,[ye]:ue.target.value}))},[]),re=se.useCallback(ye=>ue=>{ae(Ie=>({...Ie,[ye]:ue.target.value}))},[]),fe=se.useCallback(ye=>{ae(ue=>({...ue,role:ye}))},[]);return r?(console.log("AuthPage: Loading state"),R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:R.jsx(bf,{className:"h-8 w-8 animate-spin text-primary"})})):F?(console.log("AuthPage: Redirecting to home"),R.jsx(pm,{to:"/home"})):(console.log("AuthPage: Rendering auth form"),R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:R.jsxs(El,{className:"w-full max-w-md bg-gray-800 border-gray-700",children:[R.jsxs(Sl,{className:"space-y-1",children:[R.jsx("div",{className:"flex items-center justify-center mb-4",children:R.jsx(kK,{className:"h-12 w-12 text-primary text-white"})}),R.jsx(Tl,{className:"text-2xl text-center text-white",children:"Welcome to HumanitarianAid"}),R.jsx($p,{className:"text-center text-gray-300",children:s==="login"?"Sign in to your account to continue":"Create a new account to get started"})]}),R.jsx(Ql,{children:R.jsxs(o1e,{value:s,onValueChange:K,className:"w-full",children:[R.jsxs(dZ,{className:"grid w-full grid-cols-2 bg-gray-700",children:[R.jsx(hN,{value:"login",className:"text-gray-300 data-[state=active]:text-black",children:"Login"}),R.jsx(hN,{value:"register",className:"text-gray-300 data-[state=active]:text-black",children:"Register"})]}),R.jsx(dN,{value:"login",children:R.jsxs("form",{onSubmit:_e,className:"space-y-4",children:[R.jsxs("div",{className:"space-y-2",children:[R.jsx(gc,{htmlFor:"email",className:"text-gray-300",children:"Email"}),R.jsx(Sh,{id:"email",type:"email",placeholder:"Enter your email",value:Q.email,onChange:Ae("email"),required:!0,className:"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"})]}),R.jsxs("div",{className:"space-y-2",children:[R.jsx(gc,{htmlFor:"password",className:"text-gray-300",children:"Password"}),R.jsx(Sh,{id:"password",type:"password",placeholder:"Enter your password",value:Q.password,onChange:Ae("password"),required:!0,className:"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"})]}),me.login&&R.jsx("div",{className:"text-sm text-red-400",children:me.login}),R.jsx(Bi,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-white",disabled:w,children:w?R.jsxs(R.Fragment,{children:[R.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign In"})]})}),R.jsx(dN,{value:"register",children:R.jsxs("form",{onSubmit:De,className:"space-y-4",children:[R.jsxs("div",{className:"space-y-2",children:[R.jsx(gc,{htmlFor:"username",className:"text-gray-300",children:"Username"}),R.jsx(Sh,{id:"username",type:"text",placeholder:"Choose a username",value:oe.username,onChange:re("username"),required:!0,className:"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"})]}),R.jsxs("div",{className:"space-y-2",children:[R.jsx(gc,{htmlFor:"register-email",className:"text-gray-300",children:"Email"}),R.jsx(Sh,{id:"register-email",type:"email",placeholder:"Enter your email",value:oe.email,onChange:re("email"),required:!0,className:"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"})]}),R.jsxs("div",{className:"space-y-2",children:[R.jsx(gc,{htmlFor:"role",className:"text-gray-300",children:"Role"}),R.jsxs(QT,{value:oe.role,onValueChange:fe,children:[R.jsx(kb,{className:"bg-gray-700 border-gray-600 text-white",children:R.jsx(JT,{placeholder:"Select your role"})}),R.jsxs(Nb,{className:"bg-gray-800 border-gray-700 text-white",children:[R.jsx(ql,{value:$n.BENEFICIARY,children:"Beneficiary"}),R.jsx(ql,{value:$n.DONOR,children:"Donor"}),R.jsx(ql,{value:$n.VOLUNTEER,children:"Volunteer"})]})]})]}),R.jsxs("div",{className:"space-y-2",children:[R.jsx(gc,{htmlFor:"password",className:"text-gray-300",children:"Password"}),R.jsx(Sh,{id:"password",type:"password",placeholder:"Create a password",value:oe.password,onChange:re("password"),required:!0,className:"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"})]}),R.jsxs("div",{className:"space-y-2",children:[R.jsx(gc,{htmlFor:"confirmPassword",className:"text-gray-300",children:"Confirm Password"}),R.jsx(Sh,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:oe.confirmPassword,onChange:re("confirmPassword"),required:!0,className:"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"}),me.confirmPassword&&R.jsx("div",{className:"text-sm text-red-400",children:me.confirmPassword})]}),me.register&&R.jsx("div",{className:"text-sm text-red-400",children:me.register}),R.jsx(Bi,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-white",disabled:w,children:w?R.jsxs(R.Fragment,{children:[R.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating account..."]}):"Create Account"})]})})]})})]})}))}const ewe="modulepreload",twe=function(t){return"/"+t},JU={},KA=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),s=u?.nonce||u?.getAttribute("nonce");i=Promise.allSettled(n.map(v=>{if(v=twe(v),v in JU)return;JU[v]=!0;const w=v.endsWith(".css"),A=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${A}`))return;const F=document.createElement("link");if(F.rel=w?"stylesheet":ewe,w||(F.as="script"),F.crossOrigin="",F.href=v,s&&F.setAttribute("nonce",s),document.head.appendChild(F),w)return new Promise((W,K)=>{F.addEventListener("load",W),F.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${v}`)))})}))}function l(u){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=u,window.dispatchEvent(s),!s.defaultPrevented)throw u}return i.then(u=>{for(const s of u||[])s.status==="rejected"&&l(s.reason);return e().catch(l)})},nwe=se.lazy(()=>KA(()=>import("./AidRequests-0uPFuoNB.js"),[])),rwe=se.lazy(()=>KA(()=>import("./Distributions-BQkxCVjq.js"),[])),iwe=se.lazy(()=>KA(()=>import("./Inventory-BRwNbb6e.js"),[])),swe=se.lazy(()=>KA(()=>import("./Analytics-r8qFBZ8G.js"),[])),XS=()=>R.jsx("div",{className:"flex items-center justify-center p-4",children:R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),owe=()=>{const{user:t,hasPermission:e}=Yo(),n=()=>{const i=[];return e("view_aid_requests")&&i.push({title:"Aid Requests",icon:R.jsx(pye,{className:"h-6 w-6 text-primary"}),description:"View and manage aid requests",path:"/request",component:R.jsx(se.Suspense,{fallback:R.jsx(XS,{}),children:R.jsx(nwe,{})})}),e("view_distributions")&&i.push({title:"Distributions",icon:R.jsx(Jy,{className:"h-6 w-6 text-primary"}),description:"Track aid distributions",path:"/distribution",component:R.jsx(se.Suspense,{fallback:R.jsx(XS,{}),children:R.jsx(rwe,{})})}),e("manage_inventory")&&i.push({title:"Inventory",icon:R.jsx(Jy,{className:"h-6 w-6 text-primary"}),description:"Manage aid inventory",path:"/inventory",component:R.jsx(se.Suspense,{fallback:R.jsx(XS,{}),children:R.jsx(iwe,{})})}),(t?.role==="admin"||t?.role==="staff")&&i.push({title:"Analytics",icon:R.jsx(IK,{className:"h-6 w-6 text-primary"}),description:"View system analytics",path:"/analytics",component:R.jsx(se.Suspense,{fallback:R.jsx(XS,{}),children:R.jsx(swe,{})})}),i},r=()=>[{label:"Aid Requests",value:"150+",description:"Active requests"},{label:"Beneficiaries",value:"2,000+",description:"People helped"},{label:"Volunteers",value:"500+",description:"Active volunteers"},{label:"Aid Distributed",value:"$1.2M",description:"Total value"}];return R.jsx("div",{className:"min-h-screen",children:R.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[R.jsxs("div",{className:"text-center mb-12",children:[R.jsx("div",{className:"flex items-center justify-center mb-6",children:R.jsx(y4,{className:"h-12 w-12 text-white"})}),R.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Welcome to HumanitarianAid"}),R.jsx("p",{className:"text-xl text-white/80 max-w-2xl mx-auto",children:t?`Welcome back, ${t.displayName||"User"}!`:"Connecting those who need help with those who can help"})]}),t?R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"mb-12",children:[R.jsx("h2",{className:"text-2xl font-semibold mb-6 text-white",children:"Quick Actions"}),R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n().map((i,l)=>R.jsx(hu,{href:i.path,children:R.jsx(El,{className:"cursor-pointer hover:shadow-lg transition-shadow bg-white/10 border-0",children:R.jsx(Sl,{children:R.jsxs("div",{className:"flex items-center gap-4",children:[R.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:i.icon}),R.jsxs("div",{children:[R.jsx(Tl,{className:"text-white",children:i.title}),R.jsx($p,{className:"text-white/60",children:i.description})]})]})})})},l))})]}),R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-semibold mb-6 text-white",children:"Overview"}),R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:r().map((i,l)=>R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsxs(Sl,{children:[R.jsx(Tl,{className:"text-3xl font-bold text-white",children:i.value}),R.jsx($p,{className:"text-lg font-medium text-white/60",children:i.label})]}),R.jsx(Ql,{children:R.jsx("p",{className:"text-sm text-white/60",children:i.description})})]},l))})]})]}):R.jsxs("div",{className:"flex flex-col items-center space-y-6",children:[R.jsx("p",{className:"text-lg text-white/80 max-w-2xl text-center",children:"Join our platform to make a difference in your community."}),R.jsxs("div",{className:"flex gap-4",children:[R.jsx(hu,{href:"/auth?type=login",children:R.jsx(Bi,{size:"lg",className:"bg-primary text-white hover:bg-primary/80",children:"Sign In"})}),R.jsx(hu,{href:"/auth?type=register",children:R.jsx(Bi,{size:"lg",variant:"outline",className:"bg-transparent text-white border-white hover:bg-white/10",children:"Register"})})]})]})]})})};function awe(){const[,t]=xu(),{user:e,logout:n}=A_(),r=s=>{t(`/${s}`)},i=()=>{t("/about")},l=()=>{n()},u=()=>{t("/home")};return R.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-900",children:[R.jsx("header",{className:"bg-gray-800 border-b border-gray-700",children:R.jsxs("div",{className:"container mx-auto px-4 py-4 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0",children:[R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx(y4,{className:"h-8 w-8 text-primary text-white"}),R.jsx("span",{className:"text-xl font-bold text-white",children:"HumanitarianAid"})]}),R.jsxs("nav",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-4",children:[R.jsx(Bi,{variant:"ghost",onClick:i,className:"text-gray-300 hover:text-white",children:"About Us"}),e?R.jsxs(R.Fragment,{children:[R.jsx(Bi,{variant:"outline",onClick:u,className:"text-gray-300 hover:text-white",children:"Dashboard"}),R.jsxs(Bi,{variant:"destructive",onClick:l,children:[R.jsx(MK,{className:"mr-2 h-4 w-4"}),"Logout"]})]}):R.jsxs(R.Fragment,{children:[R.jsx(Bi,{variant:"secondary",onClick:()=>r("login"),className:"text-gray-900 text-white",children:"Sign In"}),R.jsx(Bi,{variant:"default",onClick:()=>r("register"),className:"text-white",children:"Create Account"})]})]})]})}),R.jsxs("main",{className:"flex-grow",children:[R.jsx("section",{className:"bg-gradient-to-b from-gray-800 to-gray-900 py-12 sm:py-20",children:R.jsx("div",{className:"container mx-auto px-4",children:R.jsxs("div",{className:"max-w-3xl mx-auto text-center",children:[R.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold mb-4 sm:mb-6 text-white",children:"Connecting Those Who Need Help with Those Who Want to Help"}),R.jsx("p",{className:"text-lg sm:text-xl text-gray-300 mb-6 sm:mb-8",children:"HumanitarianAid is a platform that brings together beneficiaries, donors, and volunteers to create positive change in communities worldwide."}),R.jsxs("div",{className:"flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4",children:[R.jsxs(Bi,{size:"lg",onClick:()=>r("register"),className:"text-white w-full sm:w-auto",children:["Get Started",R.jsx(X0e,{className:"ml-2 h-4 w-4"})]}),R.jsx(Bi,{variant:"outline",size:"lg",onClick:i,className:"text-black w-full sm:w-auto",children:"Learn More"})]})]})})}),R.jsx("section",{className:"py-12 sm:py-20 bg-gray-900",children:R.jsxs("div",{className:"container mx-auto px-4",children:[R.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-8 sm:mb-12 text-white",children:"How It Works"}),R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 sm:gap-8",children:[R.jsxs("div",{className:"text-center p-6 bg-gray-800 rounded-lg",children:[R.jsx(Sw,{className:"h-12 w-12 text-primary text-white mx-auto mb-4"}),R.jsx("h3",{className:"text-xl font-semibold mb-2 text-white",children:"Connect"}),R.jsx("p",{className:"text-gray-300",children:"Join our community of beneficiaries, donors, and volunteers."})]}),R.jsxs("div",{className:"text-center p-6 bg-gray-800 rounded-lg",children:[R.jsx(RK,{className:"h-12 w-12 text-primary text-white mx-auto mb-4"}),R.jsx("h3",{className:"text-xl font-semibold mb-2 text-white",children:"Collaborate"}),R.jsx("p",{className:"text-gray-300",children:"Work together to address humanitarian needs in your community."})]}),R.jsxs("div",{className:"text-center p-6 bg-gray-800 rounded-lg",children:[R.jsx(x4,{className:"h-12 w-12 text-primary text-white mx-auto mb-4"}),R.jsx("h3",{className:"text-xl font-semibold mb-2 text-white",children:"Create Change"}),R.jsx("p",{className:"text-gray-300",children:"Make a real difference in people's lives through coordinated efforts."})]})]})]})})]}),R.jsx("footer",{className:"bg-gray-800 border-t border-gray-700",children:R.jsx("div",{className:"container mx-auto px-4 py-6 sm:py-8",children:R.jsx("div",{className:"text-center text-gray-300",children:" 2024 HumanitarianAid. All rights reserved."})})})]})}function lwe(){const{user:t,isLoading:e}=Yo(),{user:n,isLoading:r}=A_(),[,i]=xu();return se.useEffect(()=>{!r&&!n&&i("/auth?type=login")},[n,r,i]),e||r?R.jsx("div",{className:"min-h-screen flex items-center justify-center",children:R.jsx(bf,{className:"h-8 w-8 animate-spin text-white"})}):!t||!n?R.jsx("div",{className:"min-h-screen flex items-center justify-center",children:R.jsxs(El,{className:"w-full max-w-md bg-white/10 border-0",children:[R.jsxs(Sl,{children:[R.jsx("div",{className:"flex items-center justify-center mb-4",children:R.jsx(kK,{className:"h-12 w-12 text-red-500"})}),R.jsx(Tl,{className:"text-2xl text-center text-white",children:"Access Denied"}),R.jsx($p,{className:"text-center text-white/60",children:"You must be logged in to access this page"})]}),R.jsx(Ql,{className:"flex justify-center",children:R.jsx(Bi,{onClick:()=>i("/auth?type=login"),className:"bg-primary text-white hover:bg-primary/80",children:"Go to Login"})})]})}):R.jsx("div",{className:"min-h-screen py-12 px-4 sm:px-6 lg:px-8",children:R.jsxs("div",{className:"max-w-7xl mx-auto",children:[R.jsxs("div",{className:"text-center mb-12",children:[R.jsxs("h1",{className:"text-3xl font-bold text-white",children:["Welcome, ",t.name,"!"]}),R.jsxs("p",{className:"mt-2 text-white/80",children:["Role: ",t.role]})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsxs(Sl,{children:[R.jsx(Tl,{className:"text-white",children:"Quick Actions"}),R.jsx($p,{className:"text-white/60",children:"Common tasks and operations"})]}),R.jsxs(Ql,{className:"space-y-4",children:[R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/profile"),children:"View Profile"}),R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/settings"),children:"Update Settings"}),R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/notifications"),children:"View Notifications"})]})]}),R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsxs(Sl,{children:[R.jsx(Tl,{className:"text-white",children:"Role Dashboard"}),R.jsx($p,{className:"text-white/60",children:"Features specific to your role"})]}),R.jsxs(Ql,{className:"space-y-4",children:[t.role==="admin"&&R.jsxs(R.Fragment,{children:[R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/admin-dashboard"),children:"Manage Users"}),R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/settings"),children:"System Settings"})]}),t.role==="beneficiary"&&R.jsxs(R.Fragment,{children:[R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/request"),children:"View My Aid Requests"}),R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/deliveries"),children:"Track My Shipments"})]}),t.role==="donor"&&R.jsxs(R.Fragment,{children:[R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/donations"),children:"Manage My Donations"}),R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/analytics"),children:"View My Impact"})]}),t.role==="volunteer"&&R.jsxs(R.Fragment,{children:[R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/deliveries"),children:"View My Assignments"}),R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/volunteer-hours"),children:"Report My Hours"})]}),t.role==="staff"&&R.jsxs(R.Fragment,{children:[R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/inventory"),children:"Manage Inventory"}),R.jsx(Bi,{className:"w-full bg-transparent text-white border-white hover:bg-white/10",variant:"outline",onClick:()=>i("/distribution"),children:"Oversee Distributions"})]})]})]}),R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsxs(Sl,{children:[R.jsx(Tl,{className:"text-white",children:"System Status"}),R.jsx($p,{className:"text-white/60",children:"Current system information"})]}),R.jsxs(Ql,{className:"space-y-4",children:[R.jsxs("div",{className:"flex justify-between items-center",children:[R.jsx("span",{className:"text-white/60",children:"Last Login"}),R.jsx("span",{className:"text-white",children:new Date().toLocaleString()})]}),R.jsxs("div",{className:"flex justify-between items-center",children:[R.jsx("span",{className:"text-white/60",children:"Account Status"}),R.jsx("span",{className:"text-green-400",children:"Active"})]}),R.jsxs("div",{className:"flex justify-between items-center",children:[R.jsx("span",{className:"text-white/60",children:"Notifications"}),R.jsx("span",{className:"text-white",children:"0 unread"})]})]})]})]})]})})}var ZA="Dialog",[kQ,Y5e]=M_(ZA),[cwe,Uh]=kQ(ZA),NQ=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:l,modal:u=!0}=t,s=se.useRef(null),v=se.useRef(null),[w,A]=tx({prop:r,defaultProp:i??!1,onChange:l,caller:ZA});return R.jsx(cwe,{scope:e,triggerRef:s,contentRef:v,contentId:cm(),titleId:cm(),descriptionId:cm(),open:w,onOpenChange:A,onOpenToggle:se.useCallback(()=>A(F=>!F),[A]),modal:u,children:n})};NQ.displayName=ZA;var OQ="DialogTrigger",uwe=se.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Uh(OQ,n),l=No(e,i.triggerRef);return R.jsx(Xi.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":V4(i.open),...r,ref:l,onClick:Di(t.onClick,i.onOpenToggle)})});uwe.displayName=OQ;var z4="DialogPortal",[hwe,LQ]=kQ(z4,{forceMount:void 0}),FQ=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,l=Uh(z4,e);return R.jsx(hwe,{scope:e,forceMount:n,children:se.Children.map(r,u=>R.jsx(Ix,{present:n||l.open,children:R.jsx($A,{asChild:!0,container:i,children:u})}))})};FQ.displayName=z4;var dI="DialogOverlay",BQ=se.forwardRef((t,e)=>{const n=LQ(dI,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,l=Uh(dI,t.__scopeDialog);return l.modal?R.jsx(Ix,{present:r||l.open,children:R.jsx(fwe,{...i,ref:e})}):null});BQ.displayName=dI;var dwe=ex("DialogOverlay.RemoveScroll"),fwe=se.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Uh(dI,n);return R.jsx(F4,{as:dwe,allowPinchZoom:!0,shards:[i.contentRef],children:R.jsx(Xi.div,{"data-state":V4(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),p_="DialogContent",zQ=se.forwardRef((t,e)=>{const n=LQ(p_,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,l=Uh(p_,t.__scopeDialog);return R.jsx(Ix,{present:r||l.open,children:l.modal?R.jsx(pwe,{...i,ref:e}):R.jsx(mwe,{...i,ref:e})})});zQ.displayName=p_;var pwe=se.forwardRef((t,e)=>{const n=Uh(p_,t.__scopeDialog),r=se.useRef(null),i=No(e,n.contentRef,r);return se.useEffect(()=>{const l=r.current;if(l)return HZ(l)},[]),R.jsx(jQ,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Di(t.onCloseAutoFocus,l=>{l.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Di(t.onPointerDownOutside,l=>{const u=l.detail.originalEvent,s=u.button===0&&u.ctrlKey===!0;(u.button===2||s)&&l.preventDefault()}),onFocusOutside:Di(t.onFocusOutside,l=>l.preventDefault())})}),mwe=se.forwardRef((t,e)=>{const n=Uh(p_,t.__scopeDialog),r=se.useRef(!1),i=se.useRef(!1);return R.jsx(jQ,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{t.onCloseAutoFocus?.(l),l.defaultPrevented||(r.current||n.triggerRef.current?.focus(),l.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:l=>{t.onInteractOutside?.(l),l.defaultPrevented||(r.current=!0,l.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const u=l.target;n.triggerRef.current?.contains(u)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&i.current&&l.preventDefault()}})}),jQ=se.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:l,...u}=t,s=Uh(p_,n),v=se.useRef(null),w=No(e,v);return yZ(),R.jsxs(R.Fragment,{children:[R.jsx(C4,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:l,children:R.jsx(VA,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":V4(s.open),...u,ref:w,onDismiss:()=>s.onOpenChange(!1)})}),R.jsxs(R.Fragment,{children:[R.jsx(gwe,{titleId:s.titleId}),R.jsx(ywe,{contentRef:v,descriptionId:s.descriptionId})]})]})}),j4="DialogTitle",VQ=se.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Uh(j4,n);return R.jsx(Xi.h2,{id:i.titleId,...r,ref:e})});VQ.displayName=j4;var UQ="DialogDescription",HQ=se.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Uh(UQ,n);return R.jsx(Xi.p,{id:i.descriptionId,...r,ref:e})});HQ.displayName=UQ;var WQ="DialogClose",$Q=se.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Uh(WQ,n);return R.jsx(Xi.button,{type:"button",...r,ref:e,onClick:Di(t.onClick,()=>i.onOpenChange(!1))})});$Q.displayName=WQ;function V4(t){return t?"open":"closed"}var qQ="DialogTitleWarning",[X5e,GQ]=Gye(qQ,{contentName:p_,titleName:j4,docsSlug:"dialog"}),gwe=({titleId:t})=>{const e=GQ(qQ),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return se.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},_we="DialogDescriptionWarning",ywe=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${GQ(_we).contentName}}.`;return se.useEffect(()=>{const i=t.current?.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},xwe=NQ,vwe=FQ,YQ=BQ,XQ=zQ,KQ=VQ,ZQ=HQ,bwe=$Q;const KS=xwe,wwe=vwe,QQ=se.forwardRef(({className:t,...e},n)=>R.jsx(YQ,{ref:n,className:Fs("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));QQ.displayName=YQ.displayName;const lb=se.forwardRef(({className:t,children:e,...n},r)=>R.jsxs(wwe,{children:[R.jsx(QQ,{}),R.jsxs(XQ,{ref:r,className:Fs("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[e,R.jsxs(bwe,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[R.jsx(v4,{className:"h-4 w-4"}),R.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));lb.displayName=XQ.displayName;const cb=se.forwardRef(({className:t,...e},n)=>R.jsx(KQ,{ref:n,className:Fs("text-lg font-semibold leading-none tracking-tight",t),...e}));cb.displayName=KQ.displayName;const Ewe=se.forwardRef(({className:t,...e},n)=>R.jsx(ZQ,{ref:n,className:Fs("text-sm text-muted-foreground",t),...e}));Ewe.displayName=ZQ.displayName;var Cr;(function(t){t[t.QR_CODE=0]="QR_CODE",t[t.AZTEC=1]="AZTEC",t[t.CODABAR=2]="CODABAR",t[t.CODE_39=3]="CODE_39",t[t.CODE_93=4]="CODE_93",t[t.CODE_128=5]="CODE_128",t[t.DATA_MATRIX=6]="DATA_MATRIX",t[t.MAXICODE=7]="MAXICODE",t[t.ITF=8]="ITF",t[t.EAN_13=9]="EAN_13",t[t.EAN_8=10]="EAN_8",t[t.PDF_417=11]="PDF_417",t[t.RSS_14=12]="RSS_14",t[t.RSS_EXPANDED=13]="RSS_EXPANDED",t[t.UPC_A=14]="UPC_A",t[t.UPC_E=15]="UPC_E",t[t.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Cr||(Cr={}));var e7=new Map([[Cr.QR_CODE,"QR_CODE"],[Cr.AZTEC,"AZTEC"],[Cr.CODABAR,"CODABAR"],[Cr.CODE_39,"CODE_39"],[Cr.CODE_93,"CODE_93"],[Cr.CODE_128,"CODE_128"],[Cr.DATA_MATRIX,"DATA_MATRIX"],[Cr.MAXICODE,"MAXICODE"],[Cr.ITF,"ITF"],[Cr.EAN_13,"EAN_13"],[Cr.EAN_8,"EAN_8"],[Cr.PDF_417,"PDF_417"],[Cr.RSS_14,"RSS_14"],[Cr.RSS_EXPANDED,"RSS_EXPANDED"],[Cr.UPC_A,"UPC_A"],[Cr.UPC_E,"UPC_E"],[Cr.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),t7;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.URL=1]="URL"})(t7||(t7={}));function Swe(t){return Object.values(Cr).includes(t)}var Cm;(function(t){t[t.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",t[t.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Cm||(Cm={}));var wh=function(){function t(){}return t.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",t.SCAN_DEFAULT_FPS=2,t.DEFAULT_DISABLE_FLIP=!1,t.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,t.DEFAULT_SUPPORTED_SCAN_TYPE=[Cm.SCAN_TYPE_CAMERA,Cm.SCAN_TYPE_FILE],t}(),JQ=function(){function t(e,n){this.format=e,this.formatName=n}return t.prototype.toString=function(){return this.formatName},t.create=function(e){if(!e7.has(e))throw"".concat(e," not in html5QrcodeSupportedFormatsTextMap");return new t(e,e7.get(e))},t}(),n7=function(){function t(){}return t.createFromText=function(e){var n={text:e};return{decodedText:e,result:n}},t.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},t}(),EN;(function(t){t[t.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",t[t.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",t[t.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(EN||(EN={}));var eJ=function(){function t(){}return t.createFrom=function(e){return{errorMessage:e,type:EN.UNKWOWN_ERROR}},t}(),tJ=function(){function t(e){this.verbose=e}return t.prototype.log=function(e){this.verbose&&console.log(e)},t.prototype.warn=function(e){this.verbose&&console.warn(e)},t.prototype.logError=function(e,n){(this.verbose||n===!0)&&console.error(e)},t.prototype.logErrors=function(e){if(e.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},t}();function dd(t){return typeof t>"u"||t===null}function Twe(t,e,n){return t>n?n:t<e?e:t}var uy=function(){function t(){}return t.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},t.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},t.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},t.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},t.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},t.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},t.scannerPaused=function(){return"Scanner paused"},t}(),Xs=function(){function t(){}return t.scanningStatus=function(){return"Scanning"},t.idleStatus=function(){return"Idle"},t.errorStatus=function(){return"Error"},t.permissionStatus=function(){return"Permission"},t.noCameraFoundErrorStatus=function(){return"No Cameras"},t.lastMatch=function(e){return"Last Match: ".concat(e)},t.codeScannerTitle=function(){return"Code Scanner"},t.cameraPermissionTitle=function(){return"Request Camera Permissions"},t.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},t.noCameraFound=function(){return"No camera found"},t.scanButtonStopScanningText=function(){return"Stop Scanning"},t.scanButtonStartScanningText=function(){return"Start Scanning"},t.torchOnButton=function(){return"Switch On Torch"},t.torchOffButton=function(){return"Switch Off Torch"},t.torchOnFailedMessage=function(){return"Failed to turn on torch"},t.torchOffFailedMessage=function(){return"Failed to turn off torch"},t.scanButtonScanningStarting=function(){return"Launching Camera..."},t.textIfCameraScanSelected=function(){return"Scan an Image File"},t.textIfFileScanSelected=function(){return"Scan using camera directly"},t.selectCamera=function(){return"Select Camera"},t.fileSelectionChooseImage=function(){return"Choose Image"},t.fileSelectionChooseAnother=function(){return"Choose Another"},t.fileSelectionNoImageSelected=function(){return"No image choosen"},t.anonymousCameraPrefix=function(){return"Anonymous Camera"},t.dragAndDropMessage=function(){return"Or drop an image to scan"},t.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},t.zoom=function(){return"zoom"},t.loadingImage=function(){return"Loading image..."},t.cameraScanAltText=function(){return"Camera based scan"},t.fileScanAltText=function(){return"Fule based scan"},t}(),r7=function(){function t(){}return t.poweredBy=function(){return"Powered by "},t.reportIssues=function(){return"Report issues"},t}(),nJ=function(){function t(){}return t.isMediaStreamConstraintsValid=function(e,n){if(typeof e!="object"){var r=typeof e;return n.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(r,"."),!0),!1}for(var i=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],l=new Set(i),u=Object.keys(e),s=0,v=u;s<v.length;s++){var w=v[s];if(l.has(w))return n.logError("".concat(w," is not supported videoConstaints."),!0),!1}return!0},t}(),SN={exports:{}};(function(t,e){(function(n,r){r(e)})($0,function(n){function r(Ne){return Ne==null}var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Ne,m){Ne.__proto__=m}||function(Ne,m){for(var b in m)m.hasOwnProperty(b)&&(Ne[b]=m[b])};function l(Ne,m){i(Ne,m);function b(){this.constructor=Ne}Ne.prototype=m===null?Object.create(m):(b.prototype=m.prototype,new b)}function u(Ne,m){var b=Object.setPrototypeOf;b?b(Ne,m):Ne.__proto__=m}function s(Ne,m){m===void 0&&(m=Ne.constructor);var b=Error.captureStackTrace;b&&b(Ne,m)}var v=function(Ne){l(m,Ne);function m(b){var S=this.constructor,P=Ne.call(this,b)||this;return Object.defineProperty(P,"name",{value:S.name,enumerable:!1}),u(P,S.prototype),s(P),P}return m}(Error);class w extends v{constructor(m=void 0){super(m),this.message=m}getKind(){return this.constructor.kind}}w.kind="Exception";class A extends w{}A.kind="ArgumentException";class F extends w{}F.kind="IllegalArgumentException";class W{constructor(m){if(this.binarizer=m,m===null)throw new F("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(m,b){return this.binarizer.getBlackRow(m,b)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(m,b,S,P){const N=this.binarizer.getLuminanceSource().crop(m,b,S,P);return new W(this.binarizer.createBinarizer(N))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const m=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new W(this.binarizer.createBinarizer(m))}rotateCounterClockwise45(){const m=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new W(this.binarizer.createBinarizer(m))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class K extends w{static getChecksumInstance(){return new K}}K.kind="ChecksumException";class Q{constructor(m){this.source=m}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class Z{static arraycopy(m,b,S,P,N){for(;N--;)S[P++]=m[b++]}static currentTimeMillis(){return Date.now()}}class oe extends w{}oe.kind="IndexOutOfBoundsException";class ae extends oe{constructor(m=void 0,b=void 0){super(b),this.index=m,this.message=b}}ae.kind="ArrayIndexOutOfBoundsException";class me{static fill(m,b){for(let S=0,P=m.length;S<P;S++)m[S]=b}static fillWithin(m,b,S,P){me.rangeCheck(m.length,b,S);for(let N=b;N<S;N++)m[N]=P}static rangeCheck(m,b,S){if(b>S)throw new F("fromIndex("+b+") > toIndex("+S+")");if(b<0)throw new ae(b);if(S>m)throw new ae(S)}static asList(...m){return m}static create(m,b,S){return Array.from({length:m}).map(N=>Array.from({length:b}).fill(S))}static createInt32Array(m,b,S){return Array.from({length:m}).map(N=>Int32Array.from({length:b}).fill(S))}static equals(m,b){if(!m||!b||!m.length||!b.length||m.length!==b.length)return!1;for(let S=0,P=m.length;S<P;S++)if(m[S]!==b[S])return!1;return!0}static hashCode(m){if(m===null)return 0;let b=1;for(const S of m)b=31*b+S;return b}static fillUint8Array(m,b){for(let S=0;S!==m.length;S++)m[S]=b}static copyOf(m,b){return m.slice(0,b)}static copyOfUint8Array(m,b){if(m.length<=b){const S=new Uint8Array(b);return S.set(m),S}return m.slice(0,b)}static copyOfRange(m,b,S){const P=S-b,N=new Int32Array(P);return Z.arraycopy(m,b,N,0,P),N}static binarySearch(m,b,S){S===void 0&&(S=me.numberComparator);let P=0,N=m.length-1;for(;P<=N;){const V=N+P>>1,$=S(b,m[V]);if($>0)P=V+1;else if($<0)N=V-1;else return V}return-P-1}static numberComparator(m,b){return m-b}}class pe{static numberOfTrailingZeros(m){let b;if(m===0)return 32;let S=31;return b=m<<16,b!==0&&(S-=16,m=b),b=m<<8,b!==0&&(S-=8,m=b),b=m<<4,b!==0&&(S-=4,m=b),b=m<<2,b!==0&&(S-=2,m=b),S-(m<<1>>>31)}static numberOfLeadingZeros(m){if(m===0)return 32;let b=1;return m>>>16||(b+=16,m<<=16),m>>>24||(b+=8,m<<=8),m>>>28||(b+=4,m<<=4),m>>>30||(b+=2,m<<=2),b-=m>>>31,b}static toHexString(m){return m.toString(16)}static toBinaryString(m){return String(parseInt(String(m),2))}static bitCount(m){return m=m-(m>>>1&1431655765),m=(m&858993459)+(m>>>2&858993459),m=m+(m>>>4)&252645135,m=m+(m>>>8),m=m+(m>>>16),m&63}static truncDivision(m,b){return Math.trunc(m/b)}static parseInt(m,b=void 0){return parseInt(m,b)}}pe.MIN_VALUE_32_BITS=-2147483648,pe.MAX_VALUE=Number.MAX_SAFE_INTEGER;class _e{constructor(m,b){m===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=m,b==null?this.bits=_e.makeArray(m):this.bits=b)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(m){if(m>this.bits.length*32){const b=_e.makeArray(m);Z.arraycopy(this.bits,0,b,0,this.bits.length),this.bits=b}}get(m){return(this.bits[Math.floor(m/32)]&1<<(m&31))!==0}set(m){this.bits[Math.floor(m/32)]|=1<<(m&31)}flip(m){this.bits[Math.floor(m/32)]^=1<<(m&31)}getNextSet(m){const b=this.size;if(m>=b)return b;const S=this.bits;let P=Math.floor(m/32),N=S[P];N&=~((1<<(m&31))-1);const V=S.length;for(;N===0;){if(++P===V)return b;N=S[P]}const $=P*32+pe.numberOfTrailingZeros(N);return $>b?b:$}getNextUnset(m){const b=this.size;if(m>=b)return b;const S=this.bits;let P=Math.floor(m/32),N=~S[P];N&=~((1<<(m&31))-1);const V=S.length;for(;N===0;){if(++P===V)return b;N=~S[P]}const $=P*32+pe.numberOfTrailingZeros(N);return $>b?b:$}setBulk(m,b){this.bits[Math.floor(m/32)]=b}setRange(m,b){if(b<m||m<0||b>this.size)throw new F;if(b===m)return;b--;const S=Math.floor(m/32),P=Math.floor(b/32),N=this.bits;for(let V=S;V<=P;V++){const $=V>S?0:m&31,de=(2<<(V<P?31:b&31))-(1<<$);N[V]|=de}}clear(){const m=this.bits.length,b=this.bits;for(let S=0;S<m;S++)b[S]=0}isRange(m,b,S){if(b<m||m<0||b>this.size)throw new F;if(b===m)return!0;b--;const P=Math.floor(m/32),N=Math.floor(b/32),V=this.bits;for(let $=P;$<=N;$++){const te=$>P?0:m&31,Re=(2<<($<N?31:b&31))-(1<<te)&4294967295;if((V[$]&Re)!==(S?Re:0))return!1}return!0}appendBit(m){this.ensureCapacity(this.size+1),m&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(m,b){if(b<0||b>32)throw new F("Num bits must be between 0 and 32");this.ensureCapacity(this.size+b);for(let S=b;S>0;S--)this.appendBit((m>>S-1&1)===1)}appendBitArray(m){const b=m.size;this.ensureCapacity(this.size+b);for(let S=0;S<b;S++)this.appendBit(m.get(S))}xor(m){if(this.size!==m.size)throw new F("Sizes don't match");const b=this.bits;for(let S=0,P=b.length;S<P;S++)b[S]^=m.bits[S]}toBytes(m,b,S,P){for(let N=0;N<P;N++){let V=0;for(let $=0;$<8;$++)this.get(m)&&(V|=1<<7-$),m++;b[S+N]=V}}getBitArray(){return this.bits}reverse(){const m=new Int32Array(this.bits.length),b=Math.floor((this.size-1)/32),S=b+1,P=this.bits;for(let N=0;N<S;N++){let V=P[N];V=V>>1&1431655765|(V&1431655765)<<1,V=V>>2&858993459|(V&858993459)<<2,V=V>>4&252645135|(V&252645135)<<4,V=V>>8&16711935|(V&16711935)<<8,V=V>>16&65535|(V&65535)<<16,m[b-N]=V}if(this.size!==S*32){const N=S*32-this.size;let V=m[0]>>>N;for(let $=1;$<S;$++){const te=m[$];V|=te<<32-N,m[$-1]=V,V=te>>>N}m[S-1]=V}this.bits=m}static makeArray(m){return new Int32Array(Math.floor((m+31)/32))}equals(m){if(!(m instanceof _e))return!1;const b=m;return this.size===b.size&&me.equals(this.bits,b.bits)}hashCode(){return 31*this.size+me.hashCode(this.bits)}toString(){let m="";for(let b=0,S=this.size;b<S;b++)b&7||(m+=" "),m+=this.get(b)?"X":".";return m}clone(){return new _e(this.size,this.bits.slice())}}var De;(function(Ne){Ne[Ne.OTHER=0]="OTHER",Ne[Ne.PURE_BARCODE=1]="PURE_BARCODE",Ne[Ne.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",Ne[Ne.TRY_HARDER=3]="TRY_HARDER",Ne[Ne.CHARACTER_SET=4]="CHARACTER_SET",Ne[Ne.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",Ne[Ne.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",Ne[Ne.ASSUME_GS1=7]="ASSUME_GS1",Ne[Ne.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",Ne[Ne.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",Ne[Ne.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(De||(De={}));var Ae=De;class re extends w{static getFormatInstance(){return new re}}re.kind="FormatException";var fe;(function(Ne){Ne[Ne.Cp437=0]="Cp437",Ne[Ne.ISO8859_1=1]="ISO8859_1",Ne[Ne.ISO8859_2=2]="ISO8859_2",Ne[Ne.ISO8859_3=3]="ISO8859_3",Ne[Ne.ISO8859_4=4]="ISO8859_4",Ne[Ne.ISO8859_5=5]="ISO8859_5",Ne[Ne.ISO8859_6=6]="ISO8859_6",Ne[Ne.ISO8859_7=7]="ISO8859_7",Ne[Ne.ISO8859_8=8]="ISO8859_8",Ne[Ne.ISO8859_9=9]="ISO8859_9",Ne[Ne.ISO8859_10=10]="ISO8859_10",Ne[Ne.ISO8859_11=11]="ISO8859_11",Ne[Ne.ISO8859_13=12]="ISO8859_13",Ne[Ne.ISO8859_14=13]="ISO8859_14",Ne[Ne.ISO8859_15=14]="ISO8859_15",Ne[Ne.ISO8859_16=15]="ISO8859_16",Ne[Ne.SJIS=16]="SJIS",Ne[Ne.Cp1250=17]="Cp1250",Ne[Ne.Cp1251=18]="Cp1251",Ne[Ne.Cp1252=19]="Cp1252",Ne[Ne.Cp1256=20]="Cp1256",Ne[Ne.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",Ne[Ne.UTF8=22]="UTF8",Ne[Ne.ASCII=23]="ASCII",Ne[Ne.Big5=24]="Big5",Ne[Ne.GB18030=25]="GB18030",Ne[Ne.EUC_KR=26]="EUC_KR"})(fe||(fe={}));class ye{constructor(m,b,S,...P){this.valueIdentifier=m,this.name=S,typeof b=="number"?this.values=Int32Array.from([b]):this.values=b,this.otherEncodingNames=P,ye.VALUE_IDENTIFIER_TO_ECI.set(m,this),ye.NAME_TO_ECI.set(S,this);const N=this.values;for(let V=0,$=N.length;V!==$;V++){const te=N[V];ye.VALUES_TO_ECI.set(te,this)}for(const V of P)ye.NAME_TO_ECI.set(V,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(m){if(m<0||m>=900)throw new re("incorect value");const b=ye.VALUES_TO_ECI.get(m);if(b===void 0)throw new re("incorect value");return b}static getCharacterSetECIByName(m){const b=ye.NAME_TO_ECI.get(m);if(b===void 0)throw new re("incorect value");return b}equals(m){if(!(m instanceof ye))return!1;const b=m;return this.getName()===b.getName()}}ye.VALUE_IDENTIFIER_TO_ECI=new Map,ye.VALUES_TO_ECI=new Map,ye.NAME_TO_ECI=new Map,ye.Cp437=new ye(fe.Cp437,Int32Array.from([0,2]),"Cp437"),ye.ISO8859_1=new ye(fe.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),ye.ISO8859_2=new ye(fe.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),ye.ISO8859_3=new ye(fe.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),ye.ISO8859_4=new ye(fe.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),ye.ISO8859_5=new ye(fe.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),ye.ISO8859_6=new ye(fe.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),ye.ISO8859_7=new ye(fe.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),ye.ISO8859_8=new ye(fe.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),ye.ISO8859_9=new ye(fe.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),ye.ISO8859_10=new ye(fe.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),ye.ISO8859_11=new ye(fe.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),ye.ISO8859_13=new ye(fe.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),ye.ISO8859_14=new ye(fe.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),ye.ISO8859_15=new ye(fe.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),ye.ISO8859_16=new ye(fe.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),ye.SJIS=new ye(fe.SJIS,20,"SJIS","Shift_JIS"),ye.Cp1250=new ye(fe.Cp1250,21,"Cp1250","windows-1250"),ye.Cp1251=new ye(fe.Cp1251,22,"Cp1251","windows-1251"),ye.Cp1252=new ye(fe.Cp1252,23,"Cp1252","windows-1252"),ye.Cp1256=new ye(fe.Cp1256,24,"Cp1256","windows-1256"),ye.UnicodeBigUnmarked=new ye(fe.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),ye.UTF8=new ye(fe.UTF8,26,"UTF8","UTF-8"),ye.ASCII=new ye(fe.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),ye.Big5=new ye(fe.Big5,28,"Big5"),ye.GB18030=new ye(fe.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),ye.EUC_KR=new ye(fe.EUC_KR,30,"EUC_KR","EUC-KR");class ue extends w{}ue.kind="UnsupportedOperationException";class Ie{static decode(m,b){const S=this.encodingName(b);return this.customDecoder?this.customDecoder(m,S):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(S)?this.decodeFallback(m,S):new TextDecoder(S).decode(m)}static shouldDecodeOnFallback(m){return!Ie.isBrowser()&&m==="ISO-8859-1"}static encode(m,b){const S=this.encodingName(b);return this.customEncoder?this.customEncoder(m,S):typeof TextEncoder>"u"?this.encodeFallback(m):new TextEncoder().encode(m)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(m){return typeof m=="string"?m:m.getName()}static encodingCharacterSet(m){return m instanceof ye?m:ye.getCharacterSetECIByName(m)}static decodeFallback(m,b){const S=this.encodingCharacterSet(b);if(Ie.isDecodeFallbackSupported(S)){let P="";for(let N=0,V=m.length;N<V;N++){let $=m[N].toString(16);$.length<2&&($="0"+$),P+="%"+$}return decodeURIComponent(P)}if(S.equals(ye.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(m.buffer));throw new ue(`Encoding ${this.encodingName(b)} not supported by fallback.`)}static isDecodeFallbackSupported(m){return m.equals(ye.UTF8)||m.equals(ye.ISO8859_1)||m.equals(ye.ASCII)}static encodeFallback(m){const S=btoa(unescape(encodeURIComponent(m))).split(""),P=[];for(let N=0;N<S.length;N++)P.push(S[N].charCodeAt(0));return new Uint8Array(P)}}class Oe{static castAsNonUtf8Char(m,b=null){const S=b?b.getName():this.ISO88591;return Ie.decode(new Uint8Array([m]),S)}static guessEncoding(m,b){if(b!=null&&b.get(Ae.CHARACTER_SET)!==void 0)return b.get(Ae.CHARACTER_SET).toString();const S=m.length;let P=!0,N=!0,V=!0,$=0,te=0,de=0,Re=0,Fe=0,Ge=0,dt=0,Ct=0,Pt=0,$t=0,tn=0;const Vn=m.length>3&&m[0]===239&&m[1]===187&&m[2]===191;for(let zn=0;zn<S&&(P||N||V);zn++){const Dn=m[zn]&255;V&&($>0?Dn&128?$--:V=!1:Dn&128&&(Dn&64?($++,Dn&32?($++,Dn&16?($++,Dn&8?V=!1:Re++):de++):te++):V=!1)),P&&(Dn>127&&Dn<160?P=!1:Dn>159&&(Dn<192||Dn===215||Dn===247)&&tn++),N&&(Fe>0?Dn<64||Dn===127||Dn>252?N=!1:Fe--:Dn===128||Dn===160||Dn>239?N=!1:Dn>160&&Dn<224?(Ge++,Ct=0,dt++,dt>Pt&&(Pt=dt)):Dn>127?(Fe++,dt=0,Ct++,Ct>$t&&($t=Ct)):(dt=0,Ct=0))}return V&&$>0&&(V=!1),N&&Fe>0&&(N=!1),V&&(Vn||te+de+Re>0)?Oe.UTF8:N&&(Oe.ASSUME_SHIFT_JIS||Pt>=3||$t>=3)?Oe.SHIFT_JIS:P&&N?Pt===2&&Ge===2||tn*10>=S?Oe.SHIFT_JIS:Oe.ISO88591:P?Oe.ISO88591:N?Oe.SHIFT_JIS:V?Oe.UTF8:Oe.PLATFORM_DEFAULT_ENCODING}static format(m,...b){let S=-1;function P(V,$,te,de,Re,Fe){if(V==="%%")return"%";if(b[++S]===void 0)return;V=de?parseInt(de.substr(1)):void 0;let Ge=Re?parseInt(Re.substr(1)):void 0,dt;switch(Fe){case"s":dt=b[S];break;case"c":dt=b[S][0];break;case"f":dt=parseFloat(b[S]).toFixed(V);break;case"p":dt=parseFloat(b[S]).toPrecision(V);break;case"e":dt=parseFloat(b[S]).toExponential(V);break;case"x":dt=parseInt(b[S]).toString(Ge||16);break;case"d":dt=parseFloat(parseInt(b[S],Ge||10).toPrecision(V)).toFixed(0);break}dt=typeof dt=="object"?JSON.stringify(dt):(+dt).toString(Ge);let Ct=parseInt(te),Pt=te&&te[0]+""=="0"?"0":" ";for(;dt.length<Ct;)dt=$!==void 0?dt+Pt:Pt+dt;return dt}let N=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return m.replace(N,P)}static getBytes(m,b){return Ie.encode(m,b)}static getCharCode(m,b=0){return m.charCodeAt(b)}static getCharAt(m){return String.fromCharCode(m)}}Oe.SHIFT_JIS=ye.SJIS.getName(),Oe.GB2312="GB2312",Oe.ISO88591=ye.ISO8859_1.getName(),Oe.EUC_JP="EUC_JP",Oe.UTF8=ye.UTF8.getName(),Oe.PLATFORM_DEFAULT_ENCODING=Oe.UTF8,Oe.ASSUME_SHIFT_JIS=!1;class ze{constructor(m=""){this.value=m}enableDecoding(m){return this.encoding=m,this}append(m){return typeof m=="string"?this.value+=m.toString():this.encoding?this.value+=Oe.castAsNonUtf8Char(m,this.encoding):this.value+=String.fromCharCode(m),this}appendChars(m,b,S){for(let P=b;b<b+S;P++)this.append(m[P]);return this}length(){return this.value.length}charAt(m){return this.value.charAt(m)}deleteCharAt(m){this.value=this.value.substr(0,m)+this.value.substring(m+1)}setCharAt(m,b){this.value=this.value.substr(0,m)+b+this.value.substr(m+1)}substring(m,b){return this.value.substring(m,b)}setLengthToZero(){this.value=""}toString(){return this.value}insert(m,b){this.value=this.value.substr(0,m)+b+this.value.substr(m+b.length)}}class ft{constructor(m,b,S,P){if(this.width=m,this.height=b,this.rowSize=S,this.bits=P,b==null&&(b=m),this.height=b,m<1||b<1)throw new F("Both dimensions must be greater than 0");S==null&&(S=Math.floor((m+31)/32)),this.rowSize=S,P==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(m){const b=m.length,S=m[0].length,P=new ft(S,b);for(let N=0;N<b;N++){const V=m[N];for(let $=0;$<S;$++)V[$]&&P.set($,N)}return P}static parseFromString(m,b,S){if(m===null)throw new F("stringRepresentation cannot be null");const P=new Array(m.length);let N=0,V=0,$=-1,te=0,de=0;for(;de<m.length;)if(m.charAt(de)===`
`||m.charAt(de)==="\r"){if(N>V){if($===-1)$=N-V;else if(N-V!==$)throw new F("row lengths do not match");V=N,te++}de++}else if(m.substring(de,de+b.length)===b)de+=b.length,P[N]=!0,N++;else if(m.substring(de,de+S.length)===S)de+=S.length,P[N]=!1,N++;else throw new F("illegal character encountered: "+m.substring(de));if(N>V){if($===-1)$=N-V;else if(N-V!==$)throw new F("row lengths do not match");te++}const Re=new ft($,te);for(let Fe=0;Fe<N;Fe++)P[Fe]&&Re.set(Math.floor(Fe%$),Math.floor(Fe/$));return Re}get(m,b){const S=b*this.rowSize+Math.floor(m/32);return(this.bits[S]>>>(m&31)&1)!==0}set(m,b){const S=b*this.rowSize+Math.floor(m/32);this.bits[S]|=1<<(m&31)&4294967295}unset(m,b){const S=b*this.rowSize+Math.floor(m/32);this.bits[S]&=~(1<<(m&31)&4294967295)}flip(m,b){const S=b*this.rowSize+Math.floor(m/32);this.bits[S]^=1<<(m&31)&4294967295}xor(m){if(this.width!==m.getWidth()||this.height!==m.getHeight()||this.rowSize!==m.getRowSize())throw new F("input matrix dimensions do not match");const b=new _e(Math.floor(this.width/32)+1),S=this.rowSize,P=this.bits;for(let N=0,V=this.height;N<V;N++){const $=N*S,te=m.getRow(N,b).getBitArray();for(let de=0;de<S;de++)P[$+de]^=te[de]}}clear(){const m=this.bits,b=m.length;for(let S=0;S<b;S++)m[S]=0}setRegion(m,b,S,P){if(b<0||m<0)throw new F("Left and top must be nonnegative");if(P<1||S<1)throw new F("Height and width must be at least 1");const N=m+S,V=b+P;if(V>this.height||N>this.width)throw new F("The region must fit inside the matrix");const $=this.rowSize,te=this.bits;for(let de=b;de<V;de++){const Re=de*$;for(let Fe=m;Fe<N;Fe++)te[Re+Math.floor(Fe/32)]|=1<<(Fe&31)&4294967295}}getRow(m,b){b==null||b.getSize()<this.width?b=new _e(this.width):b.clear();const S=this.rowSize,P=this.bits,N=m*S;for(let V=0;V<S;V++)b.setBulk(V*32,P[N+V]);return b}setRow(m,b){Z.arraycopy(b.getBitArray(),0,this.bits,m*this.rowSize,this.rowSize)}rotate180(){const m=this.getWidth(),b=this.getHeight();let S=new _e(m),P=new _e(m);for(let N=0,V=Math.floor((b+1)/2);N<V;N++)S=this.getRow(N,S),P=this.getRow(b-1-N,P),S.reverse(),P.reverse(),this.setRow(N,P),this.setRow(b-1-N,S)}getEnclosingRectangle(){const m=this.width,b=this.height,S=this.rowSize,P=this.bits;let N=m,V=b,$=-1,te=-1;for(let de=0;de<b;de++)for(let Re=0;Re<S;Re++){const Fe=P[de*S+Re];if(Fe!==0){if(de<V&&(V=de),de>te&&(te=de),Re*32<N){let Ge=0;for(;!(Fe<<31-Ge&4294967295);)Ge++;Re*32+Ge<N&&(N=Re*32+Ge)}if(Re*32+31>$){let Ge=31;for(;!(Fe>>>Ge);)Ge--;Re*32+Ge>$&&($=Re*32+Ge)}}}return $<N||te<V?null:Int32Array.from([N,V,$-N+1,te-V+1])}getTopLeftOnBit(){const m=this.rowSize,b=this.bits;let S=0;for(;S<b.length&&b[S]===0;)S++;if(S===b.length)return null;const P=S/m;let N=S%m*32;const V=b[S];let $=0;for(;!(V<<31-$&4294967295);)$++;return N+=$,Int32Array.from([N,P])}getBottomRightOnBit(){const m=this.rowSize,b=this.bits;let S=b.length-1;for(;S>=0&&b[S]===0;)S--;if(S<0)return null;const P=Math.floor(S/m);let N=Math.floor(S%m)*32;const V=b[S];let $=31;for(;!(V>>>$);)$--;return N+=$,Int32Array.from([N,P])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(m){if(!(m instanceof ft))return!1;const b=m;return this.width===b.width&&this.height===b.height&&this.rowSize===b.rowSize&&me.equals(this.bits,b.bits)}hashCode(){let m=this.width;return m=31*m+this.width,m=31*m+this.height,m=31*m+this.rowSize,m=31*m+me.hashCode(this.bits),m}toString(m="X ",b="  ",S=`
`){return this.buildToString(m,b,S)}buildToString(m,b,S){let P=new ze;for(let N=0,V=this.height;N<V;N++){for(let $=0,te=this.width;$<te;$++)P.append(this.get($,N)?m:b);P.append(S)}return P.toString()}clone(){return new ft(this.width,this.height,this.rowSize,this.bits.slice())}}class He extends w{static getNotFoundInstance(){return new He}}He.kind="NotFoundException";class bt extends Q{constructor(m){super(m),this.luminances=bt.EMPTY,this.buckets=new Int32Array(bt.LUMINANCE_BUCKETS)}getBlackRow(m,b){const S=this.getLuminanceSource(),P=S.getWidth();b==null||b.getSize()<P?b=new _e(P):b.clear(),this.initArrays(P);const N=S.getRow(m,this.luminances),V=this.buckets;for(let te=0;te<P;te++)V[(N[te]&255)>>bt.LUMINANCE_SHIFT]++;const $=bt.estimateBlackPoint(V);if(P<3)for(let te=0;te<P;te++)(N[te]&255)<$&&b.set(te);else{let te=N[0]&255,de=N[1]&255;for(let Re=1;Re<P-1;Re++){const Fe=N[Re+1]&255;(de*4-te-Fe)/2<$&&b.set(Re),te=de,de=Fe}}return b}getBlackMatrix(){const m=this.getLuminanceSource(),b=m.getWidth(),S=m.getHeight(),P=new ft(b,S);this.initArrays(b);const N=this.buckets;for(let te=1;te<5;te++){const de=Math.floor(S*te/5),Re=m.getRow(de,this.luminances),Fe=Math.floor(b*4/5);for(let Ge=Math.floor(b/5);Ge<Fe;Ge++){const dt=Re[Ge]&255;N[dt>>bt.LUMINANCE_SHIFT]++}}const V=bt.estimateBlackPoint(N),$=m.getMatrix();for(let te=0;te<S;te++){const de=te*b;for(let Re=0;Re<b;Re++)($[de+Re]&255)<V&&P.set(Re,te)}return P}createBinarizer(m){return new bt(m)}initArrays(m){this.luminances.length<m&&(this.luminances=new Uint8ClampedArray(m));const b=this.buckets;for(let S=0;S<bt.LUMINANCE_BUCKETS;S++)b[S]=0}static estimateBlackPoint(m){const b=m.length;let S=0,P=0,N=0;for(let Re=0;Re<b;Re++)m[Re]>N&&(P=Re,N=m[Re]),m[Re]>S&&(S=m[Re]);let V=0,$=0;for(let Re=0;Re<b;Re++){const Fe=Re-P,Ge=m[Re]*Fe*Fe;Ge>$&&(V=Re,$=Ge)}if(P>V){const Re=P;P=V,V=Re}if(V-P<=b/16)throw new He;let te=V-1,de=-1;for(let Re=V-1;Re>P;Re--){const Fe=Re-P,Ge=Fe*Fe*(V-Re)*(S-m[Re]);Ge>de&&(te=Re,de=Ge)}return te<<bt.LUMINANCE_SHIFT}}bt.LUMINANCE_BITS=5,bt.LUMINANCE_SHIFT=8-bt.LUMINANCE_BITS,bt.LUMINANCE_BUCKETS=1<<bt.LUMINANCE_BITS,bt.EMPTY=Uint8ClampedArray.from([0]);class Nt extends bt{constructor(m){super(m),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const m=this.getLuminanceSource(),b=m.getWidth(),S=m.getHeight();if(b>=Nt.MINIMUM_DIMENSION&&S>=Nt.MINIMUM_DIMENSION){const P=m.getMatrix();let N=b>>Nt.BLOCK_SIZE_POWER;b&Nt.BLOCK_SIZE_MASK&&N++;let V=S>>Nt.BLOCK_SIZE_POWER;S&Nt.BLOCK_SIZE_MASK&&V++;const $=Nt.calculateBlackPoints(P,N,V,b,S),te=new ft(b,S);Nt.calculateThresholdForBlock(P,N,V,b,S,$,te),this.matrix=te}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(m){return new Nt(m)}static calculateThresholdForBlock(m,b,S,P,N,V,$){const te=N-Nt.BLOCK_SIZE,de=P-Nt.BLOCK_SIZE;for(let Re=0;Re<S;Re++){let Fe=Re<<Nt.BLOCK_SIZE_POWER;Fe>te&&(Fe=te);const Ge=Nt.cap(Re,2,S-3);for(let dt=0;dt<b;dt++){let Ct=dt<<Nt.BLOCK_SIZE_POWER;Ct>de&&(Ct=de);const Pt=Nt.cap(dt,2,b-3);let $t=0;for(let Vn=-2;Vn<=2;Vn++){const zn=V[Ge+Vn];$t+=zn[Pt-2]+zn[Pt-1]+zn[Pt]+zn[Pt+1]+zn[Pt+2]}const tn=$t/25;Nt.thresholdBlock(m,Ct,Fe,tn,P,$)}}}static cap(m,b,S){return m<b?b:m>S?S:m}static thresholdBlock(m,b,S,P,N,V){for(let $=0,te=S*N+b;$<Nt.BLOCK_SIZE;$++,te+=N)for(let de=0;de<Nt.BLOCK_SIZE;de++)(m[te+de]&255)<=P&&V.set(b+de,S+$)}static calculateBlackPoints(m,b,S,P,N){const V=N-Nt.BLOCK_SIZE,$=P-Nt.BLOCK_SIZE,te=new Array(S);for(let de=0;de<S;de++){te[de]=new Int32Array(b);let Re=de<<Nt.BLOCK_SIZE_POWER;Re>V&&(Re=V);for(let Fe=0;Fe<b;Fe++){let Ge=Fe<<Nt.BLOCK_SIZE_POWER;Ge>$&&(Ge=$);let dt=0,Ct=255,Pt=0;for(let tn=0,Vn=Re*P+Ge;tn<Nt.BLOCK_SIZE;tn++,Vn+=P){for(let zn=0;zn<Nt.BLOCK_SIZE;zn++){const Dn=m[Vn+zn]&255;dt+=Dn,Dn<Ct&&(Ct=Dn),Dn>Pt&&(Pt=Dn)}if(Pt-Ct>Nt.MIN_DYNAMIC_RANGE)for(tn++,Vn+=P;tn<Nt.BLOCK_SIZE;tn++,Vn+=P)for(let zn=0;zn<Nt.BLOCK_SIZE;zn++)dt+=m[Vn+zn]&255}let $t=dt>>Nt.BLOCK_SIZE_POWER*2;if(Pt-Ct<=Nt.MIN_DYNAMIC_RANGE&&($t=Ct/2,de>0&&Fe>0)){const tn=(te[de-1][Fe]+2*te[de][Fe-1]+te[de-1][Fe-1])/4;Ct<tn&&($t=tn)}te[de][Fe]=$t}}return te}}Nt.BLOCK_SIZE_POWER=3,Nt.BLOCK_SIZE=1<<Nt.BLOCK_SIZE_POWER,Nt.BLOCK_SIZE_MASK=Nt.BLOCK_SIZE-1,Nt.MINIMUM_DIMENSION=Nt.BLOCK_SIZE*5,Nt.MIN_DYNAMIC_RANGE=24;class wt{constructor(m,b){this.width=m,this.height=b}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(m,b,S,P){throw new ue("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new ue("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new ue("This luminance source does not support rotation by 45 degrees.")}toString(){const m=new Uint8ClampedArray(this.width);let b=new ze;for(let S=0;S<this.height;S++){const P=this.getRow(S,m);for(let N=0;N<this.width;N++){const V=P[N]&255;let $;V<64?$="#":V<128?$="+":V<192?$=".":$=" ",b.append($)}b.append(`
`)}return b.toString()}}class it extends wt{constructor(m){super(m.getWidth(),m.getHeight()),this.delegate=m}getRow(m,b){const S=this.delegate.getRow(m,b),P=this.getWidth();for(let N=0;N<P;N++)S[N]=255-(S[N]&255);return S}getMatrix(){const m=this.delegate.getMatrix(),b=this.getWidth()*this.getHeight(),S=new Uint8ClampedArray(b);for(let P=0;P<b;P++)S[P]=255-(m[P]&255);return S}isCropSupported(){return this.delegate.isCropSupported()}crop(m,b,S,P){return new it(this.delegate.crop(m,b,S,P))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new it(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new it(this.delegate.rotateCounterClockwise45())}}class nn extends wt{constructor(m){super(m.width,m.height),this.canvas=m,this.tempCanvasElement=null,this.buffer=nn.makeBufferFromCanvasImageData(m)}static makeBufferFromCanvasImageData(m){const b=m.getContext("2d").getImageData(0,0,m.width,m.height);return nn.toGrayscaleBuffer(b.data,m.width,m.height)}static toGrayscaleBuffer(m,b,S){const P=new Uint8ClampedArray(b*S);for(let N=0,V=0,$=m.length;N<$;N+=4,V++){let te;if(m[N+3]===0)te=255;else{const Re=m[N],Fe=m[N+1],Ge=m[N+2];te=306*Re+601*Fe+117*Ge+512>>10}P[V]=te}return P}getRow(m,b){if(m<0||m>=this.getHeight())throw new F("Requested row is outside the image: "+m);const S=this.getWidth(),P=m*S;return b===null?b=this.buffer.slice(P,P+S):(b.length<S&&(b=new Uint8ClampedArray(S)),b.set(this.buffer.slice(P,P+S))),b}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(m,b,S,P){return super.crop(m,b,S,P),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const m=this.canvas.ownerDocument.createElement("canvas");m.width=this.canvas.width,m.height=this.canvas.height,this.tempCanvasElement=m}return this.tempCanvasElement}rotate(m){const b=this.getTempCanvasElement(),S=b.getContext("2d"),P=m*nn.DEGREE_TO_RADIANS,N=this.canvas.width,V=this.canvas.height,$=Math.ceil(Math.abs(Math.cos(P))*N+Math.abs(Math.sin(P))*V),te=Math.ceil(Math.abs(Math.sin(P))*N+Math.abs(Math.cos(P))*V);return b.width=$,b.height=te,S.translate($/2,te/2),S.rotate(P),S.drawImage(this.canvas,N/-2,V/-2),this.buffer=nn.makeBufferFromCanvasImageData(b),this}invert(){return new it(this)}}nn.DEGREE_TO_RADIANS=Math.PI/180;class In{constructor(m,b,S){this.deviceId=m,this.label=b,this.kind="videoinput",this.groupId=S||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var wn=(globalThis||$0||self||window||void 0)&&(globalThis||$0||self||window||void 0).__awaiter||function(Ne,m,b,S){function P(N){return N instanceof b?N:new b(function(V){V(N)})}return new(b||(b=Promise))(function(N,V){function $(Re){try{de(S.next(Re))}catch(Fe){V(Fe)}}function te(Re){try{de(S.throw(Re))}catch(Fe){V(Fe)}}function de(Re){Re.done?N(Re.value):P(Re.value).then($,te)}de((S=S.apply(Ne,m||[])).next())})};class Xt{constructor(m,b=500,S){this.reader=m,this.timeBetweenScansMillis=b,this._hints=S,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(m){this._timeBetweenDecodingAttempts=m<0?0:m}set hints(m){this._hints=m||null}get hints(){return this._hints}listVideoInputDevices(){return wn(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const m=yield navigator.mediaDevices.enumerateDevices(),b=[];for(const S of m){const P=S.kind==="video"?"videoinput":S.kind;if(P!=="videoinput")continue;const N=S.deviceId||S.id,V=S.label||`Video device ${b.length+1}`,$=S.groupId,te={deviceId:N,label:V,kind:P,groupId:$};b.push(te)}return b})}getVideoInputDevices(){return wn(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(b=>new In(b.deviceId,b.label))})}findDeviceById(m){return wn(this,void 0,void 0,function*(){const b=yield this.listVideoInputDevices();return b?b.find(S=>S.deviceId===m):null})}decodeFromInputVideoDevice(m,b){return wn(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(m,b)})}decodeOnceFromVideoDevice(m,b){return wn(this,void 0,void 0,function*(){this.reset();let S;m?S={deviceId:{exact:m}}:S={facingMode:"environment"};const P={video:S};return yield this.decodeOnceFromConstraints(P,b)})}decodeOnceFromConstraints(m,b){return wn(this,void 0,void 0,function*(){const S=yield navigator.mediaDevices.getUserMedia(m);return yield this.decodeOnceFromStream(S,b)})}decodeOnceFromStream(m,b){return wn(this,void 0,void 0,function*(){this.reset();const S=yield this.attachStreamToVideo(m,b);return yield this.decodeOnce(S)})}decodeFromInputVideoDeviceContinuously(m,b,S){return wn(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(m,b,S)})}decodeFromVideoDevice(m,b,S){return wn(this,void 0,void 0,function*(){let P;m?P={deviceId:{exact:m}}:P={facingMode:"environment"};const N={video:P};return yield this.decodeFromConstraints(N,b,S)})}decodeFromConstraints(m,b,S){return wn(this,void 0,void 0,function*(){const P=yield navigator.mediaDevices.getUserMedia(m);return yield this.decodeFromStream(P,b,S)})}decodeFromStream(m,b,S){return wn(this,void 0,void 0,function*(){this.reset();const P=yield this.attachStreamToVideo(m,b);return yield this.decodeContinuously(P,S)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(m,b){return wn(this,void 0,void 0,function*(){const S=this.prepareVideoElement(b);return this.addVideoSource(S,m),this.videoElement=S,this.stream=m,yield this.playVideoOnLoadAsync(S),S})}playVideoOnLoadAsync(m){return new Promise((b,S)=>this.playVideoOnLoad(m,()=>b()))}playVideoOnLoad(m,b){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(m),m.addEventListener("ended",this.videoEndedListener),m.addEventListener("canplay",this.videoCanPlayListener),m.addEventListener("playing",b),this.tryPlayVideo(m)}isVideoPlaying(m){return m.currentTime>0&&!m.paused&&!m.ended&&m.readyState>2}tryPlayVideo(m){return wn(this,void 0,void 0,function*(){if(this.isVideoPlaying(m)){console.warn("Trying to play video that is already playing.");return}try{yield m.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(m,b){const S=document.getElementById(m);if(!S)throw new A(`element with id '${m}' not found`);if(S.nodeName.toLowerCase()!==b.toLowerCase())throw new A(`element with id '${m}' must be an ${b} element`);return S}decodeFromImage(m,b){if(!m&&!b)throw new A("either imageElement with a src set or an url must be provided");return b&&!m?this.decodeFromImageUrl(b):this.decodeFromImageElement(m)}decodeFromVideo(m,b){if(!m&&!b)throw new A("Either an element with a src set or an URL must be provided");return b&&!m?this.decodeFromVideoUrl(b):this.decodeFromVideoElement(m)}decodeFromVideoContinuously(m,b,S){if(m===void 0&&b===void 0)throw new A("Either an element with a src set or an URL must be provided");return b&&!m?this.decodeFromVideoUrlContinuously(b,S):this.decodeFromVideoElementContinuously(m,S)}decodeFromImageElement(m){if(!m)throw new A("An image element must be provided.");this.reset();const b=this.prepareImageElement(m);this.imageElement=b;let S;return this.isImageLoaded(b)?S=this.decodeOnce(b,!1,!0):S=this._decodeOnLoadImage(b),S}decodeFromVideoElement(m){const b=this._decodeFromVideoElementSetup(m);return this._decodeOnLoadVideo(b)}decodeFromVideoElementContinuously(m,b){const S=this._decodeFromVideoElementSetup(m);return this._decodeOnLoadVideoContinuously(S,b)}_decodeFromVideoElementSetup(m){if(!m)throw new A("A video element must be provided.");this.reset();const b=this.prepareVideoElement(m);return this.videoElement=b,b}decodeFromImageUrl(m){if(!m)throw new A("An URL must be provided.");this.reset();const b=this.prepareImageElement();this.imageElement=b;const S=this._decodeOnLoadImage(b);return b.src=m,S}decodeFromVideoUrl(m){if(!m)throw new A("An URL must be provided.");this.reset();const b=this.prepareVideoElement(),S=this.decodeFromVideoElement(b);return b.src=m,S}decodeFromVideoUrlContinuously(m,b){if(!m)throw new A("An URL must be provided.");this.reset();const S=this.prepareVideoElement(),P=this.decodeFromVideoElementContinuously(S,b);return S.src=m,P}_decodeOnLoadImage(m){return new Promise((b,S)=>{this.imageLoadedListener=()=>this.decodeOnce(m,!1,!0).then(b,S),m.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(m){return wn(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(m),yield this.decodeOnce(m)})}_decodeOnLoadVideoContinuously(m,b){return wn(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(m),this.decodeContinuously(m,b)})}isImageLoaded(m){return!(!m.complete||m.naturalWidth===0)}prepareImageElement(m){let b;return typeof m>"u"&&(b=document.createElement("img"),b.width=200,b.height=200),typeof m=="string"&&(b=this.getMediaElement(m,"img")),m instanceof HTMLImageElement&&(b=m),b}prepareVideoElement(m){let b;return!m&&typeof document<"u"&&(b=document.createElement("video"),b.width=200,b.height=200),typeof m=="string"&&(b=this.getMediaElement(m,"video")),m instanceof HTMLVideoElement&&(b=m),b.setAttribute("autoplay","true"),b.setAttribute("muted","true"),b.setAttribute("playsinline","true"),b}decodeOnce(m,b=!0,S=!0){this._stopAsyncDecode=!1;const P=(N,V)=>{if(this._stopAsyncDecode){V(new He("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const $=this.decode(m);N($)}catch($){const te=b&&$ instanceof He,Re=($ instanceof K||$ instanceof re)&&S;if(te||Re)return setTimeout(P,this._timeBetweenDecodingAttempts,N,V);V($)}};return new Promise((N,V)=>P(N,V))}decodeContinuously(m,b){this._stopContinuousDecode=!1;const S=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const P=this.decode(m);b(P,null),setTimeout(S,this.timeBetweenScansMillis)}catch(P){b(null,P);const N=P instanceof K||P instanceof re,V=P instanceof He;(N||V)&&setTimeout(S,this._timeBetweenDecodingAttempts)}};S()}decode(m){const b=this.createBinaryBitmap(m);return this.decodeBitmap(b)}_isHTMLVideoElement(m){return m.videoWidth!==0}drawFrameOnCanvas(m,b,S){b||(b={sx:0,sy:0,sWidth:m.videoWidth,sHeight:m.videoHeight,dx:0,dy:0,dWidth:m.videoWidth,dHeight:m.videoHeight}),S||(S=this.captureCanvasContext),S.drawImage(m,b.sx,b.sy,b.sWidth,b.sHeight,b.dx,b.dy,b.dWidth,b.dHeight)}drawImageOnCanvas(m,b,S=this.captureCanvasContext){b||(b={sx:0,sy:0,sWidth:m.naturalWidth,sHeight:m.naturalHeight,dx:0,dy:0,dWidth:m.naturalWidth,dHeight:m.naturalHeight}),S||(S=this.captureCanvasContext),S.drawImage(m,b.sx,b.sy,b.sWidth,b.sHeight,b.dx,b.dy,b.dWidth,b.dHeight)}createBinaryBitmap(m){this.getCaptureCanvasContext(m),this._isHTMLVideoElement(m)?this.drawFrameOnCanvas(m):this.drawImageOnCanvas(m);const b=this.getCaptureCanvas(m),S=new nn(b),P=new Nt(S);return new W(P)}getCaptureCanvasContext(m){if(!this.captureCanvasContext){const S=this.getCaptureCanvas(m).getContext("2d");this.captureCanvasContext=S}return this.captureCanvasContext}getCaptureCanvas(m){if(!this.captureCanvas){const b=this.createCaptureCanvas(m);this.captureCanvas=b}return this.captureCanvas}decodeBitmap(m){return this.reader.decode(m,this._hints)}createCaptureCanvas(m){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const b=document.createElement("canvas");let S,P;return typeof m<"u"&&(m instanceof HTMLVideoElement?(S=m.videoWidth,P=m.videoHeight):m instanceof HTMLImageElement&&(S=m.naturalWidth||m.width,P=m.naturalHeight||m.height)),b.style.width=S+"px",b.style.height=P+"px",b.width=S,b.height=P,b}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(m=>m.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(m,b){try{m.srcObject=b}catch{m.src=URL.createObjectURL(b)}}cleanVideoSource(m){try{m.srcObject=null}catch{m.src=""}this.videoElement.removeAttribute("src")}}class On{constructor(m,b,S=b==null?0:8*b.length,P,N,V=Z.currentTimeMillis()){this.text=m,this.rawBytes=b,this.numBits=S,this.resultPoints=P,this.format=N,this.timestamp=V,this.text=m,this.rawBytes=b,S==null?this.numBits=b==null?0:8*b.length:this.numBits=S,this.resultPoints=P,this.format=N,this.resultMetadata=null,V==null?this.timestamp=Z.currentTimeMillis():this.timestamp=V}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(m,b){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(m,b)}putAllMetadata(m){m!==null&&(this.resultMetadata===null?this.resultMetadata=m:this.resultMetadata=new Map(m))}addResultPoints(m){const b=this.resultPoints;if(b===null)this.resultPoints=m;else if(m!==null&&m.length>0){const S=new Array(b.length+m.length);Z.arraycopy(b,0,S,0,b.length),Z.arraycopy(m,0,S,b.length,m.length),this.resultPoints=S}}getTimestamp(){return this.timestamp}toString(){return this.text}}var cr;(function(Ne){Ne[Ne.AZTEC=0]="AZTEC",Ne[Ne.CODABAR=1]="CODABAR",Ne[Ne.CODE_39=2]="CODE_39",Ne[Ne.CODE_93=3]="CODE_93",Ne[Ne.CODE_128=4]="CODE_128",Ne[Ne.DATA_MATRIX=5]="DATA_MATRIX",Ne[Ne.EAN_8=6]="EAN_8",Ne[Ne.EAN_13=7]="EAN_13",Ne[Ne.ITF=8]="ITF",Ne[Ne.MAXICODE=9]="MAXICODE",Ne[Ne.PDF_417=10]="PDF_417",Ne[Ne.QR_CODE=11]="QR_CODE",Ne[Ne.RSS_14=12]="RSS_14",Ne[Ne.RSS_EXPANDED=13]="RSS_EXPANDED",Ne[Ne.UPC_A=14]="UPC_A",Ne[Ne.UPC_E=15]="UPC_E",Ne[Ne.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(cr||(cr={}));var En=cr,fn;(function(Ne){Ne[Ne.OTHER=0]="OTHER",Ne[Ne.ORIENTATION=1]="ORIENTATION",Ne[Ne.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",Ne[Ne.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",Ne[Ne.ISSUE_NUMBER=4]="ISSUE_NUMBER",Ne[Ne.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",Ne[Ne.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",Ne[Ne.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",Ne[Ne.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",Ne[Ne.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",Ne[Ne.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(fn||(fn={}));var ur=fn;class br{constructor(m,b,S,P,N=-1,V=-1){this.rawBytes=m,this.text=b,this.byteSegments=S,this.ecLevel=P,this.structuredAppendSequenceNumber=N,this.structuredAppendParity=V,this.numBits=m==null?0:8*m.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(m){this.numBits=m}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(m){this.errorsCorrected=m}getErasures(){return this.erasures}setErasures(m){this.erasures=m}getOther(){return this.other}setOther(m){this.other=m}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Pe{exp(m){return this.expTable[m]}log(m){if(m===0)throw new F;return this.logTable[m]}static addOrSubtract(m,b){return m^b}}class jn{constructor(m,b){if(b.length===0)throw new F;this.field=m;const S=b.length;if(S>1&&b[0]===0){let P=1;for(;P<S&&b[P]===0;)P++;P===S?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(S-P),Z.arraycopy(b,P,this.coefficients,0,this.coefficients.length))}else this.coefficients=b}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(m){return this.coefficients[this.coefficients.length-1-m]}evaluateAt(m){if(m===0)return this.getCoefficient(0);const b=this.coefficients;let S;if(m===1){S=0;for(let V=0,$=b.length;V!==$;V++){const te=b[V];S=Pe.addOrSubtract(S,te)}return S}S=b[0];const P=b.length,N=this.field;for(let V=1;V<P;V++)S=Pe.addOrSubtract(N.multiply(m,S),b[V]);return S}addOrSubtract(m){if(!this.field.equals(m.field))throw new F("GenericGFPolys do not have same GenericGF field");if(this.isZero())return m;if(m.isZero())return this;let b=this.coefficients,S=m.coefficients;if(b.length>S.length){const V=b;b=S,S=V}let P=new Int32Array(S.length);const N=S.length-b.length;Z.arraycopy(S,0,P,0,N);for(let V=N;V<S.length;V++)P[V]=Pe.addOrSubtract(b[V-N],S[V]);return new jn(this.field,P)}multiply(m){if(!this.field.equals(m.field))throw new F("GenericGFPolys do not have same GenericGF field");if(this.isZero()||m.isZero())return this.field.getZero();const b=this.coefficients,S=b.length,P=m.coefficients,N=P.length,V=new Int32Array(S+N-1),$=this.field;for(let te=0;te<S;te++){const de=b[te];for(let Re=0;Re<N;Re++)V[te+Re]=Pe.addOrSubtract(V[te+Re],$.multiply(de,P[Re]))}return new jn($,V)}multiplyScalar(m){if(m===0)return this.field.getZero();if(m===1)return this;const b=this.coefficients.length,S=this.field,P=new Int32Array(b),N=this.coefficients;for(let V=0;V<b;V++)P[V]=S.multiply(N[V],m);return new jn(S,P)}multiplyByMonomial(m,b){if(m<0)throw new F;if(b===0)return this.field.getZero();const S=this.coefficients,P=S.length,N=new Int32Array(P+m),V=this.field;for(let $=0;$<P;$++)N[$]=V.multiply(S[$],b);return new jn(V,N)}divide(m){if(!this.field.equals(m.field))throw new F("GenericGFPolys do not have same GenericGF field");if(m.isZero())throw new F("Divide by 0");const b=this.field;let S=b.getZero(),P=this;const N=m.getCoefficient(m.getDegree()),V=b.inverse(N);for(;P.getDegree()>=m.getDegree()&&!P.isZero();){const $=P.getDegree()-m.getDegree(),te=b.multiply(P.getCoefficient(P.getDegree()),V),de=m.multiplyByMonomial($,te),Re=b.buildMonomial($,te);S=S.addOrSubtract(Re),P=P.addOrSubtract(de)}return[S,P]}toString(){let m="";for(let b=this.getDegree();b>=0;b--){let S=this.getCoefficient(b);if(S!==0){if(S<0?(m+=" - ",S=-S):m.length>0&&(m+=" + "),b===0||S!==1){const P=this.field.log(S);P===0?m+="1":P===1?m+="a":(m+="a^",m+=P)}b!==0&&(b===1?m+="x":(m+="x^",m+=b))}}return m}}class rr extends w{}rr.kind="ArithmeticException";class Yn extends Pe{constructor(m,b,S){super(),this.primitive=m,this.size=b,this.generatorBase=S;const P=new Int32Array(b);let N=1;for(let $=0;$<b;$++)P[$]=N,N*=2,N>=b&&(N^=m,N&=b-1);this.expTable=P;const V=new Int32Array(b);for(let $=0;$<b-1;$++)V[P[$]]=$;this.logTable=V,this.zero=new jn(this,Int32Array.from([0])),this.one=new jn(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(m,b){if(m<0)throw new F;if(b===0)return this.zero;const S=new Int32Array(m+1);return S[0]=b,new jn(this,S)}inverse(m){if(m===0)throw new rr;return this.expTable[this.size-this.logTable[m]-1]}multiply(m,b){return m===0||b===0?0:this.expTable[(this.logTable[m]+this.logTable[b])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+pe.toHexString(this.primitive)+","+this.size+")"}equals(m){return m===this}}Yn.AZTEC_DATA_12=new Yn(4201,4096,1),Yn.AZTEC_DATA_10=new Yn(1033,1024,1),Yn.AZTEC_DATA_6=new Yn(67,64,1),Yn.AZTEC_PARAM=new Yn(19,16,1),Yn.QR_CODE_FIELD_256=new Yn(285,256,0),Yn.DATA_MATRIX_FIELD_256=new Yn(301,256,1),Yn.AZTEC_DATA_8=Yn.DATA_MATRIX_FIELD_256,Yn.MAXICODE_FIELD_64=Yn.AZTEC_DATA_6;class Ot extends w{}Ot.kind="ReedSolomonException";class Sr extends w{}Sr.kind="IllegalStateException";class fi{constructor(m){this.field=m}decode(m,b){const S=this.field,P=new jn(S,m),N=new Int32Array(b);let V=!0;for(let dt=0;dt<b;dt++){const Ct=P.evaluateAt(S.exp(dt+S.getGeneratorBase()));N[N.length-1-dt]=Ct,Ct!==0&&(V=!1)}if(V)return;const $=new jn(S,N),te=this.runEuclideanAlgorithm(S.buildMonomial(b,1),$,b),de=te[0],Re=te[1],Fe=this.findErrorLocations(de),Ge=this.findErrorMagnitudes(Re,Fe);for(let dt=0;dt<Fe.length;dt++){const Ct=m.length-1-S.log(Fe[dt]);if(Ct<0)throw new Ot("Bad error location");m[Ct]=Yn.addOrSubtract(m[Ct],Ge[dt])}}runEuclideanAlgorithm(m,b,S){if(m.getDegree()<b.getDegree()){const dt=m;m=b,b=dt}const P=this.field;let N=m,V=b,$=P.getZero(),te=P.getOne();for(;V.getDegree()>=(S/2|0);){let dt=N,Ct=$;if(N=V,$=te,N.isZero())throw new Ot("r_{i-1} was zero");V=dt;let Pt=P.getZero();const $t=N.getCoefficient(N.getDegree()),tn=P.inverse($t);for(;V.getDegree()>=N.getDegree()&&!V.isZero();){const Vn=V.getDegree()-N.getDegree(),zn=P.multiply(V.getCoefficient(V.getDegree()),tn);Pt=Pt.addOrSubtract(P.buildMonomial(Vn,zn)),V=V.addOrSubtract(N.multiplyByMonomial(Vn,zn))}if(te=Pt.multiply($).addOrSubtract(Ct),V.getDegree()>=N.getDegree())throw new Sr("Division algorithm failed to reduce polynomial?")}const de=te.getCoefficient(0);if(de===0)throw new Ot("sigmaTilde(0) was zero");const Re=P.inverse(de),Fe=te.multiplyScalar(Re),Ge=V.multiplyScalar(Re);return[Fe,Ge]}findErrorLocations(m){const b=m.getDegree();if(b===1)return Int32Array.from([m.getCoefficient(1)]);const S=new Int32Array(b);let P=0;const N=this.field;for(let V=1;V<N.getSize()&&P<b;V++)m.evaluateAt(V)===0&&(S[P]=N.inverse(V),P++);if(P!==b)throw new Ot("Error locator degree does not match number of roots");return S}findErrorMagnitudes(m,b){const S=b.length,P=new Int32Array(S),N=this.field;for(let V=0;V<S;V++){const $=N.inverse(b[V]);let te=1;for(let de=0;de<S;de++)if(V!==de){const Re=N.multiply(b[de],$),Fe=Re&1?Re&-2:Re|1;te=N.multiply(te,Fe)}P[V]=N.multiply(m.evaluateAt($),N.inverse(te)),N.getGeneratorBase()!==0&&(P[V]=N.multiply(P[V],$))}return P}}var Wr;(function(Ne){Ne[Ne.UPPER=0]="UPPER",Ne[Ne.LOWER=1]="LOWER",Ne[Ne.MIXED=2]="MIXED",Ne[Ne.DIGIT=3]="DIGIT",Ne[Ne.PUNCT=4]="PUNCT",Ne[Ne.BINARY=5]="BINARY"})(Wr||(Wr={}));class Mn{decode(m){this.ddata=m;let b=m.getBits(),S=this.extractBits(b),P=this.correctBits(S),N=Mn.convertBoolArrayToByteArray(P),V=Mn.getEncodedData(P),$=new br(N,V,null,null);return $.setNumBits(P.length),$}static highLevelDecode(m){return this.getEncodedData(m)}static getEncodedData(m){let b=m.length,S=Wr.UPPER,P=Wr.UPPER,N="",V=0;for(;V<b;)if(P===Wr.BINARY){if(b-V<5)break;let $=Mn.readCode(m,V,5);if(V+=5,$===0){if(b-V<11)break;$=Mn.readCode(m,V,11)+31,V+=11}for(let te=0;te<$;te++){if(b-V<8){V=b;break}const de=Mn.readCode(m,V,8);N+=Oe.castAsNonUtf8Char(de),V+=8}P=S}else{let $=P===Wr.DIGIT?4:5;if(b-V<$)break;let te=Mn.readCode(m,V,$);V+=$;let de=Mn.getCharacter(P,te);de.startsWith("CTRL_")?(S=P,P=Mn.getTable(de.charAt(5)),de.charAt(6)==="L"&&(S=P)):(N+=de,P=S)}return N}static getTable(m){switch(m){case"L":return Wr.LOWER;case"P":return Wr.PUNCT;case"M":return Wr.MIXED;case"D":return Wr.DIGIT;case"B":return Wr.BINARY;case"U":default:return Wr.UPPER}}static getCharacter(m,b){switch(m){case Wr.UPPER:return Mn.UPPER_TABLE[b];case Wr.LOWER:return Mn.LOWER_TABLE[b];case Wr.MIXED:return Mn.MIXED_TABLE[b];case Wr.PUNCT:return Mn.PUNCT_TABLE[b];case Wr.DIGIT:return Mn.DIGIT_TABLE[b];default:throw new Sr("Bad table")}}correctBits(m){let b,S;this.ddata.getNbLayers()<=2?(S=6,b=Yn.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(S=8,b=Yn.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(S=10,b=Yn.AZTEC_DATA_10):(S=12,b=Yn.AZTEC_DATA_12);let P=this.ddata.getNbDatablocks(),N=m.length/S;if(N<P)throw new re;let V=m.length%S,$=new Int32Array(N);for(let Ge=0;Ge<N;Ge++,V+=S)$[Ge]=Mn.readCode(m,V,S);try{new fi(b).decode($,N-P)}catch(Ge){throw new re(Ge)}let te=(1<<S)-1,de=0;for(let Ge=0;Ge<P;Ge++){let dt=$[Ge];if(dt===0||dt===te)throw new re;(dt===1||dt===te-1)&&de++}let Re=new Array(P*S-de),Fe=0;for(let Ge=0;Ge<P;Ge++){let dt=$[Ge];if(dt===1||dt===te-1)Re.fill(dt>1,Fe,Fe+S-1),Fe+=S-1;else for(let Ct=S-1;Ct>=0;--Ct)Re[Fe++]=(dt&1<<Ct)!==0}return Re}extractBits(m){let b=this.ddata.isCompact(),S=this.ddata.getNbLayers(),P=(b?11:14)+S*4,N=new Int32Array(P),V=new Array(this.totalBitsInLayer(S,b));if(b)for(let $=0;$<N.length;$++)N[$]=$;else{let $=P+1+2*pe.truncDivision(pe.truncDivision(P,2)-1,15),te=P/2,de=pe.truncDivision($,2);for(let Re=0;Re<te;Re++){let Fe=Re+pe.truncDivision(Re,15);N[te-Re-1]=de-Fe-1,N[te+Re]=de+Fe+1}}for(let $=0,te=0;$<S;$++){let de=(S-$)*4+(b?9:12),Re=$*2,Fe=P-1-Re;for(let Ge=0;Ge<de;Ge++){let dt=Ge*2;for(let Ct=0;Ct<2;Ct++)V[te+dt+Ct]=m.get(N[Re+Ct],N[Re+Ge]),V[te+2*de+dt+Ct]=m.get(N[Re+Ge],N[Fe-Ct]),V[te+4*de+dt+Ct]=m.get(N[Fe-Ct],N[Fe-Ge]),V[te+6*de+dt+Ct]=m.get(N[Fe-Ge],N[Re+Ct])}te+=de*8}return V}static readCode(m,b,S){let P=0;for(let N=b;N<b+S;N++)P<<=1,m[N]&&(P|=1);return P}static readByte(m,b){let S=m.length-b;return S>=8?Mn.readCode(m,b,8):Mn.readCode(m,b,S)<<8-S}static convertBoolArrayToByteArray(m){let b=new Uint8Array((m.length+7)/8);for(let S=0;S<b.length;S++)b[S]=Mn.readByte(m,8*S);return b}totalBitsInLayer(m,b){return((b?88:112)+16*m)*m}}Mn.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Mn.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Mn.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Mn.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Mn.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class jt{constructor(){}static round(m){return m===NaN?0:m<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:m>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:m+(m<0?-.5:.5)|0}static distance(m,b,S,P){const N=m-S,V=b-P;return Math.sqrt(N*N+V*V)}static sum(m){let b=0;for(let S=0,P=m.length;S!==P;S++){const N=m[S];b+=N}return b}}class Ln{static floatToIntBits(m){return m}}Ln.MAX_VALUE=Number.MAX_SAFE_INTEGER;class un{constructor(m,b){this.x=m,this.y=b}getX(){return this.x}getY(){return this.y}equals(m){if(m instanceof un){const b=m;return this.x===b.x&&this.y===b.y}return!1}hashCode(){return 31*Ln.floatToIntBits(this.x)+Ln.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(m){const b=this.distance(m[0],m[1]),S=this.distance(m[1],m[2]),P=this.distance(m[0],m[2]);let N,V,$;if(S>=b&&S>=P?(V=m[0],N=m[1],$=m[2]):P>=S&&P>=b?(V=m[1],N=m[0],$=m[2]):(V=m[2],N=m[0],$=m[1]),this.crossProductZ(N,V,$)<0){const te=N;N=$,$=te}m[0]=N,m[1]=V,m[2]=$}static distance(m,b){return jt.distance(m.x,m.y,b.x,b.y)}static crossProductZ(m,b,S){const P=b.x,N=b.y;return(S.x-P)*(m.y-N)-(S.y-N)*(m.x-P)}}class Xn{constructor(m,b){this.bits=m,this.points=b}getBits(){return this.bits}getPoints(){return this.points}}class Ni extends Xn{constructor(m,b,S,P,N){super(m,b),this.compact=S,this.nbDatablocks=P,this.nbLayers=N}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Bn{constructor(m,b,S,P){this.image=m,this.height=m.getHeight(),this.width=m.getWidth(),b==null&&(b=Bn.INIT_SIZE),S==null&&(S=m.getWidth()/2|0),P==null&&(P=m.getHeight()/2|0);const N=b/2|0;if(this.leftInit=S-N,this.rightInit=S+N,this.upInit=P-N,this.downInit=P+N,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new He}detect(){let m=this.leftInit,b=this.rightInit,S=this.upInit,P=this.downInit,N=!1,V=!0,$=!1,te=!1,de=!1,Re=!1,Fe=!1;const Ge=this.width,dt=this.height;for(;V;){V=!1;let Ct=!0;for(;(Ct||!te)&&b<Ge;)Ct=this.containsBlackPoint(S,P,b,!1),Ct?(b++,V=!0,te=!0):te||b++;if(b>=Ge){N=!0;break}let Pt=!0;for(;(Pt||!de)&&P<dt;)Pt=this.containsBlackPoint(m,b,P,!0),Pt?(P++,V=!0,de=!0):de||P++;if(P>=dt){N=!0;break}let $t=!0;for(;($t||!Re)&&m>=0;)$t=this.containsBlackPoint(S,P,m,!1),$t?(m--,V=!0,Re=!0):Re||m--;if(m<0){N=!0;break}let tn=!0;for(;(tn||!Fe)&&S>=0;)tn=this.containsBlackPoint(m,b,S,!0),tn?(S--,V=!0,Fe=!0):Fe||S--;if(S<0){N=!0;break}V&&($=!0)}if(!N&&$){const Ct=b-m;let Pt=null;for(let zn=1;Pt===null&&zn<Ct;zn++)Pt=this.getBlackPointOnSegment(m,P-zn,m+zn,P);if(Pt==null)throw new He;let $t=null;for(let zn=1;$t===null&&zn<Ct;zn++)$t=this.getBlackPointOnSegment(m,S+zn,m+zn,S);if($t==null)throw new He;let tn=null;for(let zn=1;tn===null&&zn<Ct;zn++)tn=this.getBlackPointOnSegment(b,S+zn,b-zn,S);if(tn==null)throw new He;let Vn=null;for(let zn=1;Vn===null&&zn<Ct;zn++)Vn=this.getBlackPointOnSegment(b,P-zn,b-zn,P);if(Vn==null)throw new He;return this.centerEdges(Vn,Pt,tn,$t)}else throw new He}getBlackPointOnSegment(m,b,S,P){const N=jt.round(jt.distance(m,b,S,P)),V=(S-m)/N,$=(P-b)/N,te=this.image;for(let de=0;de<N;de++){const Re=jt.round(m+de*V),Fe=jt.round(b+de*$);if(te.get(Re,Fe))return new un(Re,Fe)}return null}centerEdges(m,b,S,P){const N=m.getX(),V=m.getY(),$=b.getX(),te=b.getY(),de=S.getX(),Re=S.getY(),Fe=P.getX(),Ge=P.getY(),dt=Bn.CORR;return N<this.width/2?[new un(Fe-dt,Ge+dt),new un($+dt,te+dt),new un(de-dt,Re-dt),new un(N+dt,V-dt)]:[new un(Fe+dt,Ge+dt),new un($+dt,te-dt),new un(de-dt,Re+dt),new un(N-dt,V-dt)]}containsBlackPoint(m,b,S,P){const N=this.image;if(P){for(let V=m;V<=b;V++)if(N.get(V,S))return!0}else for(let V=m;V<=b;V++)if(N.get(S,V))return!0;return!1}}Bn.INIT_SIZE=10,Bn.CORR=1;class Es{static checkAndNudgePoints(m,b){const S=m.getWidth(),P=m.getHeight();let N=!0;for(let V=0;V<b.length&&N;V+=2){const $=Math.floor(b[V]),te=Math.floor(b[V+1]);if($<-1||$>S||te<-1||te>P)throw new He;N=!1,$===-1?(b[V]=0,N=!0):$===S&&(b[V]=S-1,N=!0),te===-1?(b[V+1]=0,N=!0):te===P&&(b[V+1]=P-1,N=!0)}N=!0;for(let V=b.length-2;V>=0&&N;V-=2){const $=Math.floor(b[V]),te=Math.floor(b[V+1]);if($<-1||$>S||te<-1||te>P)throw new He;N=!1,$===-1?(b[V]=0,N=!0):$===S&&(b[V]=S-1,N=!0),te===-1?(b[V+1]=0,N=!0):te===P&&(b[V+1]=P-1,N=!0)}}}class Si{constructor(m,b,S,P,N,V,$,te,de){this.a11=m,this.a21=b,this.a31=S,this.a12=P,this.a22=N,this.a32=V,this.a13=$,this.a23=te,this.a33=de}static quadrilateralToQuadrilateral(m,b,S,P,N,V,$,te,de,Re,Fe,Ge,dt,Ct,Pt,$t){const tn=Si.quadrilateralToSquare(m,b,S,P,N,V,$,te);return Si.squareToQuadrilateral(de,Re,Fe,Ge,dt,Ct,Pt,$t).times(tn)}transformPoints(m){const b=m.length,S=this.a11,P=this.a12,N=this.a13,V=this.a21,$=this.a22,te=this.a23,de=this.a31,Re=this.a32,Fe=this.a33;for(let Ge=0;Ge<b;Ge+=2){const dt=m[Ge],Ct=m[Ge+1],Pt=N*dt+te*Ct+Fe;m[Ge]=(S*dt+V*Ct+de)/Pt,m[Ge+1]=(P*dt+$*Ct+Re)/Pt}}transformPointsWithValues(m,b){const S=this.a11,P=this.a12,N=this.a13,V=this.a21,$=this.a22,te=this.a23,de=this.a31,Re=this.a32,Fe=this.a33,Ge=m.length;for(let dt=0;dt<Ge;dt++){const Ct=m[dt],Pt=b[dt],$t=N*Ct+te*Pt+Fe;m[dt]=(S*Ct+V*Pt+de)/$t,b[dt]=(P*Ct+$*Pt+Re)/$t}}static squareToQuadrilateral(m,b,S,P,N,V,$,te){const de=m-S+N-$,Re=b-P+V-te;if(de===0&&Re===0)return new Si(S-m,N-S,m,P-b,V-P,b,0,0,1);{const Fe=S-N,Ge=$-N,dt=P-V,Ct=te-V,Pt=Fe*Ct-Ge*dt,$t=(de*Ct-Ge*Re)/Pt,tn=(Fe*Re-de*dt)/Pt;return new Si(S-m+$t*S,$-m+tn*$,m,P-b+$t*P,te-b+tn*te,b,$t,tn,1)}}static quadrilateralToSquare(m,b,S,P,N,V,$,te){return Si.squareToQuadrilateral(m,b,S,P,N,V,$,te).buildAdjoint()}buildAdjoint(){return new Si(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(m){return new Si(this.a11*m.a11+this.a21*m.a12+this.a31*m.a13,this.a11*m.a21+this.a21*m.a22+this.a31*m.a23,this.a11*m.a31+this.a21*m.a32+this.a31*m.a33,this.a12*m.a11+this.a22*m.a12+this.a32*m.a13,this.a12*m.a21+this.a22*m.a22+this.a32*m.a23,this.a12*m.a31+this.a22*m.a32+this.a32*m.a33,this.a13*m.a11+this.a23*m.a12+this.a33*m.a13,this.a13*m.a21+this.a23*m.a22+this.a33*m.a23,this.a13*m.a31+this.a23*m.a32+this.a33*m.a33)}}class cs extends Es{sampleGrid(m,b,S,P,N,V,$,te,de,Re,Fe,Ge,dt,Ct,Pt,$t,tn,Vn,zn){const Dn=Si.quadrilateralToQuadrilateral(P,N,V,$,te,de,Re,Fe,Ge,dt,Ct,Pt,$t,tn,Vn,zn);return this.sampleGridWithTransform(m,b,S,Dn)}sampleGridWithTransform(m,b,S,P){if(b<=0||S<=0)throw new He;const N=new ft(b,S),V=new Float32Array(2*b);for(let $=0;$<S;$++){const te=V.length,de=$+.5;for(let Re=0;Re<te;Re+=2)V[Re]=Re/2+.5,V[Re+1]=de;P.transformPoints(V),Es.checkAndNudgePoints(m,V);try{for(let Re=0;Re<te;Re+=2)m.get(Math.floor(V[Re]),Math.floor(V[Re+1]))&&N.set(Re/2,$)}catch{throw new He}}return N}}class Oi{static setGridSampler(m){Oi.gridSampler=m}static getInstance(){return Oi.gridSampler}}Oi.gridSampler=new cs;class mn{constructor(m,b){this.x=m,this.y=b}toResultPoint(){return new un(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class hr{constructor(m){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=m}detect(){return this.detectMirror(!1)}detectMirror(m){let b=this.getMatrixCenter(),S=this.getBullsEyeCorners(b);if(m){let V=S[0];S[0]=S[2],S[2]=V}this.extractParameters(S);let P=this.sampleGrid(this.image,S[this.shift%4],S[(this.shift+1)%4],S[(this.shift+2)%4],S[(this.shift+3)%4]),N=this.getMatrixCornerPoints(S);return new Ni(P,N,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(m){if(!this.isValidPoint(m[0])||!this.isValidPoint(m[1])||!this.isValidPoint(m[2])||!this.isValidPoint(m[3]))throw new He;let b=2*this.nbCenterLayers,S=new Int32Array([this.sampleLine(m[0],m[1],b),this.sampleLine(m[1],m[2],b),this.sampleLine(m[2],m[3],b),this.sampleLine(m[3],m[0],b)]);this.shift=this.getRotation(S,b);let P=0;for(let V=0;V<4;V++){let $=S[(this.shift+V)%4];this.compact?(P<<=7,P+=$>>1&127):(P<<=10,P+=($>>2&992)+($>>1&31))}let N=this.getCorrectedParameterData(P,this.compact);this.compact?(this.nbLayers=(N>>6)+1,this.nbDataBlocks=(N&63)+1):(this.nbLayers=(N>>11)+1,this.nbDataBlocks=(N&2047)+1)}getRotation(m,b){let S=0;m.forEach((P,N,V)=>{let $=(P>>b-2<<1)+(P&1);S=(S<<3)+$}),S=((S&1)<<11)+(S>>1);for(let P=0;P<4;P++)if(pe.bitCount(S^this.EXPECTED_CORNER_BITS[P])<=2)return P;throw new He}getCorrectedParameterData(m,b){let S,P;b?(S=7,P=2):(S=10,P=4);let N=S-P,V=new Int32Array(S);for(let te=S-1;te>=0;--te)V[te]=m&15,m>>=4;try{new fi(Yn.AZTEC_PARAM).decode(V,N)}catch{throw new He}let $=0;for(let te=0;te<P;te++)$=($<<4)+V[te];return $}getBullsEyeCorners(m){let b=m,S=m,P=m,N=m,V=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let Fe=this.getFirstDifferent(b,V,1,-1),Ge=this.getFirstDifferent(S,V,1,1),dt=this.getFirstDifferent(P,V,-1,1),Ct=this.getFirstDifferent(N,V,-1,-1);if(this.nbCenterLayers>2){let Pt=this.distancePoint(Ct,Fe)*this.nbCenterLayers/(this.distancePoint(N,b)*(this.nbCenterLayers+2));if(Pt<.75||Pt>1.25||!this.isWhiteOrBlackRectangle(Fe,Ge,dt,Ct))break}b=Fe,S=Ge,P=dt,N=Ct,V=!V}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new He;this.compact=this.nbCenterLayers===5;let $=new un(b.getX()+.5,b.getY()-.5),te=new un(S.getX()+.5,S.getY()+.5),de=new un(P.getX()-.5,P.getY()+.5),Re=new un(N.getX()-.5,N.getY()-.5);return this.expandSquare([$,te,de,Re],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let m,b,S,P;try{let $=new Bn(this.image).detect();m=$[0],b=$[1],S=$[2],P=$[3]}catch{let te=this.image.getWidth()/2,de=this.image.getHeight()/2;m=this.getFirstDifferent(new mn(te+7,de-7),!1,1,-1).toResultPoint(),b=this.getFirstDifferent(new mn(te+7,de+7),!1,1,1).toResultPoint(),S=this.getFirstDifferent(new mn(te-7,de+7),!1,-1,1).toResultPoint(),P=this.getFirstDifferent(new mn(te-7,de-7),!1,-1,-1).toResultPoint()}let N=jt.round((m.getX()+P.getX()+b.getX()+S.getX())/4),V=jt.round((m.getY()+P.getY()+b.getY()+S.getY())/4);try{let $=new Bn(this.image,15,N,V).detect();m=$[0],b=$[1],S=$[2],P=$[3]}catch{m=this.getFirstDifferent(new mn(N+7,V-7),!1,1,-1).toResultPoint(),b=this.getFirstDifferent(new mn(N+7,V+7),!1,1,1).toResultPoint(),S=this.getFirstDifferent(new mn(N-7,V+7),!1,-1,1).toResultPoint(),P=this.getFirstDifferent(new mn(N-7,V-7),!1,-1,-1).toResultPoint()}return N=jt.round((m.getX()+P.getX()+b.getX()+S.getX())/4),V=jt.round((m.getY()+P.getY()+b.getY()+S.getY())/4),new mn(N,V)}getMatrixCornerPoints(m){return this.expandSquare(m,2*this.nbCenterLayers,this.getDimension())}sampleGrid(m,b,S,P,N){let V=Oi.getInstance(),$=this.getDimension(),te=$/2-this.nbCenterLayers,de=$/2+this.nbCenterLayers;return V.sampleGrid(m,$,$,te,te,de,te,de,de,te,de,b.getX(),b.getY(),S.getX(),S.getY(),P.getX(),P.getY(),N.getX(),N.getY())}sampleLine(m,b,S){let P=0,N=this.distanceResultPoint(m,b),V=N/S,$=m.getX(),te=m.getY(),de=V*(b.getX()-m.getX())/N,Re=V*(b.getY()-m.getY())/N;for(let Fe=0;Fe<S;Fe++)this.image.get(jt.round($+Fe*de),jt.round(te+Fe*Re))&&(P|=1<<S-Fe-1);return P}isWhiteOrBlackRectangle(m,b,S,P){let N=3;m=new mn(m.getX()-N,m.getY()+N),b=new mn(b.getX()-N,b.getY()-N),S=new mn(S.getX()+N,S.getY()-N),P=new mn(P.getX()+N,P.getY()+N);let V=this.getColor(P,m);if(V===0)return!1;let $=this.getColor(m,b);return $!==V||($=this.getColor(b,S),$!==V)?!1:($=this.getColor(S,P),$===V)}getColor(m,b){let S=this.distancePoint(m,b),P=(b.getX()-m.getX())/S,N=(b.getY()-m.getY())/S,V=0,$=m.getX(),te=m.getY(),de=this.image.get(m.getX(),m.getY()),Re=Math.ceil(S);for(let Ge=0;Ge<Re;Ge++)$+=P,te+=N,this.image.get(jt.round($),jt.round(te))!==de&&V++;let Fe=V/S;return Fe>.1&&Fe<.9?0:Fe<=.1===de?1:-1}getFirstDifferent(m,b,S,P){let N=m.getX()+S,V=m.getY()+P;for(;this.isValid(N,V)&&this.image.get(N,V)===b;)N+=S,V+=P;for(N-=S,V-=P;this.isValid(N,V)&&this.image.get(N,V)===b;)N+=S;for(N-=S;this.isValid(N,V)&&this.image.get(N,V)===b;)V+=P;return V-=P,new mn(N,V)}expandSquare(m,b,S){let P=S/(2*b),N=m[0].getX()-m[2].getX(),V=m[0].getY()-m[2].getY(),$=(m[0].getX()+m[2].getX())/2,te=(m[0].getY()+m[2].getY())/2,de=new un($+P*N,te+P*V),Re=new un($-P*N,te-P*V);N=m[1].getX()-m[3].getX(),V=m[1].getY()-m[3].getY(),$=(m[1].getX()+m[3].getX())/2,te=(m[1].getY()+m[3].getY())/2;let Fe=new un($+P*N,te+P*V),Ge=new un($-P*N,te-P*V);return[de,Fe,Re,Ge]}isValid(m,b){return m>=0&&m<this.image.getWidth()&&b>0&&b<this.image.getHeight()}isValidPoint(m){let b=jt.round(m.getX()),S=jt.round(m.getY());return this.isValid(b,S)}distancePoint(m,b){return jt.distance(m.getX(),m.getY(),b.getX(),b.getY())}distanceResultPoint(m,b){return jt.distance(m.getX(),m.getY(),b.getX(),b.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(pe.truncDivision(this.nbLayers-4,8)+1)+15}}class Tr{decode(m,b=null){let S=null,P=new hr(m.getBlackMatrix()),N=null,V=null;try{let Re=P.detectMirror(!1);N=Re.getPoints(),this.reportFoundResultPoints(b,N),V=new Mn().decode(Re)}catch(Re){S=Re}if(V==null)try{let Re=P.detectMirror(!0);N=Re.getPoints(),this.reportFoundResultPoints(b,N),V=new Mn().decode(Re)}catch(Re){throw S??Re}let $=new On(V.getText(),V.getRawBytes(),V.getNumBits(),N,En.AZTEC,Z.currentTimeMillis()),te=V.getByteSegments();te!=null&&$.putMetadata(ur.BYTE_SEGMENTS,te);let de=V.getECLevel();return de!=null&&$.putMetadata(ur.ERROR_CORRECTION_LEVEL,de),$}reportFoundResultPoints(m,b){if(m!=null){let S=m.get(Ae.NEED_RESULT_POINT_CALLBACK);S!=null&&b.forEach((P,N,V)=>{S.foundPossibleResultPoint(P)})}}reset(){}}class Li extends Xt{constructor(m=500){super(new Tr,m)}}class pi{decode(m,b){try{return this.doDecode(m,b)}catch{if(b&&b.get(Ae.TRY_HARDER)===!0&&m.isRotateSupported()){const N=m.rotateCounterClockwise(),V=this.doDecode(N,b),$=V.getResultMetadata();let te=270;$!==null&&$.get(ur.ORIENTATION)===!0&&(te=te+$.get(ur.ORIENTATION)%360),V.putMetadata(ur.ORIENTATION,te);const de=V.getResultPoints();if(de!==null){const Re=N.getHeight();for(let Fe=0;Fe<de.length;Fe++)de[Fe]=new un(Re-de[Fe].getY()-1,de[Fe].getX())}return V}else throw new He}}reset(){}doDecode(m,b){const S=m.getWidth(),P=m.getHeight();let N=new _e(S);const V=b&&b.get(Ae.TRY_HARDER)===!0,$=Math.max(1,P>>(V?8:5));let te;V?te=P:te=15;const de=Math.trunc(P/2);for(let Re=0;Re<te;Re++){const Fe=Math.trunc((Re+1)/2),Ge=(Re&1)===0,dt=de+$*(Ge?Fe:-Fe);if(dt<0||dt>=P)break;try{N=m.getBlackRow(dt,N)}catch{continue}for(let Ct=0;Ct<2;Ct++){if(Ct===1&&(N.reverse(),b&&b.get(Ae.NEED_RESULT_POINT_CALLBACK)===!0)){const Pt=new Map;b.forEach(($t,tn)=>Pt.set(tn,$t)),Pt.delete(Ae.NEED_RESULT_POINT_CALLBACK),b=Pt}try{const Pt=this.decodeRow(dt,N,b);if(Ct===1){Pt.putMetadata(ur.ORIENTATION,180);const $t=Pt.getResultPoints();$t!==null&&($t[0]=new un(S-$t[0].getX()-1,$t[0].getY()),$t[1]=new un(S-$t[1].getX()-1,$t[1].getY()))}return Pt}catch{}}}throw new He}static recordPattern(m,b,S){const P=S.length;for(let de=0;de<P;de++)S[de]=0;const N=m.getSize();if(b>=N)throw new He;let V=!m.get(b),$=0,te=b;for(;te<N;){if(m.get(te)!==V)S[$]++;else{if(++$===P)break;S[$]=1,V=!V}te++}if(!($===P||$===P-1&&te===N))throw new He}static recordPatternInReverse(m,b,S){let P=S.length,N=m.get(b);for(;b>0&&P>=0;)m.get(--b)!==N&&(P--,N=!N);if(P>=0)throw new He;pi.recordPattern(m,b+1,S)}static patternMatchVariance(m,b,S){const P=m.length;let N=0,V=0;for(let de=0;de<P;de++)N+=m[de],V+=b[de];if(N<V)return Number.POSITIVE_INFINITY;const $=N/V;S*=$;let te=0;for(let de=0;de<P;de++){const Re=m[de],Fe=b[de]*$,Ge=Re>Fe?Re-Fe:Fe-Re;if(Ge>S)return Number.POSITIVE_INFINITY;te+=Ge}return te/N}}class rn extends pi{static findStartPattern(m){const b=m.getSize(),S=m.getNextSet(0);let P=0,N=Int32Array.from([0,0,0,0,0,0]),V=S,$=!1;const te=6;for(let de=S;de<b;de++)if(m.get(de)!==$)N[P]++;else{if(P===te-1){let Re=rn.MAX_AVG_VARIANCE,Fe=-1;for(let Ge=rn.CODE_START_A;Ge<=rn.CODE_START_C;Ge++){const dt=pi.patternMatchVariance(N,rn.CODE_PATTERNS[Ge],rn.MAX_INDIVIDUAL_VARIANCE);dt<Re&&(Re=dt,Fe=Ge)}if(Fe>=0&&m.isRange(Math.max(0,V-(de-V)/2),V,!1))return Int32Array.from([V,de,Fe]);V+=N[0]+N[1],N=N.slice(2,N.length-1),N[P-1]=0,N[P]=0,P--}else P++;N[P]=1,$=!$}throw new He}static decodeCode(m,b,S){pi.recordPattern(m,S,b);let P=rn.MAX_AVG_VARIANCE,N=-1;for(let V=0;V<rn.CODE_PATTERNS.length;V++){const $=rn.CODE_PATTERNS[V],te=this.patternMatchVariance(b,$,rn.MAX_INDIVIDUAL_VARIANCE);te<P&&(P=te,N=V)}if(N>=0)return N;throw new He}decodeRow(m,b,S){const P=S&&S.get(Ae.ASSUME_GS1)===!0,N=rn.findStartPattern(b),V=N[2];let $=0;const te=new Uint8Array(20);te[$++]=V;let de;switch(V){case rn.CODE_START_A:de=rn.CODE_CODE_A;break;case rn.CODE_START_B:de=rn.CODE_CODE_B;break;case rn.CODE_START_C:de=rn.CODE_CODE_C;break;default:throw new re}let Re=!1,Fe=!1,Ge="",dt=N[0],Ct=N[1];const Pt=Int32Array.from([0,0,0,0,0,0]);let $t=0,tn=0,Vn=V,zn=0,Dn=!0,Pi=!1,Xr=!1;for(;!Re;){const Ol=Fe;switch(Fe=!1,$t=tn,tn=rn.decodeCode(b,Pt,Ct),te[$++]=tn,tn!==rn.CODE_STOP&&(Dn=!0),tn!==rn.CODE_STOP&&(zn++,Vn+=zn*tn),dt=Ct,Ct+=Pt.reduce((Gh,jd)=>Gh+jd,0),tn){case rn.CODE_START_A:case rn.CODE_START_B:case rn.CODE_START_C:throw new re}switch(de){case rn.CODE_CODE_A:if(tn<64)Xr===Pi?Ge+=String.fromCharCode(32+tn):Ge+=String.fromCharCode(32+tn+128),Xr=!1;else if(tn<96)Xr===Pi?Ge+=String.fromCharCode(tn-64):Ge+=String.fromCharCode(tn+64),Xr=!1;else switch(tn!==rn.CODE_STOP&&(Dn=!1),tn){case rn.CODE_FNC_1:P&&(Ge.length===0?Ge+="]C1":Ge+="");break;case rn.CODE_FNC_2:case rn.CODE_FNC_3:break;case rn.CODE_FNC_4_A:!Pi&&Xr?(Pi=!0,Xr=!1):Pi&&Xr?(Pi=!1,Xr=!1):Xr=!0;break;case rn.CODE_SHIFT:Fe=!0,de=rn.CODE_CODE_B;break;case rn.CODE_CODE_B:de=rn.CODE_CODE_B;break;case rn.CODE_CODE_C:de=rn.CODE_CODE_C;break;case rn.CODE_STOP:Re=!0;break}break;case rn.CODE_CODE_B:if(tn<96)Xr===Pi?Ge+=String.fromCharCode(32+tn):Ge+=String.fromCharCode(32+tn+128),Xr=!1;else switch(tn!==rn.CODE_STOP&&(Dn=!1),tn){case rn.CODE_FNC_1:P&&(Ge.length===0?Ge+="]C1":Ge+="");break;case rn.CODE_FNC_2:case rn.CODE_FNC_3:break;case rn.CODE_FNC_4_B:!Pi&&Xr?(Pi=!0,Xr=!1):Pi&&Xr?(Pi=!1,Xr=!1):Xr=!0;break;case rn.CODE_SHIFT:Fe=!0,de=rn.CODE_CODE_A;break;case rn.CODE_CODE_A:de=rn.CODE_CODE_A;break;case rn.CODE_CODE_C:de=rn.CODE_CODE_C;break;case rn.CODE_STOP:Re=!0;break}break;case rn.CODE_CODE_C:if(tn<100)tn<10&&(Ge+="0"),Ge+=tn;else switch(tn!==rn.CODE_STOP&&(Dn=!1),tn){case rn.CODE_FNC_1:P&&(Ge.length===0?Ge+="]C1":Ge+="");break;case rn.CODE_CODE_A:de=rn.CODE_CODE_A;break;case rn.CODE_CODE_B:de=rn.CODE_CODE_B;break;case rn.CODE_STOP:Re=!0;break}break}Ol&&(de=de===rn.CODE_CODE_A?rn.CODE_CODE_B:rn.CODE_CODE_A)}const Sa=Ct-dt;if(Ct=b.getNextUnset(Ct),!b.isRange(Ct,Math.min(b.getSize(),Ct+(Ct-dt)/2),!1))throw new He;if(Vn-=zn*$t,Vn%103!==$t)throw new K;const Qa=Ge.length;if(Qa===0)throw new He;Qa>0&&Dn&&(de===rn.CODE_CODE_C?Ge=Ge.substring(0,Qa-2):Ge=Ge.substring(0,Qa-1));const Zo=(N[1]+N[0])/2,_s=dt+Sa/2,to=te.length,Ta=new Uint8Array(to);for(let Ol=0;Ol<to;Ol++)Ta[Ol]=te[Ol];const Iu=[new un(Zo,m),new un(_s,m)];return new On(Ge,Ta,0,Iu,En.CODE_128,new Date().getTime())}}rn.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],rn.MAX_AVG_VARIANCE=.25,rn.MAX_INDIVIDUAL_VARIANCE=.7,rn.CODE_SHIFT=98,rn.CODE_CODE_C=99,rn.CODE_CODE_B=100,rn.CODE_CODE_A=101,rn.CODE_FNC_1=102,rn.CODE_FNC_2=97,rn.CODE_FNC_3=96,rn.CODE_FNC_4_A=101,rn.CODE_FNC_4_B=100,rn.CODE_START_A=103,rn.CODE_START_B=104,rn.CODE_START_C=105,rn.CODE_STOP=106;class Rr extends pi{constructor(m=!1,b=!1){super(),this.usingCheckDigit=m,this.extendedMode=b,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(m,b,S){let P=this.counters;P.fill(0),this.decodeRowResult="";let N=Rr.findAsteriskPattern(b,P),V=b.getNextSet(N[1]),$=b.getSize(),te,de;do{Rr.recordPattern(b,V,P);let Pt=Rr.toNarrowWidePattern(P);if(Pt<0)throw new He;te=Rr.patternToChar(Pt),this.decodeRowResult+=te,de=V;for(let $t of P)V+=$t;V=b.getNextSet(V)}while(te!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let Re=0;for(let Pt of P)Re+=Pt;let Fe=V-de-Re;if(V!==$&&Fe*2<Re)throw new He;if(this.usingCheckDigit){let Pt=this.decodeRowResult.length-1,$t=0;for(let tn=0;tn<Pt;tn++)$t+=Rr.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(tn));if(this.decodeRowResult.charAt(Pt)!==Rr.ALPHABET_STRING.charAt($t%43))throw new K;this.decodeRowResult=this.decodeRowResult.substring(0,Pt)}if(this.decodeRowResult.length===0)throw new He;let Ge;this.extendedMode?Ge=Rr.decodeExtended(this.decodeRowResult):Ge=this.decodeRowResult;let dt=(N[1]+N[0])/2,Ct=de+Re/2;return new On(Ge,null,0,[new un(dt,m),new un(Ct,m)],En.CODE_39,new Date().getTime())}static findAsteriskPattern(m,b){let S=m.getSize(),P=m.getNextSet(0),N=0,V=P,$=!1,te=b.length;for(let de=P;de<S;de++)if(m.get(de)!==$)b[N]++;else{if(N===te-1){if(this.toNarrowWidePattern(b)===Rr.ASTERISK_ENCODING&&m.isRange(Math.max(0,V-Math.floor((de-V)/2)),V,!1))return[V,de];V+=b[0]+b[1],b.copyWithin(0,2,2+N-1),b[N-1]=0,b[N]=0,N--}else N++;b[N]=1,$=!$}throw new He}static toNarrowWidePattern(m){let b=m.length,S=0,P;do{let N=2147483647;for(let te of m)te<N&&te>S&&(N=te);S=N,P=0;let V=0,$=0;for(let te=0;te<b;te++){let de=m[te];de>S&&($|=1<<b-1-te,P++,V+=de)}if(P===3){for(let te=0;te<b&&P>0;te++){let de=m[te];if(de>S&&(P--,de*2>=V))return-1}return $}}while(P>3);return-1}static patternToChar(m){for(let b=0;b<Rr.CHARACTER_ENCODINGS.length;b++)if(Rr.CHARACTER_ENCODINGS[b]===m)return Rr.ALPHABET_STRING.charAt(b);if(m===Rr.ASTERISK_ENCODING)return"*";throw new He}static decodeExtended(m){let b=m.length,S="";for(let P=0;P<b;P++){let N=m.charAt(P);if(N==="+"||N==="$"||N==="%"||N==="/"){let V=m.charAt(P+1),$="\0";switch(N){case"+":if(V>="A"&&V<="Z")$=String.fromCharCode(V.charCodeAt(0)+32);else throw new re;break;case"$":if(V>="A"&&V<="Z")$=String.fromCharCode(V.charCodeAt(0)-64);else throw new re;break;case"%":if(V>="A"&&V<="E")$=String.fromCharCode(V.charCodeAt(0)-38);else if(V>="F"&&V<="J")$=String.fromCharCode(V.charCodeAt(0)-11);else if(V>="K"&&V<="O")$=String.fromCharCode(V.charCodeAt(0)+16);else if(V>="P"&&V<="T")$=String.fromCharCode(V.charCodeAt(0)+43);else if(V==="U")$="\0";else if(V==="V")$="@";else if(V==="W")$="`";else if(V==="X"||V==="Y"||V==="Z")$="";else throw new re;break;case"/":if(V>="A"&&V<="O")$=String.fromCharCode(V.charCodeAt(0)-32);else if(V==="Z")$=":";else throw new re;break}S+=$,P++}else S+=N}return S}}Rr.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Rr.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Rr.ASTERISK_ENCODING=148;class $r extends pi{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(m,b,S){let P=this.decodeStart(b),N=this.decodeEnd(b),V=new ze;$r.decodeMiddle(b,P[1],N[0],V);let $=V.toString(),te=null;S!=null&&(te=S.get(Ae.ALLOWED_LENGTHS)),te==null&&(te=$r.DEFAULT_ALLOWED_LENGTHS);let de=$.length,Re=!1,Fe=0;for(let Ct of te){if(de===Ct){Re=!0;break}Ct>Fe&&(Fe=Ct)}if(!Re&&de>Fe&&(Re=!0),!Re)throw new re;const Ge=[new un(P[1],m),new un(N[0],m)];return new On($,null,0,Ge,En.ITF,new Date().getTime())}static decodeMiddle(m,b,S,P){let N=new Int32Array(10),V=new Int32Array(5),$=new Int32Array(5);for(N.fill(0),V.fill(0),$.fill(0);b<S;){pi.recordPattern(m,b,N);for(let de=0;de<5;de++){let Re=2*de;V[de]=N[Re],$[de]=N[Re+1]}let te=$r.decodeDigit(V);P.append(te.toString()),te=this.decodeDigit($),P.append(te.toString()),N.forEach(function(de){b+=de})}}decodeStart(m){let b=$r.skipWhiteSpace(m),S=$r.findGuardPattern(m,b,$r.START_PATTERN);return this.narrowLineWidth=(S[1]-S[0])/4,this.validateQuietZone(m,S[0]),S}validateQuietZone(m,b){let S=this.narrowLineWidth*10;S=S<b?S:b;for(let P=b-1;S>0&&P>=0&&!m.get(P);P--)S--;if(S!==0)throw new He}static skipWhiteSpace(m){const b=m.getSize(),S=m.getNextSet(0);if(S===b)throw new He;return S}decodeEnd(m){m.reverse();try{let b=$r.skipWhiteSpace(m),S;try{S=$r.findGuardPattern(m,b,$r.END_PATTERN_REVERSED[0])}catch(N){N instanceof He&&(S=$r.findGuardPattern(m,b,$r.END_PATTERN_REVERSED[1]))}this.validateQuietZone(m,S[0]);let P=S[0];return S[0]=m.getSize()-S[1],S[1]=m.getSize()-P,S}finally{m.reverse()}}static findGuardPattern(m,b,S){let P=S.length,N=new Int32Array(P),V=m.getSize(),$=!1,te=0,de=b;N.fill(0);for(let Re=b;Re<V;Re++)if(m.get(Re)!==$)N[te]++;else{if(te===P-1){if(pi.patternMatchVariance(N,S,$r.MAX_INDIVIDUAL_VARIANCE)<$r.MAX_AVG_VARIANCE)return[de,Re];de+=N[0]+N[1],Z.arraycopy(N,2,N,0,te-1),N[te-1]=0,N[te]=0,te--}else te++;N[te]=1,$=!$}throw new He}static decodeDigit(m){let b=$r.MAX_AVG_VARIANCE,S=-1,P=$r.PATTERNS.length;for(let N=0;N<P;N++){let V=$r.PATTERNS[N],$=pi.patternMatchVariance(m,V,$r.MAX_INDIVIDUAL_VARIANCE);$<b?(b=$,S=N):$===b&&(S=-1)}if(S>=0)return S%10;throw new He}}$r.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],$r.MAX_AVG_VARIANCE=.38,$r.MAX_INDIVIDUAL_VARIANCE=.5,$r.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],$r.START_PATTERN=Int32Array.from([1,1,1,1]),$r.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Nr extends pi{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(m){let b=!1,S,P=0,N=Int32Array.from([0,0,0]);for(;!b;){N=Int32Array.from([0,0,0]),S=Nr.findGuardPattern(m,P,!1,this.START_END_PATTERN,N);let V=S[0];P=S[1];let $=V-(P-V);$>=0&&(b=m.isRange($,V,!1))}return S}static checkChecksum(m){return Nr.checkStandardUPCEANChecksum(m)}static checkStandardUPCEANChecksum(m){let b=m.length;if(b===0)return!1;let S=parseInt(m.charAt(b-1),10);return Nr.getStandardUPCEANChecksum(m.substring(0,b-1))===S}static getStandardUPCEANChecksum(m){let b=m.length,S=0;for(let P=b-1;P>=0;P-=2){let N=m.charAt(P).charCodeAt(0)-48;if(N<0||N>9)throw new re;S+=N}S*=3;for(let P=b-2;P>=0;P-=2){let N=m.charAt(P).charCodeAt(0)-48;if(N<0||N>9)throw new re;S+=N}return(1e3-S)%10}static decodeEnd(m,b){return Nr.findGuardPattern(m,b,!1,Nr.START_END_PATTERN,new Int32Array(Nr.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(m,b,S,P){return this.findGuardPattern(m,b,S,P,new Int32Array(P.length))}static findGuardPattern(m,b,S,P,N){let V=m.getSize();b=S?m.getNextUnset(b):m.getNextSet(b);let $=0,te=b,de=P.length,Re=S;for(let Fe=b;Fe<V;Fe++)if(m.get(Fe)!==Re)N[$]++;else{if($===de-1){if(pi.patternMatchVariance(N,P,Nr.MAX_INDIVIDUAL_VARIANCE)<Nr.MAX_AVG_VARIANCE)return Int32Array.from([te,Fe]);te+=N[0]+N[1];let Ge=N.slice(2,N.length-1);for(let dt=0;dt<$-1;dt++)N[dt]=Ge[dt];N[$-1]=0,N[$]=0,$--}else $++;N[$]=1,Re=!Re}throw new He}static decodeDigit(m,b,S,P){this.recordPattern(m,S,b);let N=this.MAX_AVG_VARIANCE,V=-1,$=P.length;for(let te=0;te<$;te++){let de=P[te],Re=pi.patternMatchVariance(b,de,Nr.MAX_INDIVIDUAL_VARIANCE);Re<N&&(N=Re,V=te)}if(V>=0)return V;throw new He}}Nr.MAX_AVG_VARIANCE=.48,Nr.MAX_INDIVIDUAL_VARIANCE=.7,Nr.START_END_PATTERN=Int32Array.from([1,1,1]),Nr.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Nr.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Nr.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class ri{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(m,b,S){let P=this.decodeRowStringBuffer,N=this.decodeMiddle(b,S,P),V=P.toString(),$=ri.parseExtensionString(V),te=[new un((S[0]+S[1])/2,m),new un(N,m)],de=new On(V,null,0,te,En.UPC_EAN_EXTENSION,new Date().getTime());return $!=null&&de.putAllMetadata($),de}decodeMiddle(m,b,S){let P=this.decodeMiddleCounters;P[0]=0,P[1]=0,P[2]=0,P[3]=0;let N=m.getSize(),V=b[1],$=0;for(let de=0;de<5&&V<N;de++){let Re=Nr.decodeDigit(m,P,V,Nr.L_AND_G_PATTERNS);S+=String.fromCharCode(48+Re%10);for(let Fe of P)V+=Fe;Re>=10&&($|=1<<4-de),de!==4&&(V=m.getNextSet(V),V=m.getNextUnset(V))}if(S.length!==5)throw new He;let te=this.determineCheckDigit($);if(ri.extensionChecksum(S.toString())!==te)throw new He;return V}static extensionChecksum(m){let b=m.length,S=0;for(let P=b-2;P>=0;P-=2)S+=m.charAt(P).charCodeAt(0)-48;S*=3;for(let P=b-1;P>=0;P-=2)S+=m.charAt(P).charCodeAt(0)-48;return S*=3,S%10}determineCheckDigit(m){for(let b=0;b<10;b++)if(m===this.CHECK_DIGIT_ENCODINGS[b])return b;throw new He}static parseExtensionString(m){if(m.length!==5)return null;let b=ri.parseExtension5String(m);return b==null?null:new Map([[ur.SUGGESTED_PRICE,b]])}static parseExtension5String(m){let b;switch(m.charAt(0)){case"0":b="";break;case"5":b="$";break;case"9":switch(m){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}b="";break;default:b="";break}let S=parseInt(m.substring(1)),P=(S/100).toString(),N=S%100,V=N<10?"0"+N:N.toString();return b+P+"."+V}}class Ec{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(m,b,S){let P=this.decodeRowStringBuffer,N=this.decodeMiddle(b,S,P),V=P.toString(),$=Ec.parseExtensionString(V),te=[new un((S[0]+S[1])/2,m),new un(N,m)],de=new On(V,null,0,te,En.UPC_EAN_EXTENSION,new Date().getTime());return $!=null&&de.putAllMetadata($),de}decodeMiddle(m,b,S){let P=this.decodeMiddleCounters;P[0]=0,P[1]=0,P[2]=0,P[3]=0;let N=m.getSize(),V=b[1],$=0;for(let te=0;te<2&&V<N;te++){let de=Nr.decodeDigit(m,P,V,Nr.L_AND_G_PATTERNS);S+=String.fromCharCode(48+de%10);for(let Re of P)V+=Re;de>=10&&($|=1<<1-te),te!==1&&(V=m.getNextSet(V),V=m.getNextUnset(V))}if(S.length!==2)throw new He;if(parseInt(S.toString())%4!==$)throw new He;return V}static parseExtensionString(m){return m.length!==2?null:new Map([[ur.ISSUE_NUMBER,parseInt(m)]])}}class Sc{static decodeRow(m,b,S){let P=Nr.findGuardPattern(b,S,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new ri().decodeRow(m,b,P)}catch{return new Ec().decodeRow(m,b,P)}}}Sc.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Zr extends Nr{constructor(){super(),this.decodeRowStringBuffer="",Zr.L_AND_G_PATTERNS=Zr.L_PATTERNS.map(m=>Int32Array.from(m));for(let m=10;m<20;m++){let b=Zr.L_PATTERNS[m-10],S=new Int32Array(b.length);for(let P=0;P<b.length;P++)S[P]=b[b.length-P-1];Zr.L_AND_G_PATTERNS[m]=S}}decodeRow(m,b,S){let P=Zr.findStartGuardPattern(b),N=S==null?null:S.get(Ae.NEED_RESULT_POINT_CALLBACK);if(N!=null){const Dn=new un((P[0]+P[1])/2,m);N.foundPossibleResultPoint(Dn)}let V=this.decodeMiddle(b,P,this.decodeRowStringBuffer),$=V.rowOffset,te=V.resultString;if(N!=null){const Dn=new un($,m);N.foundPossibleResultPoint(Dn)}let de=this.decodeEnd(b,$);if(N!=null){const Dn=new un((de[0]+de[1])/2,m);N.foundPossibleResultPoint(Dn)}let Re=de[1],Fe=Re+(Re-de[0]);if(Fe>=b.getSize()||!b.isRange(Re,Fe,!1))throw new He;let Ge=te.toString();if(Ge.length<8)throw new re;if(!Zr.checkChecksum(Ge))throw new K;let dt=(P[1]+P[0])/2,Ct=(de[1]+de[0])/2,Pt=this.getBarcodeFormat(),$t=[new un(dt,m),new un(Ct,m)],tn=new On(Ge,null,0,$t,Pt,new Date().getTime()),Vn=0;try{let Dn=Sc.decodeRow(m,b,de[1]);tn.putMetadata(ur.UPC_EAN_EXTENSION,Dn.getText()),tn.putAllMetadata(Dn.getResultMetadata()),tn.addResultPoints(Dn.getResultPoints()),Vn=Dn.getText().length}catch{}let zn=S==null?null:S.get(Ae.ALLOWED_EAN_EXTENSIONS);if(zn!=null){let Dn=!1;for(let Pi in zn)if(Vn.toString()===Pi){Dn=!0;break}if(!Dn)throw new He}return tn}decodeEnd(m,b){return Zr.findGuardPattern(m,b,!1,Zr.START_END_PATTERN,new Int32Array(Zr.START_END_PATTERN.length).fill(0))}static checkChecksum(m){return Zr.checkStandardUPCEANChecksum(m)}static checkStandardUPCEANChecksum(m){let b=m.length;if(b===0)return!1;let S=parseInt(m.charAt(b-1),10);return Zr.getStandardUPCEANChecksum(m.substring(0,b-1))===S}static getStandardUPCEANChecksum(m){let b=m.length,S=0;for(let P=b-1;P>=0;P-=2){let N=m.charAt(P).charCodeAt(0)-48;if(N<0||N>9)throw new re;S+=N}S*=3;for(let P=b-2;P>=0;P-=2){let N=m.charAt(P).charCodeAt(0)-48;if(N<0||N>9)throw new re;S+=N}return(1e3-S)%10}}class ra extends Zr{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(m,b,S){let P=this.decodeMiddleCounters;P[0]=0,P[1]=0,P[2]=0,P[3]=0;let N=m.getSize(),V=b[1],$=0;for(let de=0;de<6&&V<N;de++){let Re=Zr.decodeDigit(m,P,V,Zr.L_AND_G_PATTERNS);S+=String.fromCharCode(48+Re%10);for(let Fe of P)V+=Fe;Re>=10&&($|=1<<5-de)}S=ra.determineFirstDigit(S,$),V=Zr.findGuardPattern(m,V,!0,Zr.MIDDLE_PATTERN,new Int32Array(Zr.MIDDLE_PATTERN.length).fill(0))[1];for(let de=0;de<6&&V<N;de++){let Re=Zr.decodeDigit(m,P,V,Zr.L_PATTERNS);S+=String.fromCharCode(48+Re);for(let Fe of P)V+=Fe}return{rowOffset:V,resultString:S}}getBarcodeFormat(){return En.EAN_13}static determineFirstDigit(m,b){for(let S=0;S<10;S++)if(b===this.FIRST_DIGIT_ENCODINGS[S])return m=String.fromCharCode(48+S)+m,m;throw new He}}ra.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Tc extends Zr{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(m,b,S){const P=this.decodeMiddleCounters;P[0]=0,P[1]=0,P[2]=0,P[3]=0;let N=m.getSize(),V=b[1];for(let te=0;te<4&&V<N;te++){let de=Zr.decodeDigit(m,P,V,Zr.L_PATTERNS);S+=String.fromCharCode(48+de);for(let Re of P)V+=Re}V=Zr.findGuardPattern(m,V,!0,Zr.MIDDLE_PATTERN,new Int32Array(Zr.MIDDLE_PATTERN.length).fill(0))[1];for(let te=0;te<4&&V<N;te++){let de=Zr.decodeDigit(m,P,V,Zr.L_PATTERNS);S+=String.fromCharCode(48+de);for(let Re of P)V+=Re}return{rowOffset:V,resultString:S}}getBarcodeFormat(){return En.EAN_8}}class za extends Zr{constructor(){super(...arguments),this.ean13Reader=new ra}getBarcodeFormat(){return En.UPC_A}decode(m,b){return this.maybeReturnResult(this.ean13Reader.decode(m))}decodeRow(m,b,S){return this.maybeReturnResult(this.ean13Reader.decodeRow(m,b,S))}decodeMiddle(m,b,S){return this.ean13Reader.decodeMiddle(m,b,S)}maybeReturnResult(m){let b=m.getText();if(b.charAt(0)==="0"){let S=new On(b.substring(1),null,null,m.getResultPoints(),En.UPC_A);return m.getResultMetadata()!=null&&S.putAllMetadata(m.getResultMetadata()),S}else throw new He}reset(){this.ean13Reader.reset()}}class ia extends Zr{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(m,b,S){const P=this.decodeMiddleCounters.map(de=>de);P[0]=0,P[1]=0,P[2]=0,P[3]=0;const N=m.getSize();let V=b[1],$=0;for(let de=0;de<6&&V<N;de++){const Re=ia.decodeDigit(m,P,V,ia.L_AND_G_PATTERNS);S+=String.fromCharCode(48+Re%10);for(let Fe of P)V+=Fe;Re>=10&&($|=1<<5-de)}let te=ia.determineNumSysAndCheckDigit(S,$);return{rowOffset:V,resultString:te}}decodeEnd(m,b){return ia.findGuardPatternWithoutCounters(m,b,!0,ia.MIDDLE_END_PATTERN)}checkChecksum(m){return Zr.checkChecksum(ia.convertUPCEtoUPCA(m))}static determineNumSysAndCheckDigit(m,b){for(let S=0;S<=1;S++)for(let P=0;P<10;P++)if(b===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[S][P]){let N=String.fromCharCode(48+S),V=String.fromCharCode(48+P);return N+m+V}throw He.getNotFoundInstance()}getBarcodeFormat(){return En.UPC_E}static convertUPCEtoUPCA(m){const b=m.slice(1,7).split("").map(N=>N.charCodeAt(0)),S=new ze;S.append(m.charAt(0));let P=b[5];switch(P){case 0:case 1:case 2:S.appendChars(b,0,2),S.append(P),S.append("0000"),S.appendChars(b,2,3);break;case 3:S.appendChars(b,0,3),S.append("00000"),S.appendChars(b,3,2);break;case 4:S.appendChars(b,0,4),S.append("00000"),S.append(b[4]);break;default:S.appendChars(b,0,5),S.append("0000"),S.append(P);break}return m.length>=8&&S.append(m.charAt(7)),S.toString()}}ia.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),ia.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class sc extends pi{constructor(m){super();let b=m==null?null:m.get(Ae.POSSIBLE_FORMATS),S=[];r(b)?(S.push(new ra),S.push(new za),S.push(new Tc),S.push(new ia)):(b.indexOf(En.EAN_13)>-1&&S.push(new ra),b.indexOf(En.UPC_A)>-1&&S.push(new za),b.indexOf(En.EAN_8)>-1&&S.push(new Tc),b.indexOf(En.UPC_E)>-1&&S.push(new ia)),this.readers=S}decodeRow(m,b,S){for(let P of this.readers)try{const N=P.decodeRow(m,b,S),V=N.getBarcodeFormat()===En.EAN_13&&N.getText().charAt(0)==="0",$=S==null?null:S.get(Ae.POSSIBLE_FORMATS),te=$==null||$.includes(En.UPC_A);if(V&&te){const de=N.getRawBytes(),Re=new On(N.getText().substring(1),de,de?de.length:null,N.getResultPoints(),En.UPC_A);return Re.putAllMetadata(N.getResultMetadata()),Re}return N}catch{}throw new He}reset(){for(let m of this.readers)m.reset()}}class io extends pi{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(m,b){for(let S=0;S<b.length;S++)if(pi.patternMatchVariance(m,b[S],io.MAX_INDIVIDUAL_VARIANCE)<io.MAX_AVG_VARIANCE)return S;throw new He}static count(m){return jt.sum(new Int32Array(m))}static increment(m,b){let S=0,P=b[0];for(let N=1;N<m.length;N++)b[N]>P&&(P=b[N],S=N);m[S]++}static decrement(m,b){let S=0,P=b[0];for(let N=1;N<m.length;N++)b[N]<P&&(P=b[N],S=N);m[S]--}static isFinderPattern(m){let b=m[0]+m[1],S=b+m[2]+m[3],P=b/S;if(P>=io.MIN_FINDER_PATTERN_RATIO&&P<=io.MAX_FINDER_PATTERN_RATIO){let N=Number.MAX_SAFE_INTEGER,V=Number.MIN_SAFE_INTEGER;for(let $ of m)$>V&&(V=$),$<N&&(N=$);return V<10*N}return!1}}io.MAX_AVG_VARIANCE=.2,io.MAX_INDIVIDUAL_VARIANCE=.45,io.MIN_FINDER_PATTERN_RATIO=9.5/12,io.MAX_FINDER_PATTERN_RATIO=12.5/14;class It{constructor(m,b){this.value=m,this.checksumPortion=b}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(m){if(!(m instanceof It))return!1;const b=m;return this.value===b.value&&this.checksumPortion===b.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Te{constructor(m,b,S,P,N){this.value=m,this.startEnd=b,this.value=m,this.startEnd=b,this.resultPoints=new Array,this.resultPoints.push(new un(S,N)),this.resultPoints.push(new un(P,N))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(m){if(!(m instanceof Te))return!1;const b=m;return this.value===b.value}hashCode(){return this.value}}class Me{constructor(){}static getRSSvalue(m,b,S){let P=0;for(let te of m)P+=te;let N=0,V=0,$=m.length;for(let te=0;te<$-1;te++){let de;for(de=1,V|=1<<te;de<m[te];de++,V&=~(1<<te)){let Re=Me.combins(P-de-1,$-te-2);if(S&&V===0&&P-de-($-te-1)>=$-te-1&&(Re-=Me.combins(P-de-($-te),$-te-2)),$-te-1>1){let Fe=0;for(let Ge=P-de-($-te-2);Ge>b;Ge--)Fe+=Me.combins(P-de-Ge-1,$-te-3);Re-=Fe*($-1-te)}else P-de>b&&Re--;N+=Re}P-=de}return N}static combins(m,b){let S,P;m-b>b?(P=b,S=m-b):(P=m-b,S=b);let N=1,V=1;for(let $=m;$>S;$--)N*=$,V<=P&&(N/=V,V++);for(;V<=P;)N/=V,V++;return N}}class qe{static buildBitArray(m){let b=m.length*2-1;m[m.length-1].getRightChar()==null&&(b-=1);let S=12*b,P=new _e(S),N=0,$=m[0].getRightChar().getValue();for(let te=11;te>=0;--te)$&1<<te&&P.set(N),N++;for(let te=1;te<m.length;++te){let de=m[te],Re=de.getLeftChar().getValue();for(let Fe=11;Fe>=0;--Fe)Re&1<<Fe&&P.set(N),N++;if(de.getRightChar()!=null){let Fe=de.getRightChar().getValue();for(let Ge=11;Ge>=0;--Ge)Fe&1<<Ge&&P.set(N),N++}}return P}}class nt{constructor(m,b){b?this.decodedInformation=null:(this.finished=m,this.decodedInformation=b)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class rt{constructor(m){this.newPosition=m}getNewPosition(){return this.newPosition}}class ct extends rt{constructor(m,b){super(m),this.value=b}getValue(){return this.value}isFNC1(){return this.value===ct.FNC1}}ct.FNC1="$";class Tt extends rt{constructor(m,b,S){super(m),S?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=b}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class ut extends rt{constructor(m,b,S){if(super(m),b<0||b>10||S<0||S>10)throw new re;this.firstDigit=b,this.secondDigit=S}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===ut.FNC1}isSecondDigitFNC1(){return this.secondDigit===ut.FNC1}isAnyFNC1(){return this.firstDigit===ut.FNC1||this.secondDigit===ut.FNC1}}ut.FNC1=10;class ht{constructor(){}static parseFieldsInGeneralPurpose(m){if(!m)return null;if(m.length<2)throw new He;let b=m.substring(0,2);for(let N of ht.TWO_DIGIT_DATA_LENGTH)if(N[0]===b)return N[1]===ht.VARIABLE_LENGTH?ht.processVariableAI(2,N[2],m):ht.processFixedAI(2,N[1],m);if(m.length<3)throw new He;let S=m.substring(0,3);for(let N of ht.THREE_DIGIT_DATA_LENGTH)if(N[0]===S)return N[1]===ht.VARIABLE_LENGTH?ht.processVariableAI(3,N[2],m):ht.processFixedAI(3,N[1],m);for(let N of ht.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(N[0]===S)return N[1]===ht.VARIABLE_LENGTH?ht.processVariableAI(4,N[2],m):ht.processFixedAI(4,N[1],m);if(m.length<4)throw new He;let P=m.substring(0,4);for(let N of ht.FOUR_DIGIT_DATA_LENGTH)if(N[0]===P)return N[1]===ht.VARIABLE_LENGTH?ht.processVariableAI(4,N[2],m):ht.processFixedAI(4,N[1],m);throw new He}static processFixedAI(m,b,S){if(S.length<m)throw new He;let P=S.substring(0,m);if(S.length<m+b)throw new He;let N=S.substring(m,m+b),V=S.substring(m+b),$="("+P+")"+N,te=ht.parseFieldsInGeneralPurpose(V);return te==null?$:$+te}static processVariableAI(m,b,S){let P=S.substring(0,m),N;S.length<m+b?N=S.length:N=m+b;let V=S.substring(m,N),$=S.substring(N),te="("+P+")"+V,de=ht.parseFieldsInGeneralPurpose($);return de==null?te:te+de}}ht.VARIABLE_LENGTH=[],ht.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",ht.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",ht.VARIABLE_LENGTH,20],["22",ht.VARIABLE_LENGTH,29],["30",ht.VARIABLE_LENGTH,8],["37",ht.VARIABLE_LENGTH,8],["90",ht.VARIABLE_LENGTH,30],["91",ht.VARIABLE_LENGTH,30],["92",ht.VARIABLE_LENGTH,30],["93",ht.VARIABLE_LENGTH,30],["94",ht.VARIABLE_LENGTH,30],["95",ht.VARIABLE_LENGTH,30],["96",ht.VARIABLE_LENGTH,30],["97",ht.VARIABLE_LENGTH,3],["98",ht.VARIABLE_LENGTH,30],["99",ht.VARIABLE_LENGTH,30]],ht.THREE_DIGIT_DATA_LENGTH=[["240",ht.VARIABLE_LENGTH,30],["241",ht.VARIABLE_LENGTH,30],["242",ht.VARIABLE_LENGTH,6],["250",ht.VARIABLE_LENGTH,30],["251",ht.VARIABLE_LENGTH,30],["253",ht.VARIABLE_LENGTH,17],["254",ht.VARIABLE_LENGTH,20],["400",ht.VARIABLE_LENGTH,30],["401",ht.VARIABLE_LENGTH,30],["402",17],["403",ht.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",ht.VARIABLE_LENGTH,20],["421",ht.VARIABLE_LENGTH,15],["422",3],["423",ht.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],ht.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",ht.VARIABLE_LENGTH,15],["391",ht.VARIABLE_LENGTH,18],["392",ht.VARIABLE_LENGTH,15],["393",ht.VARIABLE_LENGTH,18],["703",ht.VARIABLE_LENGTH,30]],ht.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",ht.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",ht.VARIABLE_LENGTH,20],["8003",ht.VARIABLE_LENGTH,30],["8004",ht.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",ht.VARIABLE_LENGTH,30],["8008",ht.VARIABLE_LENGTH,12],["8018",18],["8020",ht.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",ht.VARIABLE_LENGTH,70],["8200",ht.VARIABLE_LENGTH,70]];class Dt{constructor(m){this.buffer=new ze,this.information=m}decodeAllCodes(m,b){let S=b,P=null;do{let N=this.decodeGeneralPurposeField(S,P),V=ht.parseFieldsInGeneralPurpose(N.getNewString());if(V!=null&&m.append(V),N.isRemaining()?P=""+N.getRemainingValue():P=null,S===N.getNewPosition())break;S=N.getNewPosition()}while(!0);return m.toString()}isStillNumeric(m){if(m+7>this.information.getSize())return m+4<=this.information.getSize();for(let b=m;b<m+3;++b)if(this.information.get(b))return!0;return this.information.get(m+3)}decodeNumeric(m){if(m+7>this.information.getSize()){let N=this.extractNumericValueFromBitArray(m,4);return N===0?new ut(this.information.getSize(),ut.FNC1,ut.FNC1):new ut(this.information.getSize(),N-1,ut.FNC1)}let b=this.extractNumericValueFromBitArray(m,7),S=(b-8)/11,P=(b-8)%11;return new ut(m+7,S,P)}extractNumericValueFromBitArray(m,b){return Dt.extractNumericValueFromBitArray(this.information,m,b)}static extractNumericValueFromBitArray(m,b,S){let P=0;for(let N=0;N<S;++N)m.get(b+N)&&(P|=1<<S-N-1);return P}decodeGeneralPurposeField(m,b){this.buffer.setLengthToZero(),b!=null&&this.buffer.append(b),this.current.setPosition(m);let S=this.parseBlocks();return S!=null&&S.isRemaining()?new Tt(this.current.getPosition(),this.buffer.toString(),S.getRemainingValue()):new Tt(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let m,b;do{let S=this.current.getPosition();if(this.current.isAlpha()?(b=this.parseAlphaBlock(),m=b.isFinished()):this.current.isIsoIec646()?(b=this.parseIsoIec646Block(),m=b.isFinished()):(b=this.parseNumericBlock(),m=b.isFinished()),!(S!==this.current.getPosition())&&!m)break}while(!m);return b.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let m=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(m.getNewPosition()),m.isFirstDigitFNC1()){let b;return m.isSecondDigitFNC1()?b=new Tt(this.current.getPosition(),this.buffer.toString()):b=new Tt(this.current.getPosition(),this.buffer.toString(),m.getSecondDigit()),new nt(!0,b)}if(this.buffer.append(m.getFirstDigit()),m.isSecondDigitFNC1()){let b=new Tt(this.current.getPosition(),this.buffer.toString());return new nt(!0,b)}this.buffer.append(m.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new nt(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let m=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(m.getNewPosition()),m.isFNC1()){let b=new Tt(this.current.getPosition(),this.buffer.toString());return new nt(!0,b)}this.buffer.append(m.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new nt(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let m=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(m.getNewPosition()),m.isFNC1()){let b=new Tt(this.current.getPosition(),this.buffer.toString());return new nt(!0,b)}this.buffer.append(m.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new nt(!1)}isStillIsoIec646(m){if(m+5>this.information.getSize())return!1;let b=this.extractNumericValueFromBitArray(m,5);if(b>=5&&b<16)return!0;if(m+7>this.information.getSize())return!1;let S=this.extractNumericValueFromBitArray(m,7);if(S>=64&&S<116)return!0;if(m+8>this.information.getSize())return!1;let P=this.extractNumericValueFromBitArray(m,8);return P>=232&&P<253}decodeIsoIec646(m){let b=this.extractNumericValueFromBitArray(m,5);if(b===15)return new ct(m+5,ct.FNC1);if(b>=5&&b<15)return new ct(m+5,"0"+(b-5));let S=this.extractNumericValueFromBitArray(m,7);if(S>=64&&S<90)return new ct(m+7,""+(S+1));if(S>=90&&S<116)return new ct(m+7,""+(S+7));let P=this.extractNumericValueFromBitArray(m,8),N;switch(P){case 232:N="!";break;case 233:N='"';break;case 234:N="%";break;case 235:N="&";break;case 236:N="'";break;case 237:N="(";break;case 238:N=")";break;case 239:N="*";break;case 240:N="+";break;case 241:N=",";break;case 242:N="-";break;case 243:N=".";break;case 244:N="/";break;case 245:N=":";break;case 246:N=";";break;case 247:N="<";break;case 248:N="=";break;case 249:N=">";break;case 250:N="?";break;case 251:N="_";break;case 252:N=" ";break;default:throw new re}return new ct(m+8,N)}isStillAlpha(m){if(m+5>this.information.getSize())return!1;let b=this.extractNumericValueFromBitArray(m,5);if(b>=5&&b<16)return!0;if(m+6>this.information.getSize())return!1;let S=this.extractNumericValueFromBitArray(m,6);return S>=16&&S<63}decodeAlphanumeric(m){let b=this.extractNumericValueFromBitArray(m,5);if(b===15)return new ct(m+5,ct.FNC1);if(b>=5&&b<15)return new ct(m+5,"0"+(b-5));let S=this.extractNumericValueFromBitArray(m,6);if(S>=32&&S<58)return new ct(m+6,""+(S+33));let P;switch(S){case 58:P="*";break;case 59:P=",";break;case 60:P="-";break;case 61:P=".";break;case 62:P="/";break;default:throw new Sr("Decoding invalid alphanumeric value: "+S)}return new ct(m+6,P)}isAlphaTo646ToAlphaLatch(m){if(m+1>this.information.getSize())return!1;for(let b=0;b<5&&b+m<this.information.getSize();++b)if(b===2){if(!this.information.get(m+2))return!1}else if(this.information.get(m+b))return!1;return!0}isAlphaOr646ToNumericLatch(m){if(m+3>this.information.getSize())return!1;for(let b=m;b<m+3;++b)if(this.information.get(b))return!1;return!0}isNumericToAlphaNumericLatch(m){if(m+1>this.information.getSize())return!1;for(let b=0;b<4&&b+m<this.information.getSize();++b)if(this.information.get(m+b))return!1;return!0}}class Mt{constructor(m){this.information=m,this.generalDecoder=new Dt(m)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Kt extends Mt{constructor(m){super(m)}encodeCompressedGtin(m,b){m.append("(01)");let S=m.length();m.append("9"),this.encodeCompressedGtinWithoutAI(m,b,S)}encodeCompressedGtinWithoutAI(m,b,S){for(let P=0;P<4;++P){let N=this.getGeneralDecoder().extractNumericValueFromBitArray(b+10*P,10);N/100===0&&m.append("0"),N/10===0&&m.append("0"),m.append(N)}Kt.appendCheckDigit(m,S)}static appendCheckDigit(m,b){let S=0;for(let P=0;P<13;P++){let N=m.charAt(P+b).charCodeAt(0)-48;S+=P&1?N:3*N}S=10-S%10,S===10&&(S=0),m.append(S)}}Kt.GTIN_SIZE=40;class hn extends Kt{constructor(m){super(m)}parseInformation(){let m=new ze;m.append("(01)");let b=m.length(),S=this.getGeneralDecoder().extractNumericValueFromBitArray(hn.HEADER_SIZE,4);return m.append(S),this.encodeCompressedGtinWithoutAI(m,hn.HEADER_SIZE+4,b),this.getGeneralDecoder().decodeAllCodes(m,hn.HEADER_SIZE+44)}}hn.HEADER_SIZE=4;class yn extends Mt{constructor(m){super(m)}parseInformation(){let m=new ze;return this.getGeneralDecoder().decodeAllCodes(m,yn.HEADER_SIZE)}}yn.HEADER_SIZE=5;class Jn extends Kt{constructor(m){super(m)}encodeCompressedWeight(m,b,S){let P=this.getGeneralDecoder().extractNumericValueFromBitArray(b,S);this.addWeightCode(m,P);let N=this.checkWeight(P),V=1e5;for(let $=0;$<5;++$)N/V===0&&m.append("0"),V/=10;m.append(N)}}class ir extends Jn{constructor(m){super(m)}parseInformation(){if(this.getInformation().getSize()!=ir.HEADER_SIZE+Jn.GTIN_SIZE+ir.WEIGHT_SIZE)throw new He;let m=new ze;return this.encodeCompressedGtin(m,ir.HEADER_SIZE),this.encodeCompressedWeight(m,ir.HEADER_SIZE+Jn.GTIN_SIZE,ir.WEIGHT_SIZE),m.toString()}}ir.HEADER_SIZE=5,ir.WEIGHT_SIZE=15;class xr extends ir{constructor(m){super(m)}addWeightCode(m,b){m.append("(3103)")}checkWeight(m){return m}}class vr extends ir{constructor(m){super(m)}addWeightCode(m,b){b<1e4?m.append("(3202)"):m.append("(3203)")}checkWeight(m){return m<1e4?m:m-1e4}}class ii extends Kt{constructor(m){super(m)}parseInformation(){if(this.getInformation().getSize()<ii.HEADER_SIZE+Kt.GTIN_SIZE)throw new He;let m=new ze;this.encodeCompressedGtin(m,ii.HEADER_SIZE);let b=this.getGeneralDecoder().extractNumericValueFromBitArray(ii.HEADER_SIZE+Kt.GTIN_SIZE,ii.LAST_DIGIT_SIZE);m.append("(392"),m.append(b),m.append(")");let S=this.getGeneralDecoder().decodeGeneralPurposeField(ii.HEADER_SIZE+Kt.GTIN_SIZE+ii.LAST_DIGIT_SIZE,null);return m.append(S.getNewString()),m.toString()}}ii.HEADER_SIZE=8,ii.LAST_DIGIT_SIZE=2;class si extends Kt{constructor(m){super(m)}parseInformation(){if(this.getInformation().getSize()<si.HEADER_SIZE+Kt.GTIN_SIZE)throw new He;let m=new ze;this.encodeCompressedGtin(m,si.HEADER_SIZE);let b=this.getGeneralDecoder().extractNumericValueFromBitArray(si.HEADER_SIZE+Kt.GTIN_SIZE,si.LAST_DIGIT_SIZE);m.append("(393"),m.append(b),m.append(")");let S=this.getGeneralDecoder().extractNumericValueFromBitArray(si.HEADER_SIZE+Kt.GTIN_SIZE+si.LAST_DIGIT_SIZE,si.FIRST_THREE_DIGITS_SIZE);S/100==0&&m.append("0"),S/10==0&&m.append("0"),m.append(S);let P=this.getGeneralDecoder().decodeGeneralPurposeField(si.HEADER_SIZE+Kt.GTIN_SIZE+si.LAST_DIGIT_SIZE+si.FIRST_THREE_DIGITS_SIZE,null);return m.append(P.getNewString()),m.toString()}}si.HEADER_SIZE=8,si.LAST_DIGIT_SIZE=2,si.FIRST_THREE_DIGITS_SIZE=10;class er extends Jn{constructor(m,b,S){super(m),this.dateCode=S,this.firstAIdigits=b}parseInformation(){if(this.getInformation().getSize()!=er.HEADER_SIZE+er.GTIN_SIZE+er.WEIGHT_SIZE+er.DATE_SIZE)throw new He;let m=new ze;return this.encodeCompressedGtin(m,er.HEADER_SIZE),this.encodeCompressedWeight(m,er.HEADER_SIZE+er.GTIN_SIZE,er.WEIGHT_SIZE),this.encodeCompressedDate(m,er.HEADER_SIZE+er.GTIN_SIZE+er.WEIGHT_SIZE),m.toString()}encodeCompressedDate(m,b){let S=this.getGeneralDecoder().extractNumericValueFromBitArray(b,er.DATE_SIZE);if(S==38400)return;m.append("("),m.append(this.dateCode),m.append(")");let P=S%32;S/=32;let N=S%12+1;S/=12;let V=S;V/10==0&&m.append("0"),m.append(V),N/10==0&&m.append("0"),m.append(N),P/10==0&&m.append("0"),m.append(P)}addWeightCode(m,b){m.append("("),m.append(this.firstAIdigits),m.append(b/1e5),m.append(")")}checkWeight(m){return m%1e5}}er.HEADER_SIZE=8,er.WEIGHT_SIZE=20,er.DATE_SIZE=16;function li(Ne){try{if(Ne.get(1))return new hn(Ne);if(!Ne.get(2))return new yn(Ne);switch(Dt.extractNumericValueFromBitArray(Ne,1,4)){case 4:return new xr(Ne);case 5:return new vr(Ne)}switch(Dt.extractNumericValueFromBitArray(Ne,1,5)){case 12:return new ii(Ne);case 13:return new si(Ne)}switch(Dt.extractNumericValueFromBitArray(Ne,1,7)){case 56:return new er(Ne,"310","11");case 57:return new er(Ne,"320","11");case 58:return new er(Ne,"310","13");case 59:return new er(Ne,"320","13");case 60:return new er(Ne,"310","15");case 61:return new er(Ne,"320","15");case 62:return new er(Ne,"310","17");case 63:return new er(Ne,"320","17")}}catch(m){throw console.log(m),new Sr("unknown decoder: "+Ne)}}class zr{constructor(m,b,S,P){this.leftchar=m,this.rightchar=b,this.finderpattern=S,this.maybeLast=P}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(m,b){return m instanceof zr?zr.equalsOrNull(m.leftchar,b.leftchar)&&zr.equalsOrNull(m.rightchar,b.rightchar)&&zr.equalsOrNull(m.finderpattern,b.finderpattern):!1}static equalsOrNull(m,b){return m===null?b===null:zr.equals(m,b)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class oi{constructor(m,b,S){this.pairs=m,this.rowNumber=b,this.wasReversed=S}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(m){return this.checkEqualitity(this,m)}toString(){return"{ "+this.pairs+" }"}equals(m,b){return m instanceof oi?this.checkEqualitity(m,b)&&m.wasReversed===b.wasReversed:!1}checkEqualitity(m,b){if(!m||!b)return;let S;return m.forEach((P,N)=>{b.forEach(V=>{P.getLeftChar().getValue()===V.getLeftChar().getValue()&&P.getRightChar().getValue()===V.getRightChar().getValue()&&P.getFinderPatter().getValue()===V.getFinderPatter().getValue()&&(S=!0)})}),S}}class an extends io{constructor(m){super(...arguments),this.pairs=new Array(an.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=m===!0}decodeRow(m,b,S){this.pairs.length=0,this.startFromEven=!1;try{return an.constructResult(this.decodeRow2pairs(m,b))}catch(P){this.verbose&&console.log(P)}return this.pairs.length=0,this.startFromEven=!0,an.constructResult(this.decodeRow2pairs(m,b))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(m,b){let S=!1;for(;!S;)try{this.pairs.push(this.retrieveNextPair(b,this.pairs,m))}catch(N){if(N instanceof He){if(!this.pairs.length)throw new He;S=!0}}if(this.checkChecksum())return this.pairs;let P;if(this.rows.length?P=!0:P=!1,this.storeRow(m,!1),P){let N=this.checkRowsBoolean(!1);if(N!=null||(N=this.checkRowsBoolean(!0),N!=null))return N}throw new He}checkRowsBoolean(m){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,m&&(this.rows=this.rows.reverse());let b=null;try{b=this.checkRows(new Array,0)}catch(S){this.verbose&&console.log(S)}return m&&(this.rows=this.rows.reverse()),b}checkRows(m,b){for(let S=b;S<this.rows.length;S++){let P=this.rows[S];this.pairs.length=0;for(let V of m)this.pairs.push(V.getPairs());if(this.pairs.push(P.getPairs()),!an.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let N=new Array(m);N.push(P);try{return this.checkRows(N,S+1)}catch(V){this.verbose&&console.log(V)}}throw new He}static isValidSequence(m){for(let b of an.FINDER_PATTERN_SEQUENCES){if(m.length>b.length)continue;let S=!0;for(let P=0;P<m.length;P++)if(m[P].getFinderPattern().getValue()!=b[P]){S=!1;break}if(S)return!0}return!1}storeRow(m,b){let S=0,P=!1,N=!1;for(;S<this.rows.length;){let V=this.rows[S];if(V.getRowNumber()>m){N=V.isEquivalent(this.pairs);break}P=V.isEquivalent(this.pairs),S++}N||P||an.isPartialRow(this.pairs,this.rows)||(this.rows.push(S,new oi(this.pairs,m,b)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(m,b){for(let S of b)if(S.getPairs().length!==m.length){for(let P of S.getPairs())for(let N of m)if(zr.equals(P,N))break}}static isPartialRow(m,b){for(let S of b){let P=!0;for(let N of m){let V=!1;for(let $ of S.getPairs())if(N.equals($)){V=!0;break}if(!V){P=!1;break}}if(P)return!0}return!1}getRows(){return this.rows}static constructResult(m){let b=qe.buildBitArray(m),P=li(b).parseInformation(),N=m[0].getFinderPattern().getResultPoints(),V=m[m.length-1].getFinderPattern().getResultPoints(),$=[N[0],N[1],V[0],V[1]];return new On(P,null,null,$,En.RSS_EXPANDED,null)}checkChecksum(){let m=this.pairs.get(0),b=m.getLeftChar(),S=m.getRightChar();if(S==null)return!1;let P=S.getChecksumPortion(),N=2;for(let $=1;$<this.pairs.size();++$){let te=this.pairs.get($);P+=te.getLeftChar().getChecksumPortion(),N++;let de=te.getRightChar();de!=null&&(P+=de.getChecksumPortion(),N++)}return P%=211,211*(N-4)+P==b.getValue()}static getNextSecondBar(m,b){let S;return m.get(b)?(S=m.getNextUnset(b),S=m.getNextSet(S)):(S=m.getNextSet(b),S=m.getNextUnset(S)),S}retrieveNextPair(m,b,S){let P=b.length%2==0;this.startFromEven&&(P=!P);let N,V=!0,$=-1;do this.findNextPair(m,b,$),N=this.parseFoundFinderPattern(m,S,P),N==null?$=an.getNextSecondBar(m,this.startEnd[0]):V=!1;while(V);let te=this.decodeDataCharacter(m,N,P,!0);if(!this.isEmptyPair(b)&&b[b.length-1].mustBeLast())throw new He;let de;try{de=this.decodeDataCharacter(m,N,P,!1)}catch(Re){de=null,this.verbose&&console.log(Re)}return new zr(te,de,N,!0)}isEmptyPair(m){return m.length===0}findNextPair(m,b,S){let P=this.getDecodeFinderCounters();P[0]=0,P[1]=0,P[2]=0,P[3]=0;let N=m.getSize(),V;S>=0?V=S:this.isEmptyPair(b)?V=0:V=b[b.length-1].getFinderPattern().getStartEnd()[1];let $=b.length%2!=0;this.startFromEven&&($=!$);let te=!1;for(;V<N&&(te=!m.get(V),!!te);)V++;let de=0,Re=V;for(let Fe=V;Fe<N;Fe++)if(m.get(Fe)!=te)P[de]++;else{if(de==3){if($&&an.reverseCounters(P),an.isFinderPattern(P)){this.startEnd[0]=Re,this.startEnd[1]=Fe;return}$&&an.reverseCounters(P),Re+=P[0]+P[1],P[0]=P[2],P[1]=P[3],P[2]=0,P[3]=0,de--}else de++;P[de]=1,te=!te}throw new He}static reverseCounters(m){let b=m.length;for(let S=0;S<b/2;++S){let P=m[S];m[S]=m[b-S-1],m[b-S-1]=P}}parseFoundFinderPattern(m,b,S){let P,N,V;if(S){let de=this.startEnd[0]-1;for(;de>=0&&!m.get(de);)de--;de++,P=this.startEnd[0]-de,N=de,V=this.startEnd[1]}else N=this.startEnd[0],V=m.getNextUnset(this.startEnd[1]+1),P=V-this.startEnd[1];let $=this.getDecodeFinderCounters();Z.arraycopy($,0,$,1,$.length-1),$[0]=P;let te;try{te=this.parseFinderValue($,an.FINDER_PATTERNS)}catch{return null}return new Te(te,[N,V],N,V,b)}decodeDataCharacter(m,b,S,P){let N=this.getDataCharacterCounters();for(let _s=0;_s<N.length;_s++)N[_s]=0;if(P)an.recordPatternInReverse(m,b.getStartEnd()[0],N);else{an.recordPattern(m,b.getStartEnd()[1],N);for(let _s=0,to=N.length-1;_s<to;_s++,to--){let Ta=N[_s];N[_s]=N[to],N[to]=Ta}}let V=17,$=jt.sum(new Int32Array(N))/V,te=(b.getStartEnd()[1]-b.getStartEnd()[0])/15;if(Math.abs($-te)/te>.3)throw new He;let de=this.getOddCounts(),Re=this.getEvenCounts(),Fe=this.getOddRoundingErrors(),Ge=this.getEvenRoundingErrors();for(let _s=0;_s<N.length;_s++){let to=1*N[_s]/$,Ta=to+.5;if(Ta<1){if(to<.3)throw new He;Ta=1}else if(Ta>8){if(to>8.7)throw new He;Ta=8}let Iu=_s/2;_s&1?(Re[Iu]=Ta,Ge[Iu]=to-Ta):(de[Iu]=Ta,Fe[Iu]=to-Ta)}this.adjustOddEvenCounts(V);let dt=4*b.getValue()+(S?0:2)+(P?0:1)-1,Ct=0,Pt=0;for(let _s=de.length-1;_s>=0;_s--){if(an.isNotA1left(b,S,P)){let to=an.WEIGHTS[dt][2*_s];Pt+=de[_s]*to}Ct+=de[_s]}let $t=0;for(let _s=Re.length-1;_s>=0;_s--)if(an.isNotA1left(b,S,P)){let to=an.WEIGHTS[dt][2*_s+1];$t+=Re[_s]*to}let tn=Pt+$t;if(Ct&1||Ct>13||Ct<4)throw new He;let Vn=(13-Ct)/2,zn=an.SYMBOL_WIDEST[Vn],Dn=9-zn,Pi=Me.getRSSvalue(de,zn,!0),Xr=Me.getRSSvalue(Re,Dn,!1),Sa=an.EVEN_TOTAL_SUBSET[Vn],Qa=an.GSUM[Vn],Zo=Pi*Sa+Xr+Qa;return new It(Zo,tn)}static isNotA1left(m,b,S){return!(m.getValue()==0&&b&&S)}adjustOddEvenCounts(m){let b=jt.sum(new Int32Array(this.getOddCounts())),S=jt.sum(new Int32Array(this.getEvenCounts())),P=!1,N=!1;b>13?N=!0:b<4&&(P=!0);let V=!1,$=!1;S>13?$=!0:S<4&&(V=!0);let te=b+S-m,de=(b&1)==1,Re=(S&1)==0;if(te==1)if(de){if(Re)throw new He;N=!0}else{if(!Re)throw new He;$=!0}else if(te==-1)if(de){if(Re)throw new He;P=!0}else{if(!Re)throw new He;V=!0}else if(te==0){if(de){if(!Re)throw new He;b<S?(P=!0,$=!0):(N=!0,V=!0)}else if(Re)throw new He}else throw new He;if(P){if(N)throw new He;an.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(N&&an.decrement(this.getOddCounts(),this.getOddRoundingErrors()),V){if($)throw new He;an.increment(this.getEvenCounts(),this.getOddRoundingErrors())}$&&an.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}an.SYMBOL_WIDEST=[7,5,4,3,1],an.EVEN_TOTAL_SUBSET=[4,20,52,104,204],an.GSUM=[0,348,1388,2948,3988],an.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],an.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],an.FINDER_PAT_A=0,an.FINDER_PAT_B=1,an.FINDER_PAT_C=2,an.FINDER_PAT_D=3,an.FINDER_PAT_E=4,an.FINDER_PAT_F=5,an.FINDER_PATTERN_SEQUENCES=[[an.FINDER_PAT_A,an.FINDER_PAT_A],[an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B],[an.FINDER_PAT_A,an.FINDER_PAT_C,an.FINDER_PAT_B,an.FINDER_PAT_D],[an.FINDER_PAT_A,an.FINDER_PAT_E,an.FINDER_PAT_B,an.FINDER_PAT_D,an.FINDER_PAT_C],[an.FINDER_PAT_A,an.FINDER_PAT_E,an.FINDER_PAT_B,an.FINDER_PAT_D,an.FINDER_PAT_D,an.FINDER_PAT_F],[an.FINDER_PAT_A,an.FINDER_PAT_E,an.FINDER_PAT_B,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_F,an.FINDER_PAT_F],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_D],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_E],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_F,an.FINDER_PAT_F],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_E,an.FINDER_PAT_F,an.FINDER_PAT_F]],an.MAX_PAIRS=11;class Bs extends It{constructor(m,b,S){super(m,b),this.count=0,this.finderPattern=S}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ci extends io{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(m,b,S){const P=this.decodePair(b,!1,m,S);ci.addOrTally(this.possibleLeftPairs,P),b.reverse();let N=this.decodePair(b,!0,m,S);ci.addOrTally(this.possibleRightPairs,N),b.reverse();for(let V of this.possibleLeftPairs)if(V.getCount()>1){for(let $ of this.possibleRightPairs)if($.getCount()>1&&ci.checkChecksum(V,$))return ci.constructResult(V,$)}throw new He}static addOrTally(m,b){if(b==null)return;let S=!1;for(let P of m)if(P.getValue()===b.getValue()){P.incrementCount(),S=!0;break}S||m.push(b)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(m,b){let S=4537077*m.getValue()+b.getValue(),P=new String(S).toString(),N=new ze;for(let de=13-P.length;de>0;de--)N.append("0");N.append(P);let V=0;for(let de=0;de<13;de++){let Re=N.charAt(de).charCodeAt(0)-48;V+=de&1?Re:3*Re}V=10-V%10,V===10&&(V=0),N.append(V.toString());let $=m.getFinderPattern().getResultPoints(),te=b.getFinderPattern().getResultPoints();return new On(N.toString(),null,0,[$[0],$[1],te[0],te[1]],En.RSS_14,new Date().getTime())}static checkChecksum(m,b){let S=(m.getChecksumPortion()+16*b.getChecksumPortion())%79,P=9*m.getFinderPattern().getValue()+b.getFinderPattern().getValue();return P>72&&P--,P>8&&P--,S===P}decodePair(m,b,S,P){try{let N=this.findFinderPattern(m,b),V=this.parseFoundFinderPattern(m,S,b,N),$=P==null?null:P.get(Ae.NEED_RESULT_POINT_CALLBACK);if($!=null){let Re=(N[0]+N[1])/2;b&&(Re=m.getSize()-1-Re),$.foundPossibleResultPoint(new un(Re,S))}let te=this.decodeDataCharacter(m,V,!0),de=this.decodeDataCharacter(m,V,!1);return new Bs(1597*te.getValue()+de.getValue(),te.getChecksumPortion()+4*de.getChecksumPortion(),V)}catch{return null}}decodeDataCharacter(m,b,S){let P=this.getDataCharacterCounters();for(let $t=0;$t<P.length;$t++)P[$t]=0;if(S)pi.recordPatternInReverse(m,b.getStartEnd()[0],P);else{pi.recordPattern(m,b.getStartEnd()[1]+1,P);for(let $t=0,tn=P.length-1;$t<tn;$t++,tn--){let Vn=P[$t];P[$t]=P[tn],P[tn]=Vn}}let N=S?16:15,V=jt.sum(new Int32Array(P))/N,$=this.getOddCounts(),te=this.getEvenCounts(),de=this.getOddRoundingErrors(),Re=this.getEvenRoundingErrors();for(let $t=0;$t<P.length;$t++){let tn=P[$t]/V,Vn=Math.floor(tn+.5);Vn<1?Vn=1:Vn>8&&(Vn=8);let zn=Math.floor($t/2);$t&1?(te[zn]=Vn,Re[zn]=tn-Vn):($[zn]=Vn,de[zn]=tn-Vn)}this.adjustOddEvenCounts(S,N);let Fe=0,Ge=0;for(let $t=$.length-1;$t>=0;$t--)Ge*=9,Ge+=$[$t],Fe+=$[$t];let dt=0,Ct=0;for(let $t=te.length-1;$t>=0;$t--)dt*=9,dt+=te[$t],Ct+=te[$t];let Pt=Ge+3*dt;if(S){if(Fe&1||Fe>12||Fe<4)throw new He;let $t=(12-Fe)/2,tn=ci.OUTSIDE_ODD_WIDEST[$t],Vn=9-tn,zn=Me.getRSSvalue($,tn,!1),Dn=Me.getRSSvalue(te,Vn,!0),Pi=ci.OUTSIDE_EVEN_TOTAL_SUBSET[$t],Xr=ci.OUTSIDE_GSUM[$t];return new It(zn*Pi+Dn+Xr,Pt)}else{if(Ct&1||Ct>10||Ct<4)throw new He;let $t=(10-Ct)/2,tn=ci.INSIDE_ODD_WIDEST[$t],Vn=9-tn,zn=Me.getRSSvalue($,tn,!0),Dn=Me.getRSSvalue(te,Vn,!1),Pi=ci.INSIDE_ODD_TOTAL_SUBSET[$t],Xr=ci.INSIDE_GSUM[$t];return new It(Dn*Pi+zn+Xr,Pt)}}findFinderPattern(m,b){let S=this.getDecodeFinderCounters();S[0]=0,S[1]=0,S[2]=0,S[3]=0;let P=m.getSize(),N=!1,V=0;for(;V<P&&(N=!m.get(V),b!==N);)V++;let $=0,te=V;for(let de=V;de<P;de++)if(m.get(de)!==N)S[$]++;else{if($===3){if(io.isFinderPattern(S))return[te,de];te+=S[0]+S[1],S[0]=S[2],S[1]=S[3],S[2]=0,S[3]=0,$--}else $++;S[$]=1,N=!N}throw new He}parseFoundFinderPattern(m,b,S,P){let N=m.get(P[0]),V=P[0]-1;for(;V>=0&&N!==m.get(V);)V--;V++;const $=P[0]-V,te=this.getDecodeFinderCounters(),de=new Int32Array(te.length);Z.arraycopy(te,0,de,1,te.length-1),de[0]=$;const Re=this.parseFinderValue(de,ci.FINDER_PATTERNS);let Fe=V,Ge=P[1];return S&&(Fe=m.getSize()-1-Fe,Ge=m.getSize()-1-Ge),new Te(Re,[V,P[1]],Fe,Ge,b)}adjustOddEvenCounts(m,b){let S=jt.sum(new Int32Array(this.getOddCounts())),P=jt.sum(new Int32Array(this.getEvenCounts())),N=!1,V=!1,$=!1,te=!1;m?(S>12?V=!0:S<4&&(N=!0),P>12?te=!0:P<4&&($=!0)):(S>11?V=!0:S<5&&(N=!0),P>10?te=!0:P<4&&($=!0));let de=S+P-b,Re=(S&1)===(m?1:0),Fe=(P&1)===1;if(de===1)if(Re){if(Fe)throw new He;V=!0}else{if(!Fe)throw new He;te=!0}else if(de===-1)if(Re){if(Fe)throw new He;N=!0}else{if(!Fe)throw new He;$=!0}else if(de===0){if(Re){if(!Fe)throw new He;S<P?(N=!0,te=!0):(V=!0,$=!0)}else if(Fe)throw new He}else throw new He;if(N){if(V)throw new He;io.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(V&&io.decrement(this.getOddCounts(),this.getOddRoundingErrors()),$){if(te)throw new He;io.increment(this.getEvenCounts(),this.getOddRoundingErrors())}te&&io.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ci.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ci.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ci.OUTSIDE_GSUM=[0,161,961,2015,2715],ci.INSIDE_GSUM=[0,336,1036,1516],ci.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ci.INSIDE_ODD_WIDEST=[2,4,6,8],ci.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class xo extends pi{constructor(m,b){super(),this.readers=[],this.verbose=b===!0;const S=m?m.get(Ae.POSSIBLE_FORMATS):null,P=m&&m.get(Ae.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;S?((S.includes(En.EAN_13)||S.includes(En.UPC_A)||S.includes(En.EAN_8)||S.includes(En.UPC_E))&&this.readers.push(new sc(m)),S.includes(En.CODE_39)&&this.readers.push(new Rr(P)),S.includes(En.CODE_128)&&this.readers.push(new rn),S.includes(En.ITF)&&this.readers.push(new $r),S.includes(En.RSS_14)&&this.readers.push(new ci),S.includes(En.RSS_EXPANDED)&&this.readers.push(new an(this.verbose))):(this.readers.push(new sc(m)),this.readers.push(new Rr),this.readers.push(new sc(m)),this.readers.push(new rn),this.readers.push(new $r),this.readers.push(new ci),this.readers.push(new an(this.verbose)))}decodeRow(m,b,S){for(let P=0;P<this.readers.length;P++)try{return this.readers[P].decodeRow(m,b,S)}catch{}throw new He}reset(){this.readers.forEach(m=>m.reset())}}class Xo extends Xt{constructor(m=500,b){super(new xo(b),m,b)}}class qr{constructor(m,b,S){this.ecCodewords=m,this.ecBlocks=[b],S&&this.ecBlocks.push(S)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class Gr{constructor(m,b){this.count=m,this.dataCodewords=b}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Ti{constructor(m,b,S,P,N,V){this.versionNumber=m,this.symbolSizeRows=b,this.symbolSizeColumns=S,this.dataRegionSizeRows=P,this.dataRegionSizeColumns=N,this.ecBlocks=V;let $=0;const te=V.getECCodewords(),de=V.getECBlocks();for(let Re of de)$+=Re.getCount()*(Re.getDataCodewords()+te);this.totalCodewords=$}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(m,b){if(m&1||b&1)throw new re;for(let S of Ti.VERSIONS)if(S.symbolSizeRows===m&&S.symbolSizeColumns===b)return S;throw new re}toString(){return""+this.versionNumber}static buildVersions(){return[new Ti(1,10,10,8,8,new qr(5,new Gr(1,3))),new Ti(2,12,12,10,10,new qr(7,new Gr(1,5))),new Ti(3,14,14,12,12,new qr(10,new Gr(1,8))),new Ti(4,16,16,14,14,new qr(12,new Gr(1,12))),new Ti(5,18,18,16,16,new qr(14,new Gr(1,18))),new Ti(6,20,20,18,18,new qr(18,new Gr(1,22))),new Ti(7,22,22,20,20,new qr(20,new Gr(1,30))),new Ti(8,24,24,22,22,new qr(24,new Gr(1,36))),new Ti(9,26,26,24,24,new qr(28,new Gr(1,44))),new Ti(10,32,32,14,14,new qr(36,new Gr(1,62))),new Ti(11,36,36,16,16,new qr(42,new Gr(1,86))),new Ti(12,40,40,18,18,new qr(48,new Gr(1,114))),new Ti(13,44,44,20,20,new qr(56,new Gr(1,144))),new Ti(14,48,48,22,22,new qr(68,new Gr(1,174))),new Ti(15,52,52,24,24,new qr(42,new Gr(2,102))),new Ti(16,64,64,14,14,new qr(56,new Gr(2,140))),new Ti(17,72,72,16,16,new qr(36,new Gr(4,92))),new Ti(18,80,80,18,18,new qr(48,new Gr(4,114))),new Ti(19,88,88,20,20,new qr(56,new Gr(4,144))),new Ti(20,96,96,22,22,new qr(68,new Gr(4,174))),new Ti(21,104,104,24,24,new qr(56,new Gr(6,136))),new Ti(22,120,120,18,18,new qr(68,new Gr(6,175))),new Ti(23,132,132,20,20,new qr(62,new Gr(8,163))),new Ti(24,144,144,22,22,new qr(62,new Gr(8,156),new Gr(2,155))),new Ti(25,8,18,6,16,new qr(7,new Gr(1,5))),new Ti(26,8,32,6,14,new qr(11,new Gr(1,10))),new Ti(27,12,26,10,24,new qr(14,new Gr(1,16))),new Ti(28,12,36,10,16,new qr(18,new Gr(1,22))),new Ti(29,16,36,14,16,new qr(24,new Gr(1,32))),new Ti(30,16,48,14,22,new qr(28,new Gr(1,49)))]}}Ti.VERSIONS=Ti.buildVersions();class Ko{constructor(m){const b=m.getHeight();if(b<8||b>144||b&1)throw new re;this.version=Ko.readVersion(m),this.mappingBitMatrix=this.extractDataRegion(m),this.readMappingMatrix=new ft(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(m){const b=m.getHeight(),S=m.getWidth();return Ti.getVersionForDimensions(b,S)}readCodewords(){const m=new Int8Array(this.version.getTotalCodewords());let b=0,S=4,P=0;const N=this.mappingBitMatrix.getHeight(),V=this.mappingBitMatrix.getWidth();let $=!1,te=!1,de=!1,Re=!1;do if(S===N&&P===0&&!$)m[b++]=this.readCorner1(N,V)&255,S-=2,P+=2,$=!0;else if(S===N-2&&P===0&&V&3&&!te)m[b++]=this.readCorner2(N,V)&255,S-=2,P+=2,te=!0;else if(S===N+4&&P===2&&!(V&7)&&!de)m[b++]=this.readCorner3(N,V)&255,S-=2,P+=2,de=!0;else if(S===N-2&&P===0&&(V&7)===4&&!Re)m[b++]=this.readCorner4(N,V)&255,S-=2,P+=2,Re=!0;else{do S<N&&P>=0&&!this.readMappingMatrix.get(P,S)&&(m[b++]=this.readUtah(S,P,N,V)&255),S-=2,P+=2;while(S>=0&&P<V);S+=1,P+=3;do S>=0&&P<V&&!this.readMappingMatrix.get(P,S)&&(m[b++]=this.readUtah(S,P,N,V)&255),S+=2,P-=2;while(S<N&&P>=0);S+=3,P+=1}while(S<N||P<V);if(b!==this.version.getTotalCodewords())throw new re;return m}readModule(m,b,S,P){return m<0&&(m+=S,b+=4-(S+4&7)),b<0&&(b+=P,m+=4-(P+4&7)),this.readMappingMatrix.set(b,m),this.mappingBitMatrix.get(b,m)}readUtah(m,b,S,P){let N=0;return this.readModule(m-2,b-2,S,P)&&(N|=1),N<<=1,this.readModule(m-2,b-1,S,P)&&(N|=1),N<<=1,this.readModule(m-1,b-2,S,P)&&(N|=1),N<<=1,this.readModule(m-1,b-1,S,P)&&(N|=1),N<<=1,this.readModule(m-1,b,S,P)&&(N|=1),N<<=1,this.readModule(m,b-2,S,P)&&(N|=1),N<<=1,this.readModule(m,b-1,S,P)&&(N|=1),N<<=1,this.readModule(m,b,S,P)&&(N|=1),N}readCorner1(m,b){let S=0;return this.readModule(m-1,0,m,b)&&(S|=1),S<<=1,this.readModule(m-1,1,m,b)&&(S|=1),S<<=1,this.readModule(m-1,2,m,b)&&(S|=1),S<<=1,this.readModule(0,b-2,m,b)&&(S|=1),S<<=1,this.readModule(0,b-1,m,b)&&(S|=1),S<<=1,this.readModule(1,b-1,m,b)&&(S|=1),S<<=1,this.readModule(2,b-1,m,b)&&(S|=1),S<<=1,this.readModule(3,b-1,m,b)&&(S|=1),S}readCorner2(m,b){let S=0;return this.readModule(m-3,0,m,b)&&(S|=1),S<<=1,this.readModule(m-2,0,m,b)&&(S|=1),S<<=1,this.readModule(m-1,0,m,b)&&(S|=1),S<<=1,this.readModule(0,b-4,m,b)&&(S|=1),S<<=1,this.readModule(0,b-3,m,b)&&(S|=1),S<<=1,this.readModule(0,b-2,m,b)&&(S|=1),S<<=1,this.readModule(0,b-1,m,b)&&(S|=1),S<<=1,this.readModule(1,b-1,m,b)&&(S|=1),S}readCorner3(m,b){let S=0;return this.readModule(m-1,0,m,b)&&(S|=1),S<<=1,this.readModule(m-1,b-1,m,b)&&(S|=1),S<<=1,this.readModule(0,b-3,m,b)&&(S|=1),S<<=1,this.readModule(0,b-2,m,b)&&(S|=1),S<<=1,this.readModule(0,b-1,m,b)&&(S|=1),S<<=1,this.readModule(1,b-3,m,b)&&(S|=1),S<<=1,this.readModule(1,b-2,m,b)&&(S|=1),S<<=1,this.readModule(1,b-1,m,b)&&(S|=1),S}readCorner4(m,b){let S=0;return this.readModule(m-3,0,m,b)&&(S|=1),S<<=1,this.readModule(m-2,0,m,b)&&(S|=1),S<<=1,this.readModule(m-1,0,m,b)&&(S|=1),S<<=1,this.readModule(0,b-2,m,b)&&(S|=1),S<<=1,this.readModule(0,b-1,m,b)&&(S|=1),S<<=1,this.readModule(1,b-1,m,b)&&(S|=1),S<<=1,this.readModule(2,b-1,m,b)&&(S|=1),S<<=1,this.readModule(3,b-1,m,b)&&(S|=1),S}extractDataRegion(m){const b=this.version.getSymbolSizeRows(),S=this.version.getSymbolSizeColumns();if(m.getHeight()!==b)throw new F("Dimension of bitMatrix must match the version size");const P=this.version.getDataRegionSizeRows(),N=this.version.getDataRegionSizeColumns(),V=b/P|0,$=S/N|0,te=V*P,de=$*N,Re=new ft(de,te);for(let Fe=0;Fe<V;++Fe){const Ge=Fe*P;for(let dt=0;dt<$;++dt){const Ct=dt*N;for(let Pt=0;Pt<P;++Pt){const $t=Fe*(P+2)+1+Pt,tn=Ge+Pt;for(let Vn=0;Vn<N;++Vn){const zn=dt*(N+2)+1+Vn;if(m.get(zn,$t)){const Dn=Ct+Vn;Re.set(Dn,tn)}}}}}return Re}}class xa{constructor(m,b){this.numDataCodewords=m,this.codewords=b}static getDataBlocks(m,b){const S=b.getECBlocks();let P=0;const N=S.getECBlocks();for(let Pt of N)P+=Pt.getCount();const V=new Array(P);let $=0;for(let Pt of N)for(let $t=0;$t<Pt.getCount();$t++){const tn=Pt.getDataCodewords(),Vn=S.getECCodewords()+tn;V[$++]=new xa(tn,new Uint8Array(Vn))}const de=V[0].codewords.length-S.getECCodewords(),Re=de-1;let Fe=0;for(let Pt=0;Pt<Re;Pt++)for(let $t=0;$t<$;$t++)V[$t].codewords[Pt]=m[Fe++];const Ge=b.getVersionNumber()===24,dt=Ge?8:$;for(let Pt=0;Pt<dt;Pt++)V[Pt].codewords[de-1]=m[Fe++];const Ct=V[0].codewords.length;for(let Pt=de;Pt<Ct;Pt++)for(let $t=0;$t<$;$t++){const tn=Ge?($t+8)%$:$t,Vn=Ge&&tn>7?Pt-1:Pt;V[tn].codewords[Vn]=m[Fe++]}if(Fe!==m.length)throw new F;return V}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Eu{constructor(m){this.bytes=m,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(m){if(m<1||m>32||m>this.available())throw new F(""+m);let b=0,S=this.bitOffset,P=this.byteOffset;const N=this.bytes;if(S>0){const V=8-S,$=m<V?m:V,te=V-$,de=255>>8-$<<te;b=(N[P]&de)>>te,m-=$,S+=$,S===8&&(S=0,P++)}if(m>0){for(;m>=8;)b=b<<8|N[P]&255,P++,m-=8;if(m>0){const V=8-m,$=255>>V<<V;b=b<<m|(N[P]&$)>>V,S+=m}}return this.bitOffset=S,this.byteOffset=P,b}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var $s;(function(Ne){Ne[Ne.PAD_ENCODE=0]="PAD_ENCODE",Ne[Ne.ASCII_ENCODE=1]="ASCII_ENCODE",Ne[Ne.C40_ENCODE=2]="C40_ENCODE",Ne[Ne.TEXT_ENCODE=3]="TEXT_ENCODE",Ne[Ne.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",Ne[Ne.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",Ne[Ne.BASE256_ENCODE=6]="BASE256_ENCODE"})($s||($s={}));class Ka{static decode(m){const b=new Eu(m),S=new ze,P=new ze,N=new Array;let V=$s.ASCII_ENCODE;do if(V===$s.ASCII_ENCODE)V=this.decodeAsciiSegment(b,S,P);else{switch(V){case $s.C40_ENCODE:this.decodeC40Segment(b,S);break;case $s.TEXT_ENCODE:this.decodeTextSegment(b,S);break;case $s.ANSIX12_ENCODE:this.decodeAnsiX12Segment(b,S);break;case $s.EDIFACT_ENCODE:this.decodeEdifactSegment(b,S);break;case $s.BASE256_ENCODE:this.decodeBase256Segment(b,S,N);break;default:throw new re}V=$s.ASCII_ENCODE}while(V!==$s.PAD_ENCODE&&b.available()>0);return P.length()>0&&S.append(P.toString()),new br(m,S.toString(),N.length===0?null:N,null)}static decodeAsciiSegment(m,b,S){let P=!1;do{let N=m.readBits(8);if(N===0)throw new re;if(N<=128)return P&&(N+=128),b.append(String.fromCharCode(N-1)),$s.ASCII_ENCODE;if(N===129)return $s.PAD_ENCODE;if(N<=229){const V=N-130;V<10&&b.append("0"),b.append(""+V)}else switch(N){case 230:return $s.C40_ENCODE;case 231:return $s.BASE256_ENCODE;case 232:b.append("");break;case 233:case 234:break;case 235:P=!0;break;case 236:b.append("[)>05"),S.insert(0,"");break;case 237:b.append("[)>06"),S.insert(0,"");break;case 238:return $s.ANSIX12_ENCODE;case 239:return $s.TEXT_ENCODE;case 240:return $s.EDIFACT_ENCODE;case 241:break;default:if(N!==254||m.available()!==0)throw new re;break}}while(m.available()>0);return $s.ASCII_ENCODE}static decodeC40Segment(m,b){let S=!1;const P=[];let N=0;do{if(m.available()===8)return;const V=m.readBits(8);if(V===254)return;this.parseTwoBytes(V,m.readBits(8),P);for(let $=0;$<3;$++){const te=P[$];switch(N){case 0:if(te<3)N=te+1;else if(te<this.C40_BASIC_SET_CHARS.length){const de=this.C40_BASIC_SET_CHARS[te];S?(b.append(String.fromCharCode(de.charCodeAt(0)+128)),S=!1):b.append(de)}else throw new re;break;case 1:S?(b.append(String.fromCharCode(te+128)),S=!1):b.append(String.fromCharCode(te)),N=0;break;case 2:if(te<this.C40_SHIFT2_SET_CHARS.length){const de=this.C40_SHIFT2_SET_CHARS[te];S?(b.append(String.fromCharCode(de.charCodeAt(0)+128)),S=!1):b.append(de)}else switch(te){case 27:b.append("");break;case 30:S=!0;break;default:throw new re}N=0;break;case 3:S?(b.append(String.fromCharCode(te+224)),S=!1):b.append(String.fromCharCode(te+96)),N=0;break;default:throw new re}}}while(m.available()>0)}static decodeTextSegment(m,b){let S=!1,P=[],N=0;do{if(m.available()===8)return;const V=m.readBits(8);if(V===254)return;this.parseTwoBytes(V,m.readBits(8),P);for(let $=0;$<3;$++){const te=P[$];switch(N){case 0:if(te<3)N=te+1;else if(te<this.TEXT_BASIC_SET_CHARS.length){const de=this.TEXT_BASIC_SET_CHARS[te];S?(b.append(String.fromCharCode(de.charCodeAt(0)+128)),S=!1):b.append(de)}else throw new re;break;case 1:S?(b.append(String.fromCharCode(te+128)),S=!1):b.append(String.fromCharCode(te)),N=0;break;case 2:if(te<this.TEXT_SHIFT2_SET_CHARS.length){const de=this.TEXT_SHIFT2_SET_CHARS[te];S?(b.append(String.fromCharCode(de.charCodeAt(0)+128)),S=!1):b.append(de)}else switch(te){case 27:b.append("");break;case 30:S=!0;break;default:throw new re}N=0;break;case 3:if(te<this.TEXT_SHIFT3_SET_CHARS.length){const de=this.TEXT_SHIFT3_SET_CHARS[te];S?(b.append(String.fromCharCode(de.charCodeAt(0)+128)),S=!1):b.append(de),N=0}else throw new re;break;default:throw new re}}}while(m.available()>0)}static decodeAnsiX12Segment(m,b){const S=[];do{if(m.available()===8)return;const P=m.readBits(8);if(P===254)return;this.parseTwoBytes(P,m.readBits(8),S);for(let N=0;N<3;N++){const V=S[N];switch(V){case 0:b.append("\r");break;case 1:b.append("*");break;case 2:b.append(">");break;case 3:b.append(" ");break;default:if(V<14)b.append(String.fromCharCode(V+44));else if(V<40)b.append(String.fromCharCode(V+51));else throw new re;break}}}while(m.available()>0)}static parseTwoBytes(m,b,S){let P=(m<<8)+b-1,N=Math.floor(P/1600);S[0]=N,P-=N*1600,N=Math.floor(P/40),S[1]=N,S[2]=P-N*40}static decodeEdifactSegment(m,b){do{if(m.available()<=16)return;for(let S=0;S<4;S++){let P=m.readBits(6);if(P===31){const N=8-m.getBitOffset();N!==8&&m.readBits(N);return}P&32||(P|=64),b.append(String.fromCharCode(P))}}while(m.available()>0)}static decodeBase256Segment(m,b,S){let P=1+m.getByteOffset();const N=this.unrandomize255State(m.readBits(8),P++);let V;if(N===0?V=m.available()/8|0:N<250?V=N:V=250*(N-249)+this.unrandomize255State(m.readBits(8),P++),V<0)throw new re;const $=new Uint8Array(V);for(let te=0;te<V;te++){if(m.available()<8)throw new re;$[te]=this.unrandomize255State(m.readBits(8),P++)}S.push($);try{b.append(Ie.decode($,Oe.ISO88591))}catch(te){throw new Sr("Platform does not support required encoding: "+te.message)}}static unrandomize255State(m,b){const S=149*b%255+1,P=m-S;return P>=0?P:P+256}}Ka.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Ka.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Ka.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Ka.TEXT_SHIFT2_SET_CHARS=Ka.C40_SHIFT2_SET_CHARS,Ka.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class Su{constructor(){this.rsDecoder=new fi(Yn.DATA_MATRIX_FIELD_256)}decode(m){const b=new Ko(m),S=b.getVersion(),P=b.readCodewords(),N=xa.getDataBlocks(P,S);let V=0;for(let de of N)V+=de.getNumDataCodewords();const $=new Uint8Array(V),te=N.length;for(let de=0;de<te;de++){const Re=N[de],Fe=Re.getCodewords(),Ge=Re.getNumDataCodewords();this.correctErrors(Fe,Ge);for(let dt=0;dt<Ge;dt++)$[dt*te+de]=Fe[dt]}return Ka.decode($)}correctErrors(m,b){const S=new Int32Array(m);try{this.rsDecoder.decode(S,m.length-b)}catch{throw new K}for(let P=0;P<b;P++)m[P]=S[P]}}class zs{constructor(m){this.image=m,this.rectangleDetector=new Bn(this.image)}detect(){const m=this.rectangleDetector.detect();let b=this.detectSolid1(m);if(b=this.detectSolid2(b),b[3]=this.correctTopRight(b),!b[3])throw new He;b=this.shiftToModuleCenter(b);const S=b[0],P=b[1],N=b[2],V=b[3];let $=this.transitionsBetween(S,V)+1,te=this.transitionsBetween(N,V)+1;($&1)===1&&($+=1),(te&1)===1&&(te+=1),4*$<7*te&&4*te<7*$&&($=te=Math.max($,te));let de=zs.sampleGrid(this.image,S,P,N,V,$,te);return new Xn(de,[S,P,N,V])}static shiftPoint(m,b,S){let P=(b.getX()-m.getX())/(S+1),N=(b.getY()-m.getY())/(S+1);return new un(m.getX()+P,m.getY()+N)}static moveAway(m,b,S){let P=m.getX(),N=m.getY();return P<b?P-=1:P+=1,N<S?N-=1:N+=1,new un(P,N)}detectSolid1(m){let b=m[0],S=m[1],P=m[3],N=m[2],V=this.transitionsBetween(b,S),$=this.transitionsBetween(S,P),te=this.transitionsBetween(P,N),de=this.transitionsBetween(N,b),Re=V,Fe=[N,b,S,P];return Re>$&&(Re=$,Fe[0]=b,Fe[1]=S,Fe[2]=P,Fe[3]=N),Re>te&&(Re=te,Fe[0]=S,Fe[1]=P,Fe[2]=N,Fe[3]=b),Re>de&&(Fe[0]=P,Fe[1]=N,Fe[2]=b,Fe[3]=S),Fe}detectSolid2(m){let b=m[0],S=m[1],P=m[2],N=m[3],V=this.transitionsBetween(b,N),$=zs.shiftPoint(S,P,(V+1)*4),te=zs.shiftPoint(P,S,(V+1)*4),de=this.transitionsBetween($,b),Re=this.transitionsBetween(te,N);return de<Re?(m[0]=b,m[1]=S,m[2]=P,m[3]=N):(m[0]=S,m[1]=P,m[2]=N,m[3]=b),m}correctTopRight(m){let b=m[0],S=m[1],P=m[2],N=m[3],V=this.transitionsBetween(b,N),$=this.transitionsBetween(S,N),te=zs.shiftPoint(b,S,($+1)*4),de=zs.shiftPoint(P,S,(V+1)*4);V=this.transitionsBetween(te,N),$=this.transitionsBetween(de,N);let Re=new un(N.getX()+(P.getX()-S.getX())/(V+1),N.getY()+(P.getY()-S.getY())/(V+1)),Fe=new un(N.getX()+(b.getX()-S.getX())/($+1),N.getY()+(b.getY()-S.getY())/($+1));if(!this.isValid(Re))return this.isValid(Fe)?Fe:null;if(!this.isValid(Fe))return Re;let Ge=this.transitionsBetween(te,Re)+this.transitionsBetween(de,Re),dt=this.transitionsBetween(te,Fe)+this.transitionsBetween(de,Fe);return Ge>dt?Re:Fe}shiftToModuleCenter(m){let b=m[0],S=m[1],P=m[2],N=m[3],V=this.transitionsBetween(b,N)+1,$=this.transitionsBetween(P,N)+1,te=zs.shiftPoint(b,S,$*4),de=zs.shiftPoint(P,S,V*4);V=this.transitionsBetween(te,N)+1,$=this.transitionsBetween(de,N)+1,(V&1)===1&&(V+=1),($&1)===1&&($+=1);let Re=(b.getX()+S.getX()+P.getX()+N.getX())/4,Fe=(b.getY()+S.getY()+P.getY()+N.getY())/4;b=zs.moveAway(b,Re,Fe),S=zs.moveAway(S,Re,Fe),P=zs.moveAway(P,Re,Fe),N=zs.moveAway(N,Re,Fe);let Ge,dt;return te=zs.shiftPoint(b,S,$*4),te=zs.shiftPoint(te,N,V*4),Ge=zs.shiftPoint(S,b,$*4),Ge=zs.shiftPoint(Ge,P,V*4),de=zs.shiftPoint(P,N,$*4),de=zs.shiftPoint(de,S,V*4),dt=zs.shiftPoint(N,P,$*4),dt=zs.shiftPoint(dt,b,V*4),[te,Ge,de,dt]}isValid(m){return m.getX()>=0&&m.getX()<this.image.getWidth()&&m.getY()>0&&m.getY()<this.image.getHeight()}static sampleGrid(m,b,S,P,N,V,$){return Oi.getInstance().sampleGrid(m,V,$,.5,.5,V-.5,.5,V-.5,$-.5,.5,$-.5,b.getX(),b.getY(),N.getX(),N.getY(),P.getX(),P.getY(),S.getX(),S.getY())}transitionsBetween(m,b){let S=Math.trunc(m.getX()),P=Math.trunc(m.getY()),N=Math.trunc(b.getX()),V=Math.trunc(b.getY()),$=Math.abs(V-P)>Math.abs(N-S);if($){let Pt=S;S=P,P=Pt,Pt=N,N=V,V=Pt}let te=Math.abs(N-S),de=Math.abs(V-P),Re=-te/2,Fe=P<V?1:-1,Ge=S<N?1:-1,dt=0,Ct=this.image.get($?P:S,$?S:P);for(let Pt=S,$t=P;Pt!==N;Pt+=Ge){let tn=this.image.get($?$t:Pt,$?Pt:$t);if(tn!==Ct&&(dt++,Ct=tn),Re+=de,Re>0){if($t===V)break;$t+=Fe,Re-=te}}return dt}}class Ml{constructor(){this.decoder=new Su}decode(m,b=null){let S,P;if(b!=null&&b.has(Ae.PURE_BARCODE)){const de=Ml.extractPureBits(m.getBlackMatrix());S=this.decoder.decode(de),P=Ml.NO_POINTS}else{const de=new zs(m.getBlackMatrix()).detect();S=this.decoder.decode(de.getBits()),P=de.getPoints()}const N=S.getRawBytes(),V=new On(S.getText(),N,8*N.length,P,En.DATA_MATRIX,Z.currentTimeMillis()),$=S.getByteSegments();$!=null&&V.putMetadata(ur.BYTE_SEGMENTS,$);const te=S.getECLevel();return te!=null&&V.putMetadata(ur.ERROR_CORRECTION_LEVEL,te),V}reset(){}static extractPureBits(m){const b=m.getTopLeftOnBit(),S=m.getBottomRightOnBit();if(b==null||S==null)throw new He;const P=this.moduleSize(b,m);let N=b[1];const V=S[1];let $=b[0];const de=(S[0]-$+1)/P,Re=(V-N+1)/P;if(de<=0||Re<=0)throw new He;const Fe=P/2;N+=Fe,$+=Fe;const Ge=new ft(de,Re);for(let dt=0;dt<Re;dt++){const Ct=N+dt*P;for(let Pt=0;Pt<de;Pt++)m.get($+Pt*P,Ct)&&Ge.set(Pt,dt)}return Ge}static moduleSize(m,b){const S=b.getWidth();let P=m[0];const N=m[1];for(;P<S&&b.get(P,N);)P++;if(P===S)throw new He;const V=P-m[0];if(V===0)throw new He;return V}}Ml.NO_POINTS=[];class Uf extends Xt{constructor(m=500){super(new Ml,m)}}var va;(function(Ne){Ne[Ne.L=0]="L",Ne[Ne.M=1]="M",Ne[Ne.Q=2]="Q",Ne[Ne.H=3]="H"})(va||(va={}));class Ii{constructor(m,b,S){this.value=m,this.stringValue=b,this.bits=S,Ii.FOR_BITS.set(S,this),Ii.FOR_VALUE.set(m,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(m){switch(m){case"L":return Ii.L;case"M":return Ii.M;case"Q":return Ii.Q;case"H":return Ii.H;default:throw new A(m+"not available")}}toString(){return this.stringValue}equals(m){if(!(m instanceof Ii))return!1;const b=m;return this.value===b.value}static forBits(m){if(m<0||m>=Ii.FOR_BITS.size)throw new F;return Ii.FOR_BITS.get(m)}}Ii.FOR_BITS=new Map,Ii.FOR_VALUE=new Map,Ii.L=new Ii(va.L,"L",1),Ii.M=new Ii(va.M,"M",0),Ii.Q=new Ii(va.Q,"Q",3),Ii.H=new Ii(va.H,"H",2);class ns{constructor(m){this.errorCorrectionLevel=Ii.forBits(m>>3&3),this.dataMask=m&7}static numBitsDiffering(m,b){return pe.bitCount(m^b)}static decodeFormatInformation(m,b){const S=ns.doDecodeFormatInformation(m,b);return S!==null?S:ns.doDecodeFormatInformation(m^ns.FORMAT_INFO_MASK_QR,b^ns.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(m,b){let S=Number.MAX_SAFE_INTEGER,P=0;for(const N of ns.FORMAT_INFO_DECODE_LOOKUP){const V=N[0];if(V===m||V===b)return new ns(N[1]);let $=ns.numBitsDiffering(m,V);$<S&&(P=N[1],S=$),m!==b&&($=ns.numBitsDiffering(b,V),$<S&&(P=N[1],S=$))}return S<=3?new ns(P):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(m){if(!(m instanceof ns))return!1;const b=m;return this.errorCorrectionLevel===b.errorCorrectionLevel&&this.dataMask===b.dataMask}}ns.FORMAT_INFO_MASK_QR=21522,ns.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Vt{constructor(m,...b){this.ecCodewordsPerBlock=m,this.ecBlocks=b}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let m=0;const b=this.ecBlocks;for(const S of b)m+=S.getCount();return m}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class ot{constructor(m,b){this.count=m,this.dataCodewords=b}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Fn{constructor(m,b,...S){this.versionNumber=m,this.alignmentPatternCenters=b,this.ecBlocks=S;let P=0;const N=S[0].getECCodewordsPerBlock(),V=S[0].getECBlocks();for(const $ of V)P+=$.getCount()*($.getDataCodewords()+N);this.totalCodewords=P}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(m){return this.ecBlocks[m.getValue()]}static getProvisionalVersionForDimension(m){if(m%4!==1)throw new re;try{return this.getVersionForNumber((m-17)/4)}catch{throw new re}}static getVersionForNumber(m){if(m<1||m>40)throw new F;return Fn.VERSIONS[m-1]}static decodeVersionInformation(m){let b=Number.MAX_SAFE_INTEGER,S=0;for(let P=0;P<Fn.VERSION_DECODE_INFO.length;P++){const N=Fn.VERSION_DECODE_INFO[P];if(N===m)return Fn.getVersionForNumber(P+7);const V=ns.numBitsDiffering(m,N);V<b&&(S=P+7,b=V)}return b<=3?Fn.getVersionForNumber(S):null}buildFunctionPattern(){const m=this.getDimensionForVersion(),b=new ft(m);b.setRegion(0,0,9,9),b.setRegion(m-8,0,8,9),b.setRegion(0,m-8,9,8);const S=this.alignmentPatternCenters.length;for(let P=0;P<S;P++){const N=this.alignmentPatternCenters[P]-2;for(let V=0;V<S;V++)P===0&&(V===0||V===S-1)||P===S-1&&V===0||b.setRegion(this.alignmentPatternCenters[V]-2,N,5,5)}return b.setRegion(6,9,1,m-17),b.setRegion(9,6,m-17,1),this.versionNumber>6&&(b.setRegion(m-11,0,3,6),b.setRegion(0,m-11,6,3)),b}toString(){return""+this.versionNumber}}Fn.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Fn.VERSIONS=[new Fn(1,new Int32Array(0),new Vt(7,new ot(1,19)),new Vt(10,new ot(1,16)),new Vt(13,new ot(1,13)),new Vt(17,new ot(1,9))),new Fn(2,Int32Array.from([6,18]),new Vt(10,new ot(1,34)),new Vt(16,new ot(1,28)),new Vt(22,new ot(1,22)),new Vt(28,new ot(1,16))),new Fn(3,Int32Array.from([6,22]),new Vt(15,new ot(1,55)),new Vt(26,new ot(1,44)),new Vt(18,new ot(2,17)),new Vt(22,new ot(2,13))),new Fn(4,Int32Array.from([6,26]),new Vt(20,new ot(1,80)),new Vt(18,new ot(2,32)),new Vt(26,new ot(2,24)),new Vt(16,new ot(4,9))),new Fn(5,Int32Array.from([6,30]),new Vt(26,new ot(1,108)),new Vt(24,new ot(2,43)),new Vt(18,new ot(2,15),new ot(2,16)),new Vt(22,new ot(2,11),new ot(2,12))),new Fn(6,Int32Array.from([6,34]),new Vt(18,new ot(2,68)),new Vt(16,new ot(4,27)),new Vt(24,new ot(4,19)),new Vt(28,new ot(4,15))),new Fn(7,Int32Array.from([6,22,38]),new Vt(20,new ot(2,78)),new Vt(18,new ot(4,31)),new Vt(18,new ot(2,14),new ot(4,15)),new Vt(26,new ot(4,13),new ot(1,14))),new Fn(8,Int32Array.from([6,24,42]),new Vt(24,new ot(2,97)),new Vt(22,new ot(2,38),new ot(2,39)),new Vt(22,new ot(4,18),new ot(2,19)),new Vt(26,new ot(4,14),new ot(2,15))),new Fn(9,Int32Array.from([6,26,46]),new Vt(30,new ot(2,116)),new Vt(22,new ot(3,36),new ot(2,37)),new Vt(20,new ot(4,16),new ot(4,17)),new Vt(24,new ot(4,12),new ot(4,13))),new Fn(10,Int32Array.from([6,28,50]),new Vt(18,new ot(2,68),new ot(2,69)),new Vt(26,new ot(4,43),new ot(1,44)),new Vt(24,new ot(6,19),new ot(2,20)),new Vt(28,new ot(6,15),new ot(2,16))),new Fn(11,Int32Array.from([6,30,54]),new Vt(20,new ot(4,81)),new Vt(30,new ot(1,50),new ot(4,51)),new Vt(28,new ot(4,22),new ot(4,23)),new Vt(24,new ot(3,12),new ot(8,13))),new Fn(12,Int32Array.from([6,32,58]),new Vt(24,new ot(2,92),new ot(2,93)),new Vt(22,new ot(6,36),new ot(2,37)),new Vt(26,new ot(4,20),new ot(6,21)),new Vt(28,new ot(7,14),new ot(4,15))),new Fn(13,Int32Array.from([6,34,62]),new Vt(26,new ot(4,107)),new Vt(22,new ot(8,37),new ot(1,38)),new Vt(24,new ot(8,20),new ot(4,21)),new Vt(22,new ot(12,11),new ot(4,12))),new Fn(14,Int32Array.from([6,26,46,66]),new Vt(30,new ot(3,115),new ot(1,116)),new Vt(24,new ot(4,40),new ot(5,41)),new Vt(20,new ot(11,16),new ot(5,17)),new Vt(24,new ot(11,12),new ot(5,13))),new Fn(15,Int32Array.from([6,26,48,70]),new Vt(22,new ot(5,87),new ot(1,88)),new Vt(24,new ot(5,41),new ot(5,42)),new Vt(30,new ot(5,24),new ot(7,25)),new Vt(24,new ot(11,12),new ot(7,13))),new Fn(16,Int32Array.from([6,26,50,74]),new Vt(24,new ot(5,98),new ot(1,99)),new Vt(28,new ot(7,45),new ot(3,46)),new Vt(24,new ot(15,19),new ot(2,20)),new Vt(30,new ot(3,15),new ot(13,16))),new Fn(17,Int32Array.from([6,30,54,78]),new Vt(28,new ot(1,107),new ot(5,108)),new Vt(28,new ot(10,46),new ot(1,47)),new Vt(28,new ot(1,22),new ot(15,23)),new Vt(28,new ot(2,14),new ot(17,15))),new Fn(18,Int32Array.from([6,30,56,82]),new Vt(30,new ot(5,120),new ot(1,121)),new Vt(26,new ot(9,43),new ot(4,44)),new Vt(28,new ot(17,22),new ot(1,23)),new Vt(28,new ot(2,14),new ot(19,15))),new Fn(19,Int32Array.from([6,30,58,86]),new Vt(28,new ot(3,113),new ot(4,114)),new Vt(26,new ot(3,44),new ot(11,45)),new Vt(26,new ot(17,21),new ot(4,22)),new Vt(26,new ot(9,13),new ot(16,14))),new Fn(20,Int32Array.from([6,34,62,90]),new Vt(28,new ot(3,107),new ot(5,108)),new Vt(26,new ot(3,41),new ot(13,42)),new Vt(30,new ot(15,24),new ot(5,25)),new Vt(28,new ot(15,15),new ot(10,16))),new Fn(21,Int32Array.from([6,28,50,72,94]),new Vt(28,new ot(4,116),new ot(4,117)),new Vt(26,new ot(17,42)),new Vt(28,new ot(17,22),new ot(6,23)),new Vt(30,new ot(19,16),new ot(6,17))),new Fn(22,Int32Array.from([6,26,50,74,98]),new Vt(28,new ot(2,111),new ot(7,112)),new Vt(28,new ot(17,46)),new Vt(30,new ot(7,24),new ot(16,25)),new Vt(24,new ot(34,13))),new Fn(23,Int32Array.from([6,30,54,78,102]),new Vt(30,new ot(4,121),new ot(5,122)),new Vt(28,new ot(4,47),new ot(14,48)),new Vt(30,new ot(11,24),new ot(14,25)),new Vt(30,new ot(16,15),new ot(14,16))),new Fn(24,Int32Array.from([6,28,54,80,106]),new Vt(30,new ot(6,117),new ot(4,118)),new Vt(28,new ot(6,45),new ot(14,46)),new Vt(30,new ot(11,24),new ot(16,25)),new Vt(30,new ot(30,16),new ot(2,17))),new Fn(25,Int32Array.from([6,32,58,84,110]),new Vt(26,new ot(8,106),new ot(4,107)),new Vt(28,new ot(8,47),new ot(13,48)),new Vt(30,new ot(7,24),new ot(22,25)),new Vt(30,new ot(22,15),new ot(13,16))),new Fn(26,Int32Array.from([6,30,58,86,114]),new Vt(28,new ot(10,114),new ot(2,115)),new Vt(28,new ot(19,46),new ot(4,47)),new Vt(28,new ot(28,22),new ot(6,23)),new Vt(30,new ot(33,16),new ot(4,17))),new Fn(27,Int32Array.from([6,34,62,90,118]),new Vt(30,new ot(8,122),new ot(4,123)),new Vt(28,new ot(22,45),new ot(3,46)),new Vt(30,new ot(8,23),new ot(26,24)),new Vt(30,new ot(12,15),new ot(28,16))),new Fn(28,Int32Array.from([6,26,50,74,98,122]),new Vt(30,new ot(3,117),new ot(10,118)),new Vt(28,new ot(3,45),new ot(23,46)),new Vt(30,new ot(4,24),new ot(31,25)),new Vt(30,new ot(11,15),new ot(31,16))),new Fn(29,Int32Array.from([6,30,54,78,102,126]),new Vt(30,new ot(7,116),new ot(7,117)),new Vt(28,new ot(21,45),new ot(7,46)),new Vt(30,new ot(1,23),new ot(37,24)),new Vt(30,new ot(19,15),new ot(26,16))),new Fn(30,Int32Array.from([6,26,52,78,104,130]),new Vt(30,new ot(5,115),new ot(10,116)),new Vt(28,new ot(19,47),new ot(10,48)),new Vt(30,new ot(15,24),new ot(25,25)),new Vt(30,new ot(23,15),new ot(25,16))),new Fn(31,Int32Array.from([6,30,56,82,108,134]),new Vt(30,new ot(13,115),new ot(3,116)),new Vt(28,new ot(2,46),new ot(29,47)),new Vt(30,new ot(42,24),new ot(1,25)),new Vt(30,new ot(23,15),new ot(28,16))),new Fn(32,Int32Array.from([6,34,60,86,112,138]),new Vt(30,new ot(17,115)),new Vt(28,new ot(10,46),new ot(23,47)),new Vt(30,new ot(10,24),new ot(35,25)),new Vt(30,new ot(19,15),new ot(35,16))),new Fn(33,Int32Array.from([6,30,58,86,114,142]),new Vt(30,new ot(17,115),new ot(1,116)),new Vt(28,new ot(14,46),new ot(21,47)),new Vt(30,new ot(29,24),new ot(19,25)),new Vt(30,new ot(11,15),new ot(46,16))),new Fn(34,Int32Array.from([6,34,62,90,118,146]),new Vt(30,new ot(13,115),new ot(6,116)),new Vt(28,new ot(14,46),new ot(23,47)),new Vt(30,new ot(44,24),new ot(7,25)),new Vt(30,new ot(59,16),new ot(1,17))),new Fn(35,Int32Array.from([6,30,54,78,102,126,150]),new Vt(30,new ot(12,121),new ot(7,122)),new Vt(28,new ot(12,47),new ot(26,48)),new Vt(30,new ot(39,24),new ot(14,25)),new Vt(30,new ot(22,15),new ot(41,16))),new Fn(36,Int32Array.from([6,24,50,76,102,128,154]),new Vt(30,new ot(6,121),new ot(14,122)),new Vt(28,new ot(6,47),new ot(34,48)),new Vt(30,new ot(46,24),new ot(10,25)),new Vt(30,new ot(2,15),new ot(64,16))),new Fn(37,Int32Array.from([6,28,54,80,106,132,158]),new Vt(30,new ot(17,122),new ot(4,123)),new Vt(28,new ot(29,46),new ot(14,47)),new Vt(30,new ot(49,24),new ot(10,25)),new Vt(30,new ot(24,15),new ot(46,16))),new Fn(38,Int32Array.from([6,32,58,84,110,136,162]),new Vt(30,new ot(4,122),new ot(18,123)),new Vt(28,new ot(13,46),new ot(32,47)),new Vt(30,new ot(48,24),new ot(14,25)),new Vt(30,new ot(42,15),new ot(32,16))),new Fn(39,Int32Array.from([6,26,54,82,110,138,166]),new Vt(30,new ot(20,117),new ot(4,118)),new Vt(28,new ot(40,47),new ot(7,48)),new Vt(30,new ot(43,24),new ot(22,25)),new Vt(30,new ot(10,15),new ot(67,16))),new Fn(40,Int32Array.from([6,30,58,86,114,142,170]),new Vt(30,new ot(19,118),new ot(6,119)),new Vt(28,new ot(18,47),new ot(31,48)),new Vt(30,new ot(34,24),new ot(34,25)),new Vt(30,new ot(20,15),new ot(61,16)))];var zi;(function(Ne){Ne[Ne.DATA_MASK_000=0]="DATA_MASK_000",Ne[Ne.DATA_MASK_001=1]="DATA_MASK_001",Ne[Ne.DATA_MASK_010=2]="DATA_MASK_010",Ne[Ne.DATA_MASK_011=3]="DATA_MASK_011",Ne[Ne.DATA_MASK_100=4]="DATA_MASK_100",Ne[Ne.DATA_MASK_101=5]="DATA_MASK_101",Ne[Ne.DATA_MASK_110=6]="DATA_MASK_110",Ne[Ne.DATA_MASK_111=7]="DATA_MASK_111"})(zi||(zi={}));class so{constructor(m,b){this.value=m,this.isMasked=b}unmaskBitMatrix(m,b){for(let S=0;S<b;S++)for(let P=0;P<b;P++)this.isMasked(S,P)&&m.flip(P,S)}}so.values=new Map([[zi.DATA_MASK_000,new so(zi.DATA_MASK_000,(Ne,m)=>(Ne+m&1)===0)],[zi.DATA_MASK_001,new so(zi.DATA_MASK_001,(Ne,m)=>(Ne&1)===0)],[zi.DATA_MASK_010,new so(zi.DATA_MASK_010,(Ne,m)=>m%3===0)],[zi.DATA_MASK_011,new so(zi.DATA_MASK_011,(Ne,m)=>(Ne+m)%3===0)],[zi.DATA_MASK_100,new so(zi.DATA_MASK_100,(Ne,m)=>(Math.floor(Ne/2)+Math.floor(m/3)&1)===0)],[zi.DATA_MASK_101,new so(zi.DATA_MASK_101,(Ne,m)=>Ne*m%6===0)],[zi.DATA_MASK_110,new so(zi.DATA_MASK_110,(Ne,m)=>Ne*m%6<3)],[zi.DATA_MASK_111,new so(zi.DATA_MASK_111,(Ne,m)=>(Ne+m+Ne*m%3&1)===0)]]);class Zc{constructor(m){const b=m.getHeight();if(b<21||(b&3)!==1)throw new re;this.bitMatrix=m}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let m=0;for(let N=0;N<6;N++)m=this.copyBit(N,8,m);m=this.copyBit(7,8,m),m=this.copyBit(8,8,m),m=this.copyBit(8,7,m);for(let N=5;N>=0;N--)m=this.copyBit(8,N,m);const b=this.bitMatrix.getHeight();let S=0;const P=b-7;for(let N=b-1;N>=P;N--)S=this.copyBit(8,N,S);for(let N=b-8;N<b;N++)S=this.copyBit(N,8,S);if(this.parsedFormatInfo=ns.decodeFormatInformation(m,S),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new re}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const m=this.bitMatrix.getHeight(),b=Math.floor((m-17)/4);if(b<=6)return Fn.getVersionForNumber(b);let S=0;const P=m-11;for(let V=5;V>=0;V--)for(let $=m-9;$>=P;$--)S=this.copyBit($,V,S);let N=Fn.decodeVersionInformation(S);if(N!==null&&N.getDimensionForVersion()===m)return this.parsedVersion=N,N;S=0;for(let V=5;V>=0;V--)for(let $=m-9;$>=P;$--)S=this.copyBit(V,$,S);if(N=Fn.decodeVersionInformation(S),N!==null&&N.getDimensionForVersion()===m)return this.parsedVersion=N,N;throw new re}copyBit(m,b,S){return(this.isMirror?this.bitMatrix.get(b,m):this.bitMatrix.get(m,b))?S<<1|1:S<<1}readCodewords(){const m=this.readFormatInformation(),b=this.readVersion(),S=so.values.get(m.getDataMask()),P=this.bitMatrix.getHeight();S.unmaskBitMatrix(this.bitMatrix,P);const N=b.buildFunctionPattern();let V=!0;const $=new Uint8Array(b.getTotalCodewords());let te=0,de=0,Re=0;for(let Fe=P-1;Fe>0;Fe-=2){Fe===6&&Fe--;for(let Ge=0;Ge<P;Ge++){const dt=V?P-1-Ge:Ge;for(let Ct=0;Ct<2;Ct++)N.get(Fe-Ct,dt)||(Re++,de<<=1,this.bitMatrix.get(Fe-Ct,dt)&&(de|=1),Re===8&&($[te++]=de,Re=0,de=0))}V=!V}if(te!==b.getTotalCodewords())throw new re;return $}remask(){if(this.parsedFormatInfo===null)return;const m=so.values[this.parsedFormatInfo.getDataMask()],b=this.bitMatrix.getHeight();m.unmaskBitMatrix(this.bitMatrix,b)}setMirror(m){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=m}mirror(){const m=this.bitMatrix;for(let b=0,S=m.getWidth();b<S;b++)for(let P=b+1,N=m.getHeight();P<N;P++)m.get(b,P)!==m.get(P,b)&&(m.flip(P,b),m.flip(b,P))}}class Tu{constructor(m,b){this.numDataCodewords=m,this.codewords=b}static getDataBlocks(m,b,S){if(m.length!==b.getTotalCodewords())throw new F;const P=b.getECBlocksForLevel(S);let N=0;const V=P.getECBlocks();for(const Ct of V)N+=Ct.getCount();const $=new Array(N);let te=0;for(const Ct of V)for(let Pt=0;Pt<Ct.getCount();Pt++){const $t=Ct.getDataCodewords(),tn=P.getECCodewordsPerBlock()+$t;$[te++]=new Tu($t,new Uint8Array(tn))}const de=$[0].codewords.length;let Re=$.length-1;for(;Re>=0&&$[Re].codewords.length!==de;)Re--;Re++;const Fe=de-P.getECCodewordsPerBlock();let Ge=0;for(let Ct=0;Ct<Fe;Ct++)for(let Pt=0;Pt<te;Pt++)$[Pt].codewords[Ct]=m[Ge++];for(let Ct=Re;Ct<te;Ct++)$[Ct].codewords[Fe]=m[Ge++];const dt=$[0].codewords.length;for(let Ct=Fe;Ct<dt;Ct++)for(let Pt=0;Pt<te;Pt++){const $t=Pt<Re?Ct:Ct+1;$[Pt].codewords[$t]=m[Ge++]}return $}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var qs;(function(Ne){Ne[Ne.TERMINATOR=0]="TERMINATOR",Ne[Ne.NUMERIC=1]="NUMERIC",Ne[Ne.ALPHANUMERIC=2]="ALPHANUMERIC",Ne[Ne.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",Ne[Ne.BYTE=4]="BYTE",Ne[Ne.ECI=5]="ECI",Ne[Ne.KANJI=6]="KANJI",Ne[Ne.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",Ne[Ne.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",Ne[Ne.HANZI=9]="HANZI"})(qs||(qs={}));class mr{constructor(m,b,S,P){this.value=m,this.stringValue=b,this.characterCountBitsForVersions=S,this.bits=P,mr.FOR_BITS.set(P,this),mr.FOR_VALUE.set(m,this)}static forBits(m){const b=mr.FOR_BITS.get(m);if(b===void 0)throw new F;return b}getCharacterCountBits(m){const b=m.getVersionNumber();let S;return b<=9?S=0:b<=26?S=1:S=2,this.characterCountBitsForVersions[S]}getValue(){return this.value}getBits(){return this.bits}equals(m){if(!(m instanceof mr))return!1;const b=m;return this.value===b.value}toString(){return this.stringValue}}mr.FOR_BITS=new Map,mr.FOR_VALUE=new Map,mr.TERMINATOR=new mr(qs.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),mr.NUMERIC=new mr(qs.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),mr.ALPHANUMERIC=new mr(qs.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),mr.STRUCTURED_APPEND=new mr(qs.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),mr.BYTE=new mr(qs.BYTE,"BYTE",Int32Array.from([8,16,16]),4),mr.ECI=new mr(qs.ECI,"ECI",Int32Array.from([0,0,0]),7),mr.KANJI=new mr(qs.KANJI,"KANJI",Int32Array.from([8,10,12]),8),mr.FNC1_FIRST_POSITION=new mr(qs.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),mr.FNC1_SECOND_POSITION=new mr(qs.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),mr.HANZI=new mr(qs.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class js{static decode(m,b,S,P){const N=new Eu(m);let V=new ze;const $=new Array;let te=-1,de=-1;try{let Re=null,Fe=!1,Ge;do{if(N.available()<4)Ge=mr.TERMINATOR;else{const dt=N.readBits(4);Ge=mr.forBits(dt)}switch(Ge){case mr.TERMINATOR:break;case mr.FNC1_FIRST_POSITION:case mr.FNC1_SECOND_POSITION:Fe=!0;break;case mr.STRUCTURED_APPEND:if(N.available()<16)throw new re;te=N.readBits(8),de=N.readBits(8);break;case mr.ECI:const dt=js.parseECIValue(N);if(Re=ye.getCharacterSetECIByValue(dt),Re===null)throw new re;break;case mr.HANZI:const Ct=N.readBits(4),Pt=N.readBits(Ge.getCharacterCountBits(b));Ct===js.GB2312_SUBSET&&js.decodeHanziSegment(N,V,Pt);break;default:const $t=N.readBits(Ge.getCharacterCountBits(b));switch(Ge){case mr.NUMERIC:js.decodeNumericSegment(N,V,$t);break;case mr.ALPHANUMERIC:js.decodeAlphanumericSegment(N,V,$t,Fe);break;case mr.BYTE:js.decodeByteSegment(N,V,$t,Re,$,P);break;case mr.KANJI:js.decodeKanjiSegment(N,V,$t);break;default:throw new re}break}}while(Ge!==mr.TERMINATOR)}catch{throw new re}return new br(m,V.toString(),$.length===0?null:$,S===null?null:S.toString(),te,de)}static decodeHanziSegment(m,b,S){if(S*13>m.available())throw new re;const P=new Uint8Array(2*S);let N=0;for(;S>0;){const V=m.readBits(13);let $=V/96<<8&4294967295|V%96;$<959?$+=41377:$+=42657,P[N]=$>>8&255,P[N+1]=$&255,N+=2,S--}try{b.append(Ie.decode(P,Oe.GB2312))}catch(V){throw new re(V)}}static decodeKanjiSegment(m,b,S){if(S*13>m.available())throw new re;const P=new Uint8Array(2*S);let N=0;for(;S>0;){const V=m.readBits(13);let $=V/192<<8&4294967295|V%192;$<7936?$+=33088:$+=49472,P[N]=$>>8,P[N+1]=$,N+=2,S--}try{b.append(Ie.decode(P,Oe.SHIFT_JIS))}catch(V){throw new re(V)}}static decodeByteSegment(m,b,S,P,N,V){if(8*S>m.available())throw new re;const $=new Uint8Array(S);for(let de=0;de<S;de++)$[de]=m.readBits(8);let te;P===null?te=Oe.guessEncoding($,V):te=P.getName();try{b.append(Ie.decode($,te))}catch(de){throw new re(de)}N.push($)}static toAlphaNumericChar(m){if(m>=js.ALPHANUMERIC_CHARS.length)throw new re;return js.ALPHANUMERIC_CHARS[m]}static decodeAlphanumericSegment(m,b,S,P){const N=b.length();for(;S>1;){if(m.available()<11)throw new re;const V=m.readBits(11);b.append(js.toAlphaNumericChar(Math.floor(V/45))),b.append(js.toAlphaNumericChar(V%45)),S-=2}if(S===1){if(m.available()<6)throw new re;b.append(js.toAlphaNumericChar(m.readBits(6)))}if(P)for(let V=N;V<b.length();V++)b.charAt(V)==="%"&&(V<b.length()-1&&b.charAt(V+1)==="%"?b.deleteCharAt(V+1):b.setCharAt(V,""))}static decodeNumericSegment(m,b,S){for(;S>=3;){if(m.available()<10)throw new re;const P=m.readBits(10);if(P>=1e3)throw new re;b.append(js.toAlphaNumericChar(Math.floor(P/100))),b.append(js.toAlphaNumericChar(Math.floor(P/10)%10)),b.append(js.toAlphaNumericChar(P%10)),S-=3}if(S===2){if(m.available()<7)throw new re;const P=m.readBits(7);if(P>=100)throw new re;b.append(js.toAlphaNumericChar(Math.floor(P/10))),b.append(js.toAlphaNumericChar(P%10))}else if(S===1){if(m.available()<4)throw new re;const P=m.readBits(4);if(P>=10)throw new re;b.append(js.toAlphaNumericChar(P))}}static parseECIValue(m){const b=m.readBits(8);if(!(b&128))return b&127;if((b&192)===128){const S=m.readBits(8);return(b&63)<<8&4294967295|S}if((b&224)===192){const S=m.readBits(16);return(b&31)<<16&4294967295|S}throw new re}}js.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",js.GB2312_SUBSET=1;class Wh{constructor(m){this.mirrored=m}isMirrored(){return this.mirrored}applyMirroredCorrection(m){if(!this.mirrored||m===null||m.length<3)return;const b=m[0];m[0]=m[2],m[2]=b}}class Za{constructor(){this.rsDecoder=new fi(Yn.QR_CODE_FIELD_256)}decodeBooleanArray(m,b){return this.decodeBitMatrix(ft.parseFromBooleanArray(m),b)}decodeBitMatrix(m,b){const S=new Zc(m);let P=null;try{return this.decodeBitMatrixParser(S,b)}catch(N){P=N}try{S.remask(),S.setMirror(!0),S.readVersion(),S.readFormatInformation(),S.mirror();const N=this.decodeBitMatrixParser(S,b);return N.setOther(new Wh(!0)),N}catch(N){throw P!==null?P:N}}decodeBitMatrixParser(m,b){const S=m.readVersion(),P=m.readFormatInformation().getErrorCorrectionLevel(),N=m.readCodewords(),V=Tu.getDataBlocks(N,S,P);let $=0;for(const Re of V)$+=Re.getNumDataCodewords();const te=new Uint8Array($);let de=0;for(const Re of V){const Fe=Re.getCodewords(),Ge=Re.getNumDataCodewords();this.correctErrors(Fe,Ge);for(let dt=0;dt<Ge;dt++)te[de++]=Fe[dt]}return js.decode(te,S,P,b)}correctErrors(m,b){const S=new Int32Array(m);try{this.rsDecoder.decode(S,m.length-b)}catch{throw new K}for(let P=0;P<b;P++)m[P]=S[P]}}class Qr extends un{constructor(m,b,S){super(m,b),this.estimatedModuleSize=S}aboutEquals(m,b,S){if(Math.abs(b-this.getY())<=m&&Math.abs(S-this.getX())<=m){const P=Math.abs(m-this.estimatedModuleSize);return P<=1||P<=this.estimatedModuleSize}return!1}combineEstimate(m,b,S){const P=(this.getX()+b)/2,N=(this.getY()+m)/2,V=(this.estimatedModuleSize+S)/2;return new Qr(P,N,V)}}class ja{constructor(m,b,S,P,N,V,$){this.image=m,this.startX=b,this.startY=S,this.width=P,this.height=N,this.moduleSize=V,this.resultPointCallback=$,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const m=this.startX,b=this.height,S=this.width,P=m+S,N=this.startY+b/2,V=new Int32Array(3),$=this.image;for(let te=0;te<b;te++){const de=N+(te&1?-Math.floor((te+1)/2):Math.floor((te+1)/2));V[0]=0,V[1]=0,V[2]=0;let Re=m;for(;Re<P&&!$.get(Re,de);)Re++;let Fe=0;for(;Re<P;){if($.get(Re,de))if(Fe===1)V[1]++;else if(Fe===2){if(this.foundPatternCross(V)){const Ge=this.handlePossibleCenter(V,de,Re);if(Ge!==null)return Ge}V[0]=V[2],V[1]=1,V[2]=0,Fe=1}else V[++Fe]++;else Fe===1&&Fe++,V[Fe]++;Re++}if(this.foundPatternCross(V)){const Ge=this.handlePossibleCenter(V,de,P);if(Ge!==null)return Ge}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new He}static centerFromEnd(m,b){return b-m[2]-m[1]/2}foundPatternCross(m){const b=this.moduleSize,S=b/2;for(let P=0;P<3;P++)if(Math.abs(b-m[P])>=S)return!1;return!0}crossCheckVertical(m,b,S,P){const N=this.image,V=N.getHeight(),$=this.crossCheckStateCount;$[0]=0,$[1]=0,$[2]=0;let te=m;for(;te>=0&&N.get(b,te)&&$[1]<=S;)$[1]++,te--;if(te<0||$[1]>S)return NaN;for(;te>=0&&!N.get(b,te)&&$[0]<=S;)$[0]++,te--;if($[0]>S)return NaN;for(te=m+1;te<V&&N.get(b,te)&&$[1]<=S;)$[1]++,te++;if(te===V||$[1]>S)return NaN;for(;te<V&&!N.get(b,te)&&$[2]<=S;)$[2]++,te++;if($[2]>S)return NaN;const de=$[0]+$[1]+$[2];return 5*Math.abs(de-P)>=2*P?NaN:this.foundPatternCross($)?ja.centerFromEnd($,te):NaN}handlePossibleCenter(m,b,S){const P=m[0]+m[1]+m[2],N=ja.centerFromEnd(m,S),V=this.crossCheckVertical(b,N,2*m[1],P);if(!isNaN(V)){const $=(m[0]+m[1]+m[2])/3;for(const de of this.possibleCenters)if(de.aboutEquals($,V,N))return de.combineEstimate(V,N,$);const te=new Qr(N,V,$);this.possibleCenters.push(te),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(te)}return null}}class Wn extends un{constructor(m,b,S,P){super(m,b),this.estimatedModuleSize=S,this.count=P,P===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(m,b,S){if(Math.abs(b-this.getY())<=m&&Math.abs(S-this.getX())<=m){const P=Math.abs(m-this.estimatedModuleSize);return P<=1||P<=this.estimatedModuleSize}return!1}combineEstimate(m,b,S){const P=this.count+1,N=(this.count*this.getX()+b)/P,V=(this.count*this.getY()+m)/P,$=(this.count*this.estimatedModuleSize+S)/P;return new Wn(N,V,$,P)}}class Bd{constructor(m){this.bottomLeft=m[0],this.topLeft=m[1],this.topRight=m[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class fo{constructor(m,b){this.image=m,this.resultPointCallback=b,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=b}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(m){const b=m!=null&&m.get(Ae.TRY_HARDER)!==void 0,S=m!=null&&m.get(Ae.PURE_BARCODE)!==void 0,P=this.image,N=P.getHeight(),V=P.getWidth();let $=Math.floor(3*N/(4*fo.MAX_MODULES));($<fo.MIN_SKIP||b)&&($=fo.MIN_SKIP);let te=!1;const de=new Int32Array(5);for(let Fe=$-1;Fe<N&&!te;Fe+=$){de[0]=0,de[1]=0,de[2]=0,de[3]=0,de[4]=0;let Ge=0;for(let dt=0;dt<V;dt++)if(P.get(dt,Fe))(Ge&1)===1&&Ge++,de[Ge]++;else if(Ge&1)de[Ge]++;else if(Ge===4)if(fo.foundPatternCross(de)){if(this.handlePossibleCenter(de,Fe,dt,S)===!0)if($=2,this.hasSkipped===!0)te=this.haveMultiplyConfirmedCenters();else{const Pt=this.findRowSkip();Pt>de[2]&&(Fe+=Pt-de[2]-$,dt=V-1)}else{de[0]=de[2],de[1]=de[3],de[2]=de[4],de[3]=1,de[4]=0,Ge=3;continue}Ge=0,de[0]=0,de[1]=0,de[2]=0,de[3]=0,de[4]=0}else de[0]=de[2],de[1]=de[3],de[2]=de[4],de[3]=1,de[4]=0,Ge=3;else de[++Ge]++;fo.foundPatternCross(de)&&this.handlePossibleCenter(de,Fe,V,S)===!0&&($=de[0],this.hasSkipped&&(te=this.haveMultiplyConfirmedCenters()))}const Re=this.selectBestPatterns();return un.orderBestPatterns(Re),new Bd(Re)}static centerFromEnd(m,b){return b-m[4]-m[3]-m[2]/2}static foundPatternCross(m){let b=0;for(let N=0;N<5;N++){const V=m[N];if(V===0)return!1;b+=V}if(b<7)return!1;const S=b/7,P=S/2;return Math.abs(S-m[0])<P&&Math.abs(S-m[1])<P&&Math.abs(3*S-m[2])<3*P&&Math.abs(S-m[3])<P&&Math.abs(S-m[4])<P}getCrossCheckStateCount(){const m=this.crossCheckStateCount;return m[0]=0,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m}crossCheckDiagonal(m,b,S,P){const N=this.getCrossCheckStateCount();let V=0;const $=this.image;for(;m>=V&&b>=V&&$.get(b-V,m-V);)N[2]++,V++;if(m<V||b<V)return!1;for(;m>=V&&b>=V&&!$.get(b-V,m-V)&&N[1]<=S;)N[1]++,V++;if(m<V||b<V||N[1]>S)return!1;for(;m>=V&&b>=V&&$.get(b-V,m-V)&&N[0]<=S;)N[0]++,V++;if(N[0]>S)return!1;const te=$.getHeight(),de=$.getWidth();for(V=1;m+V<te&&b+V<de&&$.get(b+V,m+V);)N[2]++,V++;if(m+V>=te||b+V>=de)return!1;for(;m+V<te&&b+V<de&&!$.get(b+V,m+V)&&N[3]<S;)N[3]++,V++;if(m+V>=te||b+V>=de||N[3]>=S)return!1;for(;m+V<te&&b+V<de&&$.get(b+V,m+V)&&N[4]<S;)N[4]++,V++;if(N[4]>=S)return!1;const Re=N[0]+N[1]+N[2]+N[3]+N[4];return Math.abs(Re-P)<2*P&&fo.foundPatternCross(N)}crossCheckVertical(m,b,S,P){const N=this.image,V=N.getHeight(),$=this.getCrossCheckStateCount();let te=m;for(;te>=0&&N.get(b,te);)$[2]++,te--;if(te<0)return NaN;for(;te>=0&&!N.get(b,te)&&$[1]<=S;)$[1]++,te--;if(te<0||$[1]>S)return NaN;for(;te>=0&&N.get(b,te)&&$[0]<=S;)$[0]++,te--;if($[0]>S)return NaN;for(te=m+1;te<V&&N.get(b,te);)$[2]++,te++;if(te===V)return NaN;for(;te<V&&!N.get(b,te)&&$[3]<S;)$[3]++,te++;if(te===V||$[3]>=S)return NaN;for(;te<V&&N.get(b,te)&&$[4]<S;)$[4]++,te++;if($[4]>=S)return NaN;const de=$[0]+$[1]+$[2]+$[3]+$[4];return 5*Math.abs(de-P)>=2*P?NaN:fo.foundPatternCross($)?fo.centerFromEnd($,te):NaN}crossCheckHorizontal(m,b,S,P){const N=this.image,V=N.getWidth(),$=this.getCrossCheckStateCount();let te=m;for(;te>=0&&N.get(te,b);)$[2]++,te--;if(te<0)return NaN;for(;te>=0&&!N.get(te,b)&&$[1]<=S;)$[1]++,te--;if(te<0||$[1]>S)return NaN;for(;te>=0&&N.get(te,b)&&$[0]<=S;)$[0]++,te--;if($[0]>S)return NaN;for(te=m+1;te<V&&N.get(te,b);)$[2]++,te++;if(te===V)return NaN;for(;te<V&&!N.get(te,b)&&$[3]<S;)$[3]++,te++;if(te===V||$[3]>=S)return NaN;for(;te<V&&N.get(te,b)&&$[4]<S;)$[4]++,te++;if($[4]>=S)return NaN;const de=$[0]+$[1]+$[2]+$[3]+$[4];return 5*Math.abs(de-P)>=P?NaN:fo.foundPatternCross($)?fo.centerFromEnd($,te):NaN}handlePossibleCenter(m,b,S,P){const N=m[0]+m[1]+m[2]+m[3]+m[4];let V=fo.centerFromEnd(m,S),$=this.crossCheckVertical(b,Math.floor(V),m[2],N);if(!isNaN($)&&(V=this.crossCheckHorizontal(Math.floor(V),Math.floor($),m[2],N),!isNaN(V)&&(!P||this.crossCheckDiagonal(Math.floor($),Math.floor(V),m[2],N)))){const te=N/7;let de=!1;const Re=this.possibleCenters;for(let Fe=0,Ge=Re.length;Fe<Ge;Fe++){const dt=Re[Fe];if(dt.aboutEquals(te,$,V)){Re[Fe]=dt.combineEstimate($,V,te),de=!0;break}}if(!de){const Fe=new Wn(V,$,te);Re.push(Fe),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(Fe)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let b=null;for(const S of this.possibleCenters)if(S.getCount()>=fo.CENTER_QUORUM)if(b==null)b=S;else return this.hasSkipped=!0,Math.floor((Math.abs(b.getX()-S.getX())-Math.abs(b.getY()-S.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let m=0,b=0;const S=this.possibleCenters.length;for(const V of this.possibleCenters)V.getCount()>=fo.CENTER_QUORUM&&(m++,b+=V.getEstimatedModuleSize());if(m<3)return!1;const P=b/S;let N=0;for(const V of this.possibleCenters)N+=Math.abs(V.getEstimatedModuleSize()-P);return N<=.05*b}selectBestPatterns(){const m=this.possibleCenters.length;if(m<3)throw new He;const b=this.possibleCenters;let S;if(m>3){let P=0,N=0;for(const te of this.possibleCenters){const de=te.getEstimatedModuleSize();P+=de,N+=de*de}S=P/m;let V=Math.sqrt(N/m-S*S);b.sort((te,de)=>{const Re=Math.abs(de.getEstimatedModuleSize()-S),Fe=Math.abs(te.getEstimatedModuleSize()-S);return Re<Fe?-1:Re>Fe?1:0});const $=Math.max(.2*S,V);for(let te=0;te<b.length&&b.length>3;te++){const de=b[te];Math.abs(de.getEstimatedModuleSize()-S)>$&&(b.splice(te,1),te--)}}if(b.length>3){let P=0;for(const N of b)P+=N.getEstimatedModuleSize();S=P/b.length,b.sort((N,V)=>{if(V.getCount()===N.getCount()){const $=Math.abs(V.getEstimatedModuleSize()-S),te=Math.abs(N.getEstimatedModuleSize()-S);return $<te?1:$>te?-1:0}else return V.getCount()-N.getCount()}),b.splice(3)}return[b[0],b[1],b[2]]}}fo.CENTER_QUORUM=2,fo.MIN_SKIP=3,fo.MAX_MODULES=57;class ba{constructor(m){this.image=m}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(m){this.resultPointCallback=m==null?null:m.get(Ae.NEED_RESULT_POINT_CALLBACK);const S=new fo(this.image,this.resultPointCallback).find(m);return this.processFinderPatternInfo(S)}processFinderPatternInfo(m){const b=m.getTopLeft(),S=m.getTopRight(),P=m.getBottomLeft(),N=this.calculateModuleSize(b,S,P);if(N<1)throw new He("No pattern found in proccess finder.");const V=ba.computeDimension(b,S,P,N),$=Fn.getProvisionalVersionForDimension(V),te=$.getDimensionForVersion()-7;let de=null;if($.getAlignmentPatternCenters().length>0){const dt=S.getX()-b.getX()+P.getX(),Ct=S.getY()-b.getY()+P.getY(),Pt=1-3/te,$t=Math.floor(b.getX()+Pt*(dt-b.getX())),tn=Math.floor(b.getY()+Pt*(Ct-b.getY()));for(let Vn=4;Vn<=16;Vn<<=1)try{de=this.findAlignmentInRegion(N,$t,tn,Vn);break}catch(zn){if(!(zn instanceof He))throw zn}}const Re=ba.createTransform(b,S,P,de,V),Fe=ba.sampleGrid(this.image,Re,V);let Ge;return de===null?Ge=[P,b,S]:Ge=[P,b,S,de],new Xn(Fe,Ge)}static createTransform(m,b,S,P,N){const V=N-3.5;let $,te,de,Re;return P!==null?($=P.getX(),te=P.getY(),de=V-3,Re=de):($=b.getX()-m.getX()+S.getX(),te=b.getY()-m.getY()+S.getY(),de=V,Re=V),Si.quadrilateralToQuadrilateral(3.5,3.5,V,3.5,de,Re,3.5,V,m.getX(),m.getY(),b.getX(),b.getY(),$,te,S.getX(),S.getY())}static sampleGrid(m,b,S){return Oi.getInstance().sampleGridWithTransform(m,S,S,b)}static computeDimension(m,b,S,P){const N=jt.round(un.distance(m,b)/P),V=jt.round(un.distance(m,S)/P);let $=Math.floor((N+V)/2)+7;switch($&3){case 0:$++;break;case 2:$--;break;case 3:throw new He("Dimensions could be not found.")}return $}calculateModuleSize(m,b,S){return(this.calculateModuleSizeOneWay(m,b)+this.calculateModuleSizeOneWay(m,S))/2}calculateModuleSizeOneWay(m,b){const S=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(m.getX()),Math.floor(m.getY()),Math.floor(b.getX()),Math.floor(b.getY())),P=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(b.getX()),Math.floor(b.getY()),Math.floor(m.getX()),Math.floor(m.getY()));return isNaN(S)?P/7:isNaN(P)?S/7:(S+P)/14}sizeOfBlackWhiteBlackRunBothWays(m,b,S,P){let N=this.sizeOfBlackWhiteBlackRun(m,b,S,P),V=1,$=m-(S-m);$<0?(V=m/(m-$),$=0):$>=this.image.getWidth()&&(V=(this.image.getWidth()-1-m)/($-m),$=this.image.getWidth()-1);let te=Math.floor(b-(P-b)*V);return V=1,te<0?(V=b/(b-te),te=0):te>=this.image.getHeight()&&(V=(this.image.getHeight()-1-b)/(te-b),te=this.image.getHeight()-1),$=Math.floor(m+($-m)*V),N+=this.sizeOfBlackWhiteBlackRun(m,b,$,te),N-1}sizeOfBlackWhiteBlackRun(m,b,S,P){const N=Math.abs(P-b)>Math.abs(S-m);if(N){let dt=m;m=b,b=dt,dt=S,S=P,P=dt}const V=Math.abs(S-m),$=Math.abs(P-b);let te=-V/2;const de=m<S?1:-1,Re=b<P?1:-1;let Fe=0;const Ge=S+de;for(let dt=m,Ct=b;dt!==Ge;dt+=de){const Pt=N?Ct:dt,$t=N?dt:Ct;if(Fe===1===this.image.get(Pt,$t)){if(Fe===2)return jt.distance(dt,Ct,m,b);Fe++}if(te+=$,te>0){if(Ct===P)break;Ct+=Re,te-=V}}return Fe===2?jt.distance(S+de,P,m,b):NaN}findAlignmentInRegion(m,b,S,P){const N=Math.floor(P*m),V=Math.max(0,b-N),$=Math.min(this.image.getWidth()-1,b+N);if($-V<m*3)throw new He("Alignment top exceeds estimated module size.");const te=Math.max(0,S-N),de=Math.min(this.image.getHeight()-1,S+N);if(de-te<m*3)throw new He("Alignment bottom exceeds estimated module size.");return new ja(this.image,V,te,$-V,de-te,m,this.resultPointCallback).find()}}class Or{constructor(){this.decoder=new Za}getDecoder(){return this.decoder}decode(m,b){let S,P;if(b!=null&&b.get(Ae.PURE_BARCODE)!==void 0){const te=Or.extractPureBits(m.getBlackMatrix());S=this.decoder.decodeBitMatrix(te,b),P=Or.NO_POINTS}else{const te=new ba(m.getBlackMatrix()).detect(b);S=this.decoder.decodeBitMatrix(te.getBits(),b),P=te.getPoints()}S.getOther()instanceof Wh&&S.getOther().applyMirroredCorrection(P);const N=new On(S.getText(),S.getRawBytes(),void 0,P,En.QR_CODE,void 0),V=S.getByteSegments();V!==null&&N.putMetadata(ur.BYTE_SEGMENTS,V);const $=S.getECLevel();return $!==null&&N.putMetadata(ur.ERROR_CORRECTION_LEVEL,$),S.hasStructuredAppend()&&(N.putMetadata(ur.STRUCTURED_APPEND_SEQUENCE,S.getStructuredAppendSequenceNumber()),N.putMetadata(ur.STRUCTURED_APPEND_PARITY,S.getStructuredAppendParity())),N}reset(){}static extractPureBits(m){const b=m.getTopLeftOnBit(),S=m.getBottomRightOnBit();if(b===null||S===null)throw new He;const P=this.moduleSize(b,m);let N=b[1],V=S[1],$=b[0],te=S[0];if($>=te||N>=V)throw new He;if(V-N!==te-$&&(te=$+(V-N),te>=m.getWidth()))throw new He;const de=Math.round((te-$+1)/P),Re=Math.round((V-N+1)/P);if(de<=0||Re<=0)throw new He;if(Re!==de)throw new He;const Fe=Math.floor(P/2);N+=Fe,$+=Fe;const Ge=$+Math.floor((de-1)*P)-te;if(Ge>0){if(Ge>Fe)throw new He;$-=Ge}const dt=N+Math.floor((Re-1)*P)-V;if(dt>0){if(dt>Fe)throw new He;N-=dt}const Ct=new ft(de,Re);for(let Pt=0;Pt<Re;Pt++){const $t=N+Math.floor(Pt*P);for(let tn=0;tn<de;tn++)m.get($+Math.floor(tn*P),$t)&&Ct.set(tn,Pt)}return Ct}static moduleSize(m,b){const S=b.getHeight(),P=b.getWidth();let N=m[0],V=m[1],$=!0,te=0;for(;N<P&&V<S;){if($!==b.get(N,V)){if(++te===5)break;$=!$}N++,V++}if(N===P||V===S)throw new He;return(N-m[0])/7}}Or.NO_POINTS=new Array;class Ir{PDF417Common(){}static getBitCountSum(m){return jt.sum(m)}static toIntArray(m){if(m==null||!m.length)return Ir.EMPTY_INT_ARRAY;const b=new Int32Array(m.length);let S=0;for(const P of m)b[S++]=P;return b}static getCodeword(m){const b=me.binarySearch(Ir.SYMBOL_TABLE,m&262143);return b<0?-1:(Ir.CODEWORD_TABLE[b]-1)%Ir.NUMBER_OF_CODEWORDS}}Ir.NUMBER_OF_CODEWORDS=929,Ir.MAX_CODEWORDS_IN_BARCODE=Ir.NUMBER_OF_CODEWORDS-1,Ir.MIN_ROWS_IN_BARCODE=3,Ir.MAX_ROWS_IN_BARCODE=90,Ir.MODULES_IN_CODEWORD=17,Ir.MODULES_IN_STOP_PATTERN=18,Ir.BARS_IN_MODULE=8,Ir.EMPTY_INT_ARRAY=new Int32Array([]),Ir.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Ir.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class $h{constructor(m,b){this.bits=m,this.points=b}getBits(){return this.bits}getPoints(){return this.points}}class Vr{static detectMultiple(m,b,S){let P=m.getBlackMatrix(),N=Vr.detect(S,P);return N.length||(P=P.clone(),P.rotate180(),N=Vr.detect(S,P)),new $h(P,N)}static detect(m,b){const S=new Array;let P=0,N=0,V=!1;for(;P<b.getHeight();){const $=Vr.findVertices(b,P,N);if($[0]==null&&$[3]==null){if(!V)break;V=!1,N=0;for(const te of S)te[1]!=null&&(P=Math.trunc(Math.max(P,te[1].getY()))),te[3]!=null&&(P=Math.max(P,Math.trunc(te[3].getY())));P+=Vr.ROW_STEP;continue}if(V=!0,S.push($),!m)break;$[2]!=null?(N=Math.trunc($[2].getX()),P=Math.trunc($[2].getY())):(N=Math.trunc($[4].getX()),P=Math.trunc($[4].getY()))}return S}static findVertices(m,b,S){const P=m.getHeight(),N=m.getWidth(),V=new Array(8);return Vr.copyToResult(V,Vr.findRowsWithPattern(m,P,N,b,S,Vr.START_PATTERN),Vr.INDEXES_START_PATTERN),V[4]!=null&&(S=Math.trunc(V[4].getX()),b=Math.trunc(V[4].getY())),Vr.copyToResult(V,Vr.findRowsWithPattern(m,P,N,b,S,Vr.STOP_PATTERN),Vr.INDEXES_STOP_PATTERN),V}static copyToResult(m,b,S){for(let P=0;P<S.length;P++)m[S[P]]=b[P]}static findRowsWithPattern(m,b,S,P,N,V){const $=new Array(4);let te=!1;const de=new Int32Array(V.length);for(;P<b;P+=Vr.ROW_STEP){let Fe=Vr.findGuardPattern(m,N,P,S,!1,V,de);if(Fe!=null){for(;P>0;){const Ge=Vr.findGuardPattern(m,N,--P,S,!1,V,de);if(Ge!=null)Fe=Ge;else{P++;break}}$[0]=new un(Fe[0],P),$[1]=new un(Fe[1],P),te=!0;break}}let Re=P+1;if(te){let Fe=0,Ge=Int32Array.from([Math.trunc($[0].getX()),Math.trunc($[1].getX())]);for(;Re<b;Re++){const dt=Vr.findGuardPattern(m,Ge[0],Re,S,!1,V,de);if(dt!=null&&Math.abs(Ge[0]-dt[0])<Vr.MAX_PATTERN_DRIFT&&Math.abs(Ge[1]-dt[1])<Vr.MAX_PATTERN_DRIFT)Ge=dt,Fe=0;else{if(Fe>Vr.SKIPPED_ROW_COUNT_MAX)break;Fe++}}Re-=Fe+1,$[2]=new un(Ge[0],Re),$[3]=new un(Ge[1],Re)}return Re-P<Vr.BARCODE_MIN_HEIGHT&&me.fill($,null),$}static findGuardPattern(m,b,S,P,N,V,$){me.fillWithin($,0,$.length,0);let te=b,de=0;for(;m.get(te,S)&&te>0&&de++<Vr.MAX_PIXEL_DRIFT;)te--;let Re=te,Fe=0,Ge=V.length;for(let dt=N;Re<P;Re++)if(m.get(Re,S)!==dt)$[Fe]++;else{if(Fe===Ge-1){if(Vr.patternMatchVariance($,V,Vr.MAX_INDIVIDUAL_VARIANCE)<Vr.MAX_AVG_VARIANCE)return new Int32Array([te,Re]);te+=$[0]+$[1],Z.arraycopy($,2,$,0,Fe-1),$[Fe-1]=0,$[Fe]=0,Fe--}else Fe++;$[Fe]=1,dt=!dt}return Fe===Ge-1&&Vr.patternMatchVariance($,V,Vr.MAX_INDIVIDUAL_VARIANCE)<Vr.MAX_AVG_VARIANCE?new Int32Array([te,Re-1]):null}static patternMatchVariance(m,b,S){let P=m.length,N=0,V=0;for(let de=0;de<P;de++)N+=m[de],V+=b[de];if(N<V)return 1/0;let $=N/V;S*=$;let te=0;for(let de=0;de<P;de++){let Re=m[de],Fe=b[de]*$,Ge=Re>Fe?Re-Fe:Fe-Re;if(Ge>S)return 1/0;te+=Ge}return te/N}}Vr.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Vr.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Vr.MAX_AVG_VARIANCE=.42,Vr.MAX_INDIVIDUAL_VARIANCE=.8,Vr.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Vr.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Vr.MAX_PIXEL_DRIFT=3,Vr.MAX_PATTERN_DRIFT=5,Vr.SKIPPED_ROW_COUNT_MAX=25,Vr.ROW_STEP=5,Vr.BARCODE_MIN_HEIGHT=10;class vn{constructor(m,b){if(b.length===0)throw new F;this.field=m;let S=b.length;if(S>1&&b[0]===0){let P=1;for(;P<S&&b[P]===0;)P++;P===S?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(S-P),Z.arraycopy(b,P,this.coefficients,0,this.coefficients.length))}else this.coefficients=b}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(m){return this.coefficients[this.coefficients.length-1-m]}evaluateAt(m){if(m===0)return this.getCoefficient(0);if(m===1){let P=0;for(let N of this.coefficients)P=this.field.add(P,N);return P}let b=this.coefficients[0],S=this.coefficients.length;for(let P=1;P<S;P++)b=this.field.add(this.field.multiply(m,b),this.coefficients[P]);return b}add(m){if(!this.field.equals(m.field))throw new F("ModulusPolys do not have same ModulusGF field");if(this.isZero())return m;if(m.isZero())return this;let b=this.coefficients,S=m.coefficients;if(b.length>S.length){let V=b;b=S,S=V}let P=new Int32Array(S.length),N=S.length-b.length;Z.arraycopy(S,0,P,0,N);for(let V=N;V<S.length;V++)P[V]=this.field.add(b[V-N],S[V]);return new vn(this.field,P)}subtract(m){if(!this.field.equals(m.field))throw new F("ModulusPolys do not have same ModulusGF field");return m.isZero()?this:this.add(m.negative())}multiply(m){return m instanceof vn?this.multiplyOther(m):this.multiplyScalar(m)}multiplyOther(m){if(!this.field.equals(m.field))throw new F("ModulusPolys do not have same ModulusGF field");if(this.isZero()||m.isZero())return new vn(this.field,new Int32Array([0]));let b=this.coefficients,S=b.length,P=m.coefficients,N=P.length,V=new Int32Array(S+N-1);for(let $=0;$<S;$++){let te=b[$];for(let de=0;de<N;de++)V[$+de]=this.field.add(V[$+de],this.field.multiply(te,P[de]))}return new vn(this.field,V)}negative(){let m=this.coefficients.length,b=new Int32Array(m);for(let S=0;S<m;S++)b[S]=this.field.subtract(0,this.coefficients[S]);return new vn(this.field,b)}multiplyScalar(m){if(m===0)return new vn(this.field,new Int32Array([0]));if(m===1)return this;let b=this.coefficients.length,S=new Int32Array(b);for(let P=0;P<b;P++)S[P]=this.field.multiply(this.coefficients[P],m);return new vn(this.field,S)}multiplyByMonomial(m,b){if(m<0)throw new F;if(b===0)return new vn(this.field,new Int32Array([0]));let S=this.coefficients.length,P=new Int32Array(S+m);for(let N=0;N<S;N++)P[N]=this.field.multiply(this.coefficients[N],b);return new vn(this.field,P)}toString(){let m=new ze;for(let b=this.getDegree();b>=0;b--){let S=this.getCoefficient(b);S!==0&&(S<0?(m.append(" - "),S=-S):m.length()>0&&m.append(" + "),(b===0||S!==1)&&m.append(S),b!==0&&(b===1?m.append("x"):(m.append("x^"),m.append(b))))}return m.toString()}}class ui{add(m,b){return(m+b)%this.modulus}subtract(m,b){return(this.modulus+m-b)%this.modulus}exp(m){return this.expTable[m]}log(m){if(m===0)throw new F;return this.logTable[m]}inverse(m){if(m===0)throw new rr;return this.expTable[this.modulus-this.logTable[m]-1]}multiply(m,b){return m===0||b===0?0:this.expTable[(this.logTable[m]+this.logTable[b])%(this.modulus-1)]}getSize(){return this.modulus}equals(m){return m===this}}class Ur extends ui{constructor(m,b){super(),this.modulus=m,this.expTable=new Int32Array(m),this.logTable=new Int32Array(m);let S=1;for(let P=0;P<m;P++)this.expTable[P]=S,S=S*b%m;for(let P=0;P<m-1;P++)this.logTable[this.expTable[P]]=P;this.zero=new vn(this,new Int32Array([0])),this.one=new vn(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(m,b){if(m<0)throw new F;if(b===0)return this.zero;let S=new Int32Array(m+1);return S[0]=b,new vn(this,S)}}Ur.PDF417_GF=new Ur(Ir.NUMBER_OF_CODEWORDS,3);class oo{constructor(){this.field=Ur.PDF417_GF}decode(m,b,S){let P=new vn(this.field,m),N=new Int32Array(b),V=!1;for(let Ct=b;Ct>0;Ct--){let Pt=P.evaluateAt(this.field.exp(Ct));N[b-Ct]=Pt,Pt!==0&&(V=!0)}if(!V)return 0;let $=this.field.getOne();if(S!=null)for(const Ct of S){let Pt=this.field.exp(m.length-1-Ct),$t=new vn(this.field,new Int32Array([this.field.subtract(0,Pt),1]));$=$.multiply($t)}let te=new vn(this.field,N),de=this.runEuclideanAlgorithm(this.field.buildMonomial(b,1),te,b),Re=de[0],Fe=de[1],Ge=this.findErrorLocations(Re),dt=this.findErrorMagnitudes(Fe,Re,Ge);for(let Ct=0;Ct<Ge.length;Ct++){let Pt=m.length-1-this.field.log(Ge[Ct]);if(Pt<0)throw K.getChecksumInstance();m[Pt]=this.field.subtract(m[Pt],dt[Ct])}return Ge.length}runEuclideanAlgorithm(m,b,S){if(m.getDegree()<b.getDegree()){let Ge=m;m=b,b=Ge}let P=m,N=b,V=this.field.getZero(),$=this.field.getOne();for(;N.getDegree()>=Math.round(S/2);){let Ge=P,dt=V;if(P=N,V=$,P.isZero())throw K.getChecksumInstance();N=Ge;let Ct=this.field.getZero(),Pt=P.getCoefficient(P.getDegree()),$t=this.field.inverse(Pt);for(;N.getDegree()>=P.getDegree()&&!N.isZero();){let tn=N.getDegree()-P.getDegree(),Vn=this.field.multiply(N.getCoefficient(N.getDegree()),$t);Ct=Ct.add(this.field.buildMonomial(tn,Vn)),N=N.subtract(P.multiplyByMonomial(tn,Vn))}$=Ct.multiply(V).subtract(dt).negative()}let te=$.getCoefficient(0);if(te===0)throw K.getChecksumInstance();let de=this.field.inverse(te),Re=$.multiply(de),Fe=N.multiply(de);return[Re,Fe]}findErrorLocations(m){let b=m.getDegree(),S=new Int32Array(b),P=0;for(let N=1;N<this.field.getSize()&&P<b;N++)m.evaluateAt(N)===0&&(S[P]=this.field.inverse(N),P++);if(P!==b)throw K.getChecksumInstance();return S}findErrorMagnitudes(m,b,S){let P=b.getDegree(),N=new Int32Array(P);for(let de=1;de<=P;de++)N[P-de]=this.field.multiply(de,b.getCoefficient(de));let V=new vn(this.field,N),$=S.length,te=new Int32Array($);for(let de=0;de<$;de++){let Re=this.field.inverse(S[de]),Fe=this.field.subtract(0,m.evaluateAt(Re)),Ge=this.field.inverse(V.evaluateAt(Re));te[de]=this.field.multiply(Fe,Ge)}return te}}class Va{constructor(m,b,S,P,N){m instanceof Va?this.constructor_2(m):this.constructor_1(m,b,S,P,N)}constructor_1(m,b,S,P,N){const V=b==null||S==null,$=P==null||N==null;if(V&&$)throw new He;V?(b=new un(0,P.getY()),S=new un(0,N.getY())):$&&(P=new un(m.getWidth()-1,b.getY()),N=new un(m.getWidth()-1,S.getY())),this.image=m,this.topLeft=b,this.bottomLeft=S,this.topRight=P,this.bottomRight=N,this.minX=Math.trunc(Math.min(b.getX(),S.getX())),this.maxX=Math.trunc(Math.max(P.getX(),N.getX())),this.minY=Math.trunc(Math.min(b.getY(),P.getY())),this.maxY=Math.trunc(Math.max(S.getY(),N.getY()))}constructor_2(m){this.image=m.image,this.topLeft=m.getTopLeft(),this.bottomLeft=m.getBottomLeft(),this.topRight=m.getTopRight(),this.bottomRight=m.getBottomRight(),this.minX=m.getMinX(),this.maxX=m.getMaxX(),this.minY=m.getMinY(),this.maxY=m.getMaxY()}static merge(m,b){return m==null?b:b==null?m:new Va(m.image,m.topLeft,m.bottomLeft,b.topRight,b.bottomRight)}addMissingRows(m,b,S){let P=this.topLeft,N=this.bottomLeft,V=this.topRight,$=this.bottomRight;if(m>0){let te=S?this.topLeft:this.topRight,de=Math.trunc(te.getY()-m);de<0&&(de=0);let Re=new un(te.getX(),de);S?P=Re:V=Re}if(b>0){let te=S?this.bottomLeft:this.bottomRight,de=Math.trunc(te.getY()+b);de>=this.image.getHeight()&&(de=this.image.getHeight()-1);let Re=new un(te.getX(),de);S?N=Re:$=Re}return new Va(this.image,P,N,V,$)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Yr{constructor(m,b,S,P){this.columnCount=m,this.errorCorrectionLevel=P,this.rowCountUpperPart=b,this.rowCountLowerPart=S,this.rowCount=b+S}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Oo{constructor(){this.buffer=""}static form(m,b){let S=-1;function P(V,$,te,de,Re,Fe){if(V==="%%")return"%";if(b[++S]===void 0)return;V=de?parseInt(de.substr(1)):void 0;let Ge=Re?parseInt(Re.substr(1)):void 0,dt;switch(Fe){case"s":dt=b[S];break;case"c":dt=b[S][0];break;case"f":dt=parseFloat(b[S]).toFixed(V);break;case"p":dt=parseFloat(b[S]).toPrecision(V);break;case"e":dt=parseFloat(b[S]).toExponential(V);break;case"x":dt=parseInt(b[S]).toString(Ge||16);break;case"d":dt=parseFloat(parseInt(b[S],Ge||10).toPrecision(V)).toFixed(0);break}dt=typeof dt=="object"?JSON.stringify(dt):(+dt).toString(Ge);let Ct=parseInt(te),Pt=te&&te[0]+""=="0"?"0":" ";for(;dt.length<Ct;)dt=$!==void 0?dt+Pt:Pt+dt;return dt}let N=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return m.replace(N,P)}format(m,...b){this.buffer+=Oo.form(m,b)}toString(){return this.buffer}}class Pl{constructor(m){this.boundingBox=new Va(m),this.codewords=new Array(m.getMaxY()-m.getMinY()+1)}getCodewordNearby(m){let b=this.getCodeword(m);if(b!=null)return b;for(let S=1;S<Pl.MAX_NEARBY_DISTANCE;S++){let P=this.imageRowToCodewordIndex(m)-S;if(P>=0&&(b=this.codewords[P],b!=null)||(P=this.imageRowToCodewordIndex(m)+S,P<this.codewords.length&&(b=this.codewords[P],b!=null)))return b}return null}imageRowToCodewordIndex(m){return m-this.boundingBox.getMinY()}setCodeword(m,b){this.codewords[this.imageRowToCodewordIndex(m)]=b}getCodeword(m){return this.codewords[this.imageRowToCodewordIndex(m)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const m=new Oo;let b=0;for(const S of this.codewords){if(S==null){m.format("%3d:    |   %n",b++);continue}m.format("%3d: %3d|%3d%n",b++,S.getRowNumber(),S.getValue())}return m.toString()}}Pl.MAX_NEARBY_DISTANCE=5;class sa{constructor(){this.values=new Map}setValue(m){m=Math.trunc(m);let b=this.values.get(m);b==null&&(b=0),b++,this.values.set(m,b)}getValue(){let m=-1,b=new Array;for(const[S,P]of this.values.entries()){const N={getKey:()=>S,getValue:()=>P};N.getValue()>m?(m=N.getValue(),b=[],b.push(N.getKey())):N.getValue()===m&&b.push(N.getKey())}return Ir.toIntArray(b)}getConfidence(m){return this.values.get(m)}}class Ci extends Pl{constructor(m,b){super(m),this._isLeft=b}setRowNumbers(){for(let m of this.getCodewords())m?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(m){let b=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(b,m);let S=this.getBoundingBox(),P=this._isLeft?S.getTopLeft():S.getTopRight(),N=this._isLeft?S.getBottomLeft():S.getBottomRight(),V=this.imageRowToCodewordIndex(Math.trunc(P.getY())),$=this.imageRowToCodewordIndex(Math.trunc(N.getY())),te=-1,de=1,Re=0;for(let Fe=V;Fe<$;Fe++){if(b[Fe]==null)continue;let Ge=b[Fe],dt=Ge.getRowNumber()-te;if(dt===0)Re++;else if(dt===1)de=Math.max(de,Re),Re=1,te=Ge.getRowNumber();else if(dt<0||Ge.getRowNumber()>=m.getRowCount()||dt>Fe)b[Fe]=null;else{let Ct;de>2?Ct=(de-2)*dt:Ct=dt;let Pt=Ct>=Fe;for(let $t=1;$t<=Ct&&!Pt;$t++)Pt=b[Fe-$t]!=null;Pt?b[Fe]=null:(te=Ge.getRowNumber(),Re=1)}}}getRowHeights(){let m=this.getBarcodeMetadata();if(m==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(m);let b=new Int32Array(m.getRowCount());for(let S of this.getCodewords())if(S!=null){let P=S.getRowNumber();if(P>=b.length)continue;b[P]++}return b}adjustIncompleteIndicatorColumnRowNumbers(m){let b=this.getBoundingBox(),S=this._isLeft?b.getTopLeft():b.getTopRight(),P=this._isLeft?b.getBottomLeft():b.getBottomRight(),N=this.imageRowToCodewordIndex(Math.trunc(S.getY())),V=this.imageRowToCodewordIndex(Math.trunc(P.getY())),$=this.getCodewords(),te=-1;for(let de=N;de<V;de++){if($[de]==null)continue;let Re=$[de];Re.setRowNumberAsRowIndicatorColumn();let Fe=Re.getRowNumber()-te;Fe===0||(Fe===1?te=Re.getRowNumber():Re.getRowNumber()>=m.getRowCount()?$[de]=null:te=Re.getRowNumber())}}getBarcodeMetadata(){let m=this.getCodewords(),b=new sa,S=new sa,P=new sa,N=new sa;for(let $ of m){if($==null)continue;$.setRowNumberAsRowIndicatorColumn();let te=$.getValue()%30,de=$.getRowNumber();switch(this._isLeft||(de+=2),de%3){case 0:S.setValue(te*3+1);break;case 1:N.setValue(te/3),P.setValue(te%3);break;case 2:b.setValue(te+1);break}}if(b.getValue().length===0||S.getValue().length===0||P.getValue().length===0||N.getValue().length===0||b.getValue()[0]<1||S.getValue()[0]+P.getValue()[0]<Ir.MIN_ROWS_IN_BARCODE||S.getValue()[0]+P.getValue()[0]>Ir.MAX_ROWS_IN_BARCODE)return null;let V=new Yr(b.getValue()[0],S.getValue()[0],P.getValue()[0],N.getValue()[0]);return this.removeIncorrectCodewords(m,V),V}removeIncorrectCodewords(m,b){for(let S=0;S<m.length;S++){let P=m[S];if(m[S]==null)continue;let N=P.getValue()%30,V=P.getRowNumber();if(V>b.getRowCount()){m[S]=null;continue}switch(this._isLeft||(V+=2),V%3){case 0:N*3+1!==b.getRowCountUpperPart()&&(m[S]=null);break;case 1:(Math.trunc(N/3)!==b.getErrorCorrectionLevel()||N%3!==b.getRowCountLowerPart())&&(m[S]=null);break;case 2:N+1!==b.getColumnCount()&&(m[S]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class us{constructor(m,b){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=m,this.barcodeColumnCount=m.getColumnCount(),this.boundingBox=b,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let m=Ir.MAX_CODEWORDS_IN_BARCODE,b;do b=m,m=this.adjustRowNumbersAndGetCount();while(m>0&&m<b);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(m){m?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let m=this.adjustRowNumbersByRow();if(m===0)return 0;for(let b=1;b<this.barcodeColumnCount+1;b++){let S=this.detectionResultColumns[b].getCodewords();for(let P=0;P<S.length;P++)S[P]!=null&&(S[P].hasValidRowNumber()||this.adjustRowNumbers(b,P,S))}return m}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let m=this.detectionResultColumns[0].getCodewords(),b=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let S=0;S<m.length;S++)if(m[S]!=null&&b[S]!=null&&m[S].getRowNumber()===b[S].getRowNumber())for(let P=1;P<=this.barcodeColumnCount;P++){let N=this.detectionResultColumns[P].getCodewords()[S];N!=null&&(N.setRowNumber(m[S].getRowNumber()),N.hasValidRowNumber()||(this.detectionResultColumns[P].getCodewords()[S]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let m=0,b=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let S=0;S<b.length;S++){if(b[S]==null)continue;let P=b[S].getRowNumber(),N=0;for(let V=this.barcodeColumnCount+1;V>0&&N<this.ADJUST_ROW_NUMBER_SKIP;V--){let $=this.detectionResultColumns[V].getCodewords()[S];$!=null&&(N=us.adjustRowNumberIfValid(P,N,$),$.hasValidRowNumber()||m++)}}return m}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let m=0,b=this.detectionResultColumns[0].getCodewords();for(let S=0;S<b.length;S++){if(b[S]==null)continue;let P=b[S].getRowNumber(),N=0;for(let V=1;V<this.barcodeColumnCount+1&&N<this.ADJUST_ROW_NUMBER_SKIP;V++){let $=this.detectionResultColumns[V].getCodewords()[S];$!=null&&(N=us.adjustRowNumberIfValid(P,N,$),$.hasValidRowNumber()||m++)}}return m}static adjustRowNumberIfValid(m,b,S){return S==null||S.hasValidRowNumber()||(S.isValidRowNumber(m)?(S.setRowNumber(m),b=0):++b),b}adjustRowNumbers(m,b,S){if(!this.detectionResultColumns[m-1])return;let P=S[b],N=this.detectionResultColumns[m-1].getCodewords(),V=N;this.detectionResultColumns[m+1]!=null&&(V=this.detectionResultColumns[m+1].getCodewords());let $=new Array(14);$[2]=N[b],$[3]=V[b],b>0&&($[0]=S[b-1],$[4]=N[b-1],$[5]=V[b-1]),b>1&&($[8]=S[b-2],$[10]=N[b-2],$[11]=V[b-2]),b<S.length-1&&($[1]=S[b+1],$[6]=N[b+1],$[7]=V[b+1]),b<S.length-2&&($[9]=S[b+2],$[12]=N[b+2],$[13]=V[b+2]);for(let te of $)if(us.adjustRowNumber(P,te))return}static adjustRowNumber(m,b){return b==null?!1:b.hasValidRowNumber()&&b.getBucket()===m.getBucket()?(m.setRowNumber(b.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(m){this.boundingBox=m}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(m,b){this.detectionResultColumns[m]=b}getDetectionResultColumn(m){return this.detectionResultColumns[m]}toString(){let m=this.detectionResultColumns[0];m==null&&(m=this.detectionResultColumns[this.barcodeColumnCount+1]);let b=new Oo;for(let S=0;S<m.getCodewords().length;S++){b.format("CW %3d:",S);for(let P=0;P<this.barcodeColumnCount+2;P++){if(this.detectionResultColumns[P]==null){b.format("    |   ");continue}let N=this.detectionResultColumns[P].getCodewords()[S];if(N==null){b.format("    |   ");continue}b.format(" %3d|%3d",N.getRowNumber(),N.getValue())}b.format("%n")}return b.toString()}}class oa{constructor(m,b,S,P){this.rowNumber=oa.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(m),this.endX=Math.trunc(b),this.bucket=Math.trunc(S),this.value=Math.trunc(P)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(m){return m!==oa.BARCODE_ROW_UNKNOWN&&this.bucket===m%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(m){this.rowNumber=m}toString(){return this.rowNumber+"|"+this.value}}oa.BARCODE_ROW_UNKNOWN=-1;class po{static initialize(){for(let m=0;m<Ir.SYMBOL_TABLE.length;m++){let b=Ir.SYMBOL_TABLE[m],S=b&1;for(let P=0;P<Ir.BARS_IN_MODULE;P++){let N=0;for(;(b&1)===S;)N+=1,b>>=1;S=b&1,po.RATIOS_TABLE[m]||(po.RATIOS_TABLE[m]=new Array(Ir.BARS_IN_MODULE)),po.RATIOS_TABLE[m][Ir.BARS_IN_MODULE-P-1]=Math.fround(N/Ir.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(m){let b=po.getDecodedCodewordValue(po.sampleBitCounts(m));return b!==-1?b:po.getClosestDecodedValue(m)}static sampleBitCounts(m){let b=jt.sum(m),S=new Int32Array(Ir.BARS_IN_MODULE),P=0,N=0;for(let V=0;V<Ir.MODULES_IN_CODEWORD;V++){let $=b/(2*Ir.MODULES_IN_CODEWORD)+V*b/Ir.MODULES_IN_CODEWORD;N+m[P]<=$&&(N+=m[P],P++),S[P]++}return S}static getDecodedCodewordValue(m){let b=po.getBitValue(m);return Ir.getCodeword(b)===-1?-1:b}static getBitValue(m){let b=0;for(let S=0;S<m.length;S++)for(let P=0;P<m[S];P++)b=b<<1|(S%2===0?1:0);return Math.trunc(b)}static getClosestDecodedValue(m){let b=jt.sum(m),S=new Array(Ir.BARS_IN_MODULE);if(b>1)for(let V=0;V<S.length;V++)S[V]=Math.fround(m[V]/b);let P=Ln.MAX_VALUE,N=-1;this.bSymbolTableReady||po.initialize();for(let V=0;V<po.RATIOS_TABLE.length;V++){let $=0,te=po.RATIOS_TABLE[V];for(let de=0;de<Ir.BARS_IN_MODULE;de++){let Re=Math.fround(te[de]-S[de]);if($+=Math.fround(Re*Re),$>=P)break}$<P&&(P=$,N=Ir.SYMBOL_TABLE[V])}return N}}po.bSymbolTableReady=!1,po.RATIOS_TABLE=new Array(Ir.SYMBOL_TABLE.length).map(Ne=>new Array(Ir.BARS_IN_MODULE));class Qu{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(m){this.segmentIndex=m}getFileId(){return this.fileId}setFileId(m){this.fileId=m}getOptionalData(){return this.optionalData}setOptionalData(m){this.optionalData=m}isLastSegment(){return this.lastSegment}setLastSegment(m){this.lastSegment=m}getSegmentCount(){return this.segmentCount}setSegmentCount(m){this.segmentCount=m}getSender(){return this.sender||null}setSender(m){this.sender=m}getAddressee(){return this.addressee||null}setAddressee(m){this.addressee=m}getFileName(){return this.fileName}setFileName(m){this.fileName=m}getFileSize(){return this.fileSize}setFileSize(m){this.fileSize=m}getChecksum(){return this.checksum}setChecksum(m){this.checksum=m}getTimestamp(){return this.timestamp}setTimestamp(m){this.timestamp=m}}class Cc{static parseLong(m,b=void 0){return parseInt(m,b)}}class Ic extends w{}Ic.kind="NullPointerException";class Cu{writeBytes(m){this.writeBytesOffset(m,0,m.length)}writeBytesOffset(m,b,S){if(m==null)throw new Ic;if(b<0||b>m.length||S<0||b+S>m.length||b+S<0)throw new oe;if(S===0)return;for(let P=0;P<S;P++)this.write(m[b+P])}flush(){}close(){}}class Rs extends w{}class hl extends Cu{constructor(m=32){if(super(),this.count=0,m<0)throw new F("Negative initial size: "+m);this.buf=new Uint8Array(m)}ensureCapacity(m){m-this.buf.length>0&&this.grow(m)}grow(m){let S=this.buf.length<<1;if(S-m<0&&(S=m),S<0){if(m<0)throw new Rs;S=pe.MAX_VALUE}this.buf=me.copyOfUint8Array(this.buf,S)}write(m){this.ensureCapacity(this.count+1),this.buf[this.count]=m,this.count+=1}writeBytesOffset(m,b,S){if(b<0||b>m.length||S<0||b+S-m.length>0)throw new oe;this.ensureCapacity(this.count+S),Z.arraycopy(m,b,this.buf,this.count,S),this.count+=S}writeTo(m){m.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return me.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(m){return m?typeof m=="string"?this.toString_string(m):this.toString_number(m):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(m){return new String(this.buf).toString()}toString_number(m){return new String(this.buf).toString()}close(){}}var hi;(function(Ne){Ne[Ne.ALPHA=0]="ALPHA",Ne[Ne.LOWER=1]="LOWER",Ne[Ne.MIXED=2]="MIXED",Ne[Ne.PUNCT=3]="PUNCT",Ne[Ne.ALPHA_SHIFT=4]="ALPHA_SHIFT",Ne[Ne.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(hi||(hi={}));function Dl(){if(typeof window<"u")return window.BigInt||null;if(typeof $0<"u")return $0.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let aa;function Ki(Ne){if(typeof aa>"u"&&(aa=Dl()),aa===null)throw new Error("BigInt is not supported!");return aa(Ne)}function Gs(){let Ne=[];Ne[0]=Ki(1);let m=Ki(900);Ne[1]=m;for(let b=2;b<16;b++)Ne[b]=Ne[b-1]*m;return Ne}class Zt{static decode(m,b){let S=new ze(""),P=ye.ISO8859_1;S.enableDecoding(P);let N=1,V=m[N++],$=new Qu;for(;N<m[0];){switch(V){case Zt.TEXT_COMPACTION_MODE_LATCH:N=Zt.textCompaction(m,N,S);break;case Zt.BYTE_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH_6:N=Zt.byteCompaction(V,m,P,N,S);break;case Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:S.append(m[N++]);break;case Zt.NUMERIC_COMPACTION_MODE_LATCH:N=Zt.numericCompaction(m,N,S);break;case Zt.ECI_CHARSET:ye.getCharacterSetECIByValue(m[N++]);break;case Zt.ECI_GENERAL_PURPOSE:N+=2;break;case Zt.ECI_USER_DEFINED:N++;break;case Zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:N=Zt.decodeMacroBlock(m,N,$);break;case Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Zt.MACRO_PDF417_TERMINATOR:throw new re;default:N--,N=Zt.textCompaction(m,N,S);break}if(N<m.length)V=m[N++];else throw re.getFormatInstance()}if(S.length()===0)throw re.getFormatInstance();let te=new br(null,S.toString(),null,b);return te.setOther($),te}static decodeMacroBlock(m,b,S){if(b+Zt.NUMBER_OF_SEQUENCE_CODEWORDS>m[0])throw re.getFormatInstance();let P=new Int32Array(Zt.NUMBER_OF_SEQUENCE_CODEWORDS);for(let $=0;$<Zt.NUMBER_OF_SEQUENCE_CODEWORDS;$++,b++)P[$]=m[b];S.setSegmentIndex(pe.parseInt(Zt.decodeBase900toBase10(P,Zt.NUMBER_OF_SEQUENCE_CODEWORDS)));let N=new ze;b=Zt.textCompaction(m,b,N),S.setFileId(N.toString());let V=-1;for(m[b]===Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(V=b+1);b<m[0];)switch(m[b]){case Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(b++,m[b]){case Zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let $=new ze;b=Zt.textCompaction(m,b+1,$),S.setFileName($.toString());break;case Zt.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let te=new ze;b=Zt.textCompaction(m,b+1,te),S.setSender(te.toString());break;case Zt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let de=new ze;b=Zt.textCompaction(m,b+1,de),S.setAddressee(de.toString());break;case Zt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let Re=new ze;b=Zt.numericCompaction(m,b+1,Re),S.setSegmentCount(pe.parseInt(Re.toString()));break;case Zt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let Fe=new ze;b=Zt.numericCompaction(m,b+1,Fe),S.setTimestamp(Cc.parseLong(Fe.toString()));break;case Zt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let Ge=new ze;b=Zt.numericCompaction(m,b+1,Ge),S.setChecksum(pe.parseInt(Ge.toString()));break;case Zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let dt=new ze;b=Zt.numericCompaction(m,b+1,dt),S.setFileSize(Cc.parseLong(dt.toString()));break;default:throw re.getFormatInstance()}break;case Zt.MACRO_PDF417_TERMINATOR:b++,S.setLastSegment(!0);break;default:throw re.getFormatInstance()}if(V!==-1){let $=b-V;S.isLastSegment()&&$--,S.setOptionalData(me.copyOfRange(m,V,V+$))}return b}static textCompaction(m,b,S){let P=new Int32Array((m[0]-b)*2),N=new Int32Array((m[0]-b)*2),V=0,$=!1;for(;b<m[0]&&!$;){let te=m[b++];if(te<Zt.TEXT_COMPACTION_MODE_LATCH)P[V]=te/30,P[V+1]=te%30,V+=2;else switch(te){case Zt.TEXT_COMPACTION_MODE_LATCH:P[V++]=Zt.TEXT_COMPACTION_MODE_LATCH;break;case Zt.BYTE_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH_6:case Zt.NUMERIC_COMPACTION_MODE_LATCH:case Zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Zt.MACRO_PDF417_TERMINATOR:b--,$=!0;break;case Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:P[V]=Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,te=m[b++],N[V]=te,V++;break}}return Zt.decodeTextCompaction(P,N,V,S),b}static decodeTextCompaction(m,b,S,P){let N=hi.ALPHA,V=hi.ALPHA,$=0;for(;$<S;){let te=m[$],de="";switch(N){case hi.ALPHA:if(te<26)de=String.fromCharCode(65+te);else switch(te){case 26:de=" ";break;case Zt.LL:N=hi.LOWER;break;case Zt.ML:N=hi.MIXED;break;case Zt.PS:V=N,N=hi.PUNCT_SHIFT;break;case Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:P.append(b[$]);break;case Zt.TEXT_COMPACTION_MODE_LATCH:N=hi.ALPHA;break}break;case hi.LOWER:if(te<26)de=String.fromCharCode(97+te);else switch(te){case 26:de=" ";break;case Zt.AS:V=N,N=hi.ALPHA_SHIFT;break;case Zt.ML:N=hi.MIXED;break;case Zt.PS:V=N,N=hi.PUNCT_SHIFT;break;case Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:P.append(b[$]);break;case Zt.TEXT_COMPACTION_MODE_LATCH:N=hi.ALPHA;break}break;case hi.MIXED:if(te<Zt.PL)de=Zt.MIXED_CHARS[te];else switch(te){case Zt.PL:N=hi.PUNCT;break;case 26:de=" ";break;case Zt.LL:N=hi.LOWER;break;case Zt.AL:N=hi.ALPHA;break;case Zt.PS:V=N,N=hi.PUNCT_SHIFT;break;case Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:P.append(b[$]);break;case Zt.TEXT_COMPACTION_MODE_LATCH:N=hi.ALPHA;break}break;case hi.PUNCT:if(te<Zt.PAL)de=Zt.PUNCT_CHARS[te];else switch(te){case Zt.PAL:N=hi.ALPHA;break;case Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:P.append(b[$]);break;case Zt.TEXT_COMPACTION_MODE_LATCH:N=hi.ALPHA;break}break;case hi.ALPHA_SHIFT:if(N=V,te<26)de=String.fromCharCode(65+te);else switch(te){case 26:de=" ";break;case Zt.TEXT_COMPACTION_MODE_LATCH:N=hi.ALPHA;break}break;case hi.PUNCT_SHIFT:if(N=V,te<Zt.PAL)de=Zt.PUNCT_CHARS[te];else switch(te){case Zt.PAL:N=hi.ALPHA;break;case Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:P.append(b[$]);break;case Zt.TEXT_COMPACTION_MODE_LATCH:N=hi.ALPHA;break}break}de!==""&&P.append(de),$++}}static byteCompaction(m,b,S,P,N){let V=new hl,$=0,te=0,de=!1;switch(m){case Zt.BYTE_COMPACTION_MODE_LATCH:let Re=new Int32Array(6),Fe=b[P++];for(;P<b[0]&&!de;)switch(Re[$++]=Fe,te=900*te+Fe,Fe=b[P++],Fe){case Zt.TEXT_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH:case Zt.NUMERIC_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH_6:case Zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Zt.MACRO_PDF417_TERMINATOR:P--,de=!0;break;default:if($%5===0&&$>0){for(let Ge=0;Ge<6;++Ge)V.write(Number(Ki(te)>>Ki(8*(5-Ge))));te=0,$=0}break}P===b[0]&&Fe<Zt.TEXT_COMPACTION_MODE_LATCH&&(Re[$++]=Fe);for(let Ge=0;Ge<$;Ge++)V.write(Re[Ge]);break;case Zt.BYTE_COMPACTION_MODE_LATCH_6:for(;P<b[0]&&!de;){let Ge=b[P++];if(Ge<Zt.TEXT_COMPACTION_MODE_LATCH)$++,te=900*te+Ge;else switch(Ge){case Zt.TEXT_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH:case Zt.NUMERIC_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH_6:case Zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Zt.MACRO_PDF417_TERMINATOR:P--,de=!0;break}if($%5===0&&$>0){for(let dt=0;dt<6;++dt)V.write(Number(Ki(te)>>Ki(8*(5-dt))));te=0,$=0}}break}return N.append(Ie.decode(V.toByteArray(),S)),P}static numericCompaction(m,b,S){let P=0,N=!1,V=new Int32Array(Zt.MAX_NUMERIC_CODEWORDS);for(;b<m[0]&&!N;){let $=m[b++];if(b===m[0]&&(N=!0),$<Zt.TEXT_COMPACTION_MODE_LATCH)V[P]=$,P++;else switch($){case Zt.TEXT_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH:case Zt.BYTE_COMPACTION_MODE_LATCH_6:case Zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Zt.MACRO_PDF417_TERMINATOR:b--,N=!0;break}(P%Zt.MAX_NUMERIC_CODEWORDS===0||$===Zt.NUMERIC_COMPACTION_MODE_LATCH||N)&&P>0&&(S.append(Zt.decodeBase900toBase10(V,P)),P=0)}return b}static decodeBase900toBase10(m,b){let S=Ki(0);for(let N=0;N<b;N++)S+=Zt.EXP900[b-N-1]*Ki(m[N]);let P=S.toString();if(P.charAt(0)!=="1")throw new re;return P.substring(1)}}Zt.TEXT_COMPACTION_MODE_LATCH=900,Zt.BYTE_COMPACTION_MODE_LATCH=901,Zt.NUMERIC_COMPACTION_MODE_LATCH=902,Zt.BYTE_COMPACTION_MODE_LATCH_6=924,Zt.ECI_USER_DEFINED=925,Zt.ECI_GENERAL_PURPOSE=926,Zt.ECI_CHARSET=927,Zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,Zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,Zt.MACRO_PDF417_TERMINATOR=922,Zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,Zt.MAX_NUMERIC_CODEWORDS=15,Zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,Zt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,Zt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,Zt.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,Zt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,Zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,Zt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,Zt.PL=25,Zt.LL=27,Zt.AS=27,Zt.ML=28,Zt.AL=28,Zt.PS=29,Zt.PAL=29,Zt.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,Zt.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",Zt.EXP900=Dl()?Gs():[],Zt.NUMBER_OF_SEQUENCE_CODEWORDS=2;class _r{constructor(){}static decode(m,b,S,P,N,V,$){let te=new Va(m,b,S,P,N),de=null,Re=null,Fe;for(let Ct=!0;;Ct=!1){if(b!=null&&(de=_r.getRowIndicatorColumn(m,te,b,!0,V,$)),P!=null&&(Re=_r.getRowIndicatorColumn(m,te,P,!1,V,$)),Fe=_r.merge(de,Re),Fe==null)throw He.getNotFoundInstance();let Pt=Fe.getBoundingBox();if(Ct&&Pt!=null&&(Pt.getMinY()<te.getMinY()||Pt.getMaxY()>te.getMaxY()))te=Pt;else break}Fe.setBoundingBox(te);let Ge=Fe.getBarcodeColumnCount()+1;Fe.setDetectionResultColumn(0,de),Fe.setDetectionResultColumn(Ge,Re);let dt=de!=null;for(let Ct=1;Ct<=Ge;Ct++){let Pt=dt?Ct:Ge-Ct;if(Fe.getDetectionResultColumn(Pt)!==void 0)continue;let $t;Pt===0||Pt===Ge?$t=new Ci(te,Pt===0):$t=new Pl(te),Fe.setDetectionResultColumn(Pt,$t);let tn=-1,Vn=tn;for(let zn=te.getMinY();zn<=te.getMaxY();zn++){if(tn=_r.getStartColumn(Fe,Pt,zn,dt),tn<0||tn>te.getMaxX()){if(Vn===-1)continue;tn=Vn}let Dn=_r.detectCodeword(m,te.getMinX(),te.getMaxX(),dt,tn,zn,V,$);Dn!=null&&($t.setCodeword(zn,Dn),Vn=tn,V=Math.min(V,Dn.getWidth()),$=Math.max($,Dn.getWidth()))}}return _r.createDecoderResult(Fe)}static merge(m,b){if(m==null&&b==null)return null;let S=_r.getBarcodeMetadata(m,b);if(S==null)return null;let P=Va.merge(_r.adjustBoundingBox(m),_r.adjustBoundingBox(b));return new us(S,P)}static adjustBoundingBox(m){if(m==null)return null;let b=m.getRowHeights();if(b==null)return null;let S=_r.getMax(b),P=0;for(let $ of b)if(P+=S-$,$>0)break;let N=m.getCodewords();for(let $=0;P>0&&N[$]==null;$++)P--;let V=0;for(let $=b.length-1;$>=0&&(V+=S-b[$],!(b[$]>0));$--);for(let $=N.length-1;V>0&&N[$]==null;$--)V--;return m.getBoundingBox().addMissingRows(P,V,m.isLeft())}static getMax(m){let b=-1;for(let S of m)b=Math.max(b,S);return b}static getBarcodeMetadata(m,b){let S;if(m==null||(S=m.getBarcodeMetadata())==null)return b==null?null:b.getBarcodeMetadata();let P;return b==null||(P=b.getBarcodeMetadata())==null?S:S.getColumnCount()!==P.getColumnCount()&&S.getErrorCorrectionLevel()!==P.getErrorCorrectionLevel()&&S.getRowCount()!==P.getRowCount()?null:S}static getRowIndicatorColumn(m,b,S,P,N,V){let $=new Ci(b,P);for(let te=0;te<2;te++){let de=te===0?1:-1,Re=Math.trunc(Math.trunc(S.getX()));for(let Fe=Math.trunc(Math.trunc(S.getY()));Fe<=b.getMaxY()&&Fe>=b.getMinY();Fe+=de){let Ge=_r.detectCodeword(m,0,m.getWidth(),P,Re,Fe,N,V);Ge!=null&&($.setCodeword(Fe,Ge),P?Re=Ge.getStartX():Re=Ge.getEndX())}}return $}static adjustCodewordCount(m,b){let S=b[0][1],P=S.getValue(),N=m.getBarcodeColumnCount()*m.getBarcodeRowCount()-_r.getNumberOfECCodeWords(m.getBarcodeECLevel());if(P.length===0){if(N<1||N>Ir.MAX_CODEWORDS_IN_BARCODE)throw He.getNotFoundInstance();S.setValue(N)}else P[0]!==N&&S.setValue(N)}static createDecoderResult(m){let b=_r.createBarcodeMatrix(m);_r.adjustCodewordCount(m,b);let S=new Array,P=new Int32Array(m.getBarcodeRowCount()*m.getBarcodeColumnCount()),N=[],V=new Array;for(let te=0;te<m.getBarcodeRowCount();te++)for(let de=0;de<m.getBarcodeColumnCount();de++){let Re=b[te][de+1].getValue(),Fe=te*m.getBarcodeColumnCount()+de;Re.length===0?S.push(Fe):Re.length===1?P[Fe]=Re[0]:(V.push(Fe),N.push(Re))}let $=new Array(N.length);for(let te=0;te<$.length;te++)$[te]=N[te];return _r.createDecoderResultFromAmbiguousValues(m.getBarcodeECLevel(),P,Ir.toIntArray(S),Ir.toIntArray(V),$)}static createDecoderResultFromAmbiguousValues(m,b,S,P,N){let V=new Int32Array(P.length),$=100;for(;$-- >0;){for(let te=0;te<V.length;te++)b[P[te]]=N[te][V[te]];try{return _r.decodeCodewords(b,m,S)}catch(te){if(!(te instanceof K))throw te}if(V.length===0)throw K.getChecksumInstance();for(let te=0;te<V.length;te++)if(V[te]<N[te].length-1){V[te]++;break}else if(V[te]=0,te===V.length-1)throw K.getChecksumInstance()}throw K.getChecksumInstance()}static createBarcodeMatrix(m){let b=Array.from({length:m.getBarcodeRowCount()},()=>new Array(m.getBarcodeColumnCount()+2));for(let P=0;P<b.length;P++)for(let N=0;N<b[P].length;N++)b[P][N]=new sa;let S=0;for(let P of m.getDetectionResultColumns()){if(P!=null){for(let N of P.getCodewords())if(N!=null){let V=N.getRowNumber();if(V>=0){if(V>=b.length)continue;b[V][S].setValue(N.getValue())}}}S++}return b}static isValidBarcodeColumn(m,b){return b>=0&&b<=m.getBarcodeColumnCount()+1}static getStartColumn(m,b,S,P){let N=P?1:-1,V=null;if(_r.isValidBarcodeColumn(m,b-N)&&(V=m.getDetectionResultColumn(b-N).getCodeword(S)),V!=null)return P?V.getEndX():V.getStartX();if(V=m.getDetectionResultColumn(b).getCodewordNearby(S),V!=null)return P?V.getStartX():V.getEndX();if(_r.isValidBarcodeColumn(m,b-N)&&(V=m.getDetectionResultColumn(b-N).getCodewordNearby(S)),V!=null)return P?V.getEndX():V.getStartX();let $=0;for(;_r.isValidBarcodeColumn(m,b-N);){b-=N;for(let te of m.getDetectionResultColumn(b).getCodewords())if(te!=null)return(P?te.getEndX():te.getStartX())+N*$*(te.getEndX()-te.getStartX());$++}return P?m.getBoundingBox().getMinX():m.getBoundingBox().getMaxX()}static detectCodeword(m,b,S,P,N,V,$,te){N=_r.adjustCodewordStartColumn(m,b,S,P,N,V);let de=_r.getModuleBitCount(m,b,S,P,N,V);if(de==null)return null;let Re,Fe=jt.sum(de);if(P)Re=N+Fe;else{for(let Ct=0;Ct<de.length/2;Ct++){let Pt=de[Ct];de[Ct]=de[de.length-1-Ct],de[de.length-1-Ct]=Pt}Re=N,N=Re-Fe}if(!_r.checkCodewordSkew(Fe,$,te))return null;let Ge=po.getDecodedValue(de),dt=Ir.getCodeword(Ge);return dt===-1?null:new oa(N,Re,_r.getCodewordBucketNumber(Ge),dt)}static getModuleBitCount(m,b,S,P,N,V){let $=N,te=new Int32Array(8),de=0,Re=P?1:-1,Fe=P;for(;(P?$<S:$>=b)&&de<te.length;)m.get($,V)===Fe?(te[de]++,$+=Re):(de++,Fe=!Fe);return de===te.length||$===(P?S:b)&&de===te.length-1?te:null}static getNumberOfECCodeWords(m){return 2<<m}static adjustCodewordStartColumn(m,b,S,P,N,V){let $=N,te=P?-1:1;for(let de=0;de<2;de++){for(;(P?$>=b:$<S)&&P===m.get($,V);){if(Math.abs(N-$)>_r.CODEWORD_SKEW_SIZE)return N;$+=te}te=-te,P=!P}return $}static checkCodewordSkew(m,b,S){return b-_r.CODEWORD_SKEW_SIZE<=m&&m<=S+_r.CODEWORD_SKEW_SIZE}static decodeCodewords(m,b,S){if(m.length===0)throw re.getFormatInstance();let P=1<<b+1,N=_r.correctErrors(m,S,P);_r.verifyCodewordCount(m,P);let V=Zt.decode(m,""+b);return V.setErrorsCorrected(N),V.setErasures(S.length),V}static correctErrors(m,b,S){if(b!=null&&b.length>S/2+_r.MAX_ERRORS||S<0||S>_r.MAX_EC_CODEWORDS)throw K.getChecksumInstance();return _r.errorCorrection.decode(m,S,b)}static verifyCodewordCount(m,b){if(m.length<4)throw re.getFormatInstance();let S=m[0];if(S>m.length)throw re.getFormatInstance();if(S===0)if(b<m.length)m[0]=m.length-b;else throw re.getFormatInstance()}static getBitCountForCodeword(m){let b=new Int32Array(8),S=0,P=b.length-1;for(;!((m&1)!==S&&(S=m&1,P--,P<0));)b[P]++,m>>=1;return b}static getCodewordBucketNumber(m){return m instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(m):this.getCodewordBucketNumber_number(m)}static getCodewordBucketNumber_number(m){return _r.getCodewordBucketNumber(_r.getBitCountForCodeword(m))}static getCodewordBucketNumber_Int32Array(m){return(m[0]-m[2]+m[4]-m[6]+9)%9}static toString(m){let b=new Oo;for(let S=0;S<m.length;S++){b.format("Row %2d: ",S);for(let P=0;P<m[S].length;P++){let N=m[S][P];N.getValue().length===0?b.format("        ",null):b.format("%4d(%2d)",N.getValue()[0],N.getConfidence(N.getValue()[0]))}b.format("%n")}return b.toString()}}_r.CODEWORD_SKEW_SIZE=2,_r.MAX_ERRORS=3,_r.MAX_EC_CODEWORDS=512,_r.errorCorrection=new oo;class vo{decode(m,b=null){let S=vo.decode(m,b,!1);if(S==null||S.length===0||S[0]==null)throw He.getNotFoundInstance();return S[0]}decodeMultiple(m,b=null){try{return vo.decode(m,b,!0)}catch(S){throw S instanceof re||S instanceof K?He.getNotFoundInstance():S}}static decode(m,b,S){const P=new Array,N=Vr.detectMultiple(m,b,S);for(const V of N.getPoints()){const $=_r.decode(N.getBits(),V[4],V[5],V[6],V[7],vo.getMinCodewordWidth(V),vo.getMaxCodewordWidth(V)),te=new On($.getText(),$.getRawBytes(),void 0,V,En.PDF_417);te.putMetadata(ur.ERROR_CORRECTION_LEVEL,$.getECLevel());const de=$.getOther();de!=null&&te.putMetadata(ur.PDF417_EXTRA_METADATA,de),P.push(te)}return P.map(V=>V)}static getMaxWidth(m,b){return m==null||b==null?0:Math.trunc(Math.abs(m.getX()-b.getX()))}static getMinWidth(m,b){return m==null||b==null?pe.MAX_VALUE:Math.trunc(Math.abs(m.getX()-b.getX()))}static getMaxCodewordWidth(m){return Math.floor(Math.max(Math.max(vo.getMaxWidth(m[0],m[4]),vo.getMaxWidth(m[6],m[2])*Ir.MODULES_IN_CODEWORD/Ir.MODULES_IN_STOP_PATTERN),Math.max(vo.getMaxWidth(m[1],m[5]),vo.getMaxWidth(m[7],m[3])*Ir.MODULES_IN_CODEWORD/Ir.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(m){return Math.floor(Math.min(Math.min(vo.getMinWidth(m[0],m[4]),vo.getMinWidth(m[6],m[2])*Ir.MODULES_IN_CODEWORD/Ir.MODULES_IN_STOP_PATTERN),Math.min(vo.getMinWidth(m[1],m[5]),vo.getMinWidth(m[7],m[3])*Ir.MODULES_IN_CODEWORD/Ir.MODULES_IN_STOP_PATTERN)))}reset(){}}class Lo extends w{}Lo.kind="ReaderException";class dl{constructor(m,b){this.verbose=m===!0,b&&this.setHints(b)}decode(m,b){return b&&this.setHints(b),this.decodeInternal(m)}decodeWithState(m){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(m)}setHints(m){this.hints=m;const b=!r(m)&&m.get(Ae.TRY_HARDER)===!0,S=r(m)?null:m.get(Ae.POSSIBLE_FORMATS),P=new Array;if(!r(S)){const N=S.some(V=>V===En.UPC_A||V===En.UPC_E||V===En.EAN_13||V===En.EAN_8||V===En.CODABAR||V===En.CODE_39||V===En.CODE_93||V===En.CODE_128||V===En.ITF||V===En.RSS_14||V===En.RSS_EXPANDED);N&&!b&&P.push(new xo(m,this.verbose)),S.includes(En.QR_CODE)&&P.push(new Or),S.includes(En.DATA_MATRIX)&&P.push(new Ml),S.includes(En.AZTEC)&&P.push(new Tr),S.includes(En.PDF_417)&&P.push(new vo),N&&b&&P.push(new xo(m,this.verbose))}P.length===0&&(b||P.push(new xo(m,this.verbose)),P.push(new Or),P.push(new Ml),P.push(new Tr),P.push(new vo),b&&P.push(new xo(m,this.verbose))),this.readers=P}reset(){if(this.readers!==null)for(const m of this.readers)m.reset()}decodeInternal(m){if(this.readers===null)throw new Lo("No readers where selected, nothing can be read.");for(const b of this.readers)try{return b.decode(m,this.hints)}catch(S){if(S instanceof Lo)continue}throw new He("No MultiFormat Readers were able to detect the code.")}}class oc extends Xt{constructor(m=null,b=500){const S=new dl;S.setHints(m),super(S,b)}decodeBitmap(m){return this.reader.decodeWithState(m)}}class kl extends Xt{constructor(m=500){super(new vo,m)}}class zd extends Xt{constructor(m=500){super(new Or,m)}}var Ua;(function(Ne){Ne[Ne.ERROR_CORRECTION=0]="ERROR_CORRECTION",Ne[Ne.CHARACTER_SET=1]="CHARACTER_SET",Ne[Ne.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",Ne[Ne.MIN_SIZE=3]="MIN_SIZE",Ne[Ne.MAX_SIZE=4]="MAX_SIZE",Ne[Ne.MARGIN=5]="MARGIN",Ne[Ne.PDF417_COMPACT=6]="PDF417_COMPACT",Ne[Ne.PDF417_COMPACTION=7]="PDF417_COMPACTION",Ne[Ne.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",Ne[Ne.AZTEC_LAYERS=9]="AZTEC_LAYERS",Ne[Ne.QR_VERSION=10]="QR_VERSION"})(Ua||(Ua={}));var mo=Ua;class ac{constructor(m){this.field=m,this.cachedGenerators=[],this.cachedGenerators.push(new jn(m,Int32Array.from([1])))}buildGenerator(m){const b=this.cachedGenerators;if(m>=b.length){let S=b[b.length-1];const P=this.field;for(let N=b.length;N<=m;N++){const V=S.multiply(new jn(P,Int32Array.from([1,P.exp(N-1+P.getGeneratorBase())])));b.push(V),S=V}}return b[m]}encode(m,b){if(b===0)throw new F("No error correction bytes");const S=m.length-b;if(S<=0)throw new F("No data bytes provided");const P=this.buildGenerator(b),N=new Int32Array(S);Z.arraycopy(m,0,N,0,S);let V=new jn(this.field,N);V=V.multiplyByMonomial(b,1);const te=V.divide(P)[1].getCoefficients(),de=b-te.length;for(let Re=0;Re<de;Re++)m[S+Re]=0;Z.arraycopy(te,0,m,S+de,te.length)}}class Mi{constructor(){}static applyMaskPenaltyRule1(m){return Mi.applyMaskPenaltyRule1Internal(m,!0)+Mi.applyMaskPenaltyRule1Internal(m,!1)}static applyMaskPenaltyRule2(m){let b=0;const S=m.getArray(),P=m.getWidth(),N=m.getHeight();for(let V=0;V<N-1;V++){const $=S[V];for(let te=0;te<P-1;te++){const de=$[te];de===$[te+1]&&de===S[V+1][te]&&de===S[V+1][te+1]&&b++}}return Mi.N2*b}static applyMaskPenaltyRule3(m){let b=0;const S=m.getArray(),P=m.getWidth(),N=m.getHeight();for(let V=0;V<N;V++)for(let $=0;$<P;$++){const te=S[V];$+6<P&&te[$]===1&&te[$+1]===0&&te[$+2]===1&&te[$+3]===1&&te[$+4]===1&&te[$+5]===0&&te[$+6]===1&&(Mi.isWhiteHorizontal(te,$-4,$)||Mi.isWhiteHorizontal(te,$+7,$+11))&&b++,V+6<N&&S[V][$]===1&&S[V+1][$]===0&&S[V+2][$]===1&&S[V+3][$]===1&&S[V+4][$]===1&&S[V+5][$]===0&&S[V+6][$]===1&&(Mi.isWhiteVertical(S,$,V-4,V)||Mi.isWhiteVertical(S,$,V+7,V+11))&&b++}return b*Mi.N3}static isWhiteHorizontal(m,b,S){b=Math.max(b,0),S=Math.min(S,m.length);for(let P=b;P<S;P++)if(m[P]===1)return!1;return!0}static isWhiteVertical(m,b,S,P){S=Math.max(S,0),P=Math.min(P,m.length);for(let N=S;N<P;N++)if(m[N][b]===1)return!1;return!0}static applyMaskPenaltyRule4(m){let b=0;const S=m.getArray(),P=m.getWidth(),N=m.getHeight();for(let te=0;te<N;te++){const de=S[te];for(let Re=0;Re<P;Re++)de[Re]===1&&b++}const V=m.getHeight()*m.getWidth();return Math.floor(Math.abs(b*2-V)*10/V)*Mi.N4}static getDataMaskBit(m,b,S){let P,N;switch(m){case 0:P=S+b&1;break;case 1:P=S&1;break;case 2:P=b%3;break;case 3:P=(S+b)%3;break;case 4:P=Math.floor(S/2)+Math.floor(b/3)&1;break;case 5:N=S*b,P=(N&1)+N%3;break;case 6:N=S*b,P=(N&1)+N%3&1;break;case 7:N=S*b,P=N%3+(S+b&1)&1;break;default:throw new F("Invalid mask pattern: "+m)}return P===0}static applyMaskPenaltyRule1Internal(m,b){let S=0;const P=b?m.getHeight():m.getWidth(),N=b?m.getWidth():m.getHeight(),V=m.getArray();for(let $=0;$<P;$++){let te=0,de=-1;for(let Re=0;Re<N;Re++){const Fe=b?V[$][Re]:V[Re][$];Fe===de?te++:(te>=5&&(S+=Mi.N1+(te-5)),te=1,de=Fe)}te>=5&&(S+=Mi.N1+(te-5))}return S}}Mi.N1=3,Mi.N2=3,Mi.N3=40,Mi.N4=10;class Ju{constructor(m,b){this.width=m,this.height=b;const S=new Array(b);for(let P=0;P!==b;P++)S[P]=new Uint8Array(m);this.bytes=S}getHeight(){return this.height}getWidth(){return this.width}get(m,b){return this.bytes[b][m]}getArray(){return this.bytes}setNumber(m,b,S){this.bytes[b][m]=S}setBoolean(m,b,S){this.bytes[b][m]=S?1:0}clear(m){for(const b of this.bytes)me.fill(b,m)}equals(m){if(!(m instanceof Ju))return!1;const b=m;if(this.width!==b.width||this.height!==b.height)return!1;for(let S=0,P=this.height;S<P;++S){const N=this.bytes[S],V=b.bytes[S];for(let $=0,te=this.width;$<te;++$)if(N[$]!==V[$])return!1}return!0}toString(){const m=new ze;for(let b=0,S=this.height;b<S;++b){const P=this.bytes[b];for(let N=0,V=this.width;N<V;++N)switch(P[N]){case 0:m.append(" 0");break;case 1:m.append(" 1");break;default:m.append("  ");break}m.append(`
`)}return m.toString()}}class bo{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const m=new ze;return m.append(`<<
`),m.append(" mode: "),m.append(this.mode?this.mode.toString():"null"),m.append(`
 ecLevel: `),m.append(this.ecLevel?this.ecLevel.toString():"null"),m.append(`
 version: `),m.append(this.version?this.version.toString():"null"),m.append(`
 maskPattern: `),m.append(this.maskPattern.toString()),this.matrix?(m.append(`
 matrix:
`),m.append(this.matrix.toString())):m.append(`
 matrix: null
`),m.append(`>>
`),m.toString()}setMode(m){this.mode=m}setECLevel(m){this.ecLevel=m}setVersion(m){this.version=m}setMaskPattern(m){this.maskPattern=m}setMatrix(m){this.matrix=m}static isValidMaskPattern(m){return m>=0&&m<bo.NUM_MASK_PATTERNS}}bo.NUM_MASK_PATTERNS=8;class fs extends w{}fs.kind="WriterException";class Lr{constructor(){}static clearMatrix(m){m.clear(255)}static buildMatrix(m,b,S,P,N){Lr.clearMatrix(N),Lr.embedBasicPatterns(S,N),Lr.embedTypeInfo(b,P,N),Lr.maybeEmbedVersionInfo(S,N),Lr.embedDataBits(m,P,N)}static embedBasicPatterns(m,b){Lr.embedPositionDetectionPatternsAndSeparators(b),Lr.embedDarkDotAtLeftBottomCorner(b),Lr.maybeEmbedPositionAdjustmentPatterns(m,b),Lr.embedTimingPatterns(b)}static embedTypeInfo(m,b,S){const P=new _e;Lr.makeTypeInfoBits(m,b,P);for(let N=0,V=P.getSize();N<V;++N){const $=P.get(P.getSize()-1-N),te=Lr.TYPE_INFO_COORDINATES[N],de=te[0],Re=te[1];if(S.setBoolean(de,Re,$),N<8){const Fe=S.getWidth()-N-1;S.setBoolean(Fe,8,$)}else{const Ge=S.getHeight()-7+(N-8);S.setBoolean(8,Ge,$)}}}static maybeEmbedVersionInfo(m,b){if(m.getVersionNumber()<7)return;const S=new _e;Lr.makeVersionInfoBits(m,S);let P=6*3-1;for(let N=0;N<6;++N)for(let V=0;V<3;++V){const $=S.get(P);P--,b.setBoolean(N,b.getHeight()-11+V,$),b.setBoolean(b.getHeight()-11+V,N,$)}}static embedDataBits(m,b,S){let P=0,N=-1,V=S.getWidth()-1,$=S.getHeight()-1;for(;V>0;){for(V===6&&(V-=1);$>=0&&$<S.getHeight();){for(let te=0;te<2;++te){const de=V-te;if(!Lr.isEmpty(S.get(de,$)))continue;let Re;P<m.getSize()?(Re=m.get(P),++P):Re=!1,b!==255&&Mi.getDataMaskBit(b,de,$)&&(Re=!Re),S.setBoolean(de,$,Re)}$+=N}N=-N,$+=N,V-=2}if(P!==m.getSize())throw new fs("Not all bits consumed: "+P+"/"+m.getSize())}static findMSBSet(m){return 32-pe.numberOfLeadingZeros(m)}static calculateBCHCode(m,b){if(b===0)throw new F("0 polynomial");const S=Lr.findMSBSet(b);for(m<<=S-1;Lr.findMSBSet(m)>=S;)m^=b<<Lr.findMSBSet(m)-S;return m}static makeTypeInfoBits(m,b,S){if(!bo.isValidMaskPattern(b))throw new fs("Invalid mask pattern");const P=m.getBits()<<3|b;S.appendBits(P,5);const N=Lr.calculateBCHCode(P,Lr.TYPE_INFO_POLY);S.appendBits(N,10);const V=new _e;if(V.appendBits(Lr.TYPE_INFO_MASK_PATTERN,15),S.xor(V),S.getSize()!==15)throw new fs("should not happen but we got: "+S.getSize())}static makeVersionInfoBits(m,b){b.appendBits(m.getVersionNumber(),6);const S=Lr.calculateBCHCode(m.getVersionNumber(),Lr.VERSION_INFO_POLY);if(b.appendBits(S,12),b.getSize()!==18)throw new fs("should not happen but we got: "+b.getSize())}static isEmpty(m){return m===255}static embedTimingPatterns(m){for(let b=8;b<m.getWidth()-8;++b){const S=(b+1)%2;Lr.isEmpty(m.get(b,6))&&m.setNumber(b,6,S),Lr.isEmpty(m.get(6,b))&&m.setNumber(6,b,S)}}static embedDarkDotAtLeftBottomCorner(m){if(m.get(8,m.getHeight()-8)===0)throw new fs;m.setNumber(8,m.getHeight()-8,1)}static embedHorizontalSeparationPattern(m,b,S){for(let P=0;P<8;++P){if(!Lr.isEmpty(S.get(m+P,b)))throw new fs;S.setNumber(m+P,b,0)}}static embedVerticalSeparationPattern(m,b,S){for(let P=0;P<7;++P){if(!Lr.isEmpty(S.get(m,b+P)))throw new fs;S.setNumber(m,b+P,0)}}static embedPositionAdjustmentPattern(m,b,S){for(let P=0;P<5;++P){const N=Lr.POSITION_ADJUSTMENT_PATTERN[P];for(let V=0;V<5;++V)S.setNumber(m+V,b+P,N[V])}}static embedPositionDetectionPattern(m,b,S){for(let P=0;P<7;++P){const N=Lr.POSITION_DETECTION_PATTERN[P];for(let V=0;V<7;++V)S.setNumber(m+V,b+P,N[V])}}static embedPositionDetectionPatternsAndSeparators(m){const b=Lr.POSITION_DETECTION_PATTERN[0].length;Lr.embedPositionDetectionPattern(0,0,m),Lr.embedPositionDetectionPattern(m.getWidth()-b,0,m),Lr.embedPositionDetectionPattern(0,m.getWidth()-b,m);const S=8;Lr.embedHorizontalSeparationPattern(0,S-1,m),Lr.embedHorizontalSeparationPattern(m.getWidth()-S,S-1,m),Lr.embedHorizontalSeparationPattern(0,m.getWidth()-S,m);const P=7;Lr.embedVerticalSeparationPattern(P,0,m),Lr.embedVerticalSeparationPattern(m.getHeight()-P-1,0,m),Lr.embedVerticalSeparationPattern(P,m.getHeight()-P,m)}static maybeEmbedPositionAdjustmentPatterns(m,b){if(m.getVersionNumber()<2)return;const S=m.getVersionNumber()-1,P=Lr.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[S];for(let N=0,V=P.length;N!==V;N++){const $=P[N];if($>=0)for(let te=0;te!==V;te++){const de=P[te];de>=0&&Lr.isEmpty(b.get(de,$))&&Lr.embedPositionAdjustmentPattern(de-2,$-2,b)}}}}Lr.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Lr.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Lr.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Lr.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Lr.VERSION_INFO_POLY=7973,Lr.TYPE_INFO_POLY=1335,Lr.TYPE_INFO_MASK_PATTERN=21522;class Hf{constructor(m,b){this.dataBytes=m,this.errorCorrectionBytes=b}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Is{constructor(){}static calculateMaskPenalty(m){return Mi.applyMaskPenaltyRule1(m)+Mi.applyMaskPenaltyRule2(m)+Mi.applyMaskPenaltyRule3(m)+Mi.applyMaskPenaltyRule4(m)}static encode(m,b,S=null){let P=Is.DEFAULT_BYTE_MODE_ENCODING;const N=S!==null&&S.get(mo.CHARACTER_SET)!==void 0;N&&(P=S.get(mo.CHARACTER_SET).toString());const V=this.chooseMode(m,P),$=new _e;if(V===mr.BYTE&&(N||Is.DEFAULT_BYTE_MODE_ENCODING!==P)){const zn=ye.getCharacterSetECIByName(P);zn!==void 0&&this.appendECI(zn,$)}this.appendModeInfo(V,$);const te=new _e;this.appendBytes(m,V,te,P);let de;if(S!==null&&S.get(mo.QR_VERSION)!==void 0){const zn=Number.parseInt(S.get(mo.QR_VERSION).toString(),10);de=Fn.getVersionForNumber(zn);const Dn=this.calculateBitsNeeded(V,$,te,de);if(!this.willFit(Dn,de,b))throw new fs("Data too big for requested version")}else de=this.recommendVersion(b,V,$,te);const Re=new _e;Re.appendBitArray($);const Fe=V===mr.BYTE?te.getSizeInBytes():m.length;this.appendLengthInfo(Fe,de,V,Re),Re.appendBitArray(te);const Ge=de.getECBlocksForLevel(b),dt=de.getTotalCodewords()-Ge.getTotalECCodewords();this.terminateBits(dt,Re);const Ct=this.interleaveWithECBytes(Re,de.getTotalCodewords(),dt,Ge.getNumBlocks()),Pt=new bo;Pt.setECLevel(b),Pt.setMode(V),Pt.setVersion(de);const $t=de.getDimensionForVersion(),tn=new Ju($t,$t),Vn=this.chooseMaskPattern(Ct,b,de,tn);return Pt.setMaskPattern(Vn),Lr.buildMatrix(Ct,b,de,Vn,tn),Pt.setMatrix(tn),Pt}static recommendVersion(m,b,S,P){const N=this.calculateBitsNeeded(b,S,P,Fn.getVersionForNumber(1)),V=this.chooseVersion(N,m),$=this.calculateBitsNeeded(b,S,P,V);return this.chooseVersion($,m)}static calculateBitsNeeded(m,b,S,P){return b.getSize()+m.getCharacterCountBits(P)+S.getSize()}static getAlphanumericCode(m){return m<Is.ALPHANUMERIC_TABLE.length?Is.ALPHANUMERIC_TABLE[m]:-1}static chooseMode(m,b=null){if(ye.SJIS.getName()===b&&this.isOnlyDoubleByteKanji(m))return mr.KANJI;let S=!1,P=!1;for(let N=0,V=m.length;N<V;++N){const $=m.charAt(N);if(Is.isDigit($))S=!0;else if(this.getAlphanumericCode($.charCodeAt(0))!==-1)P=!0;else return mr.BYTE}return P?mr.ALPHANUMERIC:S?mr.NUMERIC:mr.BYTE}static isOnlyDoubleByteKanji(m){let b;try{b=Ie.encode(m,ye.SJIS)}catch{return!1}const S=b.length;if(S%2!==0)return!1;for(let P=0;P<S;P+=2){const N=b[P]&255;if((N<129||N>159)&&(N<224||N>235))return!1}return!0}static chooseMaskPattern(m,b,S,P){let N=Number.MAX_SAFE_INTEGER,V=-1;for(let $=0;$<bo.NUM_MASK_PATTERNS;$++){Lr.buildMatrix(m,b,S,$,P);let te=this.calculateMaskPenalty(P);te<N&&(N=te,V=$)}return V}static chooseVersion(m,b){for(let S=1;S<=40;S++){const P=Fn.getVersionForNumber(S);if(Is.willFit(m,P,b))return P}throw new fs("Data too big")}static willFit(m,b,S){const P=b.getTotalCodewords(),V=b.getECBlocksForLevel(S).getTotalECCodewords(),$=P-V,te=(m+7)/8;return $>=te}static terminateBits(m,b){const S=m*8;if(b.getSize()>S)throw new fs("data bits cannot fit in the QR Code"+b.getSize()+" > "+S);for(let V=0;V<4&&b.getSize()<S;++V)b.appendBit(!1);const P=b.getSize()&7;if(P>0)for(let V=P;V<8;V++)b.appendBit(!1);const N=m-b.getSizeInBytes();for(let V=0;V<N;++V)b.appendBits(V&1?17:236,8);if(b.getSize()!==S)throw new fs("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(m,b,S,P,N,V){if(P>=S)throw new fs("Block ID too large");const $=m%S,te=S-$,de=Math.floor(m/S),Re=de+1,Fe=Math.floor(b/S),Ge=Fe+1,dt=de-Fe,Ct=Re-Ge;if(dt!==Ct)throw new fs("EC bytes mismatch");if(S!==te+$)throw new fs("RS blocks mismatch");if(m!==(Fe+dt)*te+(Ge+Ct)*$)throw new fs("Total bytes mismatch");P<te?(N[0]=Fe,V[0]=dt):(N[0]=Ge,V[0]=Ct)}static interleaveWithECBytes(m,b,S,P){if(m.getSizeInBytes()!==S)throw new fs("Number of bits and data bytes does not match");let N=0,V=0,$=0;const te=new Array;for(let Re=0;Re<P;++Re){const Fe=new Int32Array(1),Ge=new Int32Array(1);Is.getNumDataBytesAndNumECBytesForBlockID(b,S,P,Re,Fe,Ge);const dt=Fe[0],Ct=new Uint8Array(dt);m.toBytes(8*N,Ct,0,dt);const Pt=Is.generateECBytes(Ct,Ge[0]);te.push(new Hf(Ct,Pt)),V=Math.max(V,dt),$=Math.max($,Pt.length),N+=Fe[0]}if(S!==N)throw new fs("Data bytes does not match offset");const de=new _e;for(let Re=0;Re<V;++Re)for(const Fe of te){const Ge=Fe.getDataBytes();Re<Ge.length&&de.appendBits(Ge[Re],8)}for(let Re=0;Re<$;++Re)for(const Fe of te){const Ge=Fe.getErrorCorrectionBytes();Re<Ge.length&&de.appendBits(Ge[Re],8)}if(b!==de.getSizeInBytes())throw new fs("Interleaving error: "+b+" and "+de.getSizeInBytes()+" differ.");return de}static generateECBytes(m,b){const S=m.length,P=new Int32Array(S+b);for(let V=0;V<S;V++)P[V]=m[V]&255;new ac(Yn.QR_CODE_FIELD_256).encode(P,b);const N=new Uint8Array(b);for(let V=0;V<b;V++)N[V]=P[S+V];return N}static appendModeInfo(m,b){b.appendBits(m.getBits(),4)}static appendLengthInfo(m,b,S,P){const N=S.getCharacterCountBits(b);if(m>=1<<N)throw new fs(m+" is bigger than "+((1<<N)-1));P.appendBits(m,N)}static appendBytes(m,b,S,P){switch(b){case mr.NUMERIC:Is.appendNumericBytes(m,S);break;case mr.ALPHANUMERIC:Is.appendAlphanumericBytes(m,S);break;case mr.BYTE:Is.append8BitBytes(m,S,P);break;case mr.KANJI:Is.appendKanjiBytes(m,S);break;default:throw new fs("Invalid mode: "+b)}}static getDigit(m){return m.charCodeAt(0)-48}static isDigit(m){const b=Is.getDigit(m);return b>=0&&b<=9}static appendNumericBytes(m,b){const S=m.length;let P=0;for(;P<S;){const N=Is.getDigit(m.charAt(P));if(P+2<S){const V=Is.getDigit(m.charAt(P+1)),$=Is.getDigit(m.charAt(P+2));b.appendBits(N*100+V*10+$,10),P+=3}else if(P+1<S){const V=Is.getDigit(m.charAt(P+1));b.appendBits(N*10+V,7),P+=2}else b.appendBits(N,4),P++}}static appendAlphanumericBytes(m,b){const S=m.length;let P=0;for(;P<S;){const N=Is.getAlphanumericCode(m.charCodeAt(P));if(N===-1)throw new fs;if(P+1<S){const V=Is.getAlphanumericCode(m.charCodeAt(P+1));if(V===-1)throw new fs;b.appendBits(N*45+V,11),P+=2}else b.appendBits(N,6),P++}}static append8BitBytes(m,b,S){let P;try{P=Ie.encode(m,S)}catch(N){throw new fs(N)}for(let N=0,V=P.length;N!==V;N++){const $=P[N];b.appendBits($,8)}}static appendKanjiBytes(m,b){let S;try{S=Ie.encode(m,ye.SJIS)}catch(N){throw new fs(N)}const P=S.length;for(let N=0;N<P;N+=2){const V=S[N]&255,$=S[N+1]&255,te=V<<8&4294967295|$;let de=-1;if(te>=33088&&te<=40956?de=te-33088:te>=57408&&te<=60351&&(de=te-49472),de===-1)throw new fs("Invalid byte sequence");const Re=(de>>8)*192+(de&255);b.appendBits(Re,13)}}static appendECI(m,b){b.appendBits(mr.ECI.getBits(),4),b.appendBits(m.getValue(),8)}}Is.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Is.DEFAULT_BYTE_MODE_ENCODING=ye.UTF8.getName();class wa{write(m,b,S,P=null){if(m.length===0)throw new F("Found empty contents");if(b<0||S<0)throw new F("Requested dimensions are too small: "+b+"x"+S);let N=Ii.L,V=wa.QUIET_ZONE_SIZE;P!==null&&(P.get(mo.ERROR_CORRECTION)!==void 0&&(N=Ii.fromString(P.get(mo.ERROR_CORRECTION).toString())),P.get(mo.MARGIN)!==void 0&&(V=Number.parseInt(P.get(mo.MARGIN).toString(),10)));const $=Is.encode(m,N,P);return this.renderResult($,b,S,V)}writeToDom(m,b,S,P,N=null){typeof m=="string"&&(m=document.querySelector(m));const V=this.write(b,S,P,N);m&&m.appendChild(V)}renderResult(m,b,S,P){const N=m.getMatrix();if(N===null)throw new Sr;const V=N.getWidth(),$=N.getHeight(),te=V+P*2,de=$+P*2,Re=Math.max(b,te),Fe=Math.max(S,de),Ge=Math.min(Math.floor(Re/te),Math.floor(Fe/de)),dt=Math.floor((Re-V*Ge)/2),Ct=Math.floor((Fe-$*Ge)/2),Pt=this.createSVGElement(Re,Fe);for(let $t=0,tn=Ct;$t<$;$t++,tn+=Ge)for(let Vn=0,zn=dt;Vn<V;Vn++,zn+=Ge)if(N.get(Vn,$t)===1){const Dn=this.createSvgRectElement(zn,tn,Ge,Ge);Pt.appendChild(Dn)}return Pt}createSVGElement(m,b){const S=document.createElementNS(wa.SVG_NS,"svg");return S.setAttributeNS(null,"height",m.toString()),S.setAttributeNS(null,"width",b.toString()),S}createSvgRectElement(m,b,S,P){const N=document.createElementNS(wa.SVG_NS,"rect");return N.setAttributeNS(null,"x",m.toString()),N.setAttributeNS(null,"y",b.toString()),N.setAttributeNS(null,"height",S.toString()),N.setAttributeNS(null,"width",P.toString()),N.setAttributeNS(null,"fill","#000000"),N}}wa.QUIET_ZONE_SIZE=4,wa.SVG_NS="http://www.w3.org/2000/svg";class eo{encode(m,b,S,P,N){if(m.length===0)throw new F("Found empty contents");if(b!==En.QR_CODE)throw new F("Can only encode QR_CODE, but got "+b);if(S<0||P<0)throw new F(`Requested dimensions are too small: ${S}x${P}`);let V=Ii.L,$=eo.QUIET_ZONE_SIZE;N!==null&&(N.get(mo.ERROR_CORRECTION)!==void 0&&(V=Ii.fromString(N.get(mo.ERROR_CORRECTION).toString())),N.get(mo.MARGIN)!==void 0&&($=Number.parseInt(N.get(mo.MARGIN).toString(),10)));const te=Is.encode(m,V,N);return eo.renderResult(te,S,P,$)}static renderResult(m,b,S,P){const N=m.getMatrix();if(N===null)throw new Sr;const V=N.getWidth(),$=N.getHeight(),te=V+P*2,de=$+P*2,Re=Math.max(b,te),Fe=Math.max(S,de),Ge=Math.min(Math.floor(Re/te),Math.floor(Fe/de)),dt=Math.floor((Re-V*Ge)/2),Ct=Math.floor((Fe-$*Ge)/2),Pt=new ft(Re,Fe);for(let $t=0,tn=Ct;$t<$;$t++,tn+=Ge)for(let Vn=0,zn=dt;Vn<V;Vn++,zn+=Ge)N.get(Vn,$t)===1&&Pt.setRegion(zn,tn,Ge,Ge);return Pt}}eo.QUIET_ZONE_SIZE=4;class Wf{encode(m,b,S,P,N){let V;switch(b){case En.QR_CODE:V=new eo;break;default:throw new F("No encoder available for format "+b)}return V.encode(m,b,S,P,N)}}class Fo extends wt{constructor(m,b,S,P,N,V,$,te){if(super(V,$),this.yuvData=m,this.dataWidth=b,this.dataHeight=S,this.left=P,this.top=N,P+V>b||N+$>S)throw new F("Crop rectangle does not fit within image data.");te&&this.reverseHorizontal(V,$)}getRow(m,b){if(m<0||m>=this.getHeight())throw new F("Requested row is outside the image: "+m);const S=this.getWidth();(b==null||b.length<S)&&(b=new Uint8ClampedArray(S));const P=(m+this.top)*this.dataWidth+this.left;return Z.arraycopy(this.yuvData,P,b,0,S),b}getMatrix(){const m=this.getWidth(),b=this.getHeight();if(m===this.dataWidth&&b===this.dataHeight)return this.yuvData;const S=m*b,P=new Uint8ClampedArray(S);let N=this.top*this.dataWidth+this.left;if(m===this.dataWidth)return Z.arraycopy(this.yuvData,N,P,0,S),P;for(let V=0;V<b;V++){const $=V*m;Z.arraycopy(this.yuvData,N,P,$,m),N+=this.dataWidth}return P}isCropSupported(){return!0}crop(m,b,S,P){return new Fo(this.yuvData,this.dataWidth,this.dataHeight,this.left+m,this.top+b,S,P,!1)}renderThumbnail(){const m=this.getWidth()/Fo.THUMBNAIL_SCALE_FACTOR,b=this.getHeight()/Fo.THUMBNAIL_SCALE_FACTOR,S=new Int32Array(m*b),P=this.yuvData;let N=this.top*this.dataWidth+this.left;for(let V=0;V<b;V++){const $=V*m;for(let te=0;te<m;te++){const de=P[N+te*Fo.THUMBNAIL_SCALE_FACTOR]&255;S[$+te]=4278190080|de*65793}N+=this.dataWidth*Fo.THUMBNAIL_SCALE_FACTOR}return S}getThumbnailWidth(){return this.getWidth()/Fo.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Fo.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(m,b){const S=this.yuvData;for(let P=0,N=this.top*this.dataWidth+this.left;P<b;P++,N+=this.dataWidth){const V=N+m/2;for(let $=N,te=N+m-1;$<V;$++,te--){const de=S[$];S[$]=S[te],S[te]=de}}}invert(){return new it(this)}}Fo.THUMBNAIL_SCALE_FACTOR=2;class Ea extends wt{constructor(m,b,S,P,N,V,$){if(super(b,S),this.dataWidth=P,this.dataHeight=N,this.left=V,this.top=$,m.BYTES_PER_ELEMENT===4){const te=b*S,de=new Uint8ClampedArray(te);for(let Re=0;Re<te;Re++){const Fe=m[Re],Ge=Fe>>16&255,dt=Fe>>7&510,Ct=Fe&255;de[Re]=(Ge+dt+Ct)/4&255}this.luminances=de}else this.luminances=m;if(P===void 0&&(this.dataWidth=b),N===void 0&&(this.dataHeight=S),V===void 0&&(this.left=0),$===void 0&&(this.top=0),this.left+b>this.dataWidth||this.top+S>this.dataHeight)throw new F("Crop rectangle does not fit within image data.")}getRow(m,b){if(m<0||m>=this.getHeight())throw new F("Requested row is outside the image: "+m);const S=this.getWidth();(b==null||b.length<S)&&(b=new Uint8ClampedArray(S));const P=(m+this.top)*this.dataWidth+this.left;return Z.arraycopy(this.luminances,P,b,0,S),b}getMatrix(){const m=this.getWidth(),b=this.getHeight();if(m===this.dataWidth&&b===this.dataHeight)return this.luminances;const S=m*b,P=new Uint8ClampedArray(S);let N=this.top*this.dataWidth+this.left;if(m===this.dataWidth)return Z.arraycopy(this.luminances,N,P,0,S),P;for(let V=0;V<b;V++){const $=V*m;Z.arraycopy(this.luminances,N,P,$,m),N+=this.dataWidth}return P}isCropSupported(){return!0}crop(m,b,S,P){return new Ea(this.luminances,S,P,this.dataWidth,this.dataHeight,this.left+m,this.top+b)}invert(){return new it(this)}}class q extends ye{static forName(m){return this.getCharacterSetECIByName(m)}}class ve{}ve.ISO_8859_1=ye.ISO8859_1;class ke{isCompact(){return this.compact}setCompact(m){this.compact=m}getSize(){return this.size}setSize(m){this.size=m}getLayers(){return this.layers}setLayers(m){this.layers=m}getCodeWords(){return this.codeWords}setCodeWords(m){this.codeWords=m}getMatrix(){return this.matrix}setMatrix(m){this.matrix=m}}class et{static singletonList(m){return[m]}static min(m,b){return m.sort(b)[0]}}class Gt{constructor(m){this.previous=m}getPrevious(){return this.previous}}class en extends Gt{constructor(m,b,S){super(m),this.value=b,this.bitCount=S}appendTo(m,b){m.appendBits(this.value,this.bitCount)}add(m,b){return new en(this,m,b)}addBinaryShift(m,b){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new en(this,m,b)}toString(){let m=this.value&(1<<this.bitCount)-1;return m|=1<<this.bitCount,"<"+pe.toBinaryString(m|1<<this.bitCount).substring(1)+">"}}class Kn extends en{constructor(m,b,S){super(m,0,0),this.binaryShiftStart=b,this.binaryShiftByteCount=S}appendTo(m,b){for(let S=0;S<this.binaryShiftByteCount;S++)(S===0||S===31&&this.binaryShiftByteCount<=62)&&(m.appendBits(31,5),this.binaryShiftByteCount>62?m.appendBits(this.binaryShiftByteCount-31,16):S===0?m.appendBits(Math.min(this.binaryShiftByteCount,31),5):m.appendBits(this.binaryShiftByteCount-31,5)),m.appendBits(b[this.binaryShiftStart+S],8)}addBinaryShift(m,b){return new Kn(this,m,b)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function ji(Ne,m,b){return new Kn(Ne,m,b)}function nr(Ne,m,b){return new en(Ne,m,b)}const gn=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],As=0,Un=1,Ms=2,Bo=3,qn=4,eh=new en(null,0,0),Qc=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function qh(Ne){for(let m of Ne)me.fill(m,-1);return Ne[As][qn]=0,Ne[Un][qn]=0,Ne[Un][As]=28,Ne[Bo][qn]=0,Ne[Ms][qn]=0,Ne[Ms][As]=15,Ne}const $f=qh(me.createInt32Array(6,6));class Ha{constructor(m,b,S,P){this.token=m,this.mode=b,this.binaryShiftByteCount=S,this.bitCount=P}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(m,b){let S=this.bitCount,P=this.token;if(m!==this.mode){let V=Qc[this.mode][m];P=nr(P,V&65535,V>>16),S+=V>>16}let N=m===Ms?4:5;return P=nr(P,b,N),new Ha(P,m,0,S+N)}shiftAndAppend(m,b){let S=this.token,P=this.mode===Ms?4:5;return S=nr(S,$f[this.mode][m],P),S=nr(S,b,5),new Ha(S,this.mode,0,this.bitCount+P+5)}addBinaryShiftChar(m){let b=this.token,S=this.mode,P=this.bitCount;if(this.mode===qn||this.mode===Ms){let $=Qc[S][As];b=nr(b,$&65535,$>>16),P+=$>>16,S=As}let N=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,V=new Ha(b,S,this.binaryShiftByteCount+1,P+N);return V.binaryShiftByteCount===2078&&(V=V.endBinaryShift(m+1)),V}endBinaryShift(m){if(this.binaryShiftByteCount===0)return this;let b=this.token;return b=ji(b,m-this.binaryShiftByteCount,this.binaryShiftByteCount),new Ha(b,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(m){let b=this.bitCount+(Qc[this.mode][m.mode]>>16);return this.binaryShiftByteCount<m.binaryShiftByteCount?b+=Ha.calculateBinaryShiftCost(m)-Ha.calculateBinaryShiftCost(this):this.binaryShiftByteCount>m.binaryShiftByteCount&&m.binaryShiftByteCount>0&&(b+=10),b<=m.bitCount}toBitArray(m){let b=[];for(let P=this.endBinaryShift(m.length).token;P!==null;P=P.getPrevious())b.unshift(P);let S=new _e;for(const P of b)P.appendTo(S,m);return S}toString(){return Oe.format("%s bits=%d bytes=%d",gn[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(m){return m.binaryShiftByteCount>62?21:m.binaryShiftByteCount>31?20:m.binaryShiftByteCount>0?10:0}}Ha.INITIAL_STATE=new Ha(eh,As,0,0);function Ps(Ne){const m=Oe.getCharCode(" "),b=Oe.getCharCode("."),S=Oe.getCharCode(",");Ne[As][m]=1;const P=Oe.getCharCode("Z"),N=Oe.getCharCode("A");for(let Ge=N;Ge<=P;Ge++)Ne[As][Ge]=Ge-N+2;Ne[Un][m]=1;const V=Oe.getCharCode("z"),$=Oe.getCharCode("a");for(let Ge=$;Ge<=V;Ge++)Ne[Un][Ge]=Ge-$+2;Ne[Ms][m]=1;const te=Oe.getCharCode("9"),de=Oe.getCharCode("0");for(let Ge=de;Ge<=te;Ge++)Ne[Ms][Ge]=Ge-de+2;Ne[Ms][S]=12,Ne[Ms][b]=13;const Re=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let Ge=0;Ge<Re.length;Ge++)Ne[Bo][Oe.getCharCode(Re[Ge])]=Ge;const Fe=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let Ge=0;Ge<Fe.length;Ge++)Oe.getCharCode(Fe[Ge])>0&&(Ne[qn][Oe.getCharCode(Fe[Ge])]=Ge);return Ne}const th=Ps(me.createInt32Array(5,256));class sn{constructor(m){this.text=m}encode(){const m=Oe.getCharCode(" "),b=Oe.getCharCode(`
`);let S=et.singletonList(Ha.INITIAL_STATE);for(let N=0;N<this.text.length;N++){let V,$=N+1<this.text.length?this.text[N+1]:0;switch(this.text[N]){case Oe.getCharCode("\r"):V=$===b?2:0;break;case Oe.getCharCode("."):V=$===m?3:0;break;case Oe.getCharCode(","):V=$===m?4:0;break;case Oe.getCharCode(":"):V=$===m?5:0;break;default:V=0}V>0?(S=sn.updateStateListForPair(S,N,V),N++):S=this.updateStateListForChar(S,N)}return et.min(S,(N,V)=>N.getBitCount()-V.getBitCount()).toBitArray(this.text)}updateStateListForChar(m,b){const S=[];for(let P of m)this.updateStateForChar(P,b,S);return sn.simplifyStates(S)}updateStateForChar(m,b,S){let P=this.text[b]&255,N=th[m.getMode()][P]>0,V=null;for(let $=0;$<=qn;$++){let te=th[$][P];if(te>0){if(V==null&&(V=m.endBinaryShift(b)),!N||$===m.getMode()||$===Ms){const de=V.latchAndAppend($,te);S.push(de)}if(!N&&$f[m.getMode()][$]>=0){const de=V.shiftAndAppend($,te);S.push(de)}}}if(m.getBinaryShiftByteCount()>0||th[m.getMode()][P]===0){let $=m.addBinaryShiftChar(b);S.push($)}}static updateStateListForPair(m,b,S){const P=[];for(let N of m)this.updateStateForPair(N,b,S,P);return this.simplifyStates(P)}static updateStateForPair(m,b,S,P){let N=m.endBinaryShift(b);if(P.push(N.latchAndAppend(qn,S)),m.getMode()!==qn&&P.push(N.shiftAndAppend(qn,S)),S===3||S===4){let V=N.latchAndAppend(Ms,16-S).latchAndAppend(Ms,1);P.push(V)}if(m.getBinaryShiftByteCount()>0){let V=m.addBinaryShiftChar(b).addBinaryShiftChar(b+1);P.push(V)}}static simplifyStates(m){let b=[];for(const S of m){let P=!0;for(const N of b){if(N.isBetterThanOrEqualTo(S)){P=!1;break}S.isBetterThanOrEqualTo(N)&&(b=b.filter(V=>V!==N))}P&&b.push(S)}return b}}class Vi{constructor(){}static encodeBytes(m){return Vi.encode(m,Vi.DEFAULT_EC_PERCENT,Vi.DEFAULT_AZTEC_LAYERS)}static encode(m,b,S){let P=new sn(m).encode(),N=pe.truncDivision(P.getSize()*b,100)+11,V=P.getSize()+N,$,te,de,Re,Fe;if(S!==Vi.DEFAULT_AZTEC_LAYERS){if($=S<0,te=Math.abs(S),te>($?Vi.MAX_NB_BITS_COMPACT:Vi.MAX_NB_BITS))throw new F(Oe.format("Illegal value %s for layers",S));de=Vi.totalBitsInLayer(te,$),Re=Vi.WORD_SIZE[te];let Dn=de-de%Re;if(Fe=Vi.stuffBits(P,Re),Fe.getSize()+N>Dn)throw new F("Data to large for user specified layer");if($&&Fe.getSize()>Re*64)throw new F("Data to large for user specified layer")}else{Re=0,Fe=null;for(let Dn=0;;Dn++){if(Dn>Vi.MAX_NB_BITS)throw new F("Data too large for an Aztec code");if($=Dn<=3,te=$?Dn+1:Dn,de=Vi.totalBitsInLayer(te,$),V>de)continue;(Fe==null||Re!==Vi.WORD_SIZE[te])&&(Re=Vi.WORD_SIZE[te],Fe=Vi.stuffBits(P,Re));let Pi=de-de%Re;if(!($&&Fe.getSize()>Re*64)&&Fe.getSize()+N<=Pi)break}}let Ge=Vi.generateCheckWords(Fe,de,Re),dt=Fe.getSize()/Re,Ct=Vi.generateModeMessage($,te,dt),Pt=($?11:14)+te*4,$t=new Int32Array(Pt),tn;if($){tn=Pt;for(let Dn=0;Dn<$t.length;Dn++)$t[Dn]=Dn}else{tn=Pt+1+2*pe.truncDivision(pe.truncDivision(Pt,2)-1,15);let Dn=pe.truncDivision(Pt,2),Pi=pe.truncDivision(tn,2);for(let Xr=0;Xr<Dn;Xr++){let Sa=Xr+pe.truncDivision(Xr,15);$t[Dn-Xr-1]=Pi-Sa-1,$t[Dn+Xr]=Pi+Sa+1}}let Vn=new ft(tn);for(let Dn=0,Pi=0;Dn<te;Dn++){let Xr=(te-Dn)*4+($?9:12);for(let Sa=0;Sa<Xr;Sa++){let Qa=Sa*2;for(let Zo=0;Zo<2;Zo++)Ge.get(Pi+Qa+Zo)&&Vn.set($t[Dn*2+Zo],$t[Dn*2+Sa]),Ge.get(Pi+Xr*2+Qa+Zo)&&Vn.set($t[Dn*2+Sa],$t[Pt-1-Dn*2-Zo]),Ge.get(Pi+Xr*4+Qa+Zo)&&Vn.set($t[Pt-1-Dn*2-Zo],$t[Pt-1-Dn*2-Sa]),Ge.get(Pi+Xr*6+Qa+Zo)&&Vn.set($t[Pt-1-Dn*2-Sa],$t[Dn*2+Zo])}Pi+=Xr*8}if(Vi.drawModeMessage(Vn,$,tn,Ct),$)Vi.drawBullsEye(Vn,pe.truncDivision(tn,2),5);else{Vi.drawBullsEye(Vn,pe.truncDivision(tn,2),7);for(let Dn=0,Pi=0;Dn<pe.truncDivision(Pt,2)-1;Dn+=15,Pi+=16)for(let Xr=pe.truncDivision(tn,2)&1;Xr<tn;Xr+=2)Vn.set(pe.truncDivision(tn,2)-Pi,Xr),Vn.set(pe.truncDivision(tn,2)+Pi,Xr),Vn.set(Xr,pe.truncDivision(tn,2)-Pi),Vn.set(Xr,pe.truncDivision(tn,2)+Pi)}let zn=new ke;return zn.setCompact($),zn.setSize(tn),zn.setLayers(te),zn.setCodeWords(dt),zn.setMatrix(Vn),zn}static drawBullsEye(m,b,S){for(let P=0;P<S;P+=2)for(let N=b-P;N<=b+P;N++)m.set(N,b-P),m.set(N,b+P),m.set(b-P,N),m.set(b+P,N);m.set(b-S,b-S),m.set(b-S+1,b-S),m.set(b-S,b-S+1),m.set(b+S,b-S),m.set(b+S,b-S+1),m.set(b+S,b+S-1)}static generateModeMessage(m,b,S){let P=new _e;return m?(P.appendBits(b-1,2),P.appendBits(S-1,6),P=Vi.generateCheckWords(P,28,4)):(P.appendBits(b-1,5),P.appendBits(S-1,11),P=Vi.generateCheckWords(P,40,4)),P}static drawModeMessage(m,b,S,P){let N=pe.truncDivision(S,2);if(b)for(let V=0;V<7;V++){let $=N-3+V;P.get(V)&&m.set($,N-5),P.get(V+7)&&m.set(N+5,$),P.get(20-V)&&m.set($,N+5),P.get(27-V)&&m.set(N-5,$)}else for(let V=0;V<10;V++){let $=N-5+V+pe.truncDivision(V,5);P.get(V)&&m.set($,N-7),P.get(V+10)&&m.set(N+7,$),P.get(29-V)&&m.set($,N+7),P.get(39-V)&&m.set(N-7,$)}}static generateCheckWords(m,b,S){let P=m.getSize()/S,N=new ac(Vi.getGF(S)),V=pe.truncDivision(b,S),$=Vi.bitsToWords(m,S,V);N.encode($,V-P);let te=b%S,de=new _e;de.appendBits(0,te);for(const Re of Array.from($))de.appendBits(Re,S);return de}static bitsToWords(m,b,S){let P=new Int32Array(S),N,V;for(N=0,V=m.getSize()/b;N<V;N++){let $=0;for(let te=0;te<b;te++)$|=m.get(N*b+te)?1<<b-te-1:0;P[N]=$}return P}static getGF(m){switch(m){case 4:return Yn.AZTEC_PARAM;case 6:return Yn.AZTEC_DATA_6;case 8:return Yn.AZTEC_DATA_8;case 10:return Yn.AZTEC_DATA_10;case 12:return Yn.AZTEC_DATA_12;default:throw new F("Unsupported word size "+m)}}static stuffBits(m,b){let S=new _e,P=m.getSize(),N=(1<<b)-2;for(let V=0;V<P;V+=b){let $=0;for(let te=0;te<b;te++)(V+te>=P||m.get(V+te))&&($|=1<<b-1-te);($&N)===N?(S.appendBits($&N,b),V--):$&N?S.appendBits($,b):(S.appendBits($|1,b),V--)}return S}static totalBitsInLayer(m,b){return((b?88:112)+16*m)*m}}Vi.DEFAULT_EC_PERCENT=33,Vi.DEFAULT_AZTEC_LAYERS=0,Vi.MAX_NB_BITS=32,Vi.MAX_NB_BITS_COMPACT=4,Vi.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Nl{encode(m,b,S,P){return this.encodeWithHints(m,b,S,P,null)}encodeWithHints(m,b,S,P,N){let V=ve.ISO_8859_1,$=Vi.DEFAULT_EC_PERCENT,te=Vi.DEFAULT_AZTEC_LAYERS;return N!=null&&(N.has(mo.CHARACTER_SET)&&(V=q.forName(N.get(mo.CHARACTER_SET).toString())),N.has(mo.ERROR_CORRECTION)&&($=pe.parseInt(N.get(mo.ERROR_CORRECTION).toString())),N.has(mo.AZTEC_LAYERS)&&(te=pe.parseInt(N.get(mo.AZTEC_LAYERS).toString()))),Nl.encodeLayers(m,b,S,P,V,$,te)}static encodeLayers(m,b,S,P,N,V,$){if(b!==En.AZTEC)throw new F("Can only encode AZTEC, but got "+b);let te=Vi.encode(Oe.getBytes(m,N),V,$);return Nl.renderResult(te,S,P)}static renderResult(m,b,S){let P=m.getMatrix();if(P==null)throw new Sr;let N=P.getWidth(),V=P.getHeight(),$=Math.max(b,N),te=Math.max(S,V),de=Math.min($/N,te/V),Re=($-N*de)/2,Fe=(te-V*de)/2,Ge=new ft($,te);for(let dt=0,Ct=Fe;dt<V;dt++,Ct+=de)for(let Pt=0,$t=Re;Pt<N;Pt++,$t+=de)P.get(Pt,dt)&&Ge.setRegion($t,Ct,de,de);return Ge}}n.AbstractExpandedDecoder=Mt,n.ArgumentException=A,n.ArithmeticException=rr,n.AztecCode=ke,n.AztecCodeReader=Tr,n.AztecCodeWriter=Nl,n.AztecDecoder=Mn,n.AztecDetector=hr,n.AztecDetectorResult=Ni,n.AztecEncoder=Vi,n.AztecHighLevelEncoder=sn,n.AztecPoint=mn,n.BarcodeFormat=En,n.Binarizer=Q,n.BinaryBitmap=W,n.BitArray=_e,n.BitMatrix=ft,n.BitSource=Eu,n.BrowserAztecCodeReader=Li,n.BrowserBarcodeReader=Xo,n.BrowserCodeReader=Xt,n.BrowserDatamatrixCodeReader=Uf,n.BrowserMultiFormatReader=oc,n.BrowserPDF417Reader=kl,n.BrowserQRCodeReader=zd,n.BrowserQRCodeSvgWriter=wa,n.CharacterSetECI=ye,n.ChecksumException=K,n.Code128Reader=rn,n.Code39Reader=Rr,n.DataMatrixDecodedBitStreamParser=Ka,n.DataMatrixReader=Ml,n.DecodeHintType=Ae,n.DecoderResult=br,n.DefaultGridSampler=cs,n.DetectorResult=Xn,n.EAN13Reader=ra,n.EncodeHintType=mo,n.Exception=w,n.FormatException=re,n.GenericGF=Yn,n.GenericGFPoly=jn,n.GlobalHistogramBinarizer=bt,n.GridSampler=Es,n.GridSamplerInstance=Oi,n.HTMLCanvasElementLuminanceSource=nn,n.HybridBinarizer=Nt,n.ITFReader=$r,n.IllegalArgumentException=F,n.IllegalStateException=Sr,n.InvertedLuminanceSource=it,n.LuminanceSource=wt,n.MathUtils=jt,n.MultiFormatOneDReader=xo,n.MultiFormatReader=dl,n.MultiFormatWriter=Wf,n.NotFoundException=He,n.OneDReader=pi,n.PDF417DecodedBitStreamParser=Zt,n.PDF417DecoderErrorCorrection=oo,n.PDF417Reader=vo,n.PDF417ResultMetadata=Qu,n.PerspectiveTransform=Si,n.PlanarYUVLuminanceSource=Fo,n.QRCodeByteMatrix=Ju,n.QRCodeDataMask=so,n.QRCodeDecodedBitStreamParser=js,n.QRCodeDecoderErrorCorrectionLevel=Ii,n.QRCodeDecoderFormatInformation=ns,n.QRCodeEncoder=Is,n.QRCodeEncoderQRCode=bo,n.QRCodeMaskUtil=Mi,n.QRCodeMatrixUtil=Lr,n.QRCodeMode=mr,n.QRCodeReader=Or,n.QRCodeVersion=Fn,n.QRCodeWriter=eo,n.RGBLuminanceSource=Ea,n.RSS14Reader=ci,n.RSSExpandedReader=an,n.ReaderException=Lo,n.ReedSolomonDecoder=fi,n.ReedSolomonEncoder=ac,n.ReedSolomonException=Ot,n.Result=On,n.ResultMetadataType=ur,n.ResultPoint=un,n.StringUtils=Oe,n.UnsupportedOperationException=ue,n.VideoInputDevice=In,n.WhiteRectangleDetector=Bn,n.WriterException=fs,n.ZXingArrays=me,n.ZXingCharset=q,n.ZXingInteger=pe,n.ZXingStandardCharsets=ve,n.ZXingStringBuilder=ze,n.ZXingStringEncoding=Ie,n.ZXingSystem=Z,n.createAbstractExpandedDecoder=li,Object.defineProperty(n,"__esModule",{value:!0})})})(SN,SN.exports);var To=SN.exports;const Cwe=$I(To),Iwe=MW({__proto__:null,default:Cwe},[To]);var i7=function(){function t(e,n,r){if(this.formatMap=new Map([[Cr.QR_CODE,To.BarcodeFormat.QR_CODE],[Cr.AZTEC,To.BarcodeFormat.AZTEC],[Cr.CODABAR,To.BarcodeFormat.CODABAR],[Cr.CODE_39,To.BarcodeFormat.CODE_39],[Cr.CODE_93,To.BarcodeFormat.CODE_93],[Cr.CODE_128,To.BarcodeFormat.CODE_128],[Cr.DATA_MATRIX,To.BarcodeFormat.DATA_MATRIX],[Cr.MAXICODE,To.BarcodeFormat.MAXICODE],[Cr.ITF,To.BarcodeFormat.ITF],[Cr.EAN_13,To.BarcodeFormat.EAN_13],[Cr.EAN_8,To.BarcodeFormat.EAN_8],[Cr.PDF_417,To.BarcodeFormat.PDF_417],[Cr.RSS_14,To.BarcodeFormat.RSS_14],[Cr.RSS_EXPANDED,To.BarcodeFormat.RSS_EXPANDED],[Cr.UPC_A,To.BarcodeFormat.UPC_A],[Cr.UPC_E,To.BarcodeFormat.UPC_E],[Cr.UPC_EAN_EXTENSION,To.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Iwe)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=n,this.logger=r;var i=this.createZXingFormats(e),l=new Map;l.set(To.DecodeHintType.POSSIBLE_FORMATS,i),l.set(To.DecodeHintType.TRY_HARDER,!1),this.hints=l}return t.prototype.decodeAsync=function(e){var n=this;return new Promise(function(r,i){try{r(n.decode(e))}catch(l){i(l)}})},t.prototype.decode=function(e){var n=new To.MultiFormatReader(this.verbose,this.hints),r=new To.HTMLCanvasElementLuminanceSource(e),i=new To.BinaryBitmap(new To.HybridBinarizer(r)),l=n.decode(i);return{text:l.text,format:JQ.create(this.toHtml5QrcodeSupportedFormats(l.format)),debugData:this.createDebugData()}},t.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(n,r,i){e.set(n,r)}),e},t.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},t.prototype.createZXingFormats=function(e){for(var n=[],r=0,i=e;r<i.length;r++){var l=i[r];this.formatMap.has(l)?n.push(this.formatMap.get(l)):this.logger.logError("".concat(l," is not supported by")+"ZXingHtml5QrcodeShim")}return n},t.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},t}(),Awe=function(t,e,n,r){function i(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function s(A){try{w(r.next(A))}catch(F){u(F)}}function v(A){try{w(r.throw(A))}catch(F){u(F)}}function w(A){A.done?l(A.value):i(A.value).then(s,v)}w((r=r.apply(t,e||[])).next())})},Rwe=function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,i,l,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(w){return function(A){return v([w,A])}}function v(w){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,w[0]&&(n=0)),n;)try{if(r=1,i&&(l=w[0]&2?i.return:w[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,w[1])).done)return l;switch(i=0,l&&(w=[w[0]&2,l.value]),w[0]){case 0:case 1:l=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!l||w[1]>l[0]&&w[1]<l[3])){n.label=w[1];break}if(w[0]===6&&n.label<l[1]){n.label=l[1],l=w;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(w);break}l[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(A){w=[6,A],i=0}finally{r=l=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},s7=function(){function t(e,n,r){if(this.formatMap=new Map([[Cr.QR_CODE,"qr_code"],[Cr.AZTEC,"aztec"],[Cr.CODABAR,"codabar"],[Cr.CODE_39,"code_39"],[Cr.CODE_93,"code_93"],[Cr.CODE_128,"code_128"],[Cr.DATA_MATRIX,"data_matrix"],[Cr.ITF,"itf"],[Cr.EAN_13,"ean_13"],[Cr.EAN_8,"ean_8"],[Cr.PDF_417,"pdf417"],[Cr.UPC_A,"upc_a"],[Cr.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!t.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=n,this.logger=r;var i=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(i),!this.detector)throw"BarcodeDetector detector not supported"}return t.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var e=new BarcodeDetector({formats:["qr_code"]});return typeof e<"u"},t.prototype.decodeAsync=function(e){return Awe(this,void 0,void 0,function(){var n,r;return Rwe(this,function(i){switch(i.label){case 0:return[4,this.detector.detect(e)];case 1:if(n=i.sent(),!n||n.length===0)throw"No barcode or QR code detected.";return r=this.selectLargestBarcode(n),[2,{text:r.rawValue,format:JQ.create(this.toHtml5QrcodeSupportedFormats(r.format)),debugData:this.createDebugData()}]}})})},t.prototype.selectLargestBarcode=function(e){for(var n=null,r=0,i=0,l=e;i<l.length;i++){var u=l[i],s=u.boundingBox.width*u.boundingBox.height;s>r&&(r=s,n=u)}if(!n)throw"No largest barcode found";return n},t.prototype.createBarcodeDetectorFormats=function(e){for(var n=[],r=0,i=e;r<i.length;r++){var l=i[r];this.formatMap.has(l)?n.push(this.formatMap.get(l)):this.logger.warn("".concat(l," is not supported by")+"BarcodeDetectorDelegate")}return{formats:n}},t.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},t.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(n,r,i){e.set(n,r)}),e},t.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},t}(),o7=function(t,e,n,r){function i(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function s(A){try{w(r.next(A))}catch(F){u(F)}}function v(A){try{w(r.throw(A))}catch(F){u(F)}}function w(A){A.done?l(A.value):i(A.value).then(s,v)}w((r=r.apply(t,e||[])).next())})},a7=function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,i,l,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(w){return function(A){return v([w,A])}}function v(w){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,w[0]&&(n=0)),n;)try{if(r=1,i&&(l=w[0]&2?i.return:w[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,w[1])).done)return l;switch(i=0,l&&(w=[w[0]&2,l.value]),w[0]){case 0:case 1:l=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!l||w[1]>l[0]&&w[1]<l[3])){n.label=w[1];break}if(w[0]===6&&n.label<l[1]){n.label=l[1],l=w;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(w);break}l[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(A){w=[6,A],i=0}finally{r=l=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},Mwe=function(){function t(e,n,r,i){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=r,n&&s7.isSupported()?(this.primaryDecoder=new s7(e,r,i),this.secondaryDecoder=new i7(e,r,i)):this.primaryDecoder=new i7(e,r,i)}return t.prototype.decodeAsync=function(e){return o7(this,void 0,void 0,function(){var n;return a7(this,function(r){switch(r.label){case 0:n=performance.now(),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,r.sent()];case 3:return this.possiblyLogPerformance(n),[7];case 4:return[2]}})})},t.prototype.decodeRobustlyAsync=function(e){return o7(this,void 0,void 0,function(){var n,r;return a7(this,function(i){switch(i.label){case 0:n=performance.now(),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,i.sent()];case 3:if(r=i.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw r;case 4:return this.possiblyLogPerformance(n),[7];case 5:return[2]}})})},t.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},t.prototype.possiblyLogPerformance=function(e){if(this.verbose){var n=performance.now()-e;this.executionResults.push(n),this.executions++,this.possiblyFlushPerformanceReport()}},t.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,n=0,r=this.executionResults;n<r.length;n++){var i=r[n];e+=i}var l=e/this.executionResults.length;console.log("".concat(l," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},t}(),U4=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(r[l]=i[l])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),fI=function(t,e,n,r){function i(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function s(A){try{w(r.next(A))}catch(F){u(F)}}function v(A){try{w(r.throw(A))}catch(F){u(F)}}function w(A){A.done?l(A.value):i(A.value).then(s,v)}w((r=r.apply(t,e||[])).next())})},pI=function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,i,l,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(w){return function(A){return v([w,A])}}function v(w){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,w[0]&&(n=0)),n;)try{if(r=1,i&&(l=w[0]&2?i.return:w[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,w[1])).done)return l;switch(i=0,l&&(w=[w[0]&2,l.value]),w[0]){case 0:case 1:l=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!l||w[1]>l[0]&&w[1]<l[3])){n.label=w[1];break}if(w[0]===6&&n.label<l[1]){n.label=l[1],l=w;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(w);break}l[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(A){w=[6,A],i=0}finally{r=l=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},rJ=function(){function t(e,n){this.name=e,this.track=n}return t.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},t.prototype.apply=function(e){var n={};n[this.name]=e;var r={advanced:[n]};return this.track.applyConstraints(r)},t.prototype.value=function(){var e=this.track.getSettings();if(this.name in e){var n=e[this.name];return n}return null},t}(),Pwe=function(t){U4(e,t);function e(n,r){return t.call(this,n,r)||this}return e.prototype.min=function(){return this.getCapabilities().min},e.prototype.max=function(){return this.getCapabilities().max},e.prototype.step=function(){return this.getCapabilities().step},e.prototype.apply=function(n){var r={};r[this.name]=n;var i={advanced:[r]};return this.track.applyConstraints(i)},e.prototype.getCapabilities=function(){this.failIfNotSupported();var n=this.track.getCapabilities(),r=n[this.name];return{min:r.min,max:r.max,step:r.step}},e.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},e}(rJ),Dwe=function(t){U4(e,t);function e(n){return t.call(this,"zoom",n)||this}return e}(Pwe),kwe=function(t){U4(e,t);function e(n){return t.call(this,"torch",n)||this}return e}(rJ),Nwe=function(){function t(e){this.track=e}return t.prototype.zoomFeature=function(){return new Dwe(this.track)},t.prototype.torchFeature=function(){return new kwe(this.track)},t}(),Owe=function(){function t(e,n,r){this.isClosed=!1,this.parentElement=e,this.mediaStream=n,this.callbacks=r,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return t.prototype.createVideoElement=function(e){var n=document.createElement("video");return n.style.width="".concat(e,"px"),n.style.display="block",n.muted=!0,n.setAttribute("muted","true"),n.playsInline=!0,n},t.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var n=function(){var r=e.surface.clientWidth,i=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(r,i),e.surface.removeEventListener("playing",n)};this.surface.addEventListener("playing",n),this.surface.srcObject=this.mediaStream,this.surface.play()},t.create=function(e,n,r,i){return fI(this,void 0,void 0,function(){var l,u;return pI(this,function(s){switch(s.label){case 0:return l=new t(e,n,i),r.aspectRatio?(u={aspectRatio:r.aspectRatio},[4,l.getFirstTrackOrFail().applyConstraints(u)]):[3,2];case 1:s.sent(),s.label=2;case 2:return l.setupSurface(),[2,l]}})})},t.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},t.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},t.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},t.prototype.resume=function(e){this.failIfClosed();var n=this,r=function(){setTimeout(e,200),n.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.play()},t.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},t.prototype.getSurface=function(){return this.failIfClosed(),this.surface},t.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},t.prototype.applyVideoConstraints=function(e){return fI(this,void 0,void 0,function(){return pI(this,function(n){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]})})},t.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise(function(n,r){var i=e.mediaStream.getVideoTracks(),l=i.length,u=0;e.mediaStream.getVideoTracks().forEach(function(s){e.mediaStream.removeTrack(s),s.stop(),++u,u>=l&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),n())})})},t.prototype.getCapabilities=function(){return new Nwe(this.getFirstTrackOrFail())},t}(),Lwe=function(){function t(e){this.mediaStream=e}return t.prototype.render=function(e,n,r){return fI(this,void 0,void 0,function(){return pI(this,function(i){return[2,Owe.create(e,this.mediaStream,n,r)]})})},t.create=function(e){return fI(this,void 0,void 0,function(){var n,r;return pI(this,function(i){switch(i.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return n={audio:!1,video:e},[4,navigator.mediaDevices.getUserMedia(n)];case 1:return r=i.sent(),[2,new t(r)]}})})},t}(),l7=function(t,e,n,r){function i(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function s(A){try{w(r.next(A))}catch(F){u(F)}}function v(A){try{w(r.throw(A))}catch(F){u(F)}}function w(A){A.done?l(A.value):i(A.value).then(s,v)}w((r=r.apply(t,e||[])).next())})},c7=function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,i,l,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(w){return function(A){return v([w,A])}}function v(w){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,w[0]&&(n=0)),n;)try{if(r=1,i&&(l=w[0]&2?i.return:w[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,w[1])).done)return l;switch(i=0,l&&(w=[w[0]&2,l.value]),w[0]){case 0:case 1:l=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!l||w[1]>l[0]&&w[1]<l[3])){n.label=w[1];break}if(w[0]===6&&n.label<l[1]){n.label=l[1],l=w;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(w);break}l[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(A){w=[6,A],i=0}finally{r=l=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},Fwe=function(){function t(){}return t.failIfNotSupported=function(){return l7(this,void 0,void 0,function(){return c7(this,function(e){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new t]})})},t.prototype.create=function(e){return l7(this,void 0,void 0,function(){return c7(this,function(n){return[2,Lwe.create(e)]})})},t}(),Bwe=function(t,e,n,r){function i(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function s(A){try{w(r.next(A))}catch(F){u(F)}}function v(A){try{w(r.throw(A))}catch(F){u(F)}}function w(A){A.done?l(A.value):i(A.value).then(s,v)}w((r=r.apply(t,e||[])).next())})},zwe=function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,i,l,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(w){return function(A){return v([w,A])}}function v(w){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,w[0]&&(n=0)),n;)try{if(r=1,i&&(l=w[0]&2?i.return:w[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,w[1])).done)return l;switch(i=0,l&&(w=[w[0]&2,l.value]),w[0]){case 0:case 1:l=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!l||w[1]>l[0]&&w[1]<l[3])){n.label=w[1];break}if(w[0]===6&&n.label<l[1]){n.label=l[1],l=w;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(w);break}l[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(A){w=[6,A],i=0}finally{r=l=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},jwe=function(){function t(){}return t.retrieve=function(){if(navigator.mediaDevices)return t.getCamerasFromMediaDevices();var e=MediaStreamTrack;return MediaStreamTrack&&e.getSources?t.getCamerasFromMediaStreamTrack():t.rejectWithError()},t.rejectWithError=function(){var e=uy.unableToQuerySupportedDevices();return t.isHttpsOrLocalhost()||(e=uy.insecureContextCameraQueryError()),Promise.reject(e)},t.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var e=location.host.split(":")[0];return e==="127.0.0.1"||e==="localhost"},t.getCamerasFromMediaDevices=function(){return Bwe(this,void 0,void 0,function(){var e,n,r,i,l,u,s;return zwe(this,function(v){switch(v.label){case 0:return e=function(w){for(var A=w.getVideoTracks(),F=0,W=A;F<W.length;F++){var K=W[F];K.enabled=!1,K.stop(),w.removeTrack(K)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return n=v.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(r=v.sent(),i=[],l=0,u=r;l<u.length;l++)s=u[l],s.kind==="videoinput"&&i.push({id:s.deviceId,label:s.label});return e(n),[2,i]}})})},t.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,n){var r=function(l){for(var u=[],s=0,v=l;s<v.length;s++){var w=v[s];w.kind==="video"&&u.push({id:w.id,label:w.label})}e(u)},i=MediaStreamTrack;i.getSources(r)})},t}(),ta;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.NOT_STARTED=1]="NOT_STARTED",t[t.SCANNING=2]="SCANNING",t[t.PAUSED=3]="PAUSED"})(ta||(ta={}));var Vwe=function(){function t(){this.state=ta.NOT_STARTED,this.onGoingTransactionNewState=ta.UNKNOWN}return t.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},t.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},t.prototype.execute=function(){if(this.onGoingTransactionNewState===ta.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=ta.UNKNOWN,this.directTransition(e)},t.prototype.cancel=function(){if(this.onGoingTransactionNewState===ta.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=ta.UNKNOWN},t.prototype.getState=function(){return this.state},t.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==ta.UNKNOWN)throw"Cannot transition to a new state, already under transition"},t.prototype.validateTransition=function(e){switch(this.state){case ta.UNKNOWN:throw"Transition from unknown is not allowed";case ta.NOT_STARTED:this.failIfNewStateIs(e,[ta.PAUSED]);break;case ta.SCANNING:break;case ta.PAUSED:break}},t.prototype.failIfNewStateIs=function(e,n){for(var r=0,i=n;r<i.length;r++){var l=i[r];if(e===l)throw"Cannot transition from ".concat(this.state," to ").concat(e)}},t}(),Uwe=function(){function t(e){this.stateManager=e}return t.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},t.prototype.directTransition=function(e){this.stateManager.directTransition(e)},t.prototype.getState=function(){return this.stateManager.getState()},t.prototype.canScanFile=function(){return this.stateManager.getState()===ta.NOT_STARTED},t.prototype.isScanning=function(){return this.stateManager.getState()!==ta.NOT_STARTED},t.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===ta.SCANNING},t.prototype.isPaused=function(){return this.stateManager.getState()===ta.PAUSED},t}(),Hwe=function(){function t(){}return t.create=function(){return new Uwe(new Vwe)},t}(),Wwe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(r[l]=i[l])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),iu=function(t){Wwe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e}(wh),$we=function(){function t(e,n){this.logger=n,this.fps=iu.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=e.disableFlip===!0,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=iu.DEFAULT_DISABLE_FLIP}return t.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?nJ.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},t.prototype.isShadedBoxEnabled=function(){return!dd(this.qrbox)},t.create=function(e,n){return new t(e,n)},t}(),u7=function(){function t(e,n){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.elementId=e,this.verbose=!1;var r;typeof n=="boolean"?this.verbose=n===!0:n&&(r=n,this.verbose=r.verbose===!0,r.experimentalFeatures),this.logger=new tJ(this.verbose),this.qrcode=new Mwe(this.getSupportedFormats(n),this.getUseBarCodeDetectorIfSupported(r),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=Hwe.create()}return t.prototype.start=function(e,n,r,i){var l=this;if(!e)throw"cameraIdOrConfig is required";if(!r||typeof r!="function")throw"qrCodeSuccessCallback is required and should be a function.";var u;i?u=i:u=this.verbose?this.logger.log:function(){};var s=$we.create(n,this.logger);this.clearElement();var v=!1;s.videoConstraints&&(s.isMediaStreamConstraintsValid()?v=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var w=v,A=document.getElementById(this.elementId);A.clientWidth?A.clientWidth:iu.DEFAULT_WIDTH,A.style.position="relative",this.shouldScan=!0,this.element=A;var F=this,W=this.stateManagerProxy.startTransition(ta.SCANNING);return new Promise(function(K,Q){var Z=w?s.videoConstraints:F.createVideoConstraints(e);if(!Z){W.cancel(),Q("videoConstraints should be defined");return}var oe={};(!w||s.aspectRatio)&&(oe.aspectRatio=s.aspectRatio);var ae={onRenderSurfaceReady:function(me,pe){F.setupUi(me,pe,s),F.isScanning=!0,F.foreverScan(s,r,u)}};Fwe.failIfNotSupported().then(function(me){me.create(Z).then(function(pe){return pe.render(l.element,oe,ae).then(function(_e){F.renderedCamera=_e,W.execute(),K(null)}).catch(function(_e){W.cancel(),Q(_e)})}).catch(function(pe){W.cancel(),Q(uy.errorGettingUserMedia(pe))})}).catch(function(me){W.cancel(),Q(uy.cameraStreamingNotSupported())})})},t.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(ta.PAUSED),this.showPausedState(),(dd(e)||e!==!0)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},t.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,n=function(){e.stateManagerProxy.directTransition(ta.SCANNING),e.hidePausedState()};if(!this.renderedCamera.isPaused()){n();return}this.renderedCamera.resume(function(){n()})},t.prototype.getState=function(){return this.stateManagerProxy.getState()},t.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var n=this.stateManagerProxy.startTransition(ta.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var r=function(){if(e.element){var l=document.getElementById(iu.SHADED_REGION_ELEMENT_ID);l&&e.element.removeChild(l)}},i=this;return this.renderedCamera.close().then(function(){return i.renderedCamera=null,i.element&&(i.element.removeChild(i.canvasElement),i.canvasElement=null),r(),i.qrRegion&&(i.qrRegion=null),i.context&&(i.context=null),n.execute(),i.hidePausedState(),i.isScanning=!1,Promise.resolve()})},t.prototype.scanFile=function(e,n){return this.scanFileV2(e,n).then(function(r){return r.decodedText})},t.prototype.scanFileV2=function(e,n){var r=this;if(!e||!(e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(dd(n)&&(n=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(i,l){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var u=new Image;u.onload=function(){var s=u.width,v=u.height,w=document.getElementById(r.elementId),A=w.clientWidth?w.clientWidth:iu.DEFAULT_WIDTH,F=Math.max(w.clientHeight?w.clientHeight:v,iu.FILE_SCAN_MIN_HEIGHT),W=r.computeCanvasDrawConfig(s,v,A,F);if(n){var K=r.createCanvasElement(A,F,"qr-canvas-visible");K.style.display="inline-block",w.appendChild(K);var Q=K.getContext("2d");if(!Q)throw"Unable to get 2d context from canvas";Q.canvas.width=A,Q.canvas.height=F,Q.drawImage(u,0,0,s,v,W.x,W.y,W.width,W.height)}var Z=iu.FILE_SCAN_HIDDEN_CANVAS_PADDING,oe=Math.max(u.width,W.width),ae=Math.max(u.height,W.height),me=oe+2*Z,pe=ae+2*Z,_e=r.createCanvasElement(me,pe);w.appendChild(_e);var De=_e.getContext("2d");if(!De)throw"Unable to get 2d context from canvas";De.canvas.width=me,De.canvas.height=pe,De.drawImage(u,0,0,s,v,Z,Z,oe,ae);try{r.qrcode.decodeRobustlyAsync(_e).then(function(Ae){i(n7.createFromQrcodeResult(Ae))}).catch(l)}catch(Ae){l("QR code parse error, error = ".concat(Ae))}},u.onerror=l,u.onabort=l,u.onstalled=l,u.onsuspend=l,u.src=URL.createObjectURL(e)})},t.prototype.clear=function(){this.clearElement()},t.getCameras=function(){return jwe.retrieve()},t.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},t.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},t.prototype.applyVideoConstraints=function(e){if(e){if(!nJ.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},t.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},t.prototype.getSupportedFormats=function(e){var n=[Cr.QR_CODE,Cr.AZTEC,Cr.CODABAR,Cr.CODE_39,Cr.CODE_93,Cr.CODE_128,Cr.DATA_MATRIX,Cr.MAXICODE,Cr.ITF,Cr.EAN_13,Cr.EAN_8,Cr.PDF_417,Cr.RSS_14,Cr.RSS_EXPANDED,Cr.UPC_A,Cr.UPC_E,Cr.UPC_EAN_EXTENSION];if(!e||typeof e=="boolean"||!e.formatsToSupport)return n;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(e.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],i=0,l=e.formatsToSupport;i<l.length;i++){var u=l[i];Swe(u)?r.push(u):this.logger.warn("Invalid format: ".concat(u," passed in config, ignoring."))}if(r.length===0)throw"None of formatsToSupport match supported values.";return r},t.prototype.getUseBarCodeDetectorIfSupported=function(e){if(dd(e))return!0;if(!dd(e.useBarCodeDetectorIfSupported))return e.useBarCodeDetectorIfSupported!==!1;if(dd(e.experimentalFeatures))return!0;var n=e.experimentalFeatures;return dd(n.useBarCodeDetectorIfSupported)?!0:n.useBarCodeDetectorIfSupported!==!1},t.prototype.validateQrboxSize=function(e,n,r){var i=this,l=r.qrbox;this.validateQrboxConfig(l);var u=this.toQrdimensions(e,n,l),s=function(w){if(w<iu.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(iu.MIN_QR_BOX_SIZE,"px.")},v=function(w){return w>e&&(i.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),w=e),w};s(u.width),s(u.height),u.width=v(u.width)},t.prototype.validateQrboxConfig=function(e){if(typeof e!="number"&&typeof e!="function"&&(e.width===void 0||e.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},t.prototype.toQrdimensions=function(e,n,r){if(typeof r=="number")return{width:r,height:r};if(typeof r=="function")try{return r(e,n)}catch(i){throw new Error("qrbox config was passed as a function but it failed with unknown error"+i)}return r},t.prototype.setupUi=function(e,n,r){r.isShadedBoxEnabled()&&this.validateQrboxSize(e,n,r);var i=dd(r.qrbox)?{width:e,height:n}:r.qrbox;this.validateQrboxConfig(i);var l=this.toQrdimensions(e,n,i);l.height>n&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var u=r.isShadedBoxEnabled()&&l.height<=n,s={x:0,y:0,width:e,height:n},v=u?this.getShadedRegionBounds(e,n,l):s,w=this.createCanvasElement(v.width,v.height),A={willReadFrequently:!0},F=w.getContext("2d",A);F.canvas.width=v.width,F.canvas.height=v.height,this.element.append(w),u&&this.possiblyInsertShadingElement(this.element,e,n,l),this.createScannerPausedUiElement(this.element),this.qrRegion=v,this.context=F,this.canvasElement=w},t.prototype.createScannerPausedUiElement=function(e){var n=document.createElement("div");n.innerText=uy.scannerPaused(),n.style.display="none",n.style.position="absolute",n.style.top="0px",n.style.zIndex="1",n.style.background="rgba(9, 9, 9, 0.46)",n.style.color="#FFECEC",n.style.textAlign="center",n.style.width="100%",e.appendChild(n),this.scannerPausedUiElement=n},t.prototype.scanContext=function(e,n){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(i){return e(i.text,n7.createFromQrcodeResult(i)),r.possiblyUpdateShaders(!0),!0}).catch(function(i){r.possiblyUpdateShaders(!1);var l=uy.codeParseError(i);return n(l,eJ.createFrom(l)),!1})},t.prototype.foreverScan=function(e,n,r){var i=this;if(this.shouldScan&&this.renderedCamera){var l=this.renderedCamera.getSurface(),u=l.videoWidth/l.clientWidth,s=l.videoHeight/l.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var v=this.qrRegion.width*u,w=this.qrRegion.height*s,A=this.qrRegion.x*u,F=this.qrRegion.y*s;this.context.drawImage(l,A,F,v,w,0,0,this.qrRegion.width,this.qrRegion.height);var W=function(){i.foreverScanTimeout=setTimeout(function(){i.foreverScan(e,n,r)},i.getTimeoutFps(e.fps))};this.scanContext(n,r).then(function(K){!K&&e.disableFlip!==!0?(i.context.translate(i.context.canvas.width,0),i.context.scale(-1,1),i.scanContext(n,r).finally(function(){W()})):W()}).catch(function(K){i.logger.logError("Error happend while scanning context",K),W()})}},t.prototype.createVideoConstraints=function(e){if(typeof e=="string")return{deviceId:{exact:e}};if(typeof e=="object"){var n="facingMode",r="deviceId",i={user:!0,environment:!0},l="exact",u=function(Q){if(Q in i)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(Q,"'")},s=Object.keys(e);if(s.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(s.length," keys");var v=Object.keys(e)[0];if(v!==n&&v!==r)throw"Only '".concat(n,"' and '").concat(r,"' ")+" are supported for 'cameraIdOrConfig'";if(v===n){var w=e.facingMode;if(typeof w=="string"){if(u(w))return{facingMode:w}}else if(typeof w=="object")if(l in w){if(u(w["".concat(l)]))return{facingMode:{exact:w["".concat(l)]}}}else throw"'facingMode' should be string or object with"+" ".concat(l," as key.");else{var A=typeof w;throw"Invalid type of 'facingMode' = ".concat(A)}}else{var F=e.deviceId;if(typeof F=="string")return{deviceId:F};if(typeof F=="object"){if(l in F)return{deviceId:{exact:F["".concat(l)]}};throw"'deviceId' should be string or object with"+" ".concat(l," as key.")}else{var W=typeof F;throw"Invalid type of 'deviceId' = ".concat(W)}}}var K=typeof e;throw"Invalid type of 'cameraIdOrConfig' = ".concat(K)},t.prototype.computeCanvasDrawConfig=function(e,n,r,i){if(e<=r&&n<=i){var l=(r-e)/2,u=(i-n)/2;return{x:l,y:u,width:e,height:n}}else{var s=e,v=n;return e>r&&(n=r/e*n,e=r),n>i&&(e=i/n*e,n=i),this.logger.log("Image downsampled from "+"".concat(s,"X").concat(v)+" to ".concat(e,"X").concat(n,".")),this.computeCanvasDrawConfig(e,n,r,i)}},t.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},t.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(n){n.style.backgroundColor=e?iu.BORDER_SHADER_MATCH_COLOR:iu.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},t.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},t.prototype.createCanvasElement=function(e,n,r){var i=e,l=n,u=document.createElement("canvas");return u.style.width="".concat(i,"px"),u.style.height="".concat(l,"px"),u.style.display="none",u.id=dd(r)?"qr-canvas":r,u},t.prototype.getShadedRegionBounds=function(e,n,r){if(r.width>e||r.height>n)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(n-r.height)/2,width:r.width,height:r.height}},t.prototype.possiblyInsertShadingElement=function(e,n,r,i){if(!(n-i.width<1||r-i.height<1)){var l=document.createElement("div");l.style.position="absolute";var u=(n-i.width)/2,s=(r-i.height)/2;if(l.style.borderLeft="".concat(u,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderRight="".concat(u,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderTop="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderBottom="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),l.style.boxSizing="border-box",l.style.top="0px",l.style.bottom="0px",l.style.left="0px",l.style.right="0px",l.id="".concat(iu.SHADED_REGION_ELEMENT_ID),n-i.width<11||r-i.height<11)this.hasBorderShaders=!1;else{var v=5,w=40;this.insertShaderBorders(l,w,v,-v,null,0,!0),this.insertShaderBorders(l,w,v,-v,null,0,!1),this.insertShaderBorders(l,w,v,null,-v,0,!0),this.insertShaderBorders(l,w,v,null,-v,0,!1),this.insertShaderBorders(l,v,w+v,-v,null,-v,!0),this.insertShaderBorders(l,v,w+v,null,-v,-v,!0),this.insertShaderBorders(l,v,w+v,-v,null,-v,!1),this.insertShaderBorders(l,v,w+v,null,-v,-v,!1),this.hasBorderShaders=!0}e.append(l)}},t.prototype.insertShaderBorders=function(e,n,r,i,l,u,s){var v=document.createElement("div");v.style.position="absolute",v.style.backgroundColor=iu.BORDER_SHADER_DEFAULT_COLOR,v.style.width="".concat(n,"px"),v.style.height="".concat(r,"px"),i!==null&&(v.style.top="".concat(i,"px")),l!==null&&(v.style.bottom="".concat(l,"px")),s?v.style.left="".concat(u,"px"):v.style.right="".concat(u,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(v),e.appendChild(v)},t.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},t.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},t.prototype.getTimeoutFps=function(e){return 1e3/e},t}(),H4="data:image/svg+xml;base64,",qwe=H4+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",Gwe=H4+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",h7=H4+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",Ywe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",d7=function(){function t(){}return t.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},t}(),Xwe=function(){function t(){this.data=d7.createDefault();var e=localStorage.getItem(t.LOCAL_STORAGE_KEY);e?this.data=JSON.parse(e):this.reset()}return t.prototype.hasCameraPermissions=function(){return this.data.hasPermission},t.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},t.prototype.setHasPermission=function(e){this.data.hasPermission=e,this.flush()},t.prototype.setLastUsedCameraId=function(e){this.data.lastUsedCameraId=e,this.flush()},t.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},t.prototype.reset=function(){this.data=d7.createDefault(),this.flush()},t.prototype.flush=function(){localStorage.setItem(t.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},t.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",t}(),Kwe=function(){function t(){this.infoDiv=document.createElement("div")}return t.prototype.renderInto=function(e){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=r7.poweredBy();var n=document.createElement("a");n.innerText="ScanApp",n.href="https://scanapp.org",n.target="new",n.style.color="white",this.infoDiv.appendChild(n);var r=document.createElement("br"),i=document.createElement("br");this.infoDiv.appendChild(r),this.infoDiv.appendChild(i);var l=document.createElement("a");l.innerText=r7.reportIssues(),l.href="https://github.com/mebjas/html5-qrcode/issues",l.target="new",l.style.color="white",this.infoDiv.appendChild(l),e.appendChild(this.infoDiv)},t.prototype.show=function(){this.infoDiv.style.display="block"},t.prototype.hide=function(){this.infoDiv.style.display="none"},t}(),Zwe=function(){function t(e,n){this.isShowingInfoIcon=!0,this.onTapIn=e,this.onTapOut=n,this.infoIcon=document.createElement("img")}return t.prototype.renderInto=function(e){var n=this;this.infoIcon.alt="Info icon",this.infoIcon.src=h7,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(r){return n.onHoverIn()},this.infoIcon.onmouseout=function(r){return n.onHoverOut()},this.infoIcon.onclick=function(r){return n.onClick()},e.appendChild(this.infoIcon)},t.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},t.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},t.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=Ywe,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=h7,this.infoIcon.style.opacity="0.6")},t}(),Qwe=function(){function t(){var e=this;this.infoDiv=new Kwe,this.infoIcon=new Zwe(function(){e.infoDiv.show()},function(){e.infoDiv.hide()})}return t.prototype.renderInto=function(e){this.infoDiv.renderInto(e),this.infoIcon.renderInto(e)},t}(),Jwe=function(t,e,n,r){function i(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function s(A){try{w(r.next(A))}catch(F){u(F)}}function v(A){try{w(r.throw(A))}catch(F){u(F)}}function w(A){A.done?l(A.value):i(A.value).then(s,v)}w((r=r.apply(t,e||[])).next())})},e2e=function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,i,l,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(w){return function(A){return v([w,A])}}function v(w){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,w[0]&&(n=0)),n;)try{if(r=1,i&&(l=w[0]&2?i.return:w[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,w[1])).done)return l;switch(i=0,l&&(w=[w[0]&2,l.value]),w[0]){case 0:case 1:l=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!l||w[1]>l[0]&&w[1]<l[3])){n.label=w[1];break}if(w[0]===6&&n.label<l[1]){n.label=l[1],l=w;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(w);break}l[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(A){w=[6,A],i=0}finally{r=l=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},f7=function(){function t(){}return t.hasPermissions=function(){return Jwe(this,void 0,void 0,function(){var e,n,r,i;return e2e(this,function(l){switch(l.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(e=l.sent(),n=0,r=e;n<r.length;n++)if(i=r[n],i.kind==="videoinput"&&i.label)return[2,!0];return[2,!1]}})})},t}(),Rp=function(){function t(e){this.supportedScanTypes=this.validateAndReturnScanTypes(e)}return t.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},t.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},t.prototype.isCameraScanRequired=function(){for(var e=0,n=this.supportedScanTypes;e<n.length;e++){var r=n[e];if(t.isCameraScanType(r))return!0}return!1},t.isCameraScanType=function(e){return e===Cm.SCAN_TYPE_CAMERA},t.isFileScanType=function(e){return e===Cm.SCAN_TYPE_FILE},t.prototype.validateAndReturnScanTypes=function(e){if(!e||e.length===0)return wh.DEFAULT_SUPPORTED_SCAN_TYPE;var n=wh.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(e.length>n)throw"Max ".concat(n," values expected for ")+"supportedScanTypes";for(var r=0,i=e;r<i.length;r++){var l=i[r];if(!wh.DEFAULT_SUPPORTED_SCAN_TYPE.includes(l))throw"Unsupported scan type ".concat(l)}return e},t}(),lu=function(){function t(){}return t.ALL_ELEMENT_CLASS="html5-qrcode-element",t.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",t.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",t.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",t.TORCH_BUTTON_ID="html5-qrcode-button-torch",t.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",t.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",t.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",t.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",t.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",t.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",t}(),pf=function(){function t(){}return t.createElement=function(e,n){var r=document.createElement(e);return r.id=n,r.classList.add(lu.ALL_ELEMENT_CLASS),e==="button"&&r.setAttribute("type","button"),r},t}(),iJ=function(t,e,n,r){function i(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function s(A){try{w(r.next(A))}catch(F){u(F)}}function v(A){try{w(r.throw(A))}catch(F){u(F)}}function w(A){A.done?l(A.value):i(A.value).then(s,v)}w((r=r.apply(t,e||[])).next())})},sJ=function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,i,l,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(w){return function(A){return v([w,A])}}function v(w){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,w[0]&&(n=0)),n;)try{if(r=1,i&&(l=w[0]&2?i.return:w[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,w[1])).done)return l;switch(i=0,l&&(w=[w[0]&2,l.value]),w[0]){case 0:case 1:l=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!l||w[1]>l[0]&&w[1]<l[3])){n.label=w[1];break}if(w[0]===6&&n.label<l[1]){n.label=l[1],l=w;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(w);break}l[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(A){w=[6,A],i=0}finally{r=l=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},p7=function(){function t(e,n,r){this.isTorchOn=!1,this.torchCapability=e,this.buttonController=n,this.onTorchActionFailureCallback=r}return t.prototype.isTorchEnabled=function(){return this.isTorchOn},t.prototype.flipState=function(){return iJ(this,void 0,void 0,function(){var e,n;return sJ(this,function(r){switch(r.label){case 0:this.buttonController.disable(),e=!this.isTorchOn,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.torchCapability.apply(e)];case 2:return r.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),e),[3,4];case 3:return n=r.sent(),this.propagateFailure(e,n),this.buttonController.enable(),[3,4];case 4:return[2]}})})},t.prototype.updateUiBasedOnLatestSettings=function(e,n){e===n?(this.buttonController.setText(n?Xs.torchOffButton():Xs.torchOnButton()),this.isTorchOn=n):this.propagateFailure(n),this.buttonController.enable()},t.prototype.propagateFailure=function(e,n){var r=e?Xs.torchOnFailedMessage():Xs.torchOffFailedMessage();n&&(r+="; Error = "+n),this.onTorchActionFailureCallback(r)},t.prototype.reset=function(){this.isTorchOn=!1},t}(),t2e=function(){function t(e,n){this.onTorchActionFailureCallback=n,this.torchButton=pf.createElement("button",lu.TORCH_BUTTON_ID),this.torchController=new p7(e,this,n)}return t.prototype.render=function(e,n){var r=this;this.torchButton.innerText=Xs.torchOnButton(),this.torchButton.style.display=n.display,this.torchButton.style.marginLeft=n.marginLeft;var i=this;this.torchButton.addEventListener("click",function(l){return iJ(r,void 0,void 0,function(){return sJ(this,function(u){switch(u.label){case 0:return[4,i.torchController.flipState()];case 1:return u.sent(),i.torchController.isTorchEnabled()?(i.torchButton.classList.remove(lu.TORCH_BUTTON_CLASS_TORCH_OFF),i.torchButton.classList.add(lu.TORCH_BUTTON_CLASS_TORCH_ON)):(i.torchButton.classList.remove(lu.TORCH_BUTTON_CLASS_TORCH_ON),i.torchButton.classList.add(lu.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),e.appendChild(this.torchButton)},t.prototype.updateTorchCapability=function(e){this.torchController=new p7(e,this,this.onTorchActionFailureCallback)},t.prototype.getTorchButton=function(){return this.torchButton},t.prototype.hide=function(){this.torchButton.style.display="none"},t.prototype.show=function(){this.torchButton.style.display="inline-block"},t.prototype.disable=function(){this.torchButton.disabled=!0},t.prototype.enable=function(){this.torchButton.disabled=!1},t.prototype.setText=function(e){this.torchButton.innerText=e},t.prototype.reset=function(){this.torchButton.innerText=Xs.torchOnButton(),this.torchController.reset()},t.create=function(e,n,r,i){var l=new t(n,i);return l.render(e,r),l},t}(),n2e=function(){function t(e,n,r){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=n?"block":"none",e.appendChild(this.fileBasedScanRegion);var i=document.createElement("label");i.setAttribute("for",this.getFileScanInputId()),i.style.display="inline-block",this.fileBasedScanRegion.appendChild(i),this.fileSelectionButton=pf.createElement("button",lu.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(s){i.click()}),i.append(this.fileSelectionButton),this.fileScanInput=pf.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",i.appendChild(this.fileScanInput);var l=this;this.fileScanInput.addEventListener("change",function(s){if(!(s==null||s.target==null)){var v=s.target;if(!(v.files&&v.files.length===0)){var w=v.files,A=w[0],F=A.name;l.setImageNameToButton(F),r(A)}}});var u=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(u),this.fileBasedScanRegion.addEventListener("dragenter",function(s){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionActiveBorder(),s.stopPropagation(),s.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(s){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionDefaultBorder(),s.stopPropagation(),s.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(s){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionActiveBorder(),s.stopPropagation(),s.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(s){s.stopPropagation(),s.preventDefault(),l.fileBasedScanRegion.style.border=l.fileBasedScanRegionDefaultBorder();var v=s.dataTransfer;if(v){var w=v.files;if(!w||w.length===0)return;for(var A=!1,F=0;F<w.length;++F){var W=w.item(F);if(W){var K=/image.*/;if(W.type.match(K)){A=!0;var Q=W.name;l.setImageNameToButton(Q),r(W),u.innerText=Xs.dragAndDropMessage();break}}}A||(u.innerText=Xs.dragAndDropMessageOnlyImages())}})}return t.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},t.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},t.prototype.isShowing=function(){return this.fileBasedScanRegion.style.display==="block"},t.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},t.prototype.createFileBasedScanRegion=function(){var e=document.createElement("div");return e.style.textAlign="center",e.style.margin="auto",e.style.width="80%",e.style.maxWidth="600px",e.style.border=this.fileBasedScanRegionDefaultBorder(),e.style.padding="10px",e.style.marginBottom="10px",e},t.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},t.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},t.prototype.createDragAndDropMessage=function(){var e=document.createElement("div");return e.innerText=Xs.dragAndDropMessage(),e.style.fontWeight="400",e},t.prototype.setImageNameToButton=function(e){var n=20;if(e.length>n){var r=e.substring(0,8),i=e.length,l=e.substring(i-8,i);e="".concat(r,"....").concat(l)}var u=Xs.fileSelectionChooseAnother()+" - "+e;this.fileSelectionButton.innerText=u},t.prototype.setInitialValueToButton=function(){var e=Xs.fileSelectionChooseImage()+" - "+Xs.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=e},t.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},t.create=function(e,n,r){var i=new t(e,n,r);return i},t}(),r2e=function(){function t(e){this.selectElement=pf.createElement("select",lu.CAMERA_SELECTION_SELECT_ID),this.cameras=e,this.options=[]}return t.prototype.render=function(e){var n=document.createElement("span");n.style.marginRight="10px";var r=this.cameras.length;if(r===0)throw new Error("No cameras found");if(r===1)n.style.display="none";else{var i=Xs.selectCamera();n.innerText="".concat(i," (").concat(this.cameras.length,")  ")}for(var l=1,u=0,s=this.cameras;u<s.length;u++){var v=s[u],w=v.id,A=v.label==null?w:v.label;(!A||A==="")&&(A=[Xs.anonymousCameraPrefix(),l++].join(" "));var F=document.createElement("option");F.value=w,F.innerText=A,this.options.push(F),this.selectElement.appendChild(F)}n.appendChild(this.selectElement),e.appendChild(n)},t.prototype.disable=function(){this.selectElement.disabled=!0},t.prototype.isDisabled=function(){return this.selectElement.disabled===!0},t.prototype.enable=function(){this.selectElement.disabled=!1},t.prototype.getValue=function(){return this.selectElement.value},t.prototype.hasValue=function(e){for(var n=0,r=this.options;n<r.length;n++){var i=r[n];if(i.value===e)return!0}return!1},t.prototype.setValue=function(e){if(!this.hasValue(e))throw new Error("".concat(e," is not present in the camera list."));this.selectElement.value=e},t.prototype.hasSingleItem=function(){return this.cameras.length===1},t.prototype.numCameras=function(){return this.cameras.length},t.create=function(e,n){var r=new t(n);return r.render(e),r},t}(),i2e=function(){function t(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=pf.createElement("input",lu.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return t.prototype.render=function(e,n){this.zoomElementContainer.style.display=n?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",e.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var r=Xs.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(r),this.rangeText.style.marginRight="10px";var i=this;this.rangeInput.addEventListener("input",function(){return i.onValueChange()}),this.rangeInput.addEventListener("change",function(){return i.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},t.prototype.onValueChange=function(){var e=Xs.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(e),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},t.prototype.setValues=function(e,n,r,i){this.rangeInput.min=e.toString(),this.rangeInput.max=n.toString(),this.rangeInput.step=i.toString(),this.rangeInput.value=r.toString(),this.onValueChange()},t.prototype.show=function(){this.zoomElementContainer.style.display="block"},t.prototype.hide=function(){this.zoomElementContainer.style.display="none"},t.prototype.setOnCameraZoomValueChangeCallback=function(e){this.onChangeCallback=e},t.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},t.create=function(e,n){var r=new t;return r.render(e,n),r},t}(),su;(function(t){t[t.STATUS_DEFAULT=0]="STATUS_DEFAULT",t[t.STATUS_SUCCESS=1]="STATUS_SUCCESS",t[t.STATUS_WARNING=2]="STATUS_WARNING",t[t.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(su||(su={}));function s2e(t){return{fps:t.fps,qrbox:t.qrbox,aspectRatio:t.aspectRatio,disableFlip:t.disableFlip,videoConstraints:t.videoConstraints}}function o2e(t,e){return{formatsToSupport:t.formatsToSupport,useBarCodeDetectorIfSupported:t.useBarCodeDetectorIfSupported,experimentalFeatures:t.experimentalFeatures,verbose:e}}var a2e=function(){function t(e,n,r){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=e,this.config=this.createConfig(n),this.verbose=r===!0,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.scanTypeSelector=new Rp(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new tJ(this.verbose),this.persistedDataManager=new Xwe,n.rememberLastUsedCamera!==!0&&this.persistedDataManager.reset()}return t.prototype.render=function(e,n){var r=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(l,u){if(e)e(l,u);else{if(r.lastMatchFound===l)return;r.lastMatchFound=l,r.setHeaderMessage(Xs.lastMatch(l),su.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(l,u){n&&n(l,u)};var i=document.getElementById(this.elementId);if(!i)throw"HTML Element with id=".concat(this.elementId," not found");i.innerHTML="",this.createBasicLayout(i),this.html5Qrcode=new u7(this.getScanRegionId(),o2e(this.config,this.verbose))},t.prototype.pause=function(e){(dd(e)||e!==!0)&&(e=!1),this.getHtml5QrcodeOrFail().pause(e)},t.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},t.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},t.prototype.clear=function(){var e=this,n=function(){var r=document.getElementById(e.elementId);r&&(r.innerHTML="",e.resetBasicLayout(r))};return this.html5Qrcode?new Promise(function(r,i){if(!e.html5Qrcode){r();return}e.html5Qrcode.isScanning?e.html5Qrcode.stop().then(function(l){if(!e.html5Qrcode){r();return}e.html5Qrcode.clear(),n(),r()}).catch(function(l){e.verbose&&e.logger.logError("Unable to stop qrcode scanner",l),i(l)}):(e.html5Qrcode.clear(),n(),r())}):Promise.resolve()},t.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},t.prototype.applyVideoConstraints=function(e){return this.getHtml5QrcodeOrFail().applyVideoConstraints(e)},t.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},t.prototype.createConfig=function(e){return e?(e.fps||(e.fps=wh.SCAN_DEFAULT_FPS),e.rememberLastUsedCamera!==!wh.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(e.rememberLastUsedCamera=wh.DEFAULT_REMEMBER_LAST_CAMERA_USED),e.supportedScanTypes||(e.supportedScanTypes=wh.DEFAULT_SUPPORTED_SCAN_TYPE),e):{fps:wh.SCAN_DEFAULT_FPS,rememberLastUsedCamera:wh.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:wh.DEFAULT_SUPPORTED_SCAN_TYPE}},t.prototype.createBasicLayout=function(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);var n=document.createElement("div"),r=this.getScanRegionId();n.id=r,n.style.width="100%",n.style.minHeight="100px",n.style.textAlign="center",e.appendChild(n),Rp.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var i=document.createElement("div"),l=this.getDashboardId();i.id=l,i.style.width="100%",e.appendChild(i),this.setupInitialDashboard(i)},t.prototype.resetBasicLayout=function(e){e.style.border="none"},t.prototype.setupInitialDashboard=function(e){this.createSection(e),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},t.prototype.createHeader=function(e){var n=document.createElement("div");n.style.textAlign="left",n.style.margin="0px",e.appendChild(n);var r=new Qwe;r.renderInto(n);var i=document.createElement("div");i.id=this.getHeaderMessageContainerId(),i.style.display="none",i.style.textAlign="center",i.style.fontSize="14px",i.style.padding="2px 10px",i.style.margin="4px",i.style.borderTop="1px solid #f6f6f6",n.appendChild(i)},t.prototype.createSection=function(e){var n=document.createElement("div");n.id=this.getDashboardSectionId(),n.style.width="100%",n.style.padding="10px 0px 10px 0px",n.style.textAlign="left",e.appendChild(n)},t.prototype.createCameraListUi=function(e,n,r){var i=this;i.showHideScanTypeSwapLink(!1),i.setHeaderMessage(Xs.cameraPermissionRequesting());var l=function(){r||i.createPermissionButton(e,n)};u7.getCameras().then(function(u){i.persistedDataManager.setHasPermission(!0),i.showHideScanTypeSwapLink(!0),i.resetHeaderMessage(),u&&u.length>0?(e.removeChild(n),i.renderCameraSelection(u)):(i.setHeaderMessage(Xs.noCameraFound(),su.STATUS_WARNING),l())}).catch(function(u){i.persistedDataManager.setHasPermission(!1),r?r.disabled=!1:l(),i.setHeaderMessage(u,su.STATUS_WARNING),i.showHideScanTypeSwapLink(!0)})},t.prototype.createPermissionButton=function(e,n){var r=this,i=pf.createElement("button",this.getCameraPermissionButtonId());i.innerText=Xs.cameraPermissionTitle(),i.addEventListener("click",function(){i.disabled=!0,r.createCameraListUi(e,n,i)}),n.appendChild(i)},t.prototype.createPermissionsUi=function(e,n){var r=this;if(Rp.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()){f7.hasPermissions().then(function(i){i?r.createCameraListUi(e,n):(r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,n))}).catch(function(i){r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,n)});return}this.createPermissionButton(e,n)},t.prototype.createSectionControlPanel=function(){var e=document.getElementById(this.getDashboardSectionId()),n=document.createElement("div");e.appendChild(n);var r=document.createElement("div");r.id=this.getDashboardSectionCameraScanRegionId(),r.style.display=Rp.isCameraScanType(this.currentScanType)?"block":"none",n.appendChild(r);var i=document.createElement("div");i.style.textAlign="center",r.appendChild(i),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(r,i),this.renderFileScanUi(n)},t.prototype.renderFileScanUi=function(e){var n=Rp.isFileScanType(this.currentScanType),r=this,i=function(l){if(!r.html5Qrcode)throw"html5Qrcode not defined";Rp.isFileScanType(r.currentScanType)&&(r.setHeaderMessage(Xs.loadingImage()),r.html5Qrcode.scanFileV2(l,!0).then(function(u){r.resetHeaderMessage(),r.qrCodeSuccessCallback(u.decodedText,u)}).catch(function(u){r.setHeaderMessage(u,su.STATUS_WARNING),r.qrCodeErrorCallback(u,eJ.createFrom(u))}))};this.fileSelectionUi=n2e.create(e,n,i)},t.prototype.renderCameraSelection=function(e){var n=this,r=this,i=document.getElementById(this.getDashboardSectionCameraScanRegionId());i.style.textAlign="center";var l=i2e.create(i,!1),u=function(Z){var oe=Z.zoomFeature();if(oe.isSupported()){l.setOnCameraZoomValueChangeCallback(function(me){oe.apply(me)});var ae=1;n.config.defaultZoomValueIfSupported&&(ae=n.config.defaultZoomValueIfSupported),ae=Twe(ae,oe.min(),oe.max()),l.setValues(oe.min(),oe.max(),ae,oe.step()),l.show()}},s=r2e.create(i,e),v=document.createElement("span"),w=pf.createElement("button",lu.CAMERA_START_BUTTON_ID);w.innerText=Xs.scanButtonStartScanningText(),v.appendChild(w);var A=pf.createElement("button",lu.CAMERA_STOP_BUTTON_ID);A.innerText=Xs.scanButtonStopScanningText(),A.style.display="none",A.disabled=!0,v.appendChild(A);var F,W=function(Z){if(!Z.torchFeature().isSupported()){F&&F.hide();return}F?F.updateTorchCapability(Z.torchFeature()):F=t2e.create(v,Z.torchFeature(),{display:"none",marginLeft:"5px"},function(oe){r.setHeaderMessage(oe,su.STATUS_WARNING)}),F.show()};i.appendChild(v);var K=function(Z){Z||(w.style.display="none"),w.innerText=Xs.scanButtonStartScanningText(),w.style.opacity="1",w.disabled=!1,Z&&(w.style.display="inline-block")};if(w.addEventListener("click",function(Z){w.innerText=Xs.scanButtonScanningStarting(),s.disable(),w.disabled=!0,w.style.opacity="0.5",n.scanTypeSelector.hasMoreThanOneScanType()&&r.showHideScanTypeSwapLink(!1),r.resetHeaderMessage();var oe=s.getValue();r.persistedDataManager.setLastUsedCameraId(oe),r.html5Qrcode.start(oe,s2e(r.config),r.qrCodeSuccessCallback,r.qrCodeErrorCallback).then(function(ae){A.disabled=!1,A.style.display="inline-block",K(!1);var me=r.html5Qrcode.getRunningTrackCameraCapabilities();n.config.showTorchButtonIfSupported===!0&&W(me),n.config.showZoomSliderIfSupported===!0&&u(me)}).catch(function(ae){r.showHideScanTypeSwapLink(!0),s.enable(),K(!0),r.setHeaderMessage(ae,su.STATUS_WARNING)})}),s.hasSingleItem()&&w.click(),A.addEventListener("click",function(Z){if(!r.html5Qrcode)throw"html5Qrcode not defined";A.disabled=!0,r.html5Qrcode.stop().then(function(oe){n.scanTypeSelector.hasMoreThanOneScanType()&&r.showHideScanTypeSwapLink(!0),s.enable(),w.disabled=!1,A.style.display="none",w.style.display="inline-block",F&&(F.reset(),F.hide()),l.removeOnCameraZoomValueChangeCallback(),l.hide(),r.insertCameraScanImageToScanRegion()}).catch(function(oe){A.disabled=!1,r.setHeaderMessage(oe,su.STATUS_WARNING)})}),r.persistedDataManager.getLastUsedCameraId()){var Q=r.persistedDataManager.getLastUsedCameraId();s.hasValue(Q)?(s.setValue(Q),w.click()):r.persistedDataManager.resetLastUsedCameraId()}},t.prototype.createSectionSwap=function(){var e=this,n=Xs.textIfCameraScanSelected(),r=Xs.textIfFileScanSelected(),i=document.getElementById(this.getDashboardSectionId()),l=document.createElement("div");l.style.textAlign="center";var u=pf.createElement("span",this.getDashboardSectionSwapLinkId());u.style.textDecoration="underline",u.style.cursor="pointer",u.innerText=Rp.isCameraScanType(this.currentScanType)?n:r,u.addEventListener("click",function(){if(!e.sectionSwapAllowed){e.verbose&&e.logger.logError("Section swap called when not allowed");return}e.resetHeaderMessage(),e.fileSelectionUi.resetValue(),e.sectionSwapAllowed=!1,Rp.isCameraScanType(e.currentScanType)?(e.clearScanRegion(),e.getCameraScanRegion().style.display="none",e.fileSelectionUi.show(),u.innerText=r,e.currentScanType=Cm.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getCameraScanRegion().style.display="block",e.fileSelectionUi.hide(),u.innerText=n,e.currentScanType=Cm.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion(),e.startCameraScanIfPermissionExistsOnSwap()),e.sectionSwapAllowed=!0}),l.appendChild(u),i.appendChild(l)},t.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var e=this,n=this;if(this.persistedDataManager.hasCameraPermissions()){f7.hasPermissions().then(function(r){if(r){var i=document.getElementById(n.getCameraPermissionButtonId());if(!i)throw e.logger.logError("Permission button not found, fail;"),"Permission button not found";i.click()}else n.persistedDataManager.setHasPermission(!1)}).catch(function(r){n.persistedDataManager.setHasPermission(!1)});return}},t.prototype.resetHeaderMessage=function(){var e=document.getElementById(this.getHeaderMessageContainerId());e.style.display="none"},t.prototype.setHeaderMessage=function(e,n){n||(n=su.STATUS_DEFAULT);var r=this.getHeaderMessageDiv();switch(r.innerText=e,r.style.display="block",n){case su.STATUS_SUCCESS:r.style.background="rgba(106, 175, 80, 0.26)",r.style.color="#477735";break;case su.STATUS_WARNING:r.style.background="rgba(203, 36, 49, 0.14)",r.style.color="#cb2431";break;case su.STATUS_DEFAULT:default:r.style.background="rgba(0, 0, 0, 0)",r.style.color="rgb(17, 17, 17)";break}},t.prototype.showHideScanTypeSwapLink=function(e){this.scanTypeSelector.hasMoreThanOneScanType()&&(e!==!0&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none")},t.prototype.insertCameraScanImageToScanRegion=function(){var e=this,n=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){n.innerHTML="<br>",n.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(r){n.innerHTML="<br>",n.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=qwe,this.cameraScanImage.alt=Xs.cameraScanAltText()},t.prototype.insertFileScanImageToScanRegion=function(){var e=this,n=document.getElementById(this.getScanRegionId());if(this.fileScanImage){n.innerHTML="<br>",n.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(r){n.innerHTML="<br>",n.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=Gwe,this.fileScanImage.alt=Xs.fileScanAltText()},t.prototype.clearScanRegion=function(){var e=document.getElementById(this.getScanRegionId());e.innerHTML=""},t.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},t.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},t.prototype.getDashboardSectionSwapLinkId=function(){return lu.SCAN_TYPE_CHANGE_ANCHOR_ID},t.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},t.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},t.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},t.prototype.getCameraPermissionButtonId=function(){return lu.CAMERA_PERMISSION_BUTTON_ID},t.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},t.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},t.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},t}();const l2e=({onScan:t,onImageUpload:e})=>{const[n,r]=se.useState(!1),[i,l]=se.useState(null),u=se.useRef(null),{toast:s}=wc(),v=()=>{const F=new a2e("qr-reader",{fps:10,qrbox:250},!1);F.render(W=>{t(W),w()},W=>{console.warn(`QR code scanning failed: ${W}`)}),l(F),r(!0)},w=()=>{i&&(i.clear(),l(null)),r(!1)},A=async F=>{const W=F.target.files[0];if(W){if(!W.type.startsWith("image/")){s({title:"Error",description:"Please upload an image file",variant:"destructive"});return}if(W.size>5*1024*1024){s({title:"Error",description:"Image size should be less than 5MB",variant:"destructive"});return}try{const K=new FileReader;K.onload=Q=>{e(Q.target.result)},K.readAsDataURL(W)}catch{s({title:"Error",description:"Failed to process image",variant:"destructive"})}}};return R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"flex items-center gap-4",children:[R.jsx("button",{onClick:n?w:v,className:`px-4 py-2 rounded-lg ${n?"bg-red-100 text-red-700 hover:bg-red-200":"bg-primary text-white hover:bg-primary/90"}`,children:n?"Stop Scanner":"Start Scanner"}),R.jsx("button",{onClick:()=>u.current?.click(),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Upload Image"}),R.jsx("input",{ref:u,type:"file",accept:"image/*",onChange:A,className:"hidden"})]}),n&&R.jsx("div",{id:"qr-reader",className:"w-full max-w-sm mx-auto"})]})},oJ=6048e5,c2e=864e5,ZS=43200,m7=1440,g7=Symbol.for("constructDateFrom");function Nf(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&g7 in t?t[g7](e):t instanceof Date?new t.constructor(e):new Date(e)}function cl(t,e){return Nf(e||t,t)}let u2e={};function w2(){return u2e}function Iw(t,e){const n=w2(),r=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,i=cl(t,e?.in),l=i.getDay(),u=(l<r?7:0)+l-r;return i.setDate(i.getDate()-u),i.setHours(0,0,0,0),i}function mI(t,e){return Iw(t,{...e,weekStartsOn:1})}function aJ(t,e){const n=cl(t,e?.in),r=n.getFullYear(),i=Nf(n,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);const l=mI(i),u=Nf(n,0);u.setFullYear(r,0,4),u.setHours(0,0,0,0);const s=mI(u);return n.getTime()>=l.getTime()?r+1:n.getTime()>=s.getTime()?r:r-1}function gI(t){const e=cl(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function QA(t,...e){const n=Nf.bind(null,t||e.find(r=>typeof r=="object"));return e.map(n)}function _7(t,e){const n=cl(t,e?.in);return n.setHours(0,0,0,0),n}function h2e(t,e,n){const[r,i]=QA(n?.in,t,e),l=_7(r),u=_7(i),s=+l-gI(l),v=+u-gI(u);return Math.round((s-v)/c2e)}function d2e(t,e){const n=aJ(t,e),r=Nf(t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),mI(r)}function eC(t,e){const n=+cl(t)-+cl(e);return n<0?-1:n>0?1:n}function f2e(t){return Nf(t,Date.now())}function p2e(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function m2e(t){return!(!p2e(t)&&typeof t!="number"||isNaN(+cl(t)))}function g2e(t,e,n){const[r,i]=QA(n?.in,t,e),l=r.getFullYear()-i.getFullYear(),u=r.getMonth()-i.getMonth();return l*12+u}function _2e(t){return e=>{const r=(t?Math[t]:Math.trunc)(e);return r===0?0:r}}function y2e(t,e){return+cl(t)-+cl(e)}function x2e(t,e){const n=cl(t,e?.in);return n.setHours(23,59,59,999),n}function v2e(t,e){const n=cl(t,e?.in),r=n.getMonth();return n.setFullYear(n.getFullYear(),r+1,0),n.setHours(23,59,59,999),n}function b2e(t,e){const n=cl(t,e?.in);return+x2e(n,e)==+v2e(n,e)}function w2e(t,e,n){const[r,i,l]=QA(n?.in,t,t,e),u=eC(i,l),s=Math.abs(g2e(i,l));if(s<1)return 0;i.getMonth()===1&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-u*s);let v=eC(i,l)===-u;b2e(r)&&s===1&&eC(r,l)===1&&(v=!1);const w=u*(s-+v);return w===0?0:w}function E2e(t,e,n){const r=y2e(t,e)/1e3;return _2e(n?.roundingMethod)(r)}function S2e(t,e){const n=cl(t,e?.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const T2e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},C2e=(t,e,n)=>{let r;const i=T2e[t];return typeof i=="string"?r=i:e===1?r=i.one:r=i.other.replace("{{count}}",e.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function qD(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const I2e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},A2e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},R2e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},M2e={date:qD({formats:I2e,defaultWidth:"full"}),time:qD({formats:A2e,defaultWidth:"full"}),dateTime:qD({formats:R2e,defaultWidth:"full"})},P2e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},D2e=(t,e,n,r)=>P2e[t];function kv(t){return(e,n)=>{const r=n?.context?String(n.context):"standalone";let i;if(r==="formatting"&&t.formattingValues){const u=t.defaultFormattingWidth||t.defaultWidth,s=n?.width?String(n.width):u;i=t.formattingValues[s]||t.formattingValues[u]}else{const u=t.defaultWidth,s=n?.width?String(n.width):t.defaultWidth;i=t.values[s]||t.values[u]}const l=t.argumentCallback?t.argumentCallback(e):e;return i[l]}}const k2e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},N2e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},O2e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},L2e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},F2e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},B2e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},z2e=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},j2e={ordinalNumber:z2e,era:kv({values:k2e,defaultWidth:"wide"}),quarter:kv({values:N2e,defaultWidth:"wide",argumentCallback:t=>t-1}),month:kv({values:O2e,defaultWidth:"wide"}),day:kv({values:L2e,defaultWidth:"wide"}),dayPeriod:kv({values:F2e,defaultWidth:"wide",formattingValues:B2e,defaultFormattingWidth:"wide"})};function Nv(t){return(e,n={})=>{const r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],l=e.match(i);if(!l)return null;const u=l[0],s=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],v=Array.isArray(s)?U2e(s,F=>F.test(u)):V2e(s,F=>F.test(u));let w;w=t.valueCallback?t.valueCallback(v):v,w=n.valueCallback?n.valueCallback(w):w;const A=e.slice(u.length);return{value:w,rest:A}}}function V2e(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function U2e(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function H2e(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const i=r[0],l=e.match(t.parsePattern);if(!l)return null;let u=t.valueCallback?t.valueCallback(l[0]):l[0];u=n.valueCallback?n.valueCallback(u):u;const s=e.slice(i.length);return{value:u,rest:s}}}const W2e=/^(\d+)(th|st|nd|rd)?/i,$2e=/\d+/i,q2e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},G2e={any:[/^b/i,/^(a|c)/i]},Y2e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},X2e={any:[/1/i,/2/i,/3/i,/4/i]},K2e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Z2e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Q2e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},J2e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},eEe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},tEe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},nEe={ordinalNumber:H2e({matchPattern:W2e,parsePattern:$2e,valueCallback:t=>parseInt(t,10)}),era:Nv({matchPatterns:q2e,defaultMatchWidth:"wide",parsePatterns:G2e,defaultParseWidth:"any"}),quarter:Nv({matchPatterns:Y2e,defaultMatchWidth:"wide",parsePatterns:X2e,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Nv({matchPatterns:K2e,defaultMatchWidth:"wide",parsePatterns:Z2e,defaultParseWidth:"any"}),day:Nv({matchPatterns:Q2e,defaultMatchWidth:"wide",parsePatterns:J2e,defaultParseWidth:"any"}),dayPeriod:Nv({matchPatterns:eEe,defaultMatchWidth:"any",parsePatterns:tEe,defaultParseWidth:"any"})},lJ={code:"en-US",formatDistance:C2e,formatLong:M2e,formatRelative:D2e,localize:j2e,match:nEe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function rEe(t,e){const n=cl(t,e?.in);return h2e(n,S2e(n))+1}function iEe(t,e){const n=cl(t,e?.in),r=+mI(n)-+d2e(n);return Math.round(r/oJ)+1}function cJ(t,e){const n=cl(t,e?.in),r=n.getFullYear(),i=w2(),l=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,u=Nf(e?.in||t,0);u.setFullYear(r+1,0,l),u.setHours(0,0,0,0);const s=Iw(u,e),v=Nf(e?.in||t,0);v.setFullYear(r,0,l),v.setHours(0,0,0,0);const w=Iw(v,e);return+n>=+s?r+1:+n>=+w?r:r-1}function sEe(t,e){const n=w2(),r=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,i=cJ(t,e),l=Nf(e?.in||t,0);return l.setFullYear(i,0,r),l.setHours(0,0,0,0),Iw(l,e)}function oEe(t,e){const n=cl(t,e?.in),r=+Iw(n,e)-+sEe(n,e);return Math.round(r/oJ)+1}function Ys(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const Mp={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return Ys(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):Ys(n+1,2)},d(t,e){return Ys(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return Ys(t.getHours()%12||12,e.length)},H(t,e){return Ys(t.getHours(),e.length)},m(t,e){return Ys(t.getMinutes(),e.length)},s(t,e){return Ys(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),i=Math.trunc(r*Math.pow(10,n-3));return Ys(i,e.length)}},L0={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},y7={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return Mp.y(t,e)},Y:function(t,e,n,r){const i=cJ(t,r),l=i>0?i:1-i;if(e==="YY"){const u=l%100;return Ys(u,2)}return e==="Yo"?n.ordinalNumber(l,{unit:"year"}):Ys(l,e.length)},R:function(t,e){const n=aJ(t);return Ys(n,e.length)},u:function(t,e){const n=t.getFullYear();return Ys(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Ys(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Ys(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return Mp.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return Ys(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const i=oEe(t,r);return e==="wo"?n.ordinalNumber(i,{unit:"week"}):Ys(i,e.length)},I:function(t,e,n){const r=iEe(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):Ys(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):Mp.d(t,e)},D:function(t,e,n){const r=rEe(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Ys(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const i=t.getDay(),l=(i-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(l);case"ee":return Ys(l,2);case"eo":return n.ordinalNumber(l,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const i=t.getDay(),l=(i-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(l);case"cc":return Ys(l,e.length);case"co":return n.ordinalNumber(l,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),i=r===0?7:r;switch(e){case"i":return String(i);case"ii":return Ys(i,e.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const i=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let i;switch(r===12?i=L0.noon:r===0?i=L0.midnight:i=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let i;switch(r>=17?i=L0.evening:r>=12?i=L0.afternoon:r>=4?i=L0.morning:i=L0.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return Mp.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):Mp.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Ys(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):Ys(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):Mp.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):Mp.s(t,e)},S:function(t,e){return Mp.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return v7(r);case"XXXX":case"XX":return Dg(r);case"XXXXX":case"XXX":default:return Dg(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return v7(r);case"xxxx":case"xx":return Dg(r);case"xxxxx":case"xxx":default:return Dg(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+x7(r,":");case"OOOO":default:return"GMT"+Dg(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+x7(r,":");case"zzzz":default:return"GMT"+Dg(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return Ys(r,e.length)},T:function(t,e,n){return Ys(+t,e.length)}};function x7(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=Math.trunc(r/60),l=r%60;return l===0?n+String(i):n+String(i)+e+Ys(l,2)}function v7(t,e){return t%60===0?(t>0?"-":"+")+Ys(Math.abs(t)/60,2):Dg(t,e)}function Dg(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=Ys(Math.trunc(r/60),2),l=Ys(r%60,2);return n+i+e+l}const b7=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},uJ=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},aEe=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return b7(t,e);let l;switch(r){case"P":l=e.dateTime({width:"short"});break;case"PP":l=e.dateTime({width:"medium"});break;case"PPP":l=e.dateTime({width:"long"});break;case"PPPP":default:l=e.dateTime({width:"full"});break}return l.replace("{{date}}",b7(r,e)).replace("{{time}}",uJ(i,e))},lEe={p:uJ,P:aEe},cEe=/^D+$/,uEe=/^Y+$/,hEe=["D","DD","YY","YYYY"];function dEe(t){return cEe.test(t)}function fEe(t){return uEe.test(t)}function pEe(t,e,n){const r=mEe(t,e,n);if(console.warn(r),hEe.includes(t))throw new RangeError(r)}function mEe(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const gEe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_Ee=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,yEe=/^'([^]*?)'?$/,xEe=/''/g,vEe=/[a-zA-Z]/;function bEe(t,e,n){const r=w2(),i=r.locale??lJ,l=r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,u=r.weekStartsOn??r.locale?.options?.weekStartsOn??0,s=cl(t,n?.in);if(!m2e(s))throw new RangeError("Invalid time value");let v=e.match(_Ee).map(A=>{const F=A[0];if(F==="p"||F==="P"){const W=lEe[F];return W(A,i.formatLong)}return A}).join("").match(gEe).map(A=>{if(A==="''")return{isToken:!1,value:"'"};const F=A[0];if(F==="'")return{isToken:!1,value:wEe(A)};if(y7[F])return{isToken:!0,value:A};if(F.match(vEe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:A}});i.localize.preprocessor&&(v=i.localize.preprocessor(s,v));const w={firstWeekContainsDate:l,weekStartsOn:u,locale:i};return v.map(A=>{if(!A.isToken)return A.value;const F=A.value;(fEe(F)||dEe(F))&&pEe(F,e,String(t));const W=y7[F[0]];return W(s,F,i.localize,w)}).join("")}function wEe(t){const e=t.match(yEe);return e?e[1].replace(xEe,"'"):t}function EEe(t,e,n){const r=w2(),i=n?.locale??r.locale??lJ,l=2520,u=eC(t,e);if(isNaN(u))throw new RangeError("Invalid time value");const s=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:u}),[v,w]=QA(n?.in,...u>0?[e,t]:[t,e]),A=E2e(w,v),F=(gI(w)-gI(v))/1e3,W=Math.round((A-F)/60);let K;if(W<2)return n?.includeSeconds?A<5?i.formatDistance("lessThanXSeconds",5,s):A<10?i.formatDistance("lessThanXSeconds",10,s):A<20?i.formatDistance("lessThanXSeconds",20,s):A<40?i.formatDistance("halfAMinute",0,s):A<60?i.formatDistance("lessThanXMinutes",1,s):i.formatDistance("xMinutes",1,s):W===0?i.formatDistance("lessThanXMinutes",1,s):i.formatDistance("xMinutes",W,s);if(W<45)return i.formatDistance("xMinutes",W,s);if(W<90)return i.formatDistance("aboutXHours",1,s);if(W<m7){const Q=Math.round(W/60);return i.formatDistance("aboutXHours",Q,s)}else{if(W<l)return i.formatDistance("xDays",1,s);if(W<ZS){const Q=Math.round(W/m7);return i.formatDistance("xDays",Q,s)}else if(W<ZS*2)return K=Math.round(W/ZS),i.formatDistance("aboutXMonths",K,s)}if(K=w2e(w,v),K<12){const Q=Math.round(W/ZS);return i.formatDistance("xMonths",Q,s)}else{const Q=K%12,Z=Math.trunc(K/12);return Q<3?i.formatDistance("aboutXYears",Z,s):Q<9?i.formatDistance("overXYears",Z,s):i.formatDistance("almostXYears",Z+1,s)}}function hJ(t,e){return EEe(t,f2e(t),e)}const SEe=({history:t=[]})=>{const e=i=>{switch(i){case"create":return"";case"update":return"";case"delete":return"";case"adjust":return"";default:return""}},n=i=>{switch(i){case"create":return"text-green-600";case"update":return"text-blue-600";case"delete":return"text-red-600";case"adjust":return"text-purple-600";default:return"text-gray-600"}},r=i=>i?typeof i=="string"?i:Object.entries(i).map(([l,u])=>`${l.replace(/([A-Z])/g," $1").toLowerCase()}: ${u}`).join(", "):"No details available";return R.jsxs("div",{className:"space-y-4",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Item History"}),t.length===0?R.jsx("p",{className:"text-sm text-gray-500",children:"No history available"}):R.jsx("div",{className:"space-y-4",children:t.map((i,l)=>R.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-white rounded-lg border border-gray-200",children:[R.jsx("div",{className:`text-xl ${n(i.action)}`,children:e(i.action)}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("p",{className:"text-sm font-medium text-gray-900",children:i.action.charAt(0).toUpperCase()+i.action.slice(1)}),R.jsx("p",{className:"text-sm text-gray-500",children:hJ(new Date(i.timestamp),{addSuffix:!0})})]}),R.jsx("p",{className:"mt-1 text-sm text-gray-600",children:r(i.change)}),i.user&&R.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["By ",i.user.name||i.user.email]})]})]},l))})]})},TEe=()=>{const{user:t}=A_(),{inventory:e,loading:n,error:r,lastUpdate:i,addInventoryItem:l,updateInventoryItem:u,removeInventoryItem:s,getItemsBelowThreshold:v,canManageInventory:w}=y2();t&&["admin","worker"].includes(t.role);const{toast:A}=wc(),[F,W]=se.useState([]),[K,Q]=se.useState(""),[Z,oe]=se.useState("all"),[ae,me]=se.useState("name"),[pe,_e]=se.useState("asc"),[De,Ae]=se.useState(!1),[re,fe]=se.useState(null),[ye,ue]=se.useState({name:"",category:"",quantity:0,unit:"",locationId:"",expiryDate:"",threshold:0}),[Ie,Oe]=se.useState(!1),[ze,ft]=se.useState(!1),[He,bt]=se.useState([]),[Nt,wt]=se.useState([]),[it,nn]=se.useState({}),[In,wn]=se.useState([]),[Xt,On]=se.useState(!1),[cr,En]=se.useState(null),[fn,ur]=se.useState(!1),[br,Pe]=se.useState(null),[jn,rr]=se.useState(!1);se.useEffect(()=>{if(e.length>0){const mn=[...new Set(e.map(Tr=>Tr.category))],hr=[...new Set(e.map(Tr=>Tr.location))];bt(mn),wt(hr)}},[e]),se.useEffect(()=>{let mn=[...e];if(Z!=="all"&&(mn=mn.filter(hr=>hr.category===Z)),K){const hr=K.toLowerCase();mn=mn.filter(Tr=>Tr.name.toLowerCase().includes(hr)||Tr.category.toLowerCase().includes(hr)||Tr.location.toLowerCase().includes(hr))}De&&(mn=mn.filter(hr=>hr.quantity<=hr.threshold)),mn.sort((hr,Tr)=>{let Li=hr[ae],pi=Tr[ae];return(ae==="lastUpdated"||ae==="expiryDate")&&(Li=Li?new Date(Li).getTime():0,pi=pi?new Date(pi).getTime():0),pe==="asc"?Li>pi?1:-1:Li<pi?1:-1}),W(mn)},[e,Z,K,De,ae,pe]);const Yn=mn=>{ae===mn?_e(pe==="asc"?"desc":"asc"):(me(mn),_e("asc"))},Ot=mn=>{const{name:hr,value:Tr}=mn.target;ue({...ye,[hr]:hr==="quantity"||hr==="threshold"?parseInt(Tr):Tr})},Sr=mn=>{const{name:hr,value:Tr}=mn.target;fe({...re,[hr]:hr==="quantity"||hr==="threshold"?parseInt(Tr):Tr})},fi=mn=>{const hr={};return mn.name.trim()||(hr.name="Name is required"),mn.category.trim()||(hr.category="Category is required"),mn.unit.trim()||(hr.unit="Unit is required"),mn.locationId.trim()||(hr.locationId="Location is required"),mn.quantity<0&&(hr.quantity="Quantity cannot be negative"),mn.threshold<0&&(hr.threshold="Threshold cannot be negative"),nn(hr),Object.keys(hr).length===0},Wr=async()=>{if(!fi(ye))return;const mn=await l(ye);mn.success?(A({title:"Success",description:"Item added successfully"}),Oe(!1),ue({name:"",category:"",quantity:0,unit:"",locationId:"",expiryDate:"",threshold:0})):A({title:"Error",description:mn.error||"Failed to add item",variant:"destructive"})},Mn=async()=>{if(!fi(re))return;const mn=await u(re.id,re);mn.success?(A({title:"Success",description:"Item updated successfully"}),ft(!1),fe(null)):A({title:"Error",description:mn.error||"Failed to update item",variant:"destructive"})},jt=async mn=>{try{await s(mn),A({title:"Success",description:"Item deleted successfully"})}catch(hr){A({title:"Error",description:hr.message||"Failed to delete item",variant:"destructive"})}},Ln=mn=>{try{const hr=JSON.parse(mn);ue(Tr=>({...Tr,...hr})),Oe(!0)}catch{A({title:"Error",description:"Invalid QR code format",variant:"destructive"})}},un=mn=>{ue(hr=>({...hr,imageUrl:mn}))},Xn=mn=>{wn(hr=>hr.includes(mn)?hr.filter(Tr=>Tr!==mn):[...hr,mn])},Ni=async mn=>{if(In.length===0){A({title:"Error",description:"Please select items first",variant:"destructive"});return}En(mn),On(!0)},Bn=async()=>{try{switch(cr){case"delete":await Promise.all(In.map(Tr=>s(Tr))),A({title:"Success",description:"Selected items deleted successfully"});break;case"export":const mn=e.filter(Tr=>In.includes(Tr.id)),hr=Es(mn);Si(hr,"inventory-export.csv"),A({title:"Success",description:"Items exported successfully"});break;default:break}}catch{A({title:"Error",description:"Failed to perform batch operation",variant:"destructive"})}finally{wn([]),On(!1),En(null)}},Es=mn=>{const hr=["ID","Name","Category","Quantity","Unit","Location","Expiry Date","Threshold"],Tr=mn.map(Li=>[Li.id,Li.name,Li.category,Li.quantity,Li.unit,Li.location,Li.expiryDate||"N/A",Li.threshold]);return[hr,...Tr].map(Li=>Li.join(",")).join(`
`)},Si=(mn,hr)=>{const Tr=new Blob([mn],{type:"text/csv"}),Li=window.URL.createObjectURL(Tr),pi=document.createElement("a");pi.href=Li,pi.download=hr,pi.click(),window.URL.revokeObjectURL(Li)},cs=mn=>{Pe(mn),rr(!0)};function Oi(mn){return mn?mn instanceof Date?mn:typeof mn=="object"&&mn.seconds?new Date(mn.seconds*1e3):new Date(mn):null}return n?R.jsx("div",{children:"Loading..."}):r?R.jsxs("div",{children:["Error: ",r]}):R.jsxs("div",{className:"container mx-auto px-4 py-8",children:[R.jsxs("div",{className:"mb-8",children:[R.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[R.jsxs("div",{className:"flex items-center gap-4",children:[R.jsx("input",{type:"text",placeholder:"Search inventory...",value:K,onChange:mn=>Q(mn.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"}),R.jsxs("select",{value:Z,onChange:mn=>oe(mn.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[R.jsx("option",{value:"all",children:"All Categories"}),He.map(mn=>R.jsx("option",{value:mn,children:mn},mn))]}),R.jsx("button",{onClick:()=>Ae(!De),className:`px-4 py-2 rounded-lg ${De?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:"Low Stock Items"})]}),R.jsxs("div",{className:"flex items-center gap-4",children:[R.jsx("button",{onClick:()=>ur(!fn),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:fn?"Hide Scanner":"Show Scanner"}),R.jsx("button",{onClick:()=>Oe(!0),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Add New Item"})]})]}),fn&&R.jsx("div",{className:"mt-4",children:R.jsx(l2e,{onScan:Ln,onImageUpload:un})}),Xt&&R.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("div",{children:R.jsxs("span",{className:"text-sm text-gray-600",children:[In.length," items selected"]})}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:()=>Ni("export"),className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200",children:"Export Selected"}),R.jsx("button",{onClick:()=>Ni("delete"),className:"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:"Delete Selected"}),R.jsx("button",{onClick:()=>{wn([]),On(!1),En(null)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]})})]}),R.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:R.jsx("div",{className:"overflow-x-auto",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[R.jsx("thead",{className:"bg-gray-50",children:R.jsxs("tr",{children:[Xt&&R.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:R.jsx("input",{type:"checkbox",checked:In.length===F.length,onChange:mn=>{mn.target.checked?wn(F.map(hr=>hr.id)):wn([])},className:"rounded border-gray-300 text-primary focus:ring-primary"})}),R.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>Yn("name"),children:["Name ",ae==="name"&&(pe==="asc"?"":"")]}),R.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>Yn("category"),children:["Category ",ae==="category"&&(pe==="asc"?"":"")]}),R.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>Yn("quantity"),children:["Quantity ",ae==="quantity"&&(pe==="asc"?"":"")]}),R.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>Yn("locationId"),children:["Location ",ae==="locationId"&&(pe==="asc"?"":"")]}),R.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>Yn("expiryDate"),children:["Expiry Date ",ae==="expiryDate"&&(pe==="asc"?"":"")]}),R.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),R.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:F.map(mn=>R.jsxs("tr",{className:"hover:bg-gray-50",children:[Xt&&R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R.jsx("input",{type:"checkbox",checked:In.includes(mn.id),onChange:()=>Xn(mn.id),className:"rounded border-gray-300 text-primary focus:ring-primary"})}),R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R.jsxs("div",{className:"flex items-center",children:[mn.imageUrl&&R.jsx("img",{src:mn.imageUrl,alt:mn.name,className:"h-10 w-10 rounded-full mr-3"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium text-gray-900",children:mn.name}),R.jsx("div",{className:"text-sm text-gray-500",children:mn.unit})]})]})}),R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:mn.category})}),R.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[R.jsx("div",{className:"text-sm text-gray-900",children:mn.quantity}),mn.quantity<=mn.threshold&&R.jsx("div",{className:"text-xs text-red-600",children:"Below threshold"})]}),R.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:mn.location}),R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:mn.expiryDate?R.jsx("div",{className:`text-sm ${Oi(mn.expiryDate)<=new Date(Date.now()+30*24*60*60*1e3)?"text-red-600":"text-gray-900"}`,children:Oi(mn.expiryDate)?.toLocaleDateString()||"N/A"}):R.jsx("div",{className:"text-sm text-gray-500",children:"N/A"})}),R.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[R.jsx("button",{onClick:()=>cs(mn),className:"text-gray-600 hover:text-gray-800 mr-3",children:"History"}),R.jsx("button",{onClick:()=>{fe(mn),ft(!0)},className:"text-primary hover:text-primary/80 mr-3",children:"Edit"}),R.jsx("button",{onClick:()=>jt(mn.id),className:"text-red-600 hover:text-red-800",children:"Delete"})]})]},mn.id))})]})})}),R.jsx(KS,{open:Xt&&cr!==null,onOpenChange:()=>On(!1),children:R.jsxs(lb,{className:"sm:max-w-[425px]",children:[R.jsxs(cb,{children:["Confirm ",cr==="delete"?"Delete":"Export"," Operation"]}),R.jsx("div",{className:"py-4",children:R.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to ",cr," ",In.length," selected items?"]})}),R.jsxs("div",{className:"flex justify-end gap-3",children:[R.jsx("button",{onClick:()=>{On(!1),En(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md",children:"Cancel"}),R.jsx("button",{onClick:Bn,className:`px-4 py-2 text-sm font-medium text-white rounded-md ${cr==="delete"?"bg-red-600 hover:bg-red-700":"bg-primary hover:bg-primary/90"}`,children:"Confirm"})]})]})}),R.jsx(KS,{open:Ie,onOpenChange:Oe,children:R.jsxs(lb,{className:"sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[R.jsx(cb,{children:"Add New Item"}),R.jsxs("div",{className:"grid gap-2 py-2",children:[R.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[R.jsxs("div",{children:[R.jsx("label",{htmlFor:"name",className:"text-sm font-medium",children:"Name"}),R.jsx("input",{id:"name",name:"name",value:ye.name,onChange:Ot,className:"w-full px-2 py-1 border rounded-md text-sm"}),it.name&&R.jsx("p",{className:"text-xs text-red-600",children:it.name})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Category"}),R.jsx("input",{id:"category",name:"category",value:ye.category,onChange:Ot,className:"w-full px-2 py-1 border rounded-md text-sm"}),it.category&&R.jsx("p",{className:"text-xs text-red-600",children:it.category})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[R.jsxs("div",{children:[R.jsx("label",{htmlFor:"quantity",className:"text-sm font-medium",children:"Quantity"}),R.jsx("input",{id:"quantity",name:"quantity",type:"number",value:ye.quantity,onChange:Ot,className:"w-full px-2 py-1 border rounded-md text-sm"}),it.quantity&&R.jsx("p",{className:"text-xs text-red-600",children:it.quantity})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"unit",className:"text-sm font-medium",children:"Unit"}),R.jsx("input",{id:"unit",name:"unit",value:ye.unit,onChange:Ot,className:"w-full px-2 py-1 border rounded-md text-sm"}),it.unit&&R.jsx("p",{className:"text-xs text-red-600",children:it.unit})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[R.jsxs("div",{children:[R.jsx("label",{htmlFor:"locationId",className:"text-sm font-medium",children:"Location"}),R.jsx("input",{id:"locationId",name:"locationId",value:ye.locationId,onChange:Ot,className:"w-full px-2 py-1 border rounded-md text-sm"}),it.locationId&&R.jsx("p",{className:"text-xs text-red-600",children:it.locationId})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"expiryDate",className:"text-sm font-medium",children:"Expiry Date"}),R.jsx("input",{id:"expiryDate",name:"expiryDate",type:"date",value:ye.expiryDate,onChange:Ot,className:"w-full px-2 py-1 border rounded-md text-sm"})]})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"threshold",className:"text-sm font-medium",children:"Low Stock Threshold"}),R.jsx("input",{id:"threshold",name:"threshold",type:"number",value:ye.threshold,onChange:Ot,className:"w-full px-2 py-1 border rounded-md text-sm"}),it.threshold&&R.jsx("p",{className:"text-xs text-red-600",children:it.threshold})]})]}),R.jsxs("div",{className:"flex justify-end gap-2 mt-4 border-t pt-4",children:[R.jsx("button",{onClick:()=>Oe(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md border border-gray-300",children:"Cancel"}),R.jsx("button",{type:"button",onClick:Wr,style:{backgroundColor:"#2563eb",color:"white",border:"2px solid #1d4ed8"},className:"px-4 py-2 text-sm font-bold rounded-md shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Add Item"})]})]})}),R.jsx(KS,{open:ze,onOpenChange:ft,children:R.jsxs(lb,{className:"sm:max-w-[450px]",children:[R.jsx(cb,{className:"text-lg",children:"Edit Item"}),re&&R.jsxs("div",{className:"grid gap-2 py-2",children:[R.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[R.jsxs("div",{className:"grid gap-1",children:[R.jsx("label",{htmlFor:"edit-name",className:"text-xs font-medium",children:"Name"}),R.jsx("input",{id:"edit-name",name:"name",value:re.name,onChange:Sr,className:"px-2 py-1 border rounded-md text-sm"}),it.name&&R.jsx("p",{className:"text-xs text-red-600",children:it.name})]}),R.jsxs("div",{className:"grid gap-1",children:[R.jsx("label",{htmlFor:"edit-category",className:"text-xs font-medium",children:"Category"}),R.jsx("input",{id:"edit-category",name:"category",value:re.category,onChange:Sr,className:"px-2 py-1 border rounded-md text-sm"}),it.category&&R.jsx("p",{className:"text-xs text-red-600",children:it.category})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[R.jsxs("div",{className:"grid gap-1",children:[R.jsx("label",{htmlFor:"edit-quantity",className:"text-xs font-medium",children:"Quantity"}),R.jsx("input",{id:"edit-quantity",name:"quantity",type:"number",value:re.quantity,onChange:Sr,className:"px-2 py-1 border rounded-md text-sm"}),it.quantity&&R.jsx("p",{className:"text-xs text-red-600",children:it.quantity})]}),R.jsxs("div",{className:"grid gap-1",children:[R.jsx("label",{htmlFor:"edit-unit",className:"text-xs font-medium",children:"Unit"}),R.jsx("input",{id:"edit-unit",name:"unit",value:re.unit,onChange:Sr,className:"px-2 py-1 border rounded-md text-sm"}),it.unit&&R.jsx("p",{className:"text-xs text-red-600",children:it.unit})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[R.jsxs("div",{className:"grid gap-1",children:[R.jsx("label",{htmlFor:"edit-locationId",className:"text-xs font-medium",children:"Location"}),R.jsx("input",{id:"edit-locationId",name:"locationId",value:re.locationId,onChange:Sr,className:"px-2 py-1 border rounded-md text-sm"}),it.locationId&&R.jsx("p",{className:"text-xs text-red-600",children:it.locationId})]}),R.jsxs("div",{className:"grid gap-1",children:[R.jsx("label",{htmlFor:"edit-expiryDate",className:"text-xs font-medium",children:"Expiry Date"}),R.jsx("input",{id:"edit-expiryDate",name:"expiryDate",type:"date",value:re.expiryDate,onChange:Sr,className:"px-2 py-1 border rounded-md text-sm"})]})]}),R.jsxs("div",{className:"grid gap-1",children:[R.jsx("label",{htmlFor:"edit-threshold",className:"text-xs font-medium",children:"Low Stock Threshold"}),R.jsx("input",{id:"edit-threshold",name:"threshold",type:"number",value:re.threshold,onChange:Sr,className:"px-2 py-1 border rounded-md text-sm"}),it.threshold&&R.jsx("p",{className:"text-xs text-red-600",children:it.threshold})]})]}),R.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[R.jsx("button",{onClick:()=>ft(!1),className:"px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Cancel"}),R.jsx("button",{onClick:Mn,className:"px-3 py-1 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md",children:"Save Changes"})]})]})}),R.jsx(KS,{open:jn,onOpenChange:rr,children:R.jsxs(lb,{className:"sm:max-w-[600px]",children:[R.jsxs(cb,{children:["Item History - ",br?.name]}),R.jsx("div",{className:"py-4",children:R.jsx(SEe,{history:br?.history||[]})}),R.jsx("div",{className:"flex justify-end",children:R.jsx("button",{onClick:()=>rr(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md",children:"Close"})})]})})]})},CEe=()=>{const{loading:t,error:e}=y2();return R.jsxs("div",{className:"space-y-6",children:[R.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:R.jsxs("div",{children:[R.jsx("h1",{className:"text-2xl text-white font-bold",children:"Inventory Management"}),R.jsx("p",{className:"text-sm text-gray-500",children:"Manage inventory items, track stock levels, and monitor expiring items"})]})}),t?R.jsx("div",{className:"flex justify-center items-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e?R.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:R.jsx("p",{className:"text-red-700",children:e})}):R.jsx(TEe,{})]})},dJ=se.forwardRef(({className:t,...e},n)=>R.jsx("textarea",{className:Fs("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...e}));dJ.displayName="Textarea";async function IEe(t){return(await tX(Td(ol,"donations"),{...t,date:Fa.fromDate(t.date)})).id}async function w7(t){const e=Ky(Td(ol,"donations"),GC("userId","==",t),KY("date","desc"));return(await xf(e)).docs.map(r=>{const i=r.data();return{id:r.id,...i,date:i.date?.toDate?i.date.toDate():new Date}})}async function GD(){const t=Ky(Td(ol,"donations"),KY("date","desc"));return(await xf(t)).docs.map(n=>{const r=n.data();return{id:n.id,...r,date:r.date?.toDate?r.date.toDate():new Date}})}async function E7(t,e){const n=yf(ol,"donations",t);await YC(n,{status:e})}const AEe=()=>{const{user:t}=Yo(),{canManageDonations:e}=x2(),{toast:n}=wc(),[r,i]=se.useState(!1),[l,u]=se.useState([]),[s,v]=se.useState(!0),[w,A]=se.useState("in-kind"),[F,W]=se.useState({items:[{name:"",quantity:"",unit:""}],amount:"",currency:"USD",notes:""}),[K,Q]=se.useState([]),[Z,oe]=se.useState(!0);se.useEffect(()=>{t?.uid&&(v(!0),w7(t.uid).then(u).finally(()=>v(!1)),e&&(oe(!0),GD().then(Q).finally(()=>oe(!1))))},[t?.uid,e]);const ae=()=>{W(re=>({...re,items:[...re.items,{name:"",quantity:"",unit:""}]}))},me=(re,fe,ye)=>{const ue=[...F.items];ue[re]={...ue[re],[fe]:ye},W(Ie=>({...Ie,items:ue}))},pe=async re=>{if(re.preventDefault(),!t?.uid)return;let fe;w==="in-kind"?fe={userId:t.uid,type:"in-kind",date:new Date,status:"pending",items:F.items.map(ye=>({name:ye.name,quantity:Number(ye.quantity),unit:ye.unit})),notes:F.notes}:fe={userId:t.uid,type:"financial",date:new Date,status:"pending",amount:Number(F.amount),currency:F.currency,notes:F.notes};try{await IEe(fe),n({title:"Donation Submitted",description:"Your donation has been submitted for review."}),i(!1),W({items:[{name:"",quantity:"",unit:""}],amount:"",currency:"USD",notes:""}),A("in-kind"),t?.uid&&(v(!0),w7(t.uid).then(u).finally(()=>v(!1)))}catch{n({title:"Error",description:"Failed to submit donation. Please try again.",variant:"destructive"})}},_e=async re=>{await E7(re,"approved"),n({title:"Donation Approved"}),oe(!0),GD().then(Q).finally(()=>oe(!1))},De=async re=>{await E7(re,"rejected"),n({title:"Donation Rejected",variant:"destructive"}),oe(!0),GD().then(Q).finally(()=>oe(!1))},Ae=re=>{switch(re){case"pending":return R.jsx(cye,{className:"h-4 w-4 text-yellow-500"});case"approved":return R.jsx(sye,{className:"h-4 w-4 text-green-500"});case"received":return R.jsx(Jy,{className:"h-4 w-4 text-blue-500"});case"rejected":return R.jsx(aye,{className:"h-4 w-4 text-red-500"});default:return null}};return R.jsxs("div",{className:"p-6 space-y-6",children:[R.jsxs("div",{className:"flex justify-between items-center",children:[R.jsx("h1",{className:"text-2xl font-bold text-white",children:"Donations"}),t?.role==="donor"&&R.jsxs(Bi,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[R.jsx(oN,{className:"w-4 h-4 mr-2"}),"New Donation"]})]}),r&&R.jsxs(El,{className:"bg-gray-800",children:[R.jsx(Sl,{children:R.jsx(Tl,{className:"text-white",children:"New Donation"})}),R.jsx(Ql,{children:R.jsxs("form",{onSubmit:pe,className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx(gc,{className:"text-gray-200",children:"Donation Type"}),R.jsxs(QT,{value:w,onValueChange:re=>A(re),children:[R.jsx(kb,{className:"bg-gray-900 text-white border-gray-700",children:R.jsx(JT,{placeholder:"Select type"})}),R.jsxs(Nb,{className:"bg-gray-900 text-white",children:[R.jsx(ql,{value:"in-kind",children:"In-Kind (Items)"}),R.jsx(ql,{value:"financial",children:"Financial"})]})]})]}),w==="in-kind"?R.jsxs(R.Fragment,{children:[F.items.map((re,fe)=>R.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[R.jsxs("div",{children:[R.jsx(gc,{className:"text-gray-200",children:"Item Name"}),R.jsx(Sh,{className:"text-white bg-gray-900 border-gray-700",value:re.name,onChange:ye=>me(fe,"name",ye.target.value),placeholder:"e.g., Rice",required:!0})]}),R.jsxs("div",{children:[R.jsx(gc,{className:"text-gray-200",children:"Quantity"}),R.jsx(Sh,{className:"text-white bg-gray-900 border-gray-700",type:"number",value:re.quantity,onChange:ye=>me(fe,"quantity",ye.target.value),placeholder:"e.g., 10",required:!0})]}),R.jsxs("div",{children:[R.jsx(gc,{className:"text-gray-200",children:"Unit"}),R.jsxs(QT,{value:re.unit,onValueChange:ye=>me(fe,"unit",ye),children:[R.jsx(kb,{className:"bg-gray-900 text-white border-gray-700",children:R.jsx(JT,{placeholder:"Select unit"})}),R.jsxs(Nb,{className:"bg-gray-900 text-white",children:[R.jsx(ql,{value:"kg",children:"Kilograms"}),R.jsx(ql,{value:"g",children:"Grams"}),R.jsx(ql,{value:"l",children:"Liters"}),R.jsx(ql,{value:"pcs",children:"Pieces"}),R.jsx(ql,{value:"box",children:"Boxes"})]})]})]})]},fe)),R.jsxs(Bi,{type:"button",variant:"outline",onClick:ae,className:"border-white text-white hover:bg-white/10",children:[R.jsx(oN,{className:"w-4 h-4 mr-2"}),"Add Another Item"]})]}):R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx(gc,{className:"text-gray-200",children:"Amount"}),R.jsx(Sh,{className:"text-white bg-gray-900 border-gray-700",type:"number",min:"1",value:F.amount,onChange:re=>W(fe=>({...fe,amount:re.target.value})),placeholder:"e.g., 100",required:!0})]}),R.jsxs("div",{children:[R.jsx(gc,{className:"text-gray-200",children:"Currency"}),R.jsxs(QT,{value:F.currency,onValueChange:re=>W(fe=>({...fe,currency:re})),children:[R.jsx(kb,{className:"bg-gray-900 text-white border-gray-700",children:R.jsx(JT,{placeholder:"Select currency"})}),R.jsxs(Nb,{className:"bg-gray-900 text-white",children:[R.jsx(ql,{value:"USD",children:"USD"}),R.jsx(ql,{value:"EUR",children:"EUR"}),R.jsx(ql,{value:"NGN",children:"NGN"}),R.jsx(ql,{value:"KES",children:"KES"}),R.jsx(ql,{value:"GHS",children:"GHS"})]})]})]})]}),R.jsxs("div",{children:[R.jsx(gc,{className:"text-gray-200",children:"Additional Notes"}),R.jsx(dJ,{className:"text-white bg-gray-900 border-gray-700",value:F.notes,onChange:re=>W(fe=>({...fe,notes:re.target.value})),placeholder:"Any additional information about your donation..."})]}),R.jsxs("div",{className:"flex justify-end space-x-2",children:[R.jsx(Bi,{type:"button",variant:"outline",onClick:()=>i(!1),className:"border-white text-white hover:bg-white/10",children:"Cancel"}),R.jsx(Bi,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Submit Donation"})]})]})})]}),t?.role==="donor"&&R.jsxs(El,{className:"bg-gray-800",children:[R.jsx(Sl,{children:R.jsx(Tl,{className:"text-white",children:"My Donations"})}),R.jsx(Ql,{children:s?R.jsx("p",{className:"text-gray-400 text-center py-4",children:"Loading..."}):l.length===0?R.jsx("p",{className:"text-gray-400 text-center py-4",children:"No donations yet. Submit your first donation above!"}):R.jsx("div",{className:"space-y-4",children:l.map(re=>R.jsxs("div",{className:"border border-gray-700 rounded-lg p-4",children:[R.jsxs("div",{className:"flex justify-between items-start",children:[R.jsxs("div",{children:[R.jsxs("h3",{className:"font-medium text-white",children:["Donation #",re.id?.slice(-6)]}),R.jsx("p",{className:"text-sm text-gray-400",children:new Date(re.date).toLocaleDateString()})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[Ae(re.status),R.jsx("span",{className:"capitalize text-gray-200",children:re.status})]})]}),re.type==="in-kind"&&re.items&&R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"font-medium mb-2 text-gray-200",children:"Items:"}),R.jsx("ul",{className:"space-y-2",children:re.items.map((fe,ye)=>R.jsxs("li",{className:"flex justify-between text-gray-200",children:[R.jsx("span",{children:fe.name}),R.jsxs("span",{children:[fe.quantity," ",fe.unit]})]},ye))})]}),re.type==="financial"&&R.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[R.jsx(wU,{className:"h-5 w-5 text-green-400"}),R.jsxs("span",{className:"text-lg text-green-300 font-bold",children:[re.amount," ",re.currency]})]}),re.notes&&R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"font-medium mb-2 text-gray-200",children:"Notes:"}),R.jsx("p",{className:"text-gray-300",children:re.notes})]})]},re.id))})})]}),e&&R.jsxs("div",{className:"grid gap-6",children:[R.jsxs(El,{className:"bg-gray-800",children:[R.jsx(Sl,{children:R.jsx(Tl,{className:"text-white",children:"Donation Management"})}),R.jsx(Ql,{children:Z?R.jsx("p",{className:"text-gray-400 text-center py-4",children:"Loading..."}):K.length===0?R.jsx("p",{className:"text-gray-400 text-center py-4",children:"No donations found."}):R.jsx("div",{className:"space-y-4",children:K.map(re=>R.jsxs("div",{className:"border border-gray-700 rounded-lg p-4",children:[R.jsxs("div",{className:"flex justify-between items-start",children:[R.jsxs("div",{children:[R.jsxs("h3",{className:"font-medium text-white",children:["Donation #",re.id?.slice(-6)]}),R.jsxs("p",{className:"text-sm text-gray-400",children:[new Date(re.date).toLocaleDateString()," by ",re.userId]})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[Ae(re.status),R.jsx("span",{className:"capitalize text-gray-200",children:re.status})]})]}),re.type==="in-kind"&&re.items&&R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"font-medium mb-2 text-gray-200",children:"Items:"}),R.jsx("ul",{className:"space-y-2",children:re.items.map((fe,ye)=>R.jsxs("li",{className:"flex justify-between text-gray-200",children:[R.jsx("span",{children:fe.name}),R.jsxs("span",{children:[fe.quantity," ",fe.unit]})]},ye))})]}),re.type==="financial"&&R.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[R.jsx(wU,{className:"h-5 w-5 text-green-400"}),R.jsxs("span",{className:"text-lg text-green-300 font-bold",children:[re.amount," ",re.currency]})]}),re.notes&&R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"font-medium mb-2 text-gray-200",children:"Notes:"}),R.jsx("p",{className:"text-gray-300",children:re.notes})]}),re.status==="pending"&&R.jsxs("div",{className:"mt-4 flex gap-2",children:[R.jsx(Bi,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>_e(re.id),children:"Approve"}),R.jsx(Bi,{className:"bg-red-600 hover:bg-red-700 text-white",onClick:()=>De(re.id),children:"Reject"})]})]},re.id))})})]}),R.jsxs(El,{className:"bg-gray-800",children:[R.jsx(Sl,{children:R.jsx(Tl,{className:"text-white",children:"Donation Analytics"})}),R.jsx(Ql,{children:R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs("div",{className:"border border-gray-700 rounded p-4",children:[R.jsx("h3",{className:"font-medium mb-2 text-white",children:"Total Donations"}),R.jsx("p",{className:"text-2xl font-bold text-white",children:"0"})]}),R.jsxs("div",{className:"border border-gray-700 rounded p-4",children:[R.jsx("h3",{className:"font-medium mb-2 text-white",children:"This Month"}),R.jsx("p",{className:"text-2xl font-bold text-white",children:"0"})]}),R.jsxs("div",{className:"border border-gray-700 rounded p-4",children:[R.jsx("h3",{className:"font-medium mb-2 text-white",children:"Pending"}),R.jsx("p",{className:"text-2xl font-bold text-white",children:"0"})]})]})})]})]})]})},REe=()=>{const{user:t}=Yo(),{canManageDistributions:e}=x2(),{aidRequests:n,loading:r}=R_(),i=t?.role==="beneficiary"?n.filter(W=>W.userId===t?.uid):[],l=i.filter(W=>["pending","in_progress","approved","ready_for_pickup","in_transit"].includes(W.status)),u=i.filter(W=>["delivered","denied","cancelled"].includes(W.status));let s={};e&&n.forEach(W=>{s[W.userId]||(s[W.userId]={name:W.userName||W.userId,aidHistory:[],futureNeeds:W.futureNeeds||""}),s[W.userId].aidHistory.push({type:W.aidType,date:W.createdAt})});const v=Object.values(s),w=Object.keys(s).length,A=n.filter(W=>["pending","in_progress","approved","ready_for_pickup","in_transit"].includes(W.status)).length,F=n.filter(W=>W.status==="delivered").length;return R.jsxs("div",{className:"p-6",children:[R.jsx("h1",{className:"text-2xl text-white font-bold mb-4",children:"Beneficiary Dashboard"}),R.jsxs("div",{className:"grid gap-6",children:[t?.role==="beneficiary"&&R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[R.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"My Aid Requests"}),R.jsxs("div",{className:"space-y-4",children:[R.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:()=>window.location.href="/request/new",children:"Request Aid"}),R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium text-white mb-2",children:"Request History"}),u.length===0?R.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"No past requests."}):R.jsx("ul",{children:u.map(W=>R.jsxs("li",{className:"text-gray-600 dark:text-gray-300",children:[W.aidType," - ",W.status]},W.id))})]}),R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium text-white mb-2",children:"Active Requests"}),l.length===0?R.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"No active requests."}):R.jsx("ul",{children:l.map(W=>R.jsxs("li",{className:"text-gray-600 dark:text-gray-300",children:[W.aidType," - ",W.status]},W.id))})]})]})]}),e&&R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[R.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"Beneficiaries"}),R.jsx("div",{className:"overflow-x-auto mb-6",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[R.jsx("thead",{children:R.jsxs("tr",{children:[R.jsx("th",{className:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),R.jsx("th",{className:"px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aid History"})]})}),R.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map((W,K)=>R.jsxs("tr",{children:[R.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:W.name}),R.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:W.aidHistory.map((Q,Z)=>R.jsxs("div",{className:"text-xs text-gray-500",children:[Q.type," (",Q.date?new Date(Q.date).toLocaleDateString():"",")"]},Z))})]},K))})]})})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[R.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"Distribution Analytics"}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium text-white mb-2",children:"Total Beneficiaries"}),R.jsx("p",{className:"text-2xl text-white font-bold",children:w})]}),R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium text-white mb-2",children:"Active Requests"}),R.jsx("p",{className:"text-2xl text-white font-bold",children:A})]}),R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium text-white mb-2",children:"Completed Distributions"}),R.jsx("p",{className:"text-2xl text-white font-bold",children:F})]})]})]})]})]})]})},YD={distributionTrends:[25,30,35,40,35,30],aidTypes:[65,40,55,30,70],serviceEfficiency:[1.2,2.3,2.8,2.5,3.5]},MEe=[{value:"usa",label:"United States"},{value:"uk",label:"United Kingdom"},{value:"canada",label:"Canada"},{value:"australia",label:"Australia"},{value:"germany",label:"Germany"},{value:"france",label:"France"},{value:"other",label:"Other"}],PEe=()=>{const{user:t,updateProfile:e,logout:n,loading:r}=Yo(),{toast:i}=wc(),[,l]=xu(),[u,s]=se.useState(!1),[v,w]=se.useState({displayName:"",email:"",phoneNumber:"",country:"",bio:""});if(fa.useEffect(()=>{t&&w({displayName:t.displayName||"",email:t.email||"",phoneNumber:t.phoneNumber||"",country:t.country||"",bio:t.bio||""})},[t]),r)return R.jsx("div",{className:"flex justify-center items-center h-[calc(100vh-200px)]",children:R.jsx(bf,{className:"h-8 w-8 animate-spin text-primary"})});if(!t&&!r)return l("/login"),null;const A=K=>{const{name:Q,value:Z}=K.target;w(oe=>({...oe,[Q]:Z}))},F=K=>{K.preventDefault();const Q=e(v);Q.success?(i({title:"Profile updated",description:"Your profile has been successfully updated"}),s(!1)):i({title:"Update failed",description:Q.message,variant:"destructive"})},W=()=>{n(),i({title:"Logged out",description:"You have been successfully logged out"}),l("/login")};return R.jsxs("div",{className:"bg-white/10 rounded-lg shadow-md p-6",children:[R.jsx("h2",{className:"text-xl font-semibold mb-6 text-white",children:"PROFILE"}),R.jsx("div",{className:"max-w-xl mx-auto",children:u?R.jsxs("form",{onSubmit:F,className:"space-y-4",children:[R.jsxs("div",{className:"text-center mb-6",children:[R.jsx("div",{className:"h-24 w-24 bg-primary/40 rounded-full flex items-center justify-center text-white text-3xl mb-4 mx-auto",children:t.photoURL?R.jsx("img",{src:t.photoURL,alt:t.displayName,className:"h-24 w-24 rounded-full object-cover"}):R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),R.jsx("h3",{className:"text-xl font-medium text-white mb-4 capitalize",children:t.role}),R.jsxs("p",{className:"text-white/60 mb-2",children:["User ID: ",t.uid]})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-white mb-1",children:"Name"}),R.jsx("input",{type:"text",id:"displayName",name:"displayName",className:"w-full px-3 py-2 bg-white/10 text-white border border-white/20 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",value:v.displayName,onChange:A,required:!0})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-white mb-1",children:"Email"}),R.jsx("input",{type:"email",id:"email",name:"email",className:"w-full px-3 py-2 bg-white/10 text-white border border-white/20 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",value:v.email,onChange:A,required:!0,disabled:!0})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"phoneNumber",className:"block text-sm font-medium text-white mb-1",children:"Phone"}),R.jsx("input",{type:"tel",id:"phoneNumber",name:"phoneNumber",className:"w-full px-3 py-2 bg-white/10 text-white border border-white/20 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",value:v.phoneNumber,onChange:A})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-white mb-1",children:"Country"}),R.jsxs("select",{id:"country",name:"country",className:"w-full px-3 py-2 bg-white/10 text-white border border-white/20 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",value:v.country,onChange:A,required:!0,children:[R.jsx("option",{value:"",disabled:!0,children:"Select country"}),MEe.map(K=>R.jsx("option",{value:K.value,className:"text-black",children:K.label},K.value))]})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"bio",className:"block text-sm font-medium text-white mb-1",children:"Bio"}),R.jsx("textarea",{id:"bio",name:"bio",rows:"4",className:"w-full px-3 py-2 bg-white/10 text-white border border-white/20 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",value:v.bio,onChange:A})]}),R.jsxs("div",{className:"flex justify-end space-x-3",children:[R.jsx("button",{type:"button",className:"py-2 px-4 border border-white/20 text-white rounded-md hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",onClick:()=>s(!1),children:"Cancel"}),R.jsx("button",{type:"submit",className:"bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Save Changes"})]})]}):R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"flex flex-col items-center mb-6",children:[R.jsx("div",{className:"h-24 w-24 bg-primary/40 rounded-full flex items-center justify-center text-white text-3xl mb-4",children:t.photoURL?R.jsx("img",{src:t.photoURL,alt:t.displayName,className:"h-24 w-24 rounded-full object-cover"}):R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),R.jsx("h3",{className:"text-xl font-medium text-white mb-1",children:t.displayName||"No name set"}),R.jsx("p",{className:"text-white/60 mb-1 capitalize",children:t.role}),R.jsx("p",{className:"text-white/60 mb-1",children:t.email}),t.phoneNumber&&R.jsx("p",{className:"text-white/60 mb-1",children:t.phoneNumber}),t.country&&R.jsx("p",{className:"text-white/60 mb-1",children:t.country}),R.jsxs("p",{className:"text-white/40 text-sm",children:["ID: ",t.uid]})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("h4",{className:"text-sm font-medium text-white/60 mb-2",children:"BIO"}),R.jsx("div",{className:"bg-white/10 rounded-lg p-4 min-h-[100px]",children:t.bio?R.jsx("span",{className:"text-white/80",children:t.bio}):R.jsx("p",{className:"text-white/40 italic",children:"No bio information provided"})})]}),R.jsxs("div",{className:"flex justify-between",children:[R.jsx("button",{onClick:W,className:"bg-white/10 hover:bg-white/20 text-white py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Logout"}),R.jsx("button",{onClick:()=>s(!0),className:"bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Modify Profile"})]})]})})]})},DEe=l4(),kEe=async(t,e)=>{const n=Age(DEe,"updateUserRole");try{return(await n({userId:t,newRole:e})).data}catch(r){throw console.error("Error updating user role:",r),r}};async function fJ(){const t=Td(ol,"users");return(await xf(t)).docs.map(n=>{const r=n.data();return{id:n.id,email:r.email||"",name:r.name||"",role:r.role||""}})}const NEe=()=>{const{user:t}=Yo(),{canViewSettings:e}=x2(),[n,r]=se.useState([]),[i,l]=se.useState(!0),[u,s]=se.useState(null);se.useEffect(()=>{e&&(async()=>{try{const A=await fJ();r(A)}catch(A){s("Failed to fetch users"),console.error(A)}finally{l(!1)}})()},[e]);const v=async(w,A)=>{try{await kEe(w,A),r(n.map(F=>F.id===w?{...F,role:A}:F))}catch(F){s("Failed to update user role"),console.error(F)}};return e?R.jsxs("div",{className:"p-6",children:[R.jsx("h1",{className:"text-2xl text-white font-bold mb-4",children:"System Settings"}),R.jsxs("div",{className:"grid gap-6",children:[R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[R.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"System Configuration"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium mb-2",children:"Email Settings"}),R.jsxs("div",{className:"space-y-2",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx("input",{type:"checkbox",className:"mr-2",id:"emailNotifications"}),R.jsx("label",{htmlFor:"emailNotifications",children:"Enable Email Notifications"})]}),R.jsx("input",{type:"email",placeholder:"System Email Address",className:"w-full p-2 border rounded"})]})]}),R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium mb-2",children:"Security Settings"}),R.jsxs("div",{className:"space-y-2",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx("input",{type:"checkbox",className:"mr-2",id:"twoFactor"}),R.jsx("label",{htmlFor:"twoFactor",children:"Require Two-Factor Authentication"})]}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("input",{type:"checkbox",className:"mr-2",id:"passwordExpiry"}),R.jsx("label",{htmlFor:"passwordExpiry",children:"Enable Password Expiry"})]})]})]})]})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[R.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"User Management"}),u&&R.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:u}),i?R.jsx("p",{children:"Loading users..."}):R.jsx("div",{className:"space-y-4",children:R.jsx("div",{className:"overflow-x-auto",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[R.jsx("thead",{className:"bg-gray-50",children:R.jsxs("tr",{children:[R.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),R.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),R.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),R.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),R.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(w=>R.jsxs("tr",{children:[R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:w.name}),R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:w.email}),R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R.jsxs("select",{value:w.role,onChange:A=>v(w.id,A.target.value),className:"border rounded px-2 py-1",children:[R.jsx("option",{value:"admin",children:"Admin"}),R.jsx("option",{value:"staff",children:"Staff"}),R.jsx("option",{value:"donor",children:"Donor"}),R.jsx("option",{value:"beneficiary",children:"Beneficiary"})]})}),R.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:R.jsx("button",{onClick:()=>v(w.id,w.role),className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"Update"})})]},w.id))})]})})})]}),R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[R.jsx("h2",{className:"text-xl text-white font-semibold mb-4",children:"System Logs"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"border rounded p-4",children:[R.jsx("h3",{className:"font-medium mb-2",children:"Recent Activity"}),R.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"System logs will appear here."})]}),R.jsx("button",{className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Download Logs"})]})]})]})]}):R.jsx("div",{className:"p-6",children:R.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:R.jsx("p",{children:"You do not have permission to access this page."})})})},OEe=()=>{const t=[{icon:R.jsx(y4,{className:"h-8 w-8 text-primary"}),title:"Compassion",description:"We approach our work with empathy and care for the dignity of those we serve."},{icon:R.jsx(RK,{className:"h-8 w-8 text-primary"}),title:"Global Reach",description:"Our network spans across continents to deliver aid wherever it is needed most."},{icon:R.jsx(Sw,{className:"h-8 w-8 text-primary"}),title:"Community Focus",description:"We believe in empowering communities to participate in their own recovery and development."},{icon:R.jsx(x4,{className:"h-8 w-8 text-primary"}),title:"Accountability",description:"We maintain transparency in our operations and responsible stewardship of resources."}];return R.jsx("div",{className:"min-h-screen bg-[#181f2a] flex items-center justify-center py-8 px-2",children:R.jsxs("div",{className:"w-full max-w-5xl bg-white rounded-xl shadow-lg p-8",children:[R.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-8",children:"About Us"}),R.jsxs("div",{className:"max-w-4xl mx-auto",children:[R.jsxs("section",{className:"mb-10",children:[R.jsx("h3",{className:"text-2xl font-semibold mb-4 text-gray-900",children:"Our Mission"}),R.jsx("p",{className:"text-gray-700 mb-4 text-lg",children:"The Humanitarian Aid Distribution System (HADS) was founded to efficiently and transparently distribute humanitarian aid to those in need by leveraging technology, ensuring equitable access, and minimizing logistical challenges."}),R.jsx("p",{className:"text-gray-700 text-lg",children:"We work with local and international partners to coordinate relief efforts in disaster-affected areas, conflict zones, and regions experiencing acute poverty or food insecurity."})]}),R.jsxs("section",{className:"mb-10",children:[R.jsx("h3",{className:"text-2xl font-semibold mb-4 text-gray-900",children:"Our Vision"}),R.jsx("p",{className:"text-gray-700 text-lg",children:"We envision a world where humanitarian assistance reaches all those in need quickly, efficiently, and with dignity. By leveraging technology and data-driven approaches, we aim to create a global, technology-driven aid distribution system that enhances transparency, promotes fairness, and ensures timely assistance to vulnerable communities worldwide."})]}),R.jsxs("section",{className:"mb-10",children:[R.jsx("h3",{className:"text-2xl font-semibold mb-5 text-gray-900",children:"Our Core Values"}),R.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.map((e,n)=>R.jsxs("div",{className:"flex p-6 border border-gray-100 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[R.jsx("div",{className:"mr-4 flex-shrink-0",children:e.icon}),R.jsxs("div",{children:[R.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-lg",children:e.title}),R.jsx("p",{className:"text-gray-600",children:e.description})]})]},n))})]}),R.jsxs("section",{className:"mb-8",children:[R.jsx("h3",{className:"text-2xl font-semibold mb-4 text-gray-900",children:"Our Team"}),R.jsx("p",{className:"text-gray-700 mb-4 text-lg",children:"HADS is powered by a dedicated team of humanitarian professionals, technologists, logistics experts, and volunteers committed to improving aid delivery systems worldwide."}),R.jsx("p",{className:"text-gray-700 text-lg",children:"We collaborate with local governments, NGOs, community organizations, and donors to ensure that our aid distribution efforts are coordinated, efficient, and responsive to the specific needs of each community we serve."})]}),R.jsxs("div",{className:"mt-8 p-8 bg-gray-50 rounded-lg border border-gray-100 text-center",children:[R.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center justify-center text-xl",children:[R.jsx(PK,{className:"h-6 w-6 mr-2 text-primary"}),"Get in Touch"]}),R.jsx("p",{className:"text-gray-700 mb-3 text-lg",children:"For partnerships, volunteer opportunities, or general inquiries:"}),R.jsx("p",{className:"font-medium text-lg",children:"contact@hads.org | +1 (123) 456-7890"})]})]})]})})};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function E2(t){return t+.5|0}const qp=(t,e,n)=>Math.max(Math.min(t,n),e);function ub(t){return qp(E2(t*2.55),0,255)}function um(t){return qp(E2(t*255),0,255)}function lf(t){return qp(E2(t/2.55)/100,0,1)}function S7(t){return qp(E2(t*100),0,100)}const Lu={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},TN=[..."0123456789ABCDEF"],LEe=t=>TN[t&15],FEe=t=>TN[(t&240)>>4]+TN[t&15],QS=t=>(t&240)>>4===(t&15),BEe=t=>QS(t.r)&&QS(t.g)&&QS(t.b)&&QS(t.a);function zEe(t){var e=t.length,n;return t[0]==="#"&&(e===4||e===5?n={r:255&Lu[t[1]]*17,g:255&Lu[t[2]]*17,b:255&Lu[t[3]]*17,a:e===5?Lu[t[4]]*17:255}:(e===7||e===9)&&(n={r:Lu[t[1]]<<4|Lu[t[2]],g:Lu[t[3]]<<4|Lu[t[4]],b:Lu[t[5]]<<4|Lu[t[6]],a:e===9?Lu[t[7]]<<4|Lu[t[8]]:255})),n}const jEe=(t,e)=>t<255?e(t):"";function VEe(t){var e=BEe(t)?LEe:FEe;return t?"#"+e(t.r)+e(t.g)+e(t.b)+jEe(t.a,e):void 0}const UEe=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function pJ(t,e,n){const r=e*Math.min(n,1-n),i=(l,u=(l+t/30)%12)=>n-r*Math.max(Math.min(u-3,9-u,1),-1);return[i(0),i(8),i(4)]}function HEe(t,e,n){const r=(i,l=(i+t/60)%6)=>n-n*e*Math.max(Math.min(l,4-l,1),0);return[r(5),r(3),r(1)]}function WEe(t,e,n){const r=pJ(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function $Ee(t,e,n,r,i){return t===i?(e-n)/r+(e<n?6:0):e===i?(n-t)/r+2:(t-e)/r+4}function W4(t){const n=t.r/255,r=t.g/255,i=t.b/255,l=Math.max(n,r,i),u=Math.min(n,r,i),s=(l+u)/2;let v,w,A;return l!==u&&(A=l-u,w=s>.5?A/(2-l-u):A/(l+u),v=$Ee(n,r,i,A,l),v=v*60+.5),[v|0,w||0,s]}function $4(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(um)}function q4(t,e,n){return $4(pJ,t,e,n)}function qEe(t,e,n){return $4(WEe,t,e,n)}function GEe(t,e,n){return $4(HEe,t,e,n)}function mJ(t){return(t%360+360)%360}function YEe(t){const e=UEe.exec(t);let n=255,r;if(!e)return;e[5]!==r&&(n=e[6]?ub(+e[5]):um(+e[5]));const i=mJ(+e[2]),l=+e[3]/100,u=+e[4]/100;return e[1]==="hwb"?r=qEe(i,l,u):e[1]==="hsv"?r=GEe(i,l,u):r=q4(i,l,u),{r:r[0],g:r[1],b:r[2],a:n}}function XEe(t,e){var n=W4(t);n[0]=mJ(n[0]+e),n=q4(n),t.r=n[0],t.g=n[1],t.b=n[2]}function KEe(t){if(!t)return;const e=W4(t),n=e[0],r=S7(e[1]),i=S7(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${lf(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}const T7={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},C7={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function ZEe(){const t={},e=Object.keys(C7),n=Object.keys(T7);let r,i,l,u,s;for(r=0;r<e.length;r++){for(u=s=e[r],i=0;i<n.length;i++)l=n[i],s=s.replace(l,T7[l]);l=parseInt(C7[u],16),t[s]=[l>>16&255,l>>8&255,l&255]}return t}let JS;function QEe(t){JS||(JS=ZEe(),JS.transparent=[0,0,0,0]);const e=JS[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const JEe=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function eSe(t){const e=JEe.exec(t);let n=255,r,i,l;if(e){if(e[7]!==r){const u=+e[7];n=e[8]?ub(u):qp(u*255,0,255)}return r=+e[1],i=+e[3],l=+e[5],r=255&(e[2]?ub(r):qp(r,0,255)),i=255&(e[4]?ub(i):qp(i,0,255)),l=255&(e[6]?ub(l):qp(l,0,255)),{r,g:i,b:l,a:n}}}function tSe(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${lf(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const XD=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,F0=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function nSe(t,e,n){const r=F0(lf(t.r)),i=F0(lf(t.g)),l=F0(lf(t.b));return{r:um(XD(r+n*(F0(lf(e.r))-r))),g:um(XD(i+n*(F0(lf(e.g))-i))),b:um(XD(l+n*(F0(lf(e.b))-l))),a:t.a+n*(e.a-t.a)}}function eT(t,e,n){if(t){let r=W4(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,e===0?360:1)),r=q4(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function gJ(t,e){return t&&Object.assign(e||{},t)}function I7(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=um(t[3]))):(e=gJ(t,{r:0,g:0,b:0,a:1}),e.a=um(e.a)),e}function rSe(t){return t.charAt(0)==="r"?eSe(t):YEe(t)}class Aw{constructor(e){if(e instanceof Aw)return e;const n=typeof e;let r;n==="object"?r=I7(e):n==="string"&&(r=zEe(e)||QEe(e)||rSe(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=gJ(this._rgb);return e&&(e.a=lf(e.a)),e}set rgb(e){this._rgb=I7(e)}rgbString(){return this._valid?tSe(this._rgb):void 0}hexString(){return this._valid?VEe(this._rgb):void 0}hslString(){return this._valid?KEe(this._rgb):void 0}mix(e,n){if(e){const r=this.rgb,i=e.rgb;let l;const u=n===l?.5:n,s=2*u-1,v=r.a-i.a,w=((s*v===-1?s:(s+v)/(1+s*v))+1)/2;l=1-w,r.r=255&w*r.r+l*i.r+.5,r.g=255&w*r.g+l*i.g+.5,r.b=255&w*r.b+l*i.b+.5,r.a=u*r.a+(1-u)*i.a,this.rgb=r}return this}interpolate(e,n){return e&&(this._rgb=nSe(this._rgb,e._rgb,n)),this}clone(){return new Aw(this.rgb)}alpha(e){return this._rgb.a=um(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=E2(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return eT(this._rgb,2,e),this}darken(e){return eT(this._rgb,2,-e),this}saturate(e){return eT(this._rgb,1,e),this}desaturate(e){return eT(this._rgb,1,-e),this}rotate(e){return XEe(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Jd(){}const iSe=(()=>{let t=0;return()=>t++})();function Hs(t){return t==null}function La(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function gs(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function rc(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function ad(t,e){return rc(t)?t:e}function hs(t,e){return typeof t>"u"?e:t}const sSe=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function Co(t,e,n){if(t&&typeof t.call=="function")return t.apply(n,e)}function Ks(t,e,n,r){let i,l,u;if(La(t))for(l=t.length,i=0;i<l;i++)e.call(n,t[i],i);else if(gs(t))for(u=Object.keys(t),l=u.length,i=0;i<l;i++)e.call(n,t[u[i]],u[i])}function _I(t,e){let n,r,i,l;if(!t||!e||t.length!==e.length)return!1;for(n=0,r=t.length;n<r;++n)if(i=t[n],l=e[n],i.datasetIndex!==l.datasetIndex||i.index!==l.index)return!1;return!0}function yI(t){if(La(t))return t.map(yI);if(gs(t)){const e=Object.create(null),n=Object.keys(t),r=n.length;let i=0;for(;i<r;++i)e[n[i]]=yI(t[n[i]]);return e}return t}function _J(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function oSe(t,e,n,r){if(!_J(t))return;const i=e[t],l=n[t];gs(i)&&gs(l)?Rw(i,l,r):e[t]=yI(l)}function Rw(t,e,n){const r=La(e)?e:[e],i=r.length;if(!gs(t))return t;n=n||{};const l=n.merger||oSe;let u;for(let s=0;s<i;++s){if(u=r[s],!gs(u))continue;const v=Object.keys(u);for(let w=0,A=v.length;w<A;++w)l(v[w],t,u,n)}return t}function Ob(t,e){return Rw(t,e,{merger:aSe})}function aSe(t,e,n){if(!_J(t))return;const r=e[t],i=n[t];gs(r)&&gs(i)?Ob(r,i):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=yI(i))}const A7={"":t=>t,x:t=>t.x,y:t=>t.y};function lSe(t){const e=t.split("."),n=[];let r="";for(const i of e)r+=i,r.endsWith("\\")?r=r.slice(0,-1)+".":(n.push(r),r="");return n}function cSe(t){const e=lSe(t);return n=>{for(const r of e){if(r==="")break;n=n&&n[r]}return n}}function rx(t,e){return(A7[e]||(A7[e]=cSe(e)))(t)}function G4(t){return t.charAt(0).toUpperCase()+t.slice(1)}const Mw=t=>typeof t<"u",Im=t=>typeof t=="function",R7=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};function uSe(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const ll=Math.PI,kh=2*ll,hSe=kh+ll,xI=Number.POSITIVE_INFINITY,dSe=ll/180,Ih=ll/2,Sg=ll/4,M7=ll*2/3,yJ=Math.log10,Rd=Math.sign;function Lb(t,e,n){return Math.abs(t-e)<n}function P7(t){const e=Math.round(t);t=Lb(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(yJ(t))),r=t/n;return(r<=1?1:r<=2?2:r<=5?5:10)*n}function fSe(t){const e=[],n=Math.sqrt(t);let r;for(r=1;r<n;r++)t%r===0&&(e.push(r),e.push(t/r));return n===(n|0)&&e.push(n),e.sort((i,l)=>i-l).pop(),e}function pSe(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function Pw(t){return!pSe(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function mSe(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}function gSe(t,e,n){let r,i,l;for(r=0,i=t.length;r<i;r++)l=t[r][n],isNaN(l)||(e.min=Math.min(e.min,l),e.max=Math.max(e.max,l))}function Wg(t){return t*(ll/180)}function _Se(t){return t*(180/ll)}function D7(t){if(!rc(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function ySe(t,e){const n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);let l=Math.atan2(r,n);return l<-.5*ll&&(l+=kh),{angle:l,distance:i}}function CN(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function xSe(t,e){return(t-e+hSe)%kh-ll}function md(t){return(t%kh+kh)%kh}function xJ(t,e,n,r){const i=md(t),l=md(e),u=md(n),s=md(l-i),v=md(u-i),w=md(i-l),A=md(i-u);return i===l||i===u||r&&l===u||s>v&&w<A}function fu(t,e,n){return Math.max(e,Math.min(n,t))}function vSe(t){return fu(t,-32768,32767)}function Gp(t,e,n,r=1e-6){return t>=Math.min(e,n)-r&&t<=Math.max(e,n)+r}function Y4(t,e,n){n=n||(u=>t[u]<e);let r=t.length-1,i=0,l;for(;r-i>1;)l=i+r>>1,n(l)?i=l:r=l;return{lo:i,hi:r}}const $g=(t,e,n,r)=>Y4(t,n,r?i=>{const l=t[i][e];return l<n||l===n&&t[i+1][e]===n}:i=>t[i][e]<n),bSe=(t,e,n)=>Y4(t,n,r=>t[r][e]>=n);function wSe(t,e,n){let r=0,i=t.length;for(;r<i&&t[r]<e;)r++;for(;i>r&&t[i-1]>n;)i--;return r>0||i<t.length?t.slice(r,i):t}const vJ=["push","pop","shift","splice","unshift"];function ESe(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),vJ.forEach(n=>{const r="_onData"+G4(n),i=t[n];Object.defineProperty(t,n,{configurable:!0,enumerable:!1,value(...l){const u=i.apply(this,l);return t._chartjs.listeners.forEach(s=>{typeof s[r]=="function"&&s[r](...l)}),u}})})}function k7(t,e){const n=t._chartjs;if(!n)return;const r=n.listeners,i=r.indexOf(e);i!==-1&&r.splice(i,1),!(r.length>0)&&(vJ.forEach(l=>{delete t[l]}),delete t._chartjs)}function bJ(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const wJ=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function EJ(t,e){let n=[],r=!1;return function(...i){n=i,r||(r=!0,wJ.call(window,()=>{r=!1,t.apply(e,n)}))}}function SSe(t,e){let n;return function(...r){return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}const X4=t=>t==="start"?"left":t==="end"?"right":"center",Gl=(t,e,n)=>t==="start"?e:t==="end"?n:(e+n)/2,TSe=(t,e,n,r)=>t===(r?"left":"right")?n:t==="center"?(e+n)/2:e;function CSe(t,e,n){const r=e.length;let i=0,l=r;if(t._sorted){const{iScale:u,vScale:s,_parsed:v}=t,w=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,A=u.axis,{min:F,max:W,minDefined:K,maxDefined:Q}=u.getUserBounds();if(K){if(i=Math.min($g(v,A,F).lo,n?r:$g(e,A,u.getPixelForValue(F)).lo),w){const Z=v.slice(0,i+1).reverse().findIndex(oe=>!Hs(oe[s.axis]));i-=Math.max(0,Z)}i=fu(i,0,r-1)}if(Q){let Z=Math.max($g(v,u.axis,W,!0).hi+1,n?0:$g(e,A,u.getPixelForValue(W),!0).hi+1);if(w){const oe=v.slice(Z-1).findIndex(ae=>!Hs(ae[s.axis]));Z+=Math.max(0,oe)}l=fu(Z,i,r)-i}else l=r-i}return{start:i,count:l}}function ISe(t){const{xScale:e,yScale:n,_scaleRanges:r}=t,i={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!r)return t._scaleRanges=i,!0;const l=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==n.min||r.ymax!==n.max;return Object.assign(r,i),l}const tT=t=>t===0||t===1,N7=(t,e,n)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*kh/n)),O7=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*kh/n)+1,Fb={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*Ih)+1,easeOutSine:t=>Math.sin(t*Ih),easeInOutSine:t=>-.5*(Math.cos(ll*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>tT(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>tT(t)?t:N7(t,.075,.3),easeOutElastic:t=>tT(t)?t:O7(t,.075,.3),easeInOutElastic(t){return tT(t)?t:t<.5?.5*N7(t*2,.1125,.45):.5+.5*O7(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-Fb.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?Fb.easeInBounce(t*2)*.5:Fb.easeOutBounce(t*2-1)*.5+.5};function K4(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function L7(t){return K4(t)?t:new Aw(t)}function KD(t){return K4(t)?t:new Aw(t).saturate(.5).darken(.1).hexString()}const ASe=["x","y","borderWidth","radius","tension"],RSe=["color","borderColor","backgroundColor"];function MSe(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:RSe},numbers:{type:"number",properties:ASe}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function PSe(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const F7=new Map;function DSe(t,e){e=e||{};const n=t+JSON.stringify(e);let r=F7.get(n);return r||(r=new Intl.NumberFormat(t,e),F7.set(n,r)),r}function SJ(t,e,n){return DSe(e,n).format(t)}const kSe={values(t){return La(t)?t:""+t},numeric(t,e,n){if(t===0)return"0";const r=this.chart.options.locale;let i,l=t;if(n.length>1){const w=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(w<1e-4||w>1e15)&&(i="scientific"),l=NSe(t,n)}const u=yJ(Math.abs(l)),s=isNaN(u)?1:Math.max(Math.min(-1*Math.floor(u),20),0),v={notation:i,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(v,this.options.ticks.format),SJ(t,r,v)}};function NSe(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}var TJ={formatters:kSe};function OSe(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,n)=>n.lineWidth,tickColor:(e,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:TJ.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const m_=Object.create(null),IN=Object.create(null);function Bb(t,e){if(!e)return t;const n=e.split(".");for(let r=0,i=n.length;r<i;++r){const l=n[r];t=t[l]||(t[l]=Object.create(null))}return t}function ZD(t,e,n){return typeof e=="string"?Rw(Bb(t,e),n):Rw(Bb(t,""),e)}class LSe{constructor(e,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,i)=>KD(i.backgroundColor),this.hoverBorderColor=(r,i)=>KD(i.borderColor),this.hoverColor=(r,i)=>KD(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(n)}set(e,n){return ZD(this,e,n)}get(e){return Bb(this,e)}describe(e,n){return ZD(IN,e,n)}override(e,n){return ZD(m_,e,n)}route(e,n,r,i){const l=Bb(this,e),u=Bb(this,r),s="_"+n;Object.defineProperties(l,{[s]:{value:l[n],writable:!0},[n]:{enumerable:!0,get(){const v=this[s],w=u[i];return gs(v)?Object.assign({},w,v):hs(v,w)},set(v){this[s]=v}}})}apply(e){e.forEach(n=>n(this))}}var ga=new LSe({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[MSe,PSe,OSe]);function FSe(t){return!t||Hs(t.size)||Hs(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function B7(t,e,n,r,i){let l=e[i];return l||(l=e[i]=t.measureText(i).width,n.push(i)),l>r&&(r=l),r}function Tg(t,e,n){const r=t.currentDevicePixelRatio,i=n!==0?Math.max(n/2,.5):0;return Math.round((e-i)*r)/r+i}function z7(t,e){!e&&!t||(e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function AN(t,e,n,r){CJ(t,e,n,r,null)}function CJ(t,e,n,r,i){let l,u,s,v,w,A,F,W;const K=e.pointStyle,Q=e.rotation,Z=e.radius;let oe=(Q||0)*dSe;if(K&&typeof K=="object"&&(l=K.toString(),l==="[object HTMLImageElement]"||l==="[object HTMLCanvasElement]")){t.save(),t.translate(n,r),t.rotate(oe),t.drawImage(K,-K.width/2,-K.height/2,K.width,K.height),t.restore();return}if(!(isNaN(Z)||Z<=0)){switch(t.beginPath(),K){default:i?t.ellipse(n,r,i/2,Z,0,0,kh):t.arc(n,r,Z,0,kh),t.closePath();break;case"triangle":A=i?i/2:Z,t.moveTo(n+Math.sin(oe)*A,r-Math.cos(oe)*Z),oe+=M7,t.lineTo(n+Math.sin(oe)*A,r-Math.cos(oe)*Z),oe+=M7,t.lineTo(n+Math.sin(oe)*A,r-Math.cos(oe)*Z),t.closePath();break;case"rectRounded":w=Z*.516,v=Z-w,u=Math.cos(oe+Sg)*v,F=Math.cos(oe+Sg)*(i?i/2-w:v),s=Math.sin(oe+Sg)*v,W=Math.sin(oe+Sg)*(i?i/2-w:v),t.arc(n-F,r-s,w,oe-ll,oe-Ih),t.arc(n+W,r-u,w,oe-Ih,oe),t.arc(n+F,r+s,w,oe,oe+Ih),t.arc(n-W,r+u,w,oe+Ih,oe+ll),t.closePath();break;case"rect":if(!Q){v=Math.SQRT1_2*Z,A=i?i/2:v,t.rect(n-A,r-v,2*A,2*v);break}oe+=Sg;case"rectRot":F=Math.cos(oe)*(i?i/2:Z),u=Math.cos(oe)*Z,s=Math.sin(oe)*Z,W=Math.sin(oe)*(i?i/2:Z),t.moveTo(n-F,r-s),t.lineTo(n+W,r-u),t.lineTo(n+F,r+s),t.lineTo(n-W,r+u),t.closePath();break;case"crossRot":oe+=Sg;case"cross":F=Math.cos(oe)*(i?i/2:Z),u=Math.cos(oe)*Z,s=Math.sin(oe)*Z,W=Math.sin(oe)*(i?i/2:Z),t.moveTo(n-F,r-s),t.lineTo(n+F,r+s),t.moveTo(n+W,r-u),t.lineTo(n-W,r+u);break;case"star":F=Math.cos(oe)*(i?i/2:Z),u=Math.cos(oe)*Z,s=Math.sin(oe)*Z,W=Math.sin(oe)*(i?i/2:Z),t.moveTo(n-F,r-s),t.lineTo(n+F,r+s),t.moveTo(n+W,r-u),t.lineTo(n-W,r+u),oe+=Sg,F=Math.cos(oe)*(i?i/2:Z),u=Math.cos(oe)*Z,s=Math.sin(oe)*Z,W=Math.sin(oe)*(i?i/2:Z),t.moveTo(n-F,r-s),t.lineTo(n+F,r+s),t.moveTo(n+W,r-u),t.lineTo(n-W,r+u);break;case"line":u=i?i/2:Math.cos(oe)*Z,s=Math.sin(oe)*Z,t.moveTo(n-u,r-s),t.lineTo(n+u,r+s);break;case"dash":t.moveTo(n,r),t.lineTo(n+Math.cos(oe)*(i?i/2:Z),r+Math.sin(oe)*Z);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function Dw(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function JA(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function eR(t){t.restore()}function BSe(t,e,n,r,i){if(!e)return t.lineTo(n.x,n.y);if(i==="middle"){const l=(e.x+n.x)/2;t.lineTo(l,e.y),t.lineTo(l,n.y)}else i==="after"!=!!r?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function zSe(t,e,n,r){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?n.cp2x:n.cp1x,r?n.cp2y:n.cp1y,n.x,n.y)}function jSe(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),Hs(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function VSe(t,e,n,r,i){if(i.strikethrough||i.underline){const l=t.measureText(r),u=e-l.actualBoundingBoxLeft,s=e+l.actualBoundingBoxRight,v=n-l.actualBoundingBoxAscent,w=n+l.actualBoundingBoxDescent,A=i.strikethrough?(v+w)/2:w;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=i.decorationWidth||2,t.moveTo(u,A),t.lineTo(s,A),t.stroke()}}function USe(t,e){const n=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=n}function kw(t,e,n,r,i,l={}){const u=La(e)?e:[e],s=l.strokeWidth>0&&l.strokeColor!=="";let v,w;for(t.save(),t.font=i.string,jSe(t,l),v=0;v<u.length;++v)w=u[v],l.backdrop&&USe(t,l.backdrop),s&&(l.strokeColor&&(t.strokeStyle=l.strokeColor),Hs(l.strokeWidth)||(t.lineWidth=l.strokeWidth),t.strokeText(w,n,r,l.maxWidth)),t.fillText(w,n,r,l.maxWidth),VSe(t,n,r,w,l),r+=Number(i.lineHeight);t.restore()}function vI(t,e){const{x:n,y:r,w:i,h:l,radius:u}=e;t.arc(n+u.topLeft,r+u.topLeft,u.topLeft,1.5*ll,ll,!0),t.lineTo(n,r+l-u.bottomLeft),t.arc(n+u.bottomLeft,r+l-u.bottomLeft,u.bottomLeft,ll,Ih,!0),t.lineTo(n+i-u.bottomRight,r+l),t.arc(n+i-u.bottomRight,r+l-u.bottomRight,u.bottomRight,Ih,0,!0),t.lineTo(n+i,r+u.topRight),t.arc(n+i-u.topRight,r+u.topRight,u.topRight,0,-Ih,!0),t.lineTo(n+u.topLeft,r)}const HSe=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,WSe=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function $Se(t,e){const n=(""+t).match(HSe);if(!n||n[1]==="normal")return e*1.2;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100;break}return e*t}const qSe=t=>+t||0;function IJ(t,e){const n={},r=gs(e),i=r?Object.keys(e):e,l=gs(t)?r?u=>hs(t[u],t[e[u]]):u=>t[u]:()=>t;for(const u of i)n[u]=qSe(l(u));return n}function AJ(t){return IJ(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Sy(t){return IJ(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Xu(t){const e=AJ(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Jl(t,e){t=t||{},e=e||ga.font;let n=hs(t.size,e.size);typeof n=="string"&&(n=parseInt(n,10));let r=hs(t.style,e.style);r&&!(""+r).match(WSe)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const i={family:hs(t.family,e.family),lineHeight:$Se(hs(t.lineHeight,e.lineHeight),n),size:n,style:r,weight:hs(t.weight,e.weight),string:""};return i.string=FSe(i),i}function nT(t,e,n,r){let i,l,u;for(i=0,l=t.length;i<l;++i)if(u=t[i],u!==void 0&&u!==void 0)return u}function GSe(t,e,n){const{min:r,max:i}=t,l=sSe(e,(i-r)/2),u=(s,v)=>n&&s===0?0:s+v;return{min:u(r,-Math.abs(l)),max:u(i,l)}}function P_(t,e){return Object.assign(Object.create(t),e)}function Z4(t,e=[""],n,r,i=()=>t[0]){const l=n||t;typeof r>"u"&&(r=DJ("_fallback",t));const u={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:l,_fallback:r,_getTarget:i,override:s=>Z4([s,...t],e,l,r)};return new Proxy(u,{deleteProperty(s,v){return delete s[v],delete s._keys,delete t[0][v],!0},get(s,v){return MJ(s,v,()=>tTe(v,e,t,s))},getOwnPropertyDescriptor(s,v){return Reflect.getOwnPropertyDescriptor(s._scopes[0],v)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(s,v){return V7(s).includes(v)},ownKeys(s){return V7(s)},set(s,v,w){const A=s._storage||(s._storage=i());return s[v]=A[v]=w,delete s._keys,!0}})}function ix(t,e,n,r){const i={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:RJ(t,r),setContext:l=>ix(t,l,n,r),override:l=>ix(t.override(l),e,n,r)};return new Proxy(i,{deleteProperty(l,u){return delete l[u],delete t[u],!0},get(l,u,s){return MJ(l,u,()=>XSe(l,u,s))},getOwnPropertyDescriptor(l,u){return l._descriptors.allKeys?Reflect.has(t,u)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,u)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(l,u){return Reflect.has(t,u)},ownKeys(){return Reflect.ownKeys(t)},set(l,u,s){return t[u]=s,delete l[u],!0}})}function RJ(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=t;return{allKeys:i,scriptable:n,indexable:r,isScriptable:Im(n)?n:()=>n,isIndexable:Im(r)?r:()=>r}}const YSe=(t,e)=>t?t+G4(e):e,Q4=(t,e)=>gs(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function MJ(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e)||e==="constructor")return t[e];const r=n();return t[e]=r,r}function XSe(t,e,n){const{_proxy:r,_context:i,_subProxy:l,_descriptors:u}=t;let s=r[e];return Im(s)&&u.isScriptable(e)&&(s=KSe(e,s,t,n)),La(s)&&s.length&&(s=ZSe(e,s,t,u.isIndexable)),Q4(e,s)&&(s=ix(s,i,l&&l[e],u)),s}function KSe(t,e,n,r){const{_proxy:i,_context:l,_subProxy:u,_stack:s}=n;if(s.has(t))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+t);s.add(t);let v=e(l,u||r);return s.delete(t),Q4(t,v)&&(v=J4(i._scopes,i,t,v)),v}function ZSe(t,e,n,r){const{_proxy:i,_context:l,_subProxy:u,_descriptors:s}=n;if(typeof l.index<"u"&&r(t))return e[l.index%e.length];if(gs(e[0])){const v=e,w=i._scopes.filter(A=>A!==v);e=[];for(const A of v){const F=J4(w,i,t,A);e.push(ix(F,l,u&&u[t],s))}}return e}function PJ(t,e,n){return Im(t)?t(e,n):t}const QSe=(t,e)=>t===!0?e:typeof t=="string"?rx(e,t):void 0;function JSe(t,e,n,r,i){for(const l of e){const u=QSe(n,l);if(u){t.add(u);const s=PJ(u._fallback,n,i);if(typeof s<"u"&&s!==n&&s!==r)return s}else if(u===!1&&typeof r<"u"&&n!==r)return null}return!1}function J4(t,e,n,r){const i=e._rootScopes,l=PJ(e._fallback,n,r),u=[...t,...i],s=new Set;s.add(r);let v=j7(s,u,n,l||n,r);return v===null||typeof l<"u"&&l!==n&&(v=j7(s,u,l,v,r),v===null)?!1:Z4(Array.from(s),[""],i,l,()=>eTe(e,n,r))}function j7(t,e,n,r,i){for(;n;)n=JSe(t,e,n,r,i);return n}function eTe(t,e,n){const r=t._getTarget();e in r||(r[e]={});const i=r[e];return La(i)&&gs(n)?n:i||{}}function tTe(t,e,n,r){let i;for(const l of e)if(i=DJ(YSe(l,t),n),typeof i<"u")return Q4(t,i)?J4(n,r,t,i):i}function DJ(t,e){for(const n of e){if(!n)continue;const r=n[t];if(typeof r<"u")return r}}function V7(t){let e=t._keys;return e||(e=t._keys=nTe(t._scopes)),e}function nTe(t){const e=new Set;for(const n of t)for(const r of Object.keys(n).filter(i=>!i.startsWith("_")))e.add(r);return Array.from(e)}const rTe=Number.EPSILON||1e-14,sx=(t,e)=>e<t.length&&!t[e].skip&&t[e],kJ=t=>t==="x"?"y":"x";function iTe(t,e,n,r){const i=t.skip?e:t,l=e,u=n.skip?e:n,s=CN(l,i),v=CN(u,l);let w=s/(s+v),A=v/(s+v);w=isNaN(w)?0:w,A=isNaN(A)?0:A;const F=r*w,W=r*A;return{previous:{x:l.x-F*(u.x-i.x),y:l.y-F*(u.y-i.y)},next:{x:l.x+W*(u.x-i.x),y:l.y+W*(u.y-i.y)}}}function sTe(t,e,n){const r=t.length;let i,l,u,s,v,w=sx(t,0);for(let A=0;A<r-1;++A)if(v=w,w=sx(t,A+1),!(!v||!w)){if(Lb(e[A],0,rTe)){n[A]=n[A+1]=0;continue}i=n[A]/e[A],l=n[A+1]/e[A],s=Math.pow(i,2)+Math.pow(l,2),!(s<=9)&&(u=3/Math.sqrt(s),n[A]=i*u*e[A],n[A+1]=l*u*e[A])}}function oTe(t,e,n="x"){const r=kJ(n),i=t.length;let l,u,s,v=sx(t,0);for(let w=0;w<i;++w){if(u=s,s=v,v=sx(t,w+1),!s)continue;const A=s[n],F=s[r];u&&(l=(A-u[n])/3,s[`cp1${n}`]=A-l,s[`cp1${r}`]=F-l*e[w]),v&&(l=(v[n]-A)/3,s[`cp2${n}`]=A+l,s[`cp2${r}`]=F+l*e[w])}}function aTe(t,e="x"){const n=kJ(e),r=t.length,i=Array(r).fill(0),l=Array(r);let u,s,v,w=sx(t,0);for(u=0;u<r;++u)if(s=v,v=w,w=sx(t,u+1),!!v){if(w){const A=w[e]-v[e];i[u]=A!==0?(w[n]-v[n])/A:0}l[u]=s?w?Rd(i[u-1])!==Rd(i[u])?0:(i[u-1]+i[u])/2:i[u-1]:i[u]}sTe(t,i,l),oTe(t,l,e)}function rT(t,e,n){return Math.max(Math.min(t,n),e)}function lTe(t,e){let n,r,i,l,u,s=Dw(t[0],e);for(n=0,r=t.length;n<r;++n)u=l,l=s,s=n<r-1&&Dw(t[n+1],e),l&&(i=t[n],u&&(i.cp1x=rT(i.cp1x,e.left,e.right),i.cp1y=rT(i.cp1y,e.top,e.bottom)),s&&(i.cp2x=rT(i.cp2x,e.left,e.right),i.cp2y=rT(i.cp2y,e.top,e.bottom)))}function cTe(t,e,n,r,i){let l,u,s,v;if(e.spanGaps&&(t=t.filter(w=>!w.skip)),e.cubicInterpolationMode==="monotone")aTe(t,i);else{let w=r?t[t.length-1]:t[0];for(l=0,u=t.length;l<u;++l)s=t[l],v=iTe(w,s,t[Math.min(l+1,u-(r?0:1))%u],e.tension),s.cp1x=v.previous.x,s.cp1y=v.previous.y,s.cp2x=v.next.x,s.cp2y=v.next.y,w=s}e.capBezierPoints&&lTe(t,n)}function eF(){return typeof window<"u"&&typeof document<"u"}function tF(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function bI(t,e,n){let r;return typeof t=="string"?(r=parseInt(t,10),t.indexOf("%")!==-1&&(r=r/100*e.parentNode[n])):r=t,r}const tR=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function uTe(t,e){return tR(t).getPropertyValue(e)}const hTe=["top","right","bottom","left"];function Jg(t,e,n){const r={};n=n?"-"+n:"";for(let i=0;i<4;i++){const l=hTe[i];r[l]=parseFloat(t[e+"-"+l+n])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const dTe=(t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot);function fTe(t,e){const n=t.touches,r=n&&n.length?n[0]:t,{offsetX:i,offsetY:l}=r;let u=!1,s,v;if(dTe(i,l,t.target))s=i,v=l;else{const w=e.getBoundingClientRect();s=r.clientX-w.left,v=r.clientY-w.top,u=!0}return{x:s,y:v,box:u}}function kg(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:r}=e,i=tR(n),l=i.boxSizing==="border-box",u=Jg(i,"padding"),s=Jg(i,"border","width"),{x:v,y:w,box:A}=fTe(t,n),F=u.left+(A&&s.left),W=u.top+(A&&s.top);let{width:K,height:Q}=e;return l&&(K-=u.width+s.width,Q-=u.height+s.height),{x:Math.round((v-F)/K*n.width/r),y:Math.round((w-W)/Q*n.height/r)}}function pTe(t,e,n){let r,i;if(e===void 0||n===void 0){const l=t&&tF(t);if(!l)e=t.clientWidth,n=t.clientHeight;else{const u=l.getBoundingClientRect(),s=tR(l),v=Jg(s,"border","width"),w=Jg(s,"padding");e=u.width-w.width-v.width,n=u.height-w.height-v.height,r=bI(s.maxWidth,l,"clientWidth"),i=bI(s.maxHeight,l,"clientHeight")}}return{width:e,height:n,maxWidth:r||xI,maxHeight:i||xI}}const iT=t=>Math.round(t*10)/10;function mTe(t,e,n,r){const i=tR(t),l=Jg(i,"margin"),u=bI(i.maxWidth,t,"clientWidth")||xI,s=bI(i.maxHeight,t,"clientHeight")||xI,v=pTe(t,e,n);let{width:w,height:A}=v;if(i.boxSizing==="content-box"){const W=Jg(i,"border","width"),K=Jg(i,"padding");w-=K.width+W.width,A-=K.height+W.height}return w=Math.max(0,w-l.width),A=Math.max(0,r?w/r:A-l.height),w=iT(Math.min(w,u,v.maxWidth)),A=iT(Math.min(A,s,v.maxHeight)),w&&!A&&(A=iT(w/2)),(e!==void 0||n!==void 0)&&r&&v.height&&A>v.height&&(A=v.height,w=iT(Math.floor(A*r))),{width:w,height:A}}function U7(t,e,n){const r=e||1,i=Math.floor(t.height*r),l=Math.floor(t.width*r);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const u=t.canvas;return u.style&&(n||!u.style.height&&!u.style.width)&&(u.style.height=`${t.height}px`,u.style.width=`${t.width}px`),t.currentDevicePixelRatio!==r||u.height!==i||u.width!==l?(t.currentDevicePixelRatio=r,u.height=i,u.width=l,t.ctx.setTransform(r,0,0,r,0,0),!0):!1}const gTe=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};eF()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t}();function H7(t,e){const n=uTe(t,e),r=n&&n.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function Ng(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function _Te(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:r==="middle"?n<.5?t.y:e.y:r==="after"?n<1?t.y:e.y:n>0?e.y:t.y}}function yTe(t,e,n,r){const i={x:t.cp2x,y:t.cp2y},l={x:e.cp1x,y:e.cp1y},u=Ng(t,i,n),s=Ng(i,l,n),v=Ng(l,e,n),w=Ng(u,s,n),A=Ng(s,v,n);return Ng(w,A,n)}const xTe=function(t,e){return{x(n){return t+t+e-n},setWidth(n){e=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,r){return n-r},leftForLtr(n,r){return n-r}}},vTe=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function Ty(t,e,n){return t?xTe(e,n):vTe()}function NJ(t,e){let n,r;(e==="ltr"||e==="rtl")&&(n=t.canvas.style,r=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=r)}function OJ(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function LJ(t){return t==="angle"?{between:xJ,compare:xSe,normalize:md}:{between:Gp,compare:(e,n)=>e-n,normalize:e=>e}}function W7({start:t,end:e,count:n,loop:r,style:i}){return{start:t%n,end:e%n,loop:r&&(e-t+1)%n===0,style:i}}function bTe(t,e,n){const{property:r,start:i,end:l}=n,{between:u,normalize:s}=LJ(r),v=e.length;let{start:w,end:A,loop:F}=t,W,K;if(F){for(w+=v,A+=v,W=0,K=v;W<K&&u(s(e[w%v][r]),i,l);++W)w--,A--;w%=v,A%=v}return A<w&&(A+=v),{start:w,end:A,loop:F,style:t.style}}function FJ(t,e,n){if(!n)return[t];const{property:r,start:i,end:l}=n,u=e.length,{compare:s,between:v,normalize:w}=LJ(r),{start:A,end:F,loop:W,style:K}=bTe(t,e,n),Q=[];let Z=!1,oe=null,ae,me,pe;const _e=()=>v(i,pe,ae)&&s(i,pe)!==0,De=()=>s(l,ae)===0||v(l,pe,ae),Ae=()=>Z||_e(),re=()=>!Z||De();for(let fe=A,ye=A;fe<=F;++fe)me=e[fe%u],!me.skip&&(ae=w(me[r]),ae!==pe&&(Z=v(ae,i,l),oe===null&&Ae()&&(oe=s(ae,i)===0?fe:ye),oe!==null&&re()&&(Q.push(W7({start:oe,end:fe,loop:W,count:u,style:K})),oe=null),ye=fe,pe=ae));return oe!==null&&Q.push(W7({start:oe,end:F,loop:W,count:u,style:K})),Q}function BJ(t,e){const n=[],r=t.segments;for(let i=0;i<r.length;i++){const l=FJ(r[i],t.points,e);l.length&&n.push(...l)}return n}function wTe(t,e,n,r){let i=0,l=e-1;if(n&&!r)for(;i<e&&!t[i].skip;)i++;for(;i<e&&t[i].skip;)i++;for(i%=e,n&&(l+=i);l>i&&t[l%e].skip;)l--;return l%=e,{start:i,end:l}}function ETe(t,e,n,r){const i=t.length,l=[];let u=e,s=t[e],v;for(v=e+1;v<=n;++v){const w=t[v%i];w.skip||w.stop?s.skip||(r=!1,l.push({start:e%i,end:(v-1)%i,loop:r}),e=u=w.stop?v:null):(u=v,s.skip&&(e=v)),s=w}return u!==null&&l.push({start:e%i,end:u%i,loop:r}),l}function STe(t,e){const n=t.points,r=t.options.spanGaps,i=n.length;if(!i)return[];const l=!!t._loop,{start:u,end:s}=wTe(n,i,l,r);if(r===!0)return $7(t,[{start:u,end:s,loop:l}],n,e);const v=s<u?s+i:s,w=!!t._fullLoop&&u===0&&s===i-1;return $7(t,ETe(n,u,v,w),n,e)}function $7(t,e,n,r){return!r||!r.setContext||!n?e:TTe(t,e,n,r)}function TTe(t,e,n,r){const i=t._chart.getContext(),l=q7(t.options),{_datasetIndex:u,options:{spanGaps:s}}=t,v=n.length,w=[];let A=l,F=e[0].start,W=F;function K(Q,Z,oe,ae){const me=s?-1:1;if(Q!==Z){for(Q+=v;n[Q%v].skip;)Q-=me;for(;n[Z%v].skip;)Z+=me;Q%v!==Z%v&&(w.push({start:Q%v,end:Z%v,loop:oe,style:ae}),A=ae,F=Z%v)}}for(const Q of e){F=s?F:Q.start;let Z=n[F%v],oe;for(W=F+1;W<=Q.end;W++){const ae=n[W%v];oe=q7(r.setContext(P_(i,{type:"segment",p0:Z,p1:ae,p0DataIndex:(W-1)%v,p1DataIndex:W%v,datasetIndex:u}))),CTe(oe,A)&&K(F,W-1,Q.loop,A),Z=ae,A=oe}F<W-1&&K(F,W-1,Q.loop,A)}return w}function q7(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function CTe(t,e){if(!e)return!1;const n=[],r=function(i,l){return K4(l)?(n.includes(l)||n.push(l),n.indexOf(l)):l};return JSON.stringify(t,r)!==JSON.stringify(e,r)}function sT(t,e,n){return t.options.clip?t[n]:e[n]}function ITe(t,e){const{xScale:n,yScale:r}=t;return n&&r?{left:sT(n,e,"left"),right:sT(n,e,"right"),top:sT(r,e,"top"),bottom:sT(r,e,"bottom")}:e}function zJ(t,e){const n=e._clip;if(n.disabled)return!1;const r=ITe(e,t.chartArea);return{left:n.left===!1?0:r.left-(n.left===!0?0:n.left),right:n.right===!1?t.width:r.right+(n.right===!0?0:n.right),top:n.top===!1?0:r.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?t.height:r.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class ATe{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,n,r,i){const l=n.listeners[i],u=n.duration;l.forEach(s=>s({chart:e,initial:n.initial,numSteps:u,currentStep:Math.min(r-n.start,u)}))}_refresh(){this._request||(this._running=!0,this._request=wJ.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let n=0;this._charts.forEach((r,i)=>{if(!r.running||!r.items.length)return;const l=r.items;let u=l.length-1,s=!1,v;for(;u>=0;--u)v=l[u],v._active?(v._total>r.duration&&(r.duration=v._total),v.tick(e),s=!0):(l[u]=l[l.length-1],l.pop());s&&(i.draw(),this._notify(i,r,e,"progress")),l.length||(r.running=!1,this._notify(i,r,e,"complete"),r.initial=!1),n+=l.length}),this._lastDate=e,n===0&&(this._running=!1)}_getAnims(e){const n=this._charts;let r=n.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(e,r)),r}listen(e,n,r){this._getAnims(e).listeners[n].push(r)}add(e,n){!n||!n.length||this._getAnims(e).items.push(...n)}has(e){return this._getAnims(e).items.length>0}start(e){const n=this._charts.get(e);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((r,i)=>Math.max(r,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const n=this._charts.get(e);return!(!n||!n.running||!n.items.length)}stop(e){const n=this._charts.get(e);if(!n||!n.items.length)return;const r=n.items;let i=r.length-1;for(;i>=0;--i)r[i].cancel();n.items=[],this._notify(e,n,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var rf=new ATe;const G7="transparent",RTe={boolean(t,e,n){return n>.5?e:t},color(t,e,n){const r=L7(t||G7),i=r.valid&&L7(e||G7);return i&&i.valid?i.mix(r,n).hexString():e},number(t,e,n){return t+(e-t)*n}};class MTe{constructor(e,n,r,i){const l=n[r];i=nT([e.to,i,l,e.from]);const u=nT([e.from,l,i]);this._active=!0,this._fn=e.fn||RTe[e.type||typeof u],this._easing=Fb[e.easing]||Fb.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=r,this._from=u,this._to=i,this._promises=void 0}active(){return this._active}update(e,n,r){if(this._active){this._notify(!1);const i=this._target[this._prop],l=r-this._start,u=this._duration-l;this._start=r,this._duration=Math.floor(Math.max(u,e.duration)),this._total+=l,this._loop=!!e.loop,this._to=nT([e.to,n,i,e.from]),this._from=nT([e.from,i,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const n=e-this._start,r=this._duration,i=this._prop,l=this._from,u=this._loop,s=this._to;let v;if(this._active=l!==s&&(u||n<r),!this._active){this._target[i]=s,this._notify(!0);return}if(n<0){this._target[i]=l;return}v=n/r%2,v=u&&v>1?2-v:v,v=this._easing(Math.min(1,Math.max(0,v))),this._target[i]=this._fn(l,s,v)}wait(){const e=this._promises||(this._promises=[]);return new Promise((n,r)=>{e.push({res:n,rej:r})})}_notify(e){const n=e?"res":"rej",r=this._promises||[];for(let i=0;i<r.length;i++)r[i][n]()}}class jJ{constructor(e,n){this._chart=e,this._properties=new Map,this.configure(n)}configure(e){if(!gs(e))return;const n=Object.keys(ga.animation),r=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const l=e[i];if(!gs(l))return;const u={};for(const s of n)u[s]=l[s];(La(l.properties)&&l.properties||[i]).forEach(s=>{(s===i||!r.has(s))&&r.set(s,u)})})}_animateOptions(e,n){const r=n.options,i=DTe(e,r);if(!i)return[];const l=this._createAnimations(i,r);return r.$shared&&PTe(e.options.$animations,r).then(()=>{e.options=r},()=>{}),l}_createAnimations(e,n){const r=this._properties,i=[],l=e.$animations||(e.$animations={}),u=Object.keys(n),s=Date.now();let v;for(v=u.length-1;v>=0;--v){const w=u[v];if(w.charAt(0)==="$")continue;if(w==="options"){i.push(...this._animateOptions(e,n));continue}const A=n[w];let F=l[w];const W=r.get(w);if(F)if(W&&F.active()){F.update(W,A,s);continue}else F.cancel();if(!W||!W.duration){e[w]=A;continue}l[w]=F=new MTe(W,e,w,A),i.push(F)}return i}update(e,n){if(this._properties.size===0){Object.assign(e,n);return}const r=this._createAnimations(e,n);if(r.length)return rf.add(this._chart,r),!0}}function PTe(t,e){const n=[],r=Object.keys(e);for(let i=0;i<r.length;i++){const l=t[r[i]];l&&l.active()&&n.push(l.wait())}return Promise.all(n)}function DTe(t,e){if(!e)return;let n=t.options;if(!n){t.options=e;return}return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function Y7(t,e){const n=t&&t.options||{},r=n.reverse,i=n.min===void 0?e:0,l=n.max===void 0?e:0;return{start:r?l:i,end:r?i:l}}function kTe(t,e,n){if(n===!1)return!1;const r=Y7(t,n),i=Y7(e,n);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}function NTe(t){let e,n,r,i;return gs(t)?(e=t.top,n=t.right,r=t.bottom,i=t.left):e=n=r=i=t,{top:e,right:n,bottom:r,left:i,disabled:t===!1}}function VJ(t,e){const n=[],r=t._getSortedDatasetMetas(e);let i,l;for(i=0,l=r.length;i<l;++i)n.push(r[i].index);return n}function X7(t,e,n,r={}){const i=t.keys,l=r.mode==="single";let u,s,v,w;if(e===null)return;let A=!1;for(u=0,s=i.length;u<s;++u){if(v=+i[u],v===n){if(A=!0,r.all)continue;break}w=t.values[v],rc(w)&&(l||e===0||Rd(e)===Rd(w))&&(e+=w)}return!A&&!r.all?0:e}function OTe(t,e){const{iScale:n,vScale:r}=e,i=n.axis==="x"?"x":"y",l=r.axis==="x"?"x":"y",u=Object.keys(t),s=new Array(u.length);let v,w,A;for(v=0,w=u.length;v<w;++v)A=u[v],s[v]={[i]:A,[l]:t[A]};return s}function QD(t,e){const n=t&&t.options.stacked;return n||n===void 0&&e.stack!==void 0}function LTe(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}function FTe(t){const{min:e,max:n,minDefined:r,maxDefined:i}=t.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?n:Number.POSITIVE_INFINITY}}function BTe(t,e,n){const r=t[e]||(t[e]={});return r[n]||(r[n]={})}function K7(t,e,n,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const l=t[i.index];if(n&&l>0||!n&&l<0)return i.index}return null}function Z7(t,e){const{chart:n,_cachedMeta:r}=t,i=n._stacks||(n._stacks={}),{iScale:l,vScale:u,index:s}=r,v=l.axis,w=u.axis,A=LTe(l,u,r),F=e.length;let W;for(let K=0;K<F;++K){const Q=e[K],{[v]:Z,[w]:oe}=Q,ae=Q._stacks||(Q._stacks={});W=ae[w]=BTe(i,A,Z),W[s]=oe,W._top=K7(W,u,!0,r.type),W._bottom=K7(W,u,!1,r.type);const me=W._visualValues||(W._visualValues={});me[s]=oe}}function JD(t,e){const n=t.scales;return Object.keys(n).filter(r=>n[r].axis===e).shift()}function zTe(t,e){return P_(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function jTe(t,e,n){return P_(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}function Ov(t,e){const n=t.controller.index,r=t.vScale&&t.vScale.axis;if(r){e=e||t._parsed;for(const i of e){const l=i._stacks;if(!l||l[r]===void 0||l[r][n]===void 0)return;delete l[r][n],l[r]._visualValues!==void 0&&l[r]._visualValues[n]!==void 0&&delete l[r]._visualValues[n]}}}const e3=t=>t==="reset"||t==="none",Q7=(t,e)=>e?t:Object.assign({},t),VTe=(t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:VJ(n,!0),values:null};class nF{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,n){this.chart=e,this._ctx=e.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=QD(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&Ov(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,n=this._cachedMeta,r=this.getDataset(),i=(F,W,K,Q)=>F==="x"?W:F==="r"?Q:K,l=n.xAxisID=hs(r.xAxisID,JD(e,"x")),u=n.yAxisID=hs(r.yAxisID,JD(e,"y")),s=n.rAxisID=hs(r.rAxisID,JD(e,"r")),v=n.indexAxis,w=n.iAxisID=i(v,l,u,s),A=n.vAxisID=i(v,u,l,s);n.xScale=this.getScaleForId(l),n.yScale=this.getScaleForId(u),n.rScale=this.getScaleForId(s),n.iScale=this.getScaleForId(w),n.vScale=this.getScaleForId(A)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const n=this._cachedMeta;return e===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&k7(this._data,this),e._stacked&&Ov(e)}_dataCheck(){const e=this.getDataset(),n=e.data||(e.data=[]),r=this._data;if(gs(n)){const i=this._cachedMeta;this._data=OTe(n,i)}else if(r!==n){if(r){k7(r,this);const i=this._cachedMeta;Ov(i),i._parsed=[]}n&&Object.isExtensible(n)&&ESe(n,this),this._syncList=[],this._data=n}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const n=this._cachedMeta,r=this.getDataset();let i=!1;this._dataCheck();const l=n._stacked;n._stacked=QD(n.vScale,n),n.stack!==r.stack&&(i=!0,Ov(n),n.stack=r.stack),this._resyncElements(e),(i||l!==n._stacked)&&(Z7(this,n._parsed),n._stacked=QD(n.vScale,n))}configure(){const e=this.chart.config,n=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),n,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,n){const{_cachedMeta:r,_data:i}=this,{iScale:l,_stacked:u}=r,s=l.axis;let v=e===0&&n===i.length?!0:r._sorted,w=e>0&&r._parsed[e-1],A,F,W;if(this._parsing===!1)r._parsed=i,r._sorted=!0,W=i;else{La(i[e])?W=this.parseArrayData(r,i,e,n):gs(i[e])?W=this.parseObjectData(r,i,e,n):W=this.parsePrimitiveData(r,i,e,n);const K=()=>F[s]===null||w&&F[s]<w[s];for(A=0;A<n;++A)r._parsed[A+e]=F=W[A],v&&(K()&&(v=!1),w=F);r._sorted=v}u&&Z7(this,W)}parsePrimitiveData(e,n,r,i){const{iScale:l,vScale:u}=e,s=l.axis,v=u.axis,w=l.getLabels(),A=l===u,F=new Array(i);let W,K,Q;for(W=0,K=i;W<K;++W)Q=W+r,F[W]={[s]:A||l.parse(w[Q],Q),[v]:u.parse(n[Q],Q)};return F}parseArrayData(e,n,r,i){const{xScale:l,yScale:u}=e,s=new Array(i);let v,w,A,F;for(v=0,w=i;v<w;++v)A=v+r,F=n[A],s[v]={x:l.parse(F[0],A),y:u.parse(F[1],A)};return s}parseObjectData(e,n,r,i){const{xScale:l,yScale:u}=e,{xAxisKey:s="x",yAxisKey:v="y"}=this._parsing,w=new Array(i);let A,F,W,K;for(A=0,F=i;A<F;++A)W=A+r,K=n[W],w[A]={x:l.parse(rx(K,s),W),y:u.parse(rx(K,v),W)};return w}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,n,r){const i=this.chart,l=this._cachedMeta,u=n[e.axis],s={keys:VJ(i,!0),values:n._stacks[e.axis]._visualValues};return X7(s,u,l.index,{mode:r})}updateRangeFromParsed(e,n,r,i){const l=r[n.axis];let u=l===null?NaN:l;const s=i&&r._stacks[n.axis];i&&s&&(i.values=s,u=X7(i,l,this._cachedMeta.index)),e.min=Math.min(e.min,u),e.max=Math.max(e.max,u)}getMinMax(e,n){const r=this._cachedMeta,i=r._parsed,l=r._sorted&&e===r.iScale,u=i.length,s=this._getOtherScale(e),v=VTe(n,r,this.chart),w={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:A,max:F}=FTe(s);let W,K;function Q(){K=i[W];const Z=K[s.axis];return!rc(K[e.axis])||A>Z||F<Z}for(W=0;W<u&&!(!Q()&&(this.updateRangeFromParsed(w,e,K,v),l));++W);if(l){for(W=u-1;W>=0;--W)if(!Q()){this.updateRangeFromParsed(w,e,K,v);break}}return w}getAllParsedValues(e){const n=this._cachedMeta._parsed,r=[];let i,l,u;for(i=0,l=n.length;i<l;++i)u=n[i][e.axis],rc(u)&&r.push(u);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const n=this._cachedMeta,r=n.iScale,i=n.vScale,l=this.getParsed(e);return{label:r?""+r.getLabelForValue(l[r.axis]):"",value:i?""+i.getLabelForValue(l[i.axis]):""}}_update(e){const n=this._cachedMeta;this.update(e||"default"),n._clip=NTe(hs(this.options.clip,kTe(n.xScale,n.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,n=this.chart,r=this._cachedMeta,i=r.data||[],l=n.chartArea,u=[],s=this._drawStart||0,v=this._drawCount||i.length-s,w=this.options.drawActiveElementsOnTop;let A;for(r.dataset&&r.dataset.draw(e,l,s,v),A=s;A<s+v;++A){const F=i[A];F.hidden||(F.active&&w?u.push(F):F.draw(e,l))}for(A=0;A<u.length;++A)u[A].draw(e,l)}getStyle(e,n){const r=n?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,n,r){const i=this.getDataset();let l;if(e>=0&&e<this._cachedMeta.data.length){const u=this._cachedMeta.data[e];l=u.$context||(u.$context=jTe(this.getContext(),e,u)),l.parsed=this.getParsed(e),l.raw=i.data[e],l.index=l.dataIndex=e}else l=this.$context||(this.$context=zTe(this.chart.getContext(),this.index)),l.dataset=i,l.index=l.datasetIndex=this.index;return l.active=!!n,l.mode=r,l}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,n){return this._resolveElementOptions(this.dataElementType.id,n,e)}_resolveElementOptions(e,n="default",r){const i=n==="active",l=this._cachedDataOpts,u=e+"-"+n,s=l[u],v=this.enableOptionSharing&&Mw(r);if(s)return Q7(s,v);const w=this.chart.config,A=w.datasetElementScopeKeys(this._type,e),F=i?[`${e}Hover`,"hover",e,""]:[e,""],W=w.getOptionScopes(this.getDataset(),A),K=Object.keys(ga.elements[e]),Q=()=>this.getContext(r,i,n),Z=w.resolveNamedOptions(W,K,Q,F);return Z.$shared&&(Z.$shared=v,l[u]=Object.freeze(Q7(Z,v))),Z}_resolveAnimations(e,n,r){const i=this.chart,l=this._cachedDataOpts,u=`animation-${n}`,s=l[u];if(s)return s;let v;if(i.options.animation!==!1){const A=this.chart.config,F=A.datasetAnimationScopeKeys(this._type,n),W=A.getOptionScopes(this.getDataset(),F);v=A.createResolver(W,this.getContext(e,r,n))}const w=new jJ(i,v&&v.animations);return v&&v._cacheable&&(l[u]=Object.freeze(w)),w}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,n){return!n||e3(e)||this.chart._animationsDisabled}_getSharedOptions(e,n){const r=this.resolveDataElementOptions(e,n),i=this._sharedOptions,l=this.getSharedOptions(r),u=this.includeOptions(n,l)||l!==i;return this.updateSharedOptions(l,n,r),{sharedOptions:l,includeOptions:u}}updateElement(e,n,r,i){e3(i)?Object.assign(e,r):this._resolveAnimations(n,i).update(e,r)}updateSharedOptions(e,n,r){e&&!e3(n)&&this._resolveAnimations(void 0,n).update(e,r)}_setStyle(e,n,r,i){e.active=i;const l=this.getStyle(n,i);this._resolveAnimations(n,r,i).update(e,{options:!i&&this.getSharedOptions(l)||l})}removeHoverStyle(e,n,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,n,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const n=this._data,r=this._cachedMeta.data;for(const[s,v,w]of this._syncList)this[s](v,w);this._syncList=[];const i=r.length,l=n.length,u=Math.min(l,i);u&&this.parse(0,u),l>i?this._insertElements(i,l-i,e):l<i&&this._removeElements(l,i-l)}_insertElements(e,n,r=!0){const i=this._cachedMeta,l=i.data,u=e+n;let s;const v=w=>{for(w.length+=n,s=w.length-1;s>=u;s--)w[s]=w[s-n]};for(v(l),s=e;s<u;++s)l[s]=new this.dataElementType;this._parsing&&v(i._parsed),this.parse(e,n),r&&this.updateElements(l,e,n,"reset")}updateElements(e,n,r,i){}_removeElements(e,n){const r=this._cachedMeta;if(this._parsing){const i=r._parsed.splice(e,n);r._stacked&&Ov(r,i)}r.data.splice(e,n)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[n,r,i]=e;this[n](r,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,n){n&&this._sync(["_removeElements",e,n]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function UTe(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let r=[];for(let i=0,l=n.length;i<l;i++)r=r.concat(n[i].controller.getAllParsedValues(t));t._cache.$bar=bJ(r.sort((i,l)=>i-l))}return t._cache.$bar}function HTe(t){const e=t.iScale,n=UTe(e,t.type);let r=e._length,i,l,u,s;const v=()=>{u===32767||u===-32768||(Mw(s)&&(r=Math.min(r,Math.abs(u-s)||r)),s=u)};for(i=0,l=n.length;i<l;++i)u=e.getPixelForValue(n[i]),v();for(s=void 0,i=0,l=e.ticks.length;i<l;++i)u=e.getPixelForTick(i),v();return r}function WTe(t,e,n,r){const i=n.barThickness;let l,u;return Hs(i)?(l=e.min*n.categoryPercentage,u=n.barPercentage):(l=i*r,u=1),{chunk:l/r,ratio:u,start:e.pixels[t]-l/2}}function $Te(t,e,n,r){const i=e.pixels,l=i[t];let u=t>0?i[t-1]:null,s=t<i.length-1?i[t+1]:null;const v=n.categoryPercentage;u===null&&(u=l-(s===null?e.end-e.start:s-l)),s===null&&(s=l+l-u);const w=l-(l-Math.min(u,s))/2*v;return{chunk:Math.abs(s-u)/2*v/r,ratio:n.barPercentage,start:w}}function qTe(t,e,n,r){const i=n.parse(t[0],r),l=n.parse(t[1],r),u=Math.min(i,l),s=Math.max(i,l);let v=u,w=s;Math.abs(u)>Math.abs(s)&&(v=s,w=u),e[n.axis]=w,e._custom={barStart:v,barEnd:w,start:i,end:l,min:u,max:s}}function UJ(t,e,n,r){return La(t)?qTe(t,e,n,r):e[n.axis]=n.parse(t,r),e}function J7(t,e,n,r){const i=t.iScale,l=t.vScale,u=i.getLabels(),s=i===l,v=[];let w,A,F,W;for(w=n,A=n+r;w<A;++w)W=e[w],F={},F[i.axis]=s||i.parse(u[w],w),v.push(UJ(W,F,l,w));return v}function t3(t){return t&&t.barStart!==void 0&&t.barEnd!==void 0}function GTe(t,e,n){return t!==0?Rd(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}function YTe(t){let e,n,r,i,l;return t.horizontal?(e=t.base>t.x,n="left",r="right"):(e=t.base<t.y,n="bottom",r="top"),e?(i="end",l="start"):(i="start",l="end"),{start:n,end:r,reverse:e,top:i,bottom:l}}function XTe(t,e,n,r){let i=e.borderSkipped;const l={};if(!i){t.borderSkipped=l;return}if(i===!0){t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:u,end:s,reverse:v,top:w,bottom:A}=YTe(t);i==="middle"&&n&&(t.enableBorderRadius=!0,(n._top||0)===r?i=w:(n._bottom||0)===r?i=A:(l[e9(A,u,s,v)]=!0,i=w)),l[e9(i,u,s,v)]=!0,t.borderSkipped=l}function e9(t,e,n,r){return r?(t=KTe(t,e,n),t=t9(t,n,e)):t=t9(t,e,n),t}function KTe(t,e,n){return t===e?n:t===n?e:t}function t9(t,e,n){return t==="start"?e:t==="end"?n:t}function ZTe(t,{inflateAmount:e},n){t.inflateAmount=e==="auto"?n===1?.33:0:e}class QTe extends nF{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,n,r,i){return J7(e,n,r,i)}parseArrayData(e,n,r,i){return J7(e,n,r,i)}parseObjectData(e,n,r,i){const{iScale:l,vScale:u}=e,{xAxisKey:s="x",yAxisKey:v="y"}=this._parsing,w=l.axis==="x"?s:v,A=u.axis==="x"?s:v,F=[];let W,K,Q,Z;for(W=r,K=r+i;W<K;++W)Z=n[W],Q={},Q[l.axis]=l.parse(rx(Z,w),W),F.push(UJ(rx(Z,A),Q,u,W));return F}updateRangeFromParsed(e,n,r,i){super.updateRangeFromParsed(e,n,r,i);const l=r._custom;l&&n===this._cachedMeta.vScale&&(e.min=Math.min(e.min,l.min),e.max=Math.max(e.max,l.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const n=this._cachedMeta,{iScale:r,vScale:i}=n,l=this.getParsed(e),u=l._custom,s=t3(u)?"["+u.start+", "+u.end+"]":""+i.getLabelForValue(l[i.axis]);return{label:""+r.getLabelForValue(l[r.axis]),value:s}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,e)}updateElements(e,n,r,i){const l=i==="reset",{index:u,_cachedMeta:{vScale:s}}=this,v=s.getBasePixel(),w=s.isHorizontal(),A=this._getRuler(),{sharedOptions:F,includeOptions:W}=this._getSharedOptions(n,i);for(let K=n;K<n+r;K++){const Q=this.getParsed(K),Z=l||Hs(Q[s.axis])?{base:v,head:v}:this._calculateBarValuePixels(K),oe=this._calculateBarIndexPixels(K,A),ae=(Q._stacks||{})[s.axis],me={horizontal:w,base:Z.base,enableBorderRadius:!ae||t3(Q._custom)||u===ae._top||u===ae._bottom,x:w?Z.head:oe.center,y:w?oe.center:Z.head,height:w?oe.size:Math.abs(Z.size),width:w?Math.abs(Z.size):oe.size};W&&(me.options=F||this.resolveDataElementOptions(K,e[K].active?"active":i));const pe=me.options||e[K].options;XTe(me,pe,ae,u),ZTe(me,pe,A.ratio),this.updateElement(e[K],K,me,i)}}_getStacks(e,n){const{iScale:r}=this._cachedMeta,i=r.getMatchingVisibleMetas(this._type).filter(A=>A.controller.options.grouped),l=r.options.stacked,u=[],s=this._cachedMeta.controller.getParsed(n),v=s&&s[r.axis],w=A=>{const F=A._parsed.find(K=>K[r.axis]===v),W=F&&F[A.vScale.axis];if(Hs(W)||isNaN(W))return!0};for(const A of i)if(!(n!==void 0&&w(A))&&((l===!1||u.indexOf(A.stack)===-1||l===void 0&&A.stack===void 0)&&u.push(A.stack),A.index===e))break;return u.length||u.push(void 0),u}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,n,r){const i=this._getStacks(e,r),l=n!==void 0?i.indexOf(n):-1;return l===-1?i.length-1:l}_getRuler(){const e=this.options,n=this._cachedMeta,r=n.iScale,i=[];let l,u;for(l=0,u=n.data.length;l<u;++l)i.push(r.getPixelForValue(this.getParsed(l)[r.axis],l));const s=e.barThickness;return{min:s||HTe(n),pixels:i,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:e.grouped,ratio:s?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:n,_stacked:r,index:i},options:{base:l,minBarLength:u}}=this,s=l||0,v=this.getParsed(e),w=v._custom,A=t3(w);let F=v[n.axis],W=0,K=r?this.applyStack(n,v,r):F,Q,Z;K!==F&&(W=K-F,K=F),A&&(F=w.barStart,K=w.barEnd-w.barStart,F!==0&&Rd(F)!==Rd(w.barEnd)&&(W=0),W+=F);const oe=!Hs(l)&&!A?l:W;let ae=n.getPixelForValue(oe);if(this.chart.getDataVisibility(e)?Q=n.getPixelForValue(W+K):Q=ae,Z=Q-ae,Math.abs(Z)<u){Z=GTe(Z,n,s)*u,F===s&&(ae-=Z/2);const me=n.getPixelForDecimal(0),pe=n.getPixelForDecimal(1),_e=Math.min(me,pe),De=Math.max(me,pe);ae=Math.max(Math.min(ae,De),_e),Q=ae+Z,r&&!A&&(v._stacks[n.axis]._visualValues[i]=n.getValueForPixel(Q)-n.getValueForPixel(ae))}if(ae===n.getPixelForValue(s)){const me=Rd(Z)*n.getLineWidthForValue(s)/2;ae+=me,Z-=me}return{size:Z,base:ae,head:Q,center:Q+Z/2}}_calculateBarIndexPixels(e,n){const r=n.scale,i=this.options,l=i.skipNull,u=hs(i.maxBarThickness,1/0);let s,v;if(n.grouped){const w=l?this._getStackCount(e):n.stackCount,A=i.barThickness==="flex"?$Te(e,n,i,w):WTe(e,n,i,w),F=this._getStackIndex(this.index,this._cachedMeta.stack,l?e:void 0);s=A.start+A.chunk*F+A.chunk/2,v=Math.min(u,A.chunk*A.ratio)}else s=r.getPixelForValue(this.getParsed(e)[r.axis],e),v=Math.min(u,n.min*n.ratio);return{base:s-v/2,head:s+v/2,center:s,size:v}}draw(){const e=this._cachedMeta,n=e.vScale,r=e.data,i=r.length;let l=0;for(;l<i;++l)this.getParsed(l)[n.axis]!==null&&!r[l].hidden&&r[l].draw(this._ctx)}}class JTe extends nF{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const n=this._cachedMeta,{dataset:r,data:i=[],_dataset:l}=n,u=this.chart._animationsDisabled;let{start:s,count:v}=CSe(n,i,u);this._drawStart=s,this._drawCount=v,ISe(n)&&(s=0,v=i.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!l._decimated,r.points=i;const w=this.resolveDatasetElementOptions(e);this.options.showLine||(w.borderWidth=0),w.segment=this.options.segment,this.updateElement(r,void 0,{animated:!u,options:w},e),this.updateElements(i,s,v,e)}updateElements(e,n,r,i){const l=i==="reset",{iScale:u,vScale:s,_stacked:v,_dataset:w}=this._cachedMeta,{sharedOptions:A,includeOptions:F}=this._getSharedOptions(n,i),W=u.axis,K=s.axis,{spanGaps:Q,segment:Z}=this.options,oe=Pw(Q)?Q:Number.POSITIVE_INFINITY,ae=this.chart._animationsDisabled||l||i==="none",me=n+r,pe=e.length;let _e=n>0&&this.getParsed(n-1);for(let De=0;De<pe;++De){const Ae=e[De],re=ae?Ae:{};if(De<n||De>=me){re.skip=!0;continue}const fe=this.getParsed(De),ye=Hs(fe[K]),ue=re[W]=u.getPixelForValue(fe[W],De),Ie=re[K]=l||ye?s.getBasePixel():s.getPixelForValue(v?this.applyStack(s,fe,v):fe[K],De);re.skip=isNaN(ue)||isNaN(Ie)||ye,re.stop=De>0&&Math.abs(fe[W]-_e[W])>oe,Z&&(re.parsed=fe,re.raw=w.data[De]),F&&(re.options=A||this.resolveDataElementOptions(De,Ae.active?"active":i)),ae||this.updateElement(Ae,De,re,i),_e=fe}}getMaxOverflow(){const e=this._cachedMeta,n=e.dataset,r=n.options&&n.options.borderWidth||0,i=e.data||[];if(!i.length)return r;const l=i[0].size(this.resolveDataElementOptions(0)),u=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(r,l,u)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}function Cg(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class rF{static override(e){Object.assign(rF.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return Cg()}parse(){return Cg()}format(){return Cg()}add(){return Cg()}diff(){return Cg()}startOf(){return Cg()}endOf(){return Cg()}}var eCe={_date:rF};function tCe(t,e,n,r){const{controller:i,data:l,_sorted:u}=t,s=i._cachedMeta.iScale,v=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(s&&e===s.axis&&e!=="r"&&u&&l.length){const w=s._reversePixels?bSe:$g;if(r){if(i._sharedOptions){const A=l[0],F=typeof A.getRange=="function"&&A.getRange(e);if(F){const W=w(l,e,n-F),K=w(l,e,n+F);return{lo:W.lo,hi:K.hi}}}}else{const A=w(l,e,n);if(v){const{vScale:F}=i._cachedMeta,{_parsed:W}=t,K=W.slice(0,A.lo+1).reverse().findIndex(Z=>!Hs(Z[F.axis]));A.lo-=Math.max(0,K);const Q=W.slice(A.hi).findIndex(Z=>!Hs(Z[F.axis]));A.hi+=Math.max(0,Q)}return A}}return{lo:0,hi:l.length-1}}function nR(t,e,n,r,i){const l=t.getSortedVisibleDatasetMetas(),u=n[e];for(let s=0,v=l.length;s<v;++s){const{index:w,data:A}=l[s],{lo:F,hi:W}=tCe(l[s],e,u,i);for(let K=F;K<=W;++K){const Q=A[K];Q.skip||r(Q,w,K)}}}function nCe(t){const e=t.indexOf("x")!==-1,n=t.indexOf("y")!==-1;return function(r,i){const l=e?Math.abs(r.x-i.x):0,u=n?Math.abs(r.y-i.y):0;return Math.sqrt(Math.pow(l,2)+Math.pow(u,2))}}function n3(t,e,n,r,i){const l=[];return!i&&!t.isPointInArea(e)||nR(t,n,e,function(s,v,w){!i&&!Dw(s,t.chartArea,0)||s.inRange(e.x,e.y,r)&&l.push({element:s,datasetIndex:v,index:w})},!0),l}function rCe(t,e,n,r){let i=[];function l(u,s,v){const{startAngle:w,endAngle:A}=u.getProps(["startAngle","endAngle"],r),{angle:F}=ySe(u,{x:e.x,y:e.y});xJ(F,w,A)&&i.push({element:u,datasetIndex:s,index:v})}return nR(t,n,e,l),i}function iCe(t,e,n,r,i,l){let u=[];const s=nCe(n);let v=Number.POSITIVE_INFINITY;function w(A,F,W){const K=A.inRange(e.x,e.y,i);if(r&&!K)return;const Q=A.getCenterPoint(i);if(!(!!l||t.isPointInArea(Q))&&!K)return;const oe=s(e,Q);oe<v?(u=[{element:A,datasetIndex:F,index:W}],v=oe):oe===v&&u.push({element:A,datasetIndex:F,index:W})}return nR(t,n,e,w),u}function r3(t,e,n,r,i,l){return!l&&!t.isPointInArea(e)?[]:n==="r"&&!r?rCe(t,e,n,i):iCe(t,e,n,r,i,l)}function n9(t,e,n,r,i){const l=[],u=n==="x"?"inXRange":"inYRange";let s=!1;return nR(t,n,e,(v,w,A)=>{v[u]&&v[u](e[n],i)&&(l.push({element:v,datasetIndex:w,index:A}),s=s||v.inRange(e.x,e.y,i))}),r&&!s?[]:l}var sCe={modes:{index(t,e,n,r){const i=kg(e,t),l=n.axis||"x",u=n.includeInvisible||!1,s=n.intersect?n3(t,i,l,r,u):r3(t,i,l,!1,r,u),v=[];return s.length?(t.getSortedVisibleDatasetMetas().forEach(w=>{const A=s[0].index,F=w.data[A];F&&!F.skip&&v.push({element:F,datasetIndex:w.index,index:A})}),v):[]},dataset(t,e,n,r){const i=kg(e,t),l=n.axis||"xy",u=n.includeInvisible||!1;let s=n.intersect?n3(t,i,l,r,u):r3(t,i,l,!1,r,u);if(s.length>0){const v=s[0].datasetIndex,w=t.getDatasetMeta(v).data;s=[];for(let A=0;A<w.length;++A)s.push({element:w[A],datasetIndex:v,index:A})}return s},point(t,e,n,r){const i=kg(e,t),l=n.axis||"xy",u=n.includeInvisible||!1;return n3(t,i,l,r,u)},nearest(t,e,n,r){const i=kg(e,t),l=n.axis||"xy",u=n.includeInvisible||!1;return r3(t,i,l,n.intersect,r,u)},x(t,e,n,r){const i=kg(e,t);return n9(t,i,"x",n.intersect,r)},y(t,e,n,r){const i=kg(e,t);return n9(t,i,"y",n.intersect,r)}}};const HJ=["left","top","right","bottom"];function Lv(t,e){return t.filter(n=>n.pos===e)}function r9(t,e){return t.filter(n=>HJ.indexOf(n.pos)===-1&&n.box.axis===e)}function Fv(t,e){return t.sort((n,r)=>{const i=e?r:n,l=e?n:r;return i.weight===l.weight?i.index-l.index:i.weight-l.weight})}function oCe(t){const e=[];let n,r,i,l,u,s;for(n=0,r=(t||[]).length;n<r;++n)i=t[n],{position:l,options:{stack:u,stackWeight:s=1}}=i,e.push({index:n,box:i,pos:l,horizontal:i.isHorizontal(),weight:i.weight,stack:u&&l+u,stackWeight:s});return e}function aCe(t){const e={};for(const n of t){const{stack:r,pos:i,stackWeight:l}=n;if(!r||!HJ.includes(i))continue;const u=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});u.count++,u.weight+=l}return e}function lCe(t,e){const n=aCe(t),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let l,u,s;for(l=0,u=t.length;l<u;++l){s=t[l];const{fullSize:v}=s.box,w=n[s.stack],A=w&&s.stackWeight/w.weight;s.horizontal?(s.width=A?A*r:v&&e.availableWidth,s.height=i):(s.width=r,s.height=A?A*i:v&&e.availableHeight)}return n}function cCe(t){const e=oCe(t),n=Fv(e.filter(w=>w.box.fullSize),!0),r=Fv(Lv(e,"left"),!0),i=Fv(Lv(e,"right")),l=Fv(Lv(e,"top"),!0),u=Fv(Lv(e,"bottom")),s=r9(e,"x"),v=r9(e,"y");return{fullSize:n,leftAndTop:r.concat(l),rightAndBottom:i.concat(v).concat(u).concat(s),chartArea:Lv(e,"chartArea"),vertical:r.concat(i).concat(v),horizontal:l.concat(u).concat(s)}}function i9(t,e,n,r){return Math.max(t[n],e[n])+Math.max(t[r],e[r])}function WJ(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function uCe(t,e,n,r){const{pos:i,box:l}=n,u=t.maxPadding;if(!gs(i)){n.size&&(t[i]-=n.size);const F=r[n.stack]||{size:0,count:1};F.size=Math.max(F.size,n.horizontal?l.height:l.width),n.size=F.size/F.count,t[i]+=n.size}l.getPadding&&WJ(u,l.getPadding());const s=Math.max(0,e.outerWidth-i9(u,t,"left","right")),v=Math.max(0,e.outerHeight-i9(u,t,"top","bottom")),w=s!==t.w,A=v!==t.h;return t.w=s,t.h=v,n.horizontal?{same:w,other:A}:{same:A,other:w}}function hCe(t){const e=t.maxPadding;function n(r){const i=Math.max(e[r]-t[r],0);return t[r]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}function dCe(t,e){const n=e.maxPadding;function r(i){const l={left:0,top:0,right:0,bottom:0};return i.forEach(u=>{l[u]=Math.max(e[u],n[u])}),l}return r(t?["left","right"]:["top","bottom"])}function hb(t,e,n,r){const i=[];let l,u,s,v,w,A;for(l=0,u=t.length,w=0;l<u;++l){s=t[l],v=s.box,v.update(s.width||e.w,s.height||e.h,dCe(s.horizontal,e));const{same:F,other:W}=uCe(e,n,s,r);w|=F&&i.length,A=A||W,v.fullSize||i.push(s)}return w&&hb(i,e,n,r)||A}function oT(t,e,n,r,i){t.top=n,t.left=e,t.right=e+r,t.bottom=n+i,t.width=r,t.height=i}function s9(t,e,n,r){const i=n.padding;let{x:l,y:u}=e;for(const s of t){const v=s.box,w=r[s.stack]||{placed:0,weight:1},A=s.stackWeight/w.weight||1;if(s.horizontal){const F=e.w*A,W=w.size||v.height;Mw(w.start)&&(u=w.start),v.fullSize?oT(v,i.left,u,n.outerWidth-i.right-i.left,W):oT(v,e.left+w.placed,u,F,W),w.start=u,w.placed+=F,u=v.bottom}else{const F=e.h*A,W=w.size||v.width;Mw(w.start)&&(l=w.start),v.fullSize?oT(v,l,i.top,W,n.outerHeight-i.bottom-i.top):oT(v,l,e.top+w.placed,W,F),w.start=l,w.placed+=F,l=v.right}}e.x=l,e.y=u}var Uu={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(n){e.draw(n)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;n!==-1&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,r){if(!t)return;const i=Xu(t.options.layout.padding),l=Math.max(e-i.width,0),u=Math.max(n-i.height,0),s=cCe(t.boxes),v=s.vertical,w=s.horizontal;Ks(t.boxes,Z=>{typeof Z.beforeLayout=="function"&&Z.beforeLayout()});const A=v.reduce((Z,oe)=>oe.box.options&&oe.box.options.display===!1?Z:Z+1,0)||1,F=Object.freeze({outerWidth:e,outerHeight:n,padding:i,availableWidth:l,availableHeight:u,vBoxMaxWidth:l/2/A,hBoxMaxHeight:u/2}),W=Object.assign({},i);WJ(W,Xu(r));const K=Object.assign({maxPadding:W,w:l,h:u,x:i.left,y:i.top},i),Q=lCe(v.concat(w),F);hb(s.fullSize,K,F,Q),hb(v,K,F,Q),hb(w,K,F,Q)&&hb(v,K,F,Q),hCe(K),s9(s.leftAndTop,K,F,Q),K.x+=K.w,K.y+=K.h,s9(s.rightAndBottom,K,F,Q),t.chartArea={left:K.left,top:K.top,right:K.left+K.w,bottom:K.top+K.h,height:K.h,width:K.w},Ks(s.chartArea,Z=>{const oe=Z.box;Object.assign(oe,t.chartArea),oe.update(K.w,K.h,{left:0,top:0,right:0,bottom:0})})}};class $J{acquireContext(e,n){}releaseContext(e){return!1}addEventListener(e,n,r){}removeEventListener(e,n,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,n,r,i){return n=Math.max(0,n||e.width),r=r||e.height,{width:n,height:Math.max(0,i?Math.floor(n/i):r)}}isAttached(e){return!0}updateConfig(e){}}class fCe extends $J{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const tC="$chartjs",pCe={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},o9=t=>t===null||t==="";function mCe(t,e){const n=t.style,r=t.getAttribute("height"),i=t.getAttribute("width");if(t[tC]={initial:{height:r,width:i,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",o9(i)){const l=H7(t,"width");l!==void 0&&(t.width=l)}if(o9(r))if(t.style.height==="")t.height=t.width/(e||2);else{const l=H7(t,"height");l!==void 0&&(t.height=l)}return t}const qJ=gTe?{passive:!0}:!1;function gCe(t,e,n){t&&t.addEventListener(e,n,qJ)}function _Ce(t,e,n){t&&t.canvas&&t.canvas.removeEventListener(e,n,qJ)}function yCe(t,e){const n=pCe[t.type]||t.type,{x:r,y:i}=kg(t,e);return{type:n,chart:e,native:t,x:r!==void 0?r:null,y:i!==void 0?i:null}}function wI(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function xCe(t,e,n){const r=t.canvas,i=new MutationObserver(l=>{let u=!1;for(const s of l)u=u||wI(s.addedNodes,r),u=u&&!wI(s.removedNodes,r);u&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}function vCe(t,e,n){const r=t.canvas,i=new MutationObserver(l=>{let u=!1;for(const s of l)u=u||wI(s.removedNodes,r),u=u&&!wI(s.addedNodes,r);u&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}const Nw=new Map;let a9=0;function GJ(){const t=window.devicePixelRatio;t!==a9&&(a9=t,Nw.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function bCe(t,e){Nw.size||window.addEventListener("resize",GJ),Nw.set(t,e)}function wCe(t){Nw.delete(t),Nw.size||window.removeEventListener("resize",GJ)}function ECe(t,e,n){const r=t.canvas,i=r&&tF(r);if(!i)return;const l=EJ((s,v)=>{const w=i.clientWidth;n(s,v),w<i.clientWidth&&n()},window),u=new ResizeObserver(s=>{const v=s[0],w=v.contentRect.width,A=v.contentRect.height;w===0&&A===0||l(w,A)});return u.observe(i),bCe(t,l),u}function i3(t,e,n){n&&n.disconnect(),e==="resize"&&wCe(t)}function SCe(t,e,n){const r=t.canvas,i=EJ(l=>{t.ctx!==null&&n(yCe(l,t))},t);return gCe(r,e,i),i}class TCe extends $J{acquireContext(e,n){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(mCe(e,n),r):null}releaseContext(e){const n=e.canvas;if(!n[tC])return!1;const r=n[tC].initial;["height","width"].forEach(l=>{const u=r[l];Hs(u)?n.removeAttribute(l):n.setAttribute(l,u)});const i=r.style||{};return Object.keys(i).forEach(l=>{n.style[l]=i[l]}),n.width=n.width,delete n[tC],!0}addEventListener(e,n,r){this.removeEventListener(e,n);const i=e.$proxies||(e.$proxies={}),u={attach:xCe,detach:vCe,resize:ECe}[n]||SCe;i[n]=u(e,n,r)}removeEventListener(e,n){const r=e.$proxies||(e.$proxies={}),i=r[n];if(!i)return;({attach:i3,detach:i3,resize:i3}[n]||_Ce)(e,n,i),r[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,n,r,i){return mTe(e,n,r,i)}isAttached(e){const n=e&&tF(e);return!!(n&&n.isConnected)}}function CCe(t){return!eF()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?fCe:TCe}let jm=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:n,y:r}=this.getProps(["x","y"],e);return{x:n,y:r}}hasValue(){return Pw(this.x)&&Pw(this.y)}getProps(e,n){const r=this.$animations;if(!n||!r)return this;const i={};return e.forEach(l=>{i[l]=r[l]&&r[l].active()?r[l]._to:this[l]}),i}};function ICe(t,e){const n=t.options.ticks,r=ACe(t),i=Math.min(n.maxTicksLimit||r,r),l=n.major.enabled?MCe(e):[],u=l.length,s=l[0],v=l[u-1],w=[];if(u>i)return PCe(e,w,l,u/i),w;const A=RCe(l,e,i);if(u>0){let F,W;const K=u>1?Math.round((v-s)/(u-1)):null;for(aT(e,w,A,Hs(K)?0:s-K,s),F=0,W=u-1;F<W;F++)aT(e,w,A,l[F],l[F+1]);return aT(e,w,A,v,Hs(K)?e.length:v+K),w}return aT(e,w,A),w}function ACe(t){const e=t.options.offset,n=t._tickSize(),r=t._length/n+(e?0:1),i=t._maxLength/n;return Math.floor(Math.min(r,i))}function RCe(t,e,n){const r=DCe(t),i=e.length/n;if(!r)return Math.max(i,1);const l=fSe(r);for(let u=0,s=l.length-1;u<s;u++){const v=l[u];if(v>i)return v}return Math.max(i,1)}function MCe(t){const e=[];let n,r;for(n=0,r=t.length;n<r;n++)t[n].major&&e.push(n);return e}function PCe(t,e,n,r){let i=0,l=n[0],u;for(r=Math.ceil(r),u=0;u<t.length;u++)u===l&&(e.push(t[u]),i++,l=n[i*r])}function aT(t,e,n,r,i){const l=hs(r,0),u=Math.min(hs(i,t.length),t.length);let s=0,v,w,A;for(n=Math.ceil(n),i&&(v=i-r,n=v/Math.floor(v/n)),A=l;A<0;)s++,A=Math.round(l+s*n);for(w=Math.max(l,0);w<u;w++)w===A&&(e.push(t[w]),s++,A=Math.round(l+s*n))}function DCe(t){const e=t.length;let n,r;if(e<2)return!1;for(r=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==r)return!1;return r}const kCe=t=>t==="left"?"right":t==="right"?"left":t,l9=(t,e,n)=>e==="top"||e==="left"?t[e]+n:t[e]-n,c9=(t,e)=>Math.min(e||t,t);function u9(t,e){const n=[],r=t.length/e,i=t.length;let l=0;for(;l<i;l+=r)n.push(t[Math.floor(l)]);return n}function NCe(t,e,n){const r=t.ticks.length,i=Math.min(e,r-1),l=t._startPixel,u=t._endPixel,s=1e-6;let v=t.getPixelForTick(i),w;if(!(n&&(r===1?w=Math.max(v-l,u-v):e===0?w=(t.getPixelForTick(1)-v)/2:w=(v-t.getPixelForTick(i-1))/2,v+=i<e?w:-w,v<l-s||v>u+s)))return v}function OCe(t,e){Ks(t,n=>{const r=n.gc,i=r.length/2;let l;if(i>e){for(l=0;l<i;++l)delete n.data[r[l]];r.splice(0,i)}})}function Bv(t){return t.drawTicks?t.tickLength:0}function h9(t,e){if(!t.display)return 0;const n=Jl(t.font,e),r=Xu(t.padding);return(La(t.text)?t.text.length:1)*n.lineHeight+r.height}function LCe(t,e){return P_(t,{scale:e,type:"scale"})}function FCe(t,e,n){return P_(t,{tick:n,index:e,type:"tick"})}function BCe(t,e,n){let r=X4(t);return(n&&e!=="right"||!n&&e==="right")&&(r=kCe(r)),r}function zCe(t,e,n,r){const{top:i,left:l,bottom:u,right:s,chart:v}=t,{chartArea:w,scales:A}=v;let F=0,W,K,Q;const Z=u-i,oe=s-l;if(t.isHorizontal()){if(K=Gl(r,l,s),gs(n)){const ae=Object.keys(n)[0],me=n[ae];Q=A[ae].getPixelForValue(me)+Z-e}else n==="center"?Q=(w.bottom+w.top)/2+Z-e:Q=l9(t,n,e);W=s-l}else{if(gs(n)){const ae=Object.keys(n)[0],me=n[ae];K=A[ae].getPixelForValue(me)-oe+e}else n==="center"?K=(w.left+w.right)/2-oe+e:K=l9(t,n,e);Q=Gl(r,u,i),F=n==="left"?-Ih:Ih}return{titleX:K,titleY:Q,maxWidth:W,rotation:F}}class kx extends jm{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,n){return e}getUserBounds(){let{_userMin:e,_userMax:n,_suggestedMin:r,_suggestedMax:i}=this;return e=ad(e,Number.POSITIVE_INFINITY),n=ad(n,Number.NEGATIVE_INFINITY),r=ad(r,Number.POSITIVE_INFINITY),i=ad(i,Number.NEGATIVE_INFINITY),{min:ad(e,r),max:ad(n,i),minDefined:rc(e),maxDefined:rc(n)}}getMinMax(e){let{min:n,max:r,minDefined:i,maxDefined:l}=this.getUserBounds(),u;if(i&&l)return{min:n,max:r};const s=this.getMatchingVisibleMetas();for(let v=0,w=s.length;v<w;++v)u=s[v].controller.getMinMax(this,e),i||(n=Math.min(n,u.min)),l||(r=Math.max(r,u.max));return n=l&&n>r?r:n,r=i&&n>r?n:r,{min:ad(n,ad(r,n)),max:ad(r,ad(n,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Co(this.options.beforeUpdate,[this])}update(e,n,r){const{beginAtZero:i,grace:l,ticks:u}=this.options,s=u.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=n,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=GSe(this,l,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const v=s<this.ticks.length;this._convertTicksToLabels(v?u9(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),u.display&&(u.autoSkip||u.source==="auto")&&(this.ticks=ICe(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),v&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,n,r;this.isHorizontal()?(n=this.left,r=this.right):(n=this.top,r=this.bottom,e=!e),this._startPixel=n,this._endPixel=r,this._reversePixels=e,this._length=r-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Co(this.options.afterUpdate,[this])}beforeSetDimensions(){Co(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Co(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Co(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Co(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const n=this.options.ticks;let r,i,l;for(r=0,i=e.length;r<i;r++)l=e[r],l.label=Co(n.callback,[l.value,r,e],this)}afterTickToLabelConversion(){Co(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Co(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,n=e.ticks,r=c9(this.ticks.length,e.ticks.maxTicksLimit),i=n.minRotation||0,l=n.maxRotation;let u=i,s,v,w;if(!this._isVisible()||!n.display||i>=l||r<=1||!this.isHorizontal()){this.labelRotation=i;return}const A=this._getLabelSizes(),F=A.widest.width,W=A.highest.height,K=fu(this.chart.width-F,0,this.maxWidth);s=e.offset?this.maxWidth/r:K/(r-1),F+6>s&&(s=K/(r-(e.offset?.5:1)),v=this.maxHeight-Bv(e.grid)-n.padding-h9(e.title,this.chart.options.font),w=Math.sqrt(F*F+W*W),u=_Se(Math.min(Math.asin(fu((A.highest.height+6)/s,-1,1)),Math.asin(fu(v/w,-1,1))-Math.asin(fu(W/w,-1,1)))),u=Math.max(i,Math.min(l,u))),this.labelRotation=u}afterCalculateLabelRotation(){Co(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Co(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:n,options:{ticks:r,title:i,grid:l}}=this,u=this._isVisible(),s=this.isHorizontal();if(u){const v=h9(i,n.options.font);if(s?(e.width=this.maxWidth,e.height=Bv(l)+v):(e.height=this.maxHeight,e.width=Bv(l)+v),r.display&&this.ticks.length){const{first:w,last:A,widest:F,highest:W}=this._getLabelSizes(),K=r.padding*2,Q=Wg(this.labelRotation),Z=Math.cos(Q),oe=Math.sin(Q);if(s){const ae=r.mirror?0:oe*F.width+Z*W.height;e.height=Math.min(this.maxHeight,e.height+ae+K)}else{const ae=r.mirror?0:Z*F.width+oe*W.height;e.width=Math.min(this.maxWidth,e.width+ae+K)}this._calculatePadding(w,A,oe,Z)}}this._handleMargins(),s?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,n,r,i){const{ticks:{align:l,padding:u},position:s}=this.options,v=this.labelRotation!==0,w=s!=="top"&&this.axis==="x";if(this.isHorizontal()){const A=this.getPixelForTick(0)-this.left,F=this.right-this.getPixelForTick(this.ticks.length-1);let W=0,K=0;v?w?(W=i*e.width,K=r*n.height):(W=r*e.height,K=i*n.width):l==="start"?K=n.width:l==="end"?W=e.width:l!=="inner"&&(W=e.width/2,K=n.width/2),this.paddingLeft=Math.max((W-A+u)*this.width/(this.width-A),0),this.paddingRight=Math.max((K-F+u)*this.width/(this.width-F),0)}else{let A=n.height/2,F=e.height/2;l==="start"?(A=0,F=e.height):l==="end"&&(A=n.height,F=0),this.paddingTop=A+u,this.paddingBottom=F+u}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Co(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:n}=this.options;return n==="top"||n==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let n,r;for(n=0,r=e.length;n<r;n++)Hs(e[n].label)&&(e.splice(n,1),r--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const n=this.options.ticks.sampleSize;let r=this.ticks;n<r.length&&(r=u9(r,n)),this._labelSizes=e=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,n,r){const{ctx:i,_longestTextCache:l}=this,u=[],s=[],v=Math.floor(n/c9(n,r));let w=0,A=0,F,W,K,Q,Z,oe,ae,me,pe,_e,De;for(F=0;F<n;F+=v){if(Q=e[F].label,Z=this._resolveTickFontOptions(F),i.font=oe=Z.string,ae=l[oe]=l[oe]||{data:{},gc:[]},me=Z.lineHeight,pe=_e=0,!Hs(Q)&&!La(Q))pe=B7(i,ae.data,ae.gc,pe,Q),_e=me;else if(La(Q))for(W=0,K=Q.length;W<K;++W)De=Q[W],!Hs(De)&&!La(De)&&(pe=B7(i,ae.data,ae.gc,pe,De),_e+=me);u.push(pe),s.push(_e),w=Math.max(pe,w),A=Math.max(_e,A)}OCe(l,n);const Ae=u.indexOf(w),re=s.indexOf(A),fe=ye=>({width:u[ye]||0,height:s[ye]||0});return{first:fe(0),last:fe(n-1),widest:fe(Ae),highest:fe(re),widths:u,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,n){return NaN}getValueForPixel(e){}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const n=this._startPixel+e*this._length;return vSe(this._alignToPixels?Tg(this.chart,n,0):n)}getDecimalForPixel(e){const n=(e-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:n}=this;return e<0&&n<0?n:e>0&&n>0?e:0}getContext(e){const n=this.ticks||[];if(e>=0&&e<n.length){const r=n[e];return r.$context||(r.$context=FCe(this.getContext(),e,r))}return this.$context||(this.$context=LCe(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,n=Wg(this.labelRotation),r=Math.abs(Math.cos(n)),i=Math.abs(Math.sin(n)),l=this._getLabelSizes(),u=e.autoSkipPadding||0,s=l?l.widest.width+u:0,v=l?l.highest.height+u:0;return this.isHorizontal()?v*r>s*i?s/r:v/i:v*i<s*r?v/r:s/i}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const n=this.axis,r=this.chart,i=this.options,{grid:l,position:u,border:s}=i,v=l.offset,w=this.isHorizontal(),F=this.ticks.length+(v?1:0),W=Bv(l),K=[],Q=s.setContext(this.getContext()),Z=Q.display?Q.width:0,oe=Z/2,ae=function(bt){return Tg(r,bt,Z)};let me,pe,_e,De,Ae,re,fe,ye,ue,Ie,Oe,ze;if(u==="top")me=ae(this.bottom),re=this.bottom-W,ye=me-oe,Ie=ae(e.top)+oe,ze=e.bottom;else if(u==="bottom")me=ae(this.top),Ie=e.top,ze=ae(e.bottom)-oe,re=me+oe,ye=this.top+W;else if(u==="left")me=ae(this.right),Ae=this.right-W,fe=me-oe,ue=ae(e.left)+oe,Oe=e.right;else if(u==="right")me=ae(this.left),ue=e.left,Oe=ae(e.right)-oe,Ae=me+oe,fe=this.left+W;else if(n==="x"){if(u==="center")me=ae((e.top+e.bottom)/2+.5);else if(gs(u)){const bt=Object.keys(u)[0],Nt=u[bt];me=ae(this.chart.scales[bt].getPixelForValue(Nt))}Ie=e.top,ze=e.bottom,re=me+oe,ye=re+W}else if(n==="y"){if(u==="center")me=ae((e.left+e.right)/2);else if(gs(u)){const bt=Object.keys(u)[0],Nt=u[bt];me=ae(this.chart.scales[bt].getPixelForValue(Nt))}Ae=me-oe,fe=Ae-W,ue=e.left,Oe=e.right}const ft=hs(i.ticks.maxTicksLimit,F),He=Math.max(1,Math.ceil(F/ft));for(pe=0;pe<F;pe+=He){const bt=this.getContext(pe),Nt=l.setContext(bt),wt=s.setContext(bt),it=Nt.lineWidth,nn=Nt.color,In=wt.dash||[],wn=wt.dashOffset,Xt=Nt.tickWidth,On=Nt.tickColor,cr=Nt.tickBorderDash||[],En=Nt.tickBorderDashOffset;_e=NCe(this,pe,v),_e!==void 0&&(De=Tg(r,_e,it),w?Ae=fe=ue=Oe=De:re=ye=Ie=ze=De,K.push({tx1:Ae,ty1:re,tx2:fe,ty2:ye,x1:ue,y1:Ie,x2:Oe,y2:ze,width:it,color:nn,borderDash:In,borderDashOffset:wn,tickWidth:Xt,tickColor:On,tickBorderDash:cr,tickBorderDashOffset:En}))}return this._ticksLength=F,this._borderValue=me,K}_computeLabelItems(e){const n=this.axis,r=this.options,{position:i,ticks:l}=r,u=this.isHorizontal(),s=this.ticks,{align:v,crossAlign:w,padding:A,mirror:F}=l,W=Bv(r.grid),K=W+A,Q=F?-A:K,Z=-Wg(this.labelRotation),oe=[];let ae,me,pe,_e,De,Ae,re,fe,ye,ue,Ie,Oe,ze="middle";if(i==="top")Ae=this.bottom-Q,re=this._getXAxisLabelAlignment();else if(i==="bottom")Ae=this.top+Q,re=this._getXAxisLabelAlignment();else if(i==="left"){const He=this._getYAxisLabelAlignment(W);re=He.textAlign,De=He.x}else if(i==="right"){const He=this._getYAxisLabelAlignment(W);re=He.textAlign,De=He.x}else if(n==="x"){if(i==="center")Ae=(e.top+e.bottom)/2+K;else if(gs(i)){const He=Object.keys(i)[0],bt=i[He];Ae=this.chart.scales[He].getPixelForValue(bt)+K}re=this._getXAxisLabelAlignment()}else if(n==="y"){if(i==="center")De=(e.left+e.right)/2-K;else if(gs(i)){const He=Object.keys(i)[0],bt=i[He];De=this.chart.scales[He].getPixelForValue(bt)}re=this._getYAxisLabelAlignment(W).textAlign}n==="y"&&(v==="start"?ze="top":v==="end"&&(ze="bottom"));const ft=this._getLabelSizes();for(ae=0,me=s.length;ae<me;++ae){pe=s[ae],_e=pe.label;const He=l.setContext(this.getContext(ae));fe=this.getPixelForTick(ae)+l.labelOffset,ye=this._resolveTickFontOptions(ae),ue=ye.lineHeight,Ie=La(_e)?_e.length:1;const bt=Ie/2,Nt=He.color,wt=He.textStrokeColor,it=He.textStrokeWidth;let nn=re;u?(De=fe,re==="inner"&&(ae===me-1?nn=this.options.reverse?"left":"right":ae===0?nn=this.options.reverse?"right":"left":nn="center"),i==="top"?w==="near"||Z!==0?Oe=-Ie*ue+ue/2:w==="center"?Oe=-ft.highest.height/2-bt*ue+ue:Oe=-ft.highest.height+ue/2:w==="near"||Z!==0?Oe=ue/2:w==="center"?Oe=ft.highest.height/2-bt*ue:Oe=ft.highest.height-Ie*ue,F&&(Oe*=-1),Z!==0&&!He.showLabelBackdrop&&(De+=ue/2*Math.sin(Z))):(Ae=fe,Oe=(1-Ie)*ue/2);let In;if(He.showLabelBackdrop){const wn=Xu(He.backdropPadding),Xt=ft.heights[ae],On=ft.widths[ae];let cr=Oe-wn.top,En=0-wn.left;switch(ze){case"middle":cr-=Xt/2;break;case"bottom":cr-=Xt;break}switch(re){case"center":En-=On/2;break;case"right":En-=On;break;case"inner":ae===me-1?En-=On:ae>0&&(En-=On/2);break}In={left:En,top:cr,width:On+wn.width,height:Xt+wn.height,color:He.backdropColor}}oe.push({label:_e,font:ye,textOffset:Oe,options:{rotation:Z,color:Nt,strokeColor:wt,strokeWidth:it,textAlign:nn,textBaseline:ze,translation:[De,Ae],backdrop:In}})}return oe}_getXAxisLabelAlignment(){const{position:e,ticks:n}=this.options;if(-Wg(this.labelRotation))return e==="top"?"left":"right";let i="center";return n.align==="start"?i="left":n.align==="end"?i="right":n.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:n,ticks:{crossAlign:r,mirror:i,padding:l}}=this.options,u=this._getLabelSizes(),s=e+l,v=u.widest.width;let w,A;return n==="left"?i?(A=this.right+l,r==="near"?w="left":r==="center"?(w="center",A+=v/2):(w="right",A+=v)):(A=this.right-s,r==="near"?w="right":r==="center"?(w="center",A-=v/2):(w="left",A=this.left)):n==="right"?i?(A=this.left+l,r==="near"?w="right":r==="center"?(w="center",A-=v/2):(w="left",A-=v)):(A=this.left+s,r==="near"?w="left":r==="center"?(w="center",A+=v/2):(w="right",A=this.right)):w="right",{textAlign:w,x:A}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:n},left:r,top:i,width:l,height:u}=this;n&&(e.save(),e.fillStyle=n,e.fillRect(r,i,l,u),e.restore())}getLineWidthForValue(e){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const i=this.ticks.findIndex(l=>l.value===e);return i>=0?n.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const n=this.options.grid,r=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let l,u;const s=(v,w,A)=>{!A.width||!A.color||(r.save(),r.lineWidth=A.width,r.strokeStyle=A.color,r.setLineDash(A.borderDash||[]),r.lineDashOffset=A.borderDashOffset,r.beginPath(),r.moveTo(v.x,v.y),r.lineTo(w.x,w.y),r.stroke(),r.restore())};if(n.display)for(l=0,u=i.length;l<u;++l){const v=i[l];n.drawOnChartArea&&s({x:v.x1,y:v.y1},{x:v.x2,y:v.y2},v),n.drawTicks&&s({x:v.tx1,y:v.ty1},{x:v.tx2,y:v.ty2},{color:v.tickColor,width:v.tickWidth,borderDash:v.tickBorderDash,borderDashOffset:v.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:n,options:{border:r,grid:i}}=this,l=r.setContext(this.getContext()),u=r.display?l.width:0;if(!u)return;const s=i.setContext(this.getContext(0)).lineWidth,v=this._borderValue;let w,A,F,W;this.isHorizontal()?(w=Tg(e,this.left,u)-u/2,A=Tg(e,this.right,s)+s/2,F=W=v):(F=Tg(e,this.top,u)-u/2,W=Tg(e,this.bottom,s)+s/2,w=A=v),n.save(),n.lineWidth=l.width,n.strokeStyle=l.color,n.beginPath(),n.moveTo(w,F),n.lineTo(A,W),n.stroke(),n.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,i=this._computeLabelArea();i&&JA(r,i);const l=this.getLabelItems(e);for(const u of l){const s=u.options,v=u.font,w=u.label,A=u.textOffset;kw(r,w,0,A,v,s)}i&&eR(r)}drawTitle(){const{ctx:e,options:{position:n,title:r,reverse:i}}=this;if(!r.display)return;const l=Jl(r.font),u=Xu(r.padding),s=r.align;let v=l.lineHeight/2;n==="bottom"||n==="center"||gs(n)?(v+=u.bottom,La(r.text)&&(v+=l.lineHeight*(r.text.length-1))):v+=u.top;const{titleX:w,titleY:A,maxWidth:F,rotation:W}=zCe(this,v,n,s);kw(e,r.text,0,0,l,{color:r.color,maxWidth:F,rotation:W,textAlign:BCe(s,n,i),textBaseline:"middle",translation:[w,A]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,n=e.ticks&&e.ticks.z||0,r=hs(e.grid&&e.grid.z,-1),i=hs(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==kx.prototype.draw?[{z:n,draw:l=>{this.draw(l)}}]:[{z:r,draw:l=>{this.drawBackground(),this.drawGrid(l),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:n,draw:l=>{this.drawLabels(l)}}]}getMatchingVisibleMetas(e){const n=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",i=[];let l,u;for(l=0,u=n.length;l<u;++l){const s=n[l];s[r]===this.id&&(!e||s.type===e)&&i.push(s)}return i}_resolveTickFontOptions(e){const n=this.options.ticks.setContext(this.getContext(e));return Jl(n.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class lT{constructor(e,n,r){this.type=e,this.scope=n,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const n=Object.getPrototypeOf(e);let r;UCe(n)&&(r=this.register(n));const i=this.items,l=e.id,u=this.scope+"."+l;if(!l)throw new Error("class does not have id: "+e);return l in i||(i[l]=e,jCe(e,u,r),this.override&&ga.override(e.id,e.overrides)),u}get(e){return this.items[e]}unregister(e){const n=this.items,r=e.id,i=this.scope;r in n&&delete n[r],i&&r in ga[i]&&(delete ga[i][r],this.override&&delete m_[r])}}function jCe(t,e,n){const r=Rw(Object.create(null),[n?ga.get(n):{},ga.get(e),t.defaults]);ga.set(e,r),t.defaultRoutes&&VCe(e,t.defaultRoutes),t.descriptors&&ga.describe(e,t.descriptors)}function VCe(t,e){Object.keys(e).forEach(n=>{const r=n.split("."),i=r.pop(),l=[t].concat(r).join("."),u=e[n].split("."),s=u.pop(),v=u.join(".");ga.route(l,i,v,s)})}function UCe(t){return"id"in t&&"defaults"in t}class HCe{constructor(){this.controllers=new lT(nF,"datasets",!0),this.elements=new lT(jm,"elements"),this.plugins=new lT(Object,"plugins"),this.scales=new lT(kx,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,n,r){[...n].forEach(i=>{const l=r||this._getRegistryForType(i);r||l.isForType(i)||l===this.plugins&&i.id?this._exec(e,l,i):Ks(i,u=>{const s=r||this._getRegistryForType(u);this._exec(e,s,u)})})}_exec(e,n,r){const i=G4(e);Co(r["before"+i],[],r),n[e](r),Co(r["after"+i],[],r)}_getRegistryForType(e){for(let n=0;n<this._typedRegistries.length;n++){const r=this._typedRegistries[n];if(r.isForType(e))return r}return this.plugins}_get(e,n,r){const i=n.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return i}}var fd=new HCe;class WCe{constructor(){this._init=[]}notify(e,n,r,i){n==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const l=i?this._descriptors(e).filter(i):this._descriptors(e),u=this._notify(l,e,n,r);return n==="afterDestroy"&&(this._notify(l,e,"stop"),this._notify(this._init,e,"uninstall")),u}_notify(e,n,r,i){i=i||{};for(const l of e){const u=l.plugin,s=u[r],v=[n,i,l.options];if(Co(s,v,u)===!1&&i.cancelable)return!1}return!0}invalidate(){Hs(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),n}_createDescriptors(e,n){const r=e&&e.config,i=hs(r.options&&r.options.plugins,{}),l=$Ce(r);return i===!1&&!n?[]:GCe(e,l,i,n)}_notifyStateChanges(e){const n=this._oldCache||[],r=this._cache,i=(l,u)=>l.filter(s=>!u.some(v=>s.plugin.id===v.plugin.id));this._notify(i(n,r),e,"stop"),this._notify(i(r,n),e,"start")}}function $Ce(t){const e={},n=[],r=Object.keys(fd.plugins.items);for(let l=0;l<r.length;l++)n.push(fd.getPlugin(r[l]));const i=t.plugins||[];for(let l=0;l<i.length;l++){const u=i[l];n.indexOf(u)===-1&&(n.push(u),e[u.id]=!0)}return{plugins:n,localIds:e}}function qCe(t,e){return!e&&t===!1?null:t===!0?{}:t}function GCe(t,{plugins:e,localIds:n},r,i){const l=[],u=t.getContext();for(const s of e){const v=s.id,w=qCe(r[v],i);w!==null&&l.push({plugin:s,options:YCe(t.config,{plugin:s,local:n[v]},w,u)})}return l}function YCe(t,{plugin:e,local:n},r,i){const l=t.pluginScopeKeys(e),u=t.getOptionScopes(r,l);return n&&e.defaults&&u.push(e.defaults),t.createResolver(u,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function RN(t,e){const n=ga.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function XCe(t,e){let n=t;return t==="_index_"?n=e:t==="_value_"&&(n=e==="x"?"y":"x"),n}function KCe(t,e){return t===e?"_index_":"_value_"}function d9(t){if(t==="x"||t==="y"||t==="r")return t}function ZCe(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function MN(t,...e){if(d9(t))return t;for(const n of e){const r=n.axis||ZCe(n.position)||t.length>1&&d9(t[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function f9(t,e,n){if(n[e+"AxisID"]===t)return{axis:e}}function QCe(t,e){if(e.data&&e.data.datasets){const n=e.data.datasets.filter(r=>r.xAxisID===t||r.yAxisID===t);if(n.length)return f9(t,"x",n[0])||f9(t,"y",n[0])}return{}}function JCe(t,e){const n=m_[t.type]||{scales:{}},r=e.scales||{},i=RN(t.type,e),l=Object.create(null);return Object.keys(r).forEach(u=>{const s=r[u];if(!gs(s))return console.error(`Invalid scale configuration for scale: ${u}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${u}`);const v=MN(u,s,QCe(u,t),ga.scales[s.type]),w=KCe(v,i),A=n.scales||{};l[u]=Ob(Object.create(null),[{axis:v},s,A[v],A[w]])}),t.data.datasets.forEach(u=>{const s=u.type||t.type,v=u.indexAxis||RN(s,e),A=(m_[s]||{}).scales||{};Object.keys(A).forEach(F=>{const W=XCe(F,v),K=u[W+"AxisID"]||W;l[K]=l[K]||Object.create(null),Ob(l[K],[{axis:W},r[K],A[F]])})}),Object.keys(l).forEach(u=>{const s=l[u];Ob(s,[ga.scales[s.type],ga.scale])}),l}function YJ(t){const e=t.options||(t.options={});e.plugins=hs(e.plugins,{}),e.scales=JCe(t,e)}function XJ(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function eIe(t){return t=t||{},t.data=XJ(t.data),YJ(t),t}const p9=new Map,KJ=new Set;function cT(t,e){let n=p9.get(t);return n||(n=e(),p9.set(t,n),KJ.add(n)),n}const zv=(t,e,n)=>{const r=rx(e,n);r!==void 0&&t.add(r)};class tIe{constructor(e){this._config=eIe(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=XJ(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),YJ(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return cT(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,n){return cT(`${e}.transition.${n}`,()=>[[`datasets.${e}.transitions.${n}`,`transitions.${n}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,n){return cT(`${e}-${n}`,()=>[[`datasets.${e}.elements.${n}`,`datasets.${e}`,`elements.${n}`,""]])}pluginScopeKeys(e){const n=e.id,r=this.type;return cT(`${r}-plugin-${n}`,()=>[[`plugins.${n}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,n){const r=this._scopeCache;let i=r.get(e);return(!i||n)&&(i=new Map,r.set(e,i)),i}getOptionScopes(e,n,r){const{options:i,type:l}=this,u=this._cachedScopes(e,r),s=u.get(n);if(s)return s;const v=new Set;n.forEach(A=>{e&&(v.add(e),A.forEach(F=>zv(v,e,F))),A.forEach(F=>zv(v,i,F)),A.forEach(F=>zv(v,m_[l]||{},F)),A.forEach(F=>zv(v,ga,F)),A.forEach(F=>zv(v,IN,F))});const w=Array.from(v);return w.length===0&&w.push(Object.create(null)),KJ.has(n)&&u.set(n,w),w}chartOptionScopes(){const{options:e,type:n}=this;return[e,m_[n]||{},ga.datasets[n]||{},{type:n},ga,IN]}resolveNamedOptions(e,n,r,i=[""]){const l={$shared:!0},{resolver:u,subPrefixes:s}=m9(this._resolverCache,e,i);let v=u;if(rIe(u,n)){l.$shared=!1,r=Im(r)?r():r;const w=this.createResolver(e,r,s);v=ix(u,r,w)}for(const w of n)l[w]=v[w];return l}createResolver(e,n,r=[""],i){const{resolver:l}=m9(this._resolverCache,e,r);return gs(n)?ix(l,n,void 0,i):l}}function m9(t,e,n){let r=t.get(e);r||(r=new Map,t.set(e,r));const i=n.join();let l=r.get(i);return l||(l={resolver:Z4(e,n),subPrefixes:n.filter(s=>!s.toLowerCase().includes("hover"))},r.set(i,l)),l}const nIe=t=>gs(t)&&Object.getOwnPropertyNames(t).some(e=>Im(t[e]));function rIe(t,e){const{isScriptable:n,isIndexable:r}=RJ(t);for(const i of e){const l=n(i),u=r(i),s=(u||l)&&t[i];if(l&&(Im(s)||nIe(s))||u&&La(s))return!0}return!1}var iIe="4.4.9";const sIe=["top","bottom","left","right","chartArea"];function g9(t,e){return t==="top"||t==="bottom"||sIe.indexOf(t)===-1&&e==="x"}function _9(t,e){return function(n,r){return n[t]===r[t]?n[e]-r[e]:n[t]-r[t]}}function y9(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),Co(n&&n.onComplete,[t],e)}function oIe(t){const e=t.chart,n=e.options.animation;Co(n&&n.onProgress,[t],e)}function ZJ(t){return eF()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const nC={},x9=t=>{const e=ZJ(t);return Object.values(nC).filter(n=>n.canvas===e).pop()};function aIe(t,e,n){const r=Object.keys(t);for(const i of r){const l=+i;if(l>=e){const u=t[i];delete t[i],(n>0||l>e)&&(t[l+n]=u)}}}function lIe(t,e,n,r){return!n||t.type==="mouseout"?null:r?e:t}let Nx=class{static defaults=ga;static instances=nC;static overrides=m_;static registry=fd;static version=iIe;static getChart=x9;static register(...e){fd.add(...e),v9()}static unregister(...e){fd.remove(...e),v9()}constructor(e,n){const r=this.config=new tIe(n),i=ZJ(e),l=x9(i);if(l)throw new Error("Canvas is already in use. Chart with ID '"+l.id+"' must be destroyed before the canvas with ID '"+l.canvas.id+"' can be reused.");const u=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||CCe(i)),this.platform.updateConfig(r);const s=this.platform.acquireContext(i,u.aspectRatio),v=s&&s.canvas,w=v&&v.height,A=v&&v.width;if(this.id=iSe(),this.ctx=s,this.canvas=v,this.width=A,this.height=w,this._options=u,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new WCe,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=SSe(F=>this.update(F),u.resizeDelay||0),this._dataChanges=[],nC[this.id]=this,!s||!v){console.error("Failed to create chart: can't acquire context from the given item");return}rf.listen(this,"complete",y9),rf.listen(this,"progress",oIe),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:n},width:r,height:i,_aspectRatio:l}=this;return Hs(e)?n&&l?l:i?r/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return fd}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():U7(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return z7(this.canvas,this.ctx),this}stop(){return rf.stop(this),this}resize(e,n){rf.running(this)?this._resizeBeforeDraw={width:e,height:n}:this._resize(e,n)}_resize(e,n){const r=this.options,i=this.canvas,l=r.maintainAspectRatio&&this.aspectRatio,u=this.platform.getMaximumSize(i,e,n,l),s=r.devicePixelRatio||this.platform.getDevicePixelRatio(),v=this.width?"resize":"attach";this.width=u.width,this.height=u.height,this._aspectRatio=this.aspectRatio,U7(this,s,!0)&&(this.notifyPlugins("resize",{size:u}),Co(r.onResize,[this,u],this),this.attached&&this._doResize(v)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};Ks(n,(r,i)=>{r.id=i})}buildOrUpdateScales(){const e=this.options,n=e.scales,r=this.scales,i=Object.keys(r).reduce((u,s)=>(u[s]=!1,u),{});let l=[];n&&(l=l.concat(Object.keys(n).map(u=>{const s=n[u],v=MN(u,s),w=v==="r",A=v==="x";return{options:s,dposition:w?"chartArea":A?"bottom":"left",dtype:w?"radialLinear":A?"category":"linear"}}))),Ks(l,u=>{const s=u.options,v=s.id,w=MN(v,s),A=hs(s.type,u.dtype);(s.position===void 0||g9(s.position,w)!==g9(u.dposition))&&(s.position=u.dposition),i[v]=!0;let F=null;if(v in r&&r[v].type===A)F=r[v];else{const W=fd.getScale(A);F=new W({id:v,type:A,ctx:this.ctx,chart:this}),r[F.id]=F}F.init(s,e)}),Ks(i,(u,s)=>{u||delete r[s]}),Ks(r,u=>{Uu.configure(this,u,u.options),Uu.addBox(this,u)})}_updateMetasets(){const e=this._metasets,n=this.data.datasets.length,r=e.length;if(e.sort((i,l)=>i.index-l.index),r>n){for(let i=n;i<r;++i)this._destroyDatasetMeta(i);e.splice(n,r-n)}this._sortedMetasets=e.slice(0).sort(_9("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:n}}=this;e.length>n.length&&delete this._stacks,e.forEach((r,i)=>{n.filter(l=>l===r._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],n=this.data.datasets;let r,i;for(this._removeUnreferencedMetasets(),r=0,i=n.length;r<i;r++){const l=n[r];let u=this.getDatasetMeta(r);const s=l.type||this.config.type;if(u.type&&u.type!==s&&(this._destroyDatasetMeta(r),u=this.getDatasetMeta(r)),u.type=s,u.indexAxis=l.indexAxis||RN(s,this.options),u.order=l.order||0,u.index=r,u.label=""+l.label,u.visible=this.isDatasetVisible(r),u.controller)u.controller.updateIndex(r),u.controller.linkScales();else{const v=fd.getController(s),{datasetElementType:w,dataElementType:A}=ga.datasets[s];Object.assign(v,{dataElementType:fd.getElement(A),datasetElementType:w&&fd.getElement(w)}),u.controller=new v(this,r),e.push(u.controller)}}return this._updateMetasets(),e}_resetElements(){Ks(this.data.datasets,(e,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const n=this.config;n.update();const r=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const l=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let u=0;for(let w=0,A=this.data.datasets.length;w<A;w++){const{controller:F}=this.getDatasetMeta(w),W=!i&&l.indexOf(F)===-1;F.buildOrUpdateElements(W),u=Math.max(+F.getMaxOverflow(),u)}u=this._minPadding=r.layout.autoPadding?u:0,this._updateLayout(u),i||Ks(l,w=>{w.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(_9("z","_idx"));const{_active:s,_lastEvent:v}=this;v?this._eventHandler(v,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){Ks(this.scales,e=>{Uu.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,n=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!R7(n,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,n=this._getUniformDataChanges()||[];for(const{method:r,start:i,count:l}of n){const u=r==="_removeElements"?-l:l;aIe(e,i,u)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const n=this.data.datasets.length,r=l=>new Set(e.filter(u=>u[0]===l).map((u,s)=>s+","+u.splice(1).join(","))),i=r(0);for(let l=1;l<n;l++)if(!R7(i,r(l)))return;return Array.from(i).map(l=>l.split(",")).map(l=>({method:l[1],start:+l[2],count:+l[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Uu.update(this,this.width,this.height,e);const n=this.chartArea,r=n.width<=0||n.height<=0;this._layers=[],Ks(this.boxes,i=>{r&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,l)=>{i._idx=l}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let n=0,r=this.data.datasets.length;n<r;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,r=this.data.datasets.length;n<r;++n)this._updateDataset(n,Im(e)?e({datasetIndex:n}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,n){const r=this.getDatasetMeta(e),i={meta:r,index:e,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(r.controller._update(n),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(rf.has(this)?this.attached&&!rf.running(this)&&rf.start(this):(this.draw(),y9({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(e=0;e<n.length&&n[e].z<=0;++e)n[e].draw(this.chartArea);for(this._drawDatasets();e<n.length;++e)n[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const n=this._sortedMetasets,r=[];let i,l;for(i=0,l=n.length;i<l;++i){const u=n[i];(!e||u.visible)&&r.push(u)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let n=e.length-1;n>=0;--n)this._drawDataset(e[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const n=this.ctx,r={meta:e,index:e.index,cancelable:!0},i=zJ(this,e);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(i&&JA(n,i),e.controller.draw(),i&&eR(n),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return Dw(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,n,r,i){const l=sCe.modes[n];return typeof l=="function"?l(this,e,r,i):[]}getDatasetMeta(e){const n=this.data.datasets[e],r=this._metasets;let i=r.filter(l=>l&&l._dataset===n).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:e,_dataset:n,_parsed:[],_sorted:!1},r.push(i)),i}getContext(){return this.$context||(this.$context=P_(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const n=this.data.datasets[e];if(!n)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!n.hidden}setDatasetVisibility(e,n){const r=this.getDatasetMeta(e);r.hidden=!n}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,n,r){const i=r?"show":"hide",l=this.getDatasetMeta(e),u=l.controller._resolveAnimations(void 0,i);Mw(n)?(l.data[n].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),u.update(l,{visible:r}),this.update(s=>s.datasetIndex===e?i:void 0))}hide(e,n){this._updateVisibility(e,n,!1)}show(e,n){this._updateVisibility(e,n,!0)}_destroyDatasetMeta(e){const n=this._metasets[e];n&&n.controller&&n.controller._destroy(),delete this._metasets[e]}_stop(){let e,n;for(this.stop(),rf.remove(this),e=0,n=this.data.datasets.length;e<n;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:n}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),z7(e,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete nC[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,n=this.platform,r=(l,u)=>{n.addEventListener(this,l,u),e[l]=u},i=(l,u,s)=>{l.offsetX=u,l.offsetY=s,this._eventHandler(l)};Ks(this.options.events,l=>r(l,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,n=this.platform,r=(v,w)=>{n.addEventListener(this,v,w),e[v]=w},i=(v,w)=>{e[v]&&(n.removeEventListener(this,v,w),delete e[v])},l=(v,w)=>{this.canvas&&this.resize(v,w)};let u;const s=()=>{i("attach",s),this.attached=!0,this.resize(),r("resize",l),r("detach",u)};u=()=>{this.attached=!1,i("resize",l),this._stop(),this._resize(0,0),r("attach",s)},n.isAttached(this.canvas)?s():u()}unbindEvents(){Ks(this._listeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._listeners={},Ks(this._responsiveListeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,n,r){const i=r?"set":"remove";let l,u,s,v;for(n==="dataset"&&(l=this.getDatasetMeta(e[0].datasetIndex),l.controller["_"+i+"DatasetHoverStyle"]()),s=0,v=e.length;s<v;++s){u=e[s];const w=u&&this.getDatasetMeta(u.datasetIndex).controller;w&&w[i+"HoverStyle"](u.element,u.datasetIndex,u.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const n=this._active||[],r=e.map(({datasetIndex:l,index:u})=>{const s=this.getDatasetMeta(l);if(!s)throw new Error("No dataset found at index "+l);return{datasetIndex:l,element:s.data[u],index:u}});!_I(r,n)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,n))}notifyPlugins(e,n,r){return this._plugins.notify(this,e,n,r)}isPluginEnabled(e){return this._plugins._cache.filter(n=>n.plugin.id===e).length===1}_updateHoverStyles(e,n,r){const i=this.options.hover,l=(v,w)=>v.filter(A=>!w.some(F=>A.datasetIndex===F.datasetIndex&&A.index===F.index)),u=l(n,e),s=r?e:l(e,n);u.length&&this.updateHoverStyle(u,i.mode,!1),s.length&&i.mode&&this.updateHoverStyle(s,i.mode,!0)}_eventHandler(e,n){const r={event:e,replay:n,cancelable:!0,inChartArea:this.isPointInArea(e)},i=u=>(u.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,i)===!1)return;const l=this._handleEvent(e,n,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,i),(l||r.changed)&&this.render(),this}_handleEvent(e,n,r){const{_active:i=[],options:l}=this,u=n,s=this._getActiveElements(e,i,r,u),v=uSe(e),w=lIe(e,this._lastEvent,r,v);r&&(this._lastEvent=null,Co(l.onHover,[e,s,this],this),v&&Co(l.onClick,[e,s,this],this));const A=!_I(s,i);return(A||n)&&(this._active=s,this._updateHoverStyles(s,i,n)),this._lastEvent=w,A}_getActiveElements(e,n,r,i){if(e.type==="mouseout")return[];if(!r)return n;const l=this.options.hover;return this.getElementsAtEventForMode(e,l.mode,l,i)}};function v9(){return Ks(Nx.instances,t=>t._plugins.invalidate())}function QJ(t,e,n=e){t.lineCap=hs(n.borderCapStyle,e.borderCapStyle),t.setLineDash(hs(n.borderDash,e.borderDash)),t.lineDashOffset=hs(n.borderDashOffset,e.borderDashOffset),t.lineJoin=hs(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=hs(n.borderWidth,e.borderWidth),t.strokeStyle=hs(n.borderColor,e.borderColor)}function cIe(t,e,n){t.lineTo(n.x,n.y)}function uIe(t){return t.stepped?BSe:t.tension||t.cubicInterpolationMode==="monotone"?zSe:cIe}function JJ(t,e,n={}){const r=t.length,{start:i=0,end:l=r-1}=n,{start:u,end:s}=e,v=Math.max(i,u),w=Math.min(l,s),A=i<u&&l<u||i>s&&l>s;return{count:r,start:v,loop:e.loop,ilen:w<v&&!A?r+w-v:w-v}}function hIe(t,e,n,r){const{points:i,options:l}=e,{count:u,start:s,loop:v,ilen:w}=JJ(i,n,r),A=uIe(l);let{move:F=!0,reverse:W}=r||{},K,Q,Z;for(K=0;K<=w;++K)Q=i[(s+(W?w-K:K))%u],!Q.skip&&(F?(t.moveTo(Q.x,Q.y),F=!1):A(t,Z,Q,W,l.stepped),Z=Q);return v&&(Q=i[(s+(W?w:0))%u],A(t,Z,Q,W,l.stepped)),!!v}function dIe(t,e,n,r){const i=e.points,{count:l,start:u,ilen:s}=JJ(i,n,r),{move:v=!0,reverse:w}=r||{};let A=0,F=0,W,K,Q,Z,oe,ae;const me=_e=>(u+(w?s-_e:_e))%l,pe=()=>{Z!==oe&&(t.lineTo(A,oe),t.lineTo(A,Z),t.lineTo(A,ae))};for(v&&(K=i[me(0)],t.moveTo(K.x,K.y)),W=0;W<=s;++W){if(K=i[me(W)],K.skip)continue;const _e=K.x,De=K.y,Ae=_e|0;Ae===Q?(De<Z?Z=De:De>oe&&(oe=De),A=(F*A+_e)/++F):(pe(),t.lineTo(_e,De),Q=Ae,F=0,Z=oe=De),ae=De}pe()}function PN(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!n?dIe:hIe}function fIe(t){return t.stepped?_Te:t.tension||t.cubicInterpolationMode==="monotone"?yTe:Ng}function pIe(t,e,n,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,n,r)&&i.closePath()),QJ(t,e.options),t.stroke(i)}function mIe(t,e,n,r){const{segments:i,options:l}=e,u=PN(e);for(const s of i)QJ(t,l,s.style),t.beginPath(),u(t,e,s,{start:n,end:n+r-1})&&t.closePath(),t.stroke()}const gIe=typeof Path2D=="function";function _Ie(t,e,n,r){gIe&&!e.options.segment?pIe(t,e,n,r):mIe(t,e,n,r)}class rR extends jm{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,n){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const i=r.spanGaps?this._loop:this._fullLoop;cTe(this._points,r,e,i,n),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=STe(this,this.options.segment))}first(){const e=this.segments,n=this.points;return e.length&&n[e[0].start]}last(){const e=this.segments,n=this.points,r=e.length;return r&&n[e[r-1].end]}interpolate(e,n){const r=this.options,i=e[n],l=this.points,u=BJ(this,{property:n,start:i,end:i});if(!u.length)return;const s=[],v=fIe(r);let w,A;for(w=0,A=u.length;w<A;++w){const{start:F,end:W}=u[w],K=l[F],Q=l[W];if(K===Q){s.push(K);continue}const Z=Math.abs((i-K[n])/(Q[n]-K[n])),oe=v(K,Q,Z,r.stepped);oe[n]=e[n],s.push(oe)}return s.length===1?s[0]:s}pathSegment(e,n,r){return PN(this)(e,this,n,r)}path(e,n,r){const i=this.segments,l=PN(this);let u=this._loop;n=n||0,r=r||this.points.length-n;for(const s of i)u&=l(e,this,s,{start:n,end:n+r-1});return!!u}draw(e,n,r,i){const l=this.options||{};(this.points||[]).length&&l.borderWidth&&(e.save(),_Ie(e,this,r,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function b9(t,e,n,r){const i=t.options,{[n]:l}=t.getProps([n],r);return Math.abs(e-l)<i.radius+i.hitRadius}class yIe extends jm{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,n,r){const i=this.options,{x:l,y:u}=this.getProps(["x","y"],r);return Math.pow(e-l,2)+Math.pow(n-u,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,n){return b9(this,e,"x",n)}inYRange(e,n){return b9(this,e,"y",n)}getCenterPoint(e){const{x:n,y:r}=this.getProps(["x","y"],e);return{x:n,y:r}}size(e){e=e||this.options||{};let n=e.radius||0;n=Math.max(n,n&&e.hoverRadius||0);const r=n&&e.borderWidth||0;return(n+r)*2}draw(e,n){const r=this.options;this.skip||r.radius<.1||!Dw(this,n,this.size(r)/2)||(e.strokeStyle=r.borderColor,e.lineWidth=r.borderWidth,e.fillStyle=r.backgroundColor,AN(e,r,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function eee(t,e){const{x:n,y:r,base:i,width:l,height:u}=t.getProps(["x","y","base","width","height"],e);let s,v,w,A,F;return t.horizontal?(F=u/2,s=Math.min(n,i),v=Math.max(n,i),w=r-F,A=r+F):(F=l/2,s=n-F,v=n+F,w=Math.min(r,i),A=Math.max(r,i)),{left:s,top:w,right:v,bottom:A}}function Yp(t,e,n,r){return t?0:fu(e,n,r)}function xIe(t,e,n){const r=t.options.borderWidth,i=t.borderSkipped,l=AJ(r);return{t:Yp(i.top,l.top,0,n),r:Yp(i.right,l.right,0,e),b:Yp(i.bottom,l.bottom,0,n),l:Yp(i.left,l.left,0,e)}}function vIe(t,e,n){const{enableBorderRadius:r}=t.getProps(["enableBorderRadius"]),i=t.options.borderRadius,l=Sy(i),u=Math.min(e,n),s=t.borderSkipped,v=r||gs(i);return{topLeft:Yp(!v||s.top||s.left,l.topLeft,0,u),topRight:Yp(!v||s.top||s.right,l.topRight,0,u),bottomLeft:Yp(!v||s.bottom||s.left,l.bottomLeft,0,u),bottomRight:Yp(!v||s.bottom||s.right,l.bottomRight,0,u)}}function bIe(t){const e=eee(t),n=e.right-e.left,r=e.bottom-e.top,i=xIe(t,n/2,r/2),l=vIe(t,n/2,r/2);return{outer:{x:e.left,y:e.top,w:n,h:r,radius:l},inner:{x:e.left+i.l,y:e.top+i.t,w:n-i.l-i.r,h:r-i.t-i.b,radius:{topLeft:Math.max(0,l.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,l.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,l.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,l.bottomRight-Math.max(i.b,i.r))}}}}function s3(t,e,n,r){const i=e===null,l=n===null,s=t&&!(i&&l)&&eee(t,r);return s&&(i||Gp(e,s.left,s.right))&&(l||Gp(n,s.top,s.bottom))}function wIe(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}function EIe(t,e){t.rect(e.x,e.y,e.w,e.h)}function o3(t,e,n={}){const r=t.x!==n.x?-e:0,i=t.y!==n.y?-e:0,l=(t.x+t.w!==n.x+n.w?e:0)-r,u=(t.y+t.h!==n.y+n.h?e:0)-i;return{x:t.x+r,y:t.y+i,w:t.w+l,h:t.h+u,radius:t.radius}}class tee extends jm{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:n,options:{borderColor:r,backgroundColor:i}}=this,{inner:l,outer:u}=bIe(this),s=wIe(u.radius)?vI:EIe;e.save(),(u.w!==l.w||u.h!==l.h)&&(e.beginPath(),s(e,o3(u,n,l)),e.clip(),s(e,o3(l,-n,u)),e.fillStyle=r,e.fill("evenodd")),e.beginPath(),s(e,o3(l,n)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,n,r){return s3(this,e,n,r)}inXRange(e,n){return s3(this,e,null,n)}inYRange(e,n){return s3(this,null,e,n)}getCenterPoint(e){const{x:n,y:r,base:i,horizontal:l}=this.getProps(["x","y","base","horizontal"],e);return{x:l?(n+i)/2:n,y:l?r:(r+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}function SIe(t,e,n){const r=t.segments,i=t.points,l=e.points,u=[];for(const s of r){let{start:v,end:w}=s;w=iF(v,w,i);const A=DN(n,i[v],i[w],s.loop);if(!e.segments){u.push({source:s,target:A,start:i[v],end:i[w]});continue}const F=BJ(e,A);for(const W of F){const K=DN(n,l[W.start],l[W.end],W.loop),Q=FJ(s,i,K);for(const Z of Q)u.push({source:Z,target:W,start:{[n]:w9(A,K,"start",Math.max)},end:{[n]:w9(A,K,"end",Math.min)}})}}return u}function DN(t,e,n,r){if(r)return;let i=e[t],l=n[t];return t==="angle"&&(i=md(i),l=md(l)),{property:t,start:i,end:l}}function TIe(t,e){const{x:n=null,y:r=null}=t||{},i=e.points,l=[];return e.segments.forEach(({start:u,end:s})=>{s=iF(u,s,i);const v=i[u],w=i[s];r!==null?(l.push({x:v.x,y:r}),l.push({x:w.x,y:r})):n!==null&&(l.push({x:n,y:v.y}),l.push({x:n,y:w.y}))}),l}function iF(t,e,n){for(;e>t;e--){const r=n[e];if(!isNaN(r.x)&&!isNaN(r.y))break}return e}function w9(t,e,n,r){return t&&e?r(t[n],e[n]):t?t[n]:e?e[n]:0}function nee(t,e){let n=[],r=!1;return La(t)?(r=!0,n=t):n=TIe(t,e),n.length?new rR({points:n,options:{tension:0},_loop:r,_fullLoop:r}):null}function E9(t){return t&&t.fill!==!1}function CIe(t,e,n){let i=t[e].fill;const l=[e];let u;if(!n)return i;for(;i!==!1&&l.indexOf(i)===-1;){if(!rc(i))return i;if(u=t[i],!u)return!1;if(u.visible)return i;l.push(i),i=u.fill}return!1}function IIe(t,e,n){const r=PIe(t);if(gs(r))return isNaN(r.value)?!1:r;let i=parseFloat(r);return rc(i)&&Math.floor(i)===i?AIe(r[0],e,i,n):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function AIe(t,e,n,r){return(t==="-"||t==="+")&&(n=e+n),n===e||n<0||n>=r?!1:n}function RIe(t,e){let n=null;return t==="start"?n=e.bottom:t==="end"?n=e.top:gs(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}function MIe(t,e,n){let r;return t==="start"?r=n:t==="end"?r=e.options.reverse?e.min:e.max:gs(t)?r=t.value:r=e.getBaseValue(),r}function PIe(t){const e=t.options,n=e.fill;let r=hs(n&&n.target,n);return r===void 0&&(r=!!e.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function DIe(t){const{scale:e,index:n,line:r}=t,i=[],l=r.segments,u=r.points,s=kIe(e,n);s.push(nee({x:null,y:e.bottom},r));for(let v=0;v<l.length;v++){const w=l[v];for(let A=w.start;A<=w.end;A++)NIe(i,u[A],s)}return new rR({points:i,options:{}})}function kIe(t,e){const n=[],r=t.getMatchingVisibleMetas("line");for(let i=0;i<r.length;i++){const l=r[i];if(l.index===e)break;l.hidden||n.unshift(l.dataset)}return n}function NIe(t,e,n){const r=[];for(let i=0;i<n.length;i++){const l=n[i],{first:u,last:s,point:v}=OIe(l,e,"x");if(!(!v||u&&s)){if(u)r.unshift(v);else if(t.push(v),!s)break}}t.push(...r)}function OIe(t,e,n){const r=t.interpolate(e,n);if(!r)return{};const i=r[n],l=t.segments,u=t.points;let s=!1,v=!1;for(let w=0;w<l.length;w++){const A=l[w],F=u[A.start][n],W=u[A.end][n];if(Gp(i,F,W)){s=i===F,v=i===W;break}}return{first:s,last:v,point:r}}class ree{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,n,r){const{x:i,y:l,radius:u}=this;return n=n||{start:0,end:kh},e.arc(i,l,u,n.end,n.start,!0),!r.bounds}interpolate(e){const{x:n,y:r,radius:i}=this,l=e.angle;return{x:n+Math.cos(l)*i,y:r+Math.sin(l)*i,angle:l}}}function LIe(t){const{chart:e,fill:n,line:r}=t;if(rc(n))return FIe(e,n);if(n==="stack")return DIe(t);if(n==="shape")return!0;const i=BIe(t);return i instanceof ree?i:nee(i,r)}function FIe(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}function BIe(t){return(t.scale||{}).getPointPositionForValue?jIe(t):zIe(t)}function zIe(t){const{scale:e={},fill:n}=t,r=RIe(n,e);if(rc(r)){const i=e.isHorizontal();return{x:i?r:null,y:i?null:r}}return null}function jIe(t){const{scale:e,fill:n}=t,r=e.options,i=e.getLabels().length,l=r.reverse?e.max:e.min,u=MIe(n,e,l),s=[];if(r.grid.circular){const v=e.getPointPositionForValue(0,l);return new ree({x:v.x,y:v.y,radius:e.getDistanceFromCenterForValue(u)})}for(let v=0;v<i;++v)s.push(e.getPointPositionForValue(v,u));return s}function a3(t,e,n){const r=LIe(e),{chart:i,index:l,line:u,scale:s,axis:v}=e,w=u.options,A=w.fill,F=w.backgroundColor,{above:W=F,below:K=F}=A||{},Q=i.getDatasetMeta(l),Z=zJ(i,Q);r&&u.points.length&&(JA(t,n),VIe(t,{line:u,target:r,above:W,below:K,area:n,scale:s,axis:v,clip:Z}),eR(t))}function VIe(t,e){const{line:n,target:r,above:i,below:l,area:u,scale:s,clip:v}=e,w=n._loop?"angle":e.axis;t.save(),w==="x"&&l!==i&&(S9(t,r,u.top),T9(t,{line:n,target:r,color:i,scale:s,property:w,clip:v}),t.restore(),t.save(),S9(t,r,u.bottom)),T9(t,{line:n,target:r,color:l,scale:s,property:w,clip:v}),t.restore()}function S9(t,e,n){const{segments:r,points:i}=e;let l=!0,u=!1;t.beginPath();for(const s of r){const{start:v,end:w}=s,A=i[v],F=i[iF(v,w,i)];l?(t.moveTo(A.x,A.y),l=!1):(t.lineTo(A.x,n),t.lineTo(A.x,A.y)),u=!!e.pathSegment(t,s,{move:u}),u?t.closePath():t.lineTo(F.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function T9(t,e){const{line:n,target:r,property:i,color:l,scale:u,clip:s}=e,v=SIe(n,r,i);for(const{source:w,target:A,start:F,end:W}of v){const{style:{backgroundColor:K=l}={}}=w,Q=r!==!0;t.save(),t.fillStyle=K,UIe(t,u,s,Q&&DN(i,F,W)),t.beginPath();const Z=!!n.pathSegment(t,w);let oe;if(Q){Z?t.closePath():C9(t,r,W,i);const ae=!!r.pathSegment(t,A,{move:Z,reverse:!0});oe=Z&&ae,oe||C9(t,r,F,i)}t.closePath(),t.fill(oe?"evenodd":"nonzero"),t.restore()}}function UIe(t,e,n,r){const i=e.chart.chartArea,{property:l,start:u,end:s}=r||{};if(l==="x"||l==="y"){let v,w,A,F;l==="x"?(v=u,w=i.top,A=s,F=i.bottom):(v=i.left,w=u,A=i.right,F=s),t.beginPath(),n&&(v=Math.max(v,n.left),A=Math.min(A,n.right),w=Math.max(w,n.top),F=Math.min(F,n.bottom)),t.rect(v,w,A-v,F-w),t.clip()}}function C9(t,e,n,r){const i=e.interpolate(n,r);i&&t.lineTo(i.x,i.y)}var HIe={id:"filler",afterDatasetsUpdate(t,e,n){const r=(t.data.datasets||[]).length,i=[];let l,u,s,v;for(u=0;u<r;++u)l=t.getDatasetMeta(u),s=l.dataset,v=null,s&&s.options&&s instanceof rR&&(v={visible:t.isDatasetVisible(u),index:u,fill:IIe(s,u,r),chart:t,axis:l.controller.options.indexAxis,scale:l.vScale,line:s}),l.$filler=v,i.push(v);for(u=0;u<r;++u)v=i[u],!(!v||v.fill===!1)&&(v.fill=CIe(i,u,n.propagate))},beforeDraw(t,e,n){const r=n.drawTime==="beforeDraw",i=t.getSortedVisibleDatasetMetas(),l=t.chartArea;for(let u=i.length-1;u>=0;--u){const s=i[u].$filler;s&&(s.line.updateControlPoints(l,s.axis),r&&s.fill&&a3(t.ctx,s,l))}},beforeDatasetsDraw(t,e,n){if(n.drawTime!=="beforeDatasetsDraw")return;const r=t.getSortedVisibleDatasetMetas();for(let i=r.length-1;i>=0;--i){const l=r[i].$filler;E9(l)&&a3(t.ctx,l,t.chartArea)}},beforeDatasetDraw(t,e,n){const r=e.meta.$filler;!E9(r)||n.drawTime!=="beforeDatasetDraw"||a3(t.ctx,r,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const I9=(t,e)=>{let{boxHeight:n=e,boxWidth:r=e}=t;return t.usePointStyle&&(n=Math.min(n,e),r=t.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:n,itemHeight:Math.max(e,n)}},WIe=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class A9 extends jm{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n,r){this.maxWidth=e,this.maxHeight=n,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let n=Co(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter(r=>e.filter(r,this.chart.data))),e.sort&&(n=n.sort((r,i)=>e.sort(r,i,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:e,ctx:n}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,i=Jl(r.font),l=i.size,u=this._computeTitleHeight(),{boxWidth:s,itemHeight:v}=I9(r,l);let w,A;n.font=i.string,this.isHorizontal()?(w=this.maxWidth,A=this._fitRows(u,l,s,v)+10):(A=this.maxHeight,w=this._fitCols(u,i,s,v)+10),this.width=Math.min(w,e.maxWidth||this.maxWidth),this.height=Math.min(A,e.maxHeight||this.maxHeight)}_fitRows(e,n,r,i){const{ctx:l,maxWidth:u,options:{labels:{padding:s}}}=this,v=this.legendHitBoxes=[],w=this.lineWidths=[0],A=i+s;let F=e;l.textAlign="left",l.textBaseline="middle";let W=-1,K=-A;return this.legendItems.forEach((Q,Z)=>{const oe=r+n/2+l.measureText(Q.text).width;(Z===0||w[w.length-1]+oe+2*s>u)&&(F+=A,w[w.length-(Z>0?0:1)]=0,K+=A,W++),v[Z]={left:0,top:K,row:W,width:oe,height:i},w[w.length-1]+=oe+s}),F}_fitCols(e,n,r,i){const{ctx:l,maxHeight:u,options:{labels:{padding:s}}}=this,v=this.legendHitBoxes=[],w=this.columnSizes=[],A=u-e;let F=s,W=0,K=0,Q=0,Z=0;return this.legendItems.forEach((oe,ae)=>{const{itemWidth:me,itemHeight:pe}=$Ie(r,n,l,oe,i);ae>0&&K+pe+2*s>A&&(F+=W+s,w.push({width:W,height:K}),Q+=W+s,Z++,W=K=0),v[ae]={left:Q,top:K,col:Z,width:me,height:pe},W=Math.max(W,me),K+=pe+s}),F+=W,w.push({width:W,height:K}),F}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:r,labels:{padding:i},rtl:l}}=this,u=Ty(l,this.left,this.width);if(this.isHorizontal()){let s=0,v=Gl(r,this.left+i,this.right-this.lineWidths[s]);for(const w of n)s!==w.row&&(s=w.row,v=Gl(r,this.left+i,this.right-this.lineWidths[s])),w.top+=this.top+e+i,w.left=u.leftForLtr(u.x(v),w.width),v+=w.width+i}else{let s=0,v=Gl(r,this.top+e+i,this.bottom-this.columnSizes[s].height);for(const w of n)w.col!==s&&(s=w.col,v=Gl(r,this.top+e+i,this.bottom-this.columnSizes[s].height)),w.top=v,w.left+=this.left+i,w.left=u.leftForLtr(u.x(w.left),w.width),v+=w.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;JA(e,this),this._draw(),eR(e)}}_draw(){const{options:e,columnSizes:n,lineWidths:r,ctx:i}=this,{align:l,labels:u}=e,s=ga.color,v=Ty(e.rtl,this.left,this.width),w=Jl(u.font),{padding:A}=u,F=w.size,W=F/2;let K;this.drawTitle(),i.textAlign=v.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=w.string;const{boxWidth:Q,boxHeight:Z,itemHeight:oe}=I9(u,F),ae=function(Ae,re,fe){if(isNaN(Q)||Q<=0||isNaN(Z)||Z<0)return;i.save();const ye=hs(fe.lineWidth,1);if(i.fillStyle=hs(fe.fillStyle,s),i.lineCap=hs(fe.lineCap,"butt"),i.lineDashOffset=hs(fe.lineDashOffset,0),i.lineJoin=hs(fe.lineJoin,"miter"),i.lineWidth=ye,i.strokeStyle=hs(fe.strokeStyle,s),i.setLineDash(hs(fe.lineDash,[])),u.usePointStyle){const ue={radius:Z*Math.SQRT2/2,pointStyle:fe.pointStyle,rotation:fe.rotation,borderWidth:ye},Ie=v.xPlus(Ae,Q/2),Oe=re+W;CJ(i,ue,Ie,Oe,u.pointStyleWidth&&Q)}else{const ue=re+Math.max((F-Z)/2,0),Ie=v.leftForLtr(Ae,Q),Oe=Sy(fe.borderRadius);i.beginPath(),Object.values(Oe).some(ze=>ze!==0)?vI(i,{x:Ie,y:ue,w:Q,h:Z,radius:Oe}):i.rect(Ie,ue,Q,Z),i.fill(),ye!==0&&i.stroke()}i.restore()},me=function(Ae,re,fe){kw(i,fe.text,Ae,re+oe/2,w,{strikethrough:fe.hidden,textAlign:v.textAlign(fe.textAlign)})},pe=this.isHorizontal(),_e=this._computeTitleHeight();pe?K={x:Gl(l,this.left+A,this.right-r[0]),y:this.top+A+_e,line:0}:K={x:this.left+A,y:Gl(l,this.top+_e+A,this.bottom-n[0].height),line:0},NJ(this.ctx,e.textDirection);const De=oe+A;this.legendItems.forEach((Ae,re)=>{i.strokeStyle=Ae.fontColor,i.fillStyle=Ae.fontColor;const fe=i.measureText(Ae.text).width,ye=v.textAlign(Ae.textAlign||(Ae.textAlign=u.textAlign)),ue=Q+W+fe;let Ie=K.x,Oe=K.y;v.setWidth(this.width),pe?re>0&&Ie+ue+A>this.right&&(Oe=K.y+=De,K.line++,Ie=K.x=Gl(l,this.left+A,this.right-r[K.line])):re>0&&Oe+De>this.bottom&&(Ie=K.x=Ie+n[K.line].width+A,K.line++,Oe=K.y=Gl(l,this.top+_e+A,this.bottom-n[K.line].height));const ze=v.x(Ie);if(ae(ze,Oe,Ae),Ie=TSe(ye,Ie+Q+W,pe?Ie+ue:this.right,e.rtl),me(v.x(Ie),Oe,Ae),pe)K.x+=ue+A;else if(typeof Ae.text!="string"){const ft=w.lineHeight;K.y+=iee(Ae,ft)+A}else K.y+=De}),OJ(this.ctx,e.textDirection)}drawTitle(){const e=this.options,n=e.title,r=Jl(n.font),i=Xu(n.padding);if(!n.display)return;const l=Ty(e.rtl,this.left,this.width),u=this.ctx,s=n.position,v=r.size/2,w=i.top+v;let A,F=this.left,W=this.width;if(this.isHorizontal())W=Math.max(...this.lineWidths),A=this.top+w,F=Gl(e.align,F,this.right-W);else{const Q=this.columnSizes.reduce((Z,oe)=>Math.max(Z,oe.height),0);A=w+Gl(e.align,this.top,this.bottom-Q-e.labels.padding-this._computeTitleHeight())}const K=Gl(s,F,F+W);u.textAlign=l.textAlign(X4(s)),u.textBaseline="middle",u.strokeStyle=n.color,u.fillStyle=n.color,u.font=r.string,kw(u,n.text,K,A,r)}_computeTitleHeight(){const e=this.options.title,n=Jl(e.font),r=Xu(e.padding);return e.display?n.lineHeight+r.height:0}_getLegendItemAt(e,n){let r,i,l;if(Gp(e,this.left,this.right)&&Gp(n,this.top,this.bottom)){for(l=this.legendHitBoxes,r=0;r<l.length;++r)if(i=l[r],Gp(e,i.left,i.left+i.width)&&Gp(n,i.top,i.top+i.height))return this.legendItems[r]}return null}handleEvent(e){const n=this.options;if(!YIe(e.type,n))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const i=this._hoveredItem,l=WIe(i,r);i&&!l&&Co(n.onLeave,[e,i,this],this),this._hoveredItem=r,r&&!l&&Co(n.onHover,[e,r,this],this)}else r&&Co(n.onClick,[e,r,this],this)}}function $Ie(t,e,n,r,i){const l=qIe(r,t,e,n),u=GIe(i,r,e.lineHeight);return{itemWidth:l,itemHeight:u}}function qIe(t,e,n,r){let i=t.text;return i&&typeof i!="string"&&(i=i.reduce((l,u)=>l.length>u.length?l:u)),e+n.size/2+r.measureText(i).width}function GIe(t,e,n){let r=t;return typeof e.text!="string"&&(r=iee(e,n)),r}function iee(t,e){const n=t.text?t.text.length:0;return e*n}function YIe(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var sF={id:"legend",_element:A9,start(t,e,n){const r=t.legend=new A9({ctx:t.ctx,options:n,chart:t});Uu.configure(t,r,n),Uu.addBox(t,r)},stop(t){Uu.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const r=t.legend;Uu.configure(t,r,n),r.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const r=e.datasetIndex,i=n.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:r,textAlign:i,color:l,useBorderRadius:u,borderRadius:s}}=t.legend.options;return t._getSortedDatasetMetas().map(v=>{const w=v.controller.getStyle(n?0:void 0),A=Xu(w.borderWidth);return{text:e[v.index].label,fillStyle:w.backgroundColor,fontColor:l,hidden:!v.visible,lineCap:w.borderCapStyle,lineDash:w.borderDash,lineDashOffset:w.borderDashOffset,lineJoin:w.borderJoinStyle,lineWidth:(A.width+A.height)/4,strokeStyle:w.borderColor,pointStyle:r||w.pointStyle,rotation:w.rotation,textAlign:i||w.textAlign,borderRadius:u&&(s||w.borderRadius),datasetIndex:v.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};let see=class extends jm{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=n;const i=La(r.text)?r.text.length:1;this._padding=Xu(r.padding);const l=i*Jl(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=l:this.width=l}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:n,left:r,bottom:i,right:l,options:u}=this,s=u.align;let v=0,w,A,F;return this.isHorizontal()?(A=Gl(s,r,l),F=n+e,w=l-r):(u.position==="left"?(A=r+e,F=Gl(s,i,n),v=ll*-.5):(A=l-e,F=Gl(s,n,i),v=ll*.5),w=i-n),{titleX:A,titleY:F,maxWidth:w,rotation:v}}draw(){const e=this.ctx,n=this.options;if(!n.display)return;const r=Jl(n.font),l=r.lineHeight/2+this._padding.top,{titleX:u,titleY:s,maxWidth:v,rotation:w}=this._drawArgs(l);kw(e,n.text,0,0,r,{color:n.color,maxWidth:v,rotation:w,textAlign:X4(n.align),textBaseline:"middle",translation:[u,s]})}};function XIe(t,e){const n=new see({ctx:t.ctx,options:e,chart:t});Uu.configure(t,n,e),Uu.addBox(t,n),t.titleBlock=n}var oF={id:"title",_element:see,start(t,e,n){XIe(t,n)},stop(t){const e=t.titleBlock;Uu.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const r=t.titleBlock;Uu.configure(t,r,n),r.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const db={average(t){if(!t.length)return!1;let e,n,r=new Set,i=0,l=0;for(e=0,n=t.length;e<n;++e){const s=t[e].element;if(s&&s.hasValue()){const v=s.tooltipPosition();r.add(v.x),i+=v.y,++l}}return l===0||r.size===0?!1:{x:[...r].reduce((s,v)=>s+v)/r.size,y:i/l}},nearest(t,e){if(!t.length)return!1;let n=e.x,r=e.y,i=Number.POSITIVE_INFINITY,l,u,s;for(l=0,u=t.length;l<u;++l){const v=t[l].element;if(v&&v.hasValue()){const w=v.getCenterPoint(),A=CN(e,w);A<i&&(i=A,s=v)}}if(s){const v=s.tooltipPosition();n=v.x,r=v.y}return{x:n,y:r}}};function ud(t,e){return e&&(La(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function sf(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function KIe(t,e){const{element:n,datasetIndex:r,index:i}=e,l=t.getDatasetMeta(r).controller,{label:u,value:s}=l.getLabelAndValue(i);return{chart:t,label:u,parsed:l.getParsed(i),raw:t.data.datasets[r].data[i],formattedValue:s,dataset:l.getDataset(),dataIndex:i,datasetIndex:r,element:n}}function R9(t,e){const n=t.chart.ctx,{body:r,footer:i,title:l}=t,{boxWidth:u,boxHeight:s}=e,v=Jl(e.bodyFont),w=Jl(e.titleFont),A=Jl(e.footerFont),F=l.length,W=i.length,K=r.length,Q=Xu(e.padding);let Z=Q.height,oe=0,ae=r.reduce((_e,De)=>_e+De.before.length+De.lines.length+De.after.length,0);if(ae+=t.beforeBody.length+t.afterBody.length,F&&(Z+=F*w.lineHeight+(F-1)*e.titleSpacing+e.titleMarginBottom),ae){const _e=e.displayColors?Math.max(s,v.lineHeight):v.lineHeight;Z+=K*_e+(ae-K)*v.lineHeight+(ae-1)*e.bodySpacing}W&&(Z+=e.footerMarginTop+W*A.lineHeight+(W-1)*e.footerSpacing);let me=0;const pe=function(_e){oe=Math.max(oe,n.measureText(_e).width+me)};return n.save(),n.font=w.string,Ks(t.title,pe),n.font=v.string,Ks(t.beforeBody.concat(t.afterBody),pe),me=e.displayColors?u+2+e.boxPadding:0,Ks(r,_e=>{Ks(_e.before,pe),Ks(_e.lines,pe),Ks(_e.after,pe)}),me=0,n.font=A.string,Ks(t.footer,pe),n.restore(),oe+=Q.width,{width:oe,height:Z}}function ZIe(t,e){const{y:n,height:r}=e;return n<r/2?"top":n>t.height-r/2?"bottom":"center"}function QIe(t,e,n,r){const{x:i,width:l}=r,u=n.caretSize+n.caretPadding;if(t==="left"&&i+l+u>e.width||t==="right"&&i-l-u<0)return!0}function JIe(t,e,n,r){const{x:i,width:l}=n,{width:u,chartArea:{left:s,right:v}}=t;let w="center";return r==="center"?w=i<=(s+v)/2?"left":"right":i<=l/2?w="left":i>=u-l/2&&(w="right"),QIe(w,t,e,n)&&(w="center"),w}function M9(t,e,n){const r=n.yAlign||e.yAlign||ZIe(t,n);return{xAlign:n.xAlign||e.xAlign||JIe(t,e,n,r),yAlign:r}}function eAe(t,e){let{x:n,width:r}=t;return e==="right"?n-=r:e==="center"&&(n-=r/2),n}function tAe(t,e,n){let{y:r,height:i}=t;return e==="top"?r+=n:e==="bottom"?r-=i+n:r-=i/2,r}function P9(t,e,n,r){const{caretSize:i,caretPadding:l,cornerRadius:u}=t,{xAlign:s,yAlign:v}=n,w=i+l,{topLeft:A,topRight:F,bottomLeft:W,bottomRight:K}=Sy(u);let Q=eAe(e,s);const Z=tAe(e,v,w);return v==="center"?s==="left"?Q+=w:s==="right"&&(Q-=w):s==="left"?Q-=Math.max(A,W)+i:s==="right"&&(Q+=Math.max(F,K)+i),{x:fu(Q,0,r.width-e.width),y:fu(Z,0,r.height-e.height)}}function uT(t,e,n){const r=Xu(n.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-r.right:t.x+r.left}function D9(t){return ud([],sf(t))}function nAe(t,e,n){return P_(t,{tooltip:e,tooltipItems:n,type:"tooltip"})}function k9(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}const oee={beforeTitle:Jd,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,r=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return n[e.dataIndex]}return""},afterTitle:Jd,beforeBody:Jd,beforeLabel:Jd,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return Hs(n)||(e+=n),e},labelColor(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Jd,afterBody:Jd,beforeFooter:Jd,footer:Jd,afterFooter:Jd};function Nc(t,e,n,r){const i=t[e].call(n,r);return typeof i>"u"?oee[e].call(n,r):i}class N9 extends jm{static positioners=db;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const n=this.chart,r=this.options.setContext(this.getContext()),i=r.enabled&&n.options.animation&&r.animations,l=new jJ(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(l)),l}getContext(){return this.$context||(this.$context=nAe(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,n){const{callbacks:r}=n,i=Nc(r,"beforeTitle",this,e),l=Nc(r,"title",this,e),u=Nc(r,"afterTitle",this,e);let s=[];return s=ud(s,sf(i)),s=ud(s,sf(l)),s=ud(s,sf(u)),s}getBeforeBody(e,n){return D9(Nc(n.callbacks,"beforeBody",this,e))}getBody(e,n){const{callbacks:r}=n,i=[];return Ks(e,l=>{const u={before:[],lines:[],after:[]},s=k9(r,l);ud(u.before,sf(Nc(s,"beforeLabel",this,l))),ud(u.lines,Nc(s,"label",this,l)),ud(u.after,sf(Nc(s,"afterLabel",this,l))),i.push(u)}),i}getAfterBody(e,n){return D9(Nc(n.callbacks,"afterBody",this,e))}getFooter(e,n){const{callbacks:r}=n,i=Nc(r,"beforeFooter",this,e),l=Nc(r,"footer",this,e),u=Nc(r,"afterFooter",this,e);let s=[];return s=ud(s,sf(i)),s=ud(s,sf(l)),s=ud(s,sf(u)),s}_createItems(e){const n=this._active,r=this.chart.data,i=[],l=[],u=[];let s=[],v,w;for(v=0,w=n.length;v<w;++v)s.push(KIe(this.chart,n[v]));return e.filter&&(s=s.filter((A,F,W)=>e.filter(A,F,W,r))),e.itemSort&&(s=s.sort((A,F)=>e.itemSort(A,F,r))),Ks(s,A=>{const F=k9(e.callbacks,A);i.push(Nc(F,"labelColor",this,A)),l.push(Nc(F,"labelPointStyle",this,A)),u.push(Nc(F,"labelTextColor",this,A))}),this.labelColors=i,this.labelPointStyles=l,this.labelTextColors=u,this.dataPoints=s,s}update(e,n){const r=this.options.setContext(this.getContext()),i=this._active;let l,u=[];if(!i.length)this.opacity!==0&&(l={opacity:0});else{const s=db[r.position].call(this,i,this._eventPosition);u=this._createItems(r),this.title=this.getTitle(u,r),this.beforeBody=this.getBeforeBody(u,r),this.body=this.getBody(u,r),this.afterBody=this.getAfterBody(u,r),this.footer=this.getFooter(u,r);const v=this._size=R9(this,r),w=Object.assign({},s,v),A=M9(this.chart,r,w),F=P9(r,w,A,this.chart);this.xAlign=A.xAlign,this.yAlign=A.yAlign,l={opacity:1,x:F.x,y:F.y,width:v.width,height:v.height,caretX:s.x,caretY:s.y}}this._tooltipItems=u,this.$context=void 0,l&&this._resolveAnimations().update(this,l),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(e,n,r,i){const l=this.getCaretPosition(e,r,i);n.lineTo(l.x1,l.y1),n.lineTo(l.x2,l.y2),n.lineTo(l.x3,l.y3)}getCaretPosition(e,n,r){const{xAlign:i,yAlign:l}=this,{caretSize:u,cornerRadius:s}=r,{topLeft:v,topRight:w,bottomLeft:A,bottomRight:F}=Sy(s),{x:W,y:K}=e,{width:Q,height:Z}=n;let oe,ae,me,pe,_e,De;return l==="center"?(_e=K+Z/2,i==="left"?(oe=W,ae=oe-u,pe=_e+u,De=_e-u):(oe=W+Q,ae=oe+u,pe=_e-u,De=_e+u),me=oe):(i==="left"?ae=W+Math.max(v,A)+u:i==="right"?ae=W+Q-Math.max(w,F)-u:ae=this.caretX,l==="top"?(pe=K,_e=pe-u,oe=ae-u,me=ae+u):(pe=K+Z,_e=pe+u,oe=ae+u,me=ae-u),De=pe),{x1:oe,x2:ae,x3:me,y1:pe,y2:_e,y3:De}}drawTitle(e,n,r){const i=this.title,l=i.length;let u,s,v;if(l){const w=Ty(r.rtl,this.x,this.width);for(e.x=uT(this,r.titleAlign,r),n.textAlign=w.textAlign(r.titleAlign),n.textBaseline="middle",u=Jl(r.titleFont),s=r.titleSpacing,n.fillStyle=r.titleColor,n.font=u.string,v=0;v<l;++v)n.fillText(i[v],w.x(e.x),e.y+u.lineHeight/2),e.y+=u.lineHeight+s,v+1===l&&(e.y+=r.titleMarginBottom-s)}}_drawColorBox(e,n,r,i,l){const u=this.labelColors[r],s=this.labelPointStyles[r],{boxHeight:v,boxWidth:w}=l,A=Jl(l.bodyFont),F=uT(this,"left",l),W=i.x(F),K=v<A.lineHeight?(A.lineHeight-v)/2:0,Q=n.y+K;if(l.usePointStyle){const Z={radius:Math.min(w,v)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},oe=i.leftForLtr(W,w)+w/2,ae=Q+v/2;e.strokeStyle=l.multiKeyBackground,e.fillStyle=l.multiKeyBackground,AN(e,Z,oe,ae),e.strokeStyle=u.borderColor,e.fillStyle=u.backgroundColor,AN(e,Z,oe,ae)}else{e.lineWidth=gs(u.borderWidth)?Math.max(...Object.values(u.borderWidth)):u.borderWidth||1,e.strokeStyle=u.borderColor,e.setLineDash(u.borderDash||[]),e.lineDashOffset=u.borderDashOffset||0;const Z=i.leftForLtr(W,w),oe=i.leftForLtr(i.xPlus(W,1),w-2),ae=Sy(u.borderRadius);Object.values(ae).some(me=>me!==0)?(e.beginPath(),e.fillStyle=l.multiKeyBackground,vI(e,{x:Z,y:Q,w,h:v,radius:ae}),e.fill(),e.stroke(),e.fillStyle=u.backgroundColor,e.beginPath(),vI(e,{x:oe,y:Q+1,w:w-2,h:v-2,radius:ae}),e.fill()):(e.fillStyle=l.multiKeyBackground,e.fillRect(Z,Q,w,v),e.strokeRect(Z,Q,w,v),e.fillStyle=u.backgroundColor,e.fillRect(oe,Q+1,w-2,v-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,n,r){const{body:i}=this,{bodySpacing:l,bodyAlign:u,displayColors:s,boxHeight:v,boxWidth:w,boxPadding:A}=r,F=Jl(r.bodyFont);let W=F.lineHeight,K=0;const Q=Ty(r.rtl,this.x,this.width),Z=function(fe){n.fillText(fe,Q.x(e.x+K),e.y+W/2),e.y+=W+l},oe=Q.textAlign(u);let ae,me,pe,_e,De,Ae,re;for(n.textAlign=u,n.textBaseline="middle",n.font=F.string,e.x=uT(this,oe,r),n.fillStyle=r.bodyColor,Ks(this.beforeBody,Z),K=s&&oe!=="right"?u==="center"?w/2+A:w+2+A:0,_e=0,Ae=i.length;_e<Ae;++_e){for(ae=i[_e],me=this.labelTextColors[_e],n.fillStyle=me,Ks(ae.before,Z),pe=ae.lines,s&&pe.length&&(this._drawColorBox(n,e,_e,Q,r),W=Math.max(F.lineHeight,v)),De=0,re=pe.length;De<re;++De)Z(pe[De]),W=F.lineHeight;Ks(ae.after,Z)}K=0,W=F.lineHeight,Ks(this.afterBody,Z),e.y-=l}drawFooter(e,n,r){const i=this.footer,l=i.length;let u,s;if(l){const v=Ty(r.rtl,this.x,this.width);for(e.x=uT(this,r.footerAlign,r),e.y+=r.footerMarginTop,n.textAlign=v.textAlign(r.footerAlign),n.textBaseline="middle",u=Jl(r.footerFont),n.fillStyle=r.footerColor,n.font=u.string,s=0;s<l;++s)n.fillText(i[s],v.x(e.x),e.y+u.lineHeight/2),e.y+=u.lineHeight+r.footerSpacing}}drawBackground(e,n,r,i){const{xAlign:l,yAlign:u}=this,{x:s,y:v}=e,{width:w,height:A}=r,{topLeft:F,topRight:W,bottomLeft:K,bottomRight:Q}=Sy(i.cornerRadius);n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.beginPath(),n.moveTo(s+F,v),u==="top"&&this.drawCaret(e,n,r,i),n.lineTo(s+w-W,v),n.quadraticCurveTo(s+w,v,s+w,v+W),u==="center"&&l==="right"&&this.drawCaret(e,n,r,i),n.lineTo(s+w,v+A-Q),n.quadraticCurveTo(s+w,v+A,s+w-Q,v+A),u==="bottom"&&this.drawCaret(e,n,r,i),n.lineTo(s+K,v+A),n.quadraticCurveTo(s,v+A,s,v+A-K),u==="center"&&l==="left"&&this.drawCaret(e,n,r,i),n.lineTo(s,v+F),n.quadraticCurveTo(s,v,s+F,v),n.closePath(),n.fill(),i.borderWidth>0&&n.stroke()}_updateAnimationTarget(e){const n=this.chart,r=this.$animations,i=r&&r.x,l=r&&r.y;if(i||l){const u=db[e.position].call(this,this._active,this._eventPosition);if(!u)return;const s=this._size=R9(this,e),v=Object.assign({},u,this._size),w=M9(n,e,v),A=P9(e,v,w,n);(i._to!==A.x||l._to!==A.y)&&(this.xAlign=w.xAlign,this.yAlign=w.yAlign,this.width=s.width,this.height=s.height,this.caretX=u.x,this.caretY=u.y,this._resolveAnimations().update(this,A))}}_willRender(){return!!this.opacity}draw(e){const n=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(n);const i={width:this.width,height:this.height},l={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const u=Xu(n.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&s&&(e.save(),e.globalAlpha=r,this.drawBackground(l,e,i,n),NJ(e,n.textDirection),l.y+=u.top,this.drawTitle(l,e,n),this.drawBody(l,e,n),this.drawFooter(l,e,n),OJ(e,n.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,n){const r=this._active,i=e.map(({datasetIndex:s,index:v})=>{const w=this.chart.getDatasetMeta(s);if(!w)throw new Error("Cannot find a dataset at index "+s);return{datasetIndex:s,element:w.data[v],index:v}}),l=!_I(r,i),u=this._positionChanged(i,n);(l||u)&&(this._active=i,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,n,r=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,l=this._active||[],u=this._getActiveElements(e,l,n,r),s=this._positionChanged(u,e),v=n||!_I(u,l)||s;return v&&(this._active=u,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,n))),v}_getActiveElements(e,n,r,i){const l=this.options;if(e.type==="mouseout")return[];if(!i)return n.filter(s=>this.chart.data.datasets[s.datasetIndex]&&this.chart.getDatasetMeta(s.datasetIndex).controller.getParsed(s.index)!==void 0);const u=this.chart.getElementsAtEventForMode(e,l.mode,l,r);return l.reverse&&u.reverse(),u}_positionChanged(e,n){const{caretX:r,caretY:i,options:l}=this,u=db[l.position].call(this,e,n);return u!==!1&&(r!==u.x||i!==u.y)}}var aF={id:"tooltip",_element:N9,positioners:db,afterInit(t,e,n){n&&(t.tooltip=new N9({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:oee},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const rAe=(t,e,n,r)=>(typeof e=="string"?(n=t.push(e)-1,r.unshift({index:n,label:e})):isNaN(e)&&(n=null),n);function iAe(t,e,n,r){const i=t.indexOf(e);if(i===-1)return rAe(t,e,n,r);const l=t.lastIndexOf(e);return i!==l?n:i}const sAe=(t,e)=>t===null?null:fu(Math.round(t),0,e);function O9(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class lF extends kx{static id="category";static defaults={ticks:{callback:O9}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const n=this._addedLabels;if(n.length){const r=this.getLabels();for(const{index:i,label:l}of n)r[i]===l&&r.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,n){if(Hs(e))return null;const r=this.getLabels();return n=isFinite(n)&&r[n]===e?n:iAe(r,e,hs(n,e),this._addedLabels),sAe(n,r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:r,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(r=0),n||(i=this.getLabels().length-1)),this.min=r,this.max=i}buildTicks(){const e=this.min,n=this.max,r=this.options.offset,i=[];let l=this.getLabels();l=e===0&&n===l.length-1?l:l.slice(e,n+1),this._valueRange=Math.max(l.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let u=e;u<=n;u++)i.push({value:u});return i}getLabelForValue(e){return O9.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function oAe(t,e){const n=[],{bounds:i,step:l,min:u,max:s,precision:v,count:w,maxTicks:A,maxDigits:F,includeBounds:W}=t,K=l||1,Q=A-1,{min:Z,max:oe}=e,ae=!Hs(u),me=!Hs(s),pe=!Hs(w),_e=(oe-Z)/(F+1);let De=P7((oe-Z)/Q/K)*K,Ae,re,fe,ye;if(De<1e-14&&!ae&&!me)return[{value:Z},{value:oe}];ye=Math.ceil(oe/De)-Math.floor(Z/De),ye>Q&&(De=P7(ye*De/Q/K)*K),Hs(v)||(Ae=Math.pow(10,v),De=Math.ceil(De*Ae)/Ae),i==="ticks"?(re=Math.floor(Z/De)*De,fe=Math.ceil(oe/De)*De):(re=Z,fe=oe),ae&&me&&l&&mSe((s-u)/l,De/1e3)?(ye=Math.round(Math.min((s-u)/De,A)),De=(s-u)/ye,re=u,fe=s):pe?(re=ae?u:re,fe=me?s:fe,ye=w-1,De=(fe-re)/ye):(ye=(fe-re)/De,Lb(ye,Math.round(ye),De/1e3)?ye=Math.round(ye):ye=Math.ceil(ye));const ue=Math.max(D7(De),D7(re));Ae=Math.pow(10,Hs(v)?ue:v),re=Math.round(re*Ae)/Ae,fe=Math.round(fe*Ae)/Ae;let Ie=0;for(ae&&(W&&re!==u?(n.push({value:u}),re<u&&Ie++,Lb(Math.round((re+Ie*De)*Ae)/Ae,u,L9(u,_e,t))&&Ie++):re<u&&Ie++);Ie<ye;++Ie){const Oe=Math.round((re+Ie*De)*Ae)/Ae;if(me&&Oe>s)break;n.push({value:Oe})}return me&&W&&fe!==s?n.length&&Lb(n[n.length-1].value,s,L9(s,_e,t))?n[n.length-1].value=s:n.push({value:s}):(!me||fe===s)&&n.push({value:fe}),n}function L9(t,e,{horizontal:n,minRotation:r}){const i=Wg(r),l=(n?Math.sin(i):Math.cos(i))||.001,u=.75*e*(""+t).length;return Math.min(e/l,u)}class aAe extends kx{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,n){return Hs(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:n,maxDefined:r}=this.getUserBounds();let{min:i,max:l}=this;const u=v=>i=n?i:v,s=v=>l=r?l:v;if(e){const v=Rd(i),w=Rd(l);v<0&&w<0?s(0):v>0&&w>0&&u(0)}if(i===l){let v=l===0?1:Math.abs(l*.05);s(l+v),e||u(i-v)}this.min=i,this.max=l}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:n,stepSize:r}=e,i;return r?(i=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),n=n||11),n&&(i=Math.min(n,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,n=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const i={maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},l=this._range||this,u=oAe(i,l);return e.bounds==="ticks"&&gSe(u,this,"value"),e.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}configure(){const e=this.ticks;let n=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const i=(r-n)/Math.max(e.length-1,1)/2;n-=i,r+=i}this._startValue=n,this._endValue=r,this._valueRange=r-n}getLabelForValue(e){return SJ(e,this.chart.options.locale,this.options.ticks.format)}}class cF extends aAe{static id="linear";static defaults={ticks:{callback:TJ.formatters.numeric}};determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=rc(e)?e:0,this.max=rc(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),n=e?this.width:this.height,r=Wg(this.options.ticks.minRotation),i=(e?Math.sin(r):Math.cos(r))||.001,l=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,l.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const iR={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},jc=Object.keys(iR);function F9(t,e){return t-e}function B9(t,e){if(Hs(e))return null;const n=t._adapter,{parser:r,round:i,isoWeekday:l}=t._parseOpts;let u=e;return typeof r=="function"&&(u=r(u)),rc(u)||(u=typeof r=="string"?n.parse(u,r):n.parse(u)),u===null?null:(i&&(u=i==="week"&&(Pw(l)||l===!0)?n.startOf(u,"isoWeek",l):n.startOf(u,i)),+u)}function z9(t,e,n,r){const i=jc.length;for(let l=jc.indexOf(t);l<i-1;++l){const u=iR[jc[l]],s=u.steps?u.steps:Number.MAX_SAFE_INTEGER;if(u.common&&Math.ceil((n-e)/(s*u.size))<=r)return jc[l]}return jc[i-1]}function lAe(t,e,n,r,i){for(let l=jc.length-1;l>=jc.indexOf(n);l--){const u=jc[l];if(iR[u].common&&t._adapter.diff(i,r,u)>=e-1)return u}return jc[n?jc.indexOf(n):0]}function cAe(t){for(let e=jc.indexOf(t)+1,n=jc.length;e<n;++e)if(iR[jc[e]].common)return jc[e]}function j9(t,e,n){if(!n)t[e]=!0;else if(n.length){const{lo:r,hi:i}=Y4(n,e),l=n[r]>=e?n[r]:n[i];t[l]=!0}}function uAe(t,e,n,r){const i=t._adapter,l=+i.startOf(e[0].value,r),u=e[e.length-1].value;let s,v;for(s=l;s<=u;s=+i.add(s,1,r))v=n[s],v>=0&&(e[v].major=!0);return e}function V9(t,e,n){const r=[],i={},l=e.length;let u,s;for(u=0;u<l;++u)s=e[u],i[s]=u,r.push({value:s,major:!1});return l===0||!n?r:uAe(t,r,i,n)}class U9 extends kx{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,n={}){const r=e.time||(e.time={}),i=this._adapter=new eCe._date(e.adapters.date);i.init(n),Ob(r.displayFormats,i.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=n.normalized}parse(e,n){return e===void 0?null:B9(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,n=this._adapter,r=e.time.unit||"day";let{min:i,max:l,minDefined:u,maxDefined:s}=this.getUserBounds();function v(w){!u&&!isNaN(w.min)&&(i=Math.min(i,w.min)),!s&&!isNaN(w.max)&&(l=Math.max(l,w.max))}(!u||!s)&&(v(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&v(this.getMinMax(!1))),i=rc(i)&&!isNaN(i)?i:+n.startOf(Date.now(),r),l=rc(l)&&!isNaN(l)?l:+n.endOf(Date.now(),r)+1,this.min=Math.min(i,l-1),this.max=Math.max(i+1,l)}_getLabelBounds(){const e=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(n=e[0],r=e[e.length-1]),{min:n,max:r}}buildTicks(){const e=this.options,n=e.time,r=e.ticks,i=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const l=this.min,u=this.max,s=wSe(i,l,u);return this._unit=n.unit||(r.autoSkip?z9(n.minUnit,this.min,this.max,this._getLabelCapacity(l)):lAe(this,s.length,n.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:cAe(this._unit),this.initOffsets(i),e.reverse&&s.reverse(),V9(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let n=0,r=0,i,l;this.options.offset&&e.length&&(i=this.getDecimalForValue(e[0]),e.length===1?n=1-i:n=(this.getDecimalForValue(e[1])-i)/2,l=this.getDecimalForValue(e[e.length-1]),e.length===1?r=l:r=(l-this.getDecimalForValue(e[e.length-2]))/2);const u=e.length<3?.5:.25;n=fu(n,0,u),r=fu(r,0,u),this._offsets={start:n,end:r,factor:1/(n+1+r)}}_generate(){const e=this._adapter,n=this.min,r=this.max,i=this.options,l=i.time,u=l.unit||z9(l.minUnit,n,r,this._getLabelCapacity(n)),s=hs(i.ticks.stepSize,1),v=u==="week"?l.isoWeekday:!1,w=Pw(v)||v===!0,A={};let F=n,W,K;if(w&&(F=+e.startOf(F,"isoWeek",v)),F=+e.startOf(F,w?"day":u),e.diff(r,n,u)>1e5*s)throw new Error(n+" and "+r+" are too far apart with stepSize of "+s+" "+u);const Q=i.ticks.source==="data"&&this.getDataTimestamps();for(W=F,K=0;W<r;W=+e.add(W,s,u),K++)j9(A,W,Q);return(W===r||i.bounds==="ticks"||K===1)&&j9(A,W,Q),Object.keys(A).sort(F9).map(Z=>+Z)}getLabelForValue(e){const n=this._adapter,r=this.options.time;return r.tooltipFormat?n.format(e,r.tooltipFormat):n.format(e,r.displayFormats.datetime)}format(e,n){const i=this.options.time.displayFormats,l=this._unit,u=n||i[l];return this._adapter.format(e,u)}_tickFormatFunction(e,n,r,i){const l=this.options,u=l.ticks.callback;if(u)return Co(u,[e,n,r],this);const s=l.time.displayFormats,v=this._unit,w=this._majorUnit,A=v&&s[v],F=w&&s[w],W=r[n],K=w&&F&&W&&W.major;return this._adapter.format(e,i||(K?F:A))}generateTickLabels(e){let n,r,i;for(n=0,r=e.length;n<r;++n)i=e[n],i.label=this._tickFormatFunction(i.value,n,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const n=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((n.start+r)*n.factor)}getValueForPixel(e){const n=this._offsets,r=this.getDecimalForPixel(e)/n.factor-n.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const n=this.options.ticks,r=this.ctx.measureText(e).width,i=Wg(this.isHorizontal()?n.maxRotation:n.minRotation),l=Math.cos(i),u=Math.sin(i),s=this._resolveTickFontOptions(0).size;return{w:r*l+s*u,h:r*u+s*l}}_getLabelCapacity(e){const n=this.options.time,r=n.displayFormats,i=r[n.unit]||r.millisecond,l=this._tickFormatFunction(e,0,V9(this,[e],this._majorUnit),i),u=this._getLabelSize(l),s=Math.floor(this.isHorizontal()?this.width/u.w:this.height/u.h)-1;return s>0?s:1}getDataTimestamps(){let e=this._cache.data||[],n,r;if(e.length)return e;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(n=0,r=i.length;n<r;++n)e=e.concat(i[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let n,r;if(e.length)return e;const i=this.getLabels();for(n=0,r=i.length;n<r;++n)e.push(B9(this,i[n]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return bJ(e.sort(F9))}}function hT(t,e,n){let r=0,i=t.length-1,l,u,s,v;n?(e>=t[r].pos&&e<=t[i].pos&&({lo:r,hi:i}=$g(t,"pos",e)),{pos:l,time:s}=t[r],{pos:u,time:v}=t[i]):(e>=t[r].time&&e<=t[i].time&&({lo:r,hi:i}=$g(t,"time",e)),{time:l,pos:s}=t[r],{time:u,pos:v}=t[i]);const w=u-l;return w?s+(v-s)*(e-l)/w:s}class J5e extends U9{static id="timeseries";static defaults=U9.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(e);this._minPos=hT(n,this.min),this._tableRange=hT(n,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:n,max:r}=this,i=[],l=[];let u,s,v,w,A;for(u=0,s=e.length;u<s;++u)w=e[u],w>=n&&w<=r&&i.push(w);if(i.length<2)return[{time:n,pos:0},{time:r,pos:1}];for(u=0,s=i.length;u<s;++u)A=i[u+1],v=i[u-1],w=i[u],Math.round((A+v)/2)!==w&&l.push({time:w,pos:u/(s-1)});return l}_generate(){const e=this.min,n=this.max;let r=super.getDataTimestamps();return(!r.includes(e)||!r.length)&&r.splice(0,0,e),(!r.includes(n)||r.length===1)&&r.push(n),r.sort((i,l)=>i-l)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const n=this.getDataTimestamps(),r=this.getLabelTimestamps();return n.length&&r.length?e=this.normalize(n.concat(r)):e=n.length?n:r,e=this._cache.all=e,e}getDecimalForValue(e){return(hT(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const n=this._offsets,r=this.getDecimalForPixel(e)/n.factor-n.end;return hT(this._table,r*this._tableRange+this._minPos,!0)}}const aee="label";function H9(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function hAe(t,e){const n=t.options;n&&e&&Object.assign(n,e)}function lee(t,e){t.labels=e}function cee(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:aee;const r=[];t.datasets=e.map(i=>{const l=t.datasets.find(u=>u[n]===i[n]);return!l||!i.data||r.includes(l)?{...i}:(r.push(l),Object.assign(l,i),l)})}function dAe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:aee;const n={labels:[],datasets:[]};return lee(n,t.labels),cee(n,t.datasets,e),n}function fAe(t,e){const{height:n=150,width:r=300,redraw:i=!1,datasetIdKey:l,type:u,data:s,options:v,plugins:w=[],fallbackContent:A,updateMode:F,...W}=t,K=se.useRef(null),Q=se.useRef(null),Z=()=>{K.current&&(Q.current=new Nx(K.current,{type:u,data:dAe(s,l),options:v&&{...v},plugins:w}),H9(e,Q.current))},oe=()=>{H9(e,null),Q.current&&(Q.current.destroy(),Q.current=null)};return se.useEffect(()=>{!i&&Q.current&&v&&hAe(Q.current,v)},[i,v]),se.useEffect(()=>{!i&&Q.current&&lee(Q.current.config.data,s.labels)},[i,s.labels]),se.useEffect(()=>{!i&&Q.current&&s.datasets&&cee(Q.current.config.data,s.datasets,l)},[i,s.datasets]),se.useEffect(()=>{Q.current&&(i?(oe(),setTimeout(Z)):Q.current.update(F))},[i,v,s.labels,s.datasets,F]),se.useEffect(()=>{Q.current&&(oe(),setTimeout(Z))},[u]),se.useEffect(()=>(Z(),()=>oe()),[]),fa.createElement("canvas",{ref:K,role:"img",height:n,width:r,...W},A)}const pAe=se.forwardRef(fAe);function uee(t,e){return Nx.register(e),se.forwardRef((n,r)=>fa.createElement(pAe,{...n,ref:r,type:t}))}const mAe=uee("line",JTe),hee=uee("bar",QTe);Nx.register(lF,cF,yIe,rR,oF,aF,sF,HIe);const gAe=({data:t})=>{const e={labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:"Distribution Volume ($k)",data:t||[25,30,35,40,35,30],borderColor:"hsl(262, 58%, 55%)",backgroundColor:"hsla(262, 58%, 55%, 0.1)",tension:.4,fill:!0}]},n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}}};return R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"Distribution Volume By Month"}),R.jsx("div",{className:"h-60 w-full",children:R.jsx(mAe,{data:e,options:n})})]})};Nx.register(lF,cF,tee,oF,aF,sF);const _Ae=({data:t})=>{const e={labels:["Food","Water","Medicine","Shelter","Clothing"],datasets:[{label:"Distribution by Type",data:t||[65,40,55,30,70],backgroundColor:["hsl(262, 58%, 55%)","hsl(330, 100%, 71%)","hsl(187, 85%, 43%)","hsl(38, 92%, 50%)","hsl(270, 95%, 60%)"],borderWidth:0,borderRadius:4}]},n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}}};return R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"Aid Items Distribution by Type"}),R.jsx("div",{className:"h-60 w-full",children:R.jsx(hee,{data:e,options:n})})]})};Nx.register(lF,cF,tee,oF,aF,sF);const yAe=({data:t})=>{const e={labels:["Jan","Feb","Mar","Apr","May"],datasets:[{label:"Average Days to Deliver",data:t||[1.2,2.3,2.8,2.5,3.5],backgroundColor:["hsl(262, 58%, 55%)","hsl(38, 92%, 50%)","hsl(187, 85%, 43%)","hsl(330, 100%, 71%)","hsl(270, 95%, 60%)"],borderWidth:0,borderRadius:4}]},n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}}};return R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"Average Distribution Time"}),R.jsx("div",{className:"h-60 w-full",children:R.jsx(hee,{data:e,options:n})})]})},xAe=()=>R.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[R.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[R.jsx("div",{children:R.jsx("h2",{className:"text-xl font-semibold",children:"Distribution Analytics"})}),R.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-2",children:[R.jsx("button",{className:"bg-gray-200 text-gray-800 py-1.5 px-3 rounded-md text-sm font-medium",children:"Last 30 Days"}),R.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-800 py-1.5 px-3 rounded-md text-sm font-medium",children:"All Locations"}),R.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-800 py-1.5 px-3 rounded-md text-sm font-medium",children:"All Aid type"})]})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Total Aid Distributed"}),R.jsx("p",{className:"text-2xl font-bold",children:"$12,450,000"})]}),R.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[R.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Beneficiaries Served"}),R.jsx("p",{className:"text-2xl font-bold",children:"2000+"})]})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Distribution Trends Over Time"}),R.jsx(gAe,{data:YD.distributionTrends})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Most Requested Aid Types"}),R.jsx(_Ae,{data:YD.aidTypes})]}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Service Efficiency"}),R.jsx(yAe,{data:YD.serviceEfficiency})]})]}),Ma={PENDING:"pending",PREPARING:"preparing",READY_FOR_PICKUP:"ready_for_pickup",IN_TRANSIT:"in_transit",DELIVERED:"delivered",CANCELLED:"cancelled"},vAe=()=>{const{distributions:t,loading:e,error:n,lastUpdate:r,createDistribution:i,updateDistributionStatus:l,cancelDistribution:u,refresh:s}=TK(),[v,w]=se.useState(null),{aidRequests:A,getAidRequestById:F}=R_(),{inventory:W,getInventoryItem:K}=y2(),{currentUser:Q,canCreateDistribution:Z,canUpdateDistribution:oe,user:ae}=Yo(),{toast:me}=wc(),[pe,_e]=se.useState([]),[De,Ae]=se.useState("all"),[re,fe]=se.useState(""),[ye,ue]=se.useState("createdAt"),[Ie,Oe]=se.useState("desc"),[ze,ft]=se.useState(!1),[He,bt]=se.useState(!1),[Nt,wt]=se.useState(null),[it,nn]=se.useState({id:null,deliveryDetails:{method:"pickup",assignedTo:"",estimatedDelivery:"",pickupLocation:"",notes:""},items:[]}),[In,wn]=se.useState({}),[Xt,On]=se.useState([]),[cr,En]=se.useState([]);se.useEffect(()=>{const jt=A.filter(Ln=>(Ln.status==="approved"||Ln.status==="in_progress")&&!t.some(un=>un.requestId===Ln.id));On(jt)},[A,t]),se.useEffect(()=>{async function jt(){const Ln=await fJ();En(Ln.filter(un=>un.role==="staff"||un.role==="volunteer"))}jt()},[]),se.useEffect(()=>{let jt=[...t];if(De!=="all"&&(jt=jt.filter(Ln=>Ln.status===De)),re){const Ln=re.toLowerCase();jt=jt.filter(un=>{const Xn=F(un.requestId);return un.id.toString().includes(Ln)||un.assignedTo.toLowerCase().includes(Ln)||Xn&&Xn.location.toLowerCase().includes(Ln)||un.notes&&un.notes.toLowerCase().includes(Ln)})}jt.sort((Ln,un)=>{let Xn,Ni;return ye==="createdAt"||ye==="estimatedDelivery"?(Xn=new Date(Ln[ye]).getTime(),Ni=new Date(un[ye]).getTime()):ye==="status"?(Xn=Ln.status,Ni=un.status):ye==="requestId"?(Xn=Ln.requestId,Ni=un.requestId):(Xn=Ln[ye],Ni=un[ye]),Ie==="asc"?Xn>Ni?1:-1:Xn<Ni?1:-1}),_e(jt)},[t,De,re,ye,Ie,F]);const fn=jt=>{const{name:Ln,value:un}=jt.target;if(Ln==="volunteerId"){const Xn=cr.find(Ni=>Ni.id===un);nn(Ni=>({...Ni,deliveryDetails:{...Ni.deliveryDetails,volunteerId:un,assignedTo:Xn?Xn.email:""}}))}else nn(Xn=>({...Xn,deliveryDetails:{...Xn.deliveryDetails,[Ln]:un}}))},ur=()=>{const jt={},{deliveryDetails:Ln}=it;return Nt||(jt.request="Please select an aid request"),Ln.method==="pickup"&&!Ln.pickupLocation.trim()&&(jt.pickupLocation="Pickup location is required"),Ln.method==="delivery"&&!Ln.assignedTo.trim()&&(jt.assignedTo="Delivery person is required"),Ln.method==="delivery"&&!Ln.estimatedDelivery&&(jt.estimatedDelivery="Estimated delivery date is required"),wn(jt),Object.keys(jt).length===0},br=async()=>{if(!ur())return;const jt={requestId:Nt.id,items:Nt.items,status:Ma.PENDING,...it.deliveryDetails},Ln=await i(jt);Ln.success?(me({title:"Success",description:"Distribution created successfully."}),wt(null),nn(un=>({...un,deliveryDetails:{method:"pickup",assignedTo:"",estimatedDelivery:"",pickupLocation:"",notes:""}})),ft(!1)):me({title:"Error",description:Ln.error||"Failed to create distribution.",variant:"destructive"})},Pe=async(jt,Ln)=>{const un=await l(jt,Ln);un.success?me({title:"Status Updated",description:`Distribution status updated to ${Ln.replace("_"," ")}.`}):me({title:"Error",description:un.error||"Failed to update status.",variant:"destructive"})},jn=async jt=>{if(!confirm("Are you sure you want to cancel this distribution?"))return;const Ln=await u(jt);Ln.success?me({title:"Distribution Cancelled",description:"Distribution has been cancelled successfully."}):me({title:"Error",description:Ln.error||"Failed to cancel distribution.",variant:"destructive"})},rr=jt=>{nn({id:jt.id,deliveryDetails:{method:jt.method,assignedTo:jt.assignedTo||"",estimatedDelivery:jt.estimatedDelivery?jt.estimatedDelivery:"",pickupLocation:jt.pickupLocation||"",notes:jt.notes||""},items:jt.items}),w(jt.id),bt(!0),console.log(jt)},Yn=()=>{const jt={};console.log(it.deliveryDetails),it.deliveryDetails.method==="pickup"&&!it.deliveryDetails.pickupLocation.trim()&&(jt.pickupLocation="Pickup location is required");const{deliveryDetails:Ln}=it;return Ln.method==="delivery"&&!Ln.assignedTo.trim()&&(jt.assignedTo="Delivery person is required"),Ln.method==="delivery"&&!Ln.estimatedDelivery&&(jt.estimatedDelivery="Estimated delivery date is required"),wn(jt),Object.keys(jt).length===0},Ot=async()=>{if(!Yn())return;const jt={id:it.id,items:it.items,...it.deliveryDetails};console.log(jt)},Sr=()=>{if(!v||!oe)return null;const{deliveryDetails:jt}=it;return R.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 border",children:[R.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Distribution"}),jt.method==="pickup"&&R.jsx(Sh,{type:"text",name:"pickupLocation",value:jt.pickupLocation,onChange:fn}),jt.method==="delivery"&&R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Assigned To *"}),R.jsxs("select",{className:"w-full border rounded px-3 py-2",name:"volunteerId",value:jt.volunteerId||"",onChange:fn,children:[R.jsx("option",{value:"",children:"Select staff or volunteer"}),cr.map(Ln=>R.jsxs("option",{value:Ln.id,children:[Ln.name," (",Ln.email,")"]},Ln.id))]}),In.assignedTo&&R.jsx("p",{className:"text-red-500 text-xs italic",children:In.assignedTo})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Estimated Delivery Date *"}),R.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",name:"estimatedDelivery",value:jt.estimatedDelivery,onChange:fn}),In.estimatedDelivery&&R.jsx("p",{className:"text-red-500 text-xs italic",children:In.estimatedDelivery})]})]}),R.jsx("div",{className:"flex justify-end",children:R.jsx(Bi,{onClick:()=>Ot(),className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline",children:"Update Distribution"})})]})},fi=jt=>{switch(jt){case Ma.PENDING:return"bg-yellow-100 text-yellow-800 border-yellow-300";case Ma.PREPARING:return"bg-blue-100 text-blue-800 border-blue-300";case Ma.READY_FOR_PICKUP:return"bg-purple-100 text-purple-800 border-purple-300";case Ma.IN_TRANSIT:return"bg-indigo-100 text-indigo-800 border-indigo-300";case Ma.DELIVERED:return"bg-green-100 text-green-800 border-green-300";case Ma.CANCELLED:return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},Wr=jt=>{switch(jt){case Ma.PENDING:return Ma.PREPARING;case Ma.PREPARING:return Ma.READY_FOR_PICKUP;case Ma.READY_FOR_PICKUP:return Ma.IN_TRANSIT;case Ma.IN_TRANSIT:return Ma.DELIVERED;default:return null}},Mn=jt=>{const Ln=F(jt.requestId);return Ln?R.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("h4",{className:"text-md font-semibold mb-2",children:"Request Details"}),R.jsxs("p",{children:[R.jsx("span",{className:"font-medium",children:"Location:"})," ",Ln.location]}),R.jsxs("p",{children:[R.jsx("span",{className:"font-medium",children:"Priority:"})," ",Ln.priority]}),R.jsxs("p",{children:[R.jsx("span",{className:"font-medium",children:"Requested:"})," ",new Date(Ln.createdAt).toLocaleDateString()]})]}),R.jsxs("div",{children:[R.jsx("h4",{className:"text-md font-semibold mb-2",children:"Distribution Details"}),R.jsxs("p",{children:[R.jsx("span",{className:"font-medium",children:"Method:"}),jt.method==="pickup"?"Pickup":"Delivery"]}),jt.method==="pickup"&&R.jsxs("p",{children:[R.jsx("span",{className:"font-medium",children:"Pickup Location:"})," ",jt.pickupLocation]}),jt.method==="delivery"&&R.jsxs(R.Fragment,{children:[R.jsxs("p",{children:[R.jsx("span",{className:"font-medium",children:"Assigned To:"})," ",jt.assignedTo]}),R.jsxs("p",{children:[R.jsx("span",{className:"font-medium",children:"Estimated Delivery:"}),new Date(jt.estimatedDelivery).toLocaleDateString()]})]})]})]}),R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"text-md font-semibold mb-2",children:"Items"}),R.jsx("div",{className:"overflow-x-auto",children:R.jsxs("table",{className:"min-w-full bg-white",children:[R.jsx("thead",{children:R.jsxs("tr",{className:"bg-gray-100 text-gray-700 text-left",children:[R.jsx("th",{className:"py-2 px-3 font-semibold",children:"Item"}),R.jsx("th",{className:"py-2 px-3 font-semibold",children:"Quantity"}),R.jsx("th",{className:"py-2 px-3 font-semibold",children:"Unit"}),R.jsx("th",{className:"py-2 px-3 font-semibold",children:"Status"})]})}),R.jsx("tbody",{className:"divide-y divide-gray-200",children:jt.items.map((un,Xn)=>{const Ni=K(un.itemId),Bn=Ni&&Ni.quantity>=un.quantity;return R.jsxs("tr",{children:[R.jsx("td",{className:"py-2 px-3",children:un.name}),R.jsx("td",{className:"py-2 px-3",children:un.quantity}),R.jsx("td",{className:"py-2 px-3",children:un.unit}),R.jsx("td",{className:"py-2 px-3",children:R.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${Bn?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:Bn?"Available":"Insufficient"})})]},Xn)})})]})})]}),jt.notes&&R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"text-md font-semibold mb-2",children:"Notes"}),R.jsx("p",{className:"text-gray-700",children:jt.notes})]})]}):null};return e?R.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:R.jsx("div",{className:"animate-pulse flex space-x-4",children:R.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[R.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),R.jsxs("div",{className:"space-y-2",children:[R.jsx("div",{className:"h-4 bg-gray-200 rounded"}),R.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})}):n?R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500",children:[R.jsx("h2",{className:"text-xl font-semibold text-red-700 mb-4",children:"Error"}),R.jsx("p",{className:"text-gray-700",children:n})]}):R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[R.jsxs("div",{className:"flex justify-between items-center mb-6",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-semibold",children:"Distribution Management"}),r&&R.jsxs("p",{className:"text-sm text-gray-500",children:["Last updated: ",new Date(r).toLocaleString()]})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("button",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:s,title:"Refresh",children:" Refresh"}),(ae?.role==="admin"||ae?.role==="staff")&&R.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:()=>ft(!0),children:"+ New Distribution"})]})]}),ze&&R.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:R.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 w-full max-w-lg relative",children:[R.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700",onClick:()=>ft(!1),children:""}),R.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Create New Distribution"}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Aid Request *"}),R.jsxs("select",{className:"w-full border rounded px-3 py-2",value:Nt?Nt.id:"",onChange:jt=>{const Ln=A.find(un=>un.id===jt.target.value);wt(Ln)},children:[R.jsx("option",{value:"",children:"Select an approved or in_progress request"}),Xt.map(jt=>R.jsxs("option",{value:jt.id,children:[jt.name||jt.id," - ",jt.location]},jt.id))]}),In.request&&R.jsx("p",{className:"text-red-500 text-xs italic",children:In.request})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Delivery Method *"}),R.jsxs("select",{className:"w-full border rounded px-3 py-2",name:"method",value:it.deliveryDetails.method,onChange:fn,children:[R.jsx("option",{value:"pickup",children:"Pickup"}),R.jsx("option",{value:"delivery",children:"Delivery"})]})]}),it.deliveryDetails.method==="pickup"&&R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Pickup Location *"}),R.jsx("input",{className:"w-full border rounded px-3 py-2",name:"pickupLocation",value:it.deliveryDetails.pickupLocation,onChange:fn}),In.pickupLocation&&R.jsx("p",{className:"text-red-500 text-xs italic",children:In.pickupLocation})]}),it.deliveryDetails.method==="delivery"&&R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Assigned To *"}),R.jsxs("select",{className:"w-full border rounded px-3 py-2",name:"volunteerId",value:it.deliveryDetails.volunteerId||"",onChange:fn,children:[R.jsx("option",{value:"",children:"Select staff or volunteer"}),cr.map(jt=>R.jsxs("option",{value:jt.id,children:[jt.name," (",jt.email,")"]},jt.id))]}),In.assignedTo&&R.jsx("p",{className:"text-red-500 text-xs italic",children:In.assignedTo})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Estimated Delivery Date *"}),R.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",name:"estimatedDelivery",value:it.deliveryDetails.estimatedDelivery,onChange:fn}),In.estimatedDelivery&&R.jsx("p",{className:"text-red-500 text-xs italic",children:In.estimatedDelivery})]})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Notes"}),R.jsx("textarea",{className:"w-full border rounded px-3 py-2",name:"notes",value:it.deliveryDetails.notes,onChange:fn})]}),R.jsx("div",{className:"flex justify-end",children:R.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline",onClick:br,children:"Create Distribution"})})]})}),He&&Sr(),R.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"statusFilter",children:"Status"}),R.jsxs("select",{id:"statusFilter",value:De,onChange:jt=>Ae(jt.target.value),className:"shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[R.jsx("option",{value:"all",children:"All Statuses"}),Object.values(Ma).map(jt=>R.jsx("option",{value:jt,children:jt.replace("_"," ").replace(/\b\w/g,Ln=>Ln.toUpperCase())},jt))]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"sortBy",children:"Sort By"}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsxs("select",{id:"sortBy",value:ye,onChange:jt=>ue(jt.target.value),className:"shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[R.jsx("option",{value:"createdAt",children:"Created Date"}),R.jsx("option",{value:"estimatedDelivery",children:"Estimated Delivery"}),R.jsx("option",{value:"requestId",children:"Request ID"}),R.jsx("option",{value:"status",children:"Status"}),R.jsx("option",{value:"method",children:"Method"})]}),R.jsx("button",{onClick:()=>Oe(Ie==="asc"?"desc":"asc"),className:"bg-gray-200 hover:bg-gray-300 px-3 rounded",children:Ie==="asc"?"":""})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"search",children:"Search"}),R.jsx("input",{id:"search",type:"text",placeholder:"Search distributions...",value:re,onChange:jt=>fe(jt.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]})]}),pe.length===0?R.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:R.jsx("p",{className:"text-gray-500",children:"No distributions found matching your criteria."})}):R.jsx("div",{className:"space-y-6",children:pe.map(jt=>{F(jt.requestId);const Ln=Wr(jt.status);return R.jsxs("div",{className:"border rounded-lg overflow-hidden shadow",children:[R.jsxs("div",{className:"bg-gray-100 p-4 flex justify-between items-center",children:[R.jsxs("div",{children:[R.jsxs("h3",{className:"text-lg font-semibold",children:["Distribution #",jt.id," - Request #",jt.requestId]}),R.jsxs("p",{className:"text-sm text-gray-600",children:["Created: ",new Date(jt.createdAt).toLocaleDateString()]})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("span",{className:`px-3 py-1 rounded-full text-sm border ${fi(jt.status)}`,children:jt.status.replace("_"," ")}),R.jsx("span",{className:`text-sm ${jt.method==="pickup"?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800"} px-2 py-1 rounded-full`,children:jt.method==="pickup"?"Pickup":"Delivery"})]})]}),R.jsxs("div",{className:"p-4",children:[Mn(jt),jt.status!==Ma.DELIVERED&&jt.status!==Ma.CANCELLED&&Q&&oe&&R.jsx(Bi,{onClick:()=>rr(jt),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Edit"}),R.jsxs("div",{className:"mt-4 flex justify-end space-x-3",children:[Ln&&Q&&oe&&R.jsxs("button",{onClick:()=>Pe(jt.id,Ln),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:["Mark as ",Ln.replace("_"," ")]}),jt.status!==Ma.DELIVERED&&jt.status!==Ma.CANCELLED&&R.jsx("button",{onClick:()=>jn(jt.id),className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Cancel"})]})]})]},jt.id)})}),R.jsx("div",{className:"mt-6 text-right",children:R.jsxs("p",{className:"text-xs text-gray-500",children:["Data refreshes automatically. Last refresh: ",r?new Date(r).toLocaleTimeString():"N/A"]})})]})},bAe=()=>{const{loading:t,error:e}=TK();return R.jsxs("div",{className:"space-y-6",children:[R.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:R.jsxs("div",{children:[R.jsx("h1",{className:"text-2xl text-white font-bold",children:"Aid Distribution"}),R.jsx("p",{className:"text-sm text-gray-500",children:"Manage and track aid distributions to beneficiaries"})]})}),t?R.jsx("div",{className:"flex justify-center items-center h-64",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e?R.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:R.jsx("p",{className:"text-red-700",children:e})}):R.jsx(vAe,{})]})},wAe=()=>{const{toast:t}=wc(),{user:e}=Yo(),[n,r]=se.useState({name:"",email:"",subject:"general",message:"",rating:5}),[i,l]=se.useState(!1);se.useEffect(()=>{e&&r(v=>({...v,name:e.displayName||"",email:e.email||""}))},[e]);const u=v=>{const{name:w,value:A}=v.target;r(F=>({...F,[w]:A}))},s=async v=>{if(v.preventDefault(),!n.message.trim()){t({title:"Error",description:"Please provide a message in your feedback.",variant:"destructive"});return}l(!0);try{const w={name:n.name||null,email:n.email||null,subject:n.subject||"General",message:n.message,rating:n.rating,userId:e?.uid||null,createdAt:bw()};await tX(Td(ol,"feedback"),w),r({name:e?.displayName||"",email:e?.email||"",subject:"general",message:"",rating:5}),t({title:"Feedback Submitted",description:"Thank you for your feedback! We appreciate your input."})}catch(w){console.error("Error submitting feedback:",w),t({title:"Error",description:"Failed to submit feedback. Please try again later.",variant:"destructive"})}finally{l(!1)}};return R.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8",children:[R.jsx("h2",{className:"text-xl font-semibold mb-6",children:"SEND US FEEDBACK"}),R.jsxs("div",{className:"max-w-2xl mx-auto",children:[R.jsx("p",{className:"text-gray-600 mb-6",children:"Your feedback helps us improve our humanitarian aid distribution system. Please share your thoughts, suggestions, or report any issues you've encountered."}),R.jsxs("form",{onSubmit:s,className:"space-y-6",children:[R.jsxs("div",{children:[R.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Your Name"}),R.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",placeholder:"Your name (optional)"})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Your Email"}),R.jsx("input",{type:"email",id:"email",name:"email",value:n.email,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",placeholder:"Your email (optional)"})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 mb-1",children:"Feedback Category"}),R.jsxs("select",{id:"subject",name:"subject",value:n.subject,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",children:[R.jsx("option",{value:"general",children:"General Feedback"}),R.jsx("option",{value:"bug",children:"Report a Bug"}),R.jsx("option",{value:"feature",children:"Feature Request"}),R.jsx("option",{value:"usability",children:"Usability Issue"}),R.jsx("option",{value:"complaint",children:"Complaint"}),R.jsx("option",{value:"praise",children:"Praise"}),R.jsx("option",{value:"other",children:"Other"})]})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"rating",className:"block text-sm font-medium text-gray-700 mb-1",children:"How would you rate your experience? (1-10)"}),R.jsx("input",{type:"range",id:"rating",name:"rating",min:"1",max:"10",value:n.rating,onChange:u,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),R.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[R.jsx("span",{children:"1"}),R.jsx("span",{children:"2"}),R.jsx("span",{children:"3"}),R.jsx("span",{children:"4"}),R.jsx("span",{children:"5"}),R.jsx("span",{children:"6"}),R.jsx("span",{children:"7"}),R.jsx("span",{children:"8"}),R.jsx("span",{children:"9"}),R.jsx("span",{children:"10"})]}),R.jsxs("p",{className:"text-center mt-2",children:["Your rating: ",n.rating,"/10"]})]}),R.jsxs("div",{children:[R.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-1",children:"Your Feedback"}),R.jsx("textarea",{id:"message",name:"message",rows:"6",value:n.message,onChange:u,placeholder:"Please share your thoughts, suggestions, or report any issues...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0})]}),R.jsx("div",{className:"flex justify-end",children:R.jsx(Bi,{type:"submit",variant:"default",size:"lg",disabled:i,children:i?"Submitting...":"Submit Feedback"})})]}),R.jsxs("div",{className:"mt-8 text-center text-gray-600",children:[R.jsx("p",{children:"If you need immediate assistance, please contact us at:"}),R.jsx("p",{className:"font-medium",children:"support@hads.org"})]})]})]})},EAe=({onRequestSubmitted:t,request:e=null})=>{const{createAidRequest:n,updateAidRequest:r}=R_(),{inventory:i,aidItems:l}=y2(),{toast:u}=wc(),{user:s}=Yo(),v=se.useMemo(()=>{if(e){e.items;const re=e.notes||"",fe=[];return re.includes("Requested Items:")&&re.split("Requested Items:")[1].trim().split(`
`).filter(Ie=>Ie.trim()!=="").forEach(Ie=>{const Oe=Ie.split(":");if(Oe.length===2){const ze=Oe[0].trim().replace("-","").trim(),ft=Oe[1].trim().split(" "),He=parseInt(ft[0]),bt=ft.slice(1).join(" ")||"unit",Nt=l.find(wt=>wt.name.toLowerCase()===ze.toLowerCase());fe.push({itemId:Nt?Nt.id:"",name:ze,quantity:He,unit:bt})}}),{name:e.name||"",location:e.location||"",aidType:e.aidType||"",urgency:e.urgency||"medium",items:fe.length>0?fe:[{itemId:"",name:"",quantity:1,unit:""}],notes:re.split("Requested Items:")[0].trim()}}return{name:"",location:"",aidType:"",urgency:"medium",items:[{itemId:"",name:"",quantity:1,unit:""}],notes:""}},[e,l]),[w,A]=se.useState(v),[F,W]=se.useState({}),[K,Q]=se.useState([]);se.useEffect(()=>{if(l&&l.length>0)Q(l);else if(i.length>0){const re=i.filter(fe=>fe.quantity>0);Q(re)}},[i,l]);const Z=()=>{const re={};return w.name.trim()||(re.name="Request name is required"),w.location.trim()||(re.location="Location is required"),w.aidType.trim()||(re.aidType="Aid type is required"),w.urgency||(re.urgency="Urgency level is required"),w.items.length===0?re.items="At least one item is required":w.items.forEach((fe,ye)=>{fe.itemId||(re[`items.${ye}.itemId`]="Item is required"),(!fe.quantity||fe.quantity<=0)&&(re[`items.${ye}.quantity`]="Quantity must be greater than 0")}),W(re),Object.keys(re).length===0},oe=(re,fe,ye)=>{const ue=[...w.items];if(fe==="itemId"){const Ie=K.find(Oe=>String(Oe.id)===String(ye));Ie&&(ue[re]={...ue[re],itemId:Ie.id,name:Ie.name,unit:Ie.unit||"unit"})}else ue[re]={...ue[re],[fe]:fe==="quantity"?parseInt(ye):ye};A({...w,items:ue})},ae=()=>{A({...w,items:[...w.items,{itemId:"",name:"",quantity:1,unit:""}]})},me=re=>{const fe=[...w.items];fe.splice(re,1),A({...w,items:fe.length?fe:[{itemId:"",name:"",quantity:1,unit:""}]})},pe=re=>{const{name:fe,value:ye}=re.target;A({...w,[fe]:ye})},_e=!!e,De=async re=>{if(re.preventDefault(),!Z()){u({title:"Form Error",description:"Please fill in all required fields correctly.",variant:"destructive"});return}const fe=w.items.map(Oe=>({itemId:Oe.itemId,name:Oe.name,quantity:Oe.quantity,unit:Oe.unit})),ye=`${w.notes}

Requested Items:
${fe.map(Oe=>`- ${Oe.name}: ${Oe.quantity} ${Oe.unit}`).join(`
`)}`,ue={name:w.name,location:w.location,aidType:w.aidType,urgency:w.urgency,notes:ye,status:"pending",requestDate:new Date,createdAt:new Date,updatedAt:new Date,items:fe,userId:s?.uid};let Ie;if(_e?Ie=await r(e.id,ue):Ie=await n(ue),!Ie){u({title:"Error",description:"An unexpected error occurred.",variant:"destructive"});return}Ie.success&&t?(u({title:"Success",description:_e?"Your aid request has been updated successfully.":"Your aid request has been submitted successfully."}),A({name:"",location:"",aidType:"",urgency:"medium",items:[{itemId:"",name:"",quantity:1,unit:""}],notes:""}),t(_e?Ie.data:Ie.request)):u({title:"Error",description:Ie.error||"Failed to submit aid request. Please try again.",variant:"destructive"})},Ae=re=>{switch(re){case"high":return"bg-red-200 border-red-400";case"medium":return"bg-yellow-200 border-yellow-400 ";case"low":return"bg-green-200 border-green-400";default:return"bg-gray-200 border-gray-400"}};return R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[R.jsx("h2",{className:"text-2xl font-semibold mb-6",children:_e?"Edit Aid Request":"Submit Aid Request"}),R.jsxs("form",{onSubmit:De,children:[R.jsxs("div",{className:"mb-6",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"name",children:"Request Name *"}),R.jsx("input",{type:"text",id:"name",name:"name",value:w.name,onChange:pe,className:`shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${F.name?"border-red-500":""}`,placeholder:"Give your request a descriptive name"}),F.name&&R.jsx("p",{className:"text-red-500 text-xs italic",children:F.name})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"location",children:"Location / Address *"}),R.jsx("input",{type:"text",id:"location",name:"location",value:w.location,onChange:pe,className:`shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${F.location?"border-red-500":""}`,placeholder:"Enter your current location"}),F.location&&R.jsx("p",{className:"text-red-500 text-xs italic",children:F.location})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"aidType",children:"Aid Type *"}),R.jsxs("select",{id:"aidType",name:"aidType",value:w.aidType,onChange:pe,className:`shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${F.aidType?"border-red-500":""}`,children:[R.jsx("option",{value:"",children:"Select Aid Type"}),R.jsx("option",{value:"food",children:"Food"}),R.jsx("option",{value:"water",children:"Water"}),R.jsx("option",{value:"medical",children:"Medical Supplies"}),R.jsx("option",{value:"shelter",children:"Shelter"}),R.jsx("option",{value:"clothing",children:"Clothing"}),R.jsx("option",{value:"hygiene",children:"Hygiene Products"}),R.jsx("option",{value:"other",children:"Other"})]}),F.aidType&&R.jsx("p",{className:"text-red-500 text-xs italic",children:F.aidType})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Urgency Level *"}),R.jsx("div",{className:"flex space-x-4",children:["low","medium","high"].map(re=>R.jsxs("div",{className:"flex items-center",children:[R.jsx("input",{type:"radio",id:`urgency-${re}`,name:"urgency",value:re,checked:w.urgency===re,onChange:pe,className:"mr-2"}),R.jsx("label",{htmlFor:`urgency-${re}`,className:`py-1 px-3 rounded-full text-sm capitalize ${Ae(re)}`,children:re})]},re))}),F.urgency&&R.jsx("p",{className:"text-red-500 text-xs italic",children:F.urgency})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Requested Items *"}),w.items.map((re,fe)=>R.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[R.jsxs("div",{className:"flex-1",children:[R.jsxs("select",{value:re.itemId,onChange:ye=>oe(fe,"itemId",ye.target.value),className:`shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${F[`items.${fe}.itemId`]?"border-red-500":""}`,children:[R.jsx("option",{value:"",children:"Select an item"}),K.map(ye=>R.jsxs("option",{value:ye.id,children:[ye.name," (",ye.quantity," ",ye.unit||"unit"," available)"]},ye.id))]}),F[`items.${fe}.itemId`]&&R.jsx("p",{className:"text-red-500 text-xs italic",children:F[`items.${fe}.itemId`]})]}),R.jsxs("div",{className:"w-24",children:[R.jsx("input",{type:"number",min:"1",value:re.quantity,onChange:ye=>oe(fe,"quantity",ye.target.value),className:`shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${F[`items.${fe}.quantity`]?"border-red-500":""}`}),F[`items.${fe}.quantity`]&&R.jsx("p",{className:"text-red-500 text-xs italic",children:F[`items.${fe}.quantity`]})]}),R.jsx("div",{className:"w-20 text-gray-600 text-sm flex items-center",children:re.unit||"unit"}),R.jsx("button",{type:"button",onClick:()=>me(fe),className:"bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline",disabled:w.items.length===1,children:"X"})]},fe)),R.jsx("button",{type:"button",onClick:ae,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"+ Add Item"}),F.items&&R.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:F.items})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"notes",children:"Additional Notes"}),R.jsx("textarea",{id:"notes",name:"notes",value:w.notes,onChange:pe,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:"3",placeholder:"Any additional information about your request"})]}),R.jsx("div",{className:"flex items-center justify-end",children:R.jsx("button",{type:"submit",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline",children:_e?"Update Request":"Submit Request"})})]})]})};function SAe(t){return t?t instanceof Date?t:typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date(t):null}const TAe=()=>{const{aidRequests:t=[],loading:e,error:n,updateRequestStatus:r}=R_(),{user:i}=Yo(),[l,u]=se.useState([]),[s,v]=se.useState("all"),[w,A]=se.useState(""),[F,W]=se.useState("createdAt"),[K,Q]=se.useState("desc");se.useEffect(()=>{if(!Array.isArray(t)){console.error("aidRequests is not an array:",t),u([]);return}let _e=[...t];if(s!=="all"&&(_e=_e.filter(De=>De.status===s)),w){const De=w.toLowerCase();_e=_e.filter(Ae=>Ae.location?.toLowerCase().includes(De)||Ae.items?.some(re=>re.name.toLowerCase().includes(De))||Ae.notes&&Ae.notes.toLowerCase().includes(De))}_e.sort((De,Ae)=>{let re,fe;if(F==="createdAt"||F==="updatedAt")re=new Date(De[F]||0).getTime(),fe=new Date(Ae[F]||0).getTime();else if(F==="priority"){const ye={high:3,medium:2,low:1};re=ye[De.priority]||0,fe=ye[Ae.priority]||0}else re=De[F],fe=Ae[F];return K==="asc"?re>fe?1:-1:re<fe?1:-1}),u(_e)},[t,s,w,F,K]);const Z=async(_e,De)=>{const Ae=await r(_e,De);Ae.success||console.error("Failed to update request status:",Ae.error)},oe=_e=>{switch(_e){case ai.PENDING:return"bg-yellow-100 text-yellow-800 border-yellow-300";case ai.APPROVED:return"bg-blue-100 text-blue-800 border-blue-300";case ai.IN_PROGRESS:return"bg-indigo-100 text-indigo-800 border-indigo-300";case ai.IN_TRANSIT:return"bg-sky-100 text-sky-800 border-sky-300";case ai.DELIVERED:return"bg-green-100 text-green-800 border-green-300";case ai.DENIED:return"bg-red-100 text-red-800 border-red-300";case ai.CANCELLED:return"bg-gray-100 text-gray-800 border-gray-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},ae=_e=>{switch(_e){case"high":return"bg-red-100 text-red-800 border-red-300";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"low":return"bg-green-100 text-green-800 border-green-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},me=_e=>{F===_e?Q(K==="asc"?"desc":"asc"):(W(_e),Q("desc"))};if(e)return R.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:R.jsx("div",{className:"flex justify-center items-center h-64",children:R.jsx(bf,{className:"h-8 w-8 animate-spin text-primary"})})});if(n)return R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500",children:[R.jsx("h2",{className:"text-xl font-semibold text-red-700 mb-4",children:"Error"}),R.jsx("p",{className:"text-gray-700",children:n})]});if(!Array.isArray(t)||t.length===0)return R.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:R.jsxs("div",{className:"text-center",children:[R.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-4",children:"No Aid Requests"}),i?.role==="beneficiary"&&R.jsx(hu,{href:"/request/new",children:R.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Create New Request"})})]})});const pe=i?.role==="admin"||i?.role==="staff";return R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[R.jsxs("div",{className:"flex justify-between items-center mb-6",children:[R.jsx("h2",{className:"text-2xl font-semibold",children:"Aid Requests"}),i?.role==="beneficiary"&&R.jsx(hu,{href:"/request/new",children:R.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"New Request"})})]}),R.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"statusFilter",children:"Status"}),R.jsxs("select",{id:"statusFilter",value:s,onChange:_e=>v(_e.target.value),className:"shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[R.jsx("option",{value:"all",children:"All Statuses"}),Object.values(ai).map(_e=>R.jsx("option",{value:_e,children:_e.replace("_"," ").replace(/\b\w/g,De=>De.toUpperCase())},_e))]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"sortBy",children:"Sort By"}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsxs("select",{id:"sortBy",value:F,onChange:_e=>W(_e.target.value),className:"shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[R.jsx("option",{value:"createdAt",children:"Created Date"}),R.jsx("option",{value:"updatedAt",children:"Updated Date"}),R.jsx("option",{value:"priority",children:"Priority"}),R.jsx("option",{value:"status",children:"Status"})]}),R.jsx("button",{onClick:()=>Q(K==="asc"?"desc":"asc"),className:"bg-gray-200 hover:bg-gray-300 px-3 rounded",children:K==="asc"?"":""})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"search",children:"Search"}),R.jsx("input",{id:"search",type:"text",placeholder:"Search by location or items...",value:w,onChange:_e=>A(_e.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]})]}),l.length===0?R.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[R.jsx("p",{className:"text-gray-500",children:"No aid requests found matching your criteria."}),i?.role==="beneficiary"&&R.jsx(hu,{href:"/request/new",children:R.jsx("button",{className:"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Create New Request"})})]}):R.jsx("div",{className:"overflow-x-auto",children:R.jsxs("table",{className:"min-w-full bg-white",children:[R.jsx("thead",{children:R.jsxs("tr",{className:"bg-gray-100 text-gray-700 text-left",children:[R.jsxs("th",{className:"py-3 px-4 font-semibold cursor-pointer",onClick:()=>me("id"),children:["ID ",F==="id"&&(K==="asc"?"":"")]}),pe&&R.jsx("th",{className:"py-3 px-4 font-semibold",children:"Beneficiary"}),R.jsxs("th",{className:"py-3 px-4 font-semibold cursor-pointer",onClick:()=>me("createdAt"),children:["Date ",F==="createdAt"&&(K==="asc"?"":"")]}),R.jsx("th",{className:"py-3 px-4 font-semibold",children:"Items"}),R.jsx("th",{className:"py-3 px-4 font-semibold",children:"Location"}),R.jsxs("th",{className:"py-3 px-4 font-semibold cursor-pointer",onClick:()=>me("priority"),children:["Priority ",F==="priority"&&(K==="asc"?"":"")]}),R.jsxs("th",{className:"py-3 px-4 font-semibold cursor-pointer",onClick:()=>me("status"),children:["Status ",F==="status"&&(K==="asc"?"":"")]}),R.jsx("th",{className:"py-3 px-4 font-semibold",children:"Actions"})]})}),R.jsx("tbody",{className:"divide-y divide-gray-200",children:l.map(_e=>R.jsxs("tr",{className:"hover:bg-gray-50",children:[R.jsxs("td",{className:"py-3 px-4",children:["#",_e.id]}),pe&&R.jsx("td",{className:"py-3 px-4",children:_e.beneficiaryId}),R.jsx("td",{className:"py-3 px-4",children:SAe(_e.createdAt)?.toLocaleDateString()||""}),R.jsx("td",{className:"py-3 px-4",children:R.jsx("div",{className:"flex flex-col space-y-1",children:(_e.items||[]).map((De,Ae)=>R.jsxs("div",{className:"text-sm",children:[De.quantity," ",De.unit," ",De.name]},Ae))})}),R.jsx("td",{className:"py-3 px-4",children:_e.location}),R.jsx("td",{className:"py-3 px-4",children:R.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${ae(_e.priority)}`,children:_e.priority})}),R.jsx("td",{className:"py-3 px-4",children:R.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${oe(_e.status)}`,children:_e.status.replace("_"," ")})}),R.jsx("td",{className:"py-3 px-4",children:R.jsxs("div",{className:"flex space-x-2",children:[R.jsx(hu,{href:`/request/${_e.id}`,children:R.jsx("button",{className:"bg-blue-500 text-white px-3 py-1 rounded text-xs",children:"View"})}),pe&&_e.status===ai.PENDING&&R.jsxs(R.Fragment,{children:[R.jsx("button",{onClick:()=>Z(_e.id,ai.APPROVED),className:"bg-green-500 text-white px-3 py-1 rounded text-xs",children:"Approve"}),R.jsx("button",{onClick:()=>Z(_e.id,ai.DENIED),className:"bg-red-500 text-white px-3 py-1 rounded text-xs",children:"Deny"})]}),pe&&_e.status===ai.APPROVED&&R.jsx("button",{onClick:()=>Z(_e.id,ai.IN_PROGRESS),className:"bg-purple-500 text-white px-3 py-1 rounded text-xs",children:"Start"}),i?.role==="beneficiary"&&_e.status===ai.PENDING&&R.jsx("button",{onClick:()=>Z(_e.id,ai.CANCELLED),className:"bg-gray-500 text-white px-3 py-1 rounded text-xs",children:"Cancel"})]})})]},_e.id))})]})})]})};function W9(t){return t?t instanceof Date?t:typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date(t):null}const CAe=({requestId:t})=>{const{getAidRequestById:e,updateAidRequest:n}=R_(),{toast:r}=wc(),[i,l]=se.useState(null),[u,s]=se.useState(!0),[v,w]=se.useState(null);se.useEffect(()=>{if(!t){w("No request ID provided"),s(!1);return}const Z=async()=>{try{const ae=await e(t);ae?(l(ae),w(null)):w("Request not found")}catch(ae){console.error("Failed to load request:",ae),w("Failed to load request details")}finally{s(!1)}};Z();const oe=setInterval(Z,3e4);return()=>clearInterval(oe)},[t,e]);const A=Z=>{switch(Z){case ai.PENDING:return"bg-yellow-100 border-yellow-500 text-yellow-700";case ai.APPROVED:return"bg-blue-100 border-blue-500 text-blue-700";case ai.IN_PROGRESS:return"bg-purple-100 border-purple-500 text-purple-700";case ai.IN_TRANSIT:return"bg-indigo-100 border-indigo-500 text-indigo-700";case ai.DELIVERED:return"bg-green-100 border-green-500 text-green-700";case ai.DENIED:return"bg-red-100 border-red-500 text-red-700";case ai.CANCELLED:return"bg-gray-100 border-gray-500 text-gray-700";default:return"bg-gray-100 border-gray-500 text-gray-700"}},F=Z=>{switch(Z){case ai.PENDING:return"";case ai.APPROVED:return"";case ai.IN_PROGRESS:return"";case ai.IN_TRANSIT:return"";case ai.DELIVERED:return"";case ai.DENIED:return"";case ai.CANCELLED:return"";default:return""}},W=Z=>{switch(Z){case ai.PENDING:return"Your request is pending review by our staff.";case ai.APPROVED:return"Your request has been approved! We are preparing your items.";case ai.IN_PROGRESS:return"Your request is being processed and items are being prepared.";case ai.IN_TRANSIT:return"Your items are on the way to your location.";case ai.DELIVERED:return"Your aid has been delivered.";case ai.DENIED:return"We regret to inform you that your request could not be fulfilled at this time.";case ai.CANCELLED:return"This request has been cancelled.";default:return"Status information unavailable."}},K=async()=>{if(!i)return;if(i.status!==ai.PENDING){r({title:"Cannot Cancel",description:"You can only cancel pending requests.",variant:"destructive"});return}const Z=await n(i.id,{status:ai.CANCELLED});Z.success?(l({...i,status:ai.CANCELLED}),r({title:"Request Cancelled",description:"Your request has been successfully cancelled."})):r({title:"Error",description:Z.error||"Failed to cancel request. Please try again.",variant:"destructive"})};if(u)return R.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:R.jsx("div",{className:"animate-pulse flex space-x-4",children:R.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[R.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),R.jsxs("div",{className:"space-y-2",children:[R.jsx("div",{className:"h-4 bg-gray-200 rounded"}),R.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})});if(v)return R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500",children:[R.jsx("h2",{className:"text-xl font-semibold text-red-700 mb-4",children:"Error"}),R.jsx("p",{className:"text-gray-700",children:v}),R.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"If you believe this is an error, please contact support."})]});if(!i)return R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border-l-4 border-yellow-500",children:[R.jsx("h2",{className:"text-xl font-semibold text-yellow-700 mb-4",children:"Request Not Found"}),R.jsx("p",{className:"text-gray-700",children:"The requested aid request could not be found. It may have been removed or you might not have permission to view it."})]});let Q=i.status;return Q==="fulfilled"&&(Q="delivered"),R.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[R.jsxs("div",{className:"border-b pb-4 mb-6",children:[R.jsxs("div",{className:"flex justify-between items-center",children:[R.jsxs("h2",{className:"text-2xl font-semibold",children:["Request #",i.id]}),R.jsxs("div",{className:`px-4 py-2 rounded-full border ${A(Q)}`,children:[R.jsx("span",{className:"mr-2",children:F(Q)}),R.jsx("span",{className:"font-medium capitalize",children:Q?Q.replace("_"," "):""})]})]}),R.jsx("p",{className:"text-gray-600 mt-2",children:W(Q)}),R.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Created: ",W9(i.createdAt)?.toLocaleString()||"",i.updatedAt!==i.createdAt&&R.jsxs("span",{className:"ml-3",children:["Last Updated: ",W9(i.updatedAt)?.toLocaleString()||""]})]})]}),R.jsxs("div",{className:"mb-6",children:[R.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Requested Items"}),R.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[R.jsxs("div",{className:"grid grid-cols-3 font-semibold text-gray-600 pb-2 border-b mb-2",children:[R.jsx("div",{children:"Item"}),R.jsx("div",{children:"Quantity"}),R.jsx("div",{children:"Unit"})]}),(i.items||[]).map((Z,oe)=>R.jsxs("div",{className:"grid grid-cols-3 py-2 border-b border-gray-200 text-gray-700",children:[R.jsx("div",{children:Z.name}),R.jsx("div",{children:Z.quantity}),R.jsx("div",{children:Z.unit})]},oe))]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Location"}),R.jsx("p",{className:"text-gray-700",children:i.location})]}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Priority"}),R.jsx("p",{className:"capitalize text-gray-700",children:i.priority})]})]}),i.notes&&R.jsxs("div",{className:"mb-6",children:[R.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Additional Notes"}),R.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded",children:i.notes})]}),R.jsxs("div",{className:"mt-8 mb-6",children:[R.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Status Updates"}),R.jsxs("div",{className:"relative",children:[R.jsx("div",{className:"absolute left-4 top-0 h-full w-0.5 bg-gray-200"}),Object.values(ai).map((Z,oe)=>{const ae=Object.values(ai).indexOf(Q)>=oe,me=Object.values(ai).indexOf(Q)>oe;return R.jsxs("div",{className:`relative flex items-start mb-6 ${ae?"":"opacity-40"}`,children:[R.jsx("div",{className:`absolute left-0 mt-1 w-8 h-8 rounded-full flex items-center justify-center z-10 
                  ${me?"bg-green-500 text-white":ae?"bg-blue-500 text-white":"bg-gray-200"}`,children:me?"":oe+1}),R.jsxs("div",{className:"ml-12",children:[R.jsx("h4",{className:`text-md font-semibold capitalize ${ae?"text-gray-900":"text-gray-500"}`,children:Z?Z.replace("_"," "):""}),R.jsx("p",{className:`text-sm ${ae?"text-gray-600":"text-gray-400"}`,children:W(Z)})]})]},Z)})]})]}),R.jsx("div",{className:"mt-8 border-t pt-6 flex justify-end",children:i.status===ai.PENDING&&R.jsx("button",{onClick:K,className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline",children:"Cancel Request"})})]})},l3=()=>{const{loading:t,error:e}=R_(),{user:n,hasPermission:r,loading:i}=Yo(),[l,u]=xu(),v=(()=>{const A=l.match(/\/request\/([^/]+)/);return A?A[1]:null})();if(i||t)return R.jsx("div",{className:"flex justify-center items-center h-[calc(100vh-200px)]",children:R.jsx(bf,{className:"h-8 w-8 animate-spin text-primary"})});const w=()=>l==="/request/new"?r("create_aid_request")?R.jsx(EAe,{onRequestSubmitted:()=>{u("/request")}}):R.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4",children:R.jsx("p",{className:"text-yellow-700",children:"You don't have permission to create aid requests."})}):v?r("view_aid_requests")?R.jsx(CAe,{requestId:v}):R.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4",children:R.jsx("p",{className:"text-yellow-700",children:"You don't have permission to view this aid request."})}):r("view_aid_requests")?R.jsx(TAe,{}):R.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4",children:R.jsx("p",{className:"text-yellow-700",children:"You don't have permission to view aid requests."})});return R.jsxs("div",{className:"space-y-6",children:[R.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[R.jsxs("div",{children:[R.jsx("h1",{className:"text-2xl text-white font-bold",children:"Aid Requests"}),R.jsx("p",{className:"text-sm text-gray-500",children:v?"View details of an aid request":l==="/request/new"?"Submit a new aid request":"Manage and track aid requests"})]}),!v&&l!=="/request/new"&&r("create_aid_request")&&R.jsx(hu,{href:"/request/new",children:R.jsx("button",{className:"mt-4 md:mt-0 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"New Request"})})]}),e?R.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:R.jsx("p",{className:"text-red-700",children:e})}):w()]})};l4();const IAe=async()=>{try{const t=Td(ol,"users"),n=(await xf(t)).size,r=Td(ol,"donations"),i=Ky(r,GC("status","==","active")),u=(await xf(i)).size,s=Td(ol,"requests"),v=Ky(s,GC("status","==","pending")),A=(await xf(v)).size;return{totalUsers:n,activeDonations:u,pendingRequests:A}}catch(t){throw console.error("Error fetching dashboard stats:",t),t}},AAe=async(t=5)=>{try{const e=Td(ol,"activities"),n=Ky(e);return(await xf(n)).docs.map(i=>{const l=i.data();return{id:i.id,type:l.type,description:l.description,timestamp:l.timestamp.toDate()}}).sort((i,l)=>l.timestamp.getTime()-i.timestamp.getTime()).slice(0,t)}catch(e){throw console.error("Error fetching recent activities:",e),e}},RAe=()=>{const[t,e]=se.useState(null),[n,r]=se.useState([]),[i,l]=se.useState(!0),[u,s]=se.useState(null),[,v]=xu(),{toast:w}=wc();se.useEffect(()=>{(async()=>{try{l(!0);const[W,K]=await Promise.all([IAe(),AAe()]);e(W),r(K)}catch(W){s("Failed to load dashboard data"),console.error(W)}finally{l(!1)}})()},[]);const A=F=>{switch(F){case"addUser":v("/users/new");break;case"manageInventory":v("/inventory");break;case"viewAnalytics":v("/analytics");break;case"systemConfig":v("/settings");break;default:w({title:"Action not implemented",description:"This action is not yet available.",variant:"destructive"})}};return i?R.jsx("div",{className:"flex items-center justify-center h-screen",children:R.jsx(bf,{className:"h-8 w-8 animate-spin text-white"})}):u?R.jsx("div",{className:"flex items-center justify-center h-screen",children:R.jsx("p",{className:"text-red-500",children:u})}):R.jsxs("div",{className:"p-6 space-y-6",children:[R.jsxs("div",{className:"flex justify-between items-center",children:[R.jsx("h1",{className:"text-3xl font-bold text-white",children:"Admin Dashboard"}),R.jsxs("div",{className:"flex gap-4",children:[R.jsxs(Bi,{variant:"outline",className:"text-black",onClick:()=>A("systemConfig"),children:[R.jsx(DK,{className:"w-4 h-4 mr-2"}),"System Settings"]}),R.jsxs(Bi,{variant:"outline",className:"text-black",onClick:()=>A("addUser"),children:[R.jsx(Sw,{className:"w-4 h-4 mr-2"}),"Manage Users"]})]})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsxs(Sl,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[R.jsx(Tl,{className:"text-sm font-medium text-white",children:"Total Users"}),R.jsx(Sw,{className:"h-4 w-4 text-white"})]}),R.jsx(Ql,{children:R.jsx("div",{className:"text-2xl font-bold text-white",children:t?.totalUsers||0})})]}),R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsxs(Sl,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[R.jsx(Tl,{className:"text-sm font-medium text-white",children:"Active Donations"}),R.jsx(Jy,{className:"h-4 w-4 text-white"})]}),R.jsx(Ql,{children:R.jsx("div",{className:"text-2xl font-bold text-white",children:t?.activeDonations||0})})]}),R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsxs(Sl,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[R.jsx(Tl,{className:"text-sm font-medium text-white",children:"Pending Requests"}),R.jsx(_ye,{className:"h-4 w-4 text-white"})]}),R.jsx(Ql,{children:R.jsx("div",{className:"text-2xl font-bold text-white",children:t?.pendingRequests||0})})]})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsx(Sl,{children:R.jsx(Tl,{className:"text-white",children:"Quick Actions"})}),R.jsx(Ql,{children:R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs(Bi,{variant:"outline",className:"text-black",onClick:()=>A("addUser"),children:[R.jsx(oN,{className:"w-4 h-4 mr-2"}),"Add User"]}),R.jsxs(Bi,{variant:"outline",className:"text-black",onClick:()=>A("manageInventory"),children:[R.jsx(Jy,{className:"w-4 h-4 mr-2"}),"Manage Inventory"]}),R.jsxs(Bi,{variant:"outline",className:"text-black",onClick:()=>A("viewAnalytics"),children:[R.jsx(IK,{className:"w-4 h-4 mr-2"}),"View Analytics"]}),R.jsxs(Bi,{variant:"outline",className:"text-black",onClick:()=>A("systemConfig"),children:[R.jsx(hye,{className:"w-4 h-4 mr-2"}),"System Config"]})]})})]}),R.jsxs(El,{className:"bg-white/10 border-0",children:[R.jsx(Sl,{children:R.jsx(Tl,{className:"text-white",children:"Recent Activity"})}),R.jsx(Ql,{children:R.jsx("div",{className:"space-y-4",children:n.map(F=>R.jsxs("div",{className:"flex items-center space-x-4",children:[R.jsx(G0e,{className:"h-4 w-4 text-white"}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-white",children:F.description}),R.jsx("p",{className:"text-xs text-white/60",children:hJ(F.timestamp,{addSuffix:!0})})]})]},F.id))})})]})]})]})},Ow={black:"#000",white:"#fff"},B0={300:"#e57373",400:"#ef5350",500:"#f44336",700:"#d32f2f",800:"#c62828"},z0={50:"#f3e5f5",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",700:"#7b1fa2"},j0={50:"#e3f2fd",200:"#90caf9",400:"#42a5f5",700:"#1976d2",800:"#1565c0"},V0={300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",700:"#0288d1",900:"#01579b"},U0={300:"#81c784",400:"#66bb6a",500:"#4caf50",700:"#388e3c",800:"#2e7d32",900:"#1b5e20"},jv={300:"#ffb74d",400:"#ffa726",500:"#ff9800",700:"#f57c00",900:"#e65100"},MAe={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function Of(t,...e){const n=new URL(`https://mui.com/production-error/?code=${t}`);return e.forEach(r=>n.searchParams.append("args[]",r)),`Minified MUI error #${t}; visit ${n} for the full message.`}const sR="$$material";function EI(){return EI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},EI.apply(null,arguments)}function PAe(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function DAe(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var kAe=function(){function t(n){var r=this;this._insertTag=function(i){var l;r.tags.length===0?r.insertionPoint?l=r.insertionPoint.nextSibling:r.prepend?l=r.container.firstChild:l=r.before:l=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(i,l),r.tags.push(i)},this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.prepend=n.prepend,this.insertionPoint=n.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(r){r.forEach(this._insertTag)},e.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(DAe(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var l=PAe(i);try{l.insertRule(r,l.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(r));this.ctr++},e.flush=function(){this.tags.forEach(function(r){var i;return(i=r.parentNode)==null?void 0:i.removeChild(r)}),this.tags=[],this.ctr=0},t}(),Wl="-ms-",SI="-moz-",Ns="-webkit-",dee="comm",uF="rule",hF="decl",NAe="@import",fee="@keyframes",OAe="@layer",LAe=Math.abs,oR=String.fromCharCode,FAe=Object.assign;function BAe(t,e){return xl(t,0)^45?(((e<<2^xl(t,0))<<2^xl(t,1))<<2^xl(t,2))<<2^xl(t,3):0}function pee(t){return t.trim()}function zAe(t,e){return(t=e.exec(t))?t[0]:t}function Os(t,e,n){return t.replace(e,n)}function kN(t,e){return t.indexOf(e)}function xl(t,e){return t.charCodeAt(e)|0}function Lw(t,e,n){return t.slice(e,n)}function gd(t){return t.length}function dF(t){return t.length}function dT(t,e){return e.push(t),t}function jAe(t,e){return t.map(e).join("")}var aR=1,ox=1,mee=0,Kc=0,Da=0,Ox="";function lR(t,e,n,r,i,l,u){return{value:t,root:e,parent:n,type:r,props:i,children:l,line:aR,column:ox,length:u,return:""}}function Vv(t,e){return FAe(lR("",null,null,"",null,null,0),t,{length:-t.length},e)}function VAe(){return Da}function UAe(){return Da=Kc>0?xl(Ox,--Kc):0,ox--,Da===10&&(ox=1,aR--),Da}function _u(){return Da=Kc<mee?xl(Ox,Kc++):0,ox++,Da===10&&(ox=1,aR++),Da}function Md(){return xl(Ox,Kc)}function rC(){return Kc}function S2(t,e){return Lw(Ox,t,e)}function Fw(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function gee(t){return aR=ox=1,mee=gd(Ox=t),Kc=0,[]}function _ee(t){return Ox="",t}function iC(t){return pee(S2(Kc-1,NN(t===91?t+2:t===40?t+1:t)))}function HAe(t){for(;(Da=Md())&&Da<33;)_u();return Fw(t)>2||Fw(Da)>3?"":" "}function WAe(t,e){for(;--e&&_u()&&!(Da<48||Da>102||Da>57&&Da<65||Da>70&&Da<97););return S2(t,rC()+(e<6&&Md()==32&&_u()==32))}function NN(t){for(;_u();)switch(Da){case t:return Kc;case 34:case 39:t!==34&&t!==39&&NN(Da);break;case 40:t===41&&NN(t);break;case 92:_u();break}return Kc}function $Ae(t,e){for(;_u()&&t+Da!==57;)if(t+Da===84&&Md()===47)break;return"/*"+S2(e,Kc-1)+"*"+oR(t===47?t:_u())}function qAe(t){for(;!Fw(Md());)_u();return S2(t,Kc)}function GAe(t){return _ee(sC("",null,null,null,[""],t=gee(t),0,[0],t))}function sC(t,e,n,r,i,l,u,s,v){for(var w=0,A=0,F=u,W=0,K=0,Q=0,Z=1,oe=1,ae=1,me=0,pe="",_e=i,De=l,Ae=r,re=pe;oe;)switch(Q=me,me=_u()){case 40:if(Q!=108&&xl(re,F-1)==58){kN(re+=Os(iC(me),"&","&\f"),"&\f")!=-1&&(ae=-1);break}case 34:case 39:case 91:re+=iC(me);break;case 9:case 10:case 13:case 32:re+=HAe(Q);break;case 92:re+=WAe(rC()-1,7);continue;case 47:switch(Md()){case 42:case 47:dT(YAe($Ae(_u(),rC()),e,n),v);break;default:re+="/"}break;case 123*Z:s[w++]=gd(re)*ae;case 125*Z:case 59:case 0:switch(me){case 0:case 125:oe=0;case 59+A:ae==-1&&(re=Os(re,/\f/g,"")),K>0&&gd(re)-F&&dT(K>32?q9(re+";",r,n,F-1):q9(Os(re," ","")+";",r,n,F-2),v);break;case 59:re+=";";default:if(dT(Ae=$9(re,e,n,w,A,i,s,pe,_e=[],De=[],F),l),me===123)if(A===0)sC(re,e,Ae,Ae,_e,l,F,s,De);else switch(W===99&&xl(re,3)===110?100:W){case 100:case 108:case 109:case 115:sC(t,Ae,Ae,r&&dT($9(t,Ae,Ae,0,0,i,s,pe,i,_e=[],F),De),i,De,F,s,r?_e:De);break;default:sC(re,Ae,Ae,Ae,[""],De,0,s,De)}}w=A=K=0,Z=ae=1,pe=re="",F=u;break;case 58:F=1+gd(re),K=Q;default:if(Z<1){if(me==123)--Z;else if(me==125&&Z++==0&&UAe()==125)continue}switch(re+=oR(me),me*Z){case 38:ae=A>0?1:(re+="\f",-1);break;case 44:s[w++]=(gd(re)-1)*ae,ae=1;break;case 64:Md()===45&&(re+=iC(_u())),W=Md(),A=F=gd(pe=re+=qAe(rC())),me++;break;case 45:Q===45&&gd(re)==2&&(Z=0)}}return l}function $9(t,e,n,r,i,l,u,s,v,w,A){for(var F=i-1,W=i===0?l:[""],K=dF(W),Q=0,Z=0,oe=0;Q<r;++Q)for(var ae=0,me=Lw(t,F+1,F=LAe(Z=u[Q])),pe=t;ae<K;++ae)(pe=pee(Z>0?W[ae]+" "+me:Os(me,/&\f/g,W[ae])))&&(v[oe++]=pe);return lR(t,e,n,i===0?uF:s,v,w,A)}function YAe(t,e,n){return lR(t,e,n,dee,oR(VAe()),Lw(t,2,-2),0)}function q9(t,e,n,r){return lR(t,e,n,hF,Lw(t,0,r),Lw(t,r+1,-1),r)}function Cy(t,e){for(var n="",r=dF(t),i=0;i<r;i++)n+=e(t[i],i,t,e)||"";return n}function XAe(t,e,n,r){switch(t.type){case OAe:if(t.children.length)break;case NAe:case hF:return t.return=t.return||t.value;case dee:return"";case fee:return t.return=t.value+"{"+Cy(t.children,r)+"}";case uF:t.value=t.props.join(",")}return gd(n=Cy(t.children,r))?t.return=t.value+"{"+n+"}":""}function KAe(t){var e=dF(t);return function(n,r,i,l){for(var u="",s=0;s<e;s++)u+=t[s](n,r,i,l)||"";return u}}function ZAe(t){return function(e){e.root||(e=e.return)&&t(e)}}function yee(t){var e=Object.create(null);return function(n){return e[n]===void 0&&(e[n]=t(n)),e[n]}}var QAe=function(e,n,r){for(var i=0,l=0;i=l,l=Md(),i===38&&l===12&&(n[r]=1),!Fw(l);)_u();return S2(e,Kc)},JAe=function(e,n){var r=-1,i=44;do switch(Fw(i)){case 0:i===38&&Md()===12&&(n[r]=1),e[r]+=QAe(Kc-1,n,r);break;case 2:e[r]+=iC(i);break;case 4:if(i===44){e[++r]=Md()===58?"&\f":"",n[r]=e[r].length;break}default:e[r]+=oR(i)}while(i=_u());return e},eRe=function(e,n){return _ee(JAe(gee(e),n))},G9=new WeakMap,tRe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var n=e.value,r=e.parent,i=e.column===r.column&&e.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(e.props.length===1&&n.charCodeAt(0)!==58&&!G9.get(r))&&!i){G9.set(e,!0);for(var l=[],u=eRe(n,l),s=r.props,v=0,w=0;v<u.length;v++)for(var A=0;A<s.length;A++,w++)e.props[w]=l[v]?u[v].replace(/&\f/g,s[A]):s[A]+" "+u[v]}}},nRe=function(e){if(e.type==="decl"){var n=e.value;n.charCodeAt(0)===108&&n.charCodeAt(2)===98&&(e.return="",e.value="")}};function xee(t,e){switch(BAe(t,e)){case 5103:return Ns+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ns+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Ns+t+SI+t+Wl+t+t;case 6828:case 4268:return Ns+t+Wl+t+t;case 6165:return Ns+t+Wl+"flex-"+t+t;case 5187:return Ns+t+Os(t,/(\w+).+(:[^]+)/,Ns+"box-$1$2"+Wl+"flex-$1$2")+t;case 5443:return Ns+t+Wl+"flex-item-"+Os(t,/flex-|-self/,"")+t;case 4675:return Ns+t+Wl+"flex-line-pack"+Os(t,/align-content|flex-|-self/,"")+t;case 5548:return Ns+t+Wl+Os(t,"shrink","negative")+t;case 5292:return Ns+t+Wl+Os(t,"basis","preferred-size")+t;case 6060:return Ns+"box-"+Os(t,"-grow","")+Ns+t+Wl+Os(t,"grow","positive")+t;case 4554:return Ns+Os(t,/([^-])(transform)/g,"$1"+Ns+"$2")+t;case 6187:return Os(Os(Os(t,/(zoom-|grab)/,Ns+"$1"),/(image-set)/,Ns+"$1"),t,"")+t;case 5495:case 3959:return Os(t,/(image-set\([^]*)/,Ns+"$1$`$1");case 4968:return Os(Os(t,/(.+:)(flex-)?(.*)/,Ns+"box-pack:$3"+Wl+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ns+t+t;case 4095:case 3583:case 4068:case 2532:return Os(t,/(.+)-inline(.+)/,Ns+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(gd(t)-1-e>6)switch(xl(t,e+1)){case 109:if(xl(t,e+4)!==45)break;case 102:return Os(t,/(.+:)(.+)-([^]+)/,"$1"+Ns+"$2-$3$1"+SI+(xl(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~kN(t,"stretch")?xee(Os(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(xl(t,e+1)!==115)break;case 6444:switch(xl(t,gd(t)-3-(~kN(t,"!important")&&10))){case 107:return Os(t,":",":"+Ns)+t;case 101:return Os(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Ns+(xl(t,14)===45?"inline-":"")+"box$3$1"+Ns+"$2$3$1"+Wl+"$2box$3")+t}break;case 5936:switch(xl(t,e+11)){case 114:return Ns+t+Wl+Os(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Ns+t+Wl+Os(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Ns+t+Wl+Os(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return Ns+t+Wl+t+t}return t}var rRe=function(e,n,r,i){if(e.length>-1&&!e.return)switch(e.type){case hF:e.return=xee(e.value,e.length);break;case fee:return Cy([Vv(e,{value:Os(e.value,"@","@"+Ns)})],i);case uF:if(e.length)return jAe(e.props,function(l){switch(zAe(l,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Cy([Vv(e,{props:[Os(l,/:(read-\w+)/,":"+SI+"$1")]})],i);case"::placeholder":return Cy([Vv(e,{props:[Os(l,/:(plac\w+)/,":"+Ns+"input-$1")]}),Vv(e,{props:[Os(l,/:(plac\w+)/,":"+SI+"$1")]}),Vv(e,{props:[Os(l,/:(plac\w+)/,Wl+"input-$1")]})],i)}return""})}},iRe=[rRe],sRe=function(e){var n=e.key;if(n==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(Z){var oe=Z.getAttribute("data-emotion");oe.indexOf(" ")!==-1&&(document.head.appendChild(Z),Z.setAttribute("data-s",""))})}var i=e.stylisPlugins||iRe,l={},u,s=[];u=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+n+' "]'),function(Z){for(var oe=Z.getAttribute("data-emotion").split(" "),ae=1;ae<oe.length;ae++)l[oe[ae]]=!0;s.push(Z)});var v,w=[tRe,nRe];{var A,F=[XAe,ZAe(function(Z){A.insert(Z)})],W=KAe(w.concat(i,F)),K=function(oe){return Cy(GAe(oe),W)};v=function(oe,ae,me,pe){A=me,K(oe?oe+"{"+ae.styles+"}":ae.styles),pe&&(Q.inserted[ae.name]=!0)}}var Q={key:n,sheet:new kAe({key:n,container:u,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:l,registered:{},insert:v};return Q.sheet.hydrate(s),Q},vee={exports:{}},Js={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ul=typeof Symbol=="function"&&Symbol.for,fF=ul?Symbol.for("react.element"):60103,pF=ul?Symbol.for("react.portal"):60106,cR=ul?Symbol.for("react.fragment"):60107,uR=ul?Symbol.for("react.strict_mode"):60108,hR=ul?Symbol.for("react.profiler"):60114,dR=ul?Symbol.for("react.provider"):60109,fR=ul?Symbol.for("react.context"):60110,mF=ul?Symbol.for("react.async_mode"):60111,pR=ul?Symbol.for("react.concurrent_mode"):60111,mR=ul?Symbol.for("react.forward_ref"):60112,gR=ul?Symbol.for("react.suspense"):60113,oRe=ul?Symbol.for("react.suspense_list"):60120,_R=ul?Symbol.for("react.memo"):60115,yR=ul?Symbol.for("react.lazy"):60116,aRe=ul?Symbol.for("react.block"):60121,lRe=ul?Symbol.for("react.fundamental"):60117,cRe=ul?Symbol.for("react.responder"):60118,uRe=ul?Symbol.for("react.scope"):60119;function wu(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case fF:switch(t=t.type,t){case mF:case pR:case cR:case hR:case uR:case gR:return t;default:switch(t=t&&t.$$typeof,t){case fR:case mR:case yR:case _R:case dR:return t;default:return e}}case pF:return e}}}function bee(t){return wu(t)===pR}Js.AsyncMode=mF;Js.ConcurrentMode=pR;Js.ContextConsumer=fR;Js.ContextProvider=dR;Js.Element=fF;Js.ForwardRef=mR;Js.Fragment=cR;Js.Lazy=yR;Js.Memo=_R;Js.Portal=pF;Js.Profiler=hR;Js.StrictMode=uR;Js.Suspense=gR;Js.isAsyncMode=function(t){return bee(t)||wu(t)===mF};Js.isConcurrentMode=bee;Js.isContextConsumer=function(t){return wu(t)===fR};Js.isContextProvider=function(t){return wu(t)===dR};Js.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===fF};Js.isForwardRef=function(t){return wu(t)===mR};Js.isFragment=function(t){return wu(t)===cR};Js.isLazy=function(t){return wu(t)===yR};Js.isMemo=function(t){return wu(t)===_R};Js.isPortal=function(t){return wu(t)===pF};Js.isProfiler=function(t){return wu(t)===hR};Js.isStrictMode=function(t){return wu(t)===uR};Js.isSuspense=function(t){return wu(t)===gR};Js.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===cR||t===pR||t===hR||t===uR||t===gR||t===oRe||typeof t=="object"&&t!==null&&(t.$$typeof===yR||t.$$typeof===_R||t.$$typeof===dR||t.$$typeof===fR||t.$$typeof===mR||t.$$typeof===lRe||t.$$typeof===cRe||t.$$typeof===uRe||t.$$typeof===aRe)};Js.typeOf=wu;vee.exports=Js;var hRe=vee.exports,wee=hRe,dRe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},fRe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Eee={};Eee[wee.ForwardRef]=dRe;Eee[wee.Memo]=fRe;var pRe=!0;function See(t,e,n){var r="";return n.split(" ").forEach(function(i){t[i]!==void 0?e.push(t[i]+";"):i&&(r+=i+" ")}),r}var gF=function(e,n,r){var i=e.key+"-"+n.name;(r===!1||pRe===!1)&&e.registered[i]===void 0&&(e.registered[i]=n.styles)},_F=function(e,n,r){gF(e,n,r);var i=e.key+"-"+n.name;if(e.inserted[n.name]===void 0){var l=n;do e.insert(n===l?"."+i:"",l,e.sheet,!0),l=l.next;while(l!==void 0)}};function mRe(t){for(var e=0,n,r=0,i=t.length;i>=4;++r,i-=4)n=t.charCodeAt(r)&255|(t.charCodeAt(++r)&255)<<8|(t.charCodeAt(++r)&255)<<16|(t.charCodeAt(++r)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,e=(n&65535)*1540483477+((n>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(i){case 3:e^=(t.charCodeAt(r+2)&255)<<16;case 2:e^=(t.charCodeAt(r+1)&255)<<8;case 1:e^=t.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var gRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},_Re=/[A-Z]|^ms/g,yRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Tee=function(e){return e.charCodeAt(1)===45},Y9=function(e){return e!=null&&typeof e!="boolean"},c3=yee(function(t){return Tee(t)?t:t.replace(_Re,"-$&").toLowerCase()}),X9=function(e,n){switch(e){case"animation":case"animationName":if(typeof n=="string")return n.replace(yRe,function(r,i,l){return _d={name:i,styles:l,next:_d},i})}return gRe[e]!==1&&!Tee(e)&&typeof n=="number"&&n!==0?n+"px":n};function Bw(t,e,n){if(n==null)return"";var r=n;if(r.__emotion_styles!==void 0)return r;switch(typeof n){case"boolean":return"";case"object":{var i=n;if(i.anim===1)return _d={name:i.name,styles:i.styles,next:_d},i.name;var l=n;if(l.styles!==void 0){var u=l.next;if(u!==void 0)for(;u!==void 0;)_d={name:u.name,styles:u.styles,next:_d},u=u.next;var s=l.styles+";";return s}return xRe(t,e,n)}case"function":{if(t!==void 0){var v=_d,w=n(t);return _d=v,Bw(t,e,w)}break}}var A=n;if(e==null)return A;var F=e[A];return F!==void 0?F:A}function xRe(t,e,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=Bw(t,e,n[i])+";";else for(var l in n){var u=n[l];if(typeof u!="object"){var s=u;e!=null&&e[s]!==void 0?r+=l+"{"+e[s]+"}":Y9(s)&&(r+=c3(l)+":"+X9(l,s)+";")}else if(Array.isArray(u)&&typeof u[0]=="string"&&(e==null||e[u[0]]===void 0))for(var v=0;v<u.length;v++)Y9(u[v])&&(r+=c3(l)+":"+X9(l,u[v])+";");else{var w=Bw(t,e,u);switch(l){case"animation":case"animationName":{r+=c3(l)+":"+w+";";break}default:r+=l+"{"+w+"}"}}}return r}var K9=/label:\s*([^\s;{]+)\s*(;|$)/g,_d;function T2(t,e,n){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var r=!0,i="";_d=void 0;var l=t[0];if(l==null||l.raw===void 0)r=!1,i+=Bw(n,e,l);else{var u=l;i+=u[0]}for(var s=1;s<t.length;s++)if(i+=Bw(n,e,t[s]),r){var v=l;i+=v[s]}K9.lastIndex=0;for(var w="",A;(A=K9.exec(i))!==null;)w+="-"+A[1];var F=mRe(i)+w;return{name:F,styles:i,next:_d}}var vRe=function(e){return e()},Cee=Dy.useInsertionEffect?Dy.useInsertionEffect:!1,Iee=Cee||vRe,Z9=Cee||se.useLayoutEffect,Aee=se.createContext(typeof HTMLElement<"u"?sRe({key:"css"}):null);Aee.Provider;var yF=function(e){return se.forwardRef(function(n,r){var i=se.useContext(Aee);return e(n,i,r)})},xR=se.createContext({}),xF={}.hasOwnProperty,ON="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",bRe=function(e,n){var r={};for(var i in n)xF.call(n,i)&&(r[i]=n[i]);return r[ON]=e,r},wRe=function(e){var n=e.cache,r=e.serialized,i=e.isStringTag;return gF(n,r,i),Iee(function(){return _F(n,r,i)}),null},ERe=yF(function(t,e,n){var r=t.css;typeof r=="string"&&e.registered[r]!==void 0&&(r=e.registered[r]);var i=t[ON],l=[r],u="";typeof t.className=="string"?u=See(e.registered,l,t.className):t.className!=null&&(u=t.className+" ");var s=T2(l,void 0,se.useContext(xR));u+=e.key+"-"+s.name;var v={};for(var w in t)xF.call(t,w)&&w!=="css"&&w!==ON&&(v[w]=t[w]);return v.className=u,n&&(v.ref=n),se.createElement(se.Fragment,null,se.createElement(wRe,{cache:e,serialized:s,isStringTag:typeof i=="string"}),se.createElement(i,v))}),SRe=ERe,Q9=function(e,n){var r=arguments;if(n==null||!xF.call(n,"css"))return se.createElement.apply(void 0,r);var i=r.length,l=new Array(i);l[0]=SRe,l[1]=bRe(e,n);for(var u=2;u<i;u++)l[u]=r[u];return se.createElement.apply(null,l)};(function(t){var e;e||(e=t.JSX||(t.JSX={}))})(Q9||(Q9={}));var TRe=yF(function(t,e){var n=t.styles,r=T2([n],void 0,se.useContext(xR)),i=se.useRef();return Z9(function(){var l=e.key+"-global",u=new e.sheet.constructor({key:l,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),s=!1,v=document.querySelector('style[data-emotion="'+l+" "+r.name+'"]');return e.sheet.tags.length&&(u.before=e.sheet.tags[0]),v!==null&&(s=!0,v.setAttribute("data-emotion",l),u.hydrate([v])),i.current=[u,s],function(){u.flush()}},[e]),Z9(function(){var l=i.current,u=l[0],s=l[1];if(s){l[1]=!1;return}if(r.next!==void 0&&_F(e,r.next,!0),u.tags.length){var v=u.tags[u.tags.length-1].nextElementSibling;u.before=v,u.flush()}e.insert("",r,u,!1)},[e,r.name]),null});function vF(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return T2(e)}function C2(){var t=vF.apply(void 0,arguments),e="animation-"+t.name;return{name:e,styles:"@keyframes "+e+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}var CRe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,IRe=yee(function(t){return CRe.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),ARe=IRe,RRe=function(e){return e!=="theme"},J9=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?ARe:RRe},eH=function(e,n,r){var i;if(n){var l=n.shouldForwardProp;i=e.__emotion_forwardProp&&l?function(u){return e.__emotion_forwardProp(u)&&l(u)}:l}return typeof i!="function"&&r&&(i=e.__emotion_forwardProp),i},MRe=function(e){var n=e.cache,r=e.serialized,i=e.isStringTag;return gF(n,r,i),Iee(function(){return _F(n,r,i)}),null},PRe=function t(e,n){var r=e.__emotion_real===e,i=r&&e.__emotion_base||e,l,u;n!==void 0&&(l=n.label,u=n.target);var s=eH(e,n,r),v=s||J9(i),w=!v("as");return function(){var A=arguments,F=r&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(l!==void 0&&F.push("label:"+l+";"),A[0]==null||A[0].raw===void 0)F.push.apply(F,A);else{var W=A[0];F.push(W[0]);for(var K=A.length,Q=1;Q<K;Q++)F.push(A[Q],W[Q])}var Z=yF(function(oe,ae,me){var pe=w&&oe.as||i,_e="",De=[],Ae=oe;if(oe.theme==null){Ae={};for(var re in oe)Ae[re]=oe[re];Ae.theme=se.useContext(xR)}typeof oe.className=="string"?_e=See(ae.registered,De,oe.className):oe.className!=null&&(_e=oe.className+" ");var fe=T2(F.concat(De),ae.registered,Ae);_e+=ae.key+"-"+fe.name,u!==void 0&&(_e+=" "+u);var ye=w&&s===void 0?J9(pe):v,ue={};for(var Ie in oe)w&&Ie==="as"||ye(Ie)&&(ue[Ie]=oe[Ie]);return ue.className=_e,me&&(ue.ref=me),se.createElement(se.Fragment,null,se.createElement(MRe,{cache:ae,serialized:fe,isStringTag:typeof pe=="string"}),se.createElement(pe,ue))});return Z.displayName=l!==void 0?l:"Styled("+(typeof i=="string"?i:i.displayName||i.name||"Component")+")",Z.defaultProps=e.defaultProps,Z.__emotion_real=Z,Z.__emotion_base=i,Z.__emotion_styles=F,Z.__emotion_forwardProp=s,Object.defineProperty(Z,"toString",{value:function(){return"."+u}}),Z.withComponent=function(oe,ae){var me=t(oe,EI({},n,ae,{shouldForwardProp:eH(Z,ae,!0)}));return me.apply(void 0,F)},Z}},DRe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],LN=PRe.bind(null);DRe.forEach(function(t){LN[t]=LN(t)});function kRe(t){return t==null||Object.keys(t).length===0}function NRe(t){const{styles:e,defaultTheme:n={}}=t,r=typeof e=="function"?i=>e(kRe(i)?n:i):e;return R.jsx(TRe,{styles:r})}function Ree(t,e){return LN(t,e)}function ORe(t,e){Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=e(t.__emotion_styles))}const tH=[];function nH(t){return tH[0]=t,T2(tH)}var Mee={exports:{}},ho={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bF=Symbol.for("react.transitional.element"),wF=Symbol.for("react.portal"),vR=Symbol.for("react.fragment"),bR=Symbol.for("react.strict_mode"),wR=Symbol.for("react.profiler"),ER=Symbol.for("react.consumer"),SR=Symbol.for("react.context"),TR=Symbol.for("react.forward_ref"),CR=Symbol.for("react.suspense"),IR=Symbol.for("react.suspense_list"),AR=Symbol.for("react.memo"),RR=Symbol.for("react.lazy"),LRe=Symbol.for("react.view_transition"),FRe=Symbol.for("react.client.reference");function Ku(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case bF:switch(t=t.type,t){case vR:case wR:case bR:case CR:case IR:case LRe:return t;default:switch(t=t&&t.$$typeof,t){case SR:case TR:case RR:case AR:return t;case ER:return t;default:return e}}case wF:return e}}}ho.ContextConsumer=ER;ho.ContextProvider=SR;ho.Element=bF;ho.ForwardRef=TR;ho.Fragment=vR;ho.Lazy=RR;ho.Memo=AR;ho.Portal=wF;ho.Profiler=wR;ho.StrictMode=bR;ho.Suspense=CR;ho.SuspenseList=IR;ho.isContextConsumer=function(t){return Ku(t)===ER};ho.isContextProvider=function(t){return Ku(t)===SR};ho.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===bF};ho.isForwardRef=function(t){return Ku(t)===TR};ho.isFragment=function(t){return Ku(t)===vR};ho.isLazy=function(t){return Ku(t)===RR};ho.isMemo=function(t){return Ku(t)===AR};ho.isPortal=function(t){return Ku(t)===wF};ho.isProfiler=function(t){return Ku(t)===wR};ho.isStrictMode=function(t){return Ku(t)===bR};ho.isSuspense=function(t){return Ku(t)===CR};ho.isSuspenseList=function(t){return Ku(t)===IR};ho.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===vR||t===wR||t===bR||t===CR||t===IR||typeof t=="object"&&t!==null&&(t.$$typeof===RR||t.$$typeof===AR||t.$$typeof===SR||t.$$typeof===ER||t.$$typeof===TR||t.$$typeof===FRe||t.getModuleId!==void 0)};ho.typeOf=Ku;Mee.exports=ho;var Pee=Mee.exports;function vd(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function Dee(t){if(se.isValidElement(t)||Pee.isValidElementType(t)||!vd(t))return t;const e={};return Object.keys(t).forEach(n=>{e[n]=Dee(t[n])}),e}function ec(t,e,n={clone:!0}){const r=n.clone?{...t}:t;return vd(t)&&vd(e)&&Object.keys(e).forEach(i=>{se.isValidElement(e[i])||Pee.isValidElementType(e[i])?r[i]=e[i]:vd(e[i])&&Object.prototype.hasOwnProperty.call(t,i)&&vd(t[i])?r[i]=ec(t[i],e[i],n):n.clone?r[i]=vd(e[i])?Dee(e[i]):e[i]:r[i]=e[i]}),r}const BRe=t=>{const e=Object.keys(t).map(n=>({key:n,val:t[n]}))||[];return e.sort((n,r)=>n.val-r.val),e.reduce((n,r)=>({...n,[r.key]:r.val}),{})};function zRe(t){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:r=5,...i}=t,l=BRe(e),u=Object.keys(l);function s(W){return`@media (min-width:${typeof e[W]=="number"?e[W]:W}${n})`}function v(W){return`@media (max-width:${(typeof e[W]=="number"?e[W]:W)-r/100}${n})`}function w(W,K){const Q=u.indexOf(K);return`@media (min-width:${typeof e[W]=="number"?e[W]:W}${n}) and (max-width:${(Q!==-1&&typeof e[u[Q]]=="number"?e[u[Q]]:K)-r/100}${n})`}function A(W){return u.indexOf(W)+1<u.length?w(W,u[u.indexOf(W)+1]):s(W)}function F(W){const K=u.indexOf(W);return K===0?s(u[1]):K===u.length-1?v(u[K]):w(W,u[u.indexOf(W)+1]).replace("@media","@media not all and")}return{keys:u,values:l,up:s,down:v,between:w,only:A,not:F,unit:n,...i}}function jRe(t,e){if(!t.containerQueries)return e;const n=Object.keys(e).filter(r=>r.startsWith("@container")).sort((r,i)=>{const l=/min-width:\s*([0-9.]+)/;return+(r.match(l)?.[1]||0)-+(i.match(l)?.[1]||0)});return n.length?n.reduce((r,i)=>{const l=e[i];return delete r[i],r[i]=l,r},{...e}):e}function VRe(t,e){return e==="@"||e.startsWith("@")&&(t.some(n=>e.startsWith(`@${n}`))||!!e.match(/^@\d/))}function URe(t,e){const n=e.match(/^@([^/]+)?\/?(.+)?$/);if(!n)return null;const[,r,i]=n,l=Number.isNaN(+r)?r||0:+r;return t.containerQueries(i).up(l)}function HRe(t){const e=(l,u)=>l.replace("@media",u?`@container ${u}`:"@container");function n(l,u){l.up=(...s)=>e(t.breakpoints.up(...s),u),l.down=(...s)=>e(t.breakpoints.down(...s),u),l.between=(...s)=>e(t.breakpoints.between(...s),u),l.only=(...s)=>e(t.breakpoints.only(...s),u),l.not=(...s)=>{const v=e(t.breakpoints.not(...s),u);return v.includes("not all and")?v.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):v}}const r={},i=l=>(n(r,l),r);return n(i),{...t,containerQueries:i}}const WRe={borderRadius:4};function zb(t,e){return e?ec(t,e,{clone:!1}):t}const MR={xs:0,sm:600,md:900,lg:1200,xl:1536},rH={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${MR[t]}px)`},$Re={containerQueries:t=>({up:e=>{let n=typeof e=="number"?e:MR[e]||e;return typeof n=="number"&&(n=`${n}px`),t?`@container ${t} (min-width:${n})`:`@container (min-width:${n})`}})};function Lf(t,e,n){const r=t.theme||{};if(Array.isArray(e)){const l=r.breakpoints||rH;return e.reduce((u,s,v)=>(u[l.up(l.keys[v])]=n(e[v]),u),{})}if(typeof e=="object"){const l=r.breakpoints||rH;return Object.keys(e).reduce((u,s)=>{if(VRe(l.keys,s)){const v=URe(r.containerQueries?r:$Re,s);v&&(u[v]=n(e[s],s))}else if(Object.keys(l.values||MR).includes(s)){const v=l.up(s);u[v]=n(e[s],s)}else{const v=s;u[v]=e[v]}return u},{})}return n(e)}function qRe(t={}){return t.keys?.reduce((n,r)=>{const i=t.up(r);return n[i]={},n},{})||{}}function GRe(t,e){return t.reduce((n,r)=>{const i=n[r];return(!i||Object.keys(i).length===0)&&delete n[r],n},e)}function or(t){if(typeof t!="string")throw new Error(Of(7));return t.charAt(0).toUpperCase()+t.slice(1)}function PR(t,e,n=!0){if(!e||typeof e!="string")return null;if(t&&t.vars&&n){const r=`vars.${e}`.split(".").reduce((i,l)=>i&&i[l]?i[l]:null,t);if(r!=null)return r}return e.split(".").reduce((r,i)=>r&&r[i]!=null?r[i]:null,t)}function TI(t,e,n,r=n){let i;return typeof t=="function"?i=t(n):Array.isArray(t)?i=t[n]||r:i=PR(t,n)||r,e&&(i=e(i,r,t)),i}function ya(t){const{prop:e,cssProperty:n=t.prop,themeKey:r,transform:i}=t,l=u=>{if(u[e]==null)return null;const s=u[e],v=u.theme,w=PR(v,r)||{};return Lf(u,s,F=>{let W=TI(w,i,F);return F===W&&typeof F=="string"&&(W=TI(w,i,`${e}${F==="default"?"":or(F)}`,F)),n===!1?W:{[n]:W}})};return l.propTypes={},l.filterProps=[e],l}function YRe(t){const e={};return n=>(e[n]===void 0&&(e[n]=t(n)),e[n])}const XRe={m:"margin",p:"padding"},KRe={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},iH={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},ZRe=YRe(t=>{if(t.length>2)if(iH[t])t=iH[t];else return[t];const[e,n]=t.split(""),r=XRe[e],i=KRe[n]||"";return Array.isArray(i)?i.map(l=>r+l):[r+i]}),EF=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],SF=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...EF,...SF];function I2(t,e,n,r){const i=PR(t,e,!0)??n;return typeof i=="number"||typeof i=="string"?l=>typeof l=="string"?l:typeof i=="string"?i.startsWith("var(")&&l===0?0:i.startsWith("var(")&&l===1?i:`calc(${l} * ${i})`:i*l:Array.isArray(i)?l=>{if(typeof l=="string")return l;const u=Math.abs(l),s=i[u];return l>=0?s:typeof s=="number"?-s:typeof s=="string"&&s.startsWith("var(")?`calc(-1 * ${s})`:`-${s}`}:typeof i=="function"?i:()=>{}}function TF(t){return I2(t,"spacing",8)}function A2(t,e){return typeof e=="string"||e==null?e:t(e)}function QRe(t,e){return n=>t.reduce((r,i)=>(r[i]=A2(e,n),r),{})}function JRe(t,e,n,r){if(!e.includes(n))return null;const i=ZRe(n),l=QRe(i,r),u=t[n];return Lf(t,u,l)}function kee(t,e){const n=TF(t.theme);return Object.keys(t).map(r=>JRe(t,e,r,n)).reduce(zb,{})}function Jo(t){return kee(t,EF)}Jo.propTypes={};Jo.filterProps=EF;function ea(t){return kee(t,SF)}ea.propTypes={};ea.filterProps=SF;function Nee(t=8,e=TF({spacing:t})){if(t.mui)return t;const n=(...r)=>(r.length===0?[1]:r).map(l=>{const u=e(l);return typeof u=="number"?`${u}px`:u}).join(" ");return n.mui=!0,n}function DR(...t){const e=t.reduce((r,i)=>(i.filterProps.forEach(l=>{r[l]=i}),r),{}),n=r=>Object.keys(r).reduce((i,l)=>e[l]?zb(i,e[l](r)):i,{});return n.propTypes={},n.filterProps=t.reduce((r,i)=>r.concat(i.filterProps),[]),n}function ju(t){return typeof t!="number"?t:`${t}px solid`}function Zu(t,e){return ya({prop:t,themeKey:"borders",transform:e})}const eMe=Zu("border",ju),tMe=Zu("borderTop",ju),nMe=Zu("borderRight",ju),rMe=Zu("borderBottom",ju),iMe=Zu("borderLeft",ju),sMe=Zu("borderColor"),oMe=Zu("borderTopColor"),aMe=Zu("borderRightColor"),lMe=Zu("borderBottomColor"),cMe=Zu("borderLeftColor"),uMe=Zu("outline",ju),hMe=Zu("outlineColor"),kR=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const e=I2(t.theme,"shape.borderRadius",4),n=r=>({borderRadius:A2(e,r)});return Lf(t,t.borderRadius,n)}return null};kR.propTypes={};kR.filterProps=["borderRadius"];DR(eMe,tMe,nMe,rMe,iMe,sMe,oMe,aMe,lMe,cMe,kR,uMe,hMe);const NR=t=>{if(t.gap!==void 0&&t.gap!==null){const e=I2(t.theme,"spacing",8),n=r=>({gap:A2(e,r)});return Lf(t,t.gap,n)}return null};NR.propTypes={};NR.filterProps=["gap"];const OR=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const e=I2(t.theme,"spacing",8),n=r=>({columnGap:A2(e,r)});return Lf(t,t.columnGap,n)}return null};OR.propTypes={};OR.filterProps=["columnGap"];const LR=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const e=I2(t.theme,"spacing",8),n=r=>({rowGap:A2(e,r)});return Lf(t,t.rowGap,n)}return null};LR.propTypes={};LR.filterProps=["rowGap"];const dMe=ya({prop:"gridColumn"}),fMe=ya({prop:"gridRow"}),pMe=ya({prop:"gridAutoFlow"}),mMe=ya({prop:"gridAutoColumns"}),gMe=ya({prop:"gridAutoRows"}),_Me=ya({prop:"gridTemplateColumns"}),yMe=ya({prop:"gridTemplateRows"}),xMe=ya({prop:"gridTemplateAreas"}),vMe=ya({prop:"gridArea"});DR(NR,OR,LR,dMe,fMe,pMe,mMe,gMe,_Me,yMe,xMe,vMe);function Iy(t,e){return e==="grey"?e:t}const bMe=ya({prop:"color",themeKey:"palette",transform:Iy}),wMe=ya({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Iy}),EMe=ya({prop:"backgroundColor",themeKey:"palette",transform:Iy});DR(bMe,wMe,EMe);function cu(t){return t<=1&&t!==0?`${t*100}%`:t}const SMe=ya({prop:"width",transform:cu}),CF=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const e=n=>{const r=t.theme?.breakpoints?.values?.[n]||MR[n];return r?t.theme?.breakpoints?.unit!=="px"?{maxWidth:`${r}${t.theme.breakpoints.unit}`}:{maxWidth:r}:{maxWidth:cu(n)}};return Lf(t,t.maxWidth,e)}return null};CF.filterProps=["maxWidth"];const TMe=ya({prop:"minWidth",transform:cu}),CMe=ya({prop:"height",transform:cu}),IMe=ya({prop:"maxHeight",transform:cu}),AMe=ya({prop:"minHeight",transform:cu});ya({prop:"size",cssProperty:"width",transform:cu});ya({prop:"size",cssProperty:"height",transform:cu});const RMe=ya({prop:"boxSizing"});DR(SMe,CF,TMe,CMe,IMe,AMe,RMe);const R2={border:{themeKey:"borders",transform:ju},borderTop:{themeKey:"borders",transform:ju},borderRight:{themeKey:"borders",transform:ju},borderBottom:{themeKey:"borders",transform:ju},borderLeft:{themeKey:"borders",transform:ju},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:ju},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:kR},color:{themeKey:"palette",transform:Iy},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Iy},backgroundColor:{themeKey:"palette",transform:Iy},p:{style:ea},pt:{style:ea},pr:{style:ea},pb:{style:ea},pl:{style:ea},px:{style:ea},py:{style:ea},padding:{style:ea},paddingTop:{style:ea},paddingRight:{style:ea},paddingBottom:{style:ea},paddingLeft:{style:ea},paddingX:{style:ea},paddingY:{style:ea},paddingInline:{style:ea},paddingInlineStart:{style:ea},paddingInlineEnd:{style:ea},paddingBlock:{style:ea},paddingBlockStart:{style:ea},paddingBlockEnd:{style:ea},m:{style:Jo},mt:{style:Jo},mr:{style:Jo},mb:{style:Jo},ml:{style:Jo},mx:{style:Jo},my:{style:Jo},margin:{style:Jo},marginTop:{style:Jo},marginRight:{style:Jo},marginBottom:{style:Jo},marginLeft:{style:Jo},marginX:{style:Jo},marginY:{style:Jo},marginInline:{style:Jo},marginInlineStart:{style:Jo},marginInlineEnd:{style:Jo},marginBlock:{style:Jo},marginBlockStart:{style:Jo},marginBlockEnd:{style:Jo},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:NR},rowGap:{style:LR},columnGap:{style:OR},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:cu},maxWidth:{style:CF},minWidth:{transform:cu},height:{transform:cu},maxHeight:{transform:cu},minHeight:{transform:cu},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function MMe(...t){const e=t.reduce((r,i)=>r.concat(Object.keys(i)),[]),n=new Set(e);return t.every(r=>n.size===Object.keys(r).length)}function PMe(t,e){return typeof t=="function"?t(e):t}function DMe(){function t(n,r,i,l){const u={[n]:r,theme:i},s=l[n];if(!s)return{[n]:r};const{cssProperty:v=n,themeKey:w,transform:A,style:F}=s;if(r==null)return null;if(w==="typography"&&r==="inherit")return{[n]:r};const W=PR(i,w)||{};return F?F(u):Lf(u,r,Q=>{let Z=TI(W,A,Q);return Q===Z&&typeof Q=="string"&&(Z=TI(W,A,`${n}${Q==="default"?"":or(Q)}`,Q)),v===!1?Z:{[v]:Z}})}function e(n){const{sx:r,theme:i={}}=n||{};if(!r)return null;const l=i.unstable_sxConfig??R2;function u(s){let v=s;if(typeof s=="function")v=s(i);else if(typeof s!="object")return s;if(!v)return null;const w=qRe(i.breakpoints),A=Object.keys(w);let F=w;return Object.keys(v).forEach(W=>{const K=PMe(v[W],i);if(K!=null)if(typeof K=="object")if(l[W])F=zb(F,t(W,K,i,l));else{const Q=Lf({theme:i},K,Z=>({[W]:Z}));MMe(Q,K)?F[W]=e({sx:K,theme:i}):F=zb(F,Q)}else F=zb(F,t(W,K,i,l))}),jRe(i,GRe(A,F))}return Array.isArray(r)?r.map(u):u(r)}return e}const g_=DMe();g_.filterProps=["sx"];function kMe(t,e){const n=this;if(n.vars){if(!n.colorSchemes?.[t]||typeof n.getColorSchemeSelector!="function")return{};let r=n.getColorSchemeSelector(t);return r==="&"?e:((r.includes("data-")||r.includes("."))&&(r=`*:where(${r.replace(/\s*&$/,"")}) &`),{[r]:e})}return n.palette.mode===t?e:{}}function M2(t={},...e){const{breakpoints:n={},palette:r={},spacing:i,shape:l={},...u}=t,s=zRe(n),v=Nee(i);let w=ec({breakpoints:s,direction:"ltr",components:{},palette:{mode:"light",...r},spacing:v,shape:{...WRe,...l}},u);return w=HRe(w),w.applyStyles=kMe,w=e.reduce((A,F)=>ec(A,F),w),w.unstable_sxConfig={...R2,...u?.unstable_sxConfig},w.unstable_sx=function(F){return g_({sx:F,theme:this})},w}function NMe(t){return Object.keys(t).length===0}function OMe(t=null){const e=se.useContext(xR);return!e||NMe(e)?t:e}const LMe=M2();function P2(t=LMe){return OMe(t)}function FMe({styles:t,themeId:e,defaultTheme:n={}}){const r=P2(n),i=typeof t=="function"?t(e&&r[e]||r):t;return R.jsx(NRe,{styles:i})}const BMe=t=>{const e={systemProps:{},otherProps:{}},n=t?.theme?.unstable_sxConfig??R2;return Object.keys(t).forEach(r=>{n[r]?e.systemProps[r]=t[r]:e.otherProps[r]=t[r]}),e};function IF(t){const{sx:e,...n}=t,{systemProps:r,otherProps:i}=BMe(n);let l;return Array.isArray(e)?l=[r,...e]:typeof e=="function"?l=(...u)=>{const s=e(...u);return vd(s)?{...r,...s}:r}:l={...r,...e},{...i,sx:l}}const sH=t=>t,zMe=()=>{let t=sH;return{configure(e){t=e},generate(e){return t(e)},reset(){t=sH}}},Oee=zMe();function jMe(t={}){const{themeId:e,defaultTheme:n,defaultClassName:r="MuiBox-root",generateClassName:i}=t,l=Ree("div",{shouldForwardProp:s=>s!=="theme"&&s!=="sx"&&s!=="as"})(g_);return se.forwardRef(function(v,w){const A=P2(n),{className:F,component:W="div",...K}=IF(v);return R.jsx(l,{as:W,ref:w,className:Fr(F,i?i(r):r),theme:e&&A[e]||A,...K})})}const VMe={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function es(t,e,n="Mui"){const r=VMe[e];return r?`${n}-${r}`:`${Oee.generate(t)}-${e}`}function as(t,e,n="Mui"){const r={};return e.forEach(i=>{r[i]=es(t,i,n)}),r}function Lee(t){const{variants:e,...n}=t,r={variants:e,style:nH(n),isProcessed:!0};return r.style===n||e&&e.forEach(i=>{typeof i.style!="function"&&(i.style=nH(i.style))}),r}const UMe=M2();function u3(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}function HMe(t){return t?(e,n)=>n[t]:null}function WMe(t,e,n){t.theme=qMe(t.theme)?n:t.theme[e]||t.theme}function oC(t,e){const n=typeof e=="function"?e(t):e;if(Array.isArray(n))return n.flatMap(r=>oC(t,r));if(Array.isArray(n?.variants)){let r;if(n.isProcessed)r=n.style;else{const{variants:i,...l}=n;r=l}return Fee(t,n.variants,[r])}return n?.isProcessed?n.style:n}function Fee(t,e,n=[]){let r;e:for(let i=0;i<e.length;i+=1){const l=e[i];if(typeof l.props=="function"){if(r??={...t,...t.ownerState,ownerState:t.ownerState},!l.props(r))continue}else for(const u in l.props)if(t[u]!==l.props[u]&&t.ownerState?.[u]!==l.props[u])continue e;typeof l.style=="function"?(r??={...t,...t.ownerState,ownerState:t.ownerState},n.push(l.style(r))):n.push(l.style)}return n}function Bee(t={}){const{themeId:e,defaultTheme:n=UMe,rootShouldForwardProp:r=u3,slotShouldForwardProp:i=u3}=t;function l(s){WMe(s,e,n)}return(s,v={})=>{ORe(s,De=>De.filter(Ae=>Ae!==g_));const{name:w,slot:A,skipVariantsResolver:F,skipSx:W,overridesResolver:K=HMe(YMe(A)),...Q}=v,Z=F!==void 0?F:A&&A!=="Root"&&A!=="root"||!1,oe=W||!1;let ae=u3;A==="Root"||A==="root"?ae=r:A?ae=i:GMe(s)&&(ae=void 0);const me=Ree(s,{shouldForwardProp:ae,label:$Me(),...Q}),pe=De=>{if(typeof De=="function"&&De.__emotion_real!==De)return function(re){return oC(re,De)};if(vd(De)){const Ae=Lee(De);return Ae.variants?function(fe){return oC(fe,Ae)}:Ae.style}return De},_e=(...De)=>{const Ae=[],re=De.map(pe),fe=[];if(Ae.push(l),w&&K&&fe.push(function(Oe){const ft=Oe.theme.components?.[w]?.styleOverrides;if(!ft)return null;const He={};for(const bt in ft)He[bt]=oC(Oe,ft[bt]);return K(Oe,He)}),w&&!Z&&fe.push(function(Oe){const ft=Oe.theme?.components?.[w]?.variants;return ft?Fee(Oe,ft):null}),oe||fe.push(g_),Array.isArray(re[0])){const Ie=re.shift(),Oe=new Array(Ae.length).fill(""),ze=new Array(fe.length).fill("");let ft;ft=[...Oe,...Ie,...ze],ft.raw=[...Oe,...Ie.raw,...ze],Ae.unshift(ft)}const ye=[...Ae,...re,...fe],ue=me(...ye);return s.muiName&&(ue.muiName=s.muiName),ue};return me.withConfig&&(_e.withConfig=me.withConfig),_e}}function $Me(t,e){return void 0}function qMe(t){for(const e in t)return!1;return!0}function GMe(t){return typeof t=="string"&&t.charCodeAt(0)>96}function YMe(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}const zee=Bee();function zw(t,e){const n={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const i=r;if(i==="components"||i==="slots")n[i]={...t[i],...n[i]};else if(i==="componentsProps"||i==="slotProps"){const l=t[i],u=e[i];if(!u)n[i]=l||{};else if(!l)n[i]=u;else{n[i]={...u};for(const s in l)if(Object.prototype.hasOwnProperty.call(l,s)){const v=s;n[i][v]=zw(l[v],u[v])}}}else n[i]===void 0&&(n[i]=t[i])}return n}function XMe(t){const{theme:e,name:n,props:r}=t;return!e||!e.components||!e.components[n]||!e.components[n].defaultProps?r:zw(e.components[n].defaultProps,r)}function jee({props:t,name:e,defaultTheme:n,themeId:r}){let i=P2(n);return r&&(i=i[r]||i),XMe({theme:i,name:e,props:t})}const __=typeof window<"u"?se.useLayoutEffect:se.useEffect;function KMe(t,e=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER){return Math.max(e,Math.min(t,n))}function AF(t,e=0,n=1){return KMe(t,e,n)}function ZMe(t){t=t.slice(1);const e=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let n=t.match(e);return n&&n[0].length===1&&(n=n.map(r=>r+r)),n?`rgb${n.length===4?"a":""}(${n.map((r,i)=>i<3?parseInt(r,16):Math.round(parseInt(r,16)/255*1e3)/1e3).join(", ")})`:""}function Am(t){if(t.type)return t;if(t.charAt(0)==="#")return Am(ZMe(t));const e=t.indexOf("("),n=t.substring(0,e);if(!["rgb","rgba","hsl","hsla","color"].includes(n))throw new Error(Of(9,t));let r=t.substring(e+1,t.length-1),i;if(n==="color"){if(r=r.split(" "),i=r.shift(),r.length===4&&r[3].charAt(0)==="/"&&(r[3]=r[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(i))throw new Error(Of(10,i))}else r=r.split(",");return r=r.map(l=>parseFloat(l)),{type:n,values:r,colorSpace:i}}const QMe=t=>{const e=Am(t);return e.values.slice(0,3).map((n,r)=>e.type.includes("hsl")&&r!==0?`${n}%`:n).join(" ")},fb=(t,e)=>{try{return QMe(t)}catch{return t}};function FR(t){const{type:e,colorSpace:n}=t;let{values:r}=t;return e.includes("rgb")?r=r.map((i,l)=>l<3?parseInt(i,10):i):e.includes("hsl")&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),e.includes("color")?r=`${n} ${r.join(" ")}`:r=`${r.join(", ")}`,`${e}(${r})`}function Vee(t){t=Am(t);const{values:e}=t,n=e[0],r=e[1]/100,i=e[2]/100,l=r*Math.min(i,1-i),u=(w,A=(w+n/30)%12)=>i-l*Math.max(Math.min(A-3,9-A,1),-1);let s="rgb";const v=[Math.round(u(0)*255),Math.round(u(8)*255),Math.round(u(4)*255)];return t.type==="hsla"&&(s+="a",v.push(e[3])),FR({type:s,values:v})}function FN(t){t=Am(t);let e=t.type==="hsl"||t.type==="hsla"?Am(Vee(t)).values:t.values;return e=e.map(n=>(t.type!=="color"&&(n/=255),n<=.03928?n/12.92:((n+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function JMe(t,e){const n=FN(t),r=FN(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function el(t,e){return t=Am(t),e=AF(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${e}`:t.values[3]=e,FR(t)}function fT(t,e,n){try{return el(t,e)}catch{return t}}function RF(t,e){if(t=Am(t),e=AF(e),t.type.includes("hsl"))t.values[2]*=1-e;else if(t.type.includes("rgb")||t.type.includes("color"))for(let n=0;n<3;n+=1)t.values[n]*=1-e;return FR(t)}function lo(t,e,n){try{return RF(t,e)}catch{return t}}function MF(t,e){if(t=Am(t),e=AF(e),t.type.includes("hsl"))t.values[2]+=(100-t.values[2])*e;else if(t.type.includes("rgb"))for(let n=0;n<3;n+=1)t.values[n]+=(255-t.values[n])*e;else if(t.type.includes("color"))for(let n=0;n<3;n+=1)t.values[n]+=(1-t.values[n])*e;return FR(t)}function co(t,e,n){try{return MF(t,e)}catch{return t}}function ePe(t,e=.15){return FN(t)>.5?RF(t,e):MF(t,e)}function pT(t,e,n){try{return ePe(t,e)}catch{return t}}function oH(...t){return t.reduce((e,n)=>n==null?e:function(...i){e.apply(this,i),n.apply(this,i)},()=>{})}function Uee(t,e=166){let n;function r(...i){const l=()=>{t.apply(this,i)};clearTimeout(n),n=setTimeout(l,e)}return r.clear=()=>{clearTimeout(n)},r}function aC(t,e){return se.isValidElement(t)&&e.indexOf(t.type.muiName??t.type?._payload?.value?.muiName)!==-1}function jh(t){return t&&t.ownerDocument||document}function Ff(t){return jh(t).defaultView||window}function aH(t,e){typeof t=="function"?t(e):t&&(t.current=e)}let lH=0;function tPe(t){const[e,n]=se.useState(t),r=t||e;return se.useEffect(()=>{e==null&&(lH+=1,n(`mui-${lH}`))},[e]),r}const nPe={...Dy},cH=nPe.useId;function BR(t){if(cH!==void 0){const e=cH();return t??e}return tPe(t)}function uH({controlled:t,default:e,name:n,state:r="value"}){const{current:i}=se.useRef(t!==void 0),[l,u]=se.useState(e),s=i?t:l,v=se.useCallback(w=>{i||u(w)},[]);return[s,v]}function e_(t){const e=se.useRef(t);return __(()=>{e.current=t}),se.useRef((...n)=>(0,e.current)(...n)).current}function xc(...t){const e=se.useRef(void 0),n=se.useCallback(r=>{const i=t.map(l=>{if(l==null)return null;if(typeof l=="function"){const u=l,s=u(r);return typeof s=="function"?s:()=>{u(null)}}return l.current=r,()=>{l.current=null}});return()=>{i.forEach(l=>l?.())}},t);return se.useMemo(()=>t.every(r=>r==null)?null:r=>{e.current&&(e.current(),e.current=void 0),r!=null&&(e.current=n(r))},t)}const hH={};function Hee(t,e){const n=se.useRef(hH);return n.current===hH&&(n.current=t(e)),n}const rPe=[];function iPe(t){se.useEffect(t,rPe)}class PF{static create(){return new PF}currentId=null;start(e,n){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,n()},e)}clear=()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)};disposeEffect=()=>this.clear}function Wee(){const t=Hee(PF.create).current;return iPe(t.disposeEffect),t}function dH(t){try{return t.matches(":focus-visible")}catch{}return!1}function $ee(t=window){const e=t.document.documentElement.clientWidth;return t.innerWidth-e}function ts(t,e,n=void 0){const r={};for(const i in t){const l=t[i];let u="",s=!0;for(let v=0;v<l.length;v+=1){const w=l[v];w&&(u+=(s===!0?"":" ")+e(w),s=!1,n&&n[w]&&(u+=" "+n[w]))}r[i]=u}return r}function sPe(t){return typeof t=="string"}function qee(t,e,n){return t===void 0||sPe(t)?e:{...e,ownerState:{...e.ownerState,...n}}}function Gee(t,e=[]){if(t===void 0)return{};const n={};return Object.keys(t).filter(r=>r.match(/^on[A-Z]/)&&typeof t[r]=="function"&&!e.includes(r)).forEach(r=>{n[r]=t[r]}),n}function fH(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(n=>!(n.match(/^on[A-Z]/)&&typeof t[n]=="function")).forEach(n=>{e[n]=t[n]}),e}function Yee(t){const{getSlotProps:e,additionalProps:n,externalSlotProps:r,externalForwardedProps:i,className:l}=t;if(!e){const K=Fr(n?.className,l,i?.className,r?.className),Q={...n?.style,...i?.style,...r?.style},Z={...n,...i,...r};return K.length>0&&(Z.className=K),Object.keys(Q).length>0&&(Z.style=Q),{props:Z,internalRef:void 0}}const u=Gee({...i,...r}),s=fH(r),v=fH(i),w=e(u),A=Fr(w?.className,n?.className,l,i?.className,r?.className),F={...w?.style,...n?.style,...i?.style,...r?.style},W={...w,...n,...v,...s};return A.length>0&&(W.className=A),Object.keys(F).length>0&&(W.style=F),{props:W,internalRef:w.ref}}function Xee(t,e,n){return typeof t=="function"?t(e,n):t}function oPe(t){const{elementType:e,externalSlotProps:n,ownerState:r,skipResolvingSlotProps:i=!1,...l}=t,u=i?{}:Xee(n,r),{props:s,internalRef:v}=Yee({...l,externalSlotProps:u}),w=xc(v,u?.ref,t.additionalProps?.ref);return qee(e,{...s,ref:w},r)}function D2(t){return parseInt(se.version,10)>=19?t?.props?.ref||null:t?.ref||null}const aPe=se.createContext(),lPe=()=>se.useContext(aPe)??!1,cPe=se.createContext(void 0);function uPe(t){const{theme:e,name:n,props:r}=t;if(!e||!e.components||!e.components[n])return r;const i=e.components[n];return i.defaultProps?zw(i.defaultProps,r):!i.styleOverrides&&!i.variants?zw(i,r):r}function hPe({props:t,name:e}){const n=se.useContext(cPe);return uPe({props:t,name:e,theme:{components:n}})}const pH={theme:void 0};function dPe(t){let e,n;return function(i){let l=e;return(l===void 0||i.theme!==n)&&(pH.theme=i.theme,l=Lee(t(pH)),e=l,n=i.theme),l}}function fPe(t=""){function e(...r){if(!r.length)return"";const i=r[0];return typeof i=="string"&&!i.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${t?`${t}-`:""}${i}${e(...r.slice(1))})`:`, ${i}`}return(r,...i)=>`var(--${t?`${t}-`:""}${r}${e(...i)})`}const mH=(t,e,n,r=[])=>{let i=t;e.forEach((l,u)=>{u===e.length-1?Array.isArray(i)?i[Number(l)]=n:i&&typeof i=="object"&&(i[l]=n):i&&typeof i=="object"&&(i[l]||(i[l]=r.includes(l)?[]:{}),i=i[l])})},pPe=(t,e,n)=>{function r(i,l=[],u=[]){Object.entries(i).forEach(([s,v])=>{(!n||n&&!n([...l,s]))&&v!=null&&(typeof v=="object"&&Object.keys(v).length>0?r(v,[...l,s],Array.isArray(v)?[...u,s]:u):e([...l,s],v,u))})}r(t)},mPe=(t,e)=>typeof e=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(r=>t.includes(r))||t[t.length-1].toLowerCase().includes("opacity")?e:`${e}px`:e;function h3(t,e){const{prefix:n,shouldSkipGeneratingVar:r}=e||{},i={},l={},u={};return pPe(t,(s,v,w)=>{if((typeof v=="string"||typeof v=="number")&&(!r||!r(s,v))){const A=`--${n?`${n}-`:""}${s.join("-")}`,F=mPe(s,v);Object.assign(i,{[A]:F}),mH(l,s,`var(${A})`,w),mH(u,s,`var(${A}, ${F})`,w)}},s=>s[0]==="vars"),{css:i,vars:l,varsWithDefaults:u}}function gPe(t,e={}){const{getSelector:n=oe,disableCssColorScheme:r,colorSchemeSelector:i}=e,{colorSchemes:l={},components:u,defaultColorScheme:s="light",...v}=t,{vars:w,css:A,varsWithDefaults:F}=h3(v,e);let W=F;const K={},{[s]:Q,...Z}=l;if(Object.entries(Z||{}).forEach(([pe,_e])=>{const{vars:De,css:Ae,varsWithDefaults:re}=h3(_e,e);W=ec(W,re),K[pe]={css:Ae,vars:De}}),Q){const{css:pe,vars:_e,varsWithDefaults:De}=h3(Q,e);W=ec(W,De),K[s]={css:pe,vars:_e}}function oe(pe,_e){let De=i;if(i==="class"&&(De=".%s"),i==="data"&&(De="[data-%s]"),i?.startsWith("data-")&&!i.includes("%s")&&(De=`[${i}="%s"]`),pe){if(De==="media")return t.defaultColorScheme===pe?":root":{[`@media (prefers-color-scheme: ${l[pe]?.palette?.mode||pe})`]:{":root":_e}};if(De)return t.defaultColorScheme===pe?`:root, ${De.replace("%s",String(pe))}`:De.replace("%s",String(pe))}return":root"}return{vars:W,generateThemeVars:()=>{let pe={...w};return Object.entries(K).forEach(([,{vars:_e}])=>{pe=ec(pe,_e)}),pe},generateStyleSheets:()=>{const pe=[],_e=t.defaultColorScheme||"light";function De(fe,ye){Object.keys(ye).length&&pe.push(typeof fe=="string"?{[fe]:{...ye}}:fe)}De(n(void 0,{...A}),A);const{[_e]:Ae,...re}=K;if(Ae){const{css:fe}=Ae,ye=l[_e]?.palette?.mode,ue=!r&&ye?{colorScheme:ye,...fe}:{...fe};De(n(_e,{...ue}),ue)}return Object.entries(re).forEach(([fe,{css:ye}])=>{const ue=l[fe]?.palette?.mode,Ie=!r&&ue?{colorScheme:ue,...ye}:{...ye};De(n(fe,{...Ie}),Ie)}),pe}}}function _Pe(t){return function(n){return t==="media"?`@media (prefers-color-scheme: ${n})`:t?t.startsWith("data-")&&!t.includes("%s")?`[${t}="${n}"] &`:t==="class"?`.${n} &`:t==="data"?`[data-${n}] &`:`${t.replace("%s",n)} &`:"&"}}const yPe=M2(),xPe=zee("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`maxWidth${or(String(n.maxWidth))}`],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),vPe=t=>jee({props:t,name:"MuiContainer",defaultTheme:yPe}),bPe=(t,e)=>{const n=v=>es(e,v),{classes:r,fixed:i,disableGutters:l,maxWidth:u}=t,s={root:["root",u&&`maxWidth${or(String(u))}`,i&&"fixed",l&&"disableGutters"]};return ts(s,n,r)};function wPe(t={}){const{createStyledComponent:e=xPe,useThemeProps:n=vPe,componentName:r="MuiContainer"}=t,i=e(({theme:u,ownerState:s})=>({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!s.disableGutters&&{paddingLeft:u.spacing(2),paddingRight:u.spacing(2),[u.breakpoints.up("sm")]:{paddingLeft:u.spacing(3),paddingRight:u.spacing(3)}}}),({theme:u,ownerState:s})=>s.fixed&&Object.keys(u.breakpoints.values).reduce((v,w)=>{const A=w,F=u.breakpoints.values[A];return F!==0&&(v[u.breakpoints.up(A)]={maxWidth:`${F}${u.breakpoints.unit}`}),v},{}),({theme:u,ownerState:s})=>({...s.maxWidth==="xs"&&{[u.breakpoints.up("xs")]:{maxWidth:Math.max(u.breakpoints.values.xs,444)}},...s.maxWidth&&s.maxWidth!=="xs"&&{[u.breakpoints.up(s.maxWidth)]:{maxWidth:`${u.breakpoints.values[s.maxWidth]}${u.breakpoints.unit}`}}}));return se.forwardRef(function(s,v){const w=n(s),{className:A,component:F="div",disableGutters:W=!1,fixed:K=!1,maxWidth:Q="lg",classes:Z,...oe}=w,ae={...w,component:F,disableGutters:W,fixed:K,maxWidth:Q},me=bPe(ae,r);return R.jsx(i,{as:F,ownerState:ae,className:Fr(me.root,A),ref:v,...oe})})}const EPe=(t,e)=>t.filter(n=>e.includes(n)),Lx=(t,e,n)=>{const r=t.keys[0];Array.isArray(e)?e.forEach((i,l)=>{n((u,s)=>{l<=t.keys.length-1&&(l===0?Object.assign(u,s):u[t.up(t.keys[l])]=s)},i)}):e&&typeof e=="object"?(Object.keys(e).length>t.keys.length?t.keys:EPe(t.keys,Object.keys(e))).forEach(l=>{if(t.keys.includes(l)){const u=e[l];u!==void 0&&n((s,v)=>{r===l?Object.assign(s,v):s[t.up(l)]=v},u)}}):(typeof e=="number"||typeof e=="string")&&n((i,l)=>{Object.assign(i,l)},e)};function CI(t){return`--Grid-${t}Spacing`}function zR(t){return`--Grid-parent-${t}Spacing`}const gH="--Grid-columns",Ay="--Grid-parent-columns",SPe=({theme:t,ownerState:e})=>{const n={};return Lx(t.breakpoints,e.size,(r,i)=>{let l={};i==="grow"&&(l={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(l={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(l={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / var(${Ay}) - (var(${Ay}) - ${i}) * (var(${zR("column")}) / var(${Ay})))`}),r(n,l)}),n},TPe=({theme:t,ownerState:e})=>{const n={};return Lx(t.breakpoints,e.offset,(r,i)=>{let l={};i==="auto"&&(l={marginLeft:"auto"}),typeof i=="number"&&(l={marginLeft:i===0?"0px":`calc(100% * ${i} / var(${Ay}) + var(${zR("column")}) * ${i} / var(${Ay}))`}),r(n,l)}),n},CPe=({theme:t,ownerState:e})=>{if(!e.container)return{};const n={[gH]:12};return Lx(t.breakpoints,e.columns,(r,i)=>{const l=i??12;r(n,{[gH]:l,"> *":{[Ay]:l}})}),n},IPe=({theme:t,ownerState:e})=>{if(!e.container)return{};const n={};return Lx(t.breakpoints,e.rowSpacing,(r,i)=>{const l=typeof i=="string"?i:t.spacing?.(i);r(n,{[CI("row")]:l,"> *":{[zR("row")]:l}})}),n},APe=({theme:t,ownerState:e})=>{if(!e.container)return{};const n={};return Lx(t.breakpoints,e.columnSpacing,(r,i)=>{const l=typeof i=="string"?i:t.spacing?.(i);r(n,{[CI("column")]:l,"> *":{[zR("column")]:l}})}),n},RPe=({theme:t,ownerState:e})=>{if(!e.container)return{};const n={};return Lx(t.breakpoints,e.direction,(r,i)=>{r(n,{flexDirection:i})}),n},MPe=({ownerState:t})=>({minWidth:0,boxSizing:"border-box",...t.container&&{display:"flex",flexWrap:"wrap",...t.wrap&&t.wrap!=="wrap"&&{flexWrap:t.wrap},gap:`var(${CI("row")}) var(${CI("column")})`}}),PPe=t=>{const e=[];return Object.entries(t).forEach(([n,r])=>{r!==!1&&r!==void 0&&e.push(`grid-${n}-${String(r)}`)}),e},DPe=(t,e="xs")=>{function n(r){return r===void 0?!1:typeof r=="string"&&!Number.isNaN(Number(r))||typeof r=="number"&&r>0}if(n(t))return[`spacing-${e}-${String(t)}`];if(typeof t=="object"&&!Array.isArray(t)){const r=[];return Object.entries(t).forEach(([i,l])=>{n(l)&&r.push(`spacing-${i}-${String(l)}`)}),r}return[]},kPe=t=>t===void 0?[]:typeof t=="object"?Object.entries(t).map(([e,n])=>`direction-${e}-${n}`):[`direction-xs-${String(t)}`];function NPe(t,e){t.item!==void 0&&delete t.item,t.zeroMinWidth!==void 0&&delete t.zeroMinWidth,e.keys.forEach(n=>{t[n]!==void 0&&delete t[n]})}const OPe=M2(),LPe=zee("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,e)=>e.root});function FPe(t){return jee({props:t,name:"MuiGrid",defaultTheme:OPe})}function BPe(t={}){const{createStyledComponent:e=LPe,useThemeProps:n=FPe,useTheme:r=P2,componentName:i="MuiGrid"}=t,l=(w,A)=>{const{container:F,direction:W,spacing:K,wrap:Q,size:Z}=w,oe={root:["root",F&&"container",Q!=="wrap"&&`wrap-xs-${String(Q)}`,...kPe(W),...PPe(Z),...F?DPe(K,A.breakpoints.keys[0]):[]]};return ts(oe,ae=>es(i,ae),{})};function u(w,A,F=()=>!0){const W={};return w===null||(Array.isArray(w)?w.forEach((K,Q)=>{K!==null&&F(K)&&A.keys[Q]&&(W[A.keys[Q]]=K)}):typeof w=="object"?Object.keys(w).forEach(K=>{const Q=w[K];Q!=null&&F(Q)&&(W[K]=Q)}):W[A.keys[0]]=w),W}const s=e(CPe,APe,IPe,SPe,RPe,MPe,TPe),v=se.forwardRef(function(A,F){const W=r(),K=n(A),Q=IF(K);NPe(Q,W.breakpoints);const{className:Z,children:oe,columns:ae=12,container:me=!1,component:pe="div",direction:_e="row",wrap:De="wrap",size:Ae={},offset:re={},spacing:fe=0,rowSpacing:ye=fe,columnSpacing:ue=fe,unstable_level:Ie=0,...Oe}=Q,ze=u(Ae,W.breakpoints,In=>In!==!1),ft=u(re,W.breakpoints),He=A.columns??(Ie?void 0:ae),bt=A.spacing??(Ie?void 0:fe),Nt=A.rowSpacing??A.spacing??(Ie?void 0:ye),wt=A.columnSpacing??A.spacing??(Ie?void 0:ue),it={...Q,level:Ie,columns:He,container:me,direction:_e,wrap:De,spacing:bt,rowSpacing:Nt,columnSpacing:wt,size:ze,offset:ft},nn=l(it,W);return R.jsx(s,{ref:F,as:pe,ownerState:it,className:Fr(nn.root,Z),...Oe,children:se.Children.map(oe,In=>se.isValidElement(In)&&aC(In,["Grid"])&&me&&In.props.container?se.cloneElement(In,{unstable_level:In.props?.unstable_level??Ie+1}):In)})});return v.muiName="Grid",v}function Kee(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Ow.white,default:Ow.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const zPe=Kee();function Zee(){return{text:{primary:Ow.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Ow.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const _H=Zee();function yH(t,e,n,r){const i=r.light||r,l=r.dark||r*1.5;t[e]||(t.hasOwnProperty(n)?t[e]=t[n]:e==="light"?t.light=MF(t.main,i):e==="dark"&&(t.dark=RF(t.main,l)))}function jPe(t="light"){return t==="dark"?{main:j0[200],light:j0[50],dark:j0[400]}:{main:j0[700],light:j0[400],dark:j0[800]}}function VPe(t="light"){return t==="dark"?{main:z0[200],light:z0[50],dark:z0[400]}:{main:z0[500],light:z0[300],dark:z0[700]}}function UPe(t="light"){return t==="dark"?{main:B0[500],light:B0[300],dark:B0[700]}:{main:B0[700],light:B0[400],dark:B0[800]}}function HPe(t="light"){return t==="dark"?{main:V0[400],light:V0[300],dark:V0[700]}:{main:V0[700],light:V0[500],dark:V0[900]}}function WPe(t="light"){return t==="dark"?{main:U0[400],light:U0[300],dark:U0[700]}:{main:U0[800],light:U0[500],dark:U0[900]}}function $Pe(t="light"){return t==="dark"?{main:jv[400],light:jv[300],dark:jv[700]}:{main:"#ed6c02",light:jv[500],dark:jv[900]}}function DF(t){const{mode:e="light",contrastThreshold:n=3,tonalOffset:r=.2,...i}=t,l=t.primary||jPe(e),u=t.secondary||VPe(e),s=t.error||UPe(e),v=t.info||HPe(e),w=t.success||WPe(e),A=t.warning||$Pe(e);function F(Z){return JMe(Z,_H.text.primary)>=n?_H.text.primary:zPe.text.primary}const W=({color:Z,name:oe,mainShade:ae=500,lightShade:me=300,darkShade:pe=700})=>{if(Z={...Z},!Z.main&&Z[ae]&&(Z.main=Z[ae]),!Z.hasOwnProperty("main"))throw new Error(Of(11,oe?` (${oe})`:"",ae));if(typeof Z.main!="string")throw new Error(Of(12,oe?` (${oe})`:"",JSON.stringify(Z.main)));return yH(Z,"light",me,r),yH(Z,"dark",pe,r),Z.contrastText||(Z.contrastText=F(Z.main)),Z};let K;return e==="light"?K=Kee():e==="dark"&&(K=Zee()),ec({common:{...Ow},mode:e,primary:W({color:l,name:"primary"}),secondary:W({color:u,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:W({color:s,name:"error"}),warning:W({color:A,name:"warning"}),info:W({color:v,name:"info"}),success:W({color:w,name:"success"}),grey:MAe,contrastThreshold:n,getContrastText:F,augmentColor:W,tonalOffset:r,...K},i)}function qPe(t){const e={};return Object.entries(t).forEach(r=>{const[i,l]=r;typeof l=="object"&&(e[i]=`${l.fontStyle?`${l.fontStyle} `:""}${l.fontVariant?`${l.fontVariant} `:""}${l.fontWeight?`${l.fontWeight} `:""}${l.fontStretch?`${l.fontStretch} `:""}${l.fontSize||""}${l.lineHeight?`/${l.lineHeight} `:""}${l.fontFamily||""}`)}),e}function GPe(t,e){return{toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}},...e}}function YPe(t){return Math.round(t*1e5)/1e5}const xH={textTransform:"uppercase"},vH='"Roboto", "Helvetica", "Arial", sans-serif';function XPe(t,e){const{fontFamily:n=vH,fontSize:r=14,fontWeightLight:i=300,fontWeightRegular:l=400,fontWeightMedium:u=500,fontWeightBold:s=700,htmlFontSize:v=16,allVariants:w,pxToRem:A,...F}=typeof e=="function"?e(t):e,W=r/14,K=A||(oe=>`${oe/v*W}rem`),Q=(oe,ae,me,pe,_e)=>({fontFamily:n,fontWeight:oe,fontSize:K(ae),lineHeight:me,...n===vH?{letterSpacing:`${YPe(pe/ae)}em`}:{},..._e,...w}),Z={h1:Q(i,96,1.167,-1.5),h2:Q(i,60,1.2,-.5),h3:Q(l,48,1.167,0),h4:Q(l,34,1.235,.25),h5:Q(l,24,1.334,0),h6:Q(u,20,1.6,.15),subtitle1:Q(l,16,1.75,.15),subtitle2:Q(u,14,1.57,.1),body1:Q(l,16,1.5,.15),body2:Q(l,14,1.43,.15),button:Q(u,14,1.75,.4,xH),caption:Q(l,12,1.66,.4),overline:Q(l,12,2.66,1,xH),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return ec({htmlFontSize:v,pxToRem:K,fontFamily:n,fontSize:r,fontWeightLight:i,fontWeightRegular:l,fontWeightMedium:u,fontWeightBold:s,...Z},F,{clone:!1})}const KPe=.2,ZPe=.14,QPe=.12;function Do(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${KPe})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${ZPe})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${QPe})`].join(",")}const JPe=["none",Do(0,2,1,-1,0,1,1,0,0,1,3,0),Do(0,3,1,-2,0,2,2,0,0,1,5,0),Do(0,3,3,-2,0,3,4,0,0,1,8,0),Do(0,2,4,-1,0,4,5,0,0,1,10,0),Do(0,3,5,-1,0,5,8,0,0,1,14,0),Do(0,3,5,-1,0,6,10,0,0,1,18,0),Do(0,4,5,-2,0,7,10,1,0,2,16,1),Do(0,5,5,-3,0,8,10,1,0,3,14,2),Do(0,5,6,-3,0,9,12,1,0,3,16,2),Do(0,6,6,-3,0,10,14,1,0,4,18,3),Do(0,6,7,-4,0,11,15,1,0,4,20,3),Do(0,7,8,-4,0,12,17,2,0,5,22,4),Do(0,7,8,-4,0,13,19,2,0,5,24,4),Do(0,7,9,-4,0,14,21,2,0,5,26,4),Do(0,8,9,-5,0,15,22,2,0,6,28,5),Do(0,8,10,-5,0,16,24,2,0,6,30,5),Do(0,8,11,-5,0,17,26,2,0,6,32,5),Do(0,9,11,-5,0,18,28,2,0,7,34,6),Do(0,9,12,-6,0,19,29,2,0,7,36,6),Do(0,10,13,-6,0,20,31,3,0,8,38,7),Do(0,10,13,-6,0,21,33,3,0,8,40,7),Do(0,10,14,-6,0,22,35,3,0,8,42,7),Do(0,11,14,-7,0,23,36,3,0,9,44,8),Do(0,11,15,-7,0,24,38,3,0,9,46,8)],eDe={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},tDe={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function bH(t){return`${Math.round(t)}ms`}function nDe(t){if(!t)return 0;const e=t/36;return Math.min(Math.round((4+15*e**.25+e/5)*10),3e3)}function rDe(t){const e={...eDe,...t.easing},n={...tDe,...t.duration};return{getAutoHeightDuration:nDe,create:(i=["all"],l={})=>{const{duration:u=n.standard,easing:s=e.easeInOut,delay:v=0,...w}=l;return(Array.isArray(i)?i:[i]).map(A=>`${A} ${typeof u=="string"?u:bH(u)} ${s} ${typeof v=="string"?v:bH(v)}`).join(",")},...t,easing:e,duration:n}}const iDe={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function sDe(t){return vd(t)||typeof t>"u"||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||Array.isArray(t)}function Qee(t={}){const e={...t};function n(r){const i=Object.entries(r);for(let l=0;l<i.length;l++){const[u,s]=i[l];!sDe(s)||u.startsWith("unstable_")?delete r[u]:vd(s)&&(r[u]={...s},n(r[u]))}}return n(e),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(e,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function BN(t={},...e){const{breakpoints:n,mixins:r={},spacing:i,palette:l={},transitions:u={},typography:s={},shape:v,...w}=t;if(t.vars&&t.generateThemeVars===void 0)throw new Error(Of(20));const A=DF(l),F=M2(t);let W=ec(F,{mixins:GPe(F.breakpoints,r),palette:A,shadows:JPe.slice(),typography:XPe(A,s),transitions:rDe(u),zIndex:{...iDe}});return W=ec(W,w),W=e.reduce((K,Q)=>ec(K,Q),W),W.unstable_sxConfig={...R2,...w?.unstable_sxConfig},W.unstable_sx=function(Q){return g_({sx:Q,theme:this})},W.toRuntimeSource=Qee,W}function zN(t){let e;return t<1?e=5.11916*t**2:e=4.5*Math.log(t+1)+2,Math.round(e*10)/1e3}const oDe=[...Array(25)].map((t,e)=>{if(e===0)return"none";const n=zN(e);return`linear-gradient(rgba(255 255 255 / ${n}), rgba(255 255 255 / ${n}))`});function Jee(t){return{inputPlaceholder:t==="dark"?.5:.42,inputUnderline:t==="dark"?.7:.42,switchTrackDisabled:t==="dark"?.2:.12,switchTrack:t==="dark"?.3:.38}}function ete(t){return t==="dark"?oDe:[]}function aDe(t){const{palette:e={mode:"light"},opacity:n,overlays:r,...i}=t,l=DF(e);return{palette:l,opacity:{...Jee(l.mode),...n},overlays:r||ete(l.mode),...i}}function lDe(t){return!!t[0].match(/(cssVarPrefix|colorSchemeSelector|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!t[0].match(/sxConfig$/)||t[0]==="palette"&&!!t[1]?.match(/(mode|contrastThreshold|tonalOffset)/)}const cDe=t=>[...[...Array(25)].map((e,n)=>`--${t?`${t}-`:""}overlays-${n}`),`--${t?`${t}-`:""}palette-AppBar-darkBg`,`--${t?`${t}-`:""}palette-AppBar-darkColor`],uDe=t=>(e,n)=>{const r=t.rootSelector||":root",i=t.colorSchemeSelector;let l=i;if(i==="class"&&(l=".%s"),i==="data"&&(l="[data-%s]"),i?.startsWith("data-")&&!i.includes("%s")&&(l=`[${i}="%s"]`),t.defaultColorScheme===e){if(e==="dark"){const u={};return cDe(t.cssVarPrefix).forEach(s=>{u[s]=n[s],delete n[s]}),l==="media"?{[r]:n,"@media (prefers-color-scheme: dark)":{[r]:u}}:l?{[l.replace("%s",e)]:u,[`${r}, ${l.replace("%s",e)}`]:n}:{[r]:{...n,...u}}}if(l&&l!=="media")return`${r}, ${l.replace("%s",String(e))}`}else if(e){if(l==="media")return{[`@media (prefers-color-scheme: ${String(e)})`]:{[r]:n}};if(l)return l.replace("%s",String(e))}return r};function hDe(t,e){e.forEach(n=>{t[n]||(t[n]={})})}function _n(t,e,n){!t[e]&&n&&(t[e]=n)}function pb(t){return typeof t!="string"||!t.startsWith("hsl")?t:Vee(t)}function ef(t,e){`${e}Channel`in t||(t[`${e}Channel`]=fb(pb(t[e])))}function dDe(t){return typeof t=="number"?`${t}px`:typeof t=="string"||typeof t=="function"||Array.isArray(t)?t:"8px"}const ld=t=>{try{return t()}catch{}},fDe=(t="mui")=>fPe(t);function d3(t,e,n,r){if(!e)return;e=e===!0?{}:e;const i=r==="dark"?"dark":"light";if(!n){t[r]=aDe({...e,palette:{mode:i,...e?.palette}});return}const{palette:l,...u}=BN({...n,palette:{mode:i,...e?.palette}});return t[r]={...e,palette:l,opacity:{...Jee(i),...e?.opacity},overlays:e?.overlays||ete(i)},u}function pDe(t={},...e){const{colorSchemes:n={light:!0},defaultColorScheme:r,disableCssColorScheme:i=!1,cssVarPrefix:l="mui",shouldSkipGeneratingVar:u=lDe,colorSchemeSelector:s=n.light&&n.dark?"media":void 0,rootSelector:v=":root",...w}=t,A=Object.keys(n)[0],F=r||(n.light&&A!=="light"?"light":A),W=fDe(l),{[F]:K,light:Q,dark:Z,...oe}=n,ae={...oe};let me=K;if((F==="dark"&&!("dark"in n)||F==="light"&&!("light"in n))&&(me=!0),!me)throw new Error(Of(21,F));const pe=d3(ae,me,w,F);Q&&!ae.light&&d3(ae,Q,void 0,"light"),Z&&!ae.dark&&d3(ae,Z,void 0,"dark");let _e={defaultColorScheme:F,...pe,cssVarPrefix:l,colorSchemeSelector:s,rootSelector:v,getCssVar:W,colorSchemes:ae,font:{...qPe(pe.typography),...pe.font},spacing:dDe(w.spacing)};Object.keys(_e.colorSchemes).forEach(ye=>{const ue=_e.colorSchemes[ye].palette,Ie=Oe=>{const ze=Oe.split("-"),ft=ze[1],He=ze[2];return W(Oe,ue[ft][He])};if(ue.mode==="light"&&(_n(ue.common,"background","#fff"),_n(ue.common,"onBackground","#000")),ue.mode==="dark"&&(_n(ue.common,"background","#000"),_n(ue.common,"onBackground","#fff")),hDe(ue,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),ue.mode==="light"){_n(ue.Alert,"errorColor",lo(ue.error.light,.6)),_n(ue.Alert,"infoColor",lo(ue.info.light,.6)),_n(ue.Alert,"successColor",lo(ue.success.light,.6)),_n(ue.Alert,"warningColor",lo(ue.warning.light,.6)),_n(ue.Alert,"errorFilledBg",Ie("palette-error-main")),_n(ue.Alert,"infoFilledBg",Ie("palette-info-main")),_n(ue.Alert,"successFilledBg",Ie("palette-success-main")),_n(ue.Alert,"warningFilledBg",Ie("palette-warning-main")),_n(ue.Alert,"errorFilledColor",ld(()=>ue.getContrastText(ue.error.main))),_n(ue.Alert,"infoFilledColor",ld(()=>ue.getContrastText(ue.info.main))),_n(ue.Alert,"successFilledColor",ld(()=>ue.getContrastText(ue.success.main))),_n(ue.Alert,"warningFilledColor",ld(()=>ue.getContrastText(ue.warning.main))),_n(ue.Alert,"errorStandardBg",co(ue.error.light,.9)),_n(ue.Alert,"infoStandardBg",co(ue.info.light,.9)),_n(ue.Alert,"successStandardBg",co(ue.success.light,.9)),_n(ue.Alert,"warningStandardBg",co(ue.warning.light,.9)),_n(ue.Alert,"errorIconColor",Ie("palette-error-main")),_n(ue.Alert,"infoIconColor",Ie("palette-info-main")),_n(ue.Alert,"successIconColor",Ie("palette-success-main")),_n(ue.Alert,"warningIconColor",Ie("palette-warning-main")),_n(ue.AppBar,"defaultBg",Ie("palette-grey-100")),_n(ue.Avatar,"defaultBg",Ie("palette-grey-400")),_n(ue.Button,"inheritContainedBg",Ie("palette-grey-300")),_n(ue.Button,"inheritContainedHoverBg",Ie("palette-grey-A100")),_n(ue.Chip,"defaultBorder",Ie("palette-grey-400")),_n(ue.Chip,"defaultAvatarColor",Ie("palette-grey-700")),_n(ue.Chip,"defaultIconColor",Ie("palette-grey-700")),_n(ue.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),_n(ue.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),_n(ue.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),_n(ue.LinearProgress,"primaryBg",co(ue.primary.main,.62)),_n(ue.LinearProgress,"secondaryBg",co(ue.secondary.main,.62)),_n(ue.LinearProgress,"errorBg",co(ue.error.main,.62)),_n(ue.LinearProgress,"infoBg",co(ue.info.main,.62)),_n(ue.LinearProgress,"successBg",co(ue.success.main,.62)),_n(ue.LinearProgress,"warningBg",co(ue.warning.main,.62)),_n(ue.Skeleton,"bg",`rgba(${Ie("palette-text-primaryChannel")} / 0.11)`),_n(ue.Slider,"primaryTrack",co(ue.primary.main,.62)),_n(ue.Slider,"secondaryTrack",co(ue.secondary.main,.62)),_n(ue.Slider,"errorTrack",co(ue.error.main,.62)),_n(ue.Slider,"infoTrack",co(ue.info.main,.62)),_n(ue.Slider,"successTrack",co(ue.success.main,.62)),_n(ue.Slider,"warningTrack",co(ue.warning.main,.62));const Oe=pT(ue.background.default,.8);_n(ue.SnackbarContent,"bg",Oe),_n(ue.SnackbarContent,"color",ld(()=>ue.getContrastText(Oe))),_n(ue.SpeedDialAction,"fabHoverBg",pT(ue.background.paper,.15)),_n(ue.StepConnector,"border",Ie("palette-grey-400")),_n(ue.StepContent,"border",Ie("palette-grey-400")),_n(ue.Switch,"defaultColor",Ie("palette-common-white")),_n(ue.Switch,"defaultDisabledColor",Ie("palette-grey-100")),_n(ue.Switch,"primaryDisabledColor",co(ue.primary.main,.62)),_n(ue.Switch,"secondaryDisabledColor",co(ue.secondary.main,.62)),_n(ue.Switch,"errorDisabledColor",co(ue.error.main,.62)),_n(ue.Switch,"infoDisabledColor",co(ue.info.main,.62)),_n(ue.Switch,"successDisabledColor",co(ue.success.main,.62)),_n(ue.Switch,"warningDisabledColor",co(ue.warning.main,.62)),_n(ue.TableCell,"border",co(fT(ue.divider,1),.88)),_n(ue.Tooltip,"bg",fT(ue.grey[700],.92))}if(ue.mode==="dark"){_n(ue.Alert,"errorColor",co(ue.error.light,.6)),_n(ue.Alert,"infoColor",co(ue.info.light,.6)),_n(ue.Alert,"successColor",co(ue.success.light,.6)),_n(ue.Alert,"warningColor",co(ue.warning.light,.6)),_n(ue.Alert,"errorFilledBg",Ie("palette-error-dark")),_n(ue.Alert,"infoFilledBg",Ie("palette-info-dark")),_n(ue.Alert,"successFilledBg",Ie("palette-success-dark")),_n(ue.Alert,"warningFilledBg",Ie("palette-warning-dark")),_n(ue.Alert,"errorFilledColor",ld(()=>ue.getContrastText(ue.error.dark))),_n(ue.Alert,"infoFilledColor",ld(()=>ue.getContrastText(ue.info.dark))),_n(ue.Alert,"successFilledColor",ld(()=>ue.getContrastText(ue.success.dark))),_n(ue.Alert,"warningFilledColor",ld(()=>ue.getContrastText(ue.warning.dark))),_n(ue.Alert,"errorStandardBg",lo(ue.error.light,.9)),_n(ue.Alert,"infoStandardBg",lo(ue.info.light,.9)),_n(ue.Alert,"successStandardBg",lo(ue.success.light,.9)),_n(ue.Alert,"warningStandardBg",lo(ue.warning.light,.9)),_n(ue.Alert,"errorIconColor",Ie("palette-error-main")),_n(ue.Alert,"infoIconColor",Ie("palette-info-main")),_n(ue.Alert,"successIconColor",Ie("palette-success-main")),_n(ue.Alert,"warningIconColor",Ie("palette-warning-main")),_n(ue.AppBar,"defaultBg",Ie("palette-grey-900")),_n(ue.AppBar,"darkBg",Ie("palette-background-paper")),_n(ue.AppBar,"darkColor",Ie("palette-text-primary")),_n(ue.Avatar,"defaultBg",Ie("palette-grey-600")),_n(ue.Button,"inheritContainedBg",Ie("palette-grey-800")),_n(ue.Button,"inheritContainedHoverBg",Ie("palette-grey-700")),_n(ue.Chip,"defaultBorder",Ie("palette-grey-700")),_n(ue.Chip,"defaultAvatarColor",Ie("palette-grey-300")),_n(ue.Chip,"defaultIconColor",Ie("palette-grey-300")),_n(ue.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),_n(ue.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),_n(ue.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),_n(ue.LinearProgress,"primaryBg",lo(ue.primary.main,.5)),_n(ue.LinearProgress,"secondaryBg",lo(ue.secondary.main,.5)),_n(ue.LinearProgress,"errorBg",lo(ue.error.main,.5)),_n(ue.LinearProgress,"infoBg",lo(ue.info.main,.5)),_n(ue.LinearProgress,"successBg",lo(ue.success.main,.5)),_n(ue.LinearProgress,"warningBg",lo(ue.warning.main,.5)),_n(ue.Skeleton,"bg",`rgba(${Ie("palette-text-primaryChannel")} / 0.13)`),_n(ue.Slider,"primaryTrack",lo(ue.primary.main,.5)),_n(ue.Slider,"secondaryTrack",lo(ue.secondary.main,.5)),_n(ue.Slider,"errorTrack",lo(ue.error.main,.5)),_n(ue.Slider,"infoTrack",lo(ue.info.main,.5)),_n(ue.Slider,"successTrack",lo(ue.success.main,.5)),_n(ue.Slider,"warningTrack",lo(ue.warning.main,.5));const Oe=pT(ue.background.default,.98);_n(ue.SnackbarContent,"bg",Oe),_n(ue.SnackbarContent,"color",ld(()=>ue.getContrastText(Oe))),_n(ue.SpeedDialAction,"fabHoverBg",pT(ue.background.paper,.15)),_n(ue.StepConnector,"border",Ie("palette-grey-600")),_n(ue.StepContent,"border",Ie("palette-grey-600")),_n(ue.Switch,"defaultColor",Ie("palette-grey-300")),_n(ue.Switch,"defaultDisabledColor",Ie("palette-grey-600")),_n(ue.Switch,"primaryDisabledColor",lo(ue.primary.main,.55)),_n(ue.Switch,"secondaryDisabledColor",lo(ue.secondary.main,.55)),_n(ue.Switch,"errorDisabledColor",lo(ue.error.main,.55)),_n(ue.Switch,"infoDisabledColor",lo(ue.info.main,.55)),_n(ue.Switch,"successDisabledColor",lo(ue.success.main,.55)),_n(ue.Switch,"warningDisabledColor",lo(ue.warning.main,.55)),_n(ue.TableCell,"border",lo(fT(ue.divider,1),.68)),_n(ue.Tooltip,"bg",fT(ue.grey[700],.92))}ef(ue.background,"default"),ef(ue.background,"paper"),ef(ue.common,"background"),ef(ue.common,"onBackground"),ef(ue,"divider"),Object.keys(ue).forEach(Oe=>{const ze=ue[Oe];Oe!=="tonalOffset"&&ze&&typeof ze=="object"&&(ze.main&&_n(ue[Oe],"mainChannel",fb(pb(ze.main))),ze.light&&_n(ue[Oe],"lightChannel",fb(pb(ze.light))),ze.dark&&_n(ue[Oe],"darkChannel",fb(pb(ze.dark))),ze.contrastText&&_n(ue[Oe],"contrastTextChannel",fb(pb(ze.contrastText))),Oe==="text"&&(ef(ue[Oe],"primary"),ef(ue[Oe],"secondary")),Oe==="action"&&(ze.active&&ef(ue[Oe],"active"),ze.selected&&ef(ue[Oe],"selected")))})}),_e=e.reduce((ye,ue)=>ec(ye,ue),_e);const De={prefix:l,disableCssColorScheme:i,shouldSkipGeneratingVar:u,getSelector:uDe(_e)},{vars:Ae,generateThemeVars:re,generateStyleSheets:fe}=gPe(_e,De);return _e.vars=Ae,Object.entries(_e.colorSchemes[_e.defaultColorScheme]).forEach(([ye,ue])=>{_e[ye]=ue}),_e.generateThemeVars=re,_e.generateStyleSheets=fe,_e.generateSpacing=function(){return Nee(w.spacing,TF(this))},_e.getColorSchemeSelector=_Pe(s),_e.spacing=_e.generateSpacing(),_e.shouldSkipGeneratingVar=u,_e.unstable_sxConfig={...R2,...w?.unstable_sxConfig},_e.unstable_sx=function(ue){return g_({sx:ue,theme:this})},_e.toRuntimeSource=Qee,_e}function wH(t,e,n){t.colorSchemes&&n&&(t.colorSchemes[e]={...n!==!0&&n,palette:DF({...n===!0?{}:n.palette,mode:e})})}function tte(t={},...e){const{palette:n,cssVariables:r=!1,colorSchemes:i=n?void 0:{light:!0},defaultColorScheme:l=n?.mode,...u}=t,s=l||"light",v=i?.[s],w={...i,...n?{[s]:{...typeof v!="boolean"&&v,palette:n}}:void 0};if(r===!1){if(!("colorSchemes"in t))return BN(t,...e);let A=n;"palette"in t||w[s]&&(w[s]!==!0?A=w[s].palette:s==="dark"&&(A={mode:"dark"}));const F=BN({...t,palette:A},...e);return F.defaultColorScheme=s,F.colorSchemes=w,F.palette.mode==="light"&&(F.colorSchemes.light={...w.light!==!0&&w.light,palette:F.palette},wH(F,"dark",w.dark)),F.palette.mode==="dark"&&(F.colorSchemes.dark={...w.dark!==!0&&w.dark,palette:F.palette},wH(F,"light",w.light)),F}return!n&&!("light"in w)&&s==="light"&&(w.light=!0),pDe({...u,colorSchemes:w,defaultColorScheme:s,...typeof r!="boolean"&&r},...e)}const kF=tte();function k2(){const t=P2(kF);return t[sR]||t}function nte(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const Hh=t=>nte(t)&&t!=="classes",pr=Bee({themeId:sR,defaultTheme:kF,rootShouldForwardProp:Hh});function mDe(t){return R.jsx(FMe,{...t,defaultTheme:kF,themeId:sR})}function gDe(t){return function(n){return R.jsx(mDe,{styles:typeof t=="function"?r=>t({theme:r,...n}):t})}}function _De(){return IF}const ro=dPe;function ls(t){return hPe(t)}function yDe(t){return es("MuiSvgIcon",t)}as("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const xDe=t=>{const{color:e,fontSize:n,classes:r}=t,i={root:["root",e!=="inherit"&&`color${or(e)}`,`fontSize${or(n)}`]};return ts(i,yDe,r)},vDe=pr("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.color!=="inherit"&&e[`color${or(n.color)}`],e[`fontSize${or(n.fontSize)}`]]}})(ro(({theme:t})=>({userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:t.transitions?.create?.("fill",{duration:(t.vars??t).transitions?.duration?.shorter}),variants:[{props:e=>!e.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:t.typography?.pxToRem?.(20)||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:t.typography?.pxToRem?.(24)||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:t.typography?.pxToRem?.(35)||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{color:(t.vars??t).palette?.[e]?.main}})),{props:{color:"action"},style:{color:(t.vars??t).palette?.action?.active}},{props:{color:"disabled"},style:{color:(t.vars??t).palette?.action?.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}))),II=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiSvgIcon"}),{children:i,className:l,color:u="inherit",component:s="svg",fontSize:v="medium",htmlColor:w,inheritViewBox:A=!1,titleAccess:F,viewBox:W="0 0 24 24",...K}=r,Q=se.isValidElement(i)&&i.type==="svg",Z={...r,color:u,component:s,fontSize:v,instanceFontSize:e.fontSize,inheritViewBox:A,viewBox:W,hasSvgAsChild:Q},oe={};A||(oe.viewBox=W);const ae=xDe(Z);return R.jsxs(vDe,{as:s,className:Fr(ae.root,l),focusable:"false",color:w,"aria-hidden":F?void 0:!0,role:F?"img":void 0,ref:n,...oe,...K,...Q&&i.props,ownerState:Z,children:[Q?i.props.children:i,F?R.jsx("title",{children:F}):null]})});II.muiName="SvgIcon";function jR(t,e){function n(r,i){return R.jsx(II,{"data-testid":void 0,ref:i,...r,children:t})}return n.muiName=II.muiName,se.memo(se.forwardRef(n))}function bDe(t,e){const n=t.charCodeAt(2);return t[0]==="o"&&t[1]==="n"&&n>=65&&n<=90&&typeof e=="function"}function wDe(t,e){if(!t)return e;function n(u,s){const v={};return Object.keys(s).forEach(w=>{bDe(w,s[w])&&typeof u[w]=="function"&&(v[w]=(...A)=>{u[w](...A),s[w](...A)})}),v}if(typeof t=="function"||typeof e=="function")return u=>{const s=typeof e=="function"?e(u):e,v=typeof t=="function"?t({...u,...s}):t,w=Fr(u?.className,s?.className,v?.className),A=n(v,s);return{...s,...v,...A,...!!w&&{className:w},...s?.style&&v?.style&&{style:{...s.style,...v.style}},...s?.sx&&v?.sx&&{sx:[...Array.isArray(s.sx)?s.sx:[s.sx],...Array.isArray(v.sx)?v.sx:[v.sx]]}}};const r=e,i=n(t,r),l=Fr(r?.className,t?.className);return{...e,...t,...i,...!!l&&{className:l},...r?.style&&t?.style&&{style:{...r.style,...t.style}},...r?.sx&&t?.sx&&{sx:[...Array.isArray(r.sx)?r.sx:[r.sx],...Array.isArray(t.sx)?t.sx:[t.sx]]}}}function rte(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function jN(t,e){return jN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},jN(t,e)}function ite(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,jN(t,e)}const EH={disabled:!1},AI=fa.createContext(null);var EDe=function(e){return e.scrollTop},mb="unmounted",Og="exited",Lg="entering",K0="entered",VN="exiting",Fd=function(t){ite(e,t);function e(r,i){var l;l=t.call(this,r,i)||this;var u=i,s=u&&!u.isMounting?r.enter:r.appear,v;return l.appearStatus=null,r.in?s?(v=Og,l.appearStatus=Lg):v=K0:r.unmountOnExit||r.mountOnEnter?v=mb:v=Og,l.state={status:v},l.nextCallback=null,l}e.getDerivedStateFromProps=function(i,l){var u=i.in;return u&&l.status===mb?{status:Og}:null};var n=e.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(i){var l=null;if(i!==this.props){var u=this.state.status;this.props.in?u!==Lg&&u!==K0&&(l=Lg):(u===Lg||u===K0)&&(l=VN)}this.updateStatus(!1,l)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var i=this.props.timeout,l,u,s;return l=u=s=i,i!=null&&typeof i!="number"&&(l=i.exit,u=i.enter,s=i.appear!==void 0?i.appear:u),{exit:l,enter:u,appear:s}},n.updateStatus=function(i,l){if(i===void 0&&(i=!1),l!==null)if(this.cancelNextCallback(),l===Lg){if(this.props.unmountOnExit||this.props.mountOnEnter){var u=this.props.nodeRef?this.props.nodeRef.current:eb.findDOMNode(this);u&&EDe(u)}this.performEnter(i)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Og&&this.setState({status:mb})},n.performEnter=function(i){var l=this,u=this.props.enter,s=this.context?this.context.isMounting:i,v=this.props.nodeRef?[s]:[eb.findDOMNode(this),s],w=v[0],A=v[1],F=this.getTimeouts(),W=s?F.appear:F.enter;if(!i&&!u||EH.disabled){this.safeSetState({status:K0},function(){l.props.onEntered(w)});return}this.props.onEnter(w,A),this.safeSetState({status:Lg},function(){l.props.onEntering(w,A),l.onTransitionEnd(W,function(){l.safeSetState({status:K0},function(){l.props.onEntered(w,A)})})})},n.performExit=function(){var i=this,l=this.props.exit,u=this.getTimeouts(),s=this.props.nodeRef?void 0:eb.findDOMNode(this);if(!l||EH.disabled){this.safeSetState({status:Og},function(){i.props.onExited(s)});return}this.props.onExit(s),this.safeSetState({status:VN},function(){i.props.onExiting(s),i.onTransitionEnd(u.exit,function(){i.safeSetState({status:Og},function(){i.props.onExited(s)})})})},n.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(i,l){l=this.setNextCallback(l),this.setState(i,l)},n.setNextCallback=function(i){var l=this,u=!0;return this.nextCallback=function(s){u&&(u=!1,l.nextCallback=null,i(s))},this.nextCallback.cancel=function(){u=!1},this.nextCallback},n.onTransitionEnd=function(i,l){this.setNextCallback(l);var u=this.props.nodeRef?this.props.nodeRef.current:eb.findDOMNode(this),s=i==null&&!this.props.addEndListener;if(!u||s){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var v=this.props.nodeRef?[this.nextCallback]:[u,this.nextCallback],w=v[0],A=v[1];this.props.addEndListener(w,A)}i!=null&&setTimeout(this.nextCallback,i)},n.render=function(){var i=this.state.status;if(i===mb)return null;var l=this.props,u=l.children;l.in,l.mountOnEnter,l.unmountOnExit,l.appear,l.enter,l.exit,l.timeout,l.addEndListener,l.onEnter,l.onEntering,l.onEntered,l.onExit,l.onExiting,l.onExited,l.nodeRef;var s=rte(l,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return fa.createElement(AI.Provider,{value:null},typeof u=="function"?u(i,s):fa.cloneElement(fa.Children.only(u),s))},e}(fa.Component);Fd.contextType=AI;Fd.propTypes={};function H0(){}Fd.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:H0,onEntering:H0,onEntered:H0,onExit:H0,onExiting:H0,onExited:H0};Fd.UNMOUNTED=mb;Fd.EXITED=Og;Fd.ENTERING=Lg;Fd.ENTERED=K0;Fd.EXITING=VN;function SDe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function NF(t,e){var n=function(l){return e&&se.isValidElement(l)?e(l):l},r=Object.create(null);return t&&se.Children.map(t,function(i){return i}).forEach(function(i){r[i.key]=n(i)}),r}function TDe(t,e){t=t||{},e=e||{};function n(A){return A in e?e[A]:t[A]}var r=Object.create(null),i=[];for(var l in t)l in e?i.length&&(r[l]=i,i=[]):i.push(l);var u,s={};for(var v in e){if(r[v])for(u=0;u<r[v].length;u++){var w=r[v][u];s[r[v][u]]=n(w)}s[v]=n(v)}for(u=0;u<i.length;u++)s[i[u]]=n(i[u]);return s}function qg(t,e,n){return n[e]!=null?n[e]:t.props[e]}function CDe(t,e){return NF(t.children,function(n){return se.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:qg(n,"appear",t),enter:qg(n,"enter",t),exit:qg(n,"exit",t)})})}function IDe(t,e,n){var r=NF(t.children),i=TDe(e,r);return Object.keys(i).forEach(function(l){var u=i[l];if(se.isValidElement(u)){var s=l in e,v=l in r,w=e[l],A=se.isValidElement(w)&&!w.props.in;v&&(!s||A)?i[l]=se.cloneElement(u,{onExited:n.bind(null,u),in:!0,exit:qg(u,"exit",t),enter:qg(u,"enter",t)}):!v&&s&&!A?i[l]=se.cloneElement(u,{in:!1}):v&&s&&se.isValidElement(w)&&(i[l]=se.cloneElement(u,{onExited:n.bind(null,u),in:w.props.in,exit:qg(u,"exit",t),enter:qg(u,"enter",t)}))}}),i}var ADe=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},RDe={component:"div",childFactory:function(e){return e}},OF=function(t){ite(e,t);function e(r,i){var l;l=t.call(this,r,i)||this;var u=l.handleExited.bind(SDe(l));return l.state={contextValue:{isMounting:!0},handleExited:u,firstRender:!0},l}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(i,l){var u=l.children,s=l.handleExited,v=l.firstRender;return{children:v?CDe(i,s):IDe(i,u,s),firstRender:!1}},n.handleExited=function(i,l){var u=NF(this.props.children);i.key in u||(i.props.onExited&&i.props.onExited(l),this.mounted&&this.setState(function(s){var v=EI({},s.children);return delete v[i.key],{children:v}}))},n.render=function(){var i=this.props,l=i.component,u=i.childFactory,s=rte(i,["component","childFactory"]),v=this.state.contextValue,w=ADe(this.state.children).map(u);return delete s.appear,delete s.enter,delete s.exit,l===null?fa.createElement(AI.Provider,{value:v},w):fa.createElement(AI.Provider,{value:v},fa.createElement(l,s,w))},e}(fa.Component);OF.propTypes={};OF.defaultProps=RDe;const ste=t=>t.scrollTop;function RI(t,e){const{timeout:n,easing:r,style:i={}}=t;return{duration:i.transitionDuration??(typeof n=="number"?n:n[e.mode]||0),easing:i.transitionTimingFunction??(typeof r=="object"?r[e.mode]:r),delay:i.transitionDelay}}function MDe(t){return es("MuiPaper",t)}as("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const PDe=t=>{const{square:e,elevation:n,variant:r,classes:i}=t,l={root:["root",r,!e&&"rounded",r==="elevation"&&`elevation${n}`]};return ts(l,MDe,i)},DDe=pr("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.variant],!n.square&&e.rounded,n.variant==="elevation"&&e[`elevation${n.elevation}`]]}})(ro(({theme:t})=>({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:({ownerState:e})=>!e.square,style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(t.vars||t).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),N2=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiPaper"}),i=k2(),{className:l,component:u="div",elevation:s=1,square:v=!1,variant:w="elevation",...A}=r,F={...r,component:u,elevation:s,square:v,variant:w},W=PDe(F);return R.jsx(DDe,{as:u,ownerState:F,className:Fr(W.root,l),ref:n,...A,style:{...w==="elevation"&&{"--Paper-shadow":(i.vars||i).shadows[s],...i.vars&&{"--Paper-overlay":i.vars.overlays?.[s]},...!i.vars&&i.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${el("#fff",zN(s))}, ${el("#fff",zN(s))})`}},...A.style}})});function Wo(t,e){const{className:n,elementType:r,ownerState:i,externalForwardedProps:l,internalForwardedProps:u,shouldForwardComponentProp:s=!1,...v}=e,{component:w,slots:A={[t]:void 0},slotProps:F={[t]:void 0},...W}=l,K=A[t]||r,Q=Xee(F[t],i),{props:{component:Z,...oe},internalRef:ae}=Yee({className:n,...v,externalForwardedProps:t==="root"?W:void 0,externalSlotProps:Q}),me=xc(ae,Q?.ref,e.ref),pe=t==="root"?Z||w:Z,_e=qee(K,{...t==="root"&&!w&&!A[t]&&u,...t!=="root"&&!A[t]&&u,...oe,...pe&&!s&&{as:pe},...pe&&s&&{component:pe},ref:me},i);return[K,_e]}class MI{static create(){return new MI}static use(){const e=Hee(MI.create).current,[n,r]=se.useState(!1);return e.shouldMount=n,e.setShouldMount=r,se.useEffect(e.mountEffect,[n]),e}constructor(){this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}mount(){return this.mounted||(this.mounted=NDe(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}mountEffect=()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())};start(...e){this.mount().then(()=>this.ref.current?.start(...e))}stop(...e){this.mount().then(()=>this.ref.current?.stop(...e))}pulsate(...e){this.mount().then(()=>this.ref.current?.pulsate(...e))}}function kDe(){return MI.use()}function NDe(){let t,e;const n=new Promise((r,i)=>{t=r,e=i});return n.resolve=t,n.reject=e,n}function ODe(t){const{className:e,classes:n,pulsate:r=!1,rippleX:i,rippleY:l,rippleSize:u,in:s,onExited:v,timeout:w}=t,[A,F]=se.useState(!1),W=Fr(e,n.ripple,n.rippleVisible,r&&n.ripplePulsate),K={width:u,height:u,top:-(u/2)+l,left:-(u/2)+i},Q=Fr(n.child,A&&n.childLeaving,r&&n.childPulsate);return!s&&!A&&F(!0),se.useEffect(()=>{if(!s&&v!=null){const Z=setTimeout(v,w);return()=>{clearTimeout(Z)}}},[v,s,w]),R.jsx("span",{className:W,style:K,children:R.jsx("span",{className:Q})})}const Fu=as("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),UN=550,LDe=80,FDe=C2`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,BDe=C2`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,zDe=C2`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,jDe=pr("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),VDe=pr(ODe,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${Fu.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${FDe};
    animation-duration: ${UN}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  &.${Fu.ripplePulsate} {
    animation-duration: ${({theme:t})=>t.transitions.duration.shorter}ms;
  }

  & .${Fu.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${Fu.childLeaving} {
    opacity: 0;
    animation-name: ${BDe};
    animation-duration: ${UN}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  & .${Fu.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${zDe};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,UDe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiTouchRipple"}),{center:i=!1,classes:l={},className:u,...s}=r,[v,w]=se.useState([]),A=se.useRef(0),F=se.useRef(null);se.useEffect(()=>{F.current&&(F.current(),F.current=null)},[v]);const W=se.useRef(!1),K=Wee(),Q=se.useRef(null),Z=se.useRef(null),oe=se.useCallback(_e=>{const{pulsate:De,rippleX:Ae,rippleY:re,rippleSize:fe,cb:ye}=_e;w(ue=>[...ue,R.jsx(VDe,{classes:{ripple:Fr(l.ripple,Fu.ripple),rippleVisible:Fr(l.rippleVisible,Fu.rippleVisible),ripplePulsate:Fr(l.ripplePulsate,Fu.ripplePulsate),child:Fr(l.child,Fu.child),childLeaving:Fr(l.childLeaving,Fu.childLeaving),childPulsate:Fr(l.childPulsate,Fu.childPulsate)},timeout:UN,pulsate:De,rippleX:Ae,rippleY:re,rippleSize:fe},A.current)]),A.current+=1,F.current=ye},[l]),ae=se.useCallback((_e={},De={},Ae=()=>{})=>{const{pulsate:re=!1,center:fe=i||De.pulsate,fakeElement:ye=!1}=De;if(_e?.type==="mousedown"&&W.current){W.current=!1;return}_e?.type==="touchstart"&&(W.current=!0);const ue=ye?null:Z.current,Ie=ue?ue.getBoundingClientRect():{width:0,height:0,left:0,top:0};let Oe,ze,ft;if(fe||_e===void 0||_e.clientX===0&&_e.clientY===0||!_e.clientX&&!_e.touches)Oe=Math.round(Ie.width/2),ze=Math.round(Ie.height/2);else{const{clientX:He,clientY:bt}=_e.touches&&_e.touches.length>0?_e.touches[0]:_e;Oe=Math.round(He-Ie.left),ze=Math.round(bt-Ie.top)}if(fe)ft=Math.sqrt((2*Ie.width**2+Ie.height**2)/3),ft%2===0&&(ft+=1);else{const He=Math.max(Math.abs((ue?ue.clientWidth:0)-Oe),Oe)*2+2,bt=Math.max(Math.abs((ue?ue.clientHeight:0)-ze),ze)*2+2;ft=Math.sqrt(He**2+bt**2)}_e?.touches?Q.current===null&&(Q.current=()=>{oe({pulsate:re,rippleX:Oe,rippleY:ze,rippleSize:ft,cb:Ae})},K.start(LDe,()=>{Q.current&&(Q.current(),Q.current=null)})):oe({pulsate:re,rippleX:Oe,rippleY:ze,rippleSize:ft,cb:Ae})},[i,oe,K]),me=se.useCallback(()=>{ae({},{pulsate:!0})},[ae]),pe=se.useCallback((_e,De)=>{if(K.clear(),_e?.type==="touchend"&&Q.current){Q.current(),Q.current=null,K.start(0,()=>{pe(_e,De)});return}Q.current=null,w(Ae=>Ae.length>0?Ae.slice(1):Ae),F.current=De},[K]);return se.useImperativeHandle(n,()=>({pulsate:me,start:ae,stop:pe}),[me,ae,pe]),R.jsx(jDe,{className:Fr(Fu.root,l.root,u),ref:Z,...s,children:R.jsx(OF,{component:null,exit:!0,children:v})})});function HDe(t){return es("MuiButtonBase",t)}const WDe=as("MuiButtonBase",["root","disabled","focusVisible"]),$De=t=>{const{disabled:e,focusVisible:n,focusVisibleClassName:r,classes:i}=t,u=ts({root:["root",e&&"disabled",n&&"focusVisible"]},HDe,i);return n&&r&&(u.root+=` ${r}`),u},qDe=pr("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(t,e)=>e.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${WDe.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),HN=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiButtonBase"}),{action:i,centerRipple:l=!1,children:u,className:s,component:v="button",disabled:w=!1,disableRipple:A=!1,disableTouchRipple:F=!1,focusRipple:W=!1,focusVisibleClassName:K,LinkComponent:Q="a",onBlur:Z,onClick:oe,onContextMenu:ae,onDragLeave:me,onFocus:pe,onFocusVisible:_e,onKeyDown:De,onKeyUp:Ae,onMouseDown:re,onMouseLeave:fe,onMouseUp:ye,onTouchEnd:ue,onTouchMove:Ie,onTouchStart:Oe,tabIndex:ze=0,TouchRippleProps:ft,touchRippleRef:He,type:bt,...Nt}=r,wt=se.useRef(null),it=kDe(),nn=xc(it.ref,He),[In,wn]=se.useState(!1);w&&In&&wn(!1),se.useImperativeHandle(i,()=>({focusVisible:()=>{wn(!0),wt.current.focus()}}),[]);const Xt=it.shouldMount&&!A&&!w;se.useEffect(()=>{In&&W&&!A&&it.pulsate()},[A,W,In,it]);const On=tf(it,"start",re,F),cr=tf(it,"stop",ae,F),En=tf(it,"stop",me,F),fn=tf(it,"stop",ye,F),ur=tf(it,"stop",Xn=>{In&&Xn.preventDefault(),fe&&fe(Xn)},F),br=tf(it,"start",Oe,F),Pe=tf(it,"stop",ue,F),jn=tf(it,"stop",Ie,F),rr=tf(it,"stop",Xn=>{dH(Xn.target)||wn(!1),Z&&Z(Xn)},!1),Yn=e_(Xn=>{wt.current||(wt.current=Xn.currentTarget),dH(Xn.target)&&(wn(!0),_e&&_e(Xn)),pe&&pe(Xn)}),Ot=()=>{const Xn=wt.current;return v&&v!=="button"&&!(Xn.tagName==="A"&&Xn.href)},Sr=e_(Xn=>{W&&!Xn.repeat&&In&&Xn.key===" "&&it.stop(Xn,()=>{it.start(Xn)}),Xn.target===Xn.currentTarget&&Ot()&&Xn.key===" "&&Xn.preventDefault(),De&&De(Xn),Xn.target===Xn.currentTarget&&Ot()&&Xn.key==="Enter"&&!w&&(Xn.preventDefault(),oe&&oe(Xn))}),fi=e_(Xn=>{W&&Xn.key===" "&&In&&!Xn.defaultPrevented&&it.stop(Xn,()=>{it.pulsate(Xn)}),Ae&&Ae(Xn),oe&&Xn.target===Xn.currentTarget&&Ot()&&Xn.key===" "&&!Xn.defaultPrevented&&oe(Xn)});let Wr=v;Wr==="button"&&(Nt.href||Nt.to)&&(Wr=Q);const Mn={};Wr==="button"?(Mn.type=bt===void 0?"button":bt,Mn.disabled=w):(!Nt.href&&!Nt.to&&(Mn.role="button"),w&&(Mn["aria-disabled"]=w));const jt=xc(n,wt),Ln={...r,centerRipple:l,component:v,disabled:w,disableRipple:A,disableTouchRipple:F,focusRipple:W,tabIndex:ze,focusVisible:In},un=$De(Ln);return R.jsxs(qDe,{as:Wr,className:Fr(un.root,s),ownerState:Ln,onBlur:rr,onClick:oe,onContextMenu:cr,onFocus:Yn,onKeyDown:Sr,onKeyUp:fi,onMouseDown:On,onMouseLeave:ur,onMouseUp:fn,onDragLeave:En,onTouchEnd:Pe,onTouchMove:jn,onTouchStart:br,ref:jt,tabIndex:w?-1:ze,type:bt,...Mn,...Nt,children:[u,Xt?R.jsx(UDe,{ref:nn,center:l,...ft}):null]})});function tf(t,e,n,r=!1){return e_(i=>(n&&n(i),r||t[e](i),!0))}function GDe(t){return typeof t.main=="string"}function YDe(t,e=[]){if(!GDe(t))return!1;for(const n of e)if(!t.hasOwnProperty(n)||typeof t[n]!="string")return!1;return!0}function Ah(t=[]){return([,e])=>e&&YDe(e,t)}function XDe(t){return es("MuiCircularProgress",t)}as("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const Pp=44,WN=C2`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,$N=C2`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: -126px;
  }
`,KDe=typeof WN!="string"?vF`
        animation: ${WN} 1.4s linear infinite;
      `:null,ZDe=typeof $N!="string"?vF`
        animation: ${$N} 1.4s ease-in-out infinite;
      `:null,QDe=t=>{const{classes:e,variant:n,color:r,disableShrink:i}=t,l={root:["root",n,`color${or(r)}`],svg:["svg"],circle:["circle",`circle${or(n)}`,i&&"circleDisableShrink"]};return ts(l,XDe,e)},JDe=pr("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.variant],e[`color${or(n.color)}`]]}})(ro(({theme:t})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("transform")}},{props:{variant:"indeterminate"},style:KDe||{animation:`${WN} 1.4s linear infinite`}},...Object.entries(t.palette).filter(Ah()).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}}))]}))),e3e=pr("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(t,e)=>e.svg})({display:"block"}),t3e=pr("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.circle,e[`circle${or(n.variant)}`],n.disableShrink&&e.circleDisableShrink]}})(ro(({theme:t})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:e})=>e.variant==="indeterminate"&&!e.disableShrink,style:ZDe||{animation:`${$N} 1.4s ease-in-out infinite`}}]}))),ote=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiCircularProgress"}),{className:i,color:l="primary",disableShrink:u=!1,size:s=40,style:v,thickness:w=3.6,value:A=0,variant:F="indeterminate",...W}=r,K={...r,color:l,disableShrink:u,size:s,thickness:w,value:A,variant:F},Q=QDe(K),Z={},oe={},ae={};if(F==="determinate"){const me=2*Math.PI*((Pp-w)/2);Z.strokeDasharray=me.toFixed(3),ae["aria-valuenow"]=Math.round(A),Z.strokeDashoffset=`${((100-A)/100*me).toFixed(3)}px`,oe.transform="rotate(-90deg)"}return R.jsx(JDe,{className:Fr(Q.root,i),style:{width:s,height:s,...oe,...v},ownerState:K,ref:n,role:"progressbar",...ae,...W,children:R.jsx(e3e,{className:Q.svg,ownerState:K,viewBox:`${Pp/2} ${Pp/2} ${Pp} ${Pp}`,children:R.jsx(t3e,{className:Q.circle,style:Z,ownerState:K,cx:Pp,cy:Pp,r:(Pp-w)/2,fill:"none",strokeWidth:w})})})});function n3e(t){return es("MuiTypography",t)}as("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const r3e={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},i3e=_De(),s3e=t=>{const{align:e,gutterBottom:n,noWrap:r,paragraph:i,variant:l,classes:u}=t,s={root:["root",l,t.align!=="inherit"&&`align${or(e)}`,n&&"gutterBottom",r&&"noWrap",i&&"paragraph"]};return ts(s,n3e,u)},o3e=pr("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.variant&&e[n.variant],n.align!=="inherit"&&e[`align${or(n.align)}`],n.noWrap&&e.noWrap,n.gutterBottom&&e.gutterBottom,n.paragraph&&e.paragraph]}})(ro(({theme:t})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([e,n])=>e!=="inherit"&&n&&typeof n=="object").map(([e,n])=>({props:{variant:e},style:n})),...Object.entries(t.palette).filter(Ah()).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette?.text||{}).filter(([,e])=>typeof e=="string").map(([e])=>({props:{color:`text${or(e)}`},style:{color:(t.vars||t).palette.text[e]}})),{props:({ownerState:e})=>e.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:e})=>e.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:e})=>e.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:e})=>e.paragraph,style:{marginBottom:16}}]}))),SH={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},$l=se.forwardRef(function(e,n){const{color:r,...i}=ls({props:e,name:"MuiTypography"}),l=!r3e[r],u=i3e({...i,...l&&{color:r}}),{align:s="inherit",className:v,component:w,gutterBottom:A=!1,noWrap:F=!1,paragraph:W=!1,variant:K="body1",variantMapping:Q=SH,...Z}=u,oe={...u,align:s,color:r,className:v,component:w,gutterBottom:A,noWrap:F,paragraph:W,variant:K,variantMapping:Q},ae=w||(W?"p":Q[K]||SH[K])||"span",me=s3e(oe);return R.jsx(o3e,{as:ae,ref:n,className:Fr(me.root,v),...Z,ownerState:oe,style:{...s!=="inherit"&&{"--Typography-textAlign":s},...Z.style}})});function a3e(t){return typeof t=="function"?t():t}const l3e=se.forwardRef(function(e,n){const{children:r,container:i,disablePortal:l=!1}=e,[u,s]=se.useState(null),v=xc(se.isValidElement(r)?D2(r):null,n);if(__(()=>{l||s(a3e(i)||document.body)},[i,l]),__(()=>{if(u&&!l)return aH(n,u),()=>{aH(n,null)}},[n,u,l]),l){if(se.isValidElement(r)){const w={ref:v};return se.cloneElement(r,w)}return r}return u&&Nm.createPortal(r,u)}),c3e=jR(R.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function u3e(t){return es("MuiChip",t)}const is=as("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),h3e=t=>{const{classes:e,disabled:n,size:r,color:i,iconColor:l,onDelete:u,clickable:s,variant:v}=t,w={root:["root",v,n&&"disabled",`size${or(r)}`,`color${or(i)}`,s&&"clickable",s&&`clickableColor${or(i)}`,u&&"deletable",u&&`deletableColor${or(i)}`,`${v}${or(i)}`],label:["label",`label${or(r)}`],avatar:["avatar",`avatar${or(r)}`,`avatarColor${or(i)}`],icon:["icon",`icon${or(r)}`,`iconColor${or(l)}`],deleteIcon:["deleteIcon",`deleteIcon${or(r)}`,`deleteIconColor${or(i)}`,`deleteIcon${or(v)}Color${or(i)}`]};return ts(w,u3e,e)},d3e=pr("div",{name:"MuiChip",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t,{color:r,iconColor:i,clickable:l,onDelete:u,size:s,variant:v}=n;return[{[`& .${is.avatar}`]:e.avatar},{[`& .${is.avatar}`]:e[`avatar${or(s)}`]},{[`& .${is.avatar}`]:e[`avatarColor${or(r)}`]},{[`& .${is.icon}`]:e.icon},{[`& .${is.icon}`]:e[`icon${or(s)}`]},{[`& .${is.icon}`]:e[`iconColor${or(i)}`]},{[`& .${is.deleteIcon}`]:e.deleteIcon},{[`& .${is.deleteIcon}`]:e[`deleteIcon${or(s)}`]},{[`& .${is.deleteIcon}`]:e[`deleteIconColor${or(r)}`]},{[`& .${is.deleteIcon}`]:e[`deleteIcon${or(v)}Color${or(r)}`]},e.root,e[`size${or(s)}`],e[`color${or(r)}`],l&&e.clickable,l&&r!=="default"&&e[`clickableColor${or(r)})`],u&&e.deletable,u&&r!=="default"&&e[`deletableColor${or(r)}`],e[v],e[`${v}${or(r)}`]]}})(ro(({theme:t})=>{const e=t.palette.mode==="light"?t.palette.grey[700]:t.palette.grey[300];return{maxWidth:"100%",fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,color:(t.vars||t).palette.text.primary,backgroundColor:(t.vars||t).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:t.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${is.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${is.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:t.vars?t.vars.palette.Chip.defaultAvatarColor:e,fontSize:t.typography.pxToRem(12)},[`& .${is.avatarColorPrimary}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.dark},[`& .${is.avatarColorSecondary}`]:{color:(t.vars||t).palette.secondary.contrastText,backgroundColor:(t.vars||t).palette.secondary.dark},[`& .${is.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:t.typography.pxToRem(10)},[`& .${is.icon}`]:{marginLeft:5,marginRight:-6},[`& .${is.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.26)`:el(t.palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.4)`:el(t.palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${is.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${is.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(t.palette).filter(Ah(["contrastText"])).map(([n])=>({props:{color:n},style:{backgroundColor:(t.vars||t).palette[n].main,color:(t.vars||t).palette[n].contrastText,[`& .${is.deleteIcon}`]:{color:t.vars?`rgba(${t.vars.palette[n].contrastTextChannel} / 0.7)`:el(t.palette[n].contrastText,.7),"&:hover, &:active":{color:(t.vars||t).palette[n].contrastText}}}})),{props:n=>n.iconColor===n.color,style:{[`& .${is.icon}`]:{color:t.vars?t.vars.palette.Chip.defaultIconColor:e}}},{props:n=>n.iconColor===n.color&&n.color!=="default",style:{[`& .${is.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${is.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:el(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}}},...Object.entries(t.palette).filter(Ah(["dark"])).map(([n])=>({props:{color:n,onDelete:!0},style:{[`&.${is.focusVisible}`]:{background:(t.vars||t).palette[n].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:el(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity)},[`&.${is.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:el(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},"&:active":{boxShadow:(t.vars||t).shadows[1]}}},...Object.entries(t.palette).filter(Ah(["dark"])).map(([n])=>({props:{color:n,clickable:!0},style:{[`&:hover, &.${is.focusVisible}`]:{backgroundColor:(t.vars||t).palette[n].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:t.vars?`1px solid ${t.vars.palette.Chip.defaultBorder}`:`1px solid ${t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[700]}`,[`&.${is.clickable}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${is.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`& .${is.avatar}`]:{marginLeft:4},[`& .${is.avatarSmall}`]:{marginLeft:2},[`& .${is.icon}`]:{marginLeft:4},[`& .${is.iconSmall}`]:{marginLeft:2},[`& .${is.deleteIcon}`]:{marginRight:5},[`& .${is.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(t.palette).filter(Ah()).map(([n])=>({props:{variant:"outlined",color:n},style:{color:(t.vars||t).palette[n].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[n].mainChannel} / 0.7)`:el(t.palette[n].main,.7)}`,[`&.${is.clickable}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:el(t.palette[n].main,t.palette.action.hoverOpacity)},[`&.${is.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n].mainChannel} / ${t.vars.palette.action.focusOpacity})`:el(t.palette[n].main,t.palette.action.focusOpacity)},[`& .${is.deleteIcon}`]:{color:t.vars?`rgba(${t.vars.palette[n].mainChannel} / 0.7)`:el(t.palette[n].main,.7),"&:hover, &:active":{color:(t.vars||t).palette[n].main}}}}))]}})),f3e=pr("span",{name:"MuiChip",slot:"Label",overridesResolver:(t,e)=>{const{ownerState:n}=t,{size:r}=n;return[e.label,e[`label${or(r)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function TH(t){return t.key==="Backspace"||t.key==="Delete"}const p3e=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiChip"}),{avatar:i,className:l,clickable:u,color:s="default",component:v,deleteIcon:w,disabled:A=!1,icon:F,label:W,onClick:K,onDelete:Q,onKeyDown:Z,onKeyUp:oe,size:ae="medium",variant:me="filled",tabIndex:pe,skipFocusWhenDisabled:_e=!1,...De}=r,Ae=se.useRef(null),re=xc(Ae,n),fe=it=>{it.stopPropagation(),Q&&Q(it)},ye=it=>{it.currentTarget===it.target&&TH(it)&&it.preventDefault(),Z&&Z(it)},ue=it=>{it.currentTarget===it.target&&Q&&TH(it)&&Q(it),oe&&oe(it)},Ie=u!==!1&&K?!0:u,Oe=Ie||Q?HN:v||"div",ze={...r,component:Oe,disabled:A,size:ae,color:s,iconColor:se.isValidElement(F)&&F.props.color||s,onDelete:!!Q,clickable:Ie,variant:me},ft=h3e(ze),He=Oe===HN?{component:v||"div",focusVisibleClassName:ft.focusVisible,...Q&&{disableRipple:!0}}:{};let bt=null;Q&&(bt=w&&se.isValidElement(w)?se.cloneElement(w,{className:Fr(w.props.className,ft.deleteIcon),onClick:fe}):R.jsx(c3e,{className:Fr(ft.deleteIcon),onClick:fe}));let Nt=null;i&&se.isValidElement(i)&&(Nt=se.cloneElement(i,{className:Fr(ft.avatar,i.props.className)}));let wt=null;return F&&se.isValidElement(F)&&(wt=se.cloneElement(F,{className:Fr(ft.icon,F.props.className)})),R.jsxs(d3e,{as:Oe,className:Fr(ft.root,l),disabled:Ie&&A?!0:void 0,onClick:K,onKeyDown:ye,onKeyUp:ue,ref:re,tabIndex:_e&&A?-1:pe,ownerState:ze,...He,...De,children:[Nt||wt,R.jsx(f3e,{className:Fr(ft.label),ownerState:ze,children:W}),bt]})});function mT(t){return parseInt(t,10)||0}const m3e={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function g3e(t){for(const e in t)return!1;return!0}function CH(t){return g3e(t)||t.outerHeightStyle===0&&!t.overflowing}const _3e=se.forwardRef(function(e,n){const{onChange:r,maxRows:i,minRows:l=1,style:u,value:s,...v}=e,{current:w}=se.useRef(s!=null),A=se.useRef(null),F=xc(n,A),W=se.useRef(null),K=se.useRef(null),Q=se.useCallback(()=>{const pe=A.current,_e=K.current;if(!pe||!_e)return;const Ae=Ff(pe).getComputedStyle(pe);if(Ae.width==="0px")return{outerHeightStyle:0,overflowing:!1};_e.style.width=Ae.width,_e.value=pe.value||e.placeholder||"x",_e.value.slice(-1)===`
`&&(_e.value+=" ");const re=Ae.boxSizing,fe=mT(Ae.paddingBottom)+mT(Ae.paddingTop),ye=mT(Ae.borderBottomWidth)+mT(Ae.borderTopWidth),ue=_e.scrollHeight;_e.value="x";const Ie=_e.scrollHeight;let Oe=ue;l&&(Oe=Math.max(Number(l)*Ie,Oe)),i&&(Oe=Math.min(Number(i)*Ie,Oe)),Oe=Math.max(Oe,Ie);const ze=Oe+(re==="border-box"?fe+ye:0),ft=Math.abs(Oe-ue)<=1;return{outerHeightStyle:ze,overflowing:ft}},[i,l,e.placeholder]),Z=e_(()=>{const pe=A.current,_e=Q();if(!pe||!_e||CH(_e))return!1;const De=_e.outerHeightStyle;return W.current!=null&&W.current!==De}),oe=se.useCallback(()=>{const pe=A.current,_e=Q();if(!pe||!_e||CH(_e))return;const De=_e.outerHeightStyle;W.current!==De&&(W.current=De,pe.style.height=`${De}px`),pe.style.overflow=_e.overflowing?"hidden":""},[Q]),ae=se.useRef(-1);__(()=>{const pe=Uee(oe),_e=A?.current;if(!_e)return;const De=Ff(_e);De.addEventListener("resize",pe);let Ae;return typeof ResizeObserver<"u"&&(Ae=new ResizeObserver(()=>{Z()&&(Ae.unobserve(_e),cancelAnimationFrame(ae.current),oe(),ae.current=requestAnimationFrame(()=>{Ae.observe(_e)}))}),Ae.observe(_e)),()=>{pe.clear(),cancelAnimationFrame(ae.current),De.removeEventListener("resize",pe),Ae&&Ae.disconnect()}},[Q,oe,Z]),__(()=>{oe()});const me=pe=>{w||oe(),r&&r(pe)};return R.jsxs(se.Fragment,{children:[R.jsx("textarea",{value:s,onChange:me,ref:F,rows:l,style:u,...v}),R.jsx("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:K,tabIndex:-1,style:{...m3e.shadow,...u,paddingTop:0,paddingBottom:0}})]})});function qN(t){return typeof t=="string"}function Fx({props:t,states:e,muiFormControl:n}){return e.reduce((r,i)=>(r[i]=t[i],n&&typeof t[i]>"u"&&(r[i]=n[i]),r),{})}const LF=se.createContext(void 0);function Bx(){return se.useContext(LF)}function IH(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function PI(t,e=!1){return t&&(IH(t.value)&&t.value!==""||e&&IH(t.defaultValue)&&t.defaultValue!=="")}function y3e(t){return t.startAdornment}function x3e(t){return es("MuiInputBase",t)}const ax=as("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var AH;const VR=(t,e)=>{const{ownerState:n}=t;return[e.root,n.formControl&&e.formControl,n.startAdornment&&e.adornedStart,n.endAdornment&&e.adornedEnd,n.error&&e.error,n.size==="small"&&e.sizeSmall,n.multiline&&e.multiline,n.color&&e[`color${or(n.color)}`],n.fullWidth&&e.fullWidth,n.hiddenLabel&&e.hiddenLabel]},UR=(t,e)=>{const{ownerState:n}=t;return[e.input,n.size==="small"&&e.inputSizeSmall,n.multiline&&e.inputMultiline,n.type==="search"&&e.inputTypeSearch,n.startAdornment&&e.inputAdornedStart,n.endAdornment&&e.inputAdornedEnd,n.hiddenLabel&&e.inputHiddenLabel]},v3e=t=>{const{classes:e,color:n,disabled:r,error:i,endAdornment:l,focused:u,formControl:s,fullWidth:v,hiddenLabel:w,multiline:A,readOnly:F,size:W,startAdornment:K,type:Q}=t,Z={root:["root",`color${or(n)}`,r&&"disabled",i&&"error",v&&"fullWidth",u&&"focused",s&&"formControl",W&&W!=="medium"&&`size${or(W)}`,A&&"multiline",K&&"adornedStart",l&&"adornedEnd",w&&"hiddenLabel",F&&"readOnly"],input:["input",r&&"disabled",Q==="search"&&"inputTypeSearch",A&&"inputMultiline",W==="small"&&"inputSizeSmall",w&&"inputHiddenLabel",K&&"inputAdornedStart",l&&"inputAdornedEnd",F&&"readOnly"]};return ts(Z,x3e,e)},HR=pr("div",{name:"MuiInputBase",slot:"Root",overridesResolver:VR})(ro(({theme:t})=>({...t.typography.body1,color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${ax.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:e})=>e.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:e,size:n})=>e.multiline&&n==="small",style:{paddingTop:1}},{props:({ownerState:e})=>e.fullWidth,style:{width:"100%"}}]}))),WR=pr("input",{name:"MuiInputBase",slot:"Input",overridesResolver:UR})(ro(({theme:t})=>{const e=t.palette.mode==="light",n={color:"currentColor",...t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5},transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})},r={opacity:"0 !important"},i=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":n,"&::-moz-placeholder":n,"&::-ms-input-placeholder":n,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${ax.formControl} &`]:{"&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&::-ms-input-placeholder":r,"&:focus::-webkit-input-placeholder":i,"&:focus::-moz-placeholder":i,"&:focus::-ms-input-placeholder":i},[`&.${ax.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},variants:[{props:({ownerState:l})=>!l.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:l})=>l.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),RH=gDe({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),FF=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiInputBase"}),{"aria-describedby":i,autoComplete:l,autoFocus:u,className:s,color:v,components:w={},componentsProps:A={},defaultValue:F,disabled:W,disableInjectingGlobalStyles:K,endAdornment:Q,error:Z,fullWidth:oe=!1,id:ae,inputComponent:me="input",inputProps:pe={},inputRef:_e,margin:De,maxRows:Ae,minRows:re,multiline:fe=!1,name:ye,onBlur:ue,onChange:Ie,onClick:Oe,onFocus:ze,onKeyDown:ft,onKeyUp:He,placeholder:bt,readOnly:Nt,renderSuffix:wt,rows:it,size:nn,slotProps:In={},slots:wn={},startAdornment:Xt,type:On="text",value:cr,...En}=r,fn=pe.value!=null?pe.value:cr,{current:ur}=se.useRef(fn!=null),br=se.useRef(),Pe=se.useCallback(Tr=>{},[]),jn=xc(br,_e,pe.ref,Pe),[rr,Yn]=se.useState(!1),Ot=Bx(),Sr=Fx({props:r,muiFormControl:Ot,states:["color","disabled","error","hiddenLabel","size","required","filled"]});Sr.focused=Ot?Ot.focused:rr,se.useEffect(()=>{!Ot&&W&&rr&&(Yn(!1),ue&&ue())},[Ot,W,rr,ue]);const fi=Ot&&Ot.onFilled,Wr=Ot&&Ot.onEmpty,Mn=se.useCallback(Tr=>{PI(Tr)?fi&&fi():Wr&&Wr()},[fi,Wr]);__(()=>{ur&&Mn({value:fn})},[fn,Mn,ur]);const jt=Tr=>{ze&&ze(Tr),pe.onFocus&&pe.onFocus(Tr),Ot&&Ot.onFocus?Ot.onFocus(Tr):Yn(!0)},Ln=Tr=>{ue&&ue(Tr),pe.onBlur&&pe.onBlur(Tr),Ot&&Ot.onBlur?Ot.onBlur(Tr):Yn(!1)},un=(Tr,...Li)=>{if(!ur){const pi=Tr.target||br.current;if(pi==null)throw new Error(Of(1));Mn({value:pi.value})}pe.onChange&&pe.onChange(Tr,...Li),Ie&&Ie(Tr,...Li)};se.useEffect(()=>{Mn(br.current)},[]);const Xn=Tr=>{br.current&&Tr.currentTarget===Tr.target&&br.current.focus(),Oe&&Oe(Tr)};let Ni=me,Bn=pe;fe&&Ni==="input"&&(it?Bn={type:void 0,minRows:it,maxRows:it,...Bn}:Bn={type:void 0,maxRows:Ae,minRows:re,...Bn},Ni=_3e);const Es=Tr=>{Mn(Tr.animationName==="mui-auto-fill-cancel"?br.current:{value:"x"})};se.useEffect(()=>{Ot&&Ot.setAdornedStart(!!Xt)},[Ot,Xt]);const Si={...r,color:Sr.color||"primary",disabled:Sr.disabled,endAdornment:Q,error:Sr.error,focused:Sr.focused,formControl:Ot,fullWidth:oe,hiddenLabel:Sr.hiddenLabel,multiline:fe,size:Sr.size,startAdornment:Xt,type:On},cs=v3e(Si),Oi=wn.root||w.Root||HR,mn=In.root||A.root||{},hr=wn.input||w.Input||WR;return Bn={...Bn,...In.input??A.input},R.jsxs(se.Fragment,{children:[!K&&typeof RH=="function"&&(AH||(AH=R.jsx(RH,{}))),R.jsxs(Oi,{...mn,ref:n,onClick:Xn,...En,...!qN(Oi)&&{ownerState:{...Si,...mn.ownerState}},className:Fr(cs.root,mn.className,s,Nt&&"MuiInputBase-readOnly"),children:[Xt,R.jsx(LF.Provider,{value:null,children:R.jsx(hr,{"aria-invalid":Sr.error,"aria-describedby":i,autoComplete:l,autoFocus:u,defaultValue:F,disabled:Sr.disabled,id:ae,onAnimationStart:Es,name:ye,placeholder:bt,readOnly:Nt,required:Sr.required,rows:it,value:fn,onKeyDown:ft,onKeyUp:He,type:On,...Bn,...!qN(hr)&&{as:Ni,ownerState:{...Si,...Bn.ownerState}},ref:jn,className:Fr(cs.input,Bn.className,Nt&&"MuiInputBase-readOnly"),onBlur:Ln,onChange:un,onFocus:jt})}),Q,wt?wt({...Sr,startAdornment:Xt}):null]})]})});function b3e(t){return es("MuiInput",t)}const Uv={...ax,...as("MuiInput",["root","underline","input"])};function w3e(t){return es("MuiOutlinedInput",t)}const cd={...ax,...as("MuiOutlinedInput",["root","notchedOutline","input"])};function E3e(t){return es("MuiFilledInput",t)}const Ig={...ax,...as("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},S3e=jR(R.jsx("path",{d:"M7 10l5 5 5-5z"})),T3e={entering:{opacity:1},entered:{opacity:1}},GN=se.forwardRef(function(e,n){const r=k2(),i={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:l,appear:u=!0,children:s,easing:v,in:w,onEnter:A,onEntered:F,onEntering:W,onExit:K,onExited:Q,onExiting:Z,style:oe,timeout:ae=i,TransitionComponent:me=Fd,...pe}=e,_e=se.useRef(null),De=xc(_e,D2(s),n),Ae=ft=>He=>{if(ft){const bt=_e.current;He===void 0?ft(bt):ft(bt,He)}},re=Ae(W),fe=Ae((ft,He)=>{ste(ft);const bt=RI({style:oe,timeout:ae,easing:v},{mode:"enter"});ft.style.webkitTransition=r.transitions.create("opacity",bt),ft.style.transition=r.transitions.create("opacity",bt),A&&A(ft,He)}),ye=Ae(F),ue=Ae(Z),Ie=Ae(ft=>{const He=RI({style:oe,timeout:ae,easing:v},{mode:"exit"});ft.style.webkitTransition=r.transitions.create("opacity",He),ft.style.transition=r.transitions.create("opacity",He),K&&K(ft)}),Oe=Ae(Q),ze=ft=>{l&&l(_e.current,ft)};return R.jsx(me,{appear:u,in:w,nodeRef:_e,onEnter:fe,onEntered:ye,onEntering:re,onExit:Ie,onExited:Oe,onExiting:ue,addEndListener:ze,timeout:ae,...pe,children:(ft,{ownerState:He,...bt})=>se.cloneElement(s,{style:{opacity:0,visibility:ft==="exited"&&!w?"hidden":void 0,...T3e[ft],...oe,...s.props.style},ref:De,...bt})})});function C3e(t){return es("MuiBackdrop",t)}as("MuiBackdrop",["root","invisible"]);const I3e=t=>{const{classes:e,invisible:n}=t;return ts({root:["root",n&&"invisible"]},C3e,e)},A3e=pr("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),ate=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiBackdrop"}),{children:i,className:l,component:u="div",invisible:s=!1,open:v,components:w={},componentsProps:A={},slotProps:F={},slots:W={},TransitionComponent:K,transitionDuration:Q,...Z}=r,oe={...r,component:u,invisible:s},ae=I3e(oe),me={transition:K,root:w.Root,...W},pe={...A,...F},_e={slots:me,slotProps:pe},[De,Ae]=Wo("root",{elementType:A3e,externalForwardedProps:_e,className:Fr(ae.root,l),ownerState:oe}),[re,fe]=Wo("transition",{elementType:GN,externalForwardedProps:_e,ownerState:oe});return R.jsx(re,{in:v,timeout:Q,...Z,...fe,children:R.jsx(De,{"aria-hidden":!0,...Ae,classes:ae,ref:n,children:i})})}),R3e=as("MuiBox",["root"]),M3e=tte(),Hv=jMe({themeId:sR,defaultTheme:M3e,defaultClassName:R3e.root,generateClassName:Oee.generate});function P3e(t){return es("MuiButton",t)}const Ag=as("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]),D3e=se.createContext({}),k3e=se.createContext(void 0),N3e=t=>{const{color:e,disableElevation:n,fullWidth:r,size:i,variant:l,loading:u,loadingPosition:s,classes:v}=t,w={root:["root",u&&"loading",l,`${l}${or(e)}`,`size${or(i)}`,`${l}Size${or(i)}`,`color${or(e)}`,n&&"disableElevation",r&&"fullWidth",u&&`loadingPosition${or(s)}`],startIcon:["icon","startIcon",`iconSize${or(i)}`],endIcon:["icon","endIcon",`iconSize${or(i)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},A=ts(w,P3e,v);return{...v,...A}},lte=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],O3e=pr(HN,{shouldForwardProp:t=>Hh(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.variant],e[`${n.variant}${or(n.color)}`],e[`size${or(n.size)}`],e[`${n.variant}Size${or(n.size)}`],n.color==="inherit"&&e.colorInherit,n.disableElevation&&e.disableElevation,n.fullWidth&&e.fullWidth,n.loading&&e.loading]}})(ro(({theme:t})=>{const e=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],n=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${Ag.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${Ag.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${Ag.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${Ag.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(Ah()).map(([r])=>({props:{color:r},style:{"--variant-textColor":(t.vars||t).palette[r].main,"--variant-outlinedColor":(t.vars||t).palette[r].main,"--variant-outlinedBorder":t.vars?`rgba(${t.vars.palette[r].mainChannel} / 0.5)`:el(t.palette[r].main,.5),"--variant-containedColor":(t.vars||t).palette[r].contrastText,"--variant-containedBg":(t.vars||t).palette[r].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[r].dark,"--variant-textBg":t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:el(t.palette[r].main,t.palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[r].main,"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:el(t.palette[r].main,t.palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:n,"--variant-textBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:el(t.palette.text.primary,t.palette.action.hoverOpacity),"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:el(t.palette.text.primary,t.palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${Ag.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${Ag.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),[`&.${Ag.loading}`]:{color:"transparent"}}}]}})),L3e=pr("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.startIcon,n.loading&&e.startIconLoadingStart,e[`iconSize${or(n.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...lte]})),F3e=pr("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.endIcon,n.loading&&e.endIconLoadingEnd,e[`iconSize${or(n.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...lte]})),B3e=pr("span",{name:"MuiButton",slot:"LoadingIndicator",overridesResolver:(t,e)=>e.loadingIndicator})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(t.vars||t).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]})),MH=pr("span",{name:"MuiButton",slot:"LoadingIconPlaceholder",overridesResolver:(t,e)=>e.loadingIconPlaceholder})({display:"inline-block",width:"1em",height:"1em"}),f3=se.forwardRef(function(e,n){const r=se.useContext(D3e),i=se.useContext(k3e),l=zw(r,e),u=ls({props:l,name:"MuiButton"}),{children:s,color:v="primary",component:w="button",className:A,disabled:F=!1,disableElevation:W=!1,disableFocusRipple:K=!1,endIcon:Q,focusVisibleClassName:Z,fullWidth:oe=!1,id:ae,loading:me=null,loadingIndicator:pe,loadingPosition:_e="center",size:De="medium",startIcon:Ae,type:re,variant:fe="text",...ye}=u,ue=BR(ae),Ie=pe??R.jsx(ote,{"aria-labelledby":ue,color:"inherit",size:16}),Oe={...u,color:v,component:w,disabled:F,disableElevation:W,disableFocusRipple:K,fullWidth:oe,loading:me,loadingIndicator:Ie,loadingPosition:_e,size:De,type:re,variant:fe},ze=N3e(Oe),ft=(Ae||me&&_e==="start")&&R.jsx(L3e,{className:ze.startIcon,ownerState:Oe,children:Ae||R.jsx(MH,{className:ze.loadingIconPlaceholder,ownerState:Oe})}),He=(Q||me&&_e==="end")&&R.jsx(F3e,{className:ze.endIcon,ownerState:Oe,children:Q||R.jsx(MH,{className:ze.loadingIconPlaceholder,ownerState:Oe})}),bt=i||"",Nt=typeof me=="boolean"?R.jsx("span",{className:ze.loadingWrapper,style:{display:"contents"},children:me&&R.jsx(B3e,{className:ze.loadingIndicator,ownerState:Oe,children:Ie})}):null;return R.jsxs(O3e,{ownerState:Oe,className:Fr(r.className,ze.root,A,bt),component:w,disabled:F||me,focusRipple:!K,focusVisibleClassName:Fr(ze.focusVisible,Z),ref:n,type:re,id:me?ue:ae,...ye,classes:ze,children:[ft,_e!=="end"&&Nt,s,_e==="end"&&Nt,He]})});function z3e(t){return es("MuiCard",t)}as("MuiCard",["root"]);const j3e=t=>{const{classes:e}=t;return ts({root:["root"]},z3e,e)},V3e=pr(N2,{name:"MuiCard",slot:"Root",overridesResolver:(t,e)=>e.root})({overflow:"hidden"}),U3e=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiCard"}),{className:i,raised:l=!1,...u}=r,s={...r,raised:l},v=j3e(s);return R.jsx(V3e,{className:Fr(v.root,i),elevation:l?8:void 0,ref:n,ownerState:s,...u})});function H3e(t){return es("MuiCardActions",t)}as("MuiCardActions",["root","spacing"]);const W3e=t=>{const{classes:e,disableSpacing:n}=t;return ts({root:["root",!n&&"spacing"]},H3e,e)},$3e=pr("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,!n.disableSpacing&&e.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),q3e=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiCardActions"}),{disableSpacing:i=!1,className:l,...u}=r,s={...r,disableSpacing:i},v=W3e(s);return R.jsx($3e,{className:Fr(v.root,l),ownerState:s,ref:n,...u})});function G3e(t){return es("MuiCardContent",t)}as("MuiCardContent",["root"]);const Y3e=t=>{const{classes:e}=t;return ts({root:["root"]},G3e,e)},X3e=pr("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(t,e)=>e.root})({padding:16,"&:last-child":{paddingBottom:24}}),K3e=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiCardContent"}),{className:i,component:l="div",...u}=r,s={...r,component:l},v=Y3e(s);return R.jsx(X3e,{as:l,className:Fr(v.root,i),ownerState:s,ref:n,...u})}),Z3e=wPe({createStyledComponent:pr("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`maxWidth${or(String(n.maxWidth))}`],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),useThemeProps:t=>ls({props:t,name:"MuiContainer"})});function Q3e(t){const e=jh(t);return e.body===t?Ff(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function jb(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function PH(t){return parseInt(Ff(t).getComputedStyle(t).paddingRight,10)||0}function J3e(t){const n=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(t.tagName),r=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return n||r}function DH(t,e,n,r,i){const l=[e,n,...r];[].forEach.call(t.children,u=>{const s=!l.includes(u),v=!J3e(u);s&&v&&jb(u,i)})}function p3(t,e){let n=-1;return t.some((r,i)=>e(r)?(n=i,!0):!1),n}function eke(t,e){const n=[],r=t.container;if(!e.disableScrollLock){if(Q3e(r)){const u=$ee(Ff(r));n.push({value:r.style.paddingRight,property:"padding-right",el:r}),r.style.paddingRight=`${PH(r)+u}px`;const s=jh(r).querySelectorAll(".mui-fixed");[].forEach.call(s,v=>{n.push({value:v.style.paddingRight,property:"padding-right",el:v}),v.style.paddingRight=`${PH(v)+u}px`})}let l;if(r.parentNode instanceof DocumentFragment)l=jh(r).body;else{const u=r.parentElement,s=Ff(r);l=u?.nodeName==="HTML"&&s.getComputedStyle(u).overflowY==="scroll"?u:r}n.push({value:l.style.overflow,property:"overflow",el:l},{value:l.style.overflowX,property:"overflow-x",el:l},{value:l.style.overflowY,property:"overflow-y",el:l}),l.style.overflow="hidden"}return()=>{n.forEach(({value:l,el:u,property:s})=>{l?u.style.setProperty(s,l):u.style.removeProperty(s)})}}function tke(t){const e=[];return[].forEach.call(t.children,n=>{n.getAttribute("aria-hidden")==="true"&&e.push(n)}),e}class nke{constructor(){this.modals=[],this.containers=[]}add(e,n){let r=this.modals.indexOf(e);if(r!==-1)return r;r=this.modals.length,this.modals.push(e),e.modalRef&&jb(e.modalRef,!1);const i=tke(n);DH(n,e.mount,e.modalRef,i,!0);const l=p3(this.containers,u=>u.container===n);return l!==-1?(this.containers[l].modals.push(e),r):(this.containers.push({modals:[e],container:n,restore:null,hiddenSiblings:i}),r)}mount(e,n){const r=p3(this.containers,l=>l.modals.includes(e)),i=this.containers[r];i.restore||(i.restore=eke(i,n))}remove(e,n=!0){const r=this.modals.indexOf(e);if(r===-1)return r;const i=p3(this.containers,u=>u.modals.includes(e)),l=this.containers[i];if(l.modals.splice(l.modals.indexOf(e),1),this.modals.splice(r,1),l.modals.length===0)l.restore&&l.restore(),e.modalRef&&jb(e.modalRef,n),DH(l.container,e.mount,e.modalRef,l.hiddenSiblings,!1),this.containers.splice(i,1);else{const u=l.modals[l.modals.length-1];u.modalRef&&jb(u.modalRef,!1)}return r}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}const rke=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function ike(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function ske(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=r=>t.ownerDocument.querySelector(`input[type="radio"]${r}`);let n=e(`[name="${t.name}"]:checked`);return n||(n=e(`[name="${t.name}"]`)),n!==t}function oke(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||ske(t))}function ake(t){const e=[],n=[];return Array.from(t.querySelectorAll(rke)).forEach((r,i)=>{const l=ike(r);l===-1||!oke(r)||(l===0?e.push(r):n.push({documentOrder:i,tabIndex:l,node:r}))}),n.sort((r,i)=>r.tabIndex===i.tabIndex?r.documentOrder-i.documentOrder:r.tabIndex-i.tabIndex).map(r=>r.node).concat(e)}function lke(){return!0}function cke(t){const{children:e,disableAutoFocus:n=!1,disableEnforceFocus:r=!1,disableRestoreFocus:i=!1,getTabbable:l=ake,isEnabled:u=lke,open:s}=t,v=se.useRef(!1),w=se.useRef(null),A=se.useRef(null),F=se.useRef(null),W=se.useRef(null),K=se.useRef(!1),Q=se.useRef(null),Z=xc(D2(e),Q),oe=se.useRef(null);se.useEffect(()=>{!s||!Q.current||(K.current=!n)},[n,s]),se.useEffect(()=>{if(!s||!Q.current)return;const pe=jh(Q.current);return Q.current.contains(pe.activeElement)||(Q.current.hasAttribute("tabIndex")||Q.current.setAttribute("tabIndex","-1"),K.current&&Q.current.focus()),()=>{i||(F.current&&F.current.focus&&(v.current=!0,F.current.focus()),F.current=null)}},[s]),se.useEffect(()=>{if(!s||!Q.current)return;const pe=jh(Q.current),_e=re=>{oe.current=re,!(r||!u()||re.key!=="Tab")&&pe.activeElement===Q.current&&re.shiftKey&&(v.current=!0,A.current&&A.current.focus())},De=()=>{const re=Q.current;if(re===null)return;if(!pe.hasFocus()||!u()||v.current){v.current=!1;return}if(re.contains(pe.activeElement)||r&&pe.activeElement!==w.current&&pe.activeElement!==A.current)return;if(pe.activeElement!==W.current)W.current=null;else if(W.current!==null)return;if(!K.current)return;let fe=[];if((pe.activeElement===w.current||pe.activeElement===A.current)&&(fe=l(Q.current)),fe.length>0){const ye=!!(oe.current?.shiftKey&&oe.current?.key==="Tab"),ue=fe[0],Ie=fe[fe.length-1];typeof ue!="string"&&typeof Ie!="string"&&(ye?Ie.focus():ue.focus())}else re.focus()};pe.addEventListener("focusin",De),pe.addEventListener("keydown",_e,!0);const Ae=setInterval(()=>{pe.activeElement&&pe.activeElement.tagName==="BODY"&&De()},50);return()=>{clearInterval(Ae),pe.removeEventListener("focusin",De),pe.removeEventListener("keydown",_e,!0)}},[n,r,i,u,s,l]);const ae=pe=>{F.current===null&&(F.current=pe.relatedTarget),K.current=!0,W.current=pe.target;const _e=e.props.onFocus;_e&&_e(pe)},me=pe=>{F.current===null&&(F.current=pe.relatedTarget),K.current=!0};return R.jsxs(se.Fragment,{children:[R.jsx("div",{tabIndex:s?0:-1,onFocus:me,ref:w,"data-testid":"sentinelStart"}),se.cloneElement(e,{ref:Z,onFocus:ae}),R.jsx("div",{tabIndex:s?0:-1,onFocus:me,ref:A,"data-testid":"sentinelEnd"})]})}function uke(t){return typeof t=="function"?t():t}function hke(t){return t?t.props.hasOwnProperty("in"):!1}const kH=()=>{},gT=new nke;function dke(t){const{container:e,disableEscapeKeyDown:n=!1,disableScrollLock:r=!1,closeAfterTransition:i=!1,onTransitionEnter:l,onTransitionExited:u,children:s,onClose:v,open:w,rootRef:A}=t,F=se.useRef({}),W=se.useRef(null),K=se.useRef(null),Q=xc(K,A),[Z,oe]=se.useState(!w),ae=hke(s);let me=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(me=!1);const pe=()=>jh(W.current),_e=()=>(F.current.modalRef=K.current,F.current.mount=W.current,F.current),De=()=>{gT.mount(_e(),{disableScrollLock:r}),K.current&&(K.current.scrollTop=0)},Ae=e_(()=>{const He=uke(e)||pe().body;gT.add(_e(),He),K.current&&De()}),re=()=>gT.isTopModal(_e()),fe=e_(He=>{W.current=He,He&&(w&&re()?De():K.current&&jb(K.current,me))}),ye=se.useCallback(()=>{gT.remove(_e(),me)},[me]);se.useEffect(()=>()=>{ye()},[ye]),se.useEffect(()=>{w?Ae():(!ae||!i)&&ye()},[w,ye,ae,i,Ae]);const ue=He=>bt=>{He.onKeyDown?.(bt),!(bt.key!=="Escape"||bt.which===229||!re())&&(n||(bt.stopPropagation(),v&&v(bt,"escapeKeyDown")))},Ie=He=>bt=>{He.onClick?.(bt),bt.target===bt.currentTarget&&v&&v(bt,"backdropClick")};return{getRootProps:(He={})=>{const bt=Gee(t);delete bt.onTransitionEnter,delete bt.onTransitionExited;const Nt={...bt,...He};return{role:"presentation",...Nt,onKeyDown:ue(Nt),ref:Q}},getBackdropProps:(He={})=>{const bt=He;return{"aria-hidden":!0,...bt,onClick:Ie(bt),open:w}},getTransitionProps:()=>{const He=()=>{oe(!1),l&&l()},bt=()=>{oe(!0),u&&u(),i&&ye()};return{onEnter:oH(He,s?.props.onEnter??kH),onExited:oH(bt,s?.props.onExited??kH)}},rootRef:Q,portalRef:fe,isTopModal:re,exited:Z,hasTransition:ae}}function fke(t){return es("MuiModal",t)}as("MuiModal",["root","hidden","backdrop"]);const pke=t=>{const{open:e,exited:n,classes:r}=t;return ts({root:["root",!e&&n&&"hidden"],backdrop:["backdrop"]},fke,r)},mke=pr("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,!n.open&&n.exited&&e.hidden]}})(ro(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),gke=pr(ate,{name:"MuiModal",slot:"Backdrop",overridesResolver:(t,e)=>e.backdrop})({zIndex:-1}),cte=se.forwardRef(function(e,n){const r=ls({name:"MuiModal",props:e}),{BackdropComponent:i=gke,BackdropProps:l,classes:u,className:s,closeAfterTransition:v=!1,children:w,container:A,component:F,components:W={},componentsProps:K={},disableAutoFocus:Q=!1,disableEnforceFocus:Z=!1,disableEscapeKeyDown:oe=!1,disablePortal:ae=!1,disableRestoreFocus:me=!1,disableScrollLock:pe=!1,hideBackdrop:_e=!1,keepMounted:De=!1,onClose:Ae,onTransitionEnter:re,onTransitionExited:fe,open:ye,slotProps:ue={},slots:Ie={},theme:Oe,...ze}=r,ft={...r,closeAfterTransition:v,disableAutoFocus:Q,disableEnforceFocus:Z,disableEscapeKeyDown:oe,disablePortal:ae,disableRestoreFocus:me,disableScrollLock:pe,hideBackdrop:_e,keepMounted:De},{getRootProps:He,getBackdropProps:bt,getTransitionProps:Nt,portalRef:wt,isTopModal:it,exited:nn,hasTransition:In}=dke({...ft,rootRef:n}),wn={...ft,exited:nn},Xt=pke(wn),On={};if(w.props.tabIndex===void 0&&(On.tabIndex="-1"),In){const{onEnter:Pe,onExited:jn}=Nt();On.onEnter=Pe,On.onExited=jn}const cr={slots:{root:W.Root,backdrop:W.Backdrop,...Ie},slotProps:{...K,...ue}},[En,fn]=Wo("root",{ref:n,elementType:mke,externalForwardedProps:{...cr,...ze,component:F},getSlotProps:He,ownerState:wn,className:Fr(s,Xt?.root,!wn.open&&wn.exited&&Xt?.hidden)}),[ur,br]=Wo("backdrop",{ref:l?.ref,elementType:i,externalForwardedProps:cr,shouldForwardComponentProp:!0,additionalProps:l,getSlotProps:Pe=>bt({...Pe,onClick:jn=>{Pe?.onClick&&Pe.onClick(jn)}}),className:Fr(l?.className,Xt?.backdrop),ownerState:wn});return!De&&!ye&&(!In||nn)?null:R.jsx(l3e,{ref:wt,container:A,disablePortal:ae,children:R.jsxs(En,{...fn,children:[!_e&&i?R.jsx(ur,{...br}):null,R.jsx(cke,{disableEnforceFocus:Z,disableAutoFocus:Q,disableRestoreFocus:me,isEnabled:it,open:ye,children:se.cloneElement(w,On)})]})})});function _ke(t){return es("MuiDialog",t)}const m3=as("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),ute=se.createContext({}),yke=pr(ate,{name:"MuiDialog",slot:"Backdrop",overrides:(t,e)=>e.backdrop})({zIndex:-1}),xke=t=>{const{classes:e,scroll:n,maxWidth:r,fullWidth:i,fullScreen:l}=t,u={root:["root"],container:["container",`scroll${or(n)}`],paper:["paper",`paperScroll${or(n)}`,`paperWidth${or(String(r))}`,i&&"paperFullWidth",l&&"paperFullScreen"]};return ts(u,_ke,e)},vke=pr(cte,{name:"MuiDialog",slot:"Root",overridesResolver:(t,e)=>e.root})({"@media print":{position:"absolute !important"}}),bke=pr("div",{name:"MuiDialog",slot:"Container",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.container,e[`scroll${or(n.scroll)}`]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),wke=pr(N2,{name:"MuiDialog",slot:"Paper",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.paper,e[`scrollPaper${or(n.scroll)}`],e[`paperWidth${or(String(n.maxWidth))}`],n.fullWidth&&e.paperFullWidth,n.fullScreen&&e.paperFullScreen]}})(ro(({theme:t})=>({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:({ownerState:e})=>!e.maxWidth,style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:t.breakpoints.unit==="px"?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${m3.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+32*2)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(t.breakpoints.values).filter(e=>e!=="xs").map(e=>({props:{maxWidth:e},style:{maxWidth:`${t.breakpoints.values[e]}${t.breakpoints.unit}`,[`&.${m3.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[e]+32*2)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:({ownerState:e})=>e.fullWidth,style:{width:"calc(100% - 64px)"}},{props:({ownerState:e})=>e.fullScreen,style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${m3.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}}]}))),Eke=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiDialog"}),i=k2(),l={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{"aria-describedby":u,"aria-labelledby":s,"aria-modal":v=!0,BackdropComponent:w,BackdropProps:A,children:F,className:W,disableEscapeKeyDown:K=!1,fullScreen:Q=!1,fullWidth:Z=!1,maxWidth:oe="sm",onClick:ae,onClose:me,open:pe,PaperComponent:_e=N2,PaperProps:De={},scroll:Ae="paper",slots:re={},slotProps:fe={},TransitionComponent:ye=GN,transitionDuration:ue=l,TransitionProps:Ie,...Oe}=r,ze={...r,disableEscapeKeyDown:K,fullScreen:Q,fullWidth:Z,maxWidth:oe,scroll:Ae},ft=xke(ze),He=se.useRef(),bt=Yn=>{He.current=Yn.target===Yn.currentTarget},Nt=Yn=>{ae&&ae(Yn),He.current&&(He.current=null,me&&me(Yn,"backdropClick"))},wt=BR(s),it=se.useMemo(()=>({titleId:wt}),[wt]),nn={transition:ye,...re},In={transition:Ie,paper:De,backdrop:A,...fe},wn={slots:nn,slotProps:In},[Xt,On]=Wo("root",{elementType:vke,shouldForwardComponentProp:!0,externalForwardedProps:wn,ownerState:ze,className:Fr(ft.root,W),ref:n}),[cr,En]=Wo("backdrop",{elementType:yke,shouldForwardComponentProp:!0,externalForwardedProps:wn,ownerState:ze}),[fn,ur]=Wo("paper",{elementType:wke,shouldForwardComponentProp:!0,externalForwardedProps:wn,ownerState:ze,className:Fr(ft.paper,De.className)}),[br,Pe]=Wo("container",{elementType:bke,externalForwardedProps:wn,ownerState:ze,className:Fr(ft.container)}),[jn,rr]=Wo("transition",{elementType:GN,externalForwardedProps:wn,ownerState:ze,additionalProps:{appear:!0,in:pe,timeout:ue,role:"presentation"}});return R.jsx(Xt,{closeAfterTransition:!0,slots:{backdrop:cr},slotProps:{backdrop:{transitionDuration:ue,as:w,...En}},disableEscapeKeyDown:K,onClose:me,open:pe,onClick:Nt,...On,...Oe,children:R.jsx(jn,{...rr,children:R.jsx(br,{onMouseDown:bt,...Pe,children:R.jsx(fn,{as:_e,elevation:24,role:"dialog","aria-describedby":u,"aria-labelledby":wt,"aria-modal":v,...ur,children:R.jsx(ute.Provider,{value:it,children:F})})})})})});function Ske(t){return es("MuiDialogActions",t)}as("MuiDialogActions",["root","spacing"]);const Tke=t=>{const{classes:e,disableSpacing:n}=t;return ts({root:["root",!n&&"spacing"]},Ske,e)},Cke=pr("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,!n.disableSpacing&&e.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:t})=>!t.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Ike=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiDialogActions"}),{className:i,disableSpacing:l=!1,...u}=r,s={...r,disableSpacing:l},v=Tke(s);return R.jsx(Cke,{className:Fr(v.root,i),ownerState:s,ref:n,...u})});function Ake(t){return es("MuiDialogContent",t)}as("MuiDialogContent",["root","dividers"]);function Rke(t){return es("MuiDialogTitle",t)}const Mke=as("MuiDialogTitle",["root"]),Pke=t=>{const{classes:e,dividers:n}=t;return ts({root:["root",n&&"dividers"]},Ake,e)},Dke=pr("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.dividers&&e.dividers]}})(ro(({theme:t})=>({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px",variants:[{props:({ownerState:e})=>e.dividers,style:{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>!e.dividers,style:{[`.${Mke.root} + &`]:{paddingTop:0}}}]}))),kke=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiDialogContent"}),{className:i,dividers:l=!1,...u}=r,s={...r,dividers:l},v=Pke(s);return R.jsx(Dke,{className:Fr(v.root,i),ownerState:s,ref:n,...u})}),Nke=t=>{const{classes:e}=t;return ts({root:["root"]},Rke,e)},Oke=pr($l,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,e)=>e.root})({padding:"16px 24px",flex:"0 0 auto"}),Lke=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiDialogTitle"}),{className:i,id:l,...u}=r,s=r,v=Nke(s),{titleId:w=l}=se.useContext(ute);return R.jsx(Oke,{component:"h2",className:Fr(v.root,i),ownerState:s,ref:n,variant:"h6",id:l??w,...u})}),Fke=t=>{const{classes:e,disableUnderline:n,startAdornment:r,endAdornment:i,size:l,hiddenLabel:u,multiline:s}=t,v={root:["root",!n&&"underline",r&&"adornedStart",i&&"adornedEnd",l==="small"&&`size${or(l)}`,u&&"hiddenLabel",s&&"multiline"],input:["input"]},w=ts(v,E3e,e);return{...e,...w}},Bke=pr(HR,{shouldForwardProp:t=>Hh(t)||t==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[...VR(t,e),!n.disableUnderline&&e.underline]}})(ro(({theme:t})=>{const e=t.palette.mode==="light",n=e?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",r=e?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",i=e?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",l=e?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:r,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:i,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:r}},[`&.${Ig.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:r},[`&.${Ig.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:l},variants:[{props:({ownerState:u})=>!u.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Ig.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Ig.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:n}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Ig.disabled}, .${Ig.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${Ig.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(Ah()).map(([u])=>({props:{disableUnderline:!1,color:u},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[u]?.main}`}}})),{props:({ownerState:u})=>u.startAdornment,style:{paddingLeft:12}},{props:({ownerState:u})=>u.endAdornment,style:{paddingRight:12}},{props:({ownerState:u})=>u.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:u,size:s})=>u.multiline&&s==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:u})=>u.multiline&&u.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:u})=>u.multiline&&u.hiddenLabel&&u.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),zke=pr(WR,{name:"MuiFilledInput",slot:"Input",overridesResolver:UR})(ro(({theme:t})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:e})=>e.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}},{props:({ownerState:e})=>e.hiddenLabel&&e.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:e})=>e.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),BF=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiFilledInput"}),{disableUnderline:i=!1,components:l={},componentsProps:u,fullWidth:s=!1,hiddenLabel:v,inputComponent:w="input",multiline:A=!1,slotProps:F,slots:W={},type:K="text",...Q}=r,Z={...r,disableUnderline:i,fullWidth:s,inputComponent:w,multiline:A,type:K},oe=Fke(r),ae={root:{ownerState:Z},input:{ownerState:Z}},me=F??u?ec(ae,F??u):ae,pe=W.root??l.Root??Bke,_e=W.input??l.Input??zke;return R.jsx(FF,{slots:{root:pe,input:_e},slotProps:me,fullWidth:s,inputComponent:w,multiline:A,ref:n,type:K,...Q,classes:oe})});BF.muiName="Input";function jke(t){return es("MuiFormControl",t)}as("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Vke=t=>{const{classes:e,margin:n,fullWidth:r}=t,i={root:["root",n!=="none"&&`margin${or(n)}`,r&&"fullWidth"]};return ts(i,jke,e)},Uke=pr("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`margin${or(n.margin)}`],n.fullWidth&&e.fullWidth]}})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),Hke=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiFormControl"}),{children:i,className:l,color:u="primary",component:s="div",disabled:v=!1,error:w=!1,focused:A,fullWidth:F=!1,hiddenLabel:W=!1,margin:K="none",required:Q=!1,size:Z="medium",variant:oe="outlined",...ae}=r,me={...r,color:u,component:s,disabled:v,error:w,fullWidth:F,hiddenLabel:W,margin:K,required:Q,size:Z,variant:oe},pe=Vke(me),[_e,De]=se.useState(()=>{let He=!1;return i&&se.Children.forEach(i,bt=>{if(!aC(bt,["Input","Select"]))return;const Nt=aC(bt,["Select"])?bt.props.input:bt;Nt&&y3e(Nt.props)&&(He=!0)}),He}),[Ae,re]=se.useState(()=>{let He=!1;return i&&se.Children.forEach(i,bt=>{aC(bt,["Input","Select"])&&(PI(bt.props,!0)||PI(bt.props.inputProps,!0))&&(He=!0)}),He}),[fe,ye]=se.useState(!1);v&&fe&&ye(!1);const ue=A!==void 0&&!v?A:fe;let Ie;se.useRef(!1);const Oe=se.useCallback(()=>{re(!0)},[]),ze=se.useCallback(()=>{re(!1)},[]),ft=se.useMemo(()=>({adornedStart:_e,setAdornedStart:De,color:u,disabled:v,error:w,filled:Ae,focused:ue,fullWidth:F,hiddenLabel:W,size:Z,onBlur:()=>{ye(!1)},onFocus:()=>{ye(!0)},onEmpty:ze,onFilled:Oe,registerEffect:Ie,required:Q,variant:oe}),[_e,u,v,w,Ae,ue,F,W,Ie,ze,Oe,Q,Z,oe]);return R.jsx(LF.Provider,{value:ft,children:R.jsx(Uke,{as:s,ownerState:me,className:Fr(pe.root,l),ref:n,...ae,children:i})})});function Wke(t){return es("MuiFormHelperText",t)}const NH=as("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var OH;const $ke=t=>{const{classes:e,contained:n,size:r,disabled:i,error:l,filled:u,focused:s,required:v}=t,w={root:["root",i&&"disabled",l&&"error",r&&`size${or(r)}`,n&&"contained",s&&"focused",u&&"filled",v&&"required"]};return ts(w,Wke,e)},qke=pr("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.size&&e[`size${or(n.size)}`],n.contained&&e.contained,n.filled&&e.filled]}})(ro(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${NH.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${NH.error}`]:{color:(t.vars||t).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:e})=>e.contained,style:{marginLeft:14,marginRight:14}}]}))),Gke=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiFormHelperText"}),{children:i,className:l,component:u="p",disabled:s,error:v,filled:w,focused:A,margin:F,required:W,variant:K,...Q}=r,Z=Bx(),oe=Fx({props:r,muiFormControl:Z,states:["variant","size","disabled","error","filled","focused","required"]}),ae={...r,component:u,contained:oe.variant==="filled"||oe.variant==="outlined",variant:oe.variant,size:oe.size,disabled:oe.disabled,error:oe.error,filled:oe.filled,focused:oe.focused,required:oe.required};delete ae.ownerState;const me=$ke(ae);return R.jsx(qke,{as:u,className:Fr(me.root,l),ref:n,...Q,ownerState:ae,children:i===" "?OH||(OH=R.jsx("span",{className:"notranslate","aria-hidden":!0,children:""})):i})});function Yke(t){return es("MuiFormLabel",t)}const Vb=as("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),Xke=t=>{const{classes:e,color:n,focused:r,disabled:i,error:l,filled:u,required:s}=t,v={root:["root",`color${or(n)}`,i&&"disabled",l&&"error",u&&"filled",r&&"focused",s&&"required"],asterisk:["asterisk",l&&"error"]};return ts(v,Yke,e)},Kke=pr("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.color==="secondary"&&e.colorSecondary,n.filled&&e.filled]}})(ro(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(t.palette).filter(Ah()).map(([e])=>({props:{color:e},style:{[`&.${Vb.focused}`]:{color:(t.vars||t).palette[e].main}}})),{props:{},style:{[`&.${Vb.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Vb.error}`]:{color:(t.vars||t).palette.error.main}}}]}))),Zke=pr("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(ro(({theme:t})=>({[`&.${Vb.error}`]:{color:(t.vars||t).palette.error.main}}))),Qke=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiFormLabel"}),{children:i,className:l,color:u,component:s="label",disabled:v,error:w,filled:A,focused:F,required:W,...K}=r,Q=Bx(),Z=Fx({props:r,muiFormControl:Q,states:["color","required","focused","disabled","error","filled"]}),oe={...r,color:Z.color||"primary",component:s,disabled:Z.disabled,error:Z.error,filled:Z.filled,focused:Z.focused,required:Z.required},ae=Xke(oe);return R.jsxs(Kke,{as:s,ownerState:oe,className:Fr(ae.root,l),ref:n,...K,children:[i,Z.required&&R.jsxs(Zke,{ownerState:oe,"aria-hidden":!0,className:ae.asterisk,children:["","*"]})]})}),LH=BPe({createStyledComponent:pr("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.container&&e.container]}}),componentName:"MuiGrid",useThemeProps:t=>ls({props:t,name:"MuiGrid"}),useTheme:k2});function YN(t){return`scale(${t}, ${t**2})`}const Jke={entering:{opacity:1,transform:YN(1)},entered:{opacity:1,transform:"none"}},g3=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),XN=se.forwardRef(function(e,n){const{addEndListener:r,appear:i=!0,children:l,easing:u,in:s,onEnter:v,onEntered:w,onEntering:A,onExit:F,onExited:W,onExiting:K,style:Q,timeout:Z="auto",TransitionComponent:oe=Fd,...ae}=e,me=Wee(),pe=se.useRef(),_e=k2(),De=se.useRef(null),Ae=xc(De,D2(l),n),re=He=>bt=>{if(He){const Nt=De.current;bt===void 0?He(Nt):He(Nt,bt)}},fe=re(A),ye=re((He,bt)=>{ste(He);const{duration:Nt,delay:wt,easing:it}=RI({style:Q,timeout:Z,easing:u},{mode:"enter"});let nn;Z==="auto"?(nn=_e.transitions.getAutoHeightDuration(He.clientHeight),pe.current=nn):nn=Nt,He.style.transition=[_e.transitions.create("opacity",{duration:nn,delay:wt}),_e.transitions.create("transform",{duration:g3?nn:nn*.666,delay:wt,easing:it})].join(","),v&&v(He,bt)}),ue=re(w),Ie=re(K),Oe=re(He=>{const{duration:bt,delay:Nt,easing:wt}=RI({style:Q,timeout:Z,easing:u},{mode:"exit"});let it;Z==="auto"?(it=_e.transitions.getAutoHeightDuration(He.clientHeight),pe.current=it):it=bt,He.style.transition=[_e.transitions.create("opacity",{duration:it,delay:Nt}),_e.transitions.create("transform",{duration:g3?it:it*.666,delay:g3?Nt:Nt||it*.333,easing:wt})].join(","),He.style.opacity=0,He.style.transform=YN(.75),F&&F(He)}),ze=re(W),ft=He=>{Z==="auto"&&me.start(pe.current||0,He),r&&r(De.current,He)};return R.jsx(oe,{appear:i,in:s,nodeRef:De,onEnter:ye,onEntered:ue,onEntering:fe,onExit:Oe,onExited:ze,onExiting:Ie,addEndListener:ft,timeout:Z==="auto"?null:Z,...ae,children:(He,{ownerState:bt,...Nt})=>se.cloneElement(l,{style:{opacity:0,transform:YN(.75),visibility:He==="exited"&&!s?"hidden":void 0,...Jke[He],...Q,...l.props.style},ref:Ae,...Nt})})});XN&&(XN.muiSupportAuto=!0);const eNe=t=>{const{classes:e,disableUnderline:n}=t,i=ts({root:["root",!n&&"underline"],input:["input"]},b3e,e);return{...e,...i}},tNe=pr(HR,{shouldForwardProp:t=>Hh(t)||t==="classes",name:"MuiInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[...VR(t,e),!n.disableUnderline&&e.underline]}})(ro(({theme:t})=>{let n=t.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(n=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:r})=>r.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:r})=>!r.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Uv.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Uv.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${n}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Uv.disabled}, .${Uv.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${n}`}},[`&.${Uv.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(Ah()).map(([r])=>({props:{color:r,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[r].main}`}}}))]}})),nNe=pr(WR,{name:"MuiInput",slot:"Input",overridesResolver:UR})({}),zF=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiInput"}),{disableUnderline:i=!1,components:l={},componentsProps:u,fullWidth:s=!1,inputComponent:v="input",multiline:w=!1,slotProps:A,slots:F={},type:W="text",...K}=r,Q=eNe(r),oe={root:{ownerState:{disableUnderline:i}}},ae=A??u?ec(A??u,oe):oe,me=F.root??l.Root??tNe,pe=F.input??l.Input??nNe;return R.jsx(FF,{slots:{root:me,input:pe},slotProps:ae,fullWidth:s,inputComponent:v,multiline:w,ref:n,type:W,...K,classes:Q})});zF.muiName="Input";function rNe(t){return es("MuiInputLabel",t)}as("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const iNe=t=>{const{classes:e,formControl:n,size:r,shrink:i,disableAnimation:l,variant:u,required:s}=t,v={root:["root",n&&"formControl",!l&&"animated",i&&"shrink",r&&r!=="medium"&&`size${or(r)}`,u],asterisk:[s&&"asterisk"]},w=ts(v,rNe,e);return{...e,...w}},sNe=pr(Qke,{shouldForwardProp:t=>Hh(t)||t==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[{[`& .${Vb.asterisk}`]:e.asterisk},e.root,n.formControl&&e.formControl,n.size==="small"&&e.sizeSmall,n.shrink&&e.shrink,!n.disableAnimation&&e.animated,n.focused&&e.focused,e[n.variant]]}})(ro(({theme:t})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:e})=>e.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:e})=>e.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:e})=>!e.disableAnimation,style:{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:e,ownerState:n})=>e==="filled"&&n.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:e,ownerState:n,size:r})=>e==="filled"&&n.shrink&&r==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:e,ownerState:n})=>e==="outlined"&&n.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),oNe=se.forwardRef(function(e,n){const r=ls({name:"MuiInputLabel",props:e}),{disableAnimation:i=!1,margin:l,shrink:u,variant:s,className:v,...w}=r,A=Bx();let F=u;typeof F>"u"&&A&&(F=A.filled||A.focused||A.adornedStart);const W=Fx({props:r,muiFormControl:A,states:["size","variant","required","focused"]}),K={...r,disableAnimation:i,formControl:A,shrink:F,size:W.size,variant:W.variant,required:W.required,focused:W.focused},Q=iNe(K);return R.jsx(sNe,{"data-shrink":F,ref:n,className:Fr(Q.root,v),...w,ownerState:K,classes:Q})}),aNe=se.createContext({});function lNe(t){return es("MuiList",t)}as("MuiList",["root","padding","dense","subheader"]);const cNe=t=>{const{classes:e,disablePadding:n,dense:r,subheader:i}=t;return ts({root:["root",!n&&"padding",r&&"dense",i&&"subheader"]},lNe,e)},uNe=pr("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,!n.disablePadding&&e.padding,n.dense&&e.dense,n.subheader&&e.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:t})=>!t.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:t})=>t.subheader,style:{paddingTop:0}}]}),hNe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiList"}),{children:i,className:l,component:u="ul",dense:s=!1,disablePadding:v=!1,subheader:w,...A}=r,F=se.useMemo(()=>({dense:s}),[s]),W={...r,component:u,dense:s,disablePadding:v},K=cNe(W);return R.jsx(aNe.Provider,{value:F,children:R.jsxs(uNe,{as:u,className:Fr(K.root,l),ref:n,ownerState:W,...A,children:[w,i]})})});function _3(t,e,n){return t===e?t.firstChild:e&&e.nextElementSibling?e.nextElementSibling:n?null:t.firstChild}function FH(t,e,n){return t===e?n?t.firstChild:t.lastChild:e&&e.previousElementSibling?e.previousElementSibling:n?null:t.lastChild}function hte(t,e){if(e===void 0)return!0;let n=t.innerText;return n===void 0&&(n=t.textContent),n=n.trim().toLowerCase(),n.length===0?!1:e.repeating?n[0]===e.keys[0]:n.startsWith(e.keys.join(""))}function Wv(t,e,n,r,i,l){let u=!1,s=i(t,e,e?n:!1);for(;s;){if(s===t.firstChild){if(u)return!1;u=!0}const v=r?!1:s.disabled||s.getAttribute("aria-disabled")==="true";if(!s.hasAttribute("tabindex")||!hte(s,l)||v)s=i(t,s,n);else return s.focus(),!0}return!1}const dNe=se.forwardRef(function(e,n){const{actions:r,autoFocus:i=!1,autoFocusItem:l=!1,children:u,className:s,disabledItemsFocusable:v=!1,disableListWrap:w=!1,onKeyDown:A,variant:F="selectedMenu",...W}=e,K=se.useRef(null),Q=se.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});__(()=>{i&&K.current.focus()},[i]),se.useImperativeHandle(r,()=>({adjustStyleForScrollbar:(pe,{direction:_e})=>{const De=!K.current.style.width;if(pe.clientHeight<K.current.clientHeight&&De){const Ae=`${$ee(Ff(pe))}px`;K.current.style[_e==="rtl"?"paddingLeft":"paddingRight"]=Ae,K.current.style.width=`calc(100% + ${Ae})`}return K.current}}),[]);const Z=pe=>{const _e=K.current,De=pe.key;if(pe.ctrlKey||pe.metaKey||pe.altKey){A&&A(pe);return}const re=jh(_e).activeElement;if(De==="ArrowDown")pe.preventDefault(),Wv(_e,re,w,v,_3);else if(De==="ArrowUp")pe.preventDefault(),Wv(_e,re,w,v,FH);else if(De==="Home")pe.preventDefault(),Wv(_e,null,w,v,_3);else if(De==="End")pe.preventDefault(),Wv(_e,null,w,v,FH);else if(De.length===1){const fe=Q.current,ye=De.toLowerCase(),ue=performance.now();fe.keys.length>0&&(ue-fe.lastTime>500?(fe.keys=[],fe.repeating=!0,fe.previousKeyMatched=!0):fe.repeating&&ye!==fe.keys[0]&&(fe.repeating=!1)),fe.lastTime=ue,fe.keys.push(ye);const Ie=re&&!fe.repeating&&hte(re,fe);fe.previousKeyMatched&&(Ie||Wv(_e,re,!1,v,_3,fe))?pe.preventDefault():fe.previousKeyMatched=!1}A&&A(pe)},oe=xc(K,n);let ae=-1;se.Children.forEach(u,(pe,_e)=>{if(!se.isValidElement(pe)){ae===_e&&(ae+=1,ae>=u.length&&(ae=-1));return}pe.props.disabled||(F==="selectedMenu"&&pe.props.selected||ae===-1)&&(ae=_e),ae===_e&&(pe.props.disabled||pe.props.muiSkipListHighlight||pe.type.muiSkipListHighlight)&&(ae+=1,ae>=u.length&&(ae=-1))});const me=se.Children.map(u,(pe,_e)=>{if(_e===ae){const De={};return l&&(De.autoFocus=!0),pe.props.tabIndex===void 0&&F==="selectedMenu"&&(De.tabIndex=0),se.cloneElement(pe,De)}return pe});return R.jsx(hNe,{role:"menu",ref:oe,className:s,onKeyDown:Z,tabIndex:i?0:-1,...W,children:me})});function fNe(t){return es("MuiPopover",t)}as("MuiPopover",["root","paper"]);function BH(t,e){let n=0;return typeof e=="number"?n=e:e==="center"?n=t.height/2:e==="bottom"&&(n=t.height),n}function zH(t,e){let n=0;return typeof e=="number"?n=e:e==="center"?n=t.width/2:e==="right"&&(n=t.width),n}function jH(t){return[t.horizontal,t.vertical].map(e=>typeof e=="number"?`${e}px`:e).join(" ")}function _T(t){return typeof t=="function"?t():t}const pNe=t=>{const{classes:e}=t;return ts({root:["root"],paper:["paper"]},fNe,e)},mNe=pr(cte,{name:"MuiPopover",slot:"Root",overridesResolver:(t,e)=>e.root})({}),dte=pr(N2,{name:"MuiPopover",slot:"Paper",overridesResolver:(t,e)=>e.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),gNe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiPopover"}),{action:i,anchorEl:l,anchorOrigin:u={vertical:"top",horizontal:"left"},anchorPosition:s,anchorReference:v="anchorEl",children:w,className:A,container:F,elevation:W=8,marginThreshold:K=16,open:Q,PaperProps:Z={},slots:oe={},slotProps:ae={},transformOrigin:me={vertical:"top",horizontal:"left"},TransitionComponent:pe,transitionDuration:_e="auto",TransitionProps:De={},disableScrollLock:Ae=!1,...re}=r,fe=se.useRef(),ye={...r,anchorOrigin:u,anchorReference:v,elevation:W,marginThreshold:K,transformOrigin:me,TransitionComponent:pe,transitionDuration:_e,TransitionProps:De},ue=pNe(ye),Ie=se.useCallback(()=>{if(v==="anchorPosition")return s;const Pe=_T(l),rr=(Pe&&Pe.nodeType===1?Pe:jh(fe.current).body).getBoundingClientRect();return{top:rr.top+BH(rr,u.vertical),left:rr.left+zH(rr,u.horizontal)}},[l,u.horizontal,u.vertical,s,v]),Oe=se.useCallback(Pe=>({vertical:BH(Pe,me.vertical),horizontal:zH(Pe,me.horizontal)}),[me.horizontal,me.vertical]),ze=se.useCallback(Pe=>{const jn={width:Pe.offsetWidth,height:Pe.offsetHeight},rr=Oe(jn);if(v==="none")return{top:null,left:null,transformOrigin:jH(rr)};const Yn=Ie();let Ot=Yn.top-rr.vertical,Sr=Yn.left-rr.horizontal;const fi=Ot+jn.height,Wr=Sr+jn.width,Mn=Ff(_T(l)),jt=Mn.innerHeight-K,Ln=Mn.innerWidth-K;if(K!==null&&Ot<K){const un=Ot-K;Ot-=un,rr.vertical+=un}else if(K!==null&&fi>jt){const un=fi-jt;Ot-=un,rr.vertical+=un}if(K!==null&&Sr<K){const un=Sr-K;Sr-=un,rr.horizontal+=un}else if(Wr>Ln){const un=Wr-Ln;Sr-=un,rr.horizontal+=un}return{top:`${Math.round(Ot)}px`,left:`${Math.round(Sr)}px`,transformOrigin:jH(rr)}},[l,v,Ie,Oe,K]),[ft,He]=se.useState(Q),bt=se.useCallback(()=>{const Pe=fe.current;if(!Pe)return;const jn=ze(Pe);jn.top!==null&&Pe.style.setProperty("top",jn.top),jn.left!==null&&(Pe.style.left=jn.left),Pe.style.transformOrigin=jn.transformOrigin,He(!0)},[ze]);se.useEffect(()=>(Ae&&window.addEventListener("scroll",bt),()=>window.removeEventListener("scroll",bt)),[l,Ae,bt]);const Nt=()=>{bt()},wt=()=>{He(!1)};se.useEffect(()=>{Q&&bt()}),se.useImperativeHandle(i,()=>Q?{updatePosition:()=>{bt()}}:null,[Q,bt]),se.useEffect(()=>{if(!Q)return;const Pe=Uee(()=>{bt()}),jn=Ff(_T(l));return jn.addEventListener("resize",Pe),()=>{Pe.clear(),jn.removeEventListener("resize",Pe)}},[l,Q,bt]);let it=_e;const nn={slots:{transition:pe,...oe},slotProps:{transition:De,paper:Z,...ae}},[In,wn]=Wo("transition",{elementType:XN,externalForwardedProps:nn,ownerState:ye,getSlotProps:Pe=>({...Pe,onEntering:(jn,rr)=>{Pe.onEntering?.(jn,rr),Nt()},onExited:jn=>{Pe.onExited?.(jn),wt()}}),additionalProps:{appear:!0,in:Q}});_e==="auto"&&!In.muiSupportAuto&&(it=void 0);const Xt=F||(l?jh(_T(l)).body:void 0),[On,{slots:cr,slotProps:En,...fn}]=Wo("root",{ref:n,elementType:mNe,externalForwardedProps:{...nn,...re},shouldForwardComponentProp:!0,additionalProps:{slots:{backdrop:oe.backdrop},slotProps:{backdrop:wDe(typeof ae.backdrop=="function"?ae.backdrop(ye):ae.backdrop,{invisible:!0})},container:Xt,open:Q},ownerState:ye,className:Fr(ue.root,A)}),[ur,br]=Wo("paper",{ref:fe,className:ue.paper,elementType:dte,externalForwardedProps:nn,shouldForwardComponentProp:!0,additionalProps:{elevation:W,style:ft?void 0:{opacity:0}},ownerState:ye});return R.jsx(On,{...fn,...!qN(On)&&{slots:cr,slotProps:En,disableScrollLock:Ae},children:R.jsx(In,{...wn,timeout:it,children:R.jsx(ur,{...br,children:w})})})});function _Ne(t){return es("MuiMenu",t)}as("MuiMenu",["root","paper","list"]);const yNe={vertical:"top",horizontal:"right"},xNe={vertical:"top",horizontal:"left"},vNe=t=>{const{classes:e}=t;return ts({root:["root"],paper:["paper"],list:["list"]},_Ne,e)},bNe=pr(gNe,{shouldForwardProp:t=>Hh(t)||t==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(t,e)=>e.root})({}),wNe=pr(dte,{name:"MuiMenu",slot:"Paper",overridesResolver:(t,e)=>e.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),ENe=pr(dNe,{name:"MuiMenu",slot:"List",overridesResolver:(t,e)=>e.list})({outline:0}),SNe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiMenu"}),{autoFocus:i=!0,children:l,className:u,disableAutoFocusItem:s=!1,MenuListProps:v={},onClose:w,open:A,PaperProps:F={},PopoverClasses:W,transitionDuration:K="auto",TransitionProps:{onEntering:Q,...Z}={},variant:oe="selectedMenu",slots:ae={},slotProps:me={},...pe}=r,_e=lPe(),De={...r,autoFocus:i,disableAutoFocusItem:s,MenuListProps:v,onEntering:Q,PaperProps:F,transitionDuration:K,TransitionProps:Z,variant:oe},Ae=vNe(De),re=i&&!s&&A,fe=se.useRef(null),ye=(it,nn)=>{fe.current&&fe.current.adjustStyleForScrollbar(it,{direction:_e?"rtl":"ltr"}),Q&&Q(it,nn)},ue=it=>{it.key==="Tab"&&(it.preventDefault(),w&&w(it,"tabKeyDown"))};let Ie=-1;se.Children.map(l,(it,nn)=>{se.isValidElement(it)&&(it.props.disabled||(oe==="selectedMenu"&&it.props.selected||Ie===-1)&&(Ie=nn))});const Oe={slots:ae,slotProps:{list:v,transition:Z,paper:F,...me}},ze=oPe({elementType:ae.root,externalSlotProps:me.root,ownerState:De,className:[Ae.root,u]}),[ft,He]=Wo("paper",{className:Ae.paper,elementType:wNe,externalForwardedProps:Oe,shouldForwardComponentProp:!0,ownerState:De}),[bt,Nt]=Wo("list",{className:Fr(Ae.list,v.className),elementType:ENe,shouldForwardComponentProp:!0,externalForwardedProps:Oe,getSlotProps:it=>({...it,onKeyDown:nn=>{ue(nn),it.onKeyDown?.(nn)}}),ownerState:De}),wt=typeof Oe.slotProps.transition=="function"?Oe.slotProps.transition(De):Oe.slotProps.transition;return R.jsx(bNe,{onClose:w,anchorOrigin:{vertical:"bottom",horizontal:_e?"right":"left"},transformOrigin:_e?yNe:xNe,slots:{root:ae.root,paper:ft,backdrop:ae.backdrop,...ae.transition&&{transition:ae.transition}},slotProps:{root:ze,paper:He,backdrop:typeof me.backdrop=="function"?me.backdrop(De):me.backdrop,transition:{...wt,onEntering:(...it)=>{ye(...it),wt?.onEntering?.(...it)}}},open:A,ref:n,transitionDuration:K,ownerState:De,...pe,classes:W,children:R.jsx(bt,{actions:fe,autoFocus:i&&(Ie===-1||s),autoFocusItem:re,variant:oe,...Nt,children:l})})});function TNe(t){return es("MuiNativeSelect",t)}const jF=as("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),CNe=t=>{const{classes:e,variant:n,disabled:r,multiple:i,open:l,error:u}=t,s={select:["select",n,r&&"disabled",i&&"multiple",u&&"error"],icon:["icon",`icon${or(n)}`,l&&"iconOpen",r&&"disabled"]};return ts(s,TNe,e)},fte=pr("select")(({theme:t})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${jF.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(t.vars||t).palette.background.paper},variants:[{props:({ownerState:e})=>e.variant!=="filled"&&e.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(t.vars||t).shape.borderRadius,"&:focus":{borderRadius:(t.vars||t).shape.borderRadius},"&&&":{paddingRight:32}}}]})),INe=pr(fte,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Hh,overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.select,e[n.variant],n.error&&e.error,{[`&.${jF.multiple}`]:e.multiple}]}})({}),pte=pr("svg")(({theme:t})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(t.vars||t).palette.action.active,[`&.${jF.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:({ownerState:e})=>e.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),ANe=pr(pte,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.icon,n.variant&&e[`icon${or(n.variant)}`],n.open&&e.iconOpen]}})({}),RNe=se.forwardRef(function(e,n){const{className:r,disabled:i,error:l,IconComponent:u,inputRef:s,variant:v="standard",...w}=e,A={...e,disabled:i,variant:v,error:l},F=CNe(A);return R.jsxs(se.Fragment,{children:[R.jsx(INe,{ownerState:A,className:Fr(F.select,r),disabled:i,ref:s||n,...w}),e.multiple?null:R.jsx(ANe,{as:u,ownerState:A,className:F.icon})]})});var VH;const MNe=pr("fieldset",{shouldForwardProp:Hh})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),PNe=pr("legend",{shouldForwardProp:Hh})(ro(({theme:t})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:e})=>!e.withLabel,style:{padding:0,lineHeight:"11px",transition:t.transitions.create("width",{duration:150,easing:t.transitions.easing.easeOut})}},{props:({ownerState:e})=>e.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:t.transitions.create("max-width",{duration:50,easing:t.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:e})=>e.withLabel&&e.notched,style:{maxWidth:"100%",transition:t.transitions.create("max-width",{duration:100,easing:t.transitions.easing.easeOut,delay:50})}}]})));function DNe(t){const{children:e,classes:n,className:r,label:i,notched:l,...u}=t,s=i!=null&&i!=="",v={...t,notched:l,withLabel:s};return R.jsx(MNe,{"aria-hidden":!0,className:r,ownerState:v,...u,children:R.jsx(PNe,{ownerState:v,children:s?R.jsx("span",{children:i}):VH||(VH=R.jsx("span",{className:"notranslate","aria-hidden":!0,children:""}))})})}const kNe=t=>{const{classes:e}=t,r=ts({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},w3e,e);return{...e,...r}},NNe=pr(HR,{shouldForwardProp:t=>Hh(t)||t==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:VR})(ro(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${cd.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${cd.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}},[`&.${cd.focused} .${cd.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(t.palette).filter(Ah()).map(([n])=>({props:{color:n},style:{[`&.${cd.focused} .${cd.notchedOutline}`]:{borderColor:(t.vars||t).palette[n].main}}})),{props:{},style:{[`&.${cd.error} .${cd.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${cd.disabled} .${cd.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}}},{props:({ownerState:n})=>n.startAdornment,style:{paddingLeft:14}},{props:({ownerState:n})=>n.endAdornment,style:{paddingRight:14}},{props:({ownerState:n})=>n.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:n,size:r})=>n.multiline&&r==="small",style:{padding:"8.5px 14px"}}]}})),ONe=pr(DNe,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(t,e)=>e.notchedOutline})(ro(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}})),LNe=pr(WR,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:UR})(ro(({theme:t})=>({padding:"16.5px 14px",...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:e})=>e.multiline,style:{padding:0}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}}]}))),VF=se.forwardRef(function(e,n){var r;const i=ls({props:e,name:"MuiOutlinedInput"}),{components:l={},fullWidth:u=!1,inputComponent:s="input",label:v,multiline:w=!1,notched:A,slots:F={},type:W="text",...K}=i,Q=kNe(i),Z=Bx(),oe=Fx({props:i,muiFormControl:Z,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),ae={...i,color:oe.color||"primary",disabled:oe.disabled,error:oe.error,focused:oe.focused,formControl:Z,fullWidth:u,hiddenLabel:oe.hiddenLabel,multiline:w,size:oe.size,type:W},me=F.root??l.Root??NNe,pe=F.input??l.Input??LNe;return R.jsx(FF,{slots:{root:me,input:pe},renderSuffix:_e=>R.jsx(ONe,{ownerState:ae,className:Q.notchedOutline,label:v!=null&&v!==""&&oe.required?r||(r=R.jsxs(se.Fragment,{children:[v,"","*"]})):v,notched:typeof A<"u"?A:!!(_e.startAdornment||_e.filled||_e.focused)}),fullWidth:u,inputComponent:s,multiline:w,ref:n,type:W,...K,classes:{...Q,notchedOutline:null}})});VF.muiName="Input";function mte(t){return es("MuiSelect",t)}const $v=as("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var UH;const FNe=pr(fte,{name:"MuiSelect",slot:"Select",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[{[`&.${$v.select}`]:e.select},{[`&.${$v.select}`]:e[n.variant]},{[`&.${$v.error}`]:e.error},{[`&.${$v.multiple}`]:e.multiple}]}})({[`&.${$v.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),BNe=pr(pte,{name:"MuiSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.icon,n.variant&&e[`icon${or(n.variant)}`],n.open&&e.iconOpen]}})({}),zNe=pr("input",{shouldForwardProp:t=>nte(t)&&t!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(t,e)=>e.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function HH(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}function jNe(t){return t==null||typeof t=="string"&&!t.trim()}const VNe=t=>{const{classes:e,variant:n,disabled:r,multiple:i,open:l,error:u}=t,s={select:["select",n,r&&"disabled",i&&"multiple",u&&"error"],icon:["icon",`icon${or(n)}`,l&&"iconOpen",r&&"disabled"],nativeInput:["nativeInput"]};return ts(s,mte,e)},UNe=se.forwardRef(function(e,n){const{"aria-describedby":r,"aria-label":i,autoFocus:l,autoWidth:u,children:s,className:v,defaultOpen:w,defaultValue:A,disabled:F,displayEmpty:W,error:K=!1,IconComponent:Q,inputRef:Z,labelId:oe,MenuProps:ae={},multiple:me,name:pe,onBlur:_e,onChange:De,onClose:Ae,onFocus:re,onOpen:fe,open:ye,readOnly:ue,renderValue:Ie,required:Oe,SelectDisplayProps:ze={},tabIndex:ft,type:He,value:bt,variant:Nt="standard",...wt}=e,[it,nn]=uH({controlled:bt,default:A,name:"Select"}),[In,wn]=uH({controlled:ye,default:w,name:"Select"}),Xt=se.useRef(null),On=se.useRef(null),[cr,En]=se.useState(null),{current:fn}=se.useRef(ye!=null),[ur,br]=se.useState(),Pe=xc(n,Z),jn=se.useCallback(rn=>{On.current=rn,rn&&En(rn)},[]),rr=cr?.parentNode;se.useImperativeHandle(Pe,()=>({focus:()=>{On.current.focus()},node:Xt.current,value:it}),[it]),se.useEffect(()=>{w&&In&&cr&&!fn&&(br(u?null:rr.clientWidth),On.current.focus())},[cr,u]),se.useEffect(()=>{l&&On.current.focus()},[l]),se.useEffect(()=>{if(!oe)return;const rn=jh(On.current).getElementById(oe);if(rn){const Rr=()=>{getSelection().isCollapsed&&On.current.focus()};return rn.addEventListener("click",Rr),()=>{rn.removeEventListener("click",Rr)}}},[oe]);const Yn=(rn,Rr)=>{rn?fe&&fe(Rr):Ae&&Ae(Rr),fn||(br(u?null:rr.clientWidth),wn(rn))},Ot=rn=>{rn.button===0&&(rn.preventDefault(),On.current.focus(),Yn(!0,rn))},Sr=rn=>{Yn(!1,rn)},fi=se.Children.toArray(s),Wr=rn=>{const Rr=fi.find($r=>$r.props.value===rn.target.value);Rr!==void 0&&(nn(Rr.props.value),De&&De(rn,Rr))},Mn=rn=>Rr=>{let $r;if(Rr.currentTarget.hasAttribute("tabindex")){if(me){$r=Array.isArray(it)?it.slice():[];const Nr=it.indexOf(rn.props.value);Nr===-1?$r.push(rn.props.value):$r.splice(Nr,1)}else $r=rn.props.value;if(rn.props.onClick&&rn.props.onClick(Rr),it!==$r&&(nn($r),De)){const Nr=Rr.nativeEvent||Rr,ri=new Nr.constructor(Nr.type,Nr);Object.defineProperty(ri,"target",{writable:!0,value:{value:$r,name:pe}}),De(ri,rn)}me||Yn(!1,Rr)}},jt=rn=>{ue||[" ","ArrowUp","ArrowDown","Enter"].includes(rn.key)&&(rn.preventDefault(),Yn(!0,rn))},Ln=cr!==null&&In,un=rn=>{!Ln&&_e&&(Object.defineProperty(rn,"target",{writable:!0,value:{value:it,name:pe}}),_e(rn))};delete wt["aria-invalid"];let Xn,Ni;const Bn=[];let Es=!1;(PI({value:it})||W)&&(Ie?Xn=Ie(it):Es=!0);const Si=fi.map(rn=>{if(!se.isValidElement(rn))return null;let Rr;if(me){if(!Array.isArray(it))throw new Error(Of(2));Rr=it.some($r=>HH($r,rn.props.value)),Rr&&Es&&Bn.push(rn.props.children)}else Rr=HH(it,rn.props.value),Rr&&Es&&(Ni=rn.props.children);return se.cloneElement(rn,{"aria-selected":Rr?"true":"false",onClick:Mn(rn),onKeyUp:$r=>{$r.key===" "&&$r.preventDefault(),rn.props.onKeyUp&&rn.props.onKeyUp($r)},role:"option",selected:Rr,value:void 0,"data-value":rn.props.value})});Es&&(me?Bn.length===0?Xn=null:Xn=Bn.reduce((rn,Rr,$r)=>(rn.push(Rr),$r<Bn.length-1&&rn.push(", "),rn),[]):Xn=Ni);let cs=ur;!u&&fn&&cr&&(cs=rr.clientWidth);let Oi;typeof ft<"u"?Oi=ft:Oi=F?null:0;const mn=ze.id||(pe?`mui-component-select-${pe}`:void 0),hr={...e,variant:Nt,value:it,open:Ln,error:K},Tr=VNe(hr),Li={...ae.PaperProps,...ae.slotProps?.paper},pi=BR();return R.jsxs(se.Fragment,{children:[R.jsx(FNe,{as:"div",ref:jn,tabIndex:Oi,role:"combobox","aria-controls":Ln?pi:void 0,"aria-disabled":F?"true":void 0,"aria-expanded":Ln?"true":"false","aria-haspopup":"listbox","aria-label":i,"aria-labelledby":[oe,mn].filter(Boolean).join(" ")||void 0,"aria-describedby":r,"aria-required":Oe?"true":void 0,"aria-invalid":K?"true":void 0,onKeyDown:jt,onMouseDown:F||ue?null:Ot,onBlur:un,onFocus:re,...ze,ownerState:hr,className:Fr(ze.className,Tr.select,v),id:mn,children:jNe(Xn)?UH||(UH=R.jsx("span",{className:"notranslate","aria-hidden":!0,children:""})):Xn}),R.jsx(zNe,{"aria-invalid":K,value:Array.isArray(it)?it.join(","):it,name:pe,ref:Xt,"aria-hidden":!0,onChange:Wr,tabIndex:-1,disabled:F,className:Tr.nativeInput,autoFocus:l,required:Oe,...wt,ownerState:hr}),R.jsx(BNe,{as:Q,className:Tr.icon,ownerState:hr}),R.jsx(SNe,{id:`menu-${pe||""}`,anchorEl:rr,open:Ln,onClose:Sr,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...ae,slotProps:{...ae.slotProps,list:{"aria-labelledby":oe,role:"listbox","aria-multiselectable":me?"true":void 0,disableListWrap:!0,id:pi,...ae.MenuListProps},paper:{...Li,style:{minWidth:cs,...Li!=null?Li.style:null}}},children:Si})]})}),HNe=t=>{const{classes:e}=t,r=ts({root:["root"]},mte,e);return{...e,...r}},UF={name:"MuiSelect",overridesResolver:(t,e)=>e.root,shouldForwardProp:t=>Hh(t)&&t!=="variant",slot:"Root"},WNe=pr(zF,UF)(""),$Ne=pr(VF,UF)(""),qNe=pr(BF,UF)(""),gte=se.forwardRef(function(e,n){const r=ls({name:"MuiSelect",props:e}),{autoWidth:i=!1,children:l,classes:u={},className:s,defaultOpen:v=!1,displayEmpty:w=!1,IconComponent:A=S3e,id:F,input:W,inputProps:K,label:Q,labelId:Z,MenuProps:oe,multiple:ae=!1,native:me=!1,onClose:pe,onOpen:_e,open:De,renderValue:Ae,SelectDisplayProps:re,variant:fe="outlined",...ye}=r,ue=me?RNe:UNe,Ie=Bx(),Oe=Fx({props:r,muiFormControl:Ie,states:["variant","error"]}),ze=Oe.variant||fe,ft={...r,variant:ze,classes:u},He=HNe(ft),{root:bt,...Nt}=He,wt=W||{standard:R.jsx(WNe,{ownerState:ft}),outlined:R.jsx($Ne,{label:Q,ownerState:ft}),filled:R.jsx(qNe,{ownerState:ft})}[ze],it=xc(n,D2(wt));return R.jsx(se.Fragment,{children:se.cloneElement(wt,{inputComponent:ue,inputProps:{children:l,error:Oe.error,IconComponent:A,variant:ze,type:void 0,multiple:ae,...me?{id:F}:{autoWidth:i,defaultOpen:v,displayEmpty:w,labelId:Z,MenuProps:oe,onClose:pe,onOpen:_e,open:De,renderValue:Ae,SelectDisplayProps:{id:F,...re}},...K,classes:K?ec(Nt,K.classes):Nt,...W?W.props.inputProps:{}},...(ae&&me||w)&&ze==="outlined"?{notched:!0}:{},ref:it,className:Fr(wt.props.className,s,He.root),...!W&&{variant:ze},...ye})})});gte.muiName="Select";const $R=se.createContext({}),HF=se.createContext({});function GNe(t){return es("MuiStep",t)}as("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const YNe=t=>{const{classes:e,orientation:n,alternativeLabel:r,completed:i}=t;return ts({root:["root",n,r&&"alternativeLabel",i&&"completed"]},GNe,e)},XNe=pr("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.orientation],n.alternativeLabel&&e.alternativeLabel,n.completed&&e.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),yT=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiStep"}),{active:i,children:l,className:u,component:s="div",completed:v,disabled:w,expanded:A=!1,index:F,last:W,...K}=r,{activeStep:Q,connector:Z,alternativeLabel:oe,orientation:ae,nonLinear:me}=se.useContext($R);let[pe=!1,_e=!1,De=!1]=[i,v,w];Q===F?pe=i!==void 0?i:!0:!me&&Q>F?_e=v!==void 0?v:!0:!me&&Q<F&&(De=w!==void 0?w:!0);const Ae=se.useMemo(()=>({index:F,last:W,expanded:A,icon:F+1,active:pe,completed:_e,disabled:De}),[F,W,A,pe,_e,De]),re={...r,active:pe,orientation:ae,alternativeLabel:oe,completed:_e,disabled:De,expanded:A,component:s},fe=YNe(re),ye=R.jsxs(XNe,{as:s,className:Fr(fe.root,u),ref:n,ownerState:re,...K,children:[Z&&oe&&F!==0?Z:null,l]});return R.jsx(HF.Provider,{value:Ae,children:Z&&!oe&&F!==0?R.jsxs(se.Fragment,{children:[Z,ye]}):ye})}),KNe=jR(R.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),ZNe=jR(R.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function QNe(t){return es("MuiStepIcon",t)}const y3=as("MuiStepIcon",["root","active","completed","error","text"]);var WH;const JNe=t=>{const{classes:e,active:n,completed:r,error:i}=t;return ts({root:["root",n&&"active",r&&"completed",i&&"error"],text:["text"]},QNe,e)},x3=pr(II,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,e)=>e.root})(ro(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${y3.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${y3.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${y3.error}`]:{color:(t.vars||t).palette.error.main}}))),eOe=pr("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,e)=>e.text})(ro(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),tOe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiStepIcon"}),{active:i=!1,className:l,completed:u=!1,error:s=!1,icon:v,...w}=r,A={...r,active:i,completed:u,error:s},F=JNe(A);if(typeof v=="number"||typeof v=="string"){const W=Fr(l,F.root);return s?R.jsx(x3,{as:ZNe,className:W,ref:n,ownerState:A,...w}):u?R.jsx(x3,{as:KNe,className:W,ref:n,ownerState:A,...w}):R.jsxs(x3,{className:W,ref:n,ownerState:A,...w,children:[WH||(WH=R.jsx("circle",{cx:"12",cy:"12",r:"12"})),R.jsx(eOe,{className:F.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:A,children:v})]})}return v});function nOe(t){return es("MuiStepLabel",t)}const Xp=as("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),rOe=t=>{const{classes:e,orientation:n,active:r,completed:i,error:l,disabled:u,alternativeLabel:s}=t;return ts({root:["root",n,l&&"error",u&&"disabled",s&&"alternativeLabel"],label:["label",r&&"active",i&&"completed",l&&"error",u&&"disabled",s&&"alternativeLabel"],iconContainer:["iconContainer",r&&"active",i&&"completed",l&&"error",u&&"disabled",s&&"alternativeLabel"],labelContainer:["labelContainer",s&&"alternativeLabel"]},nOe,e)},iOe=pr("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.orientation]]}})({display:"flex",alignItems:"center",[`&.${Xp.alternativeLabel}`]:{flexDirection:"column"},[`&.${Xp.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),sOe=pr("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,e)=>e.label})(ro(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${Xp.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Xp.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Xp.alternativeLabel}`]:{marginTop:16},[`&.${Xp.error}`]:{color:(t.vars||t).palette.error.main}}))),oOe=pr("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,e)=>e.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${Xp.alternativeLabel}`]:{paddingRight:0}}),aOe=pr("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,e)=>e.labelContainer})(ro(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${Xp.alternativeLabel}`]:{textAlign:"center"}}))),gb=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiStepLabel"}),{children:i,className:l,componentsProps:u={},error:s=!1,icon:v,optional:w,slots:A={},slotProps:F={},StepIconComponent:W,StepIconProps:K,...Q}=r,{alternativeLabel:Z,orientation:oe}=se.useContext($R),{active:ae,disabled:me,completed:pe,icon:_e}=se.useContext(HF),De=v||_e;let Ae=W;De&&!Ae&&(Ae=tOe);const re={...r,active:ae,alternativeLabel:Z,completed:pe,disabled:me,error:s,orientation:oe},fe=rOe(re),ye={slots:A,slotProps:{stepIcon:K,...u,...F}},[ue,Ie]=Wo("root",{elementType:iOe,externalForwardedProps:{...ye,...Q},ownerState:re,ref:n,className:Fr(fe.root,l)}),[Oe,ze]=Wo("label",{elementType:sOe,externalForwardedProps:ye,ownerState:re}),[ft,He]=Wo("stepIcon",{elementType:Ae,externalForwardedProps:ye,ownerState:re});return R.jsxs(ue,{...Ie,children:[De||ft?R.jsx(oOe,{className:fe.iconContainer,ownerState:re,children:R.jsx(ft,{completed:pe,active:ae,error:s,icon:De,...He})}):null,R.jsxs(aOe,{className:fe.labelContainer,ownerState:re,children:[i?R.jsx(Oe,{...ze,className:Fr(fe.label,ze?.className),children:i}):null,w]})]})});gb.muiName="StepLabel";function lOe(t){return es("MuiStepConnector",t)}as("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const cOe=t=>{const{classes:e,orientation:n,alternativeLabel:r,active:i,completed:l,disabled:u}=t,s={root:["root",n,r&&"alternativeLabel",i&&"active",l&&"completed",u&&"disabled"],line:["line",`line${or(n)}`]};return ts(s,lOe,e)},uOe=pr("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.orientation],n.alternativeLabel&&e.alternativeLabel,n.completed&&e.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),hOe=pr("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.line,e[`line${or(n.orientation)}`]]}})(ro(({theme:t})=>{const e=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:e,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),dOe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiStepConnector"}),{className:i,...l}=r,{alternativeLabel:u,orientation:s="horizontal"}=se.useContext($R),{active:v,disabled:w,completed:A}=se.useContext(HF),F={...r,alternativeLabel:u,orientation:s,active:v,completed:A,disabled:w},W=cOe(F);return R.jsx(uOe,{className:Fr(W.root,i),ref:n,ownerState:F,...l,children:R.jsx(hOe,{className:W.line,ownerState:F})})});function fOe(t){return es("MuiStepper",t)}as("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const pOe=t=>{const{orientation:e,nonLinear:n,alternativeLabel:r,classes:i}=t;return ts({root:["root",e,n&&"nonLinear",r&&"alternativeLabel"]},fOe,i)},mOe=pr("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.orientation],n.alternativeLabel&&e.alternativeLabel,n.nonLinear&&e.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),gOe=R.jsx(dOe,{}),_Oe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiStepper"}),{activeStep:i=0,alternativeLabel:l=!1,children:u,className:s,component:v="div",connector:w=gOe,nonLinear:A=!1,orientation:F="horizontal",...W}=r,K={...r,nonLinear:A,alternativeLabel:l,orientation:F,component:v},Q=pOe(K),Z=se.Children.toArray(u).filter(Boolean),oe=Z.map((me,pe)=>se.cloneElement(me,{index:pe,last:pe+1===Z.length,...me.props})),ae=se.useMemo(()=>({activeStep:i,alternativeLabel:l,connector:w,nonLinear:A,orientation:F}),[i,l,w,A,F]);return R.jsx($R.Provider,{value:ae,children:R.jsx(mOe,{as:v,ownerState:K,className:Fr(Q.root,s),ref:n,...W,children:oe})})});function yOe(t){return es("MuiTextField",t)}as("MuiTextField",["root"]);const xOe={standard:zF,filled:BF,outlined:VF},vOe=t=>{const{classes:e}=t;return ts({root:["root"]},yOe,e)},bOe=pr(Hke,{name:"MuiTextField",slot:"Root",overridesResolver:(t,e)=>e.root})({}),wOe=se.forwardRef(function(e,n){const r=ls({props:e,name:"MuiTextField"}),{autoComplete:i,autoFocus:l=!1,children:u,className:s,color:v="primary",defaultValue:w,disabled:A=!1,error:F=!1,FormHelperTextProps:W,fullWidth:K=!1,helperText:Q,id:Z,InputLabelProps:oe,inputProps:ae,InputProps:me,inputRef:pe,label:_e,maxRows:De,minRows:Ae,multiline:re=!1,name:fe,onBlur:ye,onChange:ue,onFocus:Ie,placeholder:Oe,required:ze=!1,rows:ft,select:He=!1,SelectProps:bt,slots:Nt={},slotProps:wt={},type:it,value:nn,variant:In="outlined",...wn}=r,Xt={...r,autoFocus:l,color:v,disabled:A,error:F,fullWidth:K,multiline:re,required:ze,select:He,variant:In},On=vOe(Xt),cr=BR(Z),En=Q&&cr?`${cr}-helper-text`:void 0,fn=_e&&cr?`${cr}-label`:void 0,ur=xOe[In],br={slots:Nt,slotProps:{input:me,inputLabel:oe,htmlInput:ae,formHelperText:W,select:bt,...wt}},Pe={},jn=br.slotProps.inputLabel;In==="outlined"&&(jn&&typeof jn.shrink<"u"&&(Pe.notched=jn.shrink),Pe.label=_e),He&&((!bt||!bt.native)&&(Pe.id=void 0),Pe["aria-describedby"]=void 0);const[rr,Yn]=Wo("root",{elementType:bOe,shouldForwardComponentProp:!0,externalForwardedProps:{...br,...wn},ownerState:Xt,className:Fr(On.root,s),ref:n,additionalProps:{disabled:A,error:F,fullWidth:K,required:ze,color:v,variant:In}}),[Ot,Sr]=Wo("input",{elementType:ur,externalForwardedProps:br,additionalProps:Pe,ownerState:Xt}),[fi,Wr]=Wo("inputLabel",{elementType:oNe,externalForwardedProps:br,ownerState:Xt}),[Mn,jt]=Wo("htmlInput",{elementType:"input",externalForwardedProps:br,ownerState:Xt}),[Ln,un]=Wo("formHelperText",{elementType:Gke,externalForwardedProps:br,ownerState:Xt}),[Xn,Ni]=Wo("select",{elementType:gte,externalForwardedProps:br,ownerState:Xt}),Bn=R.jsx(Ot,{"aria-describedby":En,autoComplete:i,autoFocus:l,defaultValue:w,fullWidth:K,multiline:re,name:fe,rows:ft,maxRows:De,minRows:Ae,type:it,value:nn,id:cr,inputRef:pe,onBlur:ye,onChange:ue,onFocus:Ie,placeholder:Oe,inputProps:jt,slots:{input:Nt.htmlInput?Mn:void 0},...Sr});return R.jsxs(rr,{...Yn,children:[_e!=null&&_e!==""&&R.jsx(fi,{htmlFor:cr,id:fn,...Wr,children:_e}),He?R.jsx(Xn,{"aria-describedby":En,id:cr,labelId:fn,value:nn,input:Bn,...Ni,children:u}):Bn,Q&&R.jsx(Ln,{id:En,...un,children:Q})]})}),EOe=()=>{const{user:t}=Yo(),{toast:e}=wc(),[n,r]=se.useState([]),[i,l]=se.useState(!0),[u,s]=se.useState(null),[v,w]=se.useState(null),[A,F]=se.useState(!1),[W,K]=se.useState("");se.useEffect(()=>{t?.uid&&Q()},[t]);const Q=async()=>{try{l(!0),console.log("Volunteer UID in app:",t?.uid);const Ae=Td(ol,"distributions"),re=Ky(Ae,GC("volunteerId","==",t.uid)),fe=await xf(re);console.log("Found docs:",fe.docs.length),(await xf(Ae)).forEach(Ie=>{console.log("Distribution:",Ie.id,Ie.data())});const ue=[];for(const Ie of fe.docs){const Oe={id:Ie.id,...Ie.data(),createdAt:Ie.data().createdAt?.toDate()};if(Oe.requestId){const ze=yf(ol,"aidRequests",Oe.requestId),ft=await qk(ze);if(ft.exists()){const He=ft.data();ue.push({...Oe,aidType:He.aidType,quantity:He.quantity,requesterName:He.userName||"Anonymous",requesterEmail:He.userEmail})}}}console.log("Setting deliveries:",ue),r(ue)}catch(Ae){console.error("Error fetching deliveries:",Ae),s("Failed to load deliveries")}finally{l(!1)}},Z=Ae=>{w(Ae),K(""),F(!0)},oe=()=>{w(null),F(!1)},ae=async Ae=>{try{const re=yf(ol,"distributions",v.id);if(await YC(re,{status:Ae,deliveryNotes:W,updatedAt:bw()}),Ae==="delivered"){const fe=yf(ol,"aidRequests",v.requestId);await YC(fe,{status:"fulfilled",updatedAt:bw()})}r(fe=>fe.map(ye=>ye.id===v.id?{...ye,status:Ae,deliveryNotes:W}:ye)),e({title:"Status Updated",description:`Delivery status has been updated to ${Ae}.`}),oe()}catch(re){console.error("Error updating delivery status:",re),e({title:"Error",description:"Failed to update delivery status. Please try again.",variant:"destructive"})}},me=Ae=>Ae==="pending"?"assigned":Ae,pe=Ae=>{switch(Ae=me(Ae),Ae){case"assigned":return"info";case"picked-up":return"primary";case"in-transit":return"warning";case"delivered":return"success";default:return"default"}},_e=Ae=>{switch(Ae=me(Ae),Ae){case"assigned":return"Mark as Picked Up";case"picked-up":return"Start Delivery";case"in-transit":return"Complete Delivery";default:return""}},De=Ae=>{switch(Ae=me(Ae),Ae){case"assigned":return"picked-up";case"picked-up":return"in-transit";case"in-transit":return"delivered";default:return Ae}};return i?R.jsx(Hv,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:R.jsx(ote,{})}):u?R.jsx(Hv,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:R.jsx($l,{color:"error",children:u})}):R.jsxs(Hv,{sx:{p:3},children:[R.jsx($l,{variant:"h5",color:"white",component:"h2",gutterBottom:!0,children:"My Deliveries"}),R.jsx($l,{variant:"body1",color:"white",paragraph:!0,children:"View and manage your assigned aid deliveries."}),n.length===0?R.jsx(N2,{sx:{p:3,textAlign:"center"},children:R.jsx($l,{children:"You don't have any assigned deliveries at the moment."})}):R.jsx(LH,{container:!0,spacing:3,children:n.map(Ae=>R.jsx(LH,{item:!0,xs:12,md:6,children:R.jsxs(U3e,{children:[R.jsxs(K3e,{children:[R.jsxs(Hv,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[R.jsx($l,{variant:"h6",component:"div",children:Ae.aidType}),R.jsx(p3e,{label:Ae.status,color:pe(Ae.status)})]}),R.jsxs($l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[R.jsx("strong",{children:"Quantity:"})," ",Ae.quantity]}),R.jsxs($l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[R.jsx("strong",{children:"Pickup Location:"})," ",Ae.pickupLocation]}),R.jsxs($l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[R.jsx("strong",{children:"Delivery Location:"})," ",Ae.dropoffLocation]}),R.jsxs($l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[R.jsx("strong",{children:"Requester:"})," ",Ae.requesterName]}),Ae.estimatedPickupTime&&R.jsxs($l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[R.jsx("strong",{children:"Estimated Pickup:"})," ",Ae.estimatedPickupTime]}),Ae.notes&&R.jsxs($l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[R.jsx("strong",{children:"Notes:"})," ",Ae.notes]}),R.jsxs($l,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:["Assigned on: ",Ae.createdAt&&bEe(Ae.createdAt,"MMM d, yyyy")]})]}),R.jsx(q3e,{children:Ae.status!=="delivered"&&R.jsxs(f3,{variant:"contained",color:"primary",onClick:()=>Z(Ae),children:["Action ",_e(Ae.status)]})})]})},Ae.id))}),R.jsx(Eke,{open:A,onClose:oe,maxWidth:"sm",fullWidth:!0,children:v&&R.jsxs(R.Fragment,{children:[R.jsx(Lke,{children:"Update Delivery Status"}),R.jsxs(kke,{children:[R.jsx(Hv,{sx:{mt:2,mb:5},children:R.jsxs(_Oe,{activeStep:v.status==="assigned"?0:v.status==="picked-up"?1:v.status==="in-transit"?2:3,children:[R.jsx(yT,{children:R.jsx(gb,{children:"Assigned"})}),R.jsx(yT,{children:R.jsx(gb,{children:"Picked Up"})}),R.jsx(yT,{children:R.jsx(gb,{children:"In Transit"})}),R.jsx(yT,{children:R.jsx(gb,{children:"Delivered"})})]})}),R.jsx($l,{variant:"subtitle1",gutterBottom:!0,children:v.status==="assigned"?"Confirm Pickup":v.status==="picked-up"?"Start Delivery":"Complete Delivery"}),R.jsx($l,{variant:"body2",color:"text.secondary",paragraph:!0,children:v.status==="assigned"?"Please confirm that you have picked up the aid from the specified location.":v.status==="picked-up"?"Please confirm that you are now transporting the aid to the delivery location.":"Please confirm that you have delivered the aid to the recipient."}),R.jsx(wOe,{fullWidth:!0,id:"deliveryNotes",name:"deliveryNotes",label:"Delivery Notes",value:W,onChange:Ae=>K(Ae.target.value),multiline:!0,rows:3,placeholder:"Add any notes about the delivery process",sx:{mt:2}})]}),R.jsxs(Ike,{children:[R.jsx(f3,{onClick:oe,children:"Cancel"}),R.jsx(f3,{color:"primary",variant:"contained",onClick:()=>ae(De(v.status)),children:v.status==="assigned"?"Confirm Pickup":v.status==="picked-up"?"Start Delivery":"Complete Delivery"})]})]})})]})},SOe=()=>{const{user:t}=Yo();return!t||t.role!=="volunteer"?R.jsx(pm,{to:"/"}):R.jsxs(Z3e,{maxWidth:"lg",sx:{py:4},children:[R.jsx($l,{variant:"h4",color:"white",component:"h1",gutterBottom:!0,children:"My Deliveries"}),R.jsx(EOe,{})]})};var _te={exports:{}};(function(t,e){(function(n,r){t.exports=r()})($0,function(){var n,r,i;function l(s,v){if(!n)n=v;else if(!r)r=v;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",A={};n(A),i=v(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}l(["exports"],function(s){function v(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var w,A={},F={};function W(){if(w)return F;w=1,Object.defineProperty(F,"__esModule",{value:!0}),F.setMatrixArrayType=function(g){F.ARRAY_TYPE=o=g},F.toRadian=function(g){return g*f},F.equals=function(g,p){return Math.abs(g-p)<=d*Math.max(1,Math.abs(g),Math.abs(p))},F.RANDOM=F.ARRAY_TYPE=F.EPSILON=void 0;var d=1e-6;F.EPSILON=d;var o=typeof Float32Array<"u"?Float32Array:Array;F.ARRAY_TYPE=o;var c=Math.random;F.RANDOM=c;var f=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var g=0,p=arguments.length;p--;)g+=arguments[p]*arguments[p];return Math.sqrt(g)}),F}var K,Q={};function Z(){if(K)return Q;function d(p){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},d(p)}K=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.create=function(){var p=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p},Q.clone=function(p){var x=new o.ARRAY_TYPE(4);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x},Q.copy=function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p},Q.identity=function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p},Q.fromValues=function(p,x,I,D){var L=new o.ARRAY_TYPE(4);return L[0]=p,L[1]=x,L[2]=I,L[3]=D,L},Q.set=function(p,x,I,D,L){return p[0]=x,p[1]=I,p[2]=D,p[3]=L,p},Q.transpose=function(p,x){if(p===x){var I=x[1];p[1]=x[2],p[2]=I}else p[0]=x[0],p[1]=x[2],p[2]=x[1],p[3]=x[3];return p},Q.invert=function(p,x){var I=x[0],D=x[1],L=x[2],T=x[3],k=I*T-L*D;return k?(p[0]=T*(k=1/k),p[1]=-D*k,p[2]=-L*k,p[3]=I*k,p):null},Q.adjoint=function(p,x){var I=x[0];return p[0]=x[3],p[1]=-x[1],p[2]=-x[2],p[3]=I,p},Q.determinant=function(p){return p[0]*p[3]-p[2]*p[1]},Q.multiply=f,Q.rotate=function(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=Math.sin(I),O=Math.cos(I);return p[0]=D*O+T*z,p[1]=L*O+k*z,p[2]=D*-z+T*O,p[3]=L*-z+k*O,p},Q.scale=function(p,x,I){var D=x[1],L=x[2],T=x[3],k=I[0],z=I[1];return p[0]=x[0]*k,p[1]=D*k,p[2]=L*z,p[3]=T*z,p},Q.fromRotation=function(p,x){var I=Math.sin(x),D=Math.cos(x);return p[0]=D,p[1]=I,p[2]=-I,p[3]=D,p},Q.fromScaling=function(p,x){return p[0]=x[0],p[1]=0,p[2]=0,p[3]=x[1],p},Q.str=function(p){return"mat2("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+")"},Q.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3])},Q.LDU=function(p,x,I,D){return p[2]=D[2]/D[0],I[0]=D[0],I[1]=D[1],I[3]=D[3]-p[2]*I[1],[p,x,I]},Q.add=function(p,x,I){return p[0]=x[0]+I[0],p[1]=x[1]+I[1],p[2]=x[2]+I[2],p[3]=x[3]+I[3],p},Q.subtract=g,Q.exactEquals=function(p,x){return p[0]===x[0]&&p[1]===x[1]&&p[2]===x[2]&&p[3]===x[3]},Q.equals=function(p,x){var I=p[0],D=p[1],L=p[2],T=p[3],k=x[0],z=x[1],O=x[2],B=x[3];return Math.abs(I-k)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(k))&&Math.abs(D-z)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(z))&&Math.abs(L-O)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(O))&&Math.abs(T-B)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(B))},Q.multiplyScalar=function(p,x,I){return p[0]=x[0]*I,p[1]=x[1]*I,p[2]=x[2]*I,p[3]=x[3]*I,p},Q.multiplyScalarAndAdd=function(p,x,I,D){return p[0]=x[0]+I[0]*D,p[1]=x[1]+I[1]*D,p[2]=x[2]+I[2]*D,p[3]=x[3]+I[3]*D,p},Q.sub=Q.mul=void 0;var o=function(p,x){if(p&&p.__esModule)return p;if(p===null||d(p)!=="object"&&typeof p!="function")return{default:p};var I=c(void 0);if(I&&I.has(p))return I.get(p);var D={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var T in p)if(T!=="default"&&Object.prototype.hasOwnProperty.call(p,T)){var k=L?Object.getOwnPropertyDescriptor(p,T):null;k&&(k.get||k.set)?Object.defineProperty(D,T,k):D[T]=p[T]}return D.default=p,I&&I.set(p,D),D}(W());function c(p){if(typeof WeakMap!="function")return null;var x=new WeakMap,I=new WeakMap;return(c=function(D){return D?I:x})(p)}function f(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=I[0],O=I[1],B=I[2],U=I[3];return p[0]=D*z+T*O,p[1]=L*z+k*O,p[2]=D*B+T*U,p[3]=L*B+k*U,p}function g(p,x,I){return p[0]=x[0]-I[0],p[1]=x[1]-I[1],p[2]=x[2]-I[2],p[3]=x[3]-I[3],p}return Q.mul=f,Q.sub=g,Q}var oe,ae={};function me(){if(oe)return ae;function d(p){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},d(p)}oe=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.create=function(){var p=new o.ARRAY_TYPE(6);return o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0,p[4]=0,p[5]=0),p[0]=1,p[3]=1,p},ae.clone=function(p){var x=new o.ARRAY_TYPE(6);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x[4]=p[4],x[5]=p[5],x},ae.copy=function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[4]=x[4],p[5]=x[5],p},ae.identity=function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p[4]=0,p[5]=0,p},ae.fromValues=function(p,x,I,D,L,T){var k=new o.ARRAY_TYPE(6);return k[0]=p,k[1]=x,k[2]=I,k[3]=D,k[4]=L,k[5]=T,k},ae.set=function(p,x,I,D,L,T,k){return p[0]=x,p[1]=I,p[2]=D,p[3]=L,p[4]=T,p[5]=k,p},ae.invert=function(p,x){var I=x[0],D=x[1],L=x[2],T=x[3],k=x[4],z=x[5],O=I*T-D*L;return O?(p[0]=T*(O=1/O),p[1]=-D*O,p[2]=-L*O,p[3]=I*O,p[4]=(L*z-T*k)*O,p[5]=(D*k-I*z)*O,p):null},ae.determinant=function(p){return p[0]*p[3]-p[1]*p[2]},ae.multiply=f,ae.rotate=function(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=x[4],O=x[5],B=Math.sin(I),U=Math.cos(I);return p[0]=D*U+T*B,p[1]=L*U+k*B,p[2]=D*-B+T*U,p[3]=L*-B+k*U,p[4]=z,p[5]=O,p},ae.scale=function(p,x,I){var D=x[1],L=x[2],T=x[3],k=x[4],z=x[5],O=I[0],B=I[1];return p[0]=x[0]*O,p[1]=D*O,p[2]=L*B,p[3]=T*B,p[4]=k,p[5]=z,p},ae.translate=function(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=x[4],O=x[5],B=I[0],U=I[1];return p[0]=D,p[1]=L,p[2]=T,p[3]=k,p[4]=D*B+T*U+z,p[5]=L*B+k*U+O,p},ae.fromRotation=function(p,x){var I=Math.sin(x),D=Math.cos(x);return p[0]=D,p[1]=I,p[2]=-I,p[3]=D,p[4]=0,p[5]=0,p},ae.fromScaling=function(p,x){return p[0]=x[0],p[1]=0,p[2]=0,p[3]=x[1],p[4]=0,p[5]=0,p},ae.fromTranslation=function(p,x){return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p[4]=x[0],p[5]=x[1],p},ae.str=function(p){return"mat2d("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+")"},ae.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3],p[4],p[5],1)},ae.add=function(p,x,I){return p[0]=x[0]+I[0],p[1]=x[1]+I[1],p[2]=x[2]+I[2],p[3]=x[3]+I[3],p[4]=x[4]+I[4],p[5]=x[5]+I[5],p},ae.subtract=g,ae.multiplyScalar=function(p,x,I){return p[0]=x[0]*I,p[1]=x[1]*I,p[2]=x[2]*I,p[3]=x[3]*I,p[4]=x[4]*I,p[5]=x[5]*I,p},ae.multiplyScalarAndAdd=function(p,x,I,D){return p[0]=x[0]+I[0]*D,p[1]=x[1]+I[1]*D,p[2]=x[2]+I[2]*D,p[3]=x[3]+I[3]*D,p[4]=x[4]+I[4]*D,p[5]=x[5]+I[5]*D,p},ae.exactEquals=function(p,x){return p[0]===x[0]&&p[1]===x[1]&&p[2]===x[2]&&p[3]===x[3]&&p[4]===x[4]&&p[5]===x[5]},ae.equals=function(p,x){var I=p[0],D=p[1],L=p[2],T=p[3],k=p[4],z=p[5],O=x[0],B=x[1],U=x[2],X=x[3],J=x[4],ce=x[5];return Math.abs(I-O)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(O))&&Math.abs(D-B)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(B))&&Math.abs(L-U)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(U))&&Math.abs(T-X)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(X))&&Math.abs(k-J)<=o.EPSILON*Math.max(1,Math.abs(k),Math.abs(J))&&Math.abs(z-ce)<=o.EPSILON*Math.max(1,Math.abs(z),Math.abs(ce))},ae.sub=ae.mul=void 0;var o=function(p,x){if(p&&p.__esModule)return p;if(p===null||d(p)!=="object"&&typeof p!="function")return{default:p};var I=c(void 0);if(I&&I.has(p))return I.get(p);var D={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var T in p)if(T!=="default"&&Object.prototype.hasOwnProperty.call(p,T)){var k=L?Object.getOwnPropertyDescriptor(p,T):null;k&&(k.get||k.set)?Object.defineProperty(D,T,k):D[T]=p[T]}return D.default=p,I&&I.set(p,D),D}(W());function c(p){if(typeof WeakMap!="function")return null;var x=new WeakMap,I=new WeakMap;return(c=function(D){return D?I:x})(p)}function f(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=x[4],O=x[5],B=I[0],U=I[1],X=I[2],J=I[3],ce=I[4],le=I[5];return p[0]=D*B+T*U,p[1]=L*B+k*U,p[2]=D*X+T*J,p[3]=L*X+k*J,p[4]=D*ce+T*le+z,p[5]=L*ce+k*le+O,p}function g(p,x,I){return p[0]=x[0]-I[0],p[1]=x[1]-I[1],p[2]=x[2]-I[2],p[3]=x[3]-I[3],p[4]=x[4]-I[4],p[5]=x[5]-I[5],p}return ae.mul=f,ae.sub=g,ae}var pe,_e={};function De(){if(pe)return _e;function d(p){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},d(p)}pe=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.create=function(){var p=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0),p[0]=1,p[4]=1,p[8]=1,p},_e.fromMat4=function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[4],p[4]=x[5],p[5]=x[6],p[6]=x[8],p[7]=x[9],p[8]=x[10],p},_e.clone=function(p){var x=new o.ARRAY_TYPE(9);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x[4]=p[4],x[5]=p[5],x[6]=p[6],x[7]=p[7],x[8]=p[8],x},_e.copy=function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[4]=x[4],p[5]=x[5],p[6]=x[6],p[7]=x[7],p[8]=x[8],p},_e.fromValues=function(p,x,I,D,L,T,k,z,O){var B=new o.ARRAY_TYPE(9);return B[0]=p,B[1]=x,B[2]=I,B[3]=D,B[4]=L,B[5]=T,B[6]=k,B[7]=z,B[8]=O,B},_e.set=function(p,x,I,D,L,T,k,z,O,B){return p[0]=x,p[1]=I,p[2]=D,p[3]=L,p[4]=T,p[5]=k,p[6]=z,p[7]=O,p[8]=B,p},_e.identity=function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=1,p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},_e.transpose=function(p,x){if(p===x){var I=x[1],D=x[2],L=x[5];p[1]=x[3],p[2]=x[6],p[3]=I,p[5]=x[7],p[6]=D,p[7]=L}else p[0]=x[0],p[1]=x[3],p[2]=x[6],p[3]=x[1],p[4]=x[4],p[5]=x[7],p[6]=x[2],p[7]=x[5],p[8]=x[8];return p},_e.invert=function(p,x){var I=x[0],D=x[1],L=x[2],T=x[3],k=x[4],z=x[5],O=x[6],B=x[7],U=x[8],X=U*k-z*B,J=-U*T+z*O,ce=B*T-k*O,le=I*X+D*J+L*ce;return le?(p[0]=X*(le=1/le),p[1]=(-U*D+L*B)*le,p[2]=(z*D-L*k)*le,p[3]=J*le,p[4]=(U*I-L*O)*le,p[5]=(-z*I+L*T)*le,p[6]=ce*le,p[7]=(-B*I+D*O)*le,p[8]=(k*I-D*T)*le,p):null},_e.adjoint=function(p,x){var I=x[0],D=x[1],L=x[2],T=x[3],k=x[4],z=x[5],O=x[6],B=x[7],U=x[8];return p[0]=k*U-z*B,p[1]=L*B-D*U,p[2]=D*z-L*k,p[3]=z*O-T*U,p[4]=I*U-L*O,p[5]=L*T-I*z,p[6]=T*B-k*O,p[7]=D*O-I*B,p[8]=I*k-D*T,p},_e.determinant=function(p){var x=p[3],I=p[4],D=p[5],L=p[6],T=p[7],k=p[8];return p[0]*(k*I-D*T)+p[1]*(-k*x+D*L)+p[2]*(T*x-I*L)},_e.multiply=f,_e.translate=function(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=x[4],O=x[5],B=x[6],U=x[7],X=x[8],J=I[0],ce=I[1];return p[0]=D,p[1]=L,p[2]=T,p[3]=k,p[4]=z,p[5]=O,p[6]=J*D+ce*k+B,p[7]=J*L+ce*z+U,p[8]=J*T+ce*O+X,p},_e.rotate=function(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=x[4],O=x[5],B=x[6],U=x[7],X=x[8],J=Math.sin(I),ce=Math.cos(I);return p[0]=ce*D+J*k,p[1]=ce*L+J*z,p[2]=ce*T+J*O,p[3]=ce*k-J*D,p[4]=ce*z-J*L,p[5]=ce*O-J*T,p[6]=B,p[7]=U,p[8]=X,p},_e.scale=function(p,x,I){var D=I[0],L=I[1];return p[0]=D*x[0],p[1]=D*x[1],p[2]=D*x[2],p[3]=L*x[3],p[4]=L*x[4],p[5]=L*x[5],p[6]=x[6],p[7]=x[7],p[8]=x[8],p},_e.fromTranslation=function(p,x){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=1,p[5]=0,p[6]=x[0],p[7]=x[1],p[8]=1,p},_e.fromRotation=function(p,x){var I=Math.sin(x),D=Math.cos(x);return p[0]=D,p[1]=I,p[2]=0,p[3]=-I,p[4]=D,p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},_e.fromScaling=function(p,x){return p[0]=x[0],p[1]=0,p[2]=0,p[3]=0,p[4]=x[1],p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},_e.fromMat2d=function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=0,p[3]=x[2],p[4]=x[3],p[5]=0,p[6]=x[4],p[7]=x[5],p[8]=1,p},_e.fromQuat=function(p,x){var I=x[0],D=x[1],L=x[2],T=x[3],k=I+I,z=D+D,O=L+L,B=I*k,U=D*k,X=D*z,J=L*k,ce=L*z,le=L*O,ie=T*k,ge=T*z,be=T*O;return p[0]=1-X-le,p[3]=U-be,p[6]=J+ge,p[1]=U+be,p[4]=1-B-le,p[7]=ce-ie,p[2]=J-ge,p[5]=ce+ie,p[8]=1-B-X,p},_e.normalFromMat4=function(p,x){var I=x[0],D=x[1],L=x[2],T=x[3],k=x[4],z=x[5],O=x[6],B=x[7],U=x[8],X=x[9],J=x[10],ce=x[11],le=x[12],ie=x[13],ge=x[14],be=x[15],Se=I*z-D*k,Ve=I*O-L*k,Le=I*B-T*k,Be=D*O-L*z,Qe=D*B-T*z,Ue=L*B-T*O,Je=U*ie-X*le,lt=U*ge-J*le,st=U*be-ce*le,mt=X*ge-J*ie,pt=X*be-ce*ie,vt=J*be-ce*ge,_t=Se*vt-Ve*pt+Le*mt+Be*st-Qe*lt+Ue*Je;return _t?(p[0]=(z*vt-O*pt+B*mt)*(_t=1/_t),p[1]=(O*st-k*vt-B*lt)*_t,p[2]=(k*pt-z*st+B*Je)*_t,p[3]=(L*pt-D*vt-T*mt)*_t,p[4]=(I*vt-L*st+T*lt)*_t,p[5]=(D*st-I*pt-T*Je)*_t,p[6]=(ie*Ue-ge*Qe+be*Be)*_t,p[7]=(ge*Le-le*Ue-be*Ve)*_t,p[8]=(le*Qe-ie*Le+be*Se)*_t,p):null},_e.projection=function(p,x,I){return p[0]=2/x,p[1]=0,p[2]=0,p[3]=0,p[4]=-2/I,p[5]=0,p[6]=-1,p[7]=1,p[8]=1,p},_e.str=function(p){return"mat3("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+", "+p[6]+", "+p[7]+", "+p[8]+")"},_e.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8])},_e.add=function(p,x,I){return p[0]=x[0]+I[0],p[1]=x[1]+I[1],p[2]=x[2]+I[2],p[3]=x[3]+I[3],p[4]=x[4]+I[4],p[5]=x[5]+I[5],p[6]=x[6]+I[6],p[7]=x[7]+I[7],p[8]=x[8]+I[8],p},_e.subtract=g,_e.multiplyScalar=function(p,x,I){return p[0]=x[0]*I,p[1]=x[1]*I,p[2]=x[2]*I,p[3]=x[3]*I,p[4]=x[4]*I,p[5]=x[5]*I,p[6]=x[6]*I,p[7]=x[7]*I,p[8]=x[8]*I,p},_e.multiplyScalarAndAdd=function(p,x,I,D){return p[0]=x[0]+I[0]*D,p[1]=x[1]+I[1]*D,p[2]=x[2]+I[2]*D,p[3]=x[3]+I[3]*D,p[4]=x[4]+I[4]*D,p[5]=x[5]+I[5]*D,p[6]=x[6]+I[6]*D,p[7]=x[7]+I[7]*D,p[8]=x[8]+I[8]*D,p},_e.exactEquals=function(p,x){return p[0]===x[0]&&p[1]===x[1]&&p[2]===x[2]&&p[3]===x[3]&&p[4]===x[4]&&p[5]===x[5]&&p[6]===x[6]&&p[7]===x[7]&&p[8]===x[8]},_e.equals=function(p,x){var I=p[0],D=p[1],L=p[2],T=p[3],k=p[4],z=p[5],O=p[6],B=p[7],U=p[8],X=x[0],J=x[1],ce=x[2],le=x[3],ie=x[4],ge=x[5],be=x[6],Se=x[7],Ve=x[8];return Math.abs(I-X)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(X))&&Math.abs(D-J)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(J))&&Math.abs(L-ce)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(ce))&&Math.abs(T-le)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(le))&&Math.abs(k-ie)<=o.EPSILON*Math.max(1,Math.abs(k),Math.abs(ie))&&Math.abs(z-ge)<=o.EPSILON*Math.max(1,Math.abs(z),Math.abs(ge))&&Math.abs(O-be)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(be))&&Math.abs(B-Se)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(Se))&&Math.abs(U-Ve)<=o.EPSILON*Math.max(1,Math.abs(U),Math.abs(Ve))},_e.sub=_e.mul=void 0;var o=function(p,x){if(p&&p.__esModule)return p;if(p===null||d(p)!=="object"&&typeof p!="function")return{default:p};var I=c(void 0);if(I&&I.has(p))return I.get(p);var D={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var T in p)if(T!=="default"&&Object.prototype.hasOwnProperty.call(p,T)){var k=L?Object.getOwnPropertyDescriptor(p,T):null;k&&(k.get||k.set)?Object.defineProperty(D,T,k):D[T]=p[T]}return D.default=p,I&&I.set(p,D),D}(W());function c(p){if(typeof WeakMap!="function")return null;var x=new WeakMap,I=new WeakMap;return(c=function(D){return D?I:x})(p)}function f(p,x,I){var D=x[0],L=x[1],T=x[2],k=x[3],z=x[4],O=x[5],B=x[6],U=x[7],X=x[8],J=I[0],ce=I[1],le=I[2],ie=I[3],ge=I[4],be=I[5],Se=I[6],Ve=I[7],Le=I[8];return p[0]=J*D+ce*k+le*B,p[1]=J*L+ce*z+le*U,p[2]=J*T+ce*O+le*X,p[3]=ie*D+ge*k+be*B,p[4]=ie*L+ge*z+be*U,p[5]=ie*T+ge*O+be*X,p[6]=Se*D+Ve*k+Le*B,p[7]=Se*L+Ve*z+Le*U,p[8]=Se*T+Ve*O+Le*X,p}function g(p,x,I){return p[0]=x[0]-I[0],p[1]=x[1]-I[1],p[2]=x[2]-I[2],p[3]=x[3]-I[3],p[4]=x[4]-I[4],p[5]=x[5]-I[5],p[6]=x[6]-I[6],p[7]=x[7]-I[7],p[8]=x[8]-I[8],p}return _e.mul=f,_e.sub=g,_e}var Ae,re={};function fe(){if(Ae)return re;function d(T){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},d(T)}Ae=1,Object.defineProperty(re,"__esModule",{value:!0}),re.create=function(){var T=new o.ARRAY_TYPE(16);return o.ARRAY_TYPE!=Float32Array&&(T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[11]=0,T[12]=0,T[13]=0,T[14]=0),T[0]=1,T[5]=1,T[10]=1,T[15]=1,T},re.clone=function(T){var k=new o.ARRAY_TYPE(16);return k[0]=T[0],k[1]=T[1],k[2]=T[2],k[3]=T[3],k[4]=T[4],k[5]=T[5],k[6]=T[6],k[7]=T[7],k[8]=T[8],k[9]=T[9],k[10]=T[10],k[11]=T[11],k[12]=T[12],k[13]=T[13],k[14]=T[14],k[15]=T[15],k},re.copy=function(T,k){return T[0]=k[0],T[1]=k[1],T[2]=k[2],T[3]=k[3],T[4]=k[4],T[5]=k[5],T[6]=k[6],T[7]=k[7],T[8]=k[8],T[9]=k[9],T[10]=k[10],T[11]=k[11],T[12]=k[12],T[13]=k[13],T[14]=k[14],T[15]=k[15],T},re.fromValues=function(T,k,z,O,B,U,X,J,ce,le,ie,ge,be,Se,Ve,Le){var Be=new o.ARRAY_TYPE(16);return Be[0]=T,Be[1]=k,Be[2]=z,Be[3]=O,Be[4]=B,Be[5]=U,Be[6]=X,Be[7]=J,Be[8]=ce,Be[9]=le,Be[10]=ie,Be[11]=ge,Be[12]=be,Be[13]=Se,Be[14]=Ve,Be[15]=Le,Be},re.set=function(T,k,z,O,B,U,X,J,ce,le,ie,ge,be,Se,Ve,Le,Be){return T[0]=k,T[1]=z,T[2]=O,T[3]=B,T[4]=U,T[5]=X,T[6]=J,T[7]=ce,T[8]=le,T[9]=ie,T[10]=ge,T[11]=be,T[12]=Se,T[13]=Ve,T[14]=Le,T[15]=Be,T},re.identity=f,re.transpose=function(T,k){if(T===k){var z=k[1],O=k[2],B=k[3],U=k[6],X=k[7],J=k[11];T[1]=k[4],T[2]=k[8],T[3]=k[12],T[4]=z,T[6]=k[9],T[7]=k[13],T[8]=O,T[9]=U,T[11]=k[14],T[12]=B,T[13]=X,T[14]=J}else T[0]=k[0],T[1]=k[4],T[2]=k[8],T[3]=k[12],T[4]=k[1],T[5]=k[5],T[6]=k[9],T[7]=k[13],T[8]=k[2],T[9]=k[6],T[10]=k[10],T[11]=k[14],T[12]=k[3],T[13]=k[7],T[14]=k[11],T[15]=k[15];return T},re.invert=function(T,k){var z=k[0],O=k[1],B=k[2],U=k[3],X=k[4],J=k[5],ce=k[6],le=k[7],ie=k[8],ge=k[9],be=k[10],Se=k[11],Ve=k[12],Le=k[13],Be=k[14],Qe=k[15],Ue=z*J-O*X,Je=z*ce-B*X,lt=z*le-U*X,st=O*ce-B*J,mt=O*le-U*J,pt=B*le-U*ce,vt=ie*Le-ge*Ve,_t=ie*Be-be*Ve,Et=ie*Qe-Se*Ve,qt=ge*Be-be*Le,Ht=ge*Qe-Se*Le,Cn=be*Qe-Se*Be,Qt=Ue*Cn-Je*Ht+lt*qt+st*Et-mt*_t+pt*vt;return Qt?(T[0]=(J*Cn-ce*Ht+le*qt)*(Qt=1/Qt),T[1]=(B*Ht-O*Cn-U*qt)*Qt,T[2]=(Le*pt-Be*mt+Qe*st)*Qt,T[3]=(be*mt-ge*pt-Se*st)*Qt,T[4]=(ce*Et-X*Cn-le*_t)*Qt,T[5]=(z*Cn-B*Et+U*_t)*Qt,T[6]=(Be*lt-Ve*pt-Qe*Je)*Qt,T[7]=(ie*pt-be*lt+Se*Je)*Qt,T[8]=(X*Ht-J*Et+le*vt)*Qt,T[9]=(O*Et-z*Ht-U*vt)*Qt,T[10]=(Ve*mt-Le*lt+Qe*Ue)*Qt,T[11]=(ge*lt-ie*mt-Se*Ue)*Qt,T[12]=(J*_t-X*qt-ce*vt)*Qt,T[13]=(z*qt-O*_t+B*vt)*Qt,T[14]=(Le*Je-Ve*st-Be*Ue)*Qt,T[15]=(ie*st-ge*Je+be*Ue)*Qt,T):null},re.adjoint=function(T,k){var z=k[0],O=k[1],B=k[2],U=k[3],X=k[4],J=k[5],ce=k[6],le=k[7],ie=k[8],ge=k[9],be=k[10],Se=k[11],Ve=k[12],Le=k[13],Be=k[14],Qe=k[15];return T[0]=J*(be*Qe-Se*Be)-ge*(ce*Qe-le*Be)+Le*(ce*Se-le*be),T[1]=-(O*(be*Qe-Se*Be)-ge*(B*Qe-U*Be)+Le*(B*Se-U*be)),T[2]=O*(ce*Qe-le*Be)-J*(B*Qe-U*Be)+Le*(B*le-U*ce),T[3]=-(O*(ce*Se-le*be)-J*(B*Se-U*be)+ge*(B*le-U*ce)),T[4]=-(X*(be*Qe-Se*Be)-ie*(ce*Qe-le*Be)+Ve*(ce*Se-le*be)),T[5]=z*(be*Qe-Se*Be)-ie*(B*Qe-U*Be)+Ve*(B*Se-U*be),T[6]=-(z*(ce*Qe-le*Be)-X*(B*Qe-U*Be)+Ve*(B*le-U*ce)),T[7]=z*(ce*Se-le*be)-X*(B*Se-U*be)+ie*(B*le-U*ce),T[8]=X*(ge*Qe-Se*Le)-ie*(J*Qe-le*Le)+Ve*(J*Se-le*ge),T[9]=-(z*(ge*Qe-Se*Le)-ie*(O*Qe-U*Le)+Ve*(O*Se-U*ge)),T[10]=z*(J*Qe-le*Le)-X*(O*Qe-U*Le)+Ve*(O*le-U*J),T[11]=-(z*(J*Se-le*ge)-X*(O*Se-U*ge)+ie*(O*le-U*J)),T[12]=-(X*(ge*Be-be*Le)-ie*(J*Be-ce*Le)+Ve*(J*be-ce*ge)),T[13]=z*(ge*Be-be*Le)-ie*(O*Be-B*Le)+Ve*(O*be-B*ge),T[14]=-(z*(J*Be-ce*Le)-X*(O*Be-B*Le)+Ve*(O*ce-B*J)),T[15]=z*(J*be-ce*ge)-X*(O*be-B*ge)+ie*(O*ce-B*J),T},re.determinant=function(T){var k=T[0],z=T[1],O=T[2],B=T[3],U=T[4],X=T[5],J=T[6],ce=T[7],le=T[8],ie=T[9],ge=T[10],be=T[11],Se=T[12],Ve=T[13],Le=T[14],Be=T[15];return(k*X-z*U)*(ge*Be-be*Le)-(k*J-O*U)*(ie*Be-be*Ve)+(k*ce-B*U)*(ie*Le-ge*Ve)+(z*J-O*X)*(le*Be-be*Se)-(z*ce-B*X)*(le*Le-ge*Se)+(O*ce-B*J)*(le*Ve-ie*Se)},re.multiply=g,re.translate=function(T,k,z){var O,B,U,X,J,ce,le,ie,ge,be,Se,Ve,Le=z[0],Be=z[1],Qe=z[2];return k===T?(T[12]=k[0]*Le+k[4]*Be+k[8]*Qe+k[12],T[13]=k[1]*Le+k[5]*Be+k[9]*Qe+k[13],T[14]=k[2]*Le+k[6]*Be+k[10]*Qe+k[14],T[15]=k[3]*Le+k[7]*Be+k[11]*Qe+k[15]):(B=k[1],U=k[2],X=k[3],J=k[4],ce=k[5],le=k[6],ie=k[7],ge=k[8],be=k[9],Se=k[10],Ve=k[11],T[0]=O=k[0],T[1]=B,T[2]=U,T[3]=X,T[4]=J,T[5]=ce,T[6]=le,T[7]=ie,T[8]=ge,T[9]=be,T[10]=Se,T[11]=Ve,T[12]=O*Le+J*Be+ge*Qe+k[12],T[13]=B*Le+ce*Be+be*Qe+k[13],T[14]=U*Le+le*Be+Se*Qe+k[14],T[15]=X*Le+ie*Be+Ve*Qe+k[15]),T},re.scale=function(T,k,z){var O=z[0],B=z[1],U=z[2];return T[0]=k[0]*O,T[1]=k[1]*O,T[2]=k[2]*O,T[3]=k[3]*O,T[4]=k[4]*B,T[5]=k[5]*B,T[6]=k[6]*B,T[7]=k[7]*B,T[8]=k[8]*U,T[9]=k[9]*U,T[10]=k[10]*U,T[11]=k[11]*U,T[12]=k[12],T[13]=k[13],T[14]=k[14],T[15]=k[15],T},re.rotate=function(T,k,z,O){var B,U,X,J,ce,le,ie,ge,be,Se,Ve,Le,Be,Qe,Ue,Je,lt,st,mt,pt,vt,_t,Et,qt,Ht=O[0],Cn=O[1],Qt=O[2],ln=Math.hypot(Ht,Cn,Qt);return ln<o.EPSILON?null:(Ht*=ln=1/ln,Cn*=ln,Qt*=ln,B=Math.sin(z),U=Math.cos(z),ce=k[1],le=k[2],ie=k[3],be=k[5],Se=k[6],Ve=k[7],Be=k[9],Qe=k[10],Ue=k[11],Je=Ht*Ht*(X=1-U)+U,mt=Ht*Cn*X-Qt*B,pt=Cn*Cn*X+U,vt=Qt*Cn*X+Ht*B,_t=Ht*Qt*X+Cn*B,Et=Cn*Qt*X-Ht*B,qt=Qt*Qt*X+U,T[0]=(J=k[0])*Je+(ge=k[4])*(lt=Cn*Ht*X+Qt*B)+(Le=k[8])*(st=Qt*Ht*X-Cn*B),T[1]=ce*Je+be*lt+Be*st,T[2]=le*Je+Se*lt+Qe*st,T[3]=ie*Je+Ve*lt+Ue*st,T[4]=J*mt+ge*pt+Le*vt,T[5]=ce*mt+be*pt+Be*vt,T[6]=le*mt+Se*pt+Qe*vt,T[7]=ie*mt+Ve*pt+Ue*vt,T[8]=J*_t+ge*Et+Le*qt,T[9]=ce*_t+be*Et+Be*qt,T[10]=le*_t+Se*Et+Qe*qt,T[11]=ie*_t+Ve*Et+Ue*qt,k!==T&&(T[12]=k[12],T[13]=k[13],T[14]=k[14],T[15]=k[15]),T)},re.rotateX=function(T,k,z){var O=Math.sin(z),B=Math.cos(z),U=k[4],X=k[5],J=k[6],ce=k[7],le=k[8],ie=k[9],ge=k[10],be=k[11];return k!==T&&(T[0]=k[0],T[1]=k[1],T[2]=k[2],T[3]=k[3],T[12]=k[12],T[13]=k[13],T[14]=k[14],T[15]=k[15]),T[4]=U*B+le*O,T[5]=X*B+ie*O,T[6]=J*B+ge*O,T[7]=ce*B+be*O,T[8]=le*B-U*O,T[9]=ie*B-X*O,T[10]=ge*B-J*O,T[11]=be*B-ce*O,T},re.rotateY=function(T,k,z){var O=Math.sin(z),B=Math.cos(z),U=k[0],X=k[1],J=k[2],ce=k[3],le=k[8],ie=k[9],ge=k[10],be=k[11];return k!==T&&(T[4]=k[4],T[5]=k[5],T[6]=k[6],T[7]=k[7],T[12]=k[12],T[13]=k[13],T[14]=k[14],T[15]=k[15]),T[0]=U*B-le*O,T[1]=X*B-ie*O,T[2]=J*B-ge*O,T[3]=ce*B-be*O,T[8]=U*O+le*B,T[9]=X*O+ie*B,T[10]=J*O+ge*B,T[11]=ce*O+be*B,T},re.rotateZ=function(T,k,z){var O=Math.sin(z),B=Math.cos(z),U=k[0],X=k[1],J=k[2],ce=k[3],le=k[4],ie=k[5],ge=k[6],be=k[7];return k!==T&&(T[8]=k[8],T[9]=k[9],T[10]=k[10],T[11]=k[11],T[12]=k[12],T[13]=k[13],T[14]=k[14],T[15]=k[15]),T[0]=U*B+le*O,T[1]=X*B+ie*O,T[2]=J*B+ge*O,T[3]=ce*B+be*O,T[4]=le*B-U*O,T[5]=ie*B-X*O,T[6]=ge*B-J*O,T[7]=be*B-ce*O,T},re.fromTranslation=function(T,k){return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=k[0],T[13]=k[1],T[14]=k[2],T[15]=1,T},re.fromScaling=function(T,k){return T[0]=k[0],T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=k[1],T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=k[2],T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T},re.fromRotation=function(T,k,z){var O,B,U,X=z[0],J=z[1],ce=z[2],le=Math.hypot(X,J,ce);return le<o.EPSILON?null:(X*=le=1/le,J*=le,ce*=le,O=Math.sin(k),B=Math.cos(k),T[0]=X*X*(U=1-B)+B,T[1]=J*X*U+ce*O,T[2]=ce*X*U-J*O,T[3]=0,T[4]=X*J*U-ce*O,T[5]=J*J*U+B,T[6]=ce*J*U+X*O,T[7]=0,T[8]=X*ce*U+J*O,T[9]=J*ce*U-X*O,T[10]=ce*ce*U+B,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T)},re.fromXRotation=function(T,k){var z=Math.sin(k),O=Math.cos(k);return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=O,T[6]=z,T[7]=0,T[8]=0,T[9]=-z,T[10]=O,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T},re.fromYRotation=function(T,k){var z=Math.sin(k),O=Math.cos(k);return T[0]=O,T[1]=0,T[2]=-z,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=z,T[9]=0,T[10]=O,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T},re.fromZRotation=function(T,k){var z=Math.sin(k),O=Math.cos(k);return T[0]=O,T[1]=z,T[2]=0,T[3]=0,T[4]=-z,T[5]=O,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T},re.fromRotationTranslation=p,re.fromQuat2=function(T,k){var z=new o.ARRAY_TYPE(3),O=-k[0],B=-k[1],U=-k[2],X=k[3],J=k[4],ce=k[5],le=k[6],ie=k[7],ge=O*O+B*B+U*U+X*X;return ge>0?(z[0]=2*(J*X+ie*O+ce*U-le*B)/ge,z[1]=2*(ce*X+ie*B+le*O-J*U)/ge,z[2]=2*(le*X+ie*U+J*B-ce*O)/ge):(z[0]=2*(J*X+ie*O+ce*U-le*B),z[1]=2*(ce*X+ie*B+le*O-J*U),z[2]=2*(le*X+ie*U+J*B-ce*O)),p(T,k,z),T},re.getTranslation=function(T,k){return T[0]=k[12],T[1]=k[13],T[2]=k[14],T},re.getScaling=x,re.getRotation=function(T,k){var z=new o.ARRAY_TYPE(3);x(z,k);var O=1/z[0],B=1/z[1],U=1/z[2],X=k[0]*O,J=k[1]*B,ce=k[2]*U,le=k[4]*O,ie=k[5]*B,ge=k[6]*U,be=k[8]*O,Se=k[9]*B,Ve=k[10]*U,Le=X+ie+Ve,Be=0;return Le>0?(Be=2*Math.sqrt(Le+1),T[3]=.25*Be,T[0]=(ge-Se)/Be,T[1]=(be-ce)/Be,T[2]=(J-le)/Be):X>ie&&X>Ve?(Be=2*Math.sqrt(1+X-ie-Ve),T[3]=(ge-Se)/Be,T[0]=.25*Be,T[1]=(J+le)/Be,T[2]=(be+ce)/Be):ie>Ve?(Be=2*Math.sqrt(1+ie-X-Ve),T[3]=(be-ce)/Be,T[0]=(J+le)/Be,T[1]=.25*Be,T[2]=(ge+Se)/Be):(Be=2*Math.sqrt(1+Ve-X-ie),T[3]=(J-le)/Be,T[0]=(be+ce)/Be,T[1]=(ge+Se)/Be,T[2]=.25*Be),T},re.fromRotationTranslationScale=function(T,k,z,O){var B=k[0],U=k[1],X=k[2],J=k[3],ce=B+B,le=U+U,ie=X+X,ge=B*ce,be=B*le,Se=B*ie,Ve=U*le,Le=U*ie,Be=X*ie,Qe=J*ce,Ue=J*le,Je=J*ie,lt=O[0],st=O[1],mt=O[2];return T[0]=(1-(Ve+Be))*lt,T[1]=(be+Je)*lt,T[2]=(Se-Ue)*lt,T[3]=0,T[4]=(be-Je)*st,T[5]=(1-(ge+Be))*st,T[6]=(Le+Qe)*st,T[7]=0,T[8]=(Se+Ue)*mt,T[9]=(Le-Qe)*mt,T[10]=(1-(ge+Ve))*mt,T[11]=0,T[12]=z[0],T[13]=z[1],T[14]=z[2],T[15]=1,T},re.fromRotationTranslationScaleOrigin=function(T,k,z,O,B){var U=k[0],X=k[1],J=k[2],ce=k[3],le=U+U,ie=X+X,ge=J+J,be=U*le,Se=U*ie,Ve=U*ge,Le=X*ie,Be=X*ge,Qe=J*ge,Ue=ce*le,Je=ce*ie,lt=ce*ge,st=O[0],mt=O[1],pt=O[2],vt=B[0],_t=B[1],Et=B[2],qt=(1-(Le+Qe))*st,Ht=(Se+lt)*st,Cn=(Ve-Je)*st,Qt=(Se-lt)*mt,ln=(1-(be+Qe))*mt,Yt=(Be+Ue)*mt,Zn=(Ve+Je)*pt,bn=(Be-Ue)*pt,Pn=(1-(be+Le))*pt;return T[0]=qt,T[1]=Ht,T[2]=Cn,T[3]=0,T[4]=Qt,T[5]=ln,T[6]=Yt,T[7]=0,T[8]=Zn,T[9]=bn,T[10]=Pn,T[11]=0,T[12]=z[0]+vt-(qt*vt+Qt*_t+Zn*Et),T[13]=z[1]+_t-(Ht*vt+ln*_t+bn*Et),T[14]=z[2]+Et-(Cn*vt+Yt*_t+Pn*Et),T[15]=1,T},re.fromQuat=function(T,k){var z=k[0],O=k[1],B=k[2],U=k[3],X=z+z,J=O+O,ce=B+B,le=z*X,ie=O*X,ge=O*J,be=B*X,Se=B*J,Ve=B*ce,Le=U*X,Be=U*J,Qe=U*ce;return T[0]=1-ge-Ve,T[1]=ie+Qe,T[2]=be-Be,T[3]=0,T[4]=ie-Qe,T[5]=1-le-Ve,T[6]=Se+Le,T[7]=0,T[8]=be+Be,T[9]=Se-Le,T[10]=1-le-ge,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T},re.frustum=function(T,k,z,O,B,U,X){var J=1/(z-k),ce=1/(B-O),le=1/(U-X);return T[0]=2*U*J,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=2*U*ce,T[6]=0,T[7]=0,T[8]=(z+k)*J,T[9]=(B+O)*ce,T[10]=(X+U)*le,T[11]=-1,T[12]=0,T[13]=0,T[14]=X*U*2*le,T[15]=0,T},re.perspectiveNO=I,re.perspectiveZO=function(T,k,z,O,B){var U,X=1/Math.tan(k/2);return T[0]=X/z,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=X,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[11]=-1,T[12]=0,T[13]=0,T[15]=0,B!=null&&B!==1/0?(T[10]=B*(U=1/(O-B)),T[14]=B*O*U):(T[10]=-1,T[14]=-O),T},re.perspectiveFromFieldOfView=function(T,k,z,O){var B=Math.tan(k.upDegrees*Math.PI/180),U=Math.tan(k.downDegrees*Math.PI/180),X=Math.tan(k.leftDegrees*Math.PI/180),J=Math.tan(k.rightDegrees*Math.PI/180),ce=2/(X+J),le=2/(B+U);return T[0]=ce,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=le,T[6]=0,T[7]=0,T[8]=-(X-J)*ce*.5,T[9]=(B-U)*le*.5,T[10]=O/(z-O),T[11]=-1,T[12]=0,T[13]=0,T[14]=O*z/(z-O),T[15]=0,T},re.orthoNO=D,re.orthoZO=function(T,k,z,O,B,U,X){var J=1/(k-z),ce=1/(O-B),le=1/(U-X);return T[0]=-2*J,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=-2*ce,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=le,T[11]=0,T[12]=(k+z)*J,T[13]=(B+O)*ce,T[14]=U*le,T[15]=1,T},re.lookAt=function(T,k,z,O){var B,U,X,J,ce,le,ie,ge,be,Se,Ve=k[0],Le=k[1],Be=k[2],Qe=O[0],Ue=O[1],Je=O[2],lt=z[0],st=z[1],mt=z[2];return Math.abs(Ve-lt)<o.EPSILON&&Math.abs(Le-st)<o.EPSILON&&Math.abs(Be-mt)<o.EPSILON?f(T):(ie=Ve-lt,ge=Le-st,be=Be-mt,B=Ue*(be*=Se=1/Math.hypot(ie,ge,be))-Je*(ge*=Se),U=Je*(ie*=Se)-Qe*be,X=Qe*ge-Ue*ie,(Se=Math.hypot(B,U,X))?(B*=Se=1/Se,U*=Se,X*=Se):(B=0,U=0,X=0),J=ge*X-be*U,ce=be*B-ie*X,le=ie*U-ge*B,(Se=Math.hypot(J,ce,le))?(J*=Se=1/Se,ce*=Se,le*=Se):(J=0,ce=0,le=0),T[0]=B,T[1]=J,T[2]=ie,T[3]=0,T[4]=U,T[5]=ce,T[6]=ge,T[7]=0,T[8]=X,T[9]=le,T[10]=be,T[11]=0,T[12]=-(B*Ve+U*Le+X*Be),T[13]=-(J*Ve+ce*Le+le*Be),T[14]=-(ie*Ve+ge*Le+be*Be),T[15]=1,T)},re.targetTo=function(T,k,z,O){var B=k[0],U=k[1],X=k[2],J=O[0],ce=O[1],le=O[2],ie=B-z[0],ge=U-z[1],be=X-z[2],Se=ie*ie+ge*ge+be*be;Se>0&&(ie*=Se=1/Math.sqrt(Se),ge*=Se,be*=Se);var Ve=ce*be-le*ge,Le=le*ie-J*be,Be=J*ge-ce*ie;return(Se=Ve*Ve+Le*Le+Be*Be)>0&&(Ve*=Se=1/Math.sqrt(Se),Le*=Se,Be*=Se),T[0]=Ve,T[1]=Le,T[2]=Be,T[3]=0,T[4]=ge*Be-be*Le,T[5]=be*Ve-ie*Be,T[6]=ie*Le-ge*Ve,T[7]=0,T[8]=ie,T[9]=ge,T[10]=be,T[11]=0,T[12]=B,T[13]=U,T[14]=X,T[15]=1,T},re.str=function(T){return"mat4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+", "+T[4]+", "+T[5]+", "+T[6]+", "+T[7]+", "+T[8]+", "+T[9]+", "+T[10]+", "+T[11]+", "+T[12]+", "+T[13]+", "+T[14]+", "+T[15]+")"},re.frob=function(T){return Math.hypot(T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],T[8],T[9],T[10],T[11],T[12],T[13],T[14],T[15])},re.add=function(T,k,z){return T[0]=k[0]+z[0],T[1]=k[1]+z[1],T[2]=k[2]+z[2],T[3]=k[3]+z[3],T[4]=k[4]+z[4],T[5]=k[5]+z[5],T[6]=k[6]+z[6],T[7]=k[7]+z[7],T[8]=k[8]+z[8],T[9]=k[9]+z[9],T[10]=k[10]+z[10],T[11]=k[11]+z[11],T[12]=k[12]+z[12],T[13]=k[13]+z[13],T[14]=k[14]+z[14],T[15]=k[15]+z[15],T},re.subtract=L,re.multiplyScalar=function(T,k,z){return T[0]=k[0]*z,T[1]=k[1]*z,T[2]=k[2]*z,T[3]=k[3]*z,T[4]=k[4]*z,T[5]=k[5]*z,T[6]=k[6]*z,T[7]=k[7]*z,T[8]=k[8]*z,T[9]=k[9]*z,T[10]=k[10]*z,T[11]=k[11]*z,T[12]=k[12]*z,T[13]=k[13]*z,T[14]=k[14]*z,T[15]=k[15]*z,T},re.multiplyScalarAndAdd=function(T,k,z,O){return T[0]=k[0]+z[0]*O,T[1]=k[1]+z[1]*O,T[2]=k[2]+z[2]*O,T[3]=k[3]+z[3]*O,T[4]=k[4]+z[4]*O,T[5]=k[5]+z[5]*O,T[6]=k[6]+z[6]*O,T[7]=k[7]+z[7]*O,T[8]=k[8]+z[8]*O,T[9]=k[9]+z[9]*O,T[10]=k[10]+z[10]*O,T[11]=k[11]+z[11]*O,T[12]=k[12]+z[12]*O,T[13]=k[13]+z[13]*O,T[14]=k[14]+z[14]*O,T[15]=k[15]+z[15]*O,T},re.exactEquals=function(T,k){return T[0]===k[0]&&T[1]===k[1]&&T[2]===k[2]&&T[3]===k[3]&&T[4]===k[4]&&T[5]===k[5]&&T[6]===k[6]&&T[7]===k[7]&&T[8]===k[8]&&T[9]===k[9]&&T[10]===k[10]&&T[11]===k[11]&&T[12]===k[12]&&T[13]===k[13]&&T[14]===k[14]&&T[15]===k[15]},re.equals=function(T,k){var z=T[0],O=T[1],B=T[2],U=T[3],X=T[4],J=T[5],ce=T[6],le=T[7],ie=T[8],ge=T[9],be=T[10],Se=T[11],Ve=T[12],Le=T[13],Be=T[14],Qe=T[15],Ue=k[0],Je=k[1],lt=k[2],st=k[3],mt=k[4],pt=k[5],vt=k[6],_t=k[7],Et=k[8],qt=k[9],Ht=k[10],Cn=k[11],Qt=k[12],ln=k[13],Yt=k[14],Zn=k[15];return Math.abs(z-Ue)<=o.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ue))&&Math.abs(O-Je)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(Je))&&Math.abs(B-lt)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(lt))&&Math.abs(U-st)<=o.EPSILON*Math.max(1,Math.abs(U),Math.abs(st))&&Math.abs(X-mt)<=o.EPSILON*Math.max(1,Math.abs(X),Math.abs(mt))&&Math.abs(J-pt)<=o.EPSILON*Math.max(1,Math.abs(J),Math.abs(pt))&&Math.abs(ce-vt)<=o.EPSILON*Math.max(1,Math.abs(ce),Math.abs(vt))&&Math.abs(le-_t)<=o.EPSILON*Math.max(1,Math.abs(le),Math.abs(_t))&&Math.abs(ie-Et)<=o.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Et))&&Math.abs(ge-qt)<=o.EPSILON*Math.max(1,Math.abs(ge),Math.abs(qt))&&Math.abs(be-Ht)<=o.EPSILON*Math.max(1,Math.abs(be),Math.abs(Ht))&&Math.abs(Se-Cn)<=o.EPSILON*Math.max(1,Math.abs(Se),Math.abs(Cn))&&Math.abs(Ve-Qt)<=o.EPSILON*Math.max(1,Math.abs(Ve),Math.abs(Qt))&&Math.abs(Le-ln)<=o.EPSILON*Math.max(1,Math.abs(Le),Math.abs(ln))&&Math.abs(Be-Yt)<=o.EPSILON*Math.max(1,Math.abs(Be),Math.abs(Yt))&&Math.abs(Qe-Zn)<=o.EPSILON*Math.max(1,Math.abs(Qe),Math.abs(Zn))},re.sub=re.mul=re.ortho=re.perspective=void 0;var o=function(T,k){if(T&&T.__esModule)return T;if(T===null||d(T)!=="object"&&typeof T!="function")return{default:T};var z=c(void 0);if(z&&z.has(T))return z.get(T);var O={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var X=B?Object.getOwnPropertyDescriptor(T,U):null;X&&(X.get||X.set)?Object.defineProperty(O,U,X):O[U]=T[U]}return O.default=T,z&&z.set(T,O),O}(W());function c(T){if(typeof WeakMap!="function")return null;var k=new WeakMap,z=new WeakMap;return(c=function(O){return O?z:k})(T)}function f(T){return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}function g(T,k,z){var O=k[0],B=k[1],U=k[2],X=k[3],J=k[4],ce=k[5],le=k[6],ie=k[7],ge=k[8],be=k[9],Se=k[10],Ve=k[11],Le=k[12],Be=k[13],Qe=k[14],Ue=k[15],Je=z[0],lt=z[1],st=z[2],mt=z[3];return T[0]=Je*O+lt*J+st*ge+mt*Le,T[1]=Je*B+lt*ce+st*be+mt*Be,T[2]=Je*U+lt*le+st*Se+mt*Qe,T[3]=Je*X+lt*ie+st*Ve+mt*Ue,T[4]=(Je=z[4])*O+(lt=z[5])*J+(st=z[6])*ge+(mt=z[7])*Le,T[5]=Je*B+lt*ce+st*be+mt*Be,T[6]=Je*U+lt*le+st*Se+mt*Qe,T[7]=Je*X+lt*ie+st*Ve+mt*Ue,T[8]=(Je=z[8])*O+(lt=z[9])*J+(st=z[10])*ge+(mt=z[11])*Le,T[9]=Je*B+lt*ce+st*be+mt*Be,T[10]=Je*U+lt*le+st*Se+mt*Qe,T[11]=Je*X+lt*ie+st*Ve+mt*Ue,T[12]=(Je=z[12])*O+(lt=z[13])*J+(st=z[14])*ge+(mt=z[15])*Le,T[13]=Je*B+lt*ce+st*be+mt*Be,T[14]=Je*U+lt*le+st*Se+mt*Qe,T[15]=Je*X+lt*ie+st*Ve+mt*Ue,T}function p(T,k,z){var O=k[0],B=k[1],U=k[2],X=k[3],J=O+O,ce=B+B,le=U+U,ie=O*J,ge=O*ce,be=O*le,Se=B*ce,Ve=B*le,Le=U*le,Be=X*J,Qe=X*ce,Ue=X*le;return T[0]=1-(Se+Le),T[1]=ge+Ue,T[2]=be-Qe,T[3]=0,T[4]=ge-Ue,T[5]=1-(ie+Le),T[6]=Ve+Be,T[7]=0,T[8]=be+Qe,T[9]=Ve-Be,T[10]=1-(ie+Se),T[11]=0,T[12]=z[0],T[13]=z[1],T[14]=z[2],T[15]=1,T}function x(T,k){var z=k[4],O=k[5],B=k[6],U=k[8],X=k[9],J=k[10];return T[0]=Math.hypot(k[0],k[1],k[2]),T[1]=Math.hypot(z,O,B),T[2]=Math.hypot(U,X,J),T}function I(T,k,z,O,B){var U,X=1/Math.tan(k/2);return T[0]=X/z,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=X,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[11]=-1,T[12]=0,T[13]=0,T[15]=0,B!=null&&B!==1/0?(T[10]=(B+O)*(U=1/(O-B)),T[14]=2*B*O*U):(T[10]=-1,T[14]=-2*O),T}function D(T,k,z,O,B,U,X){var J=1/(k-z),ce=1/(O-B),le=1/(U-X);return T[0]=-2*J,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=-2*ce,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=2*le,T[11]=0,T[12]=(k+z)*J,T[13]=(B+O)*ce,T[14]=(X+U)*le,T[15]=1,T}function L(T,k,z){return T[0]=k[0]-z[0],T[1]=k[1]-z[1],T[2]=k[2]-z[2],T[3]=k[3]-z[3],T[4]=k[4]-z[4],T[5]=k[5]-z[5],T[6]=k[6]-z[6],T[7]=k[7]-z[7],T[8]=k[8]-z[8],T[9]=k[9]-z[9],T[10]=k[10]-z[10],T[11]=k[11]-z[11],T[12]=k[12]-z[12],T[13]=k[13]-z[13],T[14]=k[14]-z[14],T[15]=k[15]-z[15],T}return re.perspective=I,re.ortho=D,re.mul=g,re.sub=L,re}var ye,ue={},Ie={};function Oe(){if(ye)return Ie;function d(B){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},d(B)}ye=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.create=f,Ie.clone=function(B){var U=new o.ARRAY_TYPE(3);return U[0]=B[0],U[1]=B[1],U[2]=B[2],U},Ie.length=g,Ie.fromValues=function(B,U,X){var J=new o.ARRAY_TYPE(3);return J[0]=B,J[1]=U,J[2]=X,J},Ie.copy=function(B,U){return B[0]=U[0],B[1]=U[1],B[2]=U[2],B},Ie.set=function(B,U,X,J){return B[0]=U,B[1]=X,B[2]=J,B},Ie.add=function(B,U,X){return B[0]=U[0]+X[0],B[1]=U[1]+X[1],B[2]=U[2]+X[2],B},Ie.subtract=p,Ie.multiply=x,Ie.divide=I,Ie.ceil=function(B,U){return B[0]=Math.ceil(U[0]),B[1]=Math.ceil(U[1]),B[2]=Math.ceil(U[2]),B},Ie.floor=function(B,U){return B[0]=Math.floor(U[0]),B[1]=Math.floor(U[1]),B[2]=Math.floor(U[2]),B},Ie.min=function(B,U,X){return B[0]=Math.min(U[0],X[0]),B[1]=Math.min(U[1],X[1]),B[2]=Math.min(U[2],X[2]),B},Ie.max=function(B,U,X){return B[0]=Math.max(U[0],X[0]),B[1]=Math.max(U[1],X[1]),B[2]=Math.max(U[2],X[2]),B},Ie.round=function(B,U){return B[0]=Math.round(U[0]),B[1]=Math.round(U[1]),B[2]=Math.round(U[2]),B},Ie.scale=function(B,U,X){return B[0]=U[0]*X,B[1]=U[1]*X,B[2]=U[2]*X,B},Ie.scaleAndAdd=function(B,U,X,J){return B[0]=U[0]+X[0]*J,B[1]=U[1]+X[1]*J,B[2]=U[2]+X[2]*J,B},Ie.distance=D,Ie.squaredDistance=L,Ie.squaredLength=T,Ie.negate=function(B,U){return B[0]=-U[0],B[1]=-U[1],B[2]=-U[2],B},Ie.inverse=function(B,U){return B[0]=1/U[0],B[1]=1/U[1],B[2]=1/U[2],B},Ie.normalize=function(B,U){var X=U[0],J=U[1],ce=U[2],le=X*X+J*J+ce*ce;return le>0&&(le=1/Math.sqrt(le)),B[0]=U[0]*le,B[1]=U[1]*le,B[2]=U[2]*le,B},Ie.dot=k,Ie.cross=function(B,U,X){var J=U[0],ce=U[1],le=U[2],ie=X[0],ge=X[1],be=X[2];return B[0]=ce*be-le*ge,B[1]=le*ie-J*be,B[2]=J*ge-ce*ie,B},Ie.lerp=function(B,U,X,J){var ce=U[0],le=U[1],ie=U[2];return B[0]=ce+J*(X[0]-ce),B[1]=le+J*(X[1]-le),B[2]=ie+J*(X[2]-ie),B},Ie.hermite=function(B,U,X,J,ce,le){var ie=le*le,ge=ie*(2*le-3)+1,be=ie*(le-2)+le,Se=ie*(le-1),Ve=ie*(3-2*le);return B[0]=U[0]*ge+X[0]*be+J[0]*Se+ce[0]*Ve,B[1]=U[1]*ge+X[1]*be+J[1]*Se+ce[1]*Ve,B[2]=U[2]*ge+X[2]*be+J[2]*Se+ce[2]*Ve,B},Ie.bezier=function(B,U,X,J,ce,le){var ie=1-le,ge=ie*ie,be=le*le,Se=ge*ie,Ve=3*le*ge,Le=3*be*ie,Be=be*le;return B[0]=U[0]*Se+X[0]*Ve+J[0]*Le+ce[0]*Be,B[1]=U[1]*Se+X[1]*Ve+J[1]*Le+ce[1]*Be,B[2]=U[2]*Se+X[2]*Ve+J[2]*Le+ce[2]*Be,B},Ie.random=function(B,U){U=U||1;var X=2*o.RANDOM()*Math.PI,J=2*o.RANDOM()-1,ce=Math.sqrt(1-J*J)*U;return B[0]=Math.cos(X)*ce,B[1]=Math.sin(X)*ce,B[2]=J*U,B},Ie.transformMat4=function(B,U,X){var J=U[0],ce=U[1],le=U[2],ie=X[3]*J+X[7]*ce+X[11]*le+X[15];return B[0]=(X[0]*J+X[4]*ce+X[8]*le+X[12])/(ie=ie||1),B[1]=(X[1]*J+X[5]*ce+X[9]*le+X[13])/ie,B[2]=(X[2]*J+X[6]*ce+X[10]*le+X[14])/ie,B},Ie.transformMat3=function(B,U,X){var J=U[0],ce=U[1],le=U[2];return B[0]=J*X[0]+ce*X[3]+le*X[6],B[1]=J*X[1]+ce*X[4]+le*X[7],B[2]=J*X[2]+ce*X[5]+le*X[8],B},Ie.transformQuat=function(B,U,X){var J=X[0],ce=X[1],le=X[2],ie=U[0],ge=U[1],be=U[2],Se=ce*be-le*ge,Ve=le*ie-J*be,Le=J*ge-ce*ie,Be=ce*Le-le*Ve,Qe=le*Se-J*Le,Ue=J*Ve-ce*Se,Je=2*X[3];return Ve*=Je,Le*=Je,Qe*=2,Ue*=2,B[0]=ie+(Se*=Je)+(Be*=2),B[1]=ge+Ve+Qe,B[2]=be+Le+Ue,B},Ie.rotateX=function(B,U,X,J){var ce=[],le=[];return ce[0]=U[0]-X[0],ce[1]=U[1]-X[1],ce[2]=U[2]-X[2],le[0]=ce[0],le[1]=ce[1]*Math.cos(J)-ce[2]*Math.sin(J),le[2]=ce[1]*Math.sin(J)+ce[2]*Math.cos(J),B[0]=le[0]+X[0],B[1]=le[1]+X[1],B[2]=le[2]+X[2],B},Ie.rotateY=function(B,U,X,J){var ce=[],le=[];return ce[0]=U[0]-X[0],ce[1]=U[1]-X[1],ce[2]=U[2]-X[2],le[0]=ce[2]*Math.sin(J)+ce[0]*Math.cos(J),le[1]=ce[1],le[2]=ce[2]*Math.cos(J)-ce[0]*Math.sin(J),B[0]=le[0]+X[0],B[1]=le[1]+X[1],B[2]=le[2]+X[2],B},Ie.rotateZ=function(B,U,X,J){var ce=[],le=[];return ce[0]=U[0]-X[0],ce[1]=U[1]-X[1],ce[2]=U[2]-X[2],le[0]=ce[0]*Math.cos(J)-ce[1]*Math.sin(J),le[1]=ce[0]*Math.sin(J)+ce[1]*Math.cos(J),le[2]=ce[2],B[0]=le[0]+X[0],B[1]=le[1]+X[1],B[2]=le[2]+X[2],B},Ie.angle=function(B,U){var X=B[0],J=B[1],ce=B[2],le=U[0],ie=U[1],ge=U[2],be=Math.sqrt(X*X+J*J+ce*ce)*Math.sqrt(le*le+ie*ie+ge*ge),Se=be&&k(B,U)/be;return Math.acos(Math.min(Math.max(Se,-1),1))},Ie.zero=function(B){return B[0]=0,B[1]=0,B[2]=0,B},Ie.str=function(B){return"vec3("+B[0]+", "+B[1]+", "+B[2]+")"},Ie.exactEquals=function(B,U){return B[0]===U[0]&&B[1]===U[1]&&B[2]===U[2]},Ie.equals=function(B,U){var X=B[0],J=B[1],ce=B[2],le=U[0],ie=U[1],ge=U[2];return Math.abs(X-le)<=o.EPSILON*Math.max(1,Math.abs(X),Math.abs(le))&&Math.abs(J-ie)<=o.EPSILON*Math.max(1,Math.abs(J),Math.abs(ie))&&Math.abs(ce-ge)<=o.EPSILON*Math.max(1,Math.abs(ce),Math.abs(ge))},Ie.forEach=Ie.sqrLen=Ie.len=Ie.sqrDist=Ie.dist=Ie.div=Ie.mul=Ie.sub=void 0;var o=function(B,U){if(B&&B.__esModule)return B;if(B===null||d(B)!=="object"&&typeof B!="function")return{default:B};var X=c(void 0);if(X&&X.has(B))return X.get(B);var J={},ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var le in B)if(le!=="default"&&Object.prototype.hasOwnProperty.call(B,le)){var ie=ce?Object.getOwnPropertyDescriptor(B,le):null;ie&&(ie.get||ie.set)?Object.defineProperty(J,le,ie):J[le]=B[le]}return J.default=B,X&&X.set(B,J),J}(W());function c(B){if(typeof WeakMap!="function")return null;var U=new WeakMap,X=new WeakMap;return(c=function(J){return J?X:U})(B)}function f(){var B=new o.ARRAY_TYPE(3);return o.ARRAY_TYPE!=Float32Array&&(B[0]=0,B[1]=0,B[2]=0),B}function g(B){return Math.hypot(B[0],B[1],B[2])}function p(B,U,X){return B[0]=U[0]-X[0],B[1]=U[1]-X[1],B[2]=U[2]-X[2],B}function x(B,U,X){return B[0]=U[0]*X[0],B[1]=U[1]*X[1],B[2]=U[2]*X[2],B}function I(B,U,X){return B[0]=U[0]/X[0],B[1]=U[1]/X[1],B[2]=U[2]/X[2],B}function D(B,U){return Math.hypot(U[0]-B[0],U[1]-B[1],U[2]-B[2])}function L(B,U){var X=U[0]-B[0],J=U[1]-B[1],ce=U[2]-B[2];return X*X+J*J+ce*ce}function T(B){var U=B[0],X=B[1],J=B[2];return U*U+X*X+J*J}function k(B,U){return B[0]*U[0]+B[1]*U[1]+B[2]*U[2]}Ie.sub=p,Ie.mul=x,Ie.div=I,Ie.dist=D,Ie.sqrDist=L,Ie.len=g,Ie.sqrLen=T;var z,O=(z=f(),function(B,U,X,J,ce,le){var ie,ge;for(U||(U=3),X||(X=0),ge=J?Math.min(J*U+X,B.length):B.length,ie=X;ie<ge;ie+=U)z[0]=B[ie],z[1]=B[ie+1],z[2]=B[ie+2],ce(z,z,le),B[ie]=z[0],B[ie+1]=z[1],B[ie+2]=z[2];return B});return Ie.forEach=O,Ie}var ze,ft,He={};function bt(){if(ze)return He;function d(O){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},d(O)}ze=1,Object.defineProperty(He,"__esModule",{value:!0}),He.create=f,He.clone=function(O){var B=new o.ARRAY_TYPE(4);return B[0]=O[0],B[1]=O[1],B[2]=O[2],B[3]=O[3],B},He.fromValues=function(O,B,U,X){var J=new o.ARRAY_TYPE(4);return J[0]=O,J[1]=B,J[2]=U,J[3]=X,J},He.copy=function(O,B){return O[0]=B[0],O[1]=B[1],O[2]=B[2],O[3]=B[3],O},He.set=function(O,B,U,X,J){return O[0]=B,O[1]=U,O[2]=X,O[3]=J,O},He.add=function(O,B,U){return O[0]=B[0]+U[0],O[1]=B[1]+U[1],O[2]=B[2]+U[2],O[3]=B[3]+U[3],O},He.subtract=g,He.multiply=p,He.divide=x,He.ceil=function(O,B){return O[0]=Math.ceil(B[0]),O[1]=Math.ceil(B[1]),O[2]=Math.ceil(B[2]),O[3]=Math.ceil(B[3]),O},He.floor=function(O,B){return O[0]=Math.floor(B[0]),O[1]=Math.floor(B[1]),O[2]=Math.floor(B[2]),O[3]=Math.floor(B[3]),O},He.min=function(O,B,U){return O[0]=Math.min(B[0],U[0]),O[1]=Math.min(B[1],U[1]),O[2]=Math.min(B[2],U[2]),O[3]=Math.min(B[3],U[3]),O},He.max=function(O,B,U){return O[0]=Math.max(B[0],U[0]),O[1]=Math.max(B[1],U[1]),O[2]=Math.max(B[2],U[2]),O[3]=Math.max(B[3],U[3]),O},He.round=function(O,B){return O[0]=Math.round(B[0]),O[1]=Math.round(B[1]),O[2]=Math.round(B[2]),O[3]=Math.round(B[3]),O},He.scale=function(O,B,U){return O[0]=B[0]*U,O[1]=B[1]*U,O[2]=B[2]*U,O[3]=B[3]*U,O},He.scaleAndAdd=function(O,B,U,X){return O[0]=B[0]+U[0]*X,O[1]=B[1]+U[1]*X,O[2]=B[2]+U[2]*X,O[3]=B[3]+U[3]*X,O},He.distance=I,He.squaredDistance=D,He.length=L,He.squaredLength=T,He.negate=function(O,B){return O[0]=-B[0],O[1]=-B[1],O[2]=-B[2],O[3]=-B[3],O},He.inverse=function(O,B){return O[0]=1/B[0],O[1]=1/B[1],O[2]=1/B[2],O[3]=1/B[3],O},He.normalize=function(O,B){var U=B[0],X=B[1],J=B[2],ce=B[3],le=U*U+X*X+J*J+ce*ce;return le>0&&(le=1/Math.sqrt(le)),O[0]=U*le,O[1]=X*le,O[2]=J*le,O[3]=ce*le,O},He.dot=function(O,B){return O[0]*B[0]+O[1]*B[1]+O[2]*B[2]+O[3]*B[3]},He.cross=function(O,B,U,X){var J=U[0]*X[1]-U[1]*X[0],ce=U[0]*X[2]-U[2]*X[0],le=U[0]*X[3]-U[3]*X[0],ie=U[1]*X[2]-U[2]*X[1],ge=U[1]*X[3]-U[3]*X[1],be=U[2]*X[3]-U[3]*X[2],Se=B[0],Ve=B[1],Le=B[2],Be=B[3];return O[0]=Ve*be-Le*ge+Be*ie,O[1]=-Se*be+Le*le-Be*ce,O[2]=Se*ge-Ve*le+Be*J,O[3]=-Se*ie+Ve*ce-Le*J,O},He.lerp=function(O,B,U,X){var J=B[0],ce=B[1],le=B[2],ie=B[3];return O[0]=J+X*(U[0]-J),O[1]=ce+X*(U[1]-ce),O[2]=le+X*(U[2]-le),O[3]=ie+X*(U[3]-ie),O},He.random=function(O,B){var U,X,J,ce,le,ie;B=B||1;do le=(U=2*o.RANDOM()-1)*U+(X=2*o.RANDOM()-1)*X;while(le>=1);do ie=(J=2*o.RANDOM()-1)*J+(ce=2*o.RANDOM()-1)*ce;while(ie>=1);var ge=Math.sqrt((1-le)/ie);return O[0]=B*U,O[1]=B*X,O[2]=B*J*ge,O[3]=B*ce*ge,O},He.transformMat4=function(O,B,U){var X=B[0],J=B[1],ce=B[2],le=B[3];return O[0]=U[0]*X+U[4]*J+U[8]*ce+U[12]*le,O[1]=U[1]*X+U[5]*J+U[9]*ce+U[13]*le,O[2]=U[2]*X+U[6]*J+U[10]*ce+U[14]*le,O[3]=U[3]*X+U[7]*J+U[11]*ce+U[15]*le,O},He.transformQuat=function(O,B,U){var X=B[0],J=B[1],ce=B[2],le=U[0],ie=U[1],ge=U[2],be=U[3],Se=be*X+ie*ce-ge*J,Ve=be*J+ge*X-le*ce,Le=be*ce+le*J-ie*X,Be=-le*X-ie*J-ge*ce;return O[0]=Se*be+Be*-le+Ve*-ge-Le*-ie,O[1]=Ve*be+Be*-ie+Le*-le-Se*-ge,O[2]=Le*be+Be*-ge+Se*-ie-Ve*-le,O[3]=B[3],O},He.zero=function(O){return O[0]=0,O[1]=0,O[2]=0,O[3]=0,O},He.str=function(O){return"vec4("+O[0]+", "+O[1]+", "+O[2]+", "+O[3]+")"},He.exactEquals=function(O,B){return O[0]===B[0]&&O[1]===B[1]&&O[2]===B[2]&&O[3]===B[3]},He.equals=function(O,B){var U=O[0],X=O[1],J=O[2],ce=O[3],le=B[0],ie=B[1],ge=B[2],be=B[3];return Math.abs(U-le)<=o.EPSILON*Math.max(1,Math.abs(U),Math.abs(le))&&Math.abs(X-ie)<=o.EPSILON*Math.max(1,Math.abs(X),Math.abs(ie))&&Math.abs(J-ge)<=o.EPSILON*Math.max(1,Math.abs(J),Math.abs(ge))&&Math.abs(ce-be)<=o.EPSILON*Math.max(1,Math.abs(ce),Math.abs(be))},He.forEach=He.sqrLen=He.len=He.sqrDist=He.dist=He.div=He.mul=He.sub=void 0;var o=function(O,B){if(O&&O.__esModule)return O;if(O===null||d(O)!=="object"&&typeof O!="function")return{default:O};var U=c(void 0);if(U&&U.has(O))return U.get(O);var X={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ce in O)if(ce!=="default"&&Object.prototype.hasOwnProperty.call(O,ce)){var le=J?Object.getOwnPropertyDescriptor(O,ce):null;le&&(le.get||le.set)?Object.defineProperty(X,ce,le):X[ce]=O[ce]}return X.default=O,U&&U.set(O,X),X}(W());function c(O){if(typeof WeakMap!="function")return null;var B=new WeakMap,U=new WeakMap;return(c=function(X){return X?U:B})(O)}function f(){var O=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(O[0]=0,O[1]=0,O[2]=0,O[3]=0),O}function g(O,B,U){return O[0]=B[0]-U[0],O[1]=B[1]-U[1],O[2]=B[2]-U[2],O[3]=B[3]-U[3],O}function p(O,B,U){return O[0]=B[0]*U[0],O[1]=B[1]*U[1],O[2]=B[2]*U[2],O[3]=B[3]*U[3],O}function x(O,B,U){return O[0]=B[0]/U[0],O[1]=B[1]/U[1],O[2]=B[2]/U[2],O[3]=B[3]/U[3],O}function I(O,B){return Math.hypot(B[0]-O[0],B[1]-O[1],B[2]-O[2],B[3]-O[3])}function D(O,B){var U=B[0]-O[0],X=B[1]-O[1],J=B[2]-O[2],ce=B[3]-O[3];return U*U+X*X+J*J+ce*ce}function L(O){return Math.hypot(O[0],O[1],O[2],O[3])}function T(O){var B=O[0],U=O[1],X=O[2],J=O[3];return B*B+U*U+X*X+J*J}He.sub=g,He.mul=p,He.div=x,He.dist=I,He.sqrDist=D,He.len=L,He.sqrLen=T;var k,z=(k=f(),function(O,B,U,X,J,ce){var le,ie;for(B||(B=4),U||(U=0),ie=X?Math.min(X*B+U,O.length):O.length,le=U;le<ie;le+=B)k[0]=O[le],k[1]=O[le+1],k[2]=O[le+2],k[3]=O[le+3],J(k,k,ce),O[le]=k[0],O[le+1]=k[1],O[le+2]=k[2],O[le+3]=k[3];return O});return He.forEach=z,He}function Nt(){if(ft)return ue;function d(Ue){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Je){return typeof Je}:function(Je){return Je&&typeof Symbol=="function"&&Je.constructor===Symbol&&Je!==Symbol.prototype?"symbol":typeof Je},d(Ue)}ft=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.create=I,ue.identity=function(Ue){return Ue[0]=0,Ue[1]=0,Ue[2]=0,Ue[3]=1,Ue},ue.setAxisAngle=D,ue.getAxisAngle=function(Ue,Je){var lt=2*Math.acos(Je[3]),st=Math.sin(lt/2);return st>o.EPSILON?(Ue[0]=Je[0]/st,Ue[1]=Je[1]/st,Ue[2]=Je[2]/st):(Ue[0]=1,Ue[1]=0,Ue[2]=0),lt},ue.getAngle=function(Ue,Je){var lt=U(Ue,Je);return Math.acos(2*lt*lt-1)},ue.multiply=L,ue.rotateX=function(Ue,Je,lt){lt*=.5;var st=Je[0],mt=Je[1],pt=Je[2],vt=Je[3],_t=Math.sin(lt),Et=Math.cos(lt);return Ue[0]=st*Et+vt*_t,Ue[1]=mt*Et+pt*_t,Ue[2]=pt*Et-mt*_t,Ue[3]=vt*Et-st*_t,Ue},ue.rotateY=function(Ue,Je,lt){lt*=.5;var st=Je[0],mt=Je[1],pt=Je[2],vt=Je[3],_t=Math.sin(lt),Et=Math.cos(lt);return Ue[0]=st*Et-pt*_t,Ue[1]=mt*Et+vt*_t,Ue[2]=pt*Et+st*_t,Ue[3]=vt*Et-mt*_t,Ue},ue.rotateZ=function(Ue,Je,lt){lt*=.5;var st=Je[0],mt=Je[1],pt=Je[2],vt=Je[3],_t=Math.sin(lt),Et=Math.cos(lt);return Ue[0]=st*Et+mt*_t,Ue[1]=mt*Et-st*_t,Ue[2]=pt*Et+vt*_t,Ue[3]=vt*Et-pt*_t,Ue},ue.calculateW=function(Ue,Je){var lt=Je[0],st=Je[1],mt=Je[2];return Ue[0]=lt,Ue[1]=st,Ue[2]=mt,Ue[3]=Math.sqrt(Math.abs(1-lt*lt-st*st-mt*mt)),Ue},ue.exp=T,ue.ln=k,ue.pow=function(Ue,Je,lt){return k(Ue,Je),B(Ue,Ue,lt),T(Ue,Ue),Ue},ue.slerp=z,ue.random=function(Ue){var Je=o.RANDOM(),lt=o.RANDOM(),st=o.RANDOM(),mt=Math.sqrt(1-Je),pt=Math.sqrt(Je);return Ue[0]=mt*Math.sin(2*Math.PI*lt),Ue[1]=mt*Math.cos(2*Math.PI*lt),Ue[2]=pt*Math.sin(2*Math.PI*st),Ue[3]=pt*Math.cos(2*Math.PI*st),Ue},ue.invert=function(Ue,Je){var lt=Je[0],st=Je[1],mt=Je[2],pt=Je[3],vt=lt*lt+st*st+mt*mt+pt*pt,_t=vt?1/vt:0;return Ue[0]=-lt*_t,Ue[1]=-st*_t,Ue[2]=-mt*_t,Ue[3]=pt*_t,Ue},ue.conjugate=function(Ue,Je){return Ue[0]=-Je[0],Ue[1]=-Je[1],Ue[2]=-Je[2],Ue[3]=Je[3],Ue},ue.fromMat3=O,ue.fromEuler=function(Ue,Je,lt,st){var mt=.5*Math.PI/180;Je*=mt,lt*=mt,st*=mt;var pt=Math.sin(Je),vt=Math.cos(Je),_t=Math.sin(lt),Et=Math.cos(lt),qt=Math.sin(st),Ht=Math.cos(st);return Ue[0]=pt*Et*Ht-vt*_t*qt,Ue[1]=vt*_t*Ht+pt*Et*qt,Ue[2]=vt*Et*qt-pt*_t*Ht,Ue[3]=vt*Et*Ht+pt*_t*qt,Ue},ue.str=function(Ue){return"quat("+Ue[0]+", "+Ue[1]+", "+Ue[2]+", "+Ue[3]+")"},ue.setAxes=ue.sqlerp=ue.rotationTo=ue.equals=ue.exactEquals=ue.normalize=ue.sqrLen=ue.squaredLength=ue.len=ue.length=ue.lerp=ue.dot=ue.scale=ue.mul=ue.add=ue.set=ue.copy=ue.fromValues=ue.clone=void 0;var o=x(W()),c=x(De()),f=x(Oe()),g=x(bt());function p(Ue){if(typeof WeakMap!="function")return null;var Je=new WeakMap,lt=new WeakMap;return(p=function(st){return st?lt:Je})(Ue)}function x(Ue,Je){if(Ue&&Ue.__esModule)return Ue;if(Ue===null||d(Ue)!=="object"&&typeof Ue!="function")return{default:Ue};var lt=p(Je);if(lt&&lt.has(Ue))return lt.get(Ue);var st={},mt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var pt in Ue)if(pt!=="default"&&Object.prototype.hasOwnProperty.call(Ue,pt)){var vt=mt?Object.getOwnPropertyDescriptor(Ue,pt):null;vt&&(vt.get||vt.set)?Object.defineProperty(st,pt,vt):st[pt]=Ue[pt]}return st.default=Ue,lt&&lt.set(Ue,st),st}function I(){var Ue=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0),Ue[3]=1,Ue}function D(Ue,Je,lt){lt*=.5;var st=Math.sin(lt);return Ue[0]=st*Je[0],Ue[1]=st*Je[1],Ue[2]=st*Je[2],Ue[3]=Math.cos(lt),Ue}function L(Ue,Je,lt){var st=Je[0],mt=Je[1],pt=Je[2],vt=Je[3],_t=lt[0],Et=lt[1],qt=lt[2],Ht=lt[3];return Ue[0]=st*Ht+vt*_t+mt*qt-pt*Et,Ue[1]=mt*Ht+vt*Et+pt*_t-st*qt,Ue[2]=pt*Ht+vt*qt+st*Et-mt*_t,Ue[3]=vt*Ht-st*_t-mt*Et-pt*qt,Ue}function T(Ue,Je){var lt=Je[0],st=Je[1],mt=Je[2],pt=Je[3],vt=Math.sqrt(lt*lt+st*st+mt*mt),_t=Math.exp(pt),Et=vt>0?_t*Math.sin(vt)/vt:0;return Ue[0]=lt*Et,Ue[1]=st*Et,Ue[2]=mt*Et,Ue[3]=_t*Math.cos(vt),Ue}function k(Ue,Je){var lt=Je[0],st=Je[1],mt=Je[2],pt=Je[3],vt=Math.sqrt(lt*lt+st*st+mt*mt),_t=vt>0?Math.atan2(vt,pt)/vt:0;return Ue[0]=lt*_t,Ue[1]=st*_t,Ue[2]=mt*_t,Ue[3]=.5*Math.log(lt*lt+st*st+mt*mt+pt*pt),Ue}function z(Ue,Je,lt,st){var mt,pt,vt,_t,Et,qt=Je[0],Ht=Je[1],Cn=Je[2],Qt=Je[3],ln=lt[0],Yt=lt[1],Zn=lt[2],bn=lt[3];return(pt=qt*ln+Ht*Yt+Cn*Zn+Qt*bn)<0&&(pt=-pt,ln=-ln,Yt=-Yt,Zn=-Zn,bn=-bn),1-pt>o.EPSILON?(mt=Math.acos(pt),vt=Math.sin(mt),_t=Math.sin((1-st)*mt)/vt,Et=Math.sin(st*mt)/vt):(_t=1-st,Et=st),Ue[0]=_t*qt+Et*ln,Ue[1]=_t*Ht+Et*Yt,Ue[2]=_t*Cn+Et*Zn,Ue[3]=_t*Qt+Et*bn,Ue}function O(Ue,Je){var lt,st=Je[0]+Je[4]+Je[8];if(st>0)lt=Math.sqrt(st+1),Ue[3]=.5*lt,Ue[0]=(Je[5]-Je[7])*(lt=.5/lt),Ue[1]=(Je[6]-Je[2])*lt,Ue[2]=(Je[1]-Je[3])*lt;else{var mt=0;Je[4]>Je[0]&&(mt=1),Je[8]>Je[3*mt+mt]&&(mt=2);var pt=(mt+1)%3,vt=(mt+2)%3;lt=Math.sqrt(Je[3*mt+mt]-Je[3*pt+pt]-Je[3*vt+vt]+1),Ue[mt]=.5*lt,Ue[3]=(Je[3*pt+vt]-Je[3*vt+pt])*(lt=.5/lt),Ue[pt]=(Je[3*pt+mt]+Je[3*mt+pt])*lt,Ue[vt]=(Je[3*vt+mt]+Je[3*mt+vt])*lt}return Ue}ue.clone=g.clone,ue.fromValues=g.fromValues,ue.copy=g.copy,ue.set=g.set,ue.add=g.add,ue.mul=L;var B=g.scale;ue.scale=B;var U=g.dot;ue.dot=U,ue.lerp=g.lerp;var X=g.length;ue.length=X,ue.len=X;var J=g.squaredLength;ue.squaredLength=J,ue.sqrLen=J;var ce=g.normalize;ue.normalize=ce,ue.exactEquals=g.exactEquals,ue.equals=g.equals;var le,ie,ge,be=(le=f.create(),ie=f.fromValues(1,0,0),ge=f.fromValues(0,1,0),function(Ue,Je,lt){var st=f.dot(Je,lt);return st<-.999999?(f.cross(le,ie,Je),f.len(le)<1e-6&&f.cross(le,ge,Je),f.normalize(le,le),D(Ue,le,Math.PI),Ue):st>.999999?(Ue[0]=0,Ue[1]=0,Ue[2]=0,Ue[3]=1,Ue):(f.cross(le,Je,lt),Ue[0]=le[0],Ue[1]=le[1],Ue[2]=le[2],Ue[3]=1+st,ce(Ue,Ue))});ue.rotationTo=be;var Se,Ve,Le=(Se=I(),Ve=I(),function(Ue,Je,lt,st,mt,pt){return z(Se,Je,mt,pt),z(Ve,lt,st,pt),z(Ue,Se,Ve,2*pt*(1-pt)),Ue});ue.sqlerp=Le;var Be,Qe=(Be=c.create(),function(Ue,Je,lt,st){return Be[0]=lt[0],Be[3]=lt[1],Be[6]=lt[2],Be[1]=st[0],Be[4]=st[1],Be[7]=st[2],Be[2]=-Je[0],Be[5]=-Je[1],Be[8]=-Je[2],ce(Ue,O(Ue,Be))});return ue.setAxes=Qe,ue}var wt,it={};function nn(){if(wt)return it;function d(z){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},d(z)}wt=1,Object.defineProperty(it,"__esModule",{value:!0}),it.create=function(){var z=new o.ARRAY_TYPE(8);return o.ARRAY_TYPE!=Float32Array&&(z[0]=0,z[1]=0,z[2]=0,z[4]=0,z[5]=0,z[6]=0,z[7]=0),z[3]=1,z},it.clone=function(z){var O=new o.ARRAY_TYPE(8);return O[0]=z[0],O[1]=z[1],O[2]=z[2],O[3]=z[3],O[4]=z[4],O[5]=z[5],O[6]=z[6],O[7]=z[7],O},it.fromValues=function(z,O,B,U,X,J,ce,le){var ie=new o.ARRAY_TYPE(8);return ie[0]=z,ie[1]=O,ie[2]=B,ie[3]=U,ie[4]=X,ie[5]=J,ie[6]=ce,ie[7]=le,ie},it.fromRotationTranslationValues=function(z,O,B,U,X,J,ce){var le=new o.ARRAY_TYPE(8);le[0]=z,le[1]=O,le[2]=B,le[3]=U;var ie=.5*X,ge=.5*J,be=.5*ce;return le[4]=ie*U+ge*B-be*O,le[5]=ge*U+be*z-ie*B,le[6]=be*U+ie*O-ge*z,le[7]=-ie*z-ge*O-be*B,le},it.fromRotationTranslation=x,it.fromTranslation=function(z,O){return z[0]=0,z[1]=0,z[2]=0,z[3]=1,z[4]=.5*O[0],z[5]=.5*O[1],z[6]=.5*O[2],z[7]=0,z},it.fromRotation=function(z,O){return z[0]=O[0],z[1]=O[1],z[2]=O[2],z[3]=O[3],z[4]=0,z[5]=0,z[6]=0,z[7]=0,z},it.fromMat4=function(z,O){var B=c.create();f.getRotation(B,O);var U=new o.ARRAY_TYPE(3);return f.getTranslation(U,O),x(z,B,U),z},it.copy=I,it.identity=function(z){return z[0]=0,z[1]=0,z[2]=0,z[3]=1,z[4]=0,z[5]=0,z[6]=0,z[7]=0,z},it.set=function(z,O,B,U,X,J,ce,le,ie){return z[0]=O,z[1]=B,z[2]=U,z[3]=X,z[4]=J,z[5]=ce,z[6]=le,z[7]=ie,z},it.getDual=function(z,O){return z[0]=O[4],z[1]=O[5],z[2]=O[6],z[3]=O[7],z},it.setDual=function(z,O){return z[4]=O[0],z[5]=O[1],z[6]=O[2],z[7]=O[3],z},it.getTranslation=function(z,O){var B=O[4],U=O[5],X=O[6],J=O[7],ce=-O[0],le=-O[1],ie=-O[2],ge=O[3];return z[0]=2*(B*ge+J*ce+U*ie-X*le),z[1]=2*(U*ge+J*le+X*ce-B*ie),z[2]=2*(X*ge+J*ie+B*le-U*ce),z},it.translate=function(z,O,B){var U=O[0],X=O[1],J=O[2],ce=O[3],le=.5*B[0],ie=.5*B[1],ge=.5*B[2],be=O[4],Se=O[5],Ve=O[6],Le=O[7];return z[0]=U,z[1]=X,z[2]=J,z[3]=ce,z[4]=ce*le+X*ge-J*ie+be,z[5]=ce*ie+J*le-U*ge+Se,z[6]=ce*ge+U*ie-X*le+Ve,z[7]=-U*le-X*ie-J*ge+Le,z},it.rotateX=function(z,O,B){var U=-O[0],X=-O[1],J=-O[2],ce=O[3],le=O[4],ie=O[5],ge=O[6],be=O[7],Se=le*ce+be*U+ie*J-ge*X,Ve=ie*ce+be*X+ge*U-le*J,Le=ge*ce+be*J+le*X-ie*U,Be=be*ce-le*U-ie*X-ge*J;return c.rotateX(z,O,B),z[4]=Se*(ce=z[3])+Be*(U=z[0])+Ve*(J=z[2])-Le*(X=z[1]),z[5]=Ve*ce+Be*X+Le*U-Se*J,z[6]=Le*ce+Be*J+Se*X-Ve*U,z[7]=Be*ce-Se*U-Ve*X-Le*J,z},it.rotateY=function(z,O,B){var U=-O[0],X=-O[1],J=-O[2],ce=O[3],le=O[4],ie=O[5],ge=O[6],be=O[7],Se=le*ce+be*U+ie*J-ge*X,Ve=ie*ce+be*X+ge*U-le*J,Le=ge*ce+be*J+le*X-ie*U,Be=be*ce-le*U-ie*X-ge*J;return c.rotateY(z,O,B),z[4]=Se*(ce=z[3])+Be*(U=z[0])+Ve*(J=z[2])-Le*(X=z[1]),z[5]=Ve*ce+Be*X+Le*U-Se*J,z[6]=Le*ce+Be*J+Se*X-Ve*U,z[7]=Be*ce-Se*U-Ve*X-Le*J,z},it.rotateZ=function(z,O,B){var U=-O[0],X=-O[1],J=-O[2],ce=O[3],le=O[4],ie=O[5],ge=O[6],be=O[7],Se=le*ce+be*U+ie*J-ge*X,Ve=ie*ce+be*X+ge*U-le*J,Le=ge*ce+be*J+le*X-ie*U,Be=be*ce-le*U-ie*X-ge*J;return c.rotateZ(z,O,B),z[4]=Se*(ce=z[3])+Be*(U=z[0])+Ve*(J=z[2])-Le*(X=z[1]),z[5]=Ve*ce+Be*X+Le*U-Se*J,z[6]=Le*ce+Be*J+Se*X-Ve*U,z[7]=Be*ce-Se*U-Ve*X-Le*J,z},it.rotateByQuatAppend=function(z,O,B){var U=B[0],X=B[1],J=B[2],ce=B[3],le=O[0],ie=O[1],ge=O[2],be=O[3];return z[0]=le*ce+be*U+ie*J-ge*X,z[1]=ie*ce+be*X+ge*U-le*J,z[2]=ge*ce+be*J+le*X-ie*U,z[3]=be*ce-le*U-ie*X-ge*J,z[4]=(le=O[4])*ce+(be=O[7])*U+(ie=O[5])*J-(ge=O[6])*X,z[5]=ie*ce+be*X+ge*U-le*J,z[6]=ge*ce+be*J+le*X-ie*U,z[7]=be*ce-le*U-ie*X-ge*J,z},it.rotateByQuatPrepend=function(z,O,B){var U=O[0],X=O[1],J=O[2],ce=O[3],le=B[0],ie=B[1],ge=B[2],be=B[3];return z[0]=U*be+ce*le+X*ge-J*ie,z[1]=X*be+ce*ie+J*le-U*ge,z[2]=J*be+ce*ge+U*ie-X*le,z[3]=ce*be-U*le-X*ie-J*ge,z[4]=U*(be=B[7])+ce*(le=B[4])+X*(ge=B[6])-J*(ie=B[5]),z[5]=X*be+ce*ie+J*le-U*ge,z[6]=J*be+ce*ge+U*ie-X*le,z[7]=ce*be-U*le-X*ie-J*ge,z},it.rotateAroundAxis=function(z,O,B,U){if(Math.abs(U)<o.EPSILON)return I(z,O);var X=Math.hypot(B[0],B[1],B[2]);U*=.5;var J=Math.sin(U),ce=J*B[0]/X,le=J*B[1]/X,ie=J*B[2]/X,ge=Math.cos(U),be=O[0],Se=O[1],Ve=O[2],Le=O[3];z[0]=be*ge+Le*ce+Se*ie-Ve*le,z[1]=Se*ge+Le*le+Ve*ce-be*ie,z[2]=Ve*ge+Le*ie+be*le-Se*ce,z[3]=Le*ge-be*ce-Se*le-Ve*ie;var Be=O[4],Qe=O[5],Ue=O[6],Je=O[7];return z[4]=Be*ge+Je*ce+Qe*ie-Ue*le,z[5]=Qe*ge+Je*le+Ue*ce-Be*ie,z[6]=Ue*ge+Je*ie+Be*le-Qe*ce,z[7]=Je*ge-Be*ce-Qe*le-Ue*ie,z},it.add=function(z,O,B){return z[0]=O[0]+B[0],z[1]=O[1]+B[1],z[2]=O[2]+B[2],z[3]=O[3]+B[3],z[4]=O[4]+B[4],z[5]=O[5]+B[5],z[6]=O[6]+B[6],z[7]=O[7]+B[7],z},it.multiply=D,it.scale=function(z,O,B){return z[0]=O[0]*B,z[1]=O[1]*B,z[2]=O[2]*B,z[3]=O[3]*B,z[4]=O[4]*B,z[5]=O[5]*B,z[6]=O[6]*B,z[7]=O[7]*B,z},it.lerp=function(z,O,B,U){var X=1-U;return L(O,B)<0&&(U=-U),z[0]=O[0]*X+B[0]*U,z[1]=O[1]*X+B[1]*U,z[2]=O[2]*X+B[2]*U,z[3]=O[3]*X+B[3]*U,z[4]=O[4]*X+B[4]*U,z[5]=O[5]*X+B[5]*U,z[6]=O[6]*X+B[6]*U,z[7]=O[7]*X+B[7]*U,z},it.invert=function(z,O){var B=k(O);return z[0]=-O[0]/B,z[1]=-O[1]/B,z[2]=-O[2]/B,z[3]=O[3]/B,z[4]=-O[4]/B,z[5]=-O[5]/B,z[6]=-O[6]/B,z[7]=O[7]/B,z},it.conjugate=function(z,O){return z[0]=-O[0],z[1]=-O[1],z[2]=-O[2],z[3]=O[3],z[4]=-O[4],z[5]=-O[5],z[6]=-O[6],z[7]=O[7],z},it.normalize=function(z,O){var B=k(O);if(B>0){B=Math.sqrt(B);var U=O[0]/B,X=O[1]/B,J=O[2]/B,ce=O[3]/B,le=O[4],ie=O[5],ge=O[6],be=O[7],Se=U*le+X*ie+J*ge+ce*be;z[0]=U,z[1]=X,z[2]=J,z[3]=ce,z[4]=(le-U*Se)/B,z[5]=(ie-X*Se)/B,z[6]=(ge-J*Se)/B,z[7]=(be-ce*Se)/B}return z},it.str=function(z){return"quat2("+z[0]+", "+z[1]+", "+z[2]+", "+z[3]+", "+z[4]+", "+z[5]+", "+z[6]+", "+z[7]+")"},it.exactEquals=function(z,O){return z[0]===O[0]&&z[1]===O[1]&&z[2]===O[2]&&z[3]===O[3]&&z[4]===O[4]&&z[5]===O[5]&&z[6]===O[6]&&z[7]===O[7]},it.equals=function(z,O){var B=z[0],U=z[1],X=z[2],J=z[3],ce=z[4],le=z[5],ie=z[6],ge=z[7],be=O[0],Se=O[1],Ve=O[2],Le=O[3],Be=O[4],Qe=O[5],Ue=O[6],Je=O[7];return Math.abs(B-be)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(be))&&Math.abs(U-Se)<=o.EPSILON*Math.max(1,Math.abs(U),Math.abs(Se))&&Math.abs(X-Ve)<=o.EPSILON*Math.max(1,Math.abs(X),Math.abs(Ve))&&Math.abs(J-Le)<=o.EPSILON*Math.max(1,Math.abs(J),Math.abs(Le))&&Math.abs(ce-Be)<=o.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Be))&&Math.abs(le-Qe)<=o.EPSILON*Math.max(1,Math.abs(le),Math.abs(Qe))&&Math.abs(ie-Ue)<=o.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Ue))&&Math.abs(ge-Je)<=o.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Je))},it.sqrLen=it.squaredLength=it.len=it.length=it.dot=it.mul=it.setReal=it.getReal=void 0;var o=p(W()),c=p(Nt()),f=p(fe());function g(z){if(typeof WeakMap!="function")return null;var O=new WeakMap,B=new WeakMap;return(g=function(U){return U?B:O})(z)}function p(z,O){if(z&&z.__esModule)return z;if(z===null||d(z)!=="object"&&typeof z!="function")return{default:z};var B=g(O);if(B&&B.has(z))return B.get(z);var U={},X=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in z)if(J!=="default"&&Object.prototype.hasOwnProperty.call(z,J)){var ce=X?Object.getOwnPropertyDescriptor(z,J):null;ce&&(ce.get||ce.set)?Object.defineProperty(U,J,ce):U[J]=z[J]}return U.default=z,B&&B.set(z,U),U}function x(z,O,B){var U=.5*B[0],X=.5*B[1],J=.5*B[2],ce=O[0],le=O[1],ie=O[2],ge=O[3];return z[0]=ce,z[1]=le,z[2]=ie,z[3]=ge,z[4]=U*ge+X*ie-J*le,z[5]=X*ge+J*ce-U*ie,z[6]=J*ge+U*le-X*ce,z[7]=-U*ce-X*le-J*ie,z}function I(z,O){return z[0]=O[0],z[1]=O[1],z[2]=O[2],z[3]=O[3],z[4]=O[4],z[5]=O[5],z[6]=O[6],z[7]=O[7],z}function D(z,O,B){var U=O[0],X=O[1],J=O[2],ce=O[3],le=B[4],ie=B[5],ge=B[6],be=B[7],Se=O[4],Ve=O[5],Le=O[6],Be=O[7],Qe=B[0],Ue=B[1],Je=B[2],lt=B[3];return z[0]=U*lt+ce*Qe+X*Je-J*Ue,z[1]=X*lt+ce*Ue+J*Qe-U*Je,z[2]=J*lt+ce*Je+U*Ue-X*Qe,z[3]=ce*lt-U*Qe-X*Ue-J*Je,z[4]=U*be+ce*le+X*ge-J*ie+Se*lt+Be*Qe+Ve*Je-Le*Ue,z[5]=X*be+ce*ie+J*le-U*ge+Ve*lt+Be*Ue+Le*Qe-Se*Je,z[6]=J*be+ce*ge+U*ie-X*le+Le*lt+Be*Je+Se*Ue-Ve*Qe,z[7]=ce*be-U*le-X*ie-J*ge+Be*lt-Se*Qe-Ve*Ue-Le*Je,z}it.getReal=c.copy,it.setReal=c.copy,it.mul=D;var L=c.dot;it.dot=L;var T=c.length;it.length=T,it.len=T;var k=c.squaredLength;return it.squaredLength=k,it.sqrLen=k,it}var In,wn,Xt={};function On(){if(In)return Xt;function d(O){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},d(O)}In=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=f,Xt.clone=function(O){var B=new o.ARRAY_TYPE(2);return B[0]=O[0],B[1]=O[1],B},Xt.fromValues=function(O,B){var U=new o.ARRAY_TYPE(2);return U[0]=O,U[1]=B,U},Xt.copy=function(O,B){return O[0]=B[0],O[1]=B[1],O},Xt.set=function(O,B,U){return O[0]=B,O[1]=U,O},Xt.add=function(O,B,U){return O[0]=B[0]+U[0],O[1]=B[1]+U[1],O},Xt.subtract=g,Xt.multiply=p,Xt.divide=x,Xt.ceil=function(O,B){return O[0]=Math.ceil(B[0]),O[1]=Math.ceil(B[1]),O},Xt.floor=function(O,B){return O[0]=Math.floor(B[0]),O[1]=Math.floor(B[1]),O},Xt.min=function(O,B,U){return O[0]=Math.min(B[0],U[0]),O[1]=Math.min(B[1],U[1]),O},Xt.max=function(O,B,U){return O[0]=Math.max(B[0],U[0]),O[1]=Math.max(B[1],U[1]),O},Xt.round=function(O,B){return O[0]=Math.round(B[0]),O[1]=Math.round(B[1]),O},Xt.scale=function(O,B,U){return O[0]=B[0]*U,O[1]=B[1]*U,O},Xt.scaleAndAdd=function(O,B,U,X){return O[0]=B[0]+U[0]*X,O[1]=B[1]+U[1]*X,O},Xt.distance=I,Xt.squaredDistance=D,Xt.length=L,Xt.squaredLength=T,Xt.negate=function(O,B){return O[0]=-B[0],O[1]=-B[1],O},Xt.inverse=function(O,B){return O[0]=1/B[0],O[1]=1/B[1],O},Xt.normalize=function(O,B){var U=B[0],X=B[1],J=U*U+X*X;return J>0&&(J=1/Math.sqrt(J)),O[0]=B[0]*J,O[1]=B[1]*J,O},Xt.dot=function(O,B){return O[0]*B[0]+O[1]*B[1]},Xt.cross=function(O,B,U){var X=B[0]*U[1]-B[1]*U[0];return O[0]=O[1]=0,O[2]=X,O},Xt.lerp=function(O,B,U,X){var J=B[0],ce=B[1];return O[0]=J+X*(U[0]-J),O[1]=ce+X*(U[1]-ce),O},Xt.random=function(O,B){B=B||1;var U=2*o.RANDOM()*Math.PI;return O[0]=Math.cos(U)*B,O[1]=Math.sin(U)*B,O},Xt.transformMat2=function(O,B,U){var X=B[0],J=B[1];return O[0]=U[0]*X+U[2]*J,O[1]=U[1]*X+U[3]*J,O},Xt.transformMat2d=function(O,B,U){var X=B[0],J=B[1];return O[0]=U[0]*X+U[2]*J+U[4],O[1]=U[1]*X+U[3]*J+U[5],O},Xt.transformMat3=function(O,B,U){var X=B[0],J=B[1];return O[0]=U[0]*X+U[3]*J+U[6],O[1]=U[1]*X+U[4]*J+U[7],O},Xt.transformMat4=function(O,B,U){var X=B[0],J=B[1];return O[0]=U[0]*X+U[4]*J+U[12],O[1]=U[1]*X+U[5]*J+U[13],O},Xt.rotate=function(O,B,U,X){var J=B[0]-U[0],ce=B[1]-U[1],le=Math.sin(X),ie=Math.cos(X);return O[0]=J*ie-ce*le+U[0],O[1]=J*le+ce*ie+U[1],O},Xt.angle=function(O,B){var U=O[0],X=O[1],J=B[0],ce=B[1],le=Math.sqrt(U*U+X*X)*Math.sqrt(J*J+ce*ce);return Math.acos(Math.min(Math.max(le&&(U*J+X*ce)/le,-1),1))},Xt.zero=function(O){return O[0]=0,O[1]=0,O},Xt.str=function(O){return"vec2("+O[0]+", "+O[1]+")"},Xt.exactEquals=function(O,B){return O[0]===B[0]&&O[1]===B[1]},Xt.equals=function(O,B){var U=O[0],X=O[1],J=B[0],ce=B[1];return Math.abs(U-J)<=o.EPSILON*Math.max(1,Math.abs(U),Math.abs(J))&&Math.abs(X-ce)<=o.EPSILON*Math.max(1,Math.abs(X),Math.abs(ce))},Xt.forEach=Xt.sqrLen=Xt.sqrDist=Xt.dist=Xt.div=Xt.mul=Xt.sub=Xt.len=void 0;var o=function(O,B){if(O&&O.__esModule)return O;if(O===null||d(O)!=="object"&&typeof O!="function")return{default:O};var U=c(void 0);if(U&&U.has(O))return U.get(O);var X={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ce in O)if(ce!=="default"&&Object.prototype.hasOwnProperty.call(O,ce)){var le=J?Object.getOwnPropertyDescriptor(O,ce):null;le&&(le.get||le.set)?Object.defineProperty(X,ce,le):X[ce]=O[ce]}return X.default=O,U&&U.set(O,X),X}(W());function c(O){if(typeof WeakMap!="function")return null;var B=new WeakMap,U=new WeakMap;return(c=function(X){return X?U:B})(O)}function f(){var O=new o.ARRAY_TYPE(2);return o.ARRAY_TYPE!=Float32Array&&(O[0]=0,O[1]=0),O}function g(O,B,U){return O[0]=B[0]-U[0],O[1]=B[1]-U[1],O}function p(O,B,U){return O[0]=B[0]*U[0],O[1]=B[1]*U[1],O}function x(O,B,U){return O[0]=B[0]/U[0],O[1]=B[1]/U[1],O}function I(O,B){return Math.hypot(B[0]-O[0],B[1]-O[1])}function D(O,B){var U=B[0]-O[0],X=B[1]-O[1];return U*U+X*X}function L(O){return Math.hypot(O[0],O[1])}function T(O){var B=O[0],U=O[1];return B*B+U*U}Xt.len=L,Xt.sub=g,Xt.mul=p,Xt.div=x,Xt.dist=I,Xt.sqrDist=D,Xt.sqrLen=T;var k,z=(k=f(),function(O,B,U,X,J,ce){var le,ie;for(B||(B=2),U||(U=0),ie=X?Math.min(X*B+U,O.length):O.length,le=U;le<ie;le+=B)k[0]=O[le],k[1]=O[le+1],J(k,k,ce),O[le]=k[0],O[le+1]=k[1];return O});return Xt.forEach=z,Xt}function cr(){if(wn)return A;function d(O){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},d(O)}wn=1,Object.defineProperty(A,"__esModule",{value:!0}),A.vec4=A.vec3=A.vec2=A.quat2=A.quat=A.mat4=A.mat3=A.mat2d=A.mat2=A.glMatrix=void 0;var o=z(W());A.glMatrix=o;var c=z(Z());A.mat2=c;var f=z(me());A.mat2d=f;var g=z(De());A.mat3=g;var p=z(fe());A.mat4=p;var x=z(Nt());A.quat=x;var I=z(nn());A.quat2=I;var D=z(On());A.vec2=D;var L=z(Oe());A.vec3=L;var T=z(bt());function k(O){if(typeof WeakMap!="function")return null;var B=new WeakMap,U=new WeakMap;return(k=function(X){return X?U:B})(O)}function z(O,B){if(O&&O.__esModule)return O;if(O===null||d(O)!=="object"&&typeof O!="function")return{default:O};var U=k(B);if(U&&U.has(O))return U.get(O);var X={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ce in O)if(ce!=="default"&&Object.prototype.hasOwnProperty.call(O,ce)){var le=J?Object.getOwnPropertyDescriptor(O,ce):null;le&&(le.get||le.set)?Object.defineProperty(X,ce,le):X[ce]=O[ce]}return X.default=O,U&&U.set(O,X),X}return A.vec4=T,A}var En,fn,ur,br,Pe=cr(),jn=function(){if(fn)return En;function d(o,c,f,g){this.cx=3*o,this.bx=3*(f-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(g-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=f,this.p2y=g}return fn=1,En=d,d.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,c){if(c===void 0&&(c=1e-6),o<0)return 0;if(o>1)return 1;for(var f=o,g=0;g<8;g++){var p=this.sampleCurveX(f)-o;if(Math.abs(p)<c)return f;var x=this.sampleCurveDerivativeX(f);if(Math.abs(x)<1e-6)break;f-=p/x}var I=0,D=1;for(f=o,g=0;g<20&&(p=this.sampleCurveX(f),!(Math.abs(p-o)<c));g++)o>p?I=f:D=f,f=.5*(D-I)+I;return f},solve:function(o,c){return this.sampleCurveY(this.solveCurveX(o,c))}},En}(),rr=v(jn);function Yn(){if(br)return ur;function d(o,c){this.x=o,this.y=c}return br=1,ur=d,d.prototype={clone:function(){return new d(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,c){return this.clone()._rotateAround(o,c)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var c=o.x-this.x,f=o.y-this.y;return c*c+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,c){return Math.atan2(this.x*c-this.y*o,this.x*o+this.y*c)},_matMult:function(o){var c=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=c,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var c=Math.cos(o),f=Math.sin(o),g=f*this.x+c*this.y;return this.x=c*this.x-f*this.y,this.y=g,this},_rotateAround:function(o,c){var f=Math.cos(o),g=Math.sin(o),p=c.y+g*(this.x-c.x)+f*(this.y-c.y);return this.x=c.x+f*(this.x-c.x)-g*(this.y-c.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},d.convert=function(o){return o instanceof d?o:Array.isArray(o)?new d(o[0],o[1]):o},ur}var Ot=v(Yn());function Sr(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let c=0;c<d.length;c++)if(!Sr(d[c],o[c]))return!1;return!0}if(typeof d=="object"&&d!==null&&o!==null){if(typeof o!="object"||Object.keys(d).length!==Object.keys(o).length)return!1;for(const c in d)if(!Sr(d[c],o[c]))return!1;return!0}return d===o}const fi=Math.PI/180,Wr=180/Math.PI;function Mn(d){return d*fi}function jt(d){return d*Wr}const Ln=[[0,0],[1,0],[1,1],[0,1]];function un(d){if(d<=0)return 0;if(d>=1)return 1;const o=d*d,c=o*d;return 4*(d<.5?c:3*(d-o)+c-.75)}function Xn(d,o,c,f){const g=new rr(d,o,c,f);return function(p){return g.solve(p)}}const Ni=Xn(.25,.1,.25,1);function Bn(d,o,c){return Math.min(c,Math.max(o,d))}function Es(d,o,c){return(c=Bn((c-d)/(o-d),0,1))*c*(3-2*c)}function Si(d,o,c){const f=c-o,g=((d-o)%f+f)%f+o;return g===o?c:g}function cs(d,o,c){if(!d.length)return c(null,[]);let f=d.length;const g=new Array(d.length);let p=null;d.forEach((x,I)=>{o(x,(D,L)=>{D&&(p=D),g[I]=L,--f==0&&c(p,g)})})}function Oi(d,...o){for(const c of o)for(const f in c)d[f]=c[f];return d}let mn=1;function hr(){return mn++}function Tr(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log(d)/Math.LN2))}function Li(d,o){d.forEach(c=>{o[c]&&(o[c]=o[c].bind(o))})}function pi(d,o,c){const f={};for(const g in d)f[g]=o.call(this,d[g],g,d);return f}function rn(d,o,c){const f={};for(const g in d)o.call(this,d[g],g,d)&&(f[g]=d[g]);return f}function Rr(d){return Array.isArray(d)?d.map(Rr):typeof d=="object"&&d?pi(d,Rr):d}const $r={};function Nr(d){$r[d]||(typeof console<"u"&&console.warn(d),$r[d]=!0)}function ri(d,o,c){return(c.y-d.y)*(o.x-d.x)>(o.y-d.y)*(c.x-d.x)}function Ec(d){let o=0;for(let c,f,g=0,p=d.length,x=p-1;g<p;x=g++)c=d[g],f=d[x],o+=(f.x-c.x)*(c.y+f.y);return o}function Sc([d,o,c]){const f=Mn(o+90),g=Mn(c);return{x:d*Math.cos(f)*Math.sin(g),y:d*Math.sin(f)*Math.sin(g),z:d*Math.cos(g),azimuthal:o,polar:c}}function Zr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ra(d){const o={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,g,p)=>{const x=g||p;return o[f]=!x||x.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o}let Tc=null;function za(d,o){return[d[4*o],d[4*o+1],d[4*o+2],d[4*o+3]]}function ia(d,o,c,f){for(;o<c;){const g=o+c>>1;d[g]<f?o=g+1:c=g}return o}function sc(d,o,c,f){for(;o<c;){const g=o+c>>1;d[g]<=f?o=g+1:c=g}return o}function io(d){return d>0?1/(1.001-d):1+d}function It(d){return d>0?1-1/(1.001-d):-d}const Te={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Te.API_URL)return null;try{const d=new URL(Te.API_URL);return d.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":d.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Me(d){return Te.API_URL_REGEX.test(d)}function qe(d){return Te.API_SPRITE_REGEX.test(d)}let nt,rt,ct,Tt,ut,ht;function Dt(){return nt==null&&(nt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),nt}const Mt={now:()=>Tt!==void 0?Tt:performance.now(),setNow(d){Tt=d},restoreNow(){Tt=void 0},frame(d){const o=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(d,o=0){const{width:c,height:f}=d;ut||(ut=document.createElement("canvas"));const g=ut.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(c>ut.width||f>ut.height)&&(ut.width=c,ut.height=f),g.clearRect(-o,-o,c+2*o,f+2*o),g.drawImage(d,0,0,c,f),g.getImageData(-o,-o,c+2*o,f+2*o)},resolveURL:d=>(rt||(rt=document.createElement("a")),rt.href=d,rt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ct==null&&(ct=window.matchMedia("(prefers-reduced-motion: reduce)")),ct.matches)},hasCanvasFingerprintNoise(){if(ht!==void 0)return ht;if(!Dt())return ht=!1,!1;const d=new OffscreenCanvas(85,1),o=d.getContext("2d",{willReadFrequently:!0});let c=0;for(let g=0;g<d.width;++g)o.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,o.fillRect(g,0,1,1);const f=o.getImageData(0,0,d.width,d.height);c=0;for(let g=0;g<f.data.length;++g)if(g%4!=3&&c++!==f.data[g])return ht=!0,!0;return ht=!1,!1}};function Kt(d,o){const c=d.indexOf("?");if(c<0)return`${d}?${new URLSearchParams(o).toString()}`;const f=new URLSearchParams(d.slice(c));for(const g in o)f.set(g,o[g]);return`${d.slice(0,c)}?${f.toString()}`}function hn(d,o={persistentParams:[]}){const c=d.indexOf("?");if(c<0)return d;const f=new URLSearchParams,g=new URLSearchParams(d.slice(c));for(const x of o.persistentParams){const I=g.get(x);I&&f.set(x,I)}const p=f.toString();return`${d.slice(0,c)}${p.length>0?`?${p}`:""}`}const yn="mapbox-tiles";let Jn=500,ir=50;const xr=["language","worldview","jobid"];let vr,ii;function si(){try{return caches}catch{}}function er(){const d=si();d&&vr==null&&(vr=d.open(yn))}let li=1/0;const zr={supported:!1,testSupport:function(d){!Bs&&an&&(ci?Xo(d):oi=d)}};let oi,an,Bs=!1,ci=!1;const xo=typeof self<"u"?self:{};function Xo(d){const o=d.createTexture();d.bindTexture(d.TEXTURE_2D,o);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,an),d.isContextLost())return;zr.supported=!0}catch{}d.deleteTexture(o),Bs=!0}xo.document&&(an=xo.document.createElement("img"),an.onload=function(){oi&&Xo(oi),oi=null,ci=!0},an.onerror=function(){Bs=!0,oi=null},an.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(qr);class Gr extends Error{constructor(o,c,f){c===401&&Me(f)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=c,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ti=Zr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ko=function(d,o){if(!(/^file:/.test(c=d.url)||/^file:/.test(Ti())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(f,g){const p=new AbortController,x=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Ti(),referrerPolicy:f.referrerPolicy,signal:p.signal});let I=!1,D=!1;const L=(T=x.url).indexOf("sku=")>0&&Me(T);var T;f.type==="json"&&x.headers.set("Accept","application/json");const k=(O,B,U)=>{if(D)return;if(O&&O.message!=="SecurityError"&&Nr(O.toString()),B&&U)return z(B);const X=Date.now();fetch(x).then(J=>{if(J.ok){const ce=L?J.clone():null;return z(J,ce,X)}return g(new Gr(J.statusText,J.status,f.url))}).catch(J=>{J.name!=="AbortError"&&g(new Error(`${J.message} ${f.url}`))})},z=(O,B,U)=>{(f.type==="arrayBuffer"?O.arrayBuffer():f.type==="json"?O.json():O.text()).then(X=>{D||(B&&U&&function(J,ce,le){if(er(),vr==null)return;const ie=ra(ce.headers.get("Cache-Control")||"");if(ie["no-store"])return;const ge={status:ce.status,statusText:ce.statusText,headers:new Headers};ce.headers.forEach((Ve,Le)=>ge.headers.set(Le,Ve)),ie["max-age"]&&ge.headers.set("Expires",new Date(le+1e3*ie["max-age"]).toUTCString());const be=ge.headers.get("Expires");if(!be||new Date(be).getTime()-le<42e4)return;let Se=hn(J.url,{persistentParams:xr});if(ce.status===206){const Ve=J.headers.get("Range");if(!Ve)return;ge.status=200,Se=Kt(Se,{range:Ve})}(function(Ve,Le){if(ii===void 0)try{new Response(new ReadableStream),ii=!0}catch{ii=!1}ii?Le(Ve.body):Ve.blob().then(Le)})(ce,Ve=>{const Le=new Response((Be=ce.status)!==200&&Be!==404&&[101,103,204,205,304].includes(Be)?null:Ve,ge);var Be;er(),vr?.then(Qe=>Qe.put(Se,Le)).catch(Qe=>Nr(Qe.message))})}(x,B,U),I=!0,g(null,X,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(X=>{D||g(new Error(X.message))})};return L?function(O,B){if(er(),vr==null)return B(null);vr.then(U=>{let X=hn(O.url,{persistentParams:xr});const J=O.headers.get("Range");J&&(X=Kt(X,{range:J})),U.match(X).then(ce=>{const le=function(ie){if(!ie)return!1;const ge=new Date(ie.headers.get("Expires")||0),be=ra(ie.headers.get("Cache-Control")||"");return ge>Date.now()&&!be["no-cache"]}(ce);U.delete(X),le&&U.put(X,ce.clone()),B(null,ce,le)}).catch(B)}).catch(B)}(x,k):k(null,null),{cancel:()=>{D=!0,I||p.abort()}}}(d,o);if(Zr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",d,o,void 0,!0)}var c;return function(f,g){const p=new XMLHttpRequest;p.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const x in f.headers)p.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=f.credentials==="include",p.onerror=()=>{g(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let x=p.response;if(f.type==="json")try{x=JSON.parse(p.response)}catch(I){return g(I)}g(null,x,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else g(new Gr(p.statusText,p.status,f.url))},p.send(f.body),{cancel:()=>p.abort()}}(d,o)},xa=function(d,o){return Ko(Oi(d,{type:"arrayBuffer"}),o)};function Eu(d){const o=document.createElement("a");return o.href=d,o.protocol===location.protocol&&o.host===location.host}const $s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ka,Su;Ka=[],Su=0;const zs=function(d,o){if(zr.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*"),Su>=Te.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:d,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Ka.push(p),p}Su++;let c=!1;const f=()=>{if(!c)for(c=!0,Su--;Ka.length&&Su<Te.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Ka.shift(),{requestParameters:x,callback:I,cancelled:D}=p;D||(p.cancel=zs(x,I).cancel)}},g=xa(d,(p,x,I,D)=>{f(),p?o(p):x&&(self.createImageBitmap?function(L,T){const k=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(k).then(z=>{T(null,z)}).catch(z=>{T(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(L,T)=>o(L,T,I,D)):function(L,T){const k=new Image;k.onload=()=>{T(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=$s})},k.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Blob([new Uint8Array(L)],{type:"image/png"});k.src=L.byteLength?URL.createObjectURL(z):$s}(x,(L,T)=>o(L,T,I,D)))});return{cancel:()=>{g.cancel(),f()}}};var Ml,Uf,va,Ii={exports:{}},ns={exports:{}},Vt={exports:{}},ot=function(){if(va)return Ii.exports;va=1;var d=(Ml||(Ml=1,ns.exports=function(c,f){var g,p,x,I,D,L,T,k;for(p=c.length-(g=3&c.length),x=f,D=3432918353,L=461845907,k=0;k<p;)T=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24,++k,x=27492+(65535&(I=5*(65535&(x=(x^=T=(65535&(T=(T=(65535&T)*D+(((T>>>16)*D&65535)<<16)&4294967295)<<15|T>>>17))*L+(((T>>>16)*L&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(I>>>16)&65535)<<16);switch(T=0,g){case 3:T^=(255&c.charCodeAt(k+2))<<16;case 2:T^=(255&c.charCodeAt(k+1))<<8;case 1:x^=T=(65535&(T=(T=(65535&(T^=255&c.charCodeAt(k)))*D+(((T>>>16)*D&65535)<<16)&4294967295)<<15|T>>>17))*L+(((T>>>16)*L&65535)<<16)&4294967295}return x^=c.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),ns.exports),o=(Uf||(Uf=1,Vt.exports=function(c,f){for(var g,p=c.length,x=f^p,I=0;p>=4;)g=1540483477*(65535&(g=255&c.charCodeAt(I)|(255&c.charCodeAt(++I))<<8|(255&c.charCodeAt(++I))<<16|(255&c.charCodeAt(++I))<<24))+((1540483477*(g>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),p-=4,++I;switch(p){case 3:x^=(255&c.charCodeAt(I+2))<<16;case 2:x^=(255&c.charCodeAt(I+1))<<8;case 1:x=1540483477*(65535&(x^=255&c.charCodeAt(I)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Vt.exports);return Ii.exports=d,Ii.exports.murmur3=d,Ii.exports.murmur2=o,Ii.exports}(),Fn=v(ot);class zi{constructor(o,...c){Oi(this,c[0]||{}),this.type=o}}class so extends zi{constructor(o,c={}){super("error",Oi({error:o},c))}}function Zc(d,o,c){c[d]&&c[d].indexOf(o)!==-1||(c[d]=c[d]||[],c[d].push(o))}function Tu(d,o,c){if(c&&c[d]){const f=c[d].indexOf(o);f!==-1&&c[d].splice(f,1)}}class qs{on(o,c){return this._listeners=this._listeners||{},Zc(o,c,this._listeners),this}off(o,c){return Tu(o,c,this._listeners),Tu(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Zc(o,c,this._oneTimeListeners),this):new Promise(f=>{this.once(o,f)})}fire(o,c){const f=typeof o=="string"?new zi(o,c):o,g=f.type;if(this.listens(g)){f.target=this;const p=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const D of p)D.call(this,f);const x=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const D of x)Tu(g,D,this._oneTimeListeners),D.call(this,f);const I=this._eventedParent;I&&(Oi(f,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(f))}else f instanceof so&&console.error(f.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}class mr{constructor(o){typeof o=="string"?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new mr(o)}static toString(o){return o.iconsetId?`${o.name}${o.iconsetId}`:o.name}static parse(o){const[c,f]=o.split("");return new mr({name:c,iconsetId:f})}static isEqual(o,c){return o.name===c.name&&o.iconsetId===c.iconsetId}toString(){return mr.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var js,Wh={},Za=function(){if(js)return Wh;js=1;var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(p){return(p=Math.round(p))<0?0:p>255?255:p}function c(p){return o(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function f(p){return(x=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:x>1?1:x;var x}function g(p,x,I){return I<0?I+=1:I>1&&(I-=1),6*I<1?p+(x-p)*I*6:2*I<1?x:3*I<2?p+(x-p)*(2/3-I)*6:p}try{Wh.parseCSSColor=function(p){var x,I=p.replace(/ /g,"").toLowerCase();if(I in d)return d[I].slice();if(I[0]==="#")return I.length===4?(x=parseInt(I.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:I.length===7&&(x=parseInt(I.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var D=I.indexOf("("),L=I.indexOf(")");if(D!==-1&&L+1===I.length){var T=I.substr(0,D),k=I.substr(D+1,L-(D+1)).split(","),z=1;switch(T){case"rgba":if(k.length!==4)return null;z=f(k.pop());case"rgb":return k.length!==3?null:[c(k[0]),c(k[1]),c(k[2]),z];case"hsla":if(k.length!==4)return null;z=f(k.pop());case"hsl":if(k.length!==3)return null;var O=(parseFloat(k[0])%360+360)%360/360,B=f(k[1]),U=f(k[2]),X=U<=.5?U*(B+1):U+B-U*B,J=2*U-X;return[o(255*g(J,X,O+1/3)),o(255*g(J,X,O)),o(255*g(J,X,O-1/3)),z];default:return null}}return null}}catch{}return Wh}();class Qr{constructor(o,c,f,g=1){this.r=o,this.g=c,this.b=f,this.a=g}static parse(o){if(!o)return;if(o instanceof Qr)return o;if(typeof o!="string")return;const c=Za.parseCSSColor(o);return c?new Qr(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toStringPremultipliedAlpha(){const[o,c,f,g]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(c)},${Math.round(f)},${g})`}toString(){const[o,c,f,g]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*c)},${Math.round(255*f)},${g})`}toRenderColor(o){const{r:c,g:f,b:g,a:p}=this;return new ja(o,c,f,g,p)}clone(){return new Qr(this.r,this.g,this.b,this.a)}}class ja{constructor(o,c,f,g,p){if(o){const x=o.image.height,I=x*x;c=p===0?0:c/p*(x-1),f=p===0?0:f/p*(x-1),g=p===0?0:g/p*(x-1);const D=Math.floor(c),L=Math.floor(f),T=Math.floor(g),k=Math.ceil(c),z=Math.ceil(f),O=Math.ceil(g),B=c-D,U=f-L,X=g-T,J=o.image.data,ce=4*(D+L*I+T*x),le=4*(D+L*I+O*x),ie=4*(D+z*I+T*x),ge=4*(D+z*I+O*x),be=4*(k+L*I+T*x),Se=4*(k+L*I+O*x),Ve=4*(k+z*I+T*x),Le=4*(k+z*I+O*x);if(ce<0||Le>=J.length)throw new Error("out of range");this.r=Wn(Wn(Wn(J[ce],J[le],X),Wn(J[ie],J[ge],X),U),Wn(Wn(J[be],J[Se],X),Wn(J[Ve],J[Le],X),U),B)/255*p,this.g=Wn(Wn(Wn(J[ce+1],J[le+1],X),Wn(J[ie+1],J[ge+1],X),U),Wn(Wn(J[be+1],J[Se+1],X),Wn(J[Ve+1],J[Le+1],X),U),B)/255*p,this.b=Wn(Wn(Wn(J[ce+2],J[le+2],X),Wn(J[ie+2],J[ge+2],X),U),Wn(Wn(J[be+2],J[Se+2],X),Wn(J[Ve+2],J[Le+2],X),U),B)/255*p,this.a=p}else this.r=c,this.g=f,this.b=g,this.a=p}toArray(){const{r:o,g:c,b:f,a:g}=this;return g===0?[0,0,0,0]:[255*o/g,255*c/g,255*f/g,g]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:o,g:c,b:f,a:g}=this,p=Math.min(Math.max(o/g,0),1),x=Math.min(Math.max(c/g,0),1),I=Math.min(Math.max(f/g,0),1),D=Math.min(p,x,I),L=Math.max(p,x,I),T=(D+L)/2;if(D===L)return[0,0,100*T,g];const k=L-D,z=T>.5?k/(2-L-D):k/(L+D);let O=0;return L===p?O=(x-I)/k+(x<I?6:0):L===x?O=(I-p)/k+2:L===I&&(O=(p-x)/k+4),O*=60,[Math.min(Math.max(O,0),360),Math.min(Math.max(100*z,0),100),Math.min(Math.max(100*T,0),100),g]}toArray01(){const{r:o,g:c,b:f,a:g}=this;return g===0?[0,0,0,0]:[o/g,c/g,f/g,g]}toArray01Scaled(o){const{r:c,g:f,b:g,a:p}=this;return p===0?[0,0,0]:[c/p*o,f/p*o,g/p*o]}toArray01PremultipliedAlpha(){const{r:o,g:c,b:f,a:g}=this;return[o,c,f,g]}toArray01Linear(){const{r:o,g:c,b:f,a:g}=this;return g===0?[0,0,0,0]:[Math.pow(o/g,2.2),Math.pow(c/g,2.2),Math.pow(f/g,2.2),g]}}function Wn(d,o,c){return d*(1-c)+o*c}function Bd(d,o,c){return d.map((f,g)=>Wn(f,o[g],c))}function fo(d){return d*d*d*d*d}Qr.black=new Qr(0,0,0,1),Qr.white=new Qr(1,1,1,1),Qr.transparent=new Qr(0,0,0,0),Qr.red=new Qr(1,0,0,1),Qr.blue=new Qr(0,0,1,1);var ba=Object.freeze({__proto__:null,array:Bd,color:function(d,o,c){return new Qr(Wn(d.r,o.r,c),Wn(d.g,o.g,c),Wn(d.b,o.b,c),Wn(d.a,o.a,c))},easeIn:fo,number:Wn});function Or(d,...o){for(const c of o)for(const f in c)d[f]=c[f];return d}class Ir extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class $h{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[f,g]of c)this.bindings[f]=g}concat(o){return new $h(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Vr={kind:"null"},vn={kind:"number"},ui={kind:"string"},Ur={kind:"boolean"},oo={kind:"color"},Va={kind:"object"},Yr={kind:"value"},Oo={kind:"collator"},Pl={kind:"formatted"},sa={kind:"resolvedImage"};function Ci(d,o){return{kind:"array",itemType:d,N:o}}function us(d){if(d.kind==="array"){const o=us(d.itemType);return typeof d.N=="number"?`array<${o}, ${d.N}>`:d.itemType.kind==="value"?"array":`array<${o}>`}return d.kind}const oa=[Vr,vn,ui,Ur,oo,Pl,Va,Ci(Yr),sa];function po(d,o){if(o.kind==="error")return null;if(d.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!po(d.itemType,o.itemType))&&(typeof d.N!="number"||d.N===o.N))return null}else{if(d.kind===o.kind)return null;if(d.kind==="value"){for(const c of oa)if(!po(c,o))return null}}return`Expected ${us(d)} but found ${us(o)} instead.`}function Qu(d,o){return o.some(c=>c.kind===d.kind)}function Cc(d,o){return o.some(c=>c==="null"?d===null:c==="array"?Array.isArray(d):c==="object"?d&&!Array.isArray(d)&&typeof d=="object":c===typeof d)}class Ic{constructor(o,c,f){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Cu{constructor(o,c,f,g,p){this.text=o.normalize?o.normalize():o,this.image=c,this.scale=f,this.fontStack=g,this.textColor=p}}class Rs{constructor(o){this.sections=o}static fromString(o){return new Rs([new Cu(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof Rs?o:Rs.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const c of this.sections){if(c.image){const g=c.image.getPrimary().id.toString();o.push(["image",g]);continue}o.push(c.text);const f={};c.fontStack&&(f["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(f["font-scale"]=c.scale),c.textColor&&(f["text-color"]=["rgba"].concat(c.textColor.toRenderColor(null).toArray())),o.push(f)}return o}}class hl{constructor(o,c={}){if(this.id=mr.from(o),this.options=Object.assign({},c),c.transform){const{a:f,b:g,c:p,d:x,e:I,f:D}=c.transform;this.options.transform=new DOMMatrix([f,g,p,x,I,D])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:o,b:c,c:f,d:g,e:p,f:x}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:o,b:c,c:f,d:g,e:p,f:x}})}static parse(o){let c,f,g,p;try{({name:c,iconsetId:f,params:g,transform:p}=JSON.parse(o)||{})}catch{return null}if(!c)return null;const{a:x,b:I,c:D,d:L,e:T,f:k}=p||{};return new hl({name:c,iconsetId:f},{params:g,transform:new DOMMatrix([x,I,D,L,T,k])})}scaleSelf(o){return this.options.transform.scaleSelf(o),this}}class hi{constructor(o,c,f,g,p=!1){this.primaryId=mr.from(o),this.primaryOptions=c,f&&(this.secondaryId=mr.from(f)),this.secondaryOptions=g,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new hl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new hl(this.secondaryId,this.secondaryOptions):null}static from(o){return typeof o=="string"?hi.build({name:o}):o}static build(o,c,f,g){return!o||typeof o=="object"&&!("name"in o)?null:new hi(o,f,c,g)}}function Dl(d,o,c,f){return typeof d=="number"&&d>=0&&d<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[d,o,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[d,o,c,f]:[d,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function aa(d){if(d===null||typeof d=="string"||typeof d=="boolean"||typeof d=="number"||d instanceof Qr||d instanceof Ic||d instanceof Rs||d instanceof hi)return!0;if(Array.isArray(d)){for(const o of d)if(!aa(o))return!1;return!0}if(typeof d=="object"){for(const o in d)if(!aa(d[o]))return!1;return!0}return!1}function Ki(d){if(d===null)return Vr;if(typeof d=="string")return ui;if(typeof d=="boolean")return Ur;if(typeof d=="number")return vn;if(d instanceof Qr)return oo;if(d instanceof Ic)return Oo;if(d instanceof Rs)return Pl;if(d instanceof hi)return sa;if(Array.isArray(d)){const o=d.length;let c;for(const f of d){const g=Ki(f);if(c){if(c===g)continue;c=Yr;break}c=g}return Ci(c||Yr,o)}return Va}function Gs(d){const o=typeof d;return d===null?"":o==="string"||o==="number"||o==="boolean"?String(d):d instanceof Qr?d.toStringPremultipliedAlpha():d instanceof Rs||d instanceof hi?d.toString():JSON.stringify(d)}class Zt{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(o.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!aa(o[1]))return c.error("invalid value");const f=o[1];let g=Ki(f);const p=c.expectedType;return g.kind!=="array"||g.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(g=p),new Zt(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Rs?this.value.serialize():this.value}}class _r{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const vo={string:ui,number:vn,boolean:Ur,object:Va};class Lo{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let f,g=1;const p=o[0];if(p==="array"){let I,D;if(o.length>2){const L=o[1];if(typeof L!="string"||!(L in vo)||L==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);I=vo[L],g++}else I=Yr;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);D=o[2],g++}f=Ci(I,D)}else f=vo[p];const x=[];for(;g<o.length;g++){const I=c.parse(o[g],g,Yr);if(!I)return null;x.push(I)}return new Lo(f,x)}evaluate(o){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(o);if(!po(this.type,Ki(f)))return f;if(c===this.args.length-1)throw new _r(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${us(Ki(f))} but was expected to be of type ${us(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,c=[o.kind];if(o.kind==="array"){const f=o.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){c.push(f.kind);const g=o.N;(typeof g=="number"||this.args.length>1)&&c.push(g)}}return c.concat(this.args.map(f=>f.serialize()))}}class dl{constructor(o){this.type=Pl,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const g=[];let p=!1;for(let x=1;x<=o.length-1;++x){const I=o[x];if(p&&typeof I=="object"&&!Array.isArray(I)){p=!1;let D=null;if(I["font-scale"]&&(D=c.parseObjectValue(I["font-scale"],x,"font-scale",vn),!D))return null;let L=null;if(I["text-font"]&&(L=c.parseObjectValue(I["text-font"],x,"text-font",Ci(ui)),!L))return null;let T=null;if(I["text-color"]&&(T=c.parseObjectValue(I["text-color"],x,"text-color",oo),!T))return null;const k=g[g.length-1];k.scale=D,k.font=L,k.textColor=T}else{const D=c.parse(o[x],x,Yr);if(!D)return null;const L=D.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,g.push({content:D,scale:null,font:null,textColor:null})}}return new dl(g)}evaluate(o){return new Rs(this.sections.map(c=>{const f=c.content.evaluate(o);return Ki(f)===sa?new Cu("",f,null,null,null):new Cu(Gs(f),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const c of this.sections){o.push(c.content.serialize());const f={};c.scale&&(f["font-scale"]=c.scale.serialize()),c.font&&(f["text-font"]=c.font.serialize()),c.textColor&&(f["text-color"]=c.textColor.serialize()),o.push(f)}return o}}class oc{constructor(o,c,f,g){this._imageWarnHistory={},this.type=sa,this.namePrimary=o,this.nameSecondary=c,f&&(this.paramsPrimary=f.params,this.iconsetIdPrimary=f.iconset?f.iconset.id:void 0),g&&(this.paramsSecondary=g.params,this.iconsetIdSecondary=g.iconset?g.iconset.id:void 0)}static parse(o,c){if(o.length<2)return c.error("Expected two or more arguments.");let f=1;const g=[];function p(){if(f<o.length){const I=c.parse(o[f],f++,ui);return I?(g.push({image:I,options:{}}),!0):(c.error(g.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(f<o.length){const D=o[f];if((I=D)===null||typeof I!="object"||Array.isArray(I))return!0;const L=D.params,T=D.iconset,k=c.concat(f);if(!L&&!T)return f++,!0;if(L){if(typeof L!="object"||L.constructor!==Object)return k.error('Image options "params" should be an object'),!1;const z={},O=k.concat(void 0,"params");for(const B in L){if(!B)return O.error("Image parameter name should be non-empty"),!1;const U=O.concat(void 0,B).parse(L[B],void 0,oo,void 0,{typeAnnotation:"coerce"});if(!U)return!1;z[B]=U}g[g.length-1].options.params=z}if(T){if(typeof T!="object"||T.constructor!==Object)return k.error('Image options "iconset" should be an object'),!1;if(!T.id)return k.error('Image options "iconset" should have an "id" property'),!1;g[g.length-1].options.iconset=T}return f++,!0}var I;return!0}for(let I=0;I<2;I++)if(!p()||!x())return;return new oc(g[0].image,g[1]?g[1].image:void 0,g[0].options,g[1]?g[1].options:void 0)}evaluateParams(o,c){const f={};if(c){for(const g in c)if(c[g])try{f[g]=c[g].evaluate(o)}catch{continue}if(Object.keys(f).length!==0)return{params:f}}}evaluate(o){const c={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},f=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,g=hi.build(c,f,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(g&&o.availableImages){const p=g.getPrimary().id;if(g.available=o.availableImages.some(x=>mr.isEqual(x,p)),g.available){const x=g.getSecondary()?g.getSecondary().id:null;x&&(g.available=o.availableImages.some(I=>mr.isEqual(I,x)))}}return g}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&o(this.paramsPrimary[c]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&o(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(o,c){const f={};if(c&&(f.iconset={id:c}),o){f.params={};for(const g in o)o[g]&&(f.params[g]=o[g].serialize())}return Object.keys(f).length>0?f:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&o.push(c)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&o.push(c)}return o}}function kl(d){return d instanceof Number?"number":d instanceof String?"string":d instanceof Boolean?"boolean":Array.isArray(d)?"array":d===null?"null":typeof d}const zd={"to-boolean":Ur,"to-color":oo,"to-number":vn,"to-string":ui};class Ua{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[0],g=[];let p=Vr;if(f==="to-array"){if(!Array.isArray(o[1]))return null;const x=o[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);p=Ci(c.expectedType.itemType,x)}else{if(!(x>0&&aa(o[1][0])))return null;p=Ci(Ki(o[1][0]),x)}for(let I=0;I<x;I++){const D=o[1][I];let L;if(kl(D)==="array")L=c.parse(D,void 0,p.itemType);else{const T=kl(D);if(T!==p.itemType.kind)return c.error(`Expected ${p.itemType.kind} but found ${T}.`);L=c.registry.literal.parse(["literal",D===void 0?null:D],c)}if(!L)return null;g.push(L)}}else{if((f==="to-boolean"||f==="to-string")&&o.length!==2)return c.error("Expected one argument.");p=zd[f];for(let x=1;x<o.length;x++){const I=c.parse(o[x],x,Yr);if(!I)return null;g.push(I)}}return new Ua(p,g)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let c,f;for(const g of this.args){if(c=g.evaluate(o),f=null,c instanceof Qr)return c;if(typeof c=="string"){const p=o.parseColor(c);if(p)return p}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Dl(c[0],c[1],c[2],c[3]),!f))return new Qr(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new _r(f||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const f of this.args){if(c=f.evaluate(o),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new _r(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?Rs.fromString(Gs(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?hi.build(Gs(this.args[0].evaluate(o))):this.type.kind==="array"?this.args.map(c=>c.evaluate(o)):Gs(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new dl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new oc(this.args[0]).serialize();const o=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{o.push(c.serialize())}),o}}const mo=["Unknown","Point","LineString","Polygon"];class ac{constructor(o,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:f,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(f*c-o[0])+this.featureDistanceData.bearing[1]*(g*c-o[1])}return 0}parseColor(o){let c=this._parseColorCache[o];return c||(c=this._parseColorCache[o]=Qr.parse(o)),c}getConfig(o){return this.options?this.options.get(o):null}}class Mi{constructor(o,c,f,g,p){this.name=o,this.type=c,this._evaluate=f,this.args=g,this._overloadIndex=p}evaluate(o){if(!this._evaluate){const c=Mi.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,c){const f=o[0],g=Mi.definitions[f];if(!g)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,I=[];let D=null,L=-1;for(const[T,k]of x){if(Array.isArray(T)&&T.length!==o.length-1)continue;I.push(T),L++,D=new Ux(c.registry,c.path,null,c.scope,void 0,c._scope,c.options);const z=[];let O=!1;for(let B=1;B<o.length;B++){const U=o[B],X=Array.isArray(T)?T[B-1]:T.type,J=D.parse(U,1+z.length,X);if(!J){O=!0;break}z.push(J)}if(!O)if(Array.isArray(T)&&T.length!==z.length)D.error(`Expected ${T.length} arguments, but found ${z.length} instead.`);else{for(let B=0;B<z.length;B++){const U=Array.isArray(T)?T[B]:T.type,X=z[B];D.concat(B+1).checkSubtype(U,X.type)}if(D.errors.length===0)return new Mi(f,p,k,z,L)}}if(I.length===1)c.errors.push(...D.errors);else{const T=(I.length?I:x.map(([z])=>z)).map(Ju).join(" | "),k=[];for(let z=1;z<o.length;z++){const O=c.parse(o[z],1+k.length);if(!O)return null;k.push(us(O.type))}c.error(`Expected arguments of type ${T}, but found (${k.join(", ")}) instead.`)}return null}static register(o,c){Mi.definitions=c;for(const f in c)o[f]=Mi}}function Ju(d){return Array.isArray(d)?`(${d.map(us).join(", ")})`:`(${us(d.type)}...)`}class bo{constructor(o,c,f){this.type=Oo,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(o.length!==2)return c.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const g=f["case-sensitive"]===void 0?c.parse(!1,1,Ur):c.parseObjectValue(f["case-sensitive"],1,"case-sensitive",Ur);if(!g)return null;const p=f["diacritic-sensitive"]===void 0?c.parse(!1,1,Ur):c.parseObjectValue(f["diacritic-sensitive"],1,"diacritic-sensitive",Ur);if(!p)return null;let x=null;return f.locale&&(x=c.parseObjectValue(f.locale,1,"locale",ui),!x)?null:new bo(g,p,x)}evaluate(o){return new Ic(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function fs(d,o,c=0,f=d.length-1,g=Hf){for(;f>c;){if(f-c>600){const D=f-c+1,L=o-c+1,T=Math.log(D),k=.5*Math.exp(2*T/3),z=.5*Math.sqrt(T*k*(D-k)/D)*(L-D/2<0?-1:1);fs(d,o,Math.max(c,Math.floor(o-L*k/D+z)),Math.min(f,Math.floor(o+(D-L)*k/D+z)),g)}const p=d[o];let x=c,I=f;for(Lr(d,c,o),g(d[f],p)>0&&Lr(d,c,f);x<I;){for(Lr(d,x,I),x++,I--;g(d[x],p)<0;)x++;for(;g(d[I],p)>0;)I--}g(d[c],p)===0?Lr(d,c,I):(I++,Lr(d,I,f)),I<=o&&(c=I+1),o<=I&&(f=I-1)}}function Lr(d,o,c){const f=d[o];d[o]=d[c],d[c]=f}function Hf(d,o){return d<o?-1:d>o?1:0}function Is(d){let o=0;for(let c,f,g=0,p=d.length,x=p-1;g<p;x=g++)c=d[g],f=d[x],o+=(f.x-c.x)*(c.y+f.y);return o}function wa(d,o){d[0]=Math.min(d[0],o[0]),d[1]=Math.min(d[1],o[1]),d[2]=Math.max(d[2],o[0]),d[3]=Math.max(d[3],o[1])}function eo(d,o){return!(d[0]<=o[0]||d[2]>=o[2]||d[1]<=o[1]||d[3]>=o[3])}function Wf(d,o,c){const f=d[0]-o[0],g=d[1]-o[1],p=d[0]-c[0],x=d[1]-c[1];return f*x-p*g==0&&f*p<=0&&g*x<=0}function Fo(d,o,c=!1){let f=!1;for(let I=0,D=o.length;I<D;I++){const L=o[I];for(let T=0,k=L.length,z=k-1;T<k;z=T++){const O=L[z],B=L[T];if(Wf(d,O,B))return c;(p=O)[1]>(g=d)[1]!=(x=B)[1]>g[1]&&g[0]<(x[0]-p[0])*(g[1]-p[1])/(x[1]-p[1])+p[0]&&(f=!f)}}var g,p,x;return f}function Ea(d,o,c,f){const g=f[0]-c[0],p=f[1]-c[1],x=(d[0]-c[0])*p-g*(d[1]-c[1]),I=(o[0]-c[0])*p-g*(o[1]-c[1]);return x>0&&I<0||x<0&&I>0}function q(d,o,c,f){return(g=[f[0]-c[0],f[1]-c[1]])[0]*(p=[o[0]-d[0],o[1]-d[1]])[1]-g[1]*p[0]!=0&&!(!Ea(d,o,c,f)||!Ea(c,f,d,o));var g,p}const ve=8192;function ke(d,o){const c=(180+d[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(c*g*ve),Math.round(f*g*ve)]}function et(d,o){for(let c=0;c<o.length;c++)if(Fo(d,o[c]))return!0;return!1}function Gt(d,o,c){for(const f of c)for(let g=0,p=f.length,x=p-1;g<p;x=g++)if(q(d,o,f[x],f[g]))return!0;return!1}function en(d,o){for(let c=0;c<d.length;++c)if(!Fo(d[c],o))return!1;for(let c=0;c<d.length-1;++c)if(Gt(d[c],d[c+1],o))return!1;return!0}function Kn(d,o){for(let c=0;c<o.length;c++)if(en(d,o[c]))return!0;return!1}function ji(d,o,c){const f=[];for(let g=0;g<d.length;g++){const p=[];for(let x=0;x<d[g].length;x++){const I=ke(d[g][x],c);wa(o,I),p.push(I)}f.push(p)}return f}function nr(d,o,c){const f=[];for(let g=0;g<d.length;g++){const p=ji(d[g],o,c);f.push(p)}return f}function gn(d,o,c,f){if(d[0]<c[0]||d[0]>c[2]){const g=.5*f;let p=d[0]-c[0]>g?-f:c[0]-d[0]>g?f:0;p===0&&(p=d[0]-c[2]>g?-f:c[2]-d[0]>g?f:0),d[0]+=p}wa(o,d)}function As(d,o,c,f){const g=Math.pow(2,f.z)*ve,p=[f.x*ve,f.y*ve],x=[];if(!d)return x;for(const I of d)for(const D of I){const L=[D.x+p[0],D.y+p[1]];gn(L,o,c,g),x.push(L)}return x}function Un(d,o,c,f){const g=Math.pow(2,f.z)*ve,p=[f.x*ve,f.y*ve],x=[];if(!d)return x;for(const D of d){const L=[];for(const T of D){const k=[T.x+p[0],T.y+p[1]];wa(o,k),L.push(k)}x.push(L)}if(o[2]-o[0]<=g/2){(I=o)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const D of x)for(const L of D)gn(L,o,c,g)}var I;return x}class Ms{constructor(o,c){this.type=Ur,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(aa(o[1])){const f=o[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const p=f.features[g].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ms(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ms(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ms(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const I=ji(f.coordinates,p,x),D=As(c.geometry(),g,p,x);if(!eo(g,p))return!1;for(const L of D)if(!Fo(L,I))return!1}if(f.type==="MultiPolygon"){const I=nr(f.coordinates,p,x),D=As(c.geometry(),g,p,x);if(!eo(g,p))return!1;for(const L of D)if(!et(L,I))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const I=ji(f.coordinates,p,x),D=Un(c.geometry(),g,p,x);if(!eo(g,p))return!1;for(const L of D)if(!en(L,I))return!1}if(f.type==="MultiPolygon"){const I=nr(f.coordinates,p,x),D=Un(c.geometry(),g,p,x);if(!eo(g,p))return!1;for(const L of D)if(!Kn(L,I))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Bo={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},qn=1/298.257223563,eh=qn*(2-qn),Qc=Math.PI/180;class qh{static fromTile(o,c,f){const g=Math.PI*(1-2*(o+.5)/Math.pow(2,c)),p=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/Qc;return new qh(p,f)}static get units(){return Bo}constructor(o,c){if(o===void 0)throw new Error("No latitude given.");if(c&&!Bo[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(Bo).join(", ")}`);const f=6378.137*Qc*(c?Bo[c]:1),g=Math.cos(o*Qc),p=1/(1-eh*(1-g*g)),x=Math.sqrt(p);this.kx=f*x*g,this.ky=f*x*p*(1-eh)}distance(o,c){const f=Ps(o[0]-c[0])*this.kx,g=(o[1]-c[1])*this.ky;return Math.sqrt(f*f+g*g)}bearing(o,c){const f=Ps(c[0]-o[0])*this.kx;return Math.atan2(f,(c[1]-o[1])*this.ky)/Qc}destination(o,c,f){const g=f*Qc;return this.offset(o,Math.sin(g)*c,Math.cos(g)*c)}offset(o,c,f){return[o[0]+c/this.kx,o[1]+f/this.ky]}lineDistance(o){let c=0;for(let f=0;f<o.length-1;f++)c+=this.distance(o[f],o[f+1]);return c}area(o){let c=0;for(let f=0;f<o.length;f++){const g=o[f];for(let p=0,x=g.length,I=x-1;p<x;I=p++)c+=Ps(g[p][0]-g[I][0])*(g[p][1]+g[I][1])*(f?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(o,c){let f=0;if(c<=0)return o[0];for(let g=0;g<o.length-1;g++){const p=o[g],x=o[g+1],I=this.distance(p,x);if(f+=I,f>c)return Ha(p,x,(c-(f-I))/I)}return o[o.length-1]}pointToSegmentDistance(o,c,f){let[g,p]=c,x=Ps(f[0]-g)*this.kx,I=(f[1]-p)*this.ky;if(x!==0||I!==0){const D=(Ps(o[0]-g)*this.kx*x+(o[1]-p)*this.ky*I)/(x*x+I*I);D>1?(g=f[0],p=f[1]):D>0&&(g+=x/this.kx*D,p+=I/this.ky*D)}return x=Ps(o[0]-g)*this.kx,I=(o[1]-p)*this.ky,Math.sqrt(x*x+I*I)}pointOnLine(o,c){let f=1/0,g=o[0][0],p=o[0][1],x=0,I=0;for(let D=0;D<o.length-1;D++){let L=o[D][0],T=o[D][1],k=Ps(o[D+1][0]-L)*this.kx,z=(o[D+1][1]-T)*this.ky,O=0;k===0&&z===0||(O=(Ps(c[0]-L)*this.kx*k+(c[1]-T)*this.ky*z)/(k*k+z*z),O>1?(L=o[D+1][0],T=o[D+1][1]):O>0&&(L+=k/this.kx*O,T+=z/this.ky*O)),k=Ps(c[0]-L)*this.kx,z=(c[1]-T)*this.ky;const B=k*k+z*z;B<f&&(f=B,g=L,p=T,x=D,I=O)}return{point:[g,p],index:x,t:Math.max(0,Math.min(1,I))}}lineSlice(o,c,f){let g=this.pointOnLine(f,o),p=this.pointOnLine(f,c);if(g.index>p.index||g.index===p.index&&g.t>p.t){const L=g;g=p,p=L}const x=[g.point],I=g.index+1,D=p.index;!$f(f[I],x[0])&&I<=D&&x.push(f[I]);for(let L=I+1;L<=D;L++)x.push(f[L]);return $f(f[D],p.point)||x.push(p.point),x}lineSliceAlong(o,c,f){let g=0;const p=[];for(let x=0;x<f.length-1;x++){const I=f[x],D=f[x+1],L=this.distance(I,D);if(g+=L,g>o&&p.length===0&&p.push(Ha(I,D,(o-(g-L))/L)),g>=c)return p.push(Ha(I,D,(c-(g-L))/L)),p;g>o&&p.push(D)}return p}bufferPoint(o,c){const f=c/this.ky,g=c/this.kx;return[o[0]-g,o[1]-f,o[0]+g,o[1]+f]}bufferBBox(o,c){const f=c/this.ky,g=c/this.kx;return[o[0]-g,o[1]-f,o[2]+g,o[3]+f]}insideBBox(o,c){return Ps(o[0]-c[0])>=0&&Ps(o[0]-c[2])<=0&&o[1]>=c[1]&&o[1]<=c[3]}}function $f(d,o){return d[0]===o[0]&&d[1]===o[1]}function Ha(d,o,c){const f=Ps(o[0]-d[0]);return[d[0]+f*c,d[1]+(o[1]-d[1])*c]}function Ps(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}class th{constructor(o=[],c=(f,g)=>f<g?-1:f>g?1:0){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:f}=this,g=c[o];for(;o>0;){const p=o-1>>1,x=c[p];if(f(g,x)>=0)break;c[o]=x,o=p}c[o]=g}_down(o){const{data:c,compare:f}=this,g=this.length>>1,p=c[o];for(;o<g;){let x=1+(o<<1);const I=x+1;if(I<this.length&&f(c[I],c[x])<0&&(x=I),f(c[x],p)>=0)break;c[o]=c[x],o=x}c[o]=p}}var sn=8192;function Vi(d,o){return o.dist-d.dist}const Nl=100,Ne=50;function m(d){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==d.length)return!1;for(let c=0;c<o.length;c++)if(o[c]!==d[c])return!1;return!0}function b(d){return d[1]-d[0]+1}function S(d,o){const c=d[1]>=d[0]&&d[1]<o;return c||console.warn("Distance Expression: Index is out of range"),c}function P(d,o){if(d[0]>d[1])return[null,null];const c=b(d);if(o){if(c===2)return[d,null];const f=Math.floor(c/2);return[[d[0],d[0]+f],[d[0]+f,d[1]]]}{if(c===1)return[d,null];const f=Math.floor(c/2)-1;return[[d[0],d[0]+f],[d[0]+f+1,d[1]]]}}function N(d,o){const c=[1/0,1/0,-1/0,-1/0];if(!S(o,d.length))return c;for(let f=o[0];f<=o[1];++f)wa(c,d[f]);return c}function V(d){const o=[1/0,1/0,-1/0,-1/0];for(let c=0;c<d.length;++c)for(let f=0;f<d[c].length;++f)wa(o,d[c][f]);return o}function $(d,o,c){if(m(d)||m(o))return NaN;let f=0,g=0;return d[2]<o[0]&&(f=o[0]-d[2]),d[0]>o[2]&&(f=d[0]-o[2]),d[1]>o[3]&&(g=d[1]-o[3]),d[3]<o[1]&&(g=o[1]-d[3]),c.distance([0,0],[f,g])}function te(d){return 360*d-180}function de(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function Re(d,o){const c=Math.pow(2,o.z),f=(d.y/sn+o.y)/c;return[te((d.x/sn+o.x)/c),de(f)]}function Fe(d,o){const c=[];for(let f=0;f<d.length;++f)c.push(Re(d[f],o));return c}function Ge(d,o,c){const f=c.pointOnLine(o,d).point;return c.distance(d,f)}function dt(d,o,c,f,g){const p=c.slice(f[0],f[1]+1);let x=1/0;for(let I=o[0];I<=o[1];++I)if((x=Math.min(x,Ge(d[I],p,g)))===0)return 0;return x}function Ct(d,o,c,f,g){const p=Math.min(g.pointToSegmentDistance(d,c,f),g.pointToSegmentDistance(o,c,f)),x=Math.min(g.pointToSegmentDistance(c,d,o),g.pointToSegmentDistance(f,d,o));return Math.min(p,x)}function Pt(d,o,c,f,g){if(!S(o,d.length)||!S(f,c.length))return NaN;let p=1/0;for(let x=o[0];x<o[1];++x)for(let I=f[0];I<f[1];++I){if(q(d[x],d[x+1],c[I],c[I+1]))return 0;p=Math.min(p,Ct(d[x],d[x+1],c[I],c[I+1],g))}return p}function $t(d,o,c,f,g){if(!S(o,d.length)||!S(f,c.length))return NaN;let p=1/0;for(let x=o[0];x<=o[1];++x)for(let I=f[0];I<=f[1];++I)if((p=Math.min(p,g.distance(d[x],c[I])))===0)return p;return p}function tn(d,o,c){if(Fo(d,o,!0))return 0;let f=1/0;for(const g of o){const p=g.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[p-1]&&(f=Math.min(f,c.pointToSegmentDistance(d,g[p-1],g[0])))===0||(f=Math.min(f,Ge(d,g,c)))===0)return f}return f}function Vn(d,o,c,f){if(!S(o,d.length))return NaN;for(let p=o[0];p<=o[1];++p)if(Fo(d[p],c,!0))return 0;let g=1/0;for(let p=o[0];p<o[1];++p)for(const x of c)for(let I=0,D=x.length,L=D-1;I<D;L=I++){if(q(d[p],d[p+1],x[L],x[I]))return 0;g=Math.min(g,Ct(d[p],d[p+1],x[L],x[I],f))}return g}function zn(d,o){for(const c of d)for(let f=0;f<=c.length-1;++f)if(Fo(c[f],o,!0))return!0;return!1}function Dn(d,o,c,f=1/0){const g=V(d),p=V(o);if(f!==1/0&&$(g,p,c)>=f)return f;if(eo(g,p)){if(zn(d,o))return 0}else if(zn(o,d))return 0;let x=f;for(const I of d)for(let D=0,L=I.length,T=L-1;D<L;T=D++)for(const k of o)for(let z=0,O=k.length,B=O-1;z<O;B=z++){if(q(I[T],I[D],k[B],k[z]))return 0;x=Math.min(x,Ct(I[T],I[D],k[B],k[z],c))}return x}function Pi(d,o,c,f,g,p,x){if(p===null||x===null)return;const I=$(N(f,p),N(g,x),c);I<o&&d.push({dist:I,range1:p,range2:x})}function Xr(d,o,c,f,g=1/0){let p=Math.min(f.distance(d[0],c[0][0]),g);if(p===0)return p;const x=new th([{dist:0,range1:[0,d.length-1],range2:[0,0]}],Vi),I=o?Ne:Nl,D=V(c);for(;x.length;){const L=x.pop();if(L.dist>=p)continue;const T=L.range1;if(b(T)<=I){if(!S(T,d.length))return NaN;if(o){const k=Vn(d,T,c,f);if((p=Math.min(p,k))===0)return p}else for(let k=T[0];k<=T[1];++k){const z=tn(d[k],c,f);if((p=Math.min(p,z))===0)return p}}else{const k=P(T,o);if(k[0]!==null){const z=$(N(d,k[0]),D,f);z<p&&x.push({dist:z,range1:k[0],range2:[0,0]})}if(k[1]!==null){const z=$(N(d,k[1]),D,f);z<p&&x.push({dist:z,range1:k[1],range2:[0,0]})}}}return p}function Sa(d,o,c,f,g,p=1/0){let x=Math.min(p,g.distance(d[0],c[0]));if(x===0)return x;const I=new th([{dist:0,range1:[0,d.length-1],range2:[0,c.length-1]}],Vi),D=o?Ne:Nl,L=f?Ne:Nl;for(;I.length;){const T=I.pop();if(T.dist>=x)continue;const k=T.range1,z=T.range2;if(b(k)<=D&&b(z)<=L){if(!S(k,d.length)||!S(z,c.length))return NaN;if(o&&f?x=Math.min(x,Pt(d,k,c,z,g)):o||f?o&&!f?x=Math.min(x,dt(c,z,d,k,g)):!o&&f&&(x=Math.min(x,dt(d,k,c,z,g))):x=Math.min(x,$t(d,k,c,z,g)),x===0)return x}else{const O=P(k,o),B=P(z,f);Pi(I,x,g,d,c,O[0],B[0]),Pi(I,x,g,d,c,O[0],B[1]),Pi(I,x,g,d,c,O[1],B[0]),Pi(I,x,g,d,c,O[1],B[1])}}return x}function Qa(d,o,c,f,g=1/0){let p=g;const x=N(d,[0,d.length-1]);for(const I of c)if(!(p!==1/0&&$(x,N(I,[0,I.length-1]),f)>=p)&&(p=Math.min(p,Sa(d,o,I,!0,f,p)),p===0))return p;return p}function Zo(d,o,c,f,g=1/0){let p=g;const x=N(d,[0,d.length-1]);for(const I of c){if(p!==1/0&&$(x,V(I),f)>=p)continue;const D=Xr(d,o,I,f,p);if(isNaN(D))return D;if((p=Math.min(p,D))===0)return p}return p}function _s(d){return d==="Point"||d==="MultiPoint"||d==="LineString"||d==="MultiLineString"||d==="Polygon"||d==="MultiPolygon"}class to{constructor(o,c){this.type=vn,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(aa(o[1])){const f=o[1];if(f.type==="FeatureCollection"){for(let g=0;g<f.features.length;++g)if(_s(f.features[g].geometry.type))return new to(f,f.features[g].geometry)}else if(f.type==="Feature"){if(_s(f.geometry.type))return new to(f,f.geometry)}else if(_s(f.type))return new to(f,f)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const c=o.geometry(),f=o.canonicalID();if(c!=null&&f!=null){if(o.geometryType()==="Point")return function(g,p,x){const I=[];for(const L of g)for(const T of L)I.push(Re(T,p));const D=new qh(I[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?Sa(I,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",D):x.type==="MultiLineString"?Qa(I,!1,x.coordinates,D):x.type==="Polygon"||x.type==="MultiPolygon"?Zo(I,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,D):null}(c,f,this.geometries);if(o.geometryType()==="LineString")return function(g,p,x){const I=[];for(const L of g){const T=[];for(const k of L)T.push(Re(k,p));I.push(T)}const D=new qh(I[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Qa(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",I,D);if(x.type==="MultiLineString"){let L=1/0;for(let T=0;T<x.coordinates.length;T++){const k=Qa(x.coordinates[T],!0,I,D,L);if(isNaN(k))return k;if((L=Math.min(L,k))===0)return L}return L}if(x.type==="Polygon"||x.type==="MultiPolygon"){let L=1/0;for(let T=0;T<I.length;T++){const k=Zo(I[T],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,D,L);if(isNaN(k))return k;if((L=Math.min(L,k))===0)return L}return L}return null}(c,f,this.geometries);if(o.geometryType()==="Polygon")return function(g,p,x){const I=[];for(const L of function(T,k){const z=T.length;if(z<=1)return[T];const O=[];let B,U;for(let X=0;X<z;X++){const J=Is(T[X]);J!==0&&(T[X].area=Math.abs(J),U===void 0&&(U=J<0),U===J<0?(B&&O.push(B),B=[T[X]]):B.push(T[X]))}return B&&O.push(B),O}(g)){const T=[];for(let k=0;k<L.length;++k)T.push(Fe(L[k],p));I.push(T)}const D=new qh(I[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Zo(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",I,D);if(x.type==="MultiLineString"){let L=1/0;for(let T=0;T<x.coordinates.length;T++){const k=Zo(x.coordinates[T],!0,I,D,L);if(isNaN(k))return k;if((L=Math.min(L,k))===0)return L}return L}return x.type==="Polygon"||x.type==="MultiPolygon"?function(L,T,k){let z=1/0;for(const O of L)for(const B of T){const U=Dn(O,B,k,z);if(isNaN(U))return U;if((z=Math.min(z,U))===0)return z}return z}(x.type==="Polygon"?[x.coordinates]:x.coordinates,I,D):null}(c,f,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ta(d,o){switch(d){case"string":return Gs(o);case"number":return+o;case"boolean":return!!o;case"color":return Qr.parse(o);case"formatted":return Rs.fromString(Gs(o));case"resolvedImage":return hi.build(Gs(o))}return o}function Iu(d,o,c,f){return f!==void 0&&(d=f*Math.round(d/f)),o!==void 0&&d<o&&(d=o),c!==void 0&&d>c&&(d=c),d}class Ol{constructor(o,c,f){this.type=o,this.key=c,this.scope=f}static parse(o,c){let f=c.expectedType;if(f==null&&(f=Yr),o.length<2||o.length>3)return c.error("Invalid number of arguments for 'config' expression.");const g=c.parse(o[1],1);if(!(g instanceof Zt))return c.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){const p=c.parse(o[2],2);return p instanceof Zt?new Ol(f,Gs(g.value),Gs(p.value)):c.error("Scope of 'config' expression must be a string literal.")}return new Ol(f,Gs(g.value))}evaluate(o){const c=[this.key,this.scope,o.scope].filter(Boolean).join(""),f=o.getConfig(c);if(!f)return null;const{type:g,value:p,values:x,minValue:I,maxValue:D,stepValue:L}=f,T=f.default.evaluate(o);let k=T;if(p){const z=o.scope;o.scope=(z||"").split("").slice(1).join(""),k=p.evaluate(o),o.scope=z}return g&&(k=Ta(g,k)),k===void 0||I===void 0&&D===void 0&&L===void 0||(typeof k=="number"?k=Iu(k,I,D,L):Array.isArray(k)&&(k=k.map(z=>typeof z=="number"?Iu(z,I,D,L):z))),p!==void 0&&k!==void 0&&x&&!x.includes(k)&&(k=T,g&&(k=Ta(g,k))),(g&&g!==this.type||k!==void 0&&Ki(k)!==this.type)&&(k=Ta(this.type.kind,k)),k}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.key),o}}function Gh(d){if(d instanceof Mi&&(d.name==="get"&&d.args.length===1||d.name==="feature-state"||d.name==="has"&&d.args.length===1||d.name==="properties"||d.name==="geometry-type"||d.name==="id"||/^filter-/.test(d.name))||d instanceof Ms||d instanceof to)return!1;let o=!0;return d.eachChild(c=>{o&&!Gh(c)&&(o=!1)}),o}function jd(d){if(d instanceof Mi&&d.name==="feature-state")return!1;let o=!0;return d.eachChild(c=>{o&&!jd(c)&&(o=!1)}),o}function Um(d){if(d instanceof Ol)return new Set([d.key]);let o=new Set;return d.eachChild(c=>{o=new Set([...o,...Um(c)])}),o}function nh(d,o){if(d instanceof Mi&&o.indexOf(d.name)>=0)return!1;let c=!0;return d.eachChild(f=>{c&&!nh(f,o)&&(c=!1)}),c}class Vd{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(o.length!==2||typeof o[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=o[1];return c.scope.has(f)?new Vd(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class qf{constructor(o,c=[],f,g=new $h,p=[],x,I){this.registry=o,this.path=c,this.key=c.map(D=>typeof D=="string"?`['${D}']`:`[${D}]`).join(""),this.scope=g,this.errors=p,this.expectedType=f,this._scope=x,this.options=I}parse(o,c,f,g,p={}){return c||f?this.concat(c,null,f,g)._parse(o,p):this._parse(o,p)}parseObjectValue(o,c,f,g,p,x={}){return this.concat(c,f,g,p)._parse(o,x)}_parse(o,c){function f(g,p,x){return x==="assert"?new Lo(p,[g]):x==="coerce"?new Ua(p,[g]):g}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof o[0]=="string"?this.registry[o[0]]:void 0;if(g){let p=g.parse(o,this);if(!p)return null;if(this.expectedType){const x=this.expectedType,I=p.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||I.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(x,I))return null}else p=f(p,x,c.typeAnnotation||"coerce");else p=f(p,x,c.typeAnnotation||"assert")}if(!(p instanceof Zt)&&p.type.kind!=="resolvedImage"&&N_(p)){const x=new ac(this._scope,this.options);try{p=new Zt(p.type,p.evaluate(x))}catch(I){return this.error(I.message),null}}return p}return Ua.parse(["to-array",o],this)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,f,g){let p=typeof o=="number"?this.path.concat(o):this.path;p=typeof c=="string"?p.concat(c):p;const x=g?this.scope.concat(g):this.scope;return new qf(this.registry,p,f||null,x,this.errors,this._scope,this.options)}error(o,...c){const f=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ir(f,o))}checkSubtype(o,c){const f=po(o,c);return f&&this.error(f),f}}var Ux=qf;function N_(d){if(d instanceof Vd)return N_(d.boundExpression);if(d instanceof Mi&&d.name==="error"||d instanceof bo||d instanceof Ms||d instanceof to||d instanceof Ol)return!1;const o=d instanceof Ua||d instanceof Lo;let c=!0;return d.eachChild(f=>{c=o?c&&N_(f):c&&f instanceof Zt}),!!c&&Gh(d)&&nh(d,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Hm(d,o){const c=d.length-1;let f,g,p=0,x=c,I=0;for(;p<=x;)if(I=Math.floor((p+x)/2),f=d[I],g=d[I+1],f<=o){if(I===c||o<g)return I;p=I+1}else{if(!(f>o))throw new _r("Input is not a number.");x=I-1}return 0}class Au{constructor(o,c,f){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,p]of f)this.labels.push(g),this.outputs.push(p)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(o[1],1,vn);if(!f)return null;const g=[];let p=null;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);for(let x=1;x<o.length;x+=2){const I=x===1?-1/0:o[x],D=o[x+1],L=x,T=x+1;if(typeof I!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=I)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const k=c.parse(D,T,p);if(!k)return null;p=p||k.type,g.push([I,k])}return new Au(p,f,g)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=c[0])return f[0].evaluate(o);const p=c.length;return g>=c[p-1]?f[p-1].evaluate(o):f[Hm(c,g)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&o.push(this.labels[c]),o.push(this.outputs[c].serialize());return o}}const Jr=.95047,V2=1.08883,U2=4/29,Gf=6/29,Hx=3*Gf*Gf,rM=Gf*Gf*Gf,ys=Math.PI/180,iM=180/Math.PI;function Wx(d){return d>rM?Math.pow(d,1/3):d/Hx+U2}function $x(d){return d>Gf?d*d*d:Hx*(d-U2)}function qx(d){return 255*(d<=.0031308?12.92*d:1.055*Math.pow(d,1/2.4)-.055)}function Gx(d){return(d/=255)<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function H2(d){const o=Gx(d.r),c=Gx(d.g),f=Gx(d.b),g=Wx((.4124564*o+.3575761*c+.1804375*f)/Jr),p=Wx((.2126729*o+.7151522*c+.072175*f)/1);return{l:116*p-16,a:500*(g-p),b:200*(p-Wx((.0193339*o+.119192*c+.9503041*f)/V2)),alpha:d.a}}function W2(d){let o=(d.l+16)/116,c=isNaN(d.a)?o:o+d.a/500,f=isNaN(d.b)?o:o-d.b/200;return o=1*$x(o),c=Jr*$x(c),f=V2*$x(f),new Qr(qx(3.2404542*c-1.5371385*o-.4985314*f),qx(-.969266*c+1.8760108*o+.041556*f),qx(.0556434*c-.2040259*o+1.0572252*f),d.alpha)}function sM(d,o,c){const f=o-d;return d+c*(f>180||f<-180?f-360*Math.round(f/360):f)}const Wm={forward:H2,reverse:W2,interpolate:function(d,o,c){return{l:Wn(d.l,o.l,c),a:Wn(d.a,o.a,c),b:Wn(d.b,o.b,c),alpha:Wn(d.alpha,o.alpha,c)}}},$m={forward:function(d){const{l:o,a:c,b:f}=H2(d),g=Math.atan2(f,c)*iM;return{h:g<0?g+360:g,c:Math.sqrt(c*c+f*f),l:o,alpha:d.a}},reverse:function(d){const o=d.h*ys,c=d.c;return W2({l:d.l,a:Math.cos(o)*c,b:Math.sin(o)*c,alpha:d.alpha})},interpolate:function(d,o,c){return{h:sM(d.h,o.h,c),c:Wn(d.c,o.c,c),l:Wn(d.l,o.l,c),alpha:Wn(d.alpha,o.alpha,c)}}};var $2=Object.freeze({__proto__:null,hcl:$m,lab:Wm});class lc{constructor(o,c,f,g,p){this.type=o,this.operator=c,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[x,I]of p)this.labels.push(x),this.outputs.push(I)}static interpolationFactor(o,c,f,g){let p=0;if(o.name==="exponential")p=Yx(c,o.base,f,g);else if(o.name==="linear")p=Yx(c,1,f,g);else if(o.name==="cubic-bezier"){const x=o.controlPoints;p=new rr(x[0],x[1],x[2],x[3]).solve(Yx(c,1,f,g))}return p}static parse(o,c){let[f,g,p,...x]=o;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(T=>typeof T!="number"||T<0||T>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(p=c.parse(p,2,vn),!p)return null;const I=[];let D=null;f==="interpolate-hcl"||f==="interpolate-lab"?D=oo:c.expectedType&&c.expectedType.kind!=="value"&&(D=c.expectedType);for(let L=0;L<x.length;L+=2){const T=x[L],k=x[L+1],z=L+3,O=L+4;if(typeof T!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(I.length&&I[I.length-1][0]>=T)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const B=c.parse(k,O,D);if(!B)return null;D=D||B.type,I.push([T,B])}return D.kind==="number"||D.kind==="color"||D.kind==="array"&&D.itemType.kind==="number"&&typeof D.N=="number"?new lc(D,f,g,p,I):c.error(`Type ${us(D)} is not interpolatable.`)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=c[0])return f[0].evaluate(o);const p=c.length;if(g>=c[p-1])return f[p-1].evaluate(o);const x=Hm(c,g),I=lc.interpolationFactor(this.interpolation,g,c[x],c[x+1]),D=f[x].evaluate(o),L=f[x+1].evaluate(o);return this.operator==="interpolate"?ba[this.type.kind.toLowerCase()](D,L,I):this.operator==="interpolate-hcl"?$m.reverse($m.interpolate($m.forward(D),$m.forward(L),I)):Wm.reverse(Wm.interpolate(Wm.forward(D),Wm.forward(L),I))}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,o,this.input.serialize()];for(let f=0;f<this.labels.length;f++)c.push(this.labels[f],this.outputs[f].serialize());return c}}function Yx(d,o,c,f){const g=f-c,p=d-c;return g===0?0:o===1?p/g:(Math.pow(o,p)-1)/(Math.pow(o,g)-1)}class O_{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let f=null;const g=c.expectedType;g&&g.kind!=="value"&&(f=g);const p=[];for(const I of o.slice(1)){const D=c.parse(I,1+p.length,f,void 0,{typeAnnotation:"omit"});if(!D)return null;f=f||D.type,p.push(D)}const x=g&&p.some(I=>po(g,I.type));return new O_(x?Yr:f,p)}evaluate(o){let c,f=null,g=0;for(const p of this.args){if(g++,f=p.evaluate(o),f&&f instanceof hi&&!f.available&&(c||(c=f),f=null,g===this.args.length))return c;if(f!==null)break}return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(c=>{o.push(c.serialize())}),o}}class L_{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let p=1;p<o.length-1;p+=2){const x=o[p];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,p);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",p);const I=c.parse(o[p+1],p+1);if(!I)return null;f.push([x,I])}const g=c.parse(o[o.length-1],o.length-1,c.expectedType,f);return g?new L_(f,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[c,f]of this.bindings)o.push(c,f.serialize());return o.push(this.result.serialize()),o}}class Xx{constructor(o,c,f){this.type=o,this.index=c,this.input=f}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,vn),g=c.parse(o[2],2,Ci(c.expectedType||Yr));return f&&g?new Xx(g.type.itemType,f,g):null}evaluate(o){const c=this.index.evaluate(o),f=this.input.evaluate(o);if(c<0)throw new _r(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new _r(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new _r(`Array index must be an integer, but found ${c} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return f[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Kx{constructor(o,c,f){this.type=o,this.index=c,this.input=f}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,vn),g=c.parse(o[2],2,Ci(c.expectedType||Yr));return f&&g?new Kx(g.type.itemType,f,g):null}evaluate(o){const c=this.index.evaluate(o),f=this.input.evaluate(o);if(c<0)throw new _r(`Array index out of bounds: ${c} < 0.`);if(c>f.length-1)throw new _r(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c===Math.floor(c))return f[c];const g=Math.floor(c),p=Math.ceil(c),x=f[g],I=f[p];if(typeof x!="number"||typeof I!="number")throw new _r(`Cannot interpolate between non-number values at index ${c}.`);const D=c-g;return x*(1-D)+I*D}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Zx{constructor(o,c){this.type=Ur,this.needle=o,this.haystack=c}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,Yr),g=c.parse(o[2],2,Yr);return f&&g?Qu(f.type,[Ur,ui,vn,Vr,Yr])?new Zx(f,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${us(f.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(f==null)return!1;if(!Cc(c,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${us(Ki(c))} instead.`);if(!Cc(f,["string","array"]))throw new _r(`Expected second argument to be of type array or string, but found ${us(Ki(f))} instead.`);return f.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class F_{constructor(o,c,f){this.type=vn,this.needle=o,this.haystack=c,this.fromIndex=f}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,Yr),g=c.parse(o[2],2,Yr);if(!f||!g)return null;if(!Qu(f.type,[Ur,ui,vn,Vr,Yr]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${us(f.type)} instead`);if(o.length===4){const p=c.parse(o[3],3,vn);return p?new F_(f,g,p):null}return new F_(f,g)}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!Cc(c,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${us(Ki(c))} instead.`);if(!Cc(f,["string","array"]))throw new _r(`Expected second argument to be of type array or string, but found ${us(Ki(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(o);return f.indexOf(c,g)}return f.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Qx{constructor(o,c,f,g,p,x){this.inputType=o,this.type=c,this.input=f,this.cases=g,this.outputs=p,this.otherwise=x}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let f,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const p={},x=[];for(let L=2;L<o.length-1;L+=2){let T=o[L];const k=o[L+1];Array.isArray(T)||(T=[T]);const z=c.concat(L);if(T.length===0)return z.error("Expected at least one branch label.");for(const B of T){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(f){if(z.checkSubtype(f,Ki(B)))return null}else f=Ki(B);if(p[String(B)]!==void 0)return z.error("Branch labels must be unique.");p[String(B)]=x.length}const O=c.parse(k,L,g);if(!O)return null;g=g||O.type,x.push(O)}const I=c.parse(o[1],1,Yr);if(!I)return null;const D=c.parse(o[o.length-1],o.length-1,g);return D?I.type.kind!=="value"&&c.concat(1).checkSubtype(f,I.type)?null:new Qx(f,g,I,p,x,D):null}evaluate(o){const c=this.input.evaluate(o);return(Ki(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),f=[],g={};for(const x of c){const I=g[this.cases[x]];I===void 0?(g[this.cases[x]]=f.length,f.push([this.cases[x],[x]])):f[I][1].push(x)}const p=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,I]of f)o.push(I.length===1?p(I[0]):I.map(p)),o.push(this.outputs[x].serialize());return o.push(this.otherwise.serialize()),o}}class Jx{constructor(o,c,f){this.type=o,this.branches=c,this.otherwise=f}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const g=[];for(let x=1;x<o.length-1;x+=2){const I=c.parse(o[x],x,Ur);if(!I)return null;const D=c.parse(o[x+1],x+1,f);if(!D)return null;g.push([I,D]),f=f||D.type}const p=c.parse(o[o.length-1],o.length-1,f);return p?new Jx(f,g,p):null}evaluate(o){for(const[c,f]of this.branches)if(c.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,f]of this.branches)o(c),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(c=>{o.push(c.serialize())}),o}}class B_{constructor(o,c,f,g){this.type=o,this.input=c,this.beginIndex=f,this.endIndex=g}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,Yr),g=c.parse(o[2],2,vn);if(!f||!g)return null;if(!Qu(f.type,[Ci(Yr),ui,Yr]))return c.error(`Expected first argument to be of type array or string, but found ${us(f.type)} instead`);if(o.length===4){const p=c.parse(o[3],3,vn);return p?new B_(f.type,f,g,p):null}return new B_(f.type,f,g)}evaluate(o){const c=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!Cc(c,["string","array"]))throw new _r(`Expected first argument to be of type array or string, but found ${us(Ki(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(o);return c.slice(f,g)}return c.slice(f)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function q2(d,o){return d==="=="||d==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function G2(d,o,c,f){return f.compare(o,c)===0}function Yf(d,o,c){const f=d!=="=="&&d!=="!=";return class yte{constructor(p,x,I){this.type=Ur,this.lhs=p,this.rhs=x,this.collator=I,this.hasUntypedArgument=p.type.kind==="value"||x.type.kind==="value"}static parse(p,x){if(p.length!==3&&p.length!==4)return x.error("Expected two or three arguments.");const I=p[0];let D=x.parse(p[1],1,Yr);if(!D)return null;if(!q2(I,D.type))return x.concat(1).error(`"${I}" comparisons are not supported for type '${us(D.type)}'.`);let L=x.parse(p[2],2,Yr);if(!L)return null;if(!q2(I,L.type))return x.concat(2).error(`"${I}" comparisons are not supported for type '${us(L.type)}'.`);if(D.type.kind!==L.type.kind&&D.type.kind!=="value"&&L.type.kind!=="value")return x.error(`Cannot compare types '${us(D.type)}' and '${us(L.type)}'.`);f&&(D.type.kind==="value"&&L.type.kind!=="value"?D=new Lo(L.type,[D]):D.type.kind!=="value"&&L.type.kind==="value"&&(L=new Lo(D.type,[L])));let T=null;if(p.length===4){if(D.type.kind!=="string"&&L.type.kind!=="string"&&D.type.kind!=="value"&&L.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(T=x.parse(p[3],3,Oo),!T)return null}return new yte(D,L,T)}evaluate(p){const x=this.lhs.evaluate(p),I=this.rhs.evaluate(p);if(f&&this.hasUntypedArgument){const D=Ki(x),L=Ki(I);if(D.kind!==L.kind||D.kind!=="string"&&D.kind!=="number")throw new _r(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${D.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const D=Ki(x),L=Ki(I);if(D.kind!=="string"||L.kind!=="string")return o(p,x,I)}return this.collator?c(p,x,I,this.collator.evaluate(p)):o(p,x,I)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[d];return this.eachChild(x=>{p.push(x.serialize())}),p}}}const oM=Yf("==",function(d,o,c){return o===c},G2),aM=Yf("!=",function(d,o,c){return o!==c},function(d,o,c,f){return!G2(0,o,c,f)}),lM=Yf("<",function(d,o,c){return o<c},function(d,o,c,f){return f.compare(o,c)<0}),cM=Yf(">",function(d,o,c){return o>c},function(d,o,c,f){return f.compare(o,c)>0}),uM=Yf("<=",function(d,o,c){return o<=c},function(d,o,c,f){return f.compare(o,c)<=0}),hM=Yf(">=",function(d,o,c){return o>=c},function(d,o,c,f){return f.compare(o,c)>=0});class qm{constructor(o,c,f,g,p,x){this.type=ui,this.number=o,this.locale=c,this.currency=f,this.unit=g,this.minFractionDigits=p,this.maxFractionDigits=x}static parse(o,c){if(o.length!==3)return c.error("Expected two arguments.");const f=c.parse(o[1],1,vn);if(!f)return null;const g=o[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let p=null;if(g.locale&&(p=c.parseObjectValue(g.locale,2,"locale",ui),!p))return null;let x=null;if(g.currency&&(x=c.parseObjectValue(g.currency,2,"currency",ui),!x))return null;let I=null;if(g.unit&&(I=c.parseObjectValue(g.unit,2,"unit",ui),!I))return null;let D=null;if(g["min-fraction-digits"]&&(D=c.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",vn),!D))return null;let L=null;return g["max-fraction-digits"]&&(L=c.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",vn),!L)?null:new qm(f,p,x,I,D,L)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class e1{constructor(o){this.type=vn,this.input=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=c.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${us(f.type)} instead.`):new e1(f):null}evaluate(o){const c=this.input.evaluate(o);if(typeof c=="string"||Array.isArray(c))return c.length;throw new _r(`Expected value to be of type string or array, but found ${us(Ki(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(c=>{o.push(c.serialize())}),o}}function t1(d){return function(){d=1831565813+(d|=0)|0;let o=Math.imul(d^d>>>15,1|d);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const Xf={"==":oM,"!=":aM,">":cM,"<":lM,">=":hM,"<=":uM,array:Lo,at:Xx,"at-interpolated":Kx,boolean:Lo,case:Jx,coalesce:O_,collator:bo,format:dl,image:oc,in:Zx,"index-of":F_,interpolate:lc,"interpolate-hcl":lc,"interpolate-lab":lc,length:e1,let:L_,literal:Zt,match:Qx,number:Lo,"number-format":qm,object:Lo,slice:B_,step:Au,string:Lo,"to-boolean":Ua,"to-color":Ua,"to-number":Ua,"to-string":Ua,var:Vd,within:Ms,distance:to,config:Ol};function Y2(d,[o,c,f,g]){o=o.evaluate(d),c=c.evaluate(d),f=f.evaluate(d);const p=g?g.evaluate(d):1,x=Dl(o,c,f,p);if(x)throw new _r(x);return new Qr(o/255*p,c/255*p,f/255*p,p)}function X2(d,[o,c,f,g]){o=o.evaluate(d),c=c.evaluate(d),f=f.evaluate(d);const p=g?g.evaluate(d):1,x=function(L,T,k,z){return typeof L=="number"&&L>=0&&L<=360?typeof T=="number"&&T>=0&&T<=100&&typeof k=="number"&&k>=0&&k<=100?z===void 0||typeof z=="number"&&z>=0&&z<=1?null:`Invalid hsla value [${[L,T,k,z].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof z=="number"?[L,T,k,z]:[L,T,k]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof z=="number"?[L,T,k,z]:[L,T,k]).join(", ")}]: 'h' must be between 0 and 360.`}(o,c,f,p);if(x)throw new _r(x);const I=`hsla(${o}, ${c}%, ${f}%, ${p})`,D=Qr.parse(I);if(!D)throw new _r(`Failed to parse HSLA color: ${I}`);return D}function n1(d,o){return d in o}function z_(d,o){const c=o[d];return c===void 0?null:c}function Ac(d){return{type:d}}function r1(d){return{result:"success",value:d}}function rh(d){return{result:"error",value:d}}function i1(d,o){return!!d&&!!d.parameters&&d.parameters.indexOf(o)>-1}function Kf(d){return d["property-type"]==="data-driven"}function j_(d){return i1(d.expression,"measure-light")}function K2(d){return i1(d.expression,"zoom")}function s1(d){return!!d.expression&&d.expression.interpolated}function V_(d){return typeof d=="object"&&d!==null&&!Array.isArray(d)}function Z2(d){return d}function Q2(d,o){const c=o.type==="color",f=d.stops&&typeof d.stops[0][0]=="object",g=f||!(f||d.property!==void 0),p=d.type||(s1(o)?"exponential":"interval");if(c&&((d=Or({},d)).stops&&(d.stops=d.stops.map(L=>[L[0],Qr.parse(L[1])])),d.default=Qr.parse(d.default?d.default:o.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!$2[d.colorSpace])throw new Error(`Unknown color space: ${d.colorSpace}`);let x,I,D;if(p==="exponential")x=o1;else if(p==="interval")x=J2;else if(p==="categorical"){x=dM,I=Object.create(null);for(const L of d.stops)I[L[0]]=L[1];D=typeof d.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);x=U_}if(f){const L={},T=[];for(let O=0;O<d.stops.length;O++){const B=d.stops[O],U=B[0].zoom;L[U]===void 0&&(L[U]={zoom:U,type:d.type,property:d.property,default:d.default,stops:[]},T.push(U)),L[U].stops.push([B[0].value,B[1]])}const k=[];for(const O of T)k.push([L[O].zoom,Q2(L[O],o)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:lc.interpolationFactor.bind(void 0,z),zoomStops:k.map(O=>O[0]),evaluate:({zoom:O},B)=>o1({stops:k,base:d.base},o,O).evaluate(O,B)}}if(g){const L=p==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:lc.interpolationFactor.bind(void 0,L),zoomStops:d.stops.map(T=>T[0]),evaluate:({zoom:T})=>x(d,o,T,I,D)}}return{kind:"source",evaluate(L,T){const k=T&&T.properties?T.properties[d.property]:void 0;return k===void 0?Gm(d.default,o.default):x(d,o,k,I,D)}}}function Gm(d,o,c){return d!==void 0?d:o!==void 0?o:c!==void 0?c:void 0}function dM(d,o,c,f,g){return Gm(typeof c===g?f[c]:void 0,d.default,o.default)}function J2(d,o,c){if(kl(c)!=="number")return Gm(d.default,o.default);const f=d.stops.length;if(f===1||c<=d.stops[0][0])return d.stops[0][1];if(c>=d.stops[f-1][0])return d.stops[f-1][1];const g=Hm(d.stops.map(p=>p[0]),c);return d.stops[g][1]}function o1(d,o,c){const f=d.base!==void 0?d.base:1;if(kl(c)!=="number")return Gm(d.default,o.default);const g=d.stops.length;if(g===1||c<=d.stops[0][0])return d.stops[0][1];if(c>=d.stops[g-1][0])return d.stops[g-1][1];const p=Hm(d.stops.map(T=>T[0]),c),x=function(T,k,z,O){const B=O-z,U=T-z;return B===0?0:k===1?U/B:(Math.pow(k,U)-1)/(Math.pow(k,B)-1)}(c,f,d.stops[p][0],d.stops[p+1][0]),I=d.stops[p][1],D=d.stops[p+1][1];let L=ba[o.type]||Z2;if(d.colorSpace&&d.colorSpace!=="rgb"){const T=$2[d.colorSpace];L=(k,z)=>T.reverse(T.interpolate(T.forward(k),T.forward(z),x))}return typeof I.evaluate=="function"?{evaluate(...T){const k=I.evaluate.apply(void 0,T),z=D.evaluate.apply(void 0,T);if(k!==void 0&&z!==void 0)return L(k,z,x)}}:L(I,D,x)}function U_(d,o,c){return o.type==="color"?c=Qr.parse(c):o.type==="formatted"?c=Rs.fromString(c.toString()):o.type==="resolvedImage"?c=hi.build(c.toString()):kl(c)===o.type||o.type==="enum"&&o.values[c]||(c=void 0),Gm(c,d.default,o.default)}Mi.register(Xf,{error:[{kind:"error"},[ui],(d,[o])=>{throw new _r(o.evaluate(d))}],typeof:[ui,[Yr],(d,[o])=>us(Ki(o.evaluate(d)))],"to-rgba":[Ci(vn,4),[oo],(d,[o])=>o.evaluate(d).toRenderColor(null).toArray()],"to-hsla":[Ci(vn,4),[oo],(d,[o])=>o.evaluate(d).toRenderColor(null).toHslaArray()],rgb:[oo,[vn,vn,vn],Y2],rgba:[oo,[vn,vn,vn,vn],Y2],hsl:[oo,[vn,vn,vn],X2],hsla:[oo,[vn,vn,vn,vn],X2],has:{type:Ur,overloads:[[[ui],(d,[o])=>n1(o.evaluate(d),d.properties())],[[ui,Va],(d,[o,c])=>n1(o.evaluate(d),c.evaluate(d))]]},get:{type:Yr,overloads:[[[ui],(d,[o])=>z_(o.evaluate(d),d.properties())],[[ui,Va],(d,[o,c])=>z_(o.evaluate(d),c.evaluate(d))]]},"feature-state":[Yr,[ui],(d,[o])=>z_(o.evaluate(d),d.featureState||{})],properties:[Va,[],d=>d.properties()],"geometry-type":[ui,[],d=>d.geometryType()],id:[Yr,[],d=>d.id()],zoom:[vn,[],d=>d.globals.zoom],pitch:[vn,[],d=>d.globals.pitch||0],"distance-from-center":[vn,[],d=>d.distanceFromCenter()],"measure-light":[vn,[ui],(d,[o])=>d.measureLight(o.evaluate(d))],"heatmap-density":[vn,[],d=>d.globals.heatmapDensity||0],"line-progress":[vn,[],d=>d.globals.lineProgress||0],"raster-value":[vn,[],d=>d.globals.rasterValue||0],"raster-particle-speed":[vn,[],d=>d.globals.rasterParticleSpeed||0],"sky-radial-progress":[vn,[],d=>d.globals.skyRadialProgress||0],accumulated:[Yr,[],d=>d.globals.accumulated===void 0?null:d.globals.accumulated],"+":[vn,Ac(vn),(d,o)=>{let c=0;for(const f of o)c+=f.evaluate(d);return c}],"*":[vn,Ac(vn),(d,o)=>{let c=1;for(const f of o)c*=f.evaluate(d);return c}],"-":{type:vn,overloads:[[[vn,vn],(d,[o,c])=>o.evaluate(d)-c.evaluate(d)],[[vn],(d,[o])=>-o.evaluate(d)]]},"/":[vn,[vn,vn],(d,[o,c])=>o.evaluate(d)/c.evaluate(d)],"%":[vn,[vn,vn],(d,[o,c])=>o.evaluate(d)%c.evaluate(d)],ln2:[vn,[],()=>Math.LN2],pi:[vn,[],()=>Math.PI],e:[vn,[],()=>Math.E],"^":[vn,[vn,vn],(d,[o,c])=>Math.pow(o.evaluate(d),c.evaluate(d))],sqrt:[vn,[vn],(d,[o])=>Math.sqrt(o.evaluate(d))],log10:[vn,[vn],(d,[o])=>Math.log(o.evaluate(d))/Math.LN10],ln:[vn,[vn],(d,[o])=>Math.log(o.evaluate(d))],log2:[vn,[vn],(d,[o])=>Math.log(o.evaluate(d))/Math.LN2],sin:[vn,[vn],(d,[o])=>Math.sin(o.evaluate(d))],cos:[vn,[vn],(d,[o])=>Math.cos(o.evaluate(d))],tan:[vn,[vn],(d,[o])=>Math.tan(o.evaluate(d))],asin:[vn,[vn],(d,[o])=>Math.asin(o.evaluate(d))],acos:[vn,[vn],(d,[o])=>Math.acos(o.evaluate(d))],atan:[vn,[vn],(d,[o])=>Math.atan(o.evaluate(d))],min:[vn,Ac(vn),(d,o)=>Math.min(...o.map(c=>c.evaluate(d)))],max:[vn,Ac(vn),(d,o)=>Math.max(...o.map(c=>c.evaluate(d)))],abs:[vn,[vn],(d,[o])=>Math.abs(o.evaluate(d))],round:[vn,[vn],(d,[o])=>{const c=o.evaluate(d);return c<0?-Math.round(-c):Math.round(c)}],floor:[vn,[vn],(d,[o])=>Math.floor(o.evaluate(d))],ceil:[vn,[vn],(d,[o])=>Math.ceil(o.evaluate(d))],"filter-==":[Ur,[ui,Yr],(d,[o,c])=>d.properties()[o.value]===c.value],"filter-id-==":[Ur,[Yr],(d,[o])=>d.id()===o.value],"filter-type-==":[Ur,[ui],(d,[o])=>d.geometryType()===o.value],"filter-<":[Ur,[ui,Yr],(d,[o,c])=>{const f=d.properties()[o.value],g=c.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Ur,[Yr],(d,[o])=>{const c=d.id(),f=o.value;return typeof c==typeof f&&c<f}],"filter->":[Ur,[ui,Yr],(d,[o,c])=>{const f=d.properties()[o.value],g=c.value;return typeof f==typeof g&&f>g}],"filter-id->":[Ur,[Yr],(d,[o])=>{const c=d.id(),f=o.value;return typeof c==typeof f&&c>f}],"filter-<=":[Ur,[ui,Yr],(d,[o,c])=>{const f=d.properties()[o.value],g=c.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Ur,[Yr],(d,[o])=>{const c=d.id(),f=o.value;return typeof c==typeof f&&c<=f}],"filter->=":[Ur,[ui,Yr],(d,[o,c])=>{const f=d.properties()[o.value],g=c.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Ur,[Yr],(d,[o])=>{const c=d.id(),f=o.value;return typeof c==typeof f&&c>=f}],"filter-has":[Ur,[Yr],(d,[o])=>o.value in d.properties()],"filter-has-id":[Ur,[],d=>d.id()!==null&&d.id()!==void 0],"filter-type-in":[Ur,[Ci(ui)],(d,[o])=>o.value.indexOf(d.geometryType())>=0],"filter-id-in":[Ur,[Ci(Yr)],(d,[o])=>o.value.indexOf(d.id())>=0],"filter-in-small":[Ur,[ui,Ci(Yr)],(d,[o,c])=>c.value.indexOf(d.properties()[o.value])>=0],"filter-in-large":[Ur,[ui,Ci(Yr)],(d,[o,c])=>function(f,g,p,x){for(;p<=x;){const I=p+x>>1;if(g[I]===f)return!0;g[I]>f?x=I-1:p=I+1}return!1}(d.properties()[o.value],c.value,0,c.value.length-1)],all:{type:Ur,overloads:[[[Ur,Ur],(d,[o,c])=>o.evaluate(d)&&c.evaluate(d)],[Ac(Ur),(d,o)=>{for(const c of o)if(!c.evaluate(d))return!1;return!0}]]},any:{type:Ur,overloads:[[[Ur,Ur],(d,[o,c])=>o.evaluate(d)||c.evaluate(d)],[Ac(Ur),(d,o)=>{for(const c of o)if(c.evaluate(d))return!0;return!1}]]},"!":[Ur,[Ur],(d,[o])=>!o.evaluate(d)],"is-supported-script":[Ur,[ui],(d,[o])=>{const c=d.globals&&d.globals.isSupportedScript;return!c||c(o.evaluate(d))}],upcase:[ui,[ui],(d,[o])=>o.evaluate(d).toUpperCase()],downcase:[ui,[ui],(d,[o])=>o.evaluate(d).toLowerCase()],concat:[ui,Ac(Yr),(d,o)=>o.map(c=>Gs(c.evaluate(d))).join("")],"resolved-locale":[ui,[Oo],(d,[o])=>o.evaluate(d).resolvedLocale()],random:[vn,[vn,vn,Yr],(d,o)=>{const[c,f,g]=o.map(x=>x.evaluate(d));if(c>f||c===f)return c;let p;if(typeof g=="string")p=function(x){let I=0;if(x.length===0)return I;for(let D=0;D<x.length;D++)I=(I<<5)-I+x.charCodeAt(D),I|=0;return I}(g);else{if(typeof g!="number")throw new _r(`Invalid seed input: ${g}`);p=g}return c+t1(p)()*(f-c)}]});class a1{constructor(o,c,f,g){this.expression=o,this._warningHistory={},this._evaluator=new ac(f,g),this._defaultValue=c?function(p){return p.type==="color"&&(V_(p.default)||Array.isArray(p.default))?new Qr(0,0,0,0):p.type==="color"?Qr.parse(p.default)||null:p.default===void 0?null:p.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=Um(o)}evaluateWithoutErrorHandling(o,c,f,g,p,x,I,D){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=g||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=I||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(o,c,f,g,p,x,I,D){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=I||null,this._evaluator.featureDistanceData=D||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new _r(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${L.message}`)),this._defaultValue}}}function H_(d){return Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0]in Xf}function Zf(d,o,c,f){const g=new Ux(Xf,[],o?function(x){const I={color:oo,string:ui,number:vn,enum:ui,boolean:Ur,formatted:Pl,resolvedImage:sa};return x.type==="array"?Ci(I[x.value]||Yr,x.length):I[x.type]}(o):void 0,void 0,void 0,c,f),p=g.parse(d,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?r1(new a1(p,o,c,f)):rh(g.errors)}class l1{constructor(o,c,f,g){this.kind=o,this._styleExpression=c,this.isLightConstant=f,this.isLineProgressConstant=g,this.isStateDependent=o!=="constant"&&!jd(c.expression),this.configDependencies=Um(c.expression)}evaluateWithoutErrorHandling(o,c,f,g,p,x){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,g,p,x)}evaluate(o,c,f,g,p,x){return this._styleExpression.evaluate(o,c,f,g,p,x)}}class Qf{constructor(o,c,f,g,p,x){this.kind=o,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=o!=="camera"&&!jd(c.expression),this.isLightConstant=p,this.isLineProgressConstant=x,this.configDependencies=Um(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(o,c,f,g,p,x){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,g,p,x)}evaluate(o,c,f,g,p,x){return this._styleExpression.evaluate(o,c,f,g,p,x)}interpolationFactor(o,c,f){return this.interpolationType?lc.interpolationFactor(this.interpolationType,o,c,f):0}}function c1(d,o,c,f){if((d=Zf(d,o,c,f)).result==="error")return d;const g=d.value.expression,p=Gh(g);if(!p&&!Kf(o))return rh([new Ir("","data expressions not supported")]);const x=nh(g,["zoom","pitch","distance-from-center"]);if(!x&&!K2(o))return rh([new Ir("","zoom expressions not supported")]);const I=nh(g,["measure-light"]);if(!I&&!j_(o))return rh([new Ir("","measure-light expression not supported")]);const D=nh(g,["line-progress"]);if(!D&&!function(k){return i1(k.expression,"line-progress")}(o))return rh([new Ir("","line-progress expression not supported")]);const L=o.expression&&o.expression.relaxZoomRestriction,T=$_(g);return T||x||L?T instanceof Ir?rh([T]):T instanceof lc&&!s1(o)?rh([new Ir("",'"interpolate" expressions cannot be used with this property')]):r1(T?new Qf(p&&D?"camera":"composite",d.value,T.labels,T instanceof lc?T.interpolation:void 0,I,D):new l1(p&&D?"constant":"source",d.value,I,D)):rh([new Ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class W_{constructor(o,c){this._parameters=o,this._specification=c,Or(this,Q2(this._parameters,this._specification))}static deserialize(o){return new W_(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function $_(d){let o=null;if(d instanceof L_)o=$_(d.result);else if(d instanceof O_){for(const c of d.args)if(o=$_(c),o)break}else(d instanceof Au||d instanceof lc)&&d.input instanceof Mi&&d.input.name==="zoom"&&(o=d);return o instanceof Ir||d.eachChild(c=>{const f=$_(c);f instanceof Ir?o=f:o&&f&&o!==f&&(o=new Ir("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Ym,eE,tE=function(){if(eE)return Ym;eE=1,Ym=o;var d=3;function o(c,f,g){var p=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var x=new Int32Array(this.arrayBuffer);c=x[0],this.d=(f=x[1])+2*(g=x[2]);for(var I=0;I<this.d*this.d;I++){var D=x[d+I],L=x[d+I+1];p.push(D===L?null:x.subarray(D,L))}var T=x[d+p.length+1];this.keys=x.subarray(x[d+p.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=f+2*g;for(var k=0;k<this.d*this.d;k++)p.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=c,this.padding=g,this.scale=f/c,this.uid=0;var z=g/f*c;this.min=-z,this.max=c+z}return o.prototype.insert=function(c,f,g,p,x){this._forEachCell(f,g,p,x,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(p),this.bboxes.push(x)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(c,f,g,p,x,I){this.cells[x].push(I)},o.prototype.query=function(c,f,g,p,x){var I=this.min,D=this.max;if(c<=I&&f<=I&&D<=g&&D<=p&&!x)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(c,f,g,p,this._queryCell,L,{},x),L},o.prototype._queryCell=function(c,f,g,p,x,I,D,L){var T=this.cells[x];if(T!==null)for(var k=this.keys,z=this.bboxes,O=0;O<T.length;O++){var B=T[O];if(D[B]===void 0){var U=4*B;(L?L(z[U+0],z[U+1],z[U+2],z[U+3]):c<=z[U+2]&&f<=z[U+3]&&g>=z[U+0]&&p>=z[U+1])?(D[B]=!0,I.push(k[B])):D[B]=!1}}},o.prototype._forEachCell=function(c,f,g,p,x,I,D,L){for(var T=this._convertToCellCoord(c),k=this._convertToCellCoord(f),z=this._convertToCellCoord(g),O=this._convertToCellCoord(p),B=T;B<=z;B++)for(var U=k;U<=O;U++){var X=this.d*U+B;if((!L||L(this._convertFromCellCoord(B),this._convertFromCellCoord(U),this._convertFromCellCoord(B+1),this._convertFromCellCoord(U+1)))&&x.call(this,c,f,g,p,X,I,D,L))return}},o.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},o.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,f=d+this.cells.length+1+1,g=0,p=0;p<this.cells.length;p++)g+=this.cells[p].length;var x=new Int32Array(f+g+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var I=f,D=0;D<c.length;D++){var L=c[D];x[d+D]=I,x.set(L,I),I+=L.length}return x[d+c.length]=I,x.set(this.keys,I),x[d+c.length+1]=I+=this.keys.length,x.set(this.bboxes,I),I+=this.bboxes.length,x.buffer},Ym}(),Jf=v(tE);const q_={};function Tn(d,o,c={}){Object.defineProperty(d,"_classRegistryKey",{value:o,writable:!1}),q_[o]={klass:d,omit:c.omit||[]}}Tn(Object,"Object"),Jf.serialize=function(d,o){const c=d.toArrayBuffer();return o&&o.add(c),{buffer:c}},Jf.deserialize=function(d){return new Jf(d.buffer)},Object.defineProperty(Jf,"name",{value:"Grid"}),Tn(Jf,"Grid"),typeof DOMMatrix<"u"&&Tn(DOMMatrix,"DOMMatrix"),Tn(Qr,"Color"),Tn(Error,"Error"),Tn(Rs,"Formatted"),Tn(Cu,"FormattedSection"),Tn(Gr,"AJAXError"),Tn(hi,"ResolvedImage"),Tn(W_,"StylePropertyFunction"),Tn(a1,"StyleExpression",{omit:["_evaluator"]}),Tn(mr,"ImageId"),Tn(hl,"ImageVariant"),Tn(Qf,"ZoomDependentExpression"),Tn(l1,"ZoomConstantExpression"),Tn(Mi,"CompoundExpression",{omit:["_evaluate"]});for(const d in Xf)q_[Xf[d]._classRegistryKey]||Tn(Xf[d],`Expression${d}`);function u1(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&d.constructor.name==="ArrayBuffer")}function h1(d){return self.ImageBitmap&&d instanceof ImageBitmap}function Yh(d,o){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp)return d;if(u1(d)||h1(d))return o&&o.add(d),d;if(ArrayBuffer.isView(d))return o&&o.add(d.buffer),d;if(d instanceof ImageData)return o&&o.add(d.data.buffer),d;if(Array.isArray(d)){const c=[];for(const f of d)c.push(Yh(f,o));return c}if(d instanceof Map){const c={$name:"Map",entries:[]};for(const[f,g]of d.entries())c.entries.push(Yh(f),Yh(g));return c}if(d instanceof Set){const c={$name:"Set"};let f=0;for(const g of d.values())c[++f]=Yh(g);return c}if(d instanceof DOMMatrix){const c={$name:"DOMMatrix"},f=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const g of f)c[g]=d[g];return c}if(typeof d=="bigint")return{$name:"BigInt",value:d.toString()};if(typeof d=="object"){const c=d.constructor,f=c._classRegistryKey;if(!f)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const g=c.serialize?c.serialize(d,o):{};if(!c.serialize){for(const p in d)d.hasOwnProperty(p)&&(q_[f].omit.indexOf(p)>=0||(g[p]=Yh(d[p],o)));d instanceof Error&&(g.message=d.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof d)}function cc(d){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||u1(d)||h1(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(cc);if(typeof d=="object"){const o=d.$name||"Object";if(o==="Map"){const g=d.entries||[],p=new Map;for(let x=0;x<g.length;x+=2)p.set(cc(g[x]),cc(g[x+1]));return p}if(o==="Set"){const g=new Set;for(const p of Object.keys(d))p!=="$name"&&g.add(cc(d[p]));return g}if(o==="DOMMatrix"){let g;return g=d.is2D?[d.a,d.b,d.c,d.d,d.e,d.f]:[d.m11,d.m12,d.m13,d.m14,d.m21,d.m22,d.m23,d.m24,d.m31,d.m32,d.m33,d.m34,d.m41,d.m42,d.m43,d.m44],new DOMMatrix(g)}if(o==="BigInt")return BigInt(d.value);const{klass:c}=q_[o];if(!c)throw new Error(`Can't deserialize unregistered class "${o}".`);if(c.deserialize)return c.deserialize(d);const f=Object.create(c.prototype);for(const g of Object.keys(d))g!=="$name"&&(f[g]=cc(d[g]));return f}throw new Error("can't deserialize object of type "+typeof d)}const Gn={"Latin-1 Supplement":d=>d>=128&&d<=255,Arabic:d=>d>=1536&&d<=1791,"Arabic Supplement":d=>d>=1872&&d<=1919,"Arabic Extended-A":d=>d>=2208&&d<=2303,"Hangul Jamo":d=>d>=4352&&d<=4607,"Unified Canadian Aboriginal Syllabics":d=>d>=5120&&d<=5759,Khmer:d=>d>=6016&&d<=6143,"Unified Canadian Aboriginal Syllabics Extended":d=>d>=6320&&d<=6399,"General Punctuation":d=>d>=8192&&d<=8303,"Letterlike Symbols":d=>d>=8448&&d<=8527,"Number Forms":d=>d>=8528&&d<=8591,"Miscellaneous Technical":d=>d>=8960&&d<=9215,"Control Pictures":d=>d>=9216&&d<=9279,"Optical Character Recognition":d=>d>=9280&&d<=9311,"Enclosed Alphanumerics":d=>d>=9312&&d<=9471,"Geometric Shapes":d=>d>=9632&&d<=9727,"Miscellaneous Symbols":d=>d>=9728&&d<=9983,"Miscellaneous Symbols and Arrows":d=>d>=11008&&d<=11263,"CJK Radicals Supplement":d=>d>=11904&&d<=12031,"Kangxi Radicals":d=>d>=12032&&d<=12255,"Ideographic Description Characters":d=>d>=12272&&d<=12287,"CJK Symbols and Punctuation":d=>d>=12288&&d<=12351,Hiragana:d=>d>=12352&&d<=12447,Katakana:d=>d>=12448&&d<=12543,Bopomofo:d=>d>=12544&&d<=12591,"Hangul Compatibility Jamo":d=>d>=12592&&d<=12687,Kanbun:d=>d>=12688&&d<=12703,"Bopomofo Extended":d=>d>=12704&&d<=12735,"CJK Strokes":d=>d>=12736&&d<=12783,"Katakana Phonetic Extensions":d=>d>=12784&&d<=12799,"Enclosed CJK Letters and Months":d=>d>=12800&&d<=13055,"CJK Compatibility":d=>d>=13056&&d<=13311,"CJK Unified Ideographs Extension A":d=>d>=13312&&d<=19903,"Yijing Hexagram Symbols":d=>d>=19904&&d<=19967,"CJK Unified Ideographs":d=>d>=19968&&d<=40959,"Yi Syllables":d=>d>=40960&&d<=42127,"Yi Radicals":d=>d>=42128&&d<=42191,"Hangul Jamo Extended-A":d=>d>=43360&&d<=43391,"Hangul Syllables":d=>d>=44032&&d<=55215,"Hangul Jamo Extended-B":d=>d>=55216&&d<=55295,"Private Use Area":d=>d>=57344&&d<=63743,"CJK Compatibility Ideographs":d=>d>=63744&&d<=64255,"Arabic Presentation Forms-A":d=>d>=64336&&d<=65023,"Vertical Forms":d=>d>=65040&&d<=65055,"CJK Compatibility Forms":d=>d>=65072&&d<=65103,"Small Form Variants":d=>d>=65104&&d<=65135,"Arabic Presentation Forms-B":d=>d>=65136&&d<=65279,"Halfwidth and Fullwidth Forms":d=>d>=65280&&d<=65519,Osage:d=>d>=66736&&d<=66815,"CJK Unified Ideographs Extension B":d=>d>=131072&&d<=173791};function d1(d){for(const o of d)if(G_(o.charCodeAt(0)))return!0;return!1}function fM(d){for(const o of d)if(!nE(o.charCodeAt(0)))return!1;return!0}function nE(d){return!(Gn.Arabic(d)||Gn["Arabic Supplement"](d)||Gn["Arabic Extended-A"](d)||Gn["Arabic Presentation Forms-A"](d)||Gn["Arabic Presentation Forms-B"](d))}function G_(d){return!(d!==746&&d!==747&&(d<4352||!(Gn["Bopomofo Extended"](d)||Gn.Bopomofo(d)||Gn["CJK Compatibility Forms"](d)&&!(d>=65097&&d<=65103)||Gn["CJK Compatibility Ideographs"](d)||Gn["CJK Compatibility"](d)||Gn["CJK Radicals Supplement"](d)||Gn["CJK Strokes"](d)||!(!Gn["CJK Symbols and Punctuation"](d)||d>=12296&&d<=12305||d>=12308&&d<=12319||d===12336)||Gn["CJK Unified Ideographs Extension A"](d)||Gn["CJK Unified Ideographs"](d)||Gn["Enclosed CJK Letters and Months"](d)||Gn["Hangul Compatibility Jamo"](d)||Gn["Hangul Jamo Extended-A"](d)||Gn["Hangul Jamo Extended-B"](d)||Gn["Hangul Jamo"](d)||Gn["Hangul Syllables"](d)||Gn.Hiragana(d)||Gn["Ideographic Description Characters"](d)||Gn.Kanbun(d)||Gn["Kangxi Radicals"](d)||Gn["Katakana Phonetic Extensions"](d)||Gn.Katakana(d)&&d!==12540||!(!Gn["Halfwidth and Fullwidth Forms"](d)||d===65288||d===65289||d===65293||d>=65306&&d<=65310||d===65339||d===65341||d===65343||d>=65371&&d<=65503||d===65507||d>=65512&&d<=65519)||!(!Gn["Small Form Variants"](d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||Gn["Unified Canadian Aboriginal Syllabics"](d)||Gn["Unified Canadian Aboriginal Syllabics Extended"](d)||Gn["Vertical Forms"](d)||Gn["Yijing Hexagram Symbols"](d)||Gn["Yi Syllables"](d)||Gn["Yi Radicals"](d))))}function f1(d){return!(G_(d)||function(o){return!!(Gn["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Gn["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Gn["Letterlike Symbols"](o)||Gn["Number Forms"](o)||Gn["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Gn["Control Pictures"](o)&&o!==9251||Gn["Optical Character Recognition"](o)||Gn["Enclosed Alphanumerics"](o)||Gn["Geometric Shapes"](o)||Gn["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Gn["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Gn["CJK Symbols and Punctuation"](o)||Gn.Katakana(o)||Gn["Private Use Area"](o)||Gn["CJK Compatibility Forms"](o)||Gn["Small Form Variants"](o)||Gn["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(d))}function rE(d){return Gn.Arabic(d)||Gn["Arabic Supplement"](d)||Gn["Arabic Extended-A"](d)||Gn["Arabic Presentation Forms-A"](d)||Gn["Arabic Presentation Forms-B"](d)}function Y_(d){return d>=1424&&d<=2303||Gn["Arabic Presentation Forms-A"](d)||Gn["Arabic Presentation Forms-B"](d)}function p1(d,o){return!(!o&&Y_(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||Gn.Khmer(d))}function iE(d){for(const o of d)if(Y_(o.charCodeAt(0)))return!0;return!1}const m1="deferred",Ru="loading",g1="loaded";let _1=null,fl="unavailable",Xh=null;const Xm=function(d){d&&typeof d=="string"&&d.indexOf("NetworkError")>-1&&(fl="error"),_1&&_1(d)};function X_(){ep.fire(new zi("pluginStateChange",{pluginStatus:fl,pluginURL:Xh}))}const ep=new qs,K_=function(){return fl},sE=function(){if(fl!==m1||!Xh)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fl=Ru,X_(),Xh&&xa({url:Xh},d=>{d?Xm(d):(fl=g1,X_())})},Rc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fl===g1||Rc.applyArabicShaping!=null,isLoading:()=>fl===Ru,setState(d){fl=d.pluginStatus,Xh=d.pluginURL},isParsed:()=>Rc.applyArabicShaping!=null&&Rc.processBidirectionalText!=null&&Rc.processStyledBidirectionalText!=null,getPluginURL:()=>Xh};class Wi{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(c,f){for(const g of c)if(!p1(g.charCodeAt(0),f))return!1;return!0}(o,Rc.isLoaded())}}class tp{constructor(o,c,f,g){this.property=o,this.value=c,this.expression=function(p,x,I,D){if(V_(p))return new W_(p,x);if(H_(p)||Array.isArray(p)&&p.length>0){const L=c1(p,x,I,D);if(L.result==="error")throw new Error(L.value.map(T=>`${T.key}: ${T.message}`).join(", "));return L.value}{let L=p;return typeof p=="string"&&x.type==="color"&&(L=Qr.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>L}}}(c===void 0?o.specification.default:c,o.specification,f,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,c,f){return this.property.possiblyEvaluate(this,o,c,f)}}class y1{constructor(o,c,f){this.property=o,this.value=new tp(o,void 0,c,f)}transitioned(o,c){return new Z_(this.property,this.value,c,Oi({},o.transition,this.transition),o.now)}untransitioned(){return new Z_(this.property,this.value,null,{},0)}}class x1{constructor(o,c,f){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=c,this._options=f,this.configDependencies=new Set}getValue(o){return Rr(this._values[o].value.value)}setValue(o,c){this._values.hasOwnProperty(o)||(this._values[o]=new y1(this._values[o].property,this._scope,this._options)),this._values[o].value=new tp(this._values[o].property,c===null?void 0:Rr(c),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,c){c&&(this._options=c);const f=this._properties.properties;if(o)for(const g in o){const p=o[g];if(g.endsWith("-transition")){const x=g.slice(0,-11);f[x]&&this.setTransition(x,p)}else f.hasOwnProperty(g)&&this.setValue(g,p)}}getTransition(o){return Rr(this._values[o].transition)}setTransition(o,c){this._values.hasOwnProperty(o)||(this._values[o]=new y1(this._values[o].property)),this._values[o].transition=Rr(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f);const g=this.getTransition(c);g!==void 0&&(o[`${c}-transition`]=g)}return o}transitioned(o,c){const f=new Km(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(o,c._values[g]);return f}untransitioned(){const o=new Km(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class Z_{constructor(o,c,f,g,p){const x=g.delay||0,I=g.duration||0;p=p||0,this.property=o,this.value=c,this.begin=p+x,this.end=this.begin+I,o.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(o,c,f){const g=o.now||0,p=this.value.possiblyEvaluate(o,c,f),x=this.prior;if(x){if(g>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(g<this.begin)return x.possiblyEvaluate(o,c,f);{const I=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(o,c,f),p,un(I))}}return p}}class Km{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,f){const g=new ip(this._properties);for(const p of Object.keys(this._values))g._values[p]=this._values[p].possiblyEvaluate(o,c,f);return g}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class np{constructor(o,c,f){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=c,this._options=f,this.configDependencies=new Set}getValue(o){return Rr(this._values[o].value)}setValue(o,c){this._values[o]=new tp(this._values[o].property,c===null?void 0:Rr(c),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f)}return o}possiblyEvaluate(o,c,f){const g=new ip(this._properties);for(const p of Object.keys(this._values))g._values[p]=this._values[p].possiblyEvaluate(o,c,f);return g}}class rp{constructor(o,c,f){this.property=o,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,c,f,g){return this.property.evaluate(this.value,this.parameters,o,c,f,g)}}class ip{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class on{constructor(o){this.specification=o}possiblyEvaluate(o,c){return o.expression.evaluate(c)}interpolate(o,c,f){const g=ba[this.specification.type];return g?g(o,c,f):o}}class Sn{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,f,g){return new rp(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(c,null,{},f,g)}:o.expression,c)}interpolate(o,c,f){if(o.value.kind!=="constant"||c.value.kind!=="constant")return o;if(o.value.value===void 0||c.value.value===void 0)return new rp(this,{kind:"constant",value:void 0},o.parameters);const g=ba[this.specification.type];return g?new rp(this,{kind:"constant",value:g(o.value.value,c.value.value,f)},o.parameters):o}evaluate(o,c,f,g,p,x){return o.kind==="constant"?o.value:o.evaluate(c,f,g,p,x)}}class sp{constructor(o){this.specification=o}possiblyEvaluate(o,c,f,g){return!!o.expression.evaluate(c,null,{},f,g)}interpolate(){return!1}}class Ds{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new Wi(0,{});for(const f in o){const g=o[f];g.specification.overridable&&this.overridableProperties.push(f);const p=this.defaultPropertyValues[f]=new tp(g,void 0),x=this.defaultTransitionablePropertyValues[f]=new y1(g);this.defaultTransitioningPropertyValues[f]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=p.possiblyEvaluate(c)}}}Tn(Sn,"DataDrivenProperty"),Tn(on,"DataConstantProperty"),Tn(sp,"ColorRampProperty");var St=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function oE(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function Q_(d){if(Array.isArray(d))return d.map(Q_);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const o={};for(const c in d)o[c]=Q_(d[c]);return o}return oE(d)}function v1(d){if(d===!0||d===!1)return!0;if(!Array.isArray(d)||d.length===0)return!1;switch(d[0]){case"has":return d.length>=2&&d[1]!=="$id"&&d[1]!=="$type";case"in":return d.length>=3&&(typeof d[1]!="string"||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return d.length!==3||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const o of d.slice(1))if(!v1(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function b1(d,o="",c=null,f="fill"){if(d==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};v1(d)||(d=J_(d));const g=d;let p=!0;try{p=function(T){if(!op(T))return T;let k=Q_(T);return lE(k),k=aE(k),k}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}let x=null,I=null;if(f!=="background"&&f!=="sky"&&f!=="slot"){I=St[`filter_${f}`];const T=Zf(p,I,o,c);if(T.result==="error")throw new Error(T.value.map(k=>`${k.key}: ${k.message}`).join(", "));x=(k,z,O)=>T.value.evaluate(k,z,{},O)}let D=null,L=null;if(p!==g){const T=Zf(g,I,o,c);if(T.result==="error")throw new Error(T.value.map(k=>`${k.key}: ${k.message}`).join(", "));D=(k,z,O,B,U)=>T.value.evaluate(k,z,{},O,void 0,void 0,B,U),L=!Gh(T.value.expression)}return{filter:x,dynamicFilter:D||void 0,needGeometry:cE(p),needFeature:!!L}}function aE(d){if(!Array.isArray(d))return d;const o=function(c){if(pM.has(c[0])){for(let f=1;f<c.length;f++)if(op(c[f]))return!0}return c}(d);return o===!0?o:o.map(c=>aE(c))}function lE(d){let o=!1;const c=[];if(d[0]==="case"){for(let f=1;f<d.length-1;f+=2)o=o||op(d[f]),c.push(d[f+1]);c.push(d[d.length-1])}else if(d[0]==="match"){o=o||op(d[1]);for(let f=2;f<d.length-1;f+=2)c.push(d[f+1]);c.push(d[d.length-1])}else if(d[0]==="step"){o=o||op(d[1]);for(let f=1;f<d.length-1;f+=2)c.push(d[f+1])}o&&(d.length=0,d.push("any",...c));for(let f=1;f<d.length;f++)lE(d[f])}function op(d){if(!Array.isArray(d))return!1;if((o=d[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let c=1;c<d.length;c++)if(op(d[c]))return!0;return!1}const pM=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function mM(d,o){return d<o?-1:d>o?1:0}function cE(d){if(!Array.isArray(d))return!1;if(d[0]==="within"||d[0]==="distance")return!0;for(let o=1;o<d.length;o++)if(cE(d[o]))return!0;return!1}function J_(d){if(!d)return!0;const o=d[0];return d.length<=1?o!=="any":o==="=="?Kh(d[1],d[2],"=="):o==="!="?Ud(Kh(d[1],d[2],"==")):o==="<"||o===">"||o==="<="||o===">="?Kh(d[1],d[2],o):o==="any"?(c=d.slice(1),["any"].concat(c.map(J_))):o==="all"?["all"].concat(d.slice(1).map(J_)):o==="none"?["all"].concat(d.slice(1).map(J_).map(Ud)):o==="in"?w1(d[1],d.slice(2)):o==="!in"?Ud(w1(d[1],d.slice(2))):o==="has"?E1(d[1]):o!=="!has"||Ud(E1(d[1]));var c}function Kh(d,o,c){switch(d){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,d,o]}}function w1(d,o){if(o.length===0)return!1;switch(d){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",d,["literal",o.sort(mM)]]:["filter-in-small",d,["literal",o]]}}function E1(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function Ud(d){return["!",d]}const e0="";function ap(d,o){return o?`${d}${e0}${o}`:d}const ih="-transition",uE=new Set(["fill","line","background","hillshade","raster"]);class Qo extends qs{constructor(o,c,f,g,p){if(super(),this.id=o.id,this.fqid=ap(this.id,f),this.type=o.type,this.scope=f,this.lut=g,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,o.type!=="custom"){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&o.type!=="background"&&o.type!=="sky"&&o.type!=="slot"){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const x=Zf(this.filter,St[`filter_${o.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(o.slot&&(this.slot=o.slot),c.layout&&(this._unevaluatedLayout=new np(c.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),c.paint){this._transitionablePaint=new x1(c.paint,this.scope,p);for(const x in o.paint)this.setPaintProperty(x,o.paint[x]);for(const x in o.layout)this.setLayoutProperty(x,o.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ip(c.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&uE.has(this.type)}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c){if(this.type==="custom"&&o==="visibility")return void(this.visibility=c);const f=this._unevaluatedLayout;f._properties.properties[o]&&(f.setValue(o,c),this.configDependencies=new Set([...this.configDependencies,...f.configDependencies]),o==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(ih)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c){const f=this._transitionablePaint,g=f._properties.properties;if(o.endsWith(ih)){const k=o.slice(0,-11);return g[k]&&f.setTransition(k,c||void 0),!1}if(!g[o])return!1;const p=f._values[o],x=p.value.isDataDriven(),I=p.value;f.setValue(o,c),this.configDependencies=new Set([...this.configDependencies,...f.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);const D=f._values[o].value,L=D.isDataDriven(),T=o.endsWith("pattern")||o==="line-dasharray";return L||x||T||this._handleOverridablePaintPropertyUpdate(o,I,D)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,c,f){return null}_handleOverridablePaintPropertyUpdate(o,c,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){return rn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,c)=>!(o===void 0||c==="layout"&&!Object.keys(o).length||c==="paint"&&!Object.keys(o).length))}is3D(o){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof rp&&Kf(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=b1(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&(o.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,c,f,g,p,x,I,D,L){}}const gM={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zm{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function yi(d,o=1){let c=0,f=0;return{members:d.map(g=>{const p=gM[g.type].BYTES_PER_ELEMENT,x=c=hE(c,Math.max(o,p)),I=g.components||1;return f=Math.max(f,p),c+=p*I,{name:g.name,type:g.type,components:I,offset:x}}),size:hE(c,Math.max(f,o)),alignment:o}}function hE(d,o){return Math.ceil(d/o)*o}class sh extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const g=2*o;return this.int16[g+0]=c,this.int16[g+1]=f,o}}sh.prototype.bytesPerElement=4,Tn(sh,"StructArrayLayout2i4");class lp extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const p=3*o;return this.int16[p+0]=c,this.int16[p+1]=f,this.int16[p+2]=g,o}}lp.prototype.bytesPerElement=6,Tn(lp,"StructArrayLayout3i6");class oh extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,f,g)}emplace(o,c,f,g,p){const x=4*o;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=g,this.int16[x+3]=p,o}}oh.prototype.bytesPerElement=8,Tn(oh,"StructArrayLayout4i8");class Hd extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}Hd.prototype.bytesPerElement=4,Tn(Hd,"StructArrayLayout1f4");class Qm extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const p=4*o,x=2*o;return this.int16[p+0]=c,this.int16[p+1]=f,this.float32[x+1]=g,o}}Qm.prototype.bytesPerElement=8,Tn(Qm,"StructArrayLayout2i1f8");class S1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const p=4*o;return this.int16[p+0]=c,this.int16[p+1]=f,this.int16[p+2]=g,o}}S1.prototype.bytesPerElement=8,Tn(S1,"StructArrayLayout3i8");class Mc extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,f,g,p)}emplace(o,c,f,g,p,x){const I=5*o;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=p,this.int16[I+4]=x,o}}Mc.prototype.bytesPerElement=10,Tn(Mc,"StructArrayLayout5i10");class T1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,f,g,p,x,I)}emplace(o,c,f,g,p,x,I,D){const L=6*o,T=12*o,k=3*o;return this.int16[L+0]=c,this.int16[L+1]=f,this.uint8[T+4]=g,this.uint8[T+5]=p,this.uint8[T+6]=x,this.uint8[T+7]=I,this.float32[k+2]=D,o}}T1.prototype.bytesPerElement=12,Tn(T1,"StructArrayLayout2i4ub1f12");class Jc extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const p=3*o;return this.float32[p+0]=c,this.float32[p+1]=f,this.float32[p+2]=g,o}}Jc.prototype.bytesPerElement=12,Tn(Jc,"StructArrayLayout3f12");class Zh extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,f,g,p)}emplace(o,c,f,g,p,x){const I=6*o,D=3*o;return this.uint16[I+0]=c,this.uint16[I+1]=f,this.uint16[I+2]=g,this.uint16[I+3]=p,this.float32[D+2]=x,o}}Zh.prototype.bytesPerElement=12,Tn(Zh,"StructArrayLayout4ui1f12");class t0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,f,g)}emplace(o,c,f,g,p){const x=4*o;return this.uint16[x+0]=c,this.uint16[x+1]=f,this.uint16[x+2]=g,this.uint16[x+3]=p,o}}t0.prototype.bytesPerElement=8,Tn(t0,"StructArrayLayout4ui8");class n0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,f,g,p,x)}emplace(o,c,f,g,p,x,I){const D=6*o;return this.int16[D+0]=c,this.int16[D+1]=f,this.int16[D+2]=g,this.int16[D+3]=p,this.int16[D+4]=x,this.int16[D+5]=I,o}}n0.prototype.bytesPerElement=12,Tn(n0,"StructArrayLayout6i12");class C1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I,D,L,T,k,z){const O=this.length;return this.resize(O+1),this.emplace(O,o,c,f,g,p,x,I,D,L,T,k,z)}emplace(o,c,f,g,p,x,I,D,L,T,k,z,O){const B=12*o;return this.int16[B+0]=c,this.int16[B+1]=f,this.int16[B+2]=g,this.int16[B+3]=p,this.uint16[B+4]=x,this.uint16[B+5]=I,this.uint16[B+6]=D,this.uint16[B+7]=L,this.int16[B+8]=T,this.int16[B+9]=k,this.int16[B+10]=z,this.int16[B+11]=O,o}}C1.prototype.bytesPerElement=24,Tn(C1,"StructArrayLayout4i4ui4i24");class I1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,f,g,p,x)}emplace(o,c,f,g,p,x,I){const D=10*o,L=5*o;return this.int16[D+0]=c,this.int16[D+1]=f,this.int16[D+2]=g,this.float32[L+2]=p,this.float32[L+3]=x,this.float32[L+4]=I,o}}I1.prototype.bytesPerElement=20,Tn(I1,"StructArrayLayout3i3f20");class Wd extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,f,g)}emplace(o,c,f,g,p){const x=4*o;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=g,this.float32[x+3]=p,o}}Wd.prototype.bytesPerElement=16,Tn(Wd,"StructArrayLayout4f16");class A1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}A1.prototype.bytesPerElement=4,Tn(A1,"StructArrayLayout1ul4");class Qh extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const g=2*o;return this.uint16[g+0]=c,this.uint16[g+1]=f,o}}Qh.prototype.bytesPerElement=4,Tn(Qh,"StructArrayLayout2ui4");class R1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I,D,L,T,k,z,O){const B=this.length;return this.resize(B+1),this.emplace(B,o,c,f,g,p,x,I,D,L,T,k,z,O)}emplace(o,c,f,g,p,x,I,D,L,T,k,z,O,B){const U=20*o,X=10*o;return this.int16[U+0]=c,this.int16[U+1]=f,this.int16[U+2]=g,this.int16[U+3]=p,this.int16[U+4]=x,this.float32[X+3]=I,this.float32[X+4]=D,this.float32[X+5]=L,this.float32[X+6]=T,this.int16[U+14]=k,this.uint32[X+8]=z,this.uint16[U+18]=O,this.uint16[U+19]=B,o}}R1.prototype.bytesPerElement=40,Tn(R1,"StructArrayLayout5i4f1i1ul2ui40");class Jm extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,f,g,p,x,I)}emplace(o,c,f,g,p,x,I,D){const L=8*o;return this.int16[L+0]=c,this.int16[L+1]=f,this.int16[L+2]=g,this.int16[L+4]=p,this.int16[L+5]=x,this.int16[L+6]=I,this.int16[L+7]=D,o}}Jm.prototype.bytesPerElement=16,Tn(Jm,"StructArrayLayout3i2i2i16");class M1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,f,g,p)}emplace(o,c,f,g,p,x){const I=4*o,D=8*o;return this.float32[I+0]=c,this.float32[I+1]=f,this.float32[I+2]=g,this.int16[D+6]=p,this.int16[D+7]=x,o}}M1.prototype.bytesPerElement=16,Tn(M1,"StructArrayLayout2f1f2i16");class P1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,f,g,p,x)}emplace(o,c,f,g,p,x,I){const D=20*o,L=5*o;return this.uint8[D+0]=c,this.uint8[D+1]=f,this.float32[L+1]=g,this.float32[L+2]=p,this.float32[L+3]=x,this.float32[L+4]=I,o}}P1.prototype.bytesPerElement=20,Tn(P1,"StructArrayLayout2ub4f20");class la extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const p=3*o;return this.uint16[p+0]=c,this.uint16[p+1]=f,this.uint16[p+2]=g,o}}la.prototype.bytesPerElement=6,Tn(la,"StructArrayLayout3ui6");class r0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J,ce,le,ie,ge){const be=this.length;return this.resize(be+1),this.emplace(be,o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J,ce,le,ie,ge)}emplace(o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J,ce,le,ie,ge,be){const Se=30*o,Ve=15*o,Le=60*o;return this.int16[Se+0]=c,this.int16[Se+1]=f,this.int16[Se+2]=g,this.float32[Ve+2]=p,this.float32[Ve+3]=x,this.uint16[Se+8]=I,this.uint16[Se+9]=D,this.uint32[Ve+5]=L,this.uint32[Ve+6]=T,this.uint32[Ve+7]=k,this.uint16[Se+16]=z,this.uint16[Se+17]=O,this.uint16[Se+18]=B,this.float32[Ve+10]=U,this.float32[Ve+11]=X,this.uint8[Le+48]=J,this.uint8[Le+49]=ce,this.uint8[Le+50]=le,this.uint32[Ve+13]=ie,this.int16[Se+28]=ge,this.uint8[Le+58]=be,o}}r0.prototype.bytesPerElement=60,Tn(r0,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class i0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J,ce,le,ie,ge,be,Se,Ve,Le,Be,Qe,Ue,Je,lt,st,mt,pt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J,ce,le,ie,ge,be,Se,Ve,Le,Be,Qe,Ue,Je,lt,st,mt,pt)}emplace(o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J,ce,le,ie,ge,be,Se,Ve,Le,Be,Qe,Ue,Je,lt,st,mt,pt,vt){const _t=20*o,Et=40*o,qt=80*o;return this.float32[_t+0]=c,this.float32[_t+1]=f,this.int16[Et+4]=g,this.int16[Et+5]=p,this.int16[Et+6]=x,this.int16[Et+7]=I,this.int16[Et+8]=D,this.int16[Et+9]=L,this.int16[Et+10]=T,this.int16[Et+11]=k,this.int16[Et+12]=z,this.uint16[Et+13]=O,this.uint16[Et+14]=B,this.uint16[Et+15]=U,this.uint16[Et+16]=X,this.uint16[Et+17]=J,this.uint16[Et+18]=ce,this.uint16[Et+19]=le,this.uint16[Et+20]=ie,this.uint16[Et+21]=ge,this.uint16[Et+22]=be,this.uint16[Et+23]=Se,this.uint16[Et+24]=Ve,this.uint16[Et+25]=Le,this.uint16[Et+26]=Be,this.uint16[Et+27]=Qe,this.uint32[_t+14]=Ue,this.float32[_t+15]=Je,this.float32[_t+16]=lt,this.float32[_t+17]=st,this.float32[_t+18]=mt,this.uint8[qt+76]=pt,this.uint16[Et+39]=vt,o}}i0.prototype.bytesPerElement=80,Tn(i0,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ll extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,f,g,p)}emplace(o,c,f,g,p,x){const I=5*o;return this.float32[I+0]=c,this.float32[I+1]=f,this.float32[I+2]=g,this.float32[I+3]=p,this.float32[I+4]=x,o}}Ll.prototype.bytesPerElement=20,Tn(Ll,"StructArrayLayout5f20");class s0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,f,g,p,x,I)}emplace(o,c,f,g,p,x,I,D){const L=7*o;return this.float32[L+0]=c,this.float32[L+1]=f,this.float32[L+2]=g,this.float32[L+3]=p,this.float32[L+4]=x,this.float32[L+5]=I,this.float32[L+6]=D,o}}s0.prototype.bytesPerElement=28,Tn(s0,"StructArrayLayout7f28");class D1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I,D,L,T,k){const z=this.length;return this.resize(z+1),this.emplace(z,o,c,f,g,p,x,I,D,L,T,k)}emplace(o,c,f,g,p,x,I,D,L,T,k,z){const O=11*o;return this.float32[O+0]=c,this.float32[O+1]=f,this.float32[O+2]=g,this.float32[O+3]=p,this.float32[O+4]=x,this.float32[O+5]=I,this.float32[O+6]=D,this.float32[O+7]=L,this.float32[O+8]=T,this.float32[O+9]=k,this.float32[O+10]=z,o}}D1.prototype.bytesPerElement=44,Tn(D1,"StructArrayLayout11f44");class k1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I,D,L){const T=this.length;return this.resize(T+1),this.emplace(T,o,c,f,g,p,x,I,D,L)}emplace(o,c,f,g,p,x,I,D,L,T){const k=9*o;return this.float32[k+0]=c,this.float32[k+1]=f,this.float32[k+2]=g,this.float32[k+3]=p,this.float32[k+4]=x,this.float32[k+5]=I,this.float32[k+6]=D,this.float32[k+7]=L,this.float32[k+8]=T,o}}k1.prototype.bytesPerElement=36,Tn(k1,"StructArrayLayout9f36");class cp extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const g=2*o;return this.float32[g+0]=c,this.float32[g+1]=f,o}}cp.prototype.bytesPerElement=8,Tn(cp,"StructArrayLayout2f8");class eg extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,f,g)}emplace(o,c,f,g,p){const x=6*o;return this.uint32[3*o+0]=c,this.uint16[x+2]=f,this.uint16[x+3]=g,this.uint16[x+4]=p,o}}eg.prototype.bytesPerElement=12,Tn(eg,"StructArrayLayout1ul3ui12");class o0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}o0.prototype.bytesPerElement=2,Tn(o0,"StructArrayLayout1ui2");class a0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X){const J=this.length;return this.resize(J+1),this.emplace(J,o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X)}emplace(o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J){const ce=16*o;return this.float32[ce+0]=c,this.float32[ce+1]=f,this.float32[ce+2]=g,this.float32[ce+3]=p,this.float32[ce+4]=x,this.float32[ce+5]=I,this.float32[ce+6]=D,this.float32[ce+7]=L,this.float32[ce+8]=T,this.float32[ce+9]=k,this.float32[ce+10]=z,this.float32[ce+11]=O,this.float32[ce+12]=B,this.float32[ce+13]=U,this.float32[ce+14]=X,this.float32[ce+15]=J,o}}a0.prototype.bytesPerElement=64,Tn(a0,"StructArrayLayout16f64");class l0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,p,x,I){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,f,g,p,x,I)}emplace(o,c,f,g,p,x,I,D){const L=10*o,T=5*o;return this.uint16[L+0]=c,this.uint16[L+1]=f,this.uint16[L+2]=g,this.uint16[L+3]=p,this.float32[T+2]=x,this.float32[T+3]=I,this.float32[T+4]=D,o}}l0.prototype.bytesPerElement=20,Tn(l0,"StructArrayLayout4ui3f20");class c0 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.int16[1*o+0]=c,o}}c0.prototype.bytesPerElement=2,Tn(c0,"StructArrayLayout1i2");class N1 extends rs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint8[1*o+0]=c,o}}N1.prototype.bytesPerElement=1,Tn(N1,"StructArrayLayout1ub1");class O1 extends Zm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}O1.prototype.size=40;class tg extends R1{get(o){return new O1(this,o)}}Tn(tg,"CollisionBoxArray");class dE extends Zm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}dE.prototype.size=60;class fE extends r0{get(o){return new dE(this,o)}}Tn(fE,"PlacedSymbolArray");class pE extends Zm{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}pE.prototype.size=80;class mE extends i0{get(o){return new pE(this,o)}}Tn(mE,"SymbolInstanceArray");class gE extends Hd{getoffsetX(o){return this.float32[1*o+0]}}Tn(gE,"GlyphOffsetArray");class ng extends sh{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Tn(ng,"SymbolLineVertexArray");class rg extends Zm{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rg.prototype.size=12;class Fl extends eg{get(o){return new rg(this,o)}}Tn(Fl,"FeatureIndexArray");class ig extends Qh{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Tn(ig,"FillExtrusionCentroidArray");class _E extends Zm{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}_E.prototype.size=6;class yE extends lp{get(o){return new _E(this,o)}}Tn(yE,"FillExtrusionWallArray");const _M=yi([{name:"a_pos",components:2,type:"Int16"}],4),yM=yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xs{constructor(o=[]){this.segments=o}_prepareSegment(o,c,f,g){let p=this.segments[this.segments.length-1];return o>xs.MAX_VERTEX_ARRAY_LENGTH&&Nr(`Max vertices per segment is ${xs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!p||p.vertexLength+o>xs.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==g)&&(p={vertexOffset:c,primitiveOffset:f,vertexLength:0,primitiveLength:0},g!==void 0&&(p.sortKey=g),this.segments.push(p)),p}prepareSegment(o,c,f,g){return this._prepareSegment(o,c.length,f.length,g)}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,f,g){return new xs([{vertexOffset:o,primitiveOffset:c,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function xE(d,o){return 256*(d=Bn(Math.floor(d),0,255))+Bn(Math.floor(o),0,255)}xs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tn(xs,"SegmentVector");const L1=yi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),xM=yi([{name:"a_dash",components:4,type:"Uint16"}]);class sg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,c,f,g){this.ids.push(F1(o)),this.positions.push(c,f,g)}eachPosition(o,c){const f=F1(o);let g=0,p=this.ids.length-1;for(;g<p;){const x=g+p>>1;this.ids[x]>=f?p=x:g=x+1}for(;this.ids[g]===f;)c(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(o,c){const f=new Float64Array(o.ids),g=new Uint32Array(o.positions);return og(f,g,0,f.length-1),c&&(c.add(f.buffer),c.add(g.buffer)),{ids:f,positions:g}}static deserialize(o){const c=new sg;let f;c.ids=o.ids,c.positions=o.positions;for(const g of c.ids)g!==f&&c.uniqueIds.push(g),f=g;return c.indexed=!0,c}}function F1(d){const o=+d;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Fn(String(d))}function og(d,o,c,f){for(;c<f;){const g=d[c+f>>1];let p=c-1,x=f+1;for(;;){do p++;while(d[p]<g);do x--;while(d[x]>g);if(p>=x)break;u0(d,p,x),u0(o,3*p,3*x),u0(o,3*p+1,3*x+1),u0(o,3*p+2,3*x+2)}x-c<f-x?(og(d,o,c,x),c=x+1):(og(d,o,x+1,f),f=x)}}function u0(d,o,c){const f=d[o];d[o]=d[c],d[c]=f}Tn(sg,"FeaturePositionMap");class Mu{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,c),this.initialized=!0),!!this.location}set(o,c,f){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ag extends Mu{constructor(o){super(o),this.current=0}set(o,c,f){this.fetchUniformLocation(o,c)&&this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}}class ao extends Mu{constructor(o){super(o),this.current=0}set(o,c,f){this.fetchUniformLocation(o,c)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class Pc extends Mu{constructor(o){super(o),this.current=[0,0]}set(o,c,f){this.fetchUniformLocation(o,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1])))}}class up extends Mu{constructor(o){super(o),this.current=[0,0,0]}set(o,c,f){this.fetchUniformLocation(o,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2])))}}class lg extends Mu{constructor(o){super(o),this.current=[0,0,0,0]}set(o,c,f){this.fetchUniformLocation(o,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class vE extends Mu{constructor(o){super(o),this.current=Qr.transparent.toRenderColor(null)}set(o,c,f){this.fetchUniformLocation(o,c)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const bE=new Float32Array(16);class cg extends Mu{constructor(o){super(o),this.current=bE}set(o,c,f){if(this.fetchUniformLocation(o,c)){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let g=1;g<16;g++)if(f[g]!==this.current[g]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}}}const B1=new Float32Array(9),vM=new Float32Array(4);class z1 extends Mu{constructor(o){super(o),this.current=vM}set(o,c,f){if(this.fetchUniformLocation(o,c)){for(let g=0;g<4;g++)if(f[g]!==this.current[g]){this.current=f,this.gl.uniformMatrix2fv(this.location,!1,f);break}}}}function j1(d){return[xE(255*d.r,255*d.g),xE(255*d.b,255*d.a)]}class ug{constructor(o,c,f,g){this.value=o,this.uniformNames=c.map(p=>`u_${p}`),this.type=f,this.context=g}setUniform(o,c,f,g,p){const x=g.constantOr(this.value);c.set(o,p,x instanceof Qr?x.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):x)}getBinding(o,c){return this.type==="color"?new vE(o):new ao(o)}}class $d{constructor(o,c){this.uniformNames=c.map(f=>`u_${f}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,c,f,g,p){const x=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;x&&c.set(o,p,x)}getBinding(o,c){return c==="u_pattern"||c==="u_dash"?new lg(o):new ao(o)}}class ah{constructor(o,c,f,g){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(p=>({name:`a_${p}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(o,c,f,g,p,x,I){const D=this.paintVertexArray.length,L=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Wi(0,{brightness:x}),c,{},p,g,I):this.expression.kind==="constant"&&this.expression.value,T=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Wi(0,{brightness:x}),c,{},p,g,I):this.lutExpression.value)==="none";this.paintVertexArray.resize(o),this._setPaintValue(D,o,L,T?null:this.context.lut)}updatePaintArray(o,c,f,g,p,x,I){const D=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:I},f,g,void 0,p):this.expression.kind==="constant"&&this.expression.value,L=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Wi(0,{brightness:I}),f,g,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(o,c,D,L?null:this.context.lut)}_setPaintValue(o,c,f,g){if(this.type==="color"){const p=j1(f.toRenderColor(g));for(let x=o;x<c;x++)this.paintVertexArray.emplace(x,p[0],p[1])}else{for(let p=o;p<c;p++)this.paintVertexArray.emplace(p,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eu{constructor(o,c,f,g,p,x){this.expression=o,this.uniformNames=c.map(I=>`u_${I}_t`),this.type=f,this.useIntegerZoom=g,this.context=p,this.maxValue=0,this.paintVertexAttributes=c.map(I=>({name:`a_${I}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(o,c,f,g,p,x,I){const D=this.expression.evaluate(new Wi(this.context.zoom,{brightness:x}),c,{},p,g,I),L=this.expression.evaluate(new Wi(this.context.zoom+1,{brightness:x}),c,{},p,g,I),T=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Wi(0,{brightness:x}),c,{},p,g,I):this.lutExpression.value)==="none",k=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(k,o,D,L,T?null:this.context.lut)}updatePaintArray(o,c,f,g,p,x,I){const D=this.expression.evaluate({zoom:this.context.zoom,brightness:I},f,g,void 0,p),L=this.expression.evaluate({zoom:this.context.zoom+1,brightness:I},f,g,void 0,p),T=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Wi(0,{brightness:I}),f,g,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(o,c,D,L,T?null:this.context.lut)}_setPaintValue(o,c,f,g,p){if(this.type==="color"){const x=j1(f.toRenderColor(p)),I=j1(f.toRenderColor(p));for(let D=o;D<c;D++)this.paintVertexArray.emplace(D,x[0],x[1],I[0],I[1])}else{for(let x=o;x<c;x++)this.paintVertexArray.emplace(x,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c,f,g,p){const x=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,I=Bn(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);c.set(o,p,I)}getBinding(o,c){return new ao(o)}}class Jh{constructor(o,c,f,g,p){this.expression=o,this.layerId=p,this.paintVertexAttributes=(f==="array"?xM:L1).members;for(let x=0;x<c.length;++x);this.paintVertexArray=new g}populatePaintArray(o,c,f,g){const p=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(p,o,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(o,c,f,g,p,x,I){this._setPaintValues(o,c,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(o,c,f,g){if(!g||!f)return;const p=g[f];if(!p)return;const{tl:x,br:I,pixelRatio:D}=p;for(let L=o;L<c;L++)this.paintVertexArray.emplace(L,x[0],x[1],I[0],I[1],D)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qd{constructor(o,c,f=()=>!0){this.binders={},this._buffers=[],this.context=c;const g=[];for(const p in o.paint._values){const x=o.paint.get(p);if(p.endsWith("-use-theme")||!f(p)||!(x instanceof rp&&Kf(x.property.specification)))continue;const I=wM(p,o.type),D=x.value,L=x.property.specification.type,T=!!x.property.useIntegerZoom,k=p==="line-dasharray"||p.endsWith("pattern"),z=o.paint.get(`${p}-use-theme`),O=p==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant"||z&&z.value.kind!=="constant";if(D.kind!=="constant"||O)if(D.kind==="source"||O||k){const B=wE(p,L,"source");this.binders[p]=k?new Jh(D,I,L,B,o.id):new ah(D,I,L,B),g.push(`/a_${p}`)}else{const B=wE(p,L,"composite");this.binders[p]=new eu(D,I,L,T,c,B),g.push(`/z_${p}`)}else this.binders[p]=k?new $d(D.value,I):new ug(D.value,I,L,c),g.push(`/u_${p}`);z&&(this.binders[p].lutExpression=z.value)}this.cacheKey=g.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof ah||c instanceof eu?c.maxValue:0}populatePaintArrays(o,c,f,g,p,x,I){for(const D in this.binders){const L=this.binders[D];L.context=this.context,(L instanceof ah||L instanceof eu||L instanceof Jh)&&L.populatePaintArray(o,c,f,g,p,x,I)}}setConstantPatternPositions(o){for(const c in this.binders){const f=this.binders[c];f instanceof $d&&f.setConstantPatternPositions(o)}}updatePaintArrays(o,c,f,g,p,x,I,D,L){let T=!1;const k=Object.keys(o),z=k.length!==0&&!D,O=z?k:c.uniqueIds;this.context.lut=p.lut;for(const B in this.binders){const U=this.binders[B];if(U.context=this.context,(U instanceof ah||U instanceof eu||U instanceof Jh)&&U.expression&&U.expression.kind&&U.expression.kind!=="constant"&&(U.expression.isStateDependent===!0||U.expression.isLightConstant===!1)){const X=p.paint.get(B);U.expression=X.value;for(const J of O){const ce=o[J.toString()];c.eachPosition(J,(le,ie,ge)=>{const be=g.feature(le);U.updatePaintArray(ie,ge,be,ce,x,I,L)})}if(!z)for(const J of f.uniqueIds){const ce=o[J.toString()];f.eachPosition(J,(le,ie,ge)=>{const be=g.feature(le);U.updatePaintArray(ie,ge,be,ce,x,I,L)})}T=!0}}return T}defines(){const o=[];for(const c in this.binders){const f=this.binders[c];(f instanceof ug||f instanceof $d)&&o.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ah||f instanceof eu||f instanceof Jh)for(let g=0;g<f.paintVertexAttributes.length;g++)o.push(f.paintVertexAttributes[g].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ug||f instanceof $d||f instanceof eu)for(const g of f.uniformNames)o.push(g)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const c=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof ug||g instanceof $d||g instanceof eu)for(const p of g.uniformNames)c.push({name:p,property:f,binding:g.getBinding(o,p)})}return c}setUniforms(o,c,f,g,p){for(const{name:x,property:I,binding:D}of f)this.binders[I].setUniform(o,D,p,g.get(I),x)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const c=this.binders[o];(c instanceof ah||c instanceof eu||c instanceof Jh)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(o){for(const c in this.binders){const f=this.binders[c];(f instanceof ah||f instanceof eu||f instanceof Jh)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof ah||c instanceof eu||c instanceof Jh)&&c.destroy()}}}class ed{constructor(o,c,f=()=>!0){this.programConfigurations={};for(const g of o)this.programConfigurations[g.id]=new qd(g,c,f);this.needsUpload=!1,this._featureMap=new sg,this._featureMapWithoutIds=new sg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,c,f,g,p,x,I,D){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(o,c,g,p,x,I,D);c.id!==void 0?this._featureMap.add(c.id,f,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,f,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,f,g,p,x,I){for(const D of f)this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,c,D,g,p,x,I||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const bM={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function wM(d,o){return bM[d]||[d.replace(`${o}-`,"").replace(/-/g,"_")]}const EM={"line-pattern":{source:Zh,composite:Zh},"fill-pattern":{source:Zh,composite:Zh},"fill-extrusion-pattern":{source:Zh,composite:Zh},"line-dasharray":{source:t0,composite:t0}},h0={color:{source:cp,composite:Wd},number:{source:Hd,composite:cp}};function wE(d,o,c){const f=EM[d];return f&&f[c]||h0[o][c]}Tn(ug,"ConstantBinder"),Tn($d,"PatternConstantBinder"),Tn(ah,"SourceExpressionBinder"),Tn(Jh,"PatternCompositeBinder"),Tn(eu,"CompositeExpressionBinder"),Tn(qd,"ProgramConfiguration",{omit:["_buffers"]}),Tn(ed,"ProgramConfigurationSet");const Ja=sn/Math.PI/2,hp=5,EE=6,SE=16383,dp=64,d0=[dp,32,16],uc=-Ja,hc=Ja;function fp(d,o,c,f=Ja){return c=Mn(c),[d*Math.sin(c)*f,-o*f,d*Math.cos(c)*f]}function Gd(d,o,c){return fp(Math.cos(Mn(d)),Math.sin(Mn(d)),o,c)}const Yd=63710088e-1,V1=2*Math.PI*Yd;class xi{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xi(Si(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,f=this.lat*c,g=o.lat*c,p=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((o.lng-this.lng)*c);return Yd*Math.acos(Math.min(p,1))}toBounds(o=0){const c=360*o/40075017,f=c/Math.cos(Math.PI/180*this.lat);return new td({lng:this.lng-f,lat:this.lat-c},{lng:this.lng+f,lat:this.lat+c})}toEcef(o){return Gd(this.lat,this.lng,Ja+o*Ja/Yd)}static convert(o){if(o instanceof xi)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new xi(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new xi(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class td{constructor(o,c){if(o)if(c)this.setSouthWest(o).setNorthEast(c);else if(o.length===4){const f=o;this.setSouthWest([f[0],f[1]]).setNorthEast([f[2],f[3]])}else{const f=o;this.setSouthWest(f[0]).setNorthEast(f[1])}}setNorthEast(o){return this._ne=o instanceof xi?new xi(o.lng,o.lat):xi.convert(o),this}setSouthWest(o){return this._sw=o instanceof xi?new xi(o.lng,o.lat):xi.convert(o),this}extend(o){const c=this._sw,f=this._ne;let g,p;if(o instanceof xi)g=o,p=o;else{if(!(o instanceof td))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(td.convert(o)):this.extend(xi.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(xi.convert(o)):this;if(g=o._sw,p=o._ne,!g||!p)return this}return c||f?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),f.lng=Math.max(p.lng,f.lng),f.lat=Math.max(p.lat,f.lat)):(this._sw=new xi(g.lng,g.lat),this._ne=new xi(p.lng,p.lat)),this}getCenter(){return new xi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xi(this.getWest(),this.getNorth())}getSouthEast(){return new xi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:c,lat:f}=xi.convert(o);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(o){if(o)return o instanceof td?o:new td(o)}}const SM=0,TM=25.5;function f0(d){return V1*Math.cos(d*Math.PI/180)}function Pu(d){return(180+d)/360}function Ca(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function Ia(d,o){return d/f0(o)}function Bl(d){return 360*d-180}function ca(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function U1(d,o){return d*f0(ca(o))}const pl=85.051129;function TE(d){return Math.cos(Mn(Bn(d,-85.051129,pl)))}function nd(d,o){const c=Bn(o,SM,TM),f=Math.pow(2,c);return TE(d)*V1/(512*f)}function CM(d){return 1/Math.cos(d*Math.PI/180)}function y(d,o=0){const c=Math.exp(Math.PI*(1-(d.y+o/sn)/(1<<d.z)*2));return 80150034*c/(c*c+1)/sn/(1<<d.z)}class a{constructor(o,c,f=0){this.x=+o,this.y=+c,this.z=+f}static fromLngLat(o,c=0){const f=xi.convert(o);return new a(Pu(f.lng),Ca(f.lat),Ia(c,f.lat))}toLngLat(){return new xi(Bl(this.x),ca(this.y))}toAltitude(){return U1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/V1*CM(ca(this.y))}}function h(d,o,c,f,g,p,x,I,D){const L=(o+f)/2,T=(c+g)/2,k=new Ot(L,T);I(k),function(z,O,B,U,X,J){const ce=B-X,le=U-J;return Math.abs((U-O)*ce-(B-z)*le)/Math.hypot(ce,le)}(k.x,k.y,p.x,p.y,x.x,x.y)>=D?(h(d,o,c,L,T,p,k,I,D),h(d,L,T,f,g,k,x,I,D)):d.push(x)}function _(d,o,c){let f=d[0],g=f.x,p=f.y;o(f);const x=[f];for(let I=1;I<d.length;I++){const D=d[I],{x:L,y:T}=D;o(D),h(x,g,p,L,T,f,D,o,c),g=L,p=T,f=D}return x}function E(d,o,c,f){if(f(o,c)){const g=o.add(c)._mult(.5);E(d,o,g,f),E(d,g,c,f)}else d.push(c)}function C(d,o){let c=d[0];const f=[c];for(let g=1;g<d.length;g++){const p=d[g];E(f,c,p,o),c=p}return f}const M=Math.pow(2,14)-1,j=-M-1;function H(d,o){const c=Math.round(d.x*o),f=Math.round(d.y*o);return d.x=Bn(c,j,M),d.y=Bn(f,j,M),(c<d.x||c>d.x+1||f<d.y||f>d.y+1)&&Nr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),d}function G(d,o,c){const f=d.loadGeometry(),g=d.extent,p=sn/g;if(o&&c&&c.projection.isReprojectedInTileSpace){const x=1<<o.z,{scale:I,x:D,y:L,projection:T}=c,k=z=>{const O=Bl((o.x+z.x/g)/x),B=ca((o.y+z.y/g)/x),U=T.project(O,B);z.x=(U.x*I-D)*g,z.y=(U.y*I-L)*g};for(let z=0;z<f.length;z++)if(d.type!==1)f[z]=_(f[z],k,1);else{const O=[];for(const B of f[z])B.x<0||B.x>=g||B.y<0||B.y>=g||(k(B),O.push(B));f[z]=O}}for(const x of f)for(const I of x)H(I,p);return f}function Y(d,o){return{type:d.type,id:d.id,properties:d.properties,geometry:o?G(d):[]}}function ne(d,o,c,f,g){d.emplaceBack(2*o+(f+1)/2,2*c+(g+1)/2)}function ee(d,o,c){d.emplaceBack(o.x,o.y,o.z,c[0]*16384,c[1]*16384,c[2]*16384)}class he{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new sh,this.indexArray=new la,this.segments=new xs,this.programConfigurations=new ed(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}updateFootprints(o,c){}populate(o,c,f,g){const p=this.layers[0],x=[];let I=null;p.type==="circle"&&(I=p.layout.get("circle-sort-key"));for(const{feature:L,id:T,index:k,sourceLayerIndex:z}of o){const O=this.layers[0]._featureFilter.needGeometry,B=Y(L,O);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),B,f))continue;const U=I?I.evaluate(B,{},f):void 0,X={id:T,properties:L.properties,type:L.type,sourceLayerIndex:z,index:k,geometry:O?B.geometry:G(L,f,g),patterns:{},sortKey:U};x.push(X)}I&&x.sort((L,T)=>L.sortKey-T.sortKey);let D=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new n0,D=g.projection);for(const L of x){const{geometry:T,index:k,sourceLayerIndex:z}=L,O=o[k].feature;this.addFeature(L,T,k,c.availableImages,f,D,c.brightness),c.featureIndex.insert(O,T,k,z,this.index)}}update(o,c,f,g,p,x,I){this.programConfigurations.updatePaintArrays(o,c,p,f,g,x,I)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_M.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,yM.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,c,f,g,p,x,I){for(const D of c)for(const L of D){const T=L.x,k=L.y;if(T<0||T>=sn||k<0||k>=sn)continue;if(x){const B=x.projectTilePoint(T,k,p),U=x.upVector(p,T,k),X=this.globeExtVertexArray;ee(X,B,U),ee(X,B,U),ee(X,B,U),ee(X,B,U)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),O=z.vertexLength;ne(this.layoutVertexArray,T,k,-1,-1),ne(this.layoutVertexArray,T,k,1,-1),ne(this.layoutVertexArray,T,k,1,1),ne(this.layoutVertexArray,T,k,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},g,p,I)}}function we(d,o){for(let c=0;c<d.length;c++)if(Xe(o,d[c]))return!0;for(let c=0;c<o.length;c++)if(Xe(d,o[c]))return!0;return!!je(d,o)}function xe(d,o,c){return!!Xe(d,o)||!!We(o,d,c)}function Ee(d,o){if(d.length===1)return Ye(o,d[0]);for(let c=0;c<o.length;c++){const f=o[c];for(let g=0;g<f.length;g++)if(Xe(d,f[g]))return!0}for(let c=0;c<d.length;c++)if(Ye(o,d[c]))return!0;for(let c=0;c<o.length;c++)if(je(d,o[c]))return!0;return!1}function Ce(d,o,c){if(d.length>1){if(je(d,o))return!0;for(let f=0;f<o.length;f++)if(We(o[f],d,c))return!0}for(let f=0;f<d.length;f++)if(We(d[f],o,c))return!0;return!1}function je(d,o){if(d.length===0||o.length===0)return!1;for(let c=0;c<d.length-1;c++){const f=d[c],g=d[c+1];for(let p=0;p<o.length-1;p++)if($e(f,g,o[p],o[p+1]))return!0}return!1}function $e(d,o,c,f){return ri(d,c,f)!==ri(o,c,f)&&ri(d,o,c)!==ri(d,o,f)}function We(d,o,c){const f=c*c;if(o.length===1)return d.distSqr(o[0])<f;for(let g=1;g<o.length;g++)if(Ze(d,o[g-1],o[g])<f)return!0;return!1}function Ze(d,o,c){const f=o.distSqr(c);if(f===0)return d.distSqr(o);const g=((d.x-o.x)*(c.x-o.x)+(d.y-o.y)*(c.y-o.y))/f;return d.distSqr(g<0?o:g>1?c:c.sub(o)._mult(g)._add(o))}function Ye(d,o){let c,f,g,p=!1;for(let x=0;x<d.length;x++){c=d[x];for(let I=0,D=c.length-1;I<c.length;D=I++)f=c[I],g=c[D],f.y>o.y!=g.y>o.y&&o.x<(g.x-f.x)*(o.y-f.y)/(g.y-f.y)+f.x&&(p=!p)}return p}function Xe(d,o){let c=!1;for(let f=0,g=d.length-1;f<d.length;g=f++){const p=d[f],x=d[g];p.y>o.y!=x.y>o.y&&o.x<(x.x-p.x)*(o.y-p.y)/(x.y-p.y)+p.x&&(c=!c)}return c}function Ke(d,o,c,f,g){for(const x of d)if(o<=x.x&&c<=x.y&&f>=x.x&&g>=x.y)return!0;const p=[new Ot(o,c),new Ot(o,g),new Ot(f,g),new Ot(f,c)];if(d.length>2){for(const x of p)if(Xe(d,x))return!0}for(let x=0;x<d.length-1;x++)if(tt(d[x],d[x+1],p))return!0;return!1}function tt(d,o,c){const f=c[0],g=c[2];if(d.x<f.x&&o.x<f.x||d.x>g.x&&o.x>g.x||d.y<f.y&&o.y<f.y||d.y>g.y&&o.y>g.y)return!1;const p=ri(d,o,c[0]);return p!==ri(d,o,c[1])||p!==ri(d,o,c[2])||p!==ri(d,o,c[3])}function at(d,o,c,f,g,p){let x=o.y-d.y,I=d.x-o.x;if(p=p||0){const D=x*x+I*I;if(D===0)return!0;const L=Math.sqrt(D);x/=L,I/=L}return!((c.x-d.x)*x+(c.y-d.y)*I-p<0||(f.x-d.x)*x+(f.y-d.y)*I-p<0||(g.x-d.x)*x+(g.y-d.y)*I-p<0)}function At(d,o,c,f,g,p,x){return!(at(d,o,f,g,p,x)||at(o,c,f,g,p,x)||at(c,d,f,g,p,x)||at(f,g,d,o,c,x)||at(g,p,d,o,c,x)||at(p,f,d,o,c,x))}function xt(d,o,c){const f=o.paint.get(d).value;return f.kind==="constant"?f.value:c.programConfigurations.get(o.id).getMaxValue(d)}function Bt(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function zt(d,o,c,f,g){if(!o[0]&&!o[1])return d;const p=Ot.convert(o)._mult(g);c==="viewport"&&p._rotate(-f);const x=[];for(let I=0;I<d.length;I++)x.push(d[I].sub(p));return x}function Jt(d,o,c,f){const g=Ot.convert(d)._mult(f);return o==="viewport"&&g._rotate(-c),g}let yt,Ft;Tn(he,"CircleBucket",{omit:["layers"]});var gt,Lt={exports:{}},kt=(gt||(gt=1,function(d,o){(function(c){function f(p,x,I){var D=g(256*p,256*(x=Math.pow(2,I)-x-1),I),L=g(256*(p+1),256*(x+1),I);return D[0]+","+D[1]+","+L[0]+","+L[1]}function g(p,x,I){var D=2*Math.PI*6378137/256/Math.pow(2,I);return[p*D-2*Math.PI*6378137/2,x*D-2*Math.PI*6378137/2]}c.getURL=function(p,x,I,D,L,T){return T=T||{},p+"?"+["bbox="+f(I,D,L),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+x].join("&")},c.getTileBBox=f,c.getMercCoords=g,Object.defineProperty(c,"__esModule",{value:!0})})(o)}(0,Lt.exports)),Lt.exports);class Ut{constructor(o,c,f){this.z=o,this.x=c,this.y=f,this.key=dn(0,o,o,c,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c){const f=kt.getTileBBox(this.x,this.y,this.z),g=function(p,x,I){let D,L="";for(let T=p;T>0;T--)D=1<<T-1,L+=(x&D?1:0)+(I&D?2:0);return L}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rt{constructor(o,c){this.wrap=o,this.canonical=c,this.key=dn(o,c.z,c.z,c.x,c.y)}}class Wt{constructor(o,c,f,g,p){this.overscaledZ=o,this.wrap=c,this.canonical=new Ut(f,+g,+p),this.key=c===0&&o===f?this.canonical.key:dn(c,o,f,g,p)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const c=this.canonical.z-o;return o>this.canonical.z?new Wt(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wt(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c=!0){if(this.overscaledZ===o&&c)return this.key;if(o>this.canonical.z)return dn(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-o;return dn(this.wrap*+c,o,o,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new Wt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Wt(c,this.wrap,c,f,g),new Wt(c,this.wrap,c,f+1,g),new Wt(c,this.wrap,c,f,g+1),new Wt(c,this.wrap,c,f+1,g+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Wt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Wt(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dn(d,o,c,f,g){const p=1<<Math.min(c,22);let x=p*(g%p)+f%p;return d&&c<22&&(x+=p*p*((d<0?-2*d-1:2*d)%(1<<2*(22-c)))),16*(32*x+c)+(o-c)}const pn=[d=>{let o=d.canonical.x-1,c=d.wrap;return o<0&&(o=(1<<d.canonical.z)-1,c--),new Wt(d.overscaledZ,c,d.canonical.z,o,d.canonical.y)},d=>{let o=d.canonical.x+1,c=d.wrap;return o===1<<d.canonical.z&&(o=0,c++),new Wt(d.overscaledZ,c,d.canonical.z,o,d.canonical.y)},d=>new Wt(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,(d.canonical.y===0?1<<d.canonical.z:d.canonical.y)-1),d=>new Wt(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y===(1<<d.canonical.z)-1?0:d.canonical.y+1)];Tn(Ut,"CanonicalTileID"),Tn(Wt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const xn=yi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:kn}=xn,gr=yi([{name:"a_pos_3",components:3,type:"Int16"}]);var Qn=yi([{name:"a_pos",type:"Int16",components:2}]);class dr{constructor(o,c){this.pos=o,this.dir=c}intersectsPlane(o,c,f){const g=Pe.vec2.dot(c,this.dir);if(Math.abs(g)<1e-6)return!1;const p=((o[0]-this.pos[0])*c[0]+(o[1]-this.pos[1])*c[1])/g;return f[0]=this.pos[0]+this.dir[0]*p,f[1]=this.pos[1]+this.dir[1]*p,!0}}class sr{constructor(o,c){this.pos=o,this.dir=c}intersectsPlane(o,c,f){const g=Pe.vec3.dot(c,this.dir);if(Math.abs(g)<1e-6)return!1;const p=((o[0]-this.pos[0])*c[0]+(o[1]-this.pos[1])*c[1]+(o[2]-this.pos[2])*c[2])/g;return f[0]=this.pos[0]+this.dir[0]*p,f[1]=this.pos[1]+this.dir[1]*p,f[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(o,c,f){if(Pe.vec3.equals(this.pos,o)||c===0)return f[0]=f[1]=f[2]=0,!1;const[g,p,x]=this.dir,I=this.pos[0]-o[0],D=this.pos[1]-o[1],L=this.pos[2]-o[2],T=g*g+p*p+x*x,k=2*(I*g+D*p+L*x),z=k*k-4*T*(I*I+D*D+L*L-c*c);if(z<0){const O=Math.max(-k/2,0),B=I+g*O,U=D+p*O,X=L+x*O,J=Math.hypot(B,U,X);return f[0]=B*c/J,f[1]=U*c/J,f[2]=X*c/J,!1}{const O=(-k-Math.sqrt(z))/(2*T);if(O<0){const B=Math.hypot(I,D,L);return f[0]=I*c/B,f[1]=D*c/B,f[2]=L*c/B,!1}return f[0]=I+g*O,f[1]=D+p*O,f[2]=L+x*O,!0}}}class Kr{constructor(o,c,f,g,p){this.TL=o,this.TR=c,this.BR=f,this.BL=g,this.horizon=p}static fromInvProjectionMatrix(o,c,f){const g=[-1,1,1],p=[1,1,1],x=[1,-1,1],I=[-1,-1,1],D=Pe.vec3.transformMat4(g,g,o),L=Pe.vec3.transformMat4(p,p,o),T=Pe.vec3.transformMat4(x,x,o),k=Pe.vec3.transformMat4(I,I,o);return new Kr(D,L,T,k,c/f)}}function vi(d,o,c){let f=1/0,g=-1/0;const p=[];for(const x of d){Pe.vec3.sub(p,x,o);const I=Pe.vec3.dot(p,c);f=Math.min(f,I),g=Math.max(g,I)}return[f,g]}function Zi(d,o){let c=!0;for(let f=0;f<d.planes.length;f++){const g=d.planes[f];let p=0;for(let x=0;x<o.length;x++)p+=Pe.vec3.dot(g,o[x])+g[3]>=0;if(p===0)return 0;p!==o.length&&(c=!1)}return c?2:1}function Br(d,o){for(const c of d.projections){const f=vi(o,d.points[0],c.axis);if(c.projection[1]<f[0]||c.projection[0]>f[1])return 0}return 1}function vs(d,o){let c=0;const f=[0,0,0,0];for(let g=0;g<d.length;g++)f[0]=d[g][0],f[1]=d[g][1],f[2]=d[g][2],f[3]=1,Pe.vec4.dot(f,o)>=0&&c++;return c}class yr{constructor(o,c){this.points=o||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=Nn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pe.vec3.sub([],this.points[2],this.points[3]),Pe.vec3.sub([],this.points[0],this.points[3]),Pe.vec3.sub([],this.points[4],this.points[0]),Pe.vec3.sub([],this.points[5],this.points[1]),Pe.vec3.sub([],this.points[6],this.points[2]),Pe.vec3.sub([],this.points[7],this.points[3])];for(const f of this.frustumEdges){const g=[0,-f[2],f[1]],p=[f[2],0,-f[0]];this.projections.push({axis:g,projection:vi(this.points,this.points[0],g)}),this.projections.push({axis:p,projection:vi(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(o,c,f,g){const p=Math.pow(2,f),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const T=Pe.vec4.transformMat4([],L,o),k=1/T[3]/c*p;return Pe.vec4.mul(T,T,[k,k,g?1/T[3]:k,k])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const T=Pe.vec3.sub([],x[L[0]],x[L[1]]),k=Pe.vec3.sub([],x[L[2]],x[L[1]]),z=Pe.vec3.normalize([],Pe.vec3.cross([],T,k)),O=-Pe.vec3.dot(z,x[L[1]]);return z.concat(O)}),D=[];for(let L=0;L<x.length;L++)D.push([x[L][0],x[L][1],x[L][2]]);return new yr(D,I)}intersectsPrecise(o,c,f){for(let g=0;g<c.length;g++)if(!vs(o,c[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!vs(o,this.planes[g]))return 0;for(const g of f)for(const p of this.frustumEdges){const x=Pe.vec3.cross([],g,p),I=Pe.vec3.length(x);if(I===0)continue;Pe.vec3.scale(x,x,1/I);const D=vi(this.points,this.points[0],x),L=vi(o,this.points[0],x);if(D[0]>L[1]||L[0]>D[1])return 0}return 1}containsPoint(o){for(const c of this.planes){const f=c[3];if(Pe.vec3.dot([c[0],c[1],c[2]],o)+f<0)return!1}return!0}}class Nn{static fromPoints(o){const c=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const g of o)Pe.vec3.min(c,c,g),Pe.vec3.max(f,f,g);return new Nn(c,f)}static fromTileIdAndHeight(o,c,f){const g=1<<o.canonical.z,p=o.canonical.x,x=o.canonical.y;return new Nn([p/g,x/g,c],[(p+1)/g,(x+1)/g,f])}static applyTransform(o,c){const f=o.getCorners();for(let g=0;g<f.length;++g)Pe.vec3.transformMat4(f[g],f[g],c);return Nn.fromPoints(f)}static applyTransformFast(o,c){const f=[c[12],c[13],c[14]],g=[...f];for(let p=0;p<3;p++)for(let x=0;x<3;x++){const I=c[4*x+p],D=I*o.min[x],L=I*o.max[x];f[p]+=Math.min(D,L),g[p]+=Math.max(D,L)}return new Nn(f,g)}static projectAabbCorners(o,c){const f=o.getCorners();for(let g=0;g<f.length;++g)Pe.vec3.transformMat4(f[g],f[g],c);return f}constructor(o,c){this.min=o,this.max=c,this.center=Pe.vec3.scale([],Pe.vec3.add([],this.min,this.max),.5)}quadrant(o){const c=[o%2==0,o<2],f=Pe.vec3.clone(this.min),g=Pe.vec3.clone(this.max);for(let p=0;p<c.length;p++)f[p]=c[p]?this.min[p]:this.center[p],g[p]=c[p]?this.center[p]:this.max[p];return g[2]=this.max[2],new Nn(f,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,c=this.max;return[[o[0],o[1],o[2]],[c[0],o[1],o[2]],[c[0],c[1],o[2]],[o[0],c[1],o[2]],[o[0],o[1],c[2]],[c[0],o[1],c[2]],[c[0],c[1],c[2]],[o[0],c[1],c[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?Zi(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?Zi(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,c){return c||this.intersects(o)?Br(o,this.getCorners()):0}intersectsPreciseFlat(o,c){return c||this.intersectsFlat(o)?Br(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let c=0;c<3;++c)if(this.min[c]>o.max[c]||o.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],o.min[c]),this.max[c]=Math.max(this.max[c],o.max[c])}encapsulatePoint(o){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],o[c]),this.max[c]=Math.max(this.max[c],o[c])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}function ei(d){return d*Ja/Yd}Tn(Nn,"Aabb");const Ai=[new Nn([uc,uc,uc],[hc,hc,hc]),new Nn([uc,uc,uc],[0,0,hc]),new Nn([0,uc,uc],[hc,0,hc]),new Nn([uc,0,uc],[0,hc,hc]),new Nn([0,0,uc],[hc,hc,hc])];function mi(d,o,c,f=!0){const g=Pe.vec3.scale([],d._camera.position,d.worldSize),p=[o,c,1,1];Pe.vec4.transformMat4(p,p,d.pixelMatrixInverse),Pe.vec4.scale(p,p,1/p[3]);const x=Pe.vec3.sub([],p,g),I=Pe.vec3.normalize([],x),D=d.globeMatrix,L=[D[12],D[13],D[14]],T=Pe.vec3.sub([],L,g),k=Pe.vec3.length(T),z=Pe.vec3.normalize([],T),O=d.worldSize/(2*Math.PI),B=Pe.vec3.dot(z,I),U=Math.asin(O/k);if(U<Math.acos(B)){if(!f)return null;const Qe=[],Ue=[];Pe.vec3.scale(Qe,I,k/B),Pe.vec3.normalize(Ue,Pe.vec3.sub(Ue,Qe,T)),Pe.vec3.normalize(I,Pe.vec3.add(I,T,Pe.vec3.scale(I,Ue,Math.tan(U)*k)))}const X=[];new sr(g,I).closestPointOnSphere(L,O,X);const J=Pe.vec3.normalize([],za(D,0)),ce=Pe.vec3.normalize([],za(D,1)),le=Pe.vec3.normalize([],za(D,2)),ie=Pe.vec3.dot(J,X),ge=Pe.vec3.dot(ce,X),be=Pe.vec3.dot(le,X),Se=jt(Math.asin(-ge/O));let Ve=jt(Math.atan2(ie,be));Ve=d.center.lng+function(Qe,Ue){const Je=(Ue-Qe+180)%360-180;return Je<-180?Je+360:Je}(d.center.lng,Ve);const Le=Pu(Ve),Be=Bn(Ca(Se),0,1);return new a(Le,Be)}class Vs{constructor(o,c,f){this.a=Pe.vec3.sub([],o,f),this.b=Pe.vec3.sub([],c,f),this.center=f;const g=Pe.vec3.normalize([],this.a),p=Pe.vec3.normalize([],this.b);this.angle=Math.acos(Pe.vec3.dot(g,p))}}function go(d,o){if(d.angle===0)return null;let c;return c=d.a[o]===0?1/d.angle*.5*Math.PI:1/d.angle*Math.atan(d.b[o]/d.a[o]/Math.sin(d.angle)-1/Math.tan(d.angle)),c<0||c>1?null:function(f,g,p,x){const I=Math.sin(p);return f*(Math.sin((1-x)*p)/I)+g*(Math.sin(x*p)/I)}(d.a[o],d.b[o],d.angle,Bn(c,0,1))+d.center[o]}function Mo(d){if(d.z<=1)return Ai[d.z+2*d.y+d.x];const o=bs(di(d));return Nn.fromPoints(o)}function zo(d,o,c){return Pe.vec3.scale(d,d,1-c),Pe.vec3.scaleAndAdd(d,d,o,c)}function dc(d,o,c){for(const f of d)Pe.vec3.transformMat4(f,f,o),Pe.vec3.scale(f,f,c)}function Wa(d,o,c,f){const g=o/d.worldSize,p=d.globeMatrix;if(c.z<=1){const Le=Mo(c).getCorners();return dc(Le,p,g),Nn.fromPoints(Le)}const x=di(c,f),I=bs(x,Ja+ei(d._tileCoverLift));dc(I,p,g);const D=Number.MAX_VALUE,L=[-D,-D,-D],T=[D,D,D];if(x.contains(d.center)){for(const Qe of I)Pe.vec3.min(T,T,Qe),Pe.vec3.max(L,L,Qe);L[2]=0;const Le=d.point,Be=[Le.x*g,Le.y*g,0];return Pe.vec3.min(T,T,Be),Pe.vec3.max(L,L,Be),new Nn(T,L)}if(d._tileCoverLift>0){for(const Le of I)Pe.vec3.min(T,T,Le),Pe.vec3.max(L,L,Le);return new Nn(T,L)}const k=[p[12]*g,p[13]*g,p[14]*g],z=x.getCenter(),O=Bn(d.center.lat,-85.051129,pl),B=Bn(z.lat,-85.051129,pl),U=Pu(d.center.lng),X=Ca(O);let J=U-Pu(z.lng);const ce=X-Ca(B);J>.5?J-=1:J<-.5&&(J+=1);let le=0;if(Math.abs(J)>Math.abs(ce))le=J>=0?1:3;else{le=ce>=0?0:2;const Le=[p[4]*g,p[5]*g,p[6]*g],Be=-Math.sin(Mn(ce>=0?x.getSouth():x.getNorth()))*Ja;Pe.vec3.scaleAndAdd(k,k,Le,Be)}const ie=I[le],ge=I[(le+1)%4],be=new Vs(ie,ge,k),Se=[go(be,0)||ie[0],go(be,1)||ie[1],go(be,2)||ie[2]],Ve=ml(d.zoom);if(Ve>0){const Le=function({x:Qe,y:Ue,z:Je},lt,st,mt,pt){const vt=1/(1<<Je);let _t=Qe*vt,Et=_t+vt,qt=Ue*vt,Ht=qt+vt,Cn=0;const Qt=(_t+Et)/2-mt;return Qt>.5?Cn=-1:Qt<-.5&&(Cn=1),_t=((_t+Cn)*lt-(mt*=lt))*st+mt,Et=((Et+Cn)*lt-mt)*st+mt,qt=(qt*lt-(pt*=lt))*st+pt,Ht=(Ht*lt-pt)*st+pt,[[_t,Ht,0],[Et,Ht,0],[Et,qt,0],[_t,qt,0]]}(c,o,d._pixelsPerMercatorPixel,U,X);for(let Qe=0;Qe<I.length;Qe++)zo(I[Qe],Le[Qe],Ve);const Be=Pe.vec3.add([],Le[le],Le[(le+1)%4]);Pe.vec3.scale(Be,Be,.5),zo(Se,Be,Ve)}for(const Le of I)Pe.vec3.min(T,T,Le),Pe.vec3.max(L,L,Le);return T[2]=Math.min(ie[2],ge[2]),Pe.vec3.min(T,T,Se),Pe.vec3.max(L,L,Se),new Nn(T,L)}function di({x:d,y:o,z:c},f=!1){const g=1/(1<<c),p=new xi(Bl(d*g),o===(1<<c)-1&&f?-90:ca((o+1)*g)),x=new xi(Bl((d+1)*g),o===0&&f?90:ca(o*g));return new td(p,x)}function bs(d,o=Ja){const c=Mn(d.getNorth()),f=Mn(d.getSouth()),g=Math.cos(c),p=Math.cos(f),x=Math.sin(c),I=Math.sin(f),D=d.getWest(),L=d.getEast();return[fp(p,I,D,o),fp(p,I,L,o),fp(g,x,L,o),fp(g,x,D,o)]}function bi(d,o,c,f){const g=1<<c.z,p=(d/sn+c.x)/g;return Gd(ca((o/sn+c.y)/g),Bl(p),f)}function Ui({min:d,max:o}){return SE/Math.max(o[0]-d[0],o[1]-d[1],o[2]-d[2])}const ua=new Float64Array(16);function ps(d){const o=Ui(d),c=Pe.mat4.fromScaling(ua,[o,o,o]);return Pe.mat4.translate(c,c,Pe.vec3.negate([],d.min))}function Po(d){const o=Pe.mat4.fromTranslation(ua,d.min),c=1/Ui(d);return Pe.mat4.scale(o,o,[c,c,c])}function Du(d){const o=sn/(2*Math.PI);return d/(2*Math.PI)/o}function zl(d,o){return sn/(512*Math.pow(2,d))*Ui(Mo(o))}function Dc(d,o,c,f,g){const p=Du(c),x=[d,o,-c/(2*Math.PI)],I=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(I,I,x),Pe.mat4.scale(I,I,[p,p,p]),Pe.mat4.rotateX(I,I,Mn(-g)),Pe.mat4.rotateY(I,I,Mn(-f)),I}function ml(d){return Es(hp,EE,d)}function kc(d,o){const c=Gd(o.lat,o.lng),f=function(p){const x=Gd(p._center.lat,p._center.lng),I=Pe.vec3.fromValues(0,1,0);let D=Pe.vec3.cross([],I,x);const L=Pe.mat4.fromRotation([],-p.angle,x);D=Pe.vec3.transformMat4(D,D,L),Pe.mat4.fromRotation(L,-p._pitch,D);const T=Pe.vec3.normalize([],x);return Pe.vec3.scale(T,T,ei(p.cameraToCenterDistance/p.pixelsPerMeter)),Pe.vec3.transformMat4(T,T,L),Pe.vec3.add([],x,T)}(d),g=Pe.vec3.subtract([],f,c);return Pe.vec3.angle(g,c)}function jl(d,o){return kc(d,o)>Math.PI/2*1.01}const lh=Mn(85),ku=Math.cos(lh),ch=Math.sin(lh),H1=Pe.mat4.create(),pp=d=>{const o=[];return d.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o};function p0(d,o,c,f,g,p,x,I,D){if(p&&d.queryGeometry.isAboveHorizon)return!1;p&&(D*=d.pixelToTileUnitsFactor);const L=d.tileID.canonical,T=c.projection.upVectorScale(L,c.center.lat,c.worldSize).metersToTile;for(const k of o)for(const z of k){const O=z.add(I),B=g&&c.elevation?c.elevation.exaggeration()*g.getElevationAt(O.x,O.y,!0):0,U=c.projection.projectTilePoint(O.x,O.y,L);if(B>0){const le=c.projection.upVector(L,O.x,O.y);U.x+=le[0]*T*B,U.y+=le[1]*T*B,U.z+=le[2]*T*B}const X=p?O:W1(U.x,U.y,U.z,f),J=p?d.tilespaceRays.map(le=>tre(le,B)):d.queryGeometry.screenGeometry,ce=Pe.vec4.transformMat4([],[U.x,U.y,U.z,1],f);if(!x&&p?D*=ce[3]/c.cameraToCenterDistance:x&&!p&&(D*=c.cameraToCenterDistance/ce[3]),p){const le=ca((z.y/sn+L.y)/(1<<L.z));D/=c.projection.pixelsPerMeter(le,1)/Ia(1,le)}if(xe(J,X,D))return!0}return!1}function W1(d,o,c,f){const g=Pe.vec4.transformMat4([],[d,o,c,1],f);return new Ot(g[0]/g[3],g[1]/g[3])}const R5=Pe.vec3.fromValues(0,0,0),ere=Pe.vec3.fromValues(0,0,1);function tre(d,o){const c=Pe.vec3.create();return R5[2]=o,d.intersectsPlane(R5,ere,c),new Ot(c[0],c[1])}class M5 extends he{}let P5,D5,k5,N5;function O5(d,{width:o,height:c},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==o*c*f)throw new RangeError("mismatched image size")}else g=new Uint8Array(o*c*f);return d.width=o,d.height=c,d.data=g,d}function L5(d,o,c){const{width:f,height:g}=o;f===d.width&&g===d.height||(IM(d,o,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,f),height:Math.min(d.height,g)},c,null),d.width=f,d.height=g,d.data=o.data)}function IM(d,o,c,f,g,p,x,I){if(g.width===0||g.height===0)return o;if(g.width>d.width||g.height>d.height||c.x>d.width-g.width||c.y>d.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||f.x>o.width-g.width||f.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const D=d.data,L=o.data,T=p===4&&I;for(let k=0;k<g.height;k++){const z=((c.y+k)*d.width+c.x)*p,O=((f.y+k)*o.width+f.x)*p;if(T)for(let B=0;B<g.width;B++){const U=z+B*p+3,X=O+B*p;L[X+0]=255,L[X+1]=255,L[X+2]=255,L[X+3]=D[U]}else if(x)for(let B=0;B<g.width;B++){const U=z+B*p,X=O+B*p,J=D[U+3],ce=new Qr(D[U+0]/255*J,D[U+1]/255*J,D[U+2]/255*J,J).toRenderColor(x).toArray();L[X+0]=ce[0],L[X+1]=ce[1],L[X+2]=ce[2],L[X+3]=ce[3]}else for(let B=0;B<g.width*p;B++)L[O+B]=D[z+B]}return o}Tn(M5,"HeatmapBucket",{omit:["layers"]});class mp{constructor(o,c){O5(this,o,1,c)}resize(o){L5(this,new mp(o),1)}clone(){return new mp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,g,p){IM(o,c,f,g,p,1,null)}}class Aa{constructor(o,c){O5(this,o,4,c)}resize(o){L5(this,new Aa(o),4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,g,p,x,I){IM(o,c,f,g,p,4,x,I)}}class F5{constructor(o,c){this.width=o.width,this.height=o.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function $1(d){const o={},c=d.resolution||256,f=d.clips?d.clips.length:1,g=d.image||new Aa({width:c,height:f}),p=(x,I,D)=>{o[d.evaluationKey]=D;const L=d.expression.evaluate(o);L&&(g.data[x+I+0]=Math.floor(255*L.r/L.a),g.data[x+I+1]=Math.floor(255*L.g/L.a),g.data[x+I+2]=Math.floor(255*L.b/L.a),g.data[x+I+3]=Math.floor(255*L.a))};if(d.clips)for(let x=0,I=0;x<f;++x,I+=4*c)for(let D=0,L=0;D<c;D++,L+=4){const T=D/(c-1),{start:k,end:z}=d.clips[x];p(I,L,k*(1-T)+z*T)}else for(let x=0,I=0;x<c;x++,I+=4)p(0,I,x/(c-1));return g}Tn(mp,"AlphaImage"),Tn(Aa,"RGBAImage");const nre=yi([{name:"a_pos",components:2,type:"Int16"}],4),rre=yi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),ire=yi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),sre=yi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function q1(d,o,c=2){const f=o&&o.length,g=f?o[0]*c:d.length;let p=B5(d,0,g,c,!0);const x=[];if(!p||p.next===p.prev)return x;let I,D,L;if(f&&(p=function(T,k,z,O){const B=[];for(let U=0,X=k.length;U<X;U++){const J=B5(T,k[U]*O,U<X-1?k[U+1]*O:T.length,O,!1);J===J.next&&(J.steiner=!0),B.push(fre(J))}B.sort(ure);for(let U=0;U<B.length;U++)z=hre(B[U],z);return z}(d,o,p,c)),d.length>80*c){I=1/0,D=1/0;let T=-1/0,k=-1/0;for(let z=c;z<g;z+=c){const O=d[z],B=d[z+1];O<I&&(I=O),B<D&&(D=B),O>T&&(T=O),B>k&&(k=B)}L=Math.max(T-I,k-D),L=L!==0?32767/L:0}return G1(p,x,c,I,D,L,0),x}function B5(d,o,c,f,g){let p;if(g===function(x,I,D,L){let T=0;for(let k=I,z=D-L;k<D;k+=L)T+=(x[z]-x[k])*(x[k+1]+x[z+1]),z=k;return T}(d,o,c,f)>0)for(let x=o;x<c;x+=f)p=V5(x/f|0,d[x],d[x+1],p);else for(let x=c-f;x>=o;x-=f)p=V5(x/f|0,d[x],d[x+1],p);return p&&CE(p,p.next)&&(X1(p),p=p.next),p}function hg(d,o){if(!d)return d;o||(o=d);let c,f=d;do if(c=!1,f.steiner||!CE(f,f.next)&&jo(f.prev,f,f.next)!==0)f=f.next;else{if(X1(f),f=o=f.prev,f===f.next)break;c=!0}while(c||f!==o);return o}function G1(d,o,c,f,g,p,x){if(!d)return;!x&&p&&function(D,L,T,k){let z=D;do z.z===0&&(z.z=AM(z.x,z.y,L,T,k)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==D);z.prevZ.nextZ=null,z.prevZ=null,function(O){let B,U=1;do{let X,J=O;O=null;let ce=null;for(B=0;J;){B++;let le=J,ie=0;for(let be=0;be<U&&(ie++,le=le.nextZ,le);be++);let ge=U;for(;ie>0||ge>0&&le;)ie!==0&&(ge===0||!le||J.z<=le.z)?(X=J,J=J.nextZ,ie--):(X=le,le=le.nextZ,ge--),ce?ce.nextZ=X:O=X,X.prevZ=ce,ce=X;J=le}ce.nextZ=null,U*=2}while(B>1)}(z)}(d,f,g,p);let I=d;for(;d.prev!==d.next;){const D=d.prev,L=d.next;if(p?are(d,f,g,p):ore(d))o.push(D.i,d.i,L.i),X1(d),d=L.next,I=L.next;else if((d=L)===I){x?x===1?G1(d=lre(hg(d),o),o,c,f,g,p,2):x===2&&cre(d,o,c,f,g,p):G1(hg(d),o,c,f,g,p,1);break}}}function ore(d){const o=d.prev,c=d,f=d.next;if(jo(o,c,f)>=0)return!1;const g=o.x,p=c.x,x=f.x,I=o.y,D=c.y,L=f.y,T=g<p?g<x?g:x:p<x?p:x,k=I<D?I<L?I:L:D<L?D:L,z=g>p?g>x?g:x:p>x?p:x,O=I>D?I>L?I:L:D>L?D:L;let B=f.next;for(;B!==o;){if(B.x>=T&&B.x<=z&&B.y>=k&&B.y<=O&&m0(g,I,p,D,x,L,B.x,B.y)&&jo(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function are(d,o,c,f){const g=d.prev,p=d,x=d.next;if(jo(g,p,x)>=0)return!1;const I=g.x,D=p.x,L=x.x,T=g.y,k=p.y,z=x.y,O=I<D?I<L?I:L:D<L?D:L,B=T<k?T<z?T:z:k<z?k:z,U=I>D?I>L?I:L:D>L?D:L,X=T>k?T>z?T:z:k>z?k:z,J=AM(O,B,o,c,f),ce=AM(U,X,o,c,f);let le=d.prevZ,ie=d.nextZ;for(;le&&le.z>=J&&ie&&ie.z<=ce;){if(le.x>=O&&le.x<=U&&le.y>=B&&le.y<=X&&le!==g&&le!==x&&m0(I,T,D,k,L,z,le.x,le.y)&&jo(le.prev,le,le.next)>=0||(le=le.prevZ,ie.x>=O&&ie.x<=U&&ie.y>=B&&ie.y<=X&&ie!==g&&ie!==x&&m0(I,T,D,k,L,z,ie.x,ie.y)&&jo(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;le&&le.z>=J;){if(le.x>=O&&le.x<=U&&le.y>=B&&le.y<=X&&le!==g&&le!==x&&m0(I,T,D,k,L,z,le.x,le.y)&&jo(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;ie&&ie.z<=ce;){if(ie.x>=O&&ie.x<=U&&ie.y>=B&&ie.y<=X&&ie!==g&&ie!==x&&m0(I,T,D,k,L,z,ie.x,ie.y)&&jo(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function lre(d,o){let c=d;do{const f=c.prev,g=c.next.next;!CE(f,g)&&z5(f,c,c.next,g)&&Y1(f,g)&&Y1(g,f)&&(o.push(f.i,c.i,g.i),X1(c),X1(c.next),c=d=g),c=c.next}while(c!==d);return hg(c)}function cre(d,o,c,f,g,p){let x=d;do{let I=x.next.next;for(;I!==x.prev;){if(x.i!==I.i&&pre(x,I)){let D=j5(x,I);return x=hg(x,x.next),D=hg(D,D.next),G1(x,o,c,f,g,p,0),void G1(D,o,c,f,g,p,0)}I=I.next}x=x.next}while(x!==d)}function ure(d,o){return d.x-o.x}function hre(d,o){const c=function(g,p){let x=p;const I=g.x,D=g.y;let L,T=-1/0;do{if(D<=x.y&&D>=x.next.y&&x.next.y!==x.y){const U=x.x+(D-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(U<=I&&U>T&&(T=U,L=x.x<x.next.x?x:x.next,U===I))return L}x=x.next}while(x!==p);if(!L)return null;const k=L,z=L.x,O=L.y;let B=1/0;x=L;do{if(I>=x.x&&x.x>=z&&I!==x.x&&m0(D<O?I:T,D,z,O,D<O?T:I,D,x.x,x.y)){const U=Math.abs(D-x.y)/(I-x.x);Y1(x,g)&&(U<B||U===B&&(x.x>L.x||x.x===L.x&&dre(L,x)))&&(L=x,B=U)}x=x.next}while(x!==k);return L}(d,o);if(!c)return o;const f=j5(c,d);return hg(f,f.next),hg(c,c.next)}function dre(d,o){return jo(d.prev,d,o.prev)<0&&jo(o.next,d,d.next)<0}function AM(d,o,c,f,g){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-c)*g|0)|d<<8))|d<<4))|d<<2))|d<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function fre(d){let o=d,c=d;do(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next;while(o!==d);return c}function m0(d,o,c,f,g,p,x,I){return(g-x)*(o-I)>=(d-x)*(p-I)&&(d-x)*(f-I)>=(c-x)*(o-I)&&(c-x)*(p-I)>=(g-x)*(f-I)}function pre(d,o){return d.next.i!==o.i&&d.prev.i!==o.i&&!function(c,f){let g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==f.i&&g.next.i!==f.i&&z5(g,g.next,c,f))return!0;g=g.next}while(g!==c);return!1}(d,o)&&(Y1(d,o)&&Y1(o,d)&&function(c,f){let g=c,p=!1;const x=(c.x+f.x)/2,I=(c.y+f.y)/2;do g.y>I!=g.next.y>I&&g.next.y!==g.y&&x<(g.next.x-g.x)*(I-g.y)/(g.next.y-g.y)+g.x&&(p=!p),g=g.next;while(g!==c);return p}(d,o)&&(jo(d.prev,d,o.prev)||jo(d,o.prev,o))||CE(d,o)&&jo(d.prev,d,d.next)>0&&jo(o.prev,o,o.next)>0)}function jo(d,o,c){return(o.y-d.y)*(c.x-o.x)-(o.x-d.x)*(c.y-o.y)}function CE(d,o){return d.x===o.x&&d.y===o.y}function z5(d,o,c,f){const g=AE(jo(d,o,c)),p=AE(jo(d,o,f)),x=AE(jo(c,f,d)),I=AE(jo(c,f,o));return g!==p&&x!==I||!(g!==0||!IE(d,c,o))||!(p!==0||!IE(d,f,o))||!(x!==0||!IE(c,d,f))||!(I!==0||!IE(c,o,f))}function IE(d,o,c){return o.x<=Math.max(d.x,c.x)&&o.x>=Math.min(d.x,c.x)&&o.y<=Math.max(d.y,c.y)&&o.y>=Math.min(d.y,c.y)}function AE(d){return d>0?1:d<0?-1:0}function Y1(d,o){return jo(d.prev,d,d.next)<0?jo(d,o,d.next)>=0&&jo(d,d.prev,o)>=0:jo(d,o,d.prev)<0||jo(d,d.next,o)<0}function j5(d,o){const c=RM(d.i,d.x,d.y),f=RM(o.i,o.x,o.y),g=d.next,p=o.prev;return d.next=o,o.prev=d,c.next=g,g.prev=c,f.next=c,c.prev=f,p.next=f,f.prev=p,f}function V5(d,o,c,f){const g=RM(d,o,c);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function X1(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function RM(d,o,c){return{i:d,x:o,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function RE(d,o){const c=d.length;if(c<=1)return[d];const f=[];let g,p;for(let x=0;x<c;x++){const I=Ec(d[x]);I!==0&&(d[x].area=Math.abs(I),p===void 0&&(p=I<0),p===I<0?(g&&f.push(g),g=[d[x]]):g.push(d[x]))}if(g&&f.push(g),o>1)for(let x=0;x<f.length;x++)f[x].length<=o||(fs(f[x],o,1,f[x].length-1,mre),f[x]=f[x].slice(0,o));return f}function mre(d,o){return o.area-d.area}function U5(d,o,c=1){if(!d)return null;const f=typeof d=="string"?hi.from(d).getPrimary():d.getPrimary(),g=f.id.toString();return o.has(g)||o.set(g,[]),f.scaleSelf(c),o.get(g).push(f),f.toString()}function MM(d,o,c,f){const g=f.patternDependencies;let p=!1;for(const x of o){const I=x.paint.get(`${d}-pattern`);I.isConstant()||(p=!0),U5(I.constantOr(null),g,c)&&(p=!0)}return p}function PM(d,o,c,f,g,p){const x=p.patternDependencies;for(const I of o){const D=I.paint.get(`${d}-pattern`).value;if(D.kind!=="constant"){let L=D.evaluate({zoom:f},c,{},p.availableImages);L=L&&L.name?L.name:L;const T=U5(L,x,g);T&&(c.patterns[I.id]=T)}}return c}var DM,H5,kM,W5,NM,$5,q5,ME={};function G5(){if(H5)return DM;H5=1;var d=Yn();function o(g,p,x,I,D){this.properties={},this.extent=x,this.type=0,this._pbf=g,this._geometry=-1,this._keys=I,this._values=D,g.readFields(c,this,p)}function c(g,p,x){g==1?p.id=x.readVarint():g==2?function(I,D){for(var L=I.readVarint()+I.pos;I.pos<L;){var T=D._keys[I.readVarint()],k=D._values[I.readVarint()];D.properties[T]=k}}(x,p):g==3?p.type=x.readVarint():g==4&&(p._geometry=x.pos)}function f(g){for(var p,x,I=0,D=0,L=g.length,T=L-1;D<L;T=D++)I+=((x=g[T]).x-(p=g[D]).x)*(p.y+x.y);return I}return DM=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var p,x=g.readVarint()+g.pos,I=1,D=0,L=0,T=0,k=[];g.pos<x;){if(D<=0){var z=g.readVarint();I=7&z,D=z>>3}if(D--,I===1||I===2)L+=g.readSVarint(),T+=g.readSVarint(),I===1&&(p&&k.push(p),p=[]),p.push(new d(L,T));else{if(I!==7)throw new Error("unknown command "+I);p&&p.push(p[0].clone())}}return p&&k.push(p),k},o.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var p=g.readVarint()+g.pos,x=1,I=0,D=0,L=0,T=1/0,k=-1/0,z=1/0,O=-1/0;g.pos<p;){if(I<=0){var B=g.readVarint();x=7&B,I=B>>3}if(I--,x===1||x===2)(D+=g.readSVarint())<T&&(T=D),D>k&&(k=D),(L+=g.readSVarint())<z&&(z=L),L>O&&(O=L);else if(x!==7)throw new Error("unknown command "+x)}return[T,z,k,O]},o.prototype.toGeoJSON=function(g,p,x){var I,D,L=this.extent*Math.pow(2,x),T=this.extent*g,k=this.extent*p,z=this.loadGeometry(),O=o.types[this.type];function B(J){for(var ce=0;ce<J.length;ce++){var le=J[ce];J[ce]=[360*(le.x+T)/L-180,360/Math.PI*Math.atan(Math.exp((180-360*(le.y+k)/L)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(I=0;I<z.length;I++)U[I]=z[I][0];B(z=U);break;case 2:for(I=0;I<z.length;I++)B(z[I]);break;case 3:for(z=function(J){var ce=J.length;if(ce<=1)return[J];for(var le,ie,ge=[],be=0;be<ce;be++){var Se=f(J[be]);Se!==0&&(ie===void 0&&(ie=Se<0),ie===Se<0?(le&&ge.push(le),le=[J[be]]):le.push(J[be]))}return le&&ge.push(le),ge}(z),I=0;I<z.length;I++)for(D=0;D<z[I].length;D++)B(z[I][D])}z.length===1?z=z[0]:O="Multi"+O;var X={type:"Feature",geometry:{type:O,coordinates:z},properties:this.properties};return"id"in this&&(X.id=this.id),X},DM}function Y5(){if(W5)return kM;W5=1;var d=G5();function o(f,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(c,this,g),this.length=this._features.length}function c(f,g,p){f===15?g.version=p.readVarint():f===1?g.name=p.readString():f===5?g.extent=p.readVarint():f===2?g._features.push(p.pos):f===3?g._keys.push(p.readString()):f===4&&g._values.push(function(x){for(var I=null,D=x.readVarint()+x.pos;x.pos<D;){var L=x.readVarint()>>3;I=L===1?x.readString():L===2?x.readFloat():L===3?x.readDouble():L===4?x.readVarint64():L===5?x.readVarint():L===6?x.readSVarint():L===7?x.readBoolean():null}return I}(p))}return kM=o,o.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var g=this._pbf.readVarint()+this._pbf.pos;return new d(this._pbf,g,this.extent,this._keys,this._values)},kM}function X5(){return q5||(q5=1,ME.VectorTile=function(){if($5)return NM;$5=1;var d=Y5();function o(c,f,g){if(c===3){var p=new d(g,g.readVarint()+g.pos);p.length&&(f[p.name]=p)}}return NM=function(c,f){this.layers=c.readFields(o,{},f)},NM}(),ME.VectorTileFeature=G5(),ME.VectorTileLayer=Y5()),ME}var gp=X5();const dg="3d_elevation_id",K5="level";class gre{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(o,c){return this._valid&&o(c(this._geometry)),this}require(o,c,f){return this.get(o,!0,c,f)}optional(o,c,f){return this.get(o,!1,c,f)}success(){return this._valid}get(o,c,f,g){const p=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&p!==void 0?f(g?g(p):p):c&&(this._valid=!1),this}}class Z5{constructor(o,c){this.featureFunc=o,this.vertexFunc=c}parseFeature(o,c,f){return this.featureFunc(o,c,f)}parseVertex(o,c,f){return this.vertexFunc(o,c,f)}}const _re=new Z5((d,o,c)=>d.reset(o).require(dg,f=>{c.id=f}).optional("fixed_height_relative",f=>{c.constantHeight=f},Xd.decodeRelativeHeight).geometry(f=>{c.bounds=f},Xd.computeBounds).success(),(d,o,c)=>d.reset(o).require(dg,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height_relative",f=>{c.height=f},Xd.decodeRelativeHeight).geometry(f=>{c.position=f},Xd.getPoint).success()),yre=new Z5((d,o,c)=>d.reset(o).require(dg,f=>{c.id=f}).optional("fixed_height",f=>{c.constantHeight=f},Xd.decodeMetricHeight).geometry(f=>{c.bounds=f},Xd.computeBounds).success(),(d,o,c)=>d.reset(o).require(dg,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height",f=>{c.height=f},Xd.decodeMetricHeight).geometry(f=>{c.position=f},Xd.getPoint).success());class Xd{static computeBounds(o){const c=new Ot(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),f=new Ot(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const g of o[0])c.x>g.x&&(c.x=g.x),c.y>g.y&&(c.y=g.y),f.x<g.x&&(f.x=g.x),f.y<g.y&&(f.y=g.y);return{min:c,max:f}}static getPoint(o){return Pe.vec2.fromValues(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static parse(o){const c=[],f=[],g=o.length,p=new gre;for(let I=0;I<g;I++){const D=o.feature(I),L=D.properties.hasOwnProperty("version")?String(D.properties.version):void 0,T=(x=L)?x==="1.0.1"?yre:void 0:_re;if(T===void 0){Nr(`Unknown elevation feature version number ${L||"(unknown)"}`);continue}const k=D.properties.hasOwnProperty("type")?D.properties.type:void 0;if(k){if(gp.VectorTileFeature.types[D.type]==="Point"&&k==="curve_point"){const z={};T.parseVertex(p,D,z)&&c.push(z)}else if(gp.VectorTileFeature.types[D.type]==="Polygon"&&k==="curve_meta"){const z={};T.parseFeature(p,D,z)&&f.push(z)}}}var x;return{vertices:c,features:f}}}class OM{constructor(o,c,f,g,p,x){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=o,this.heightRange={min:f,max:f},this.safeArea=c,this.constantHeight=f,this.constantHeight==null&&(this.constantHeight!=null||g.length!==0)){this.vertices=g,this.edges=p,this.edges=this.edges.filter(I=>I.a<this.vertices.length&&I.b<this.vertices.length&&!Pe.vec2.exactEquals(this.vertices[I.a].position,this.vertices[I.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const I of this.vertices)this.vertexProps.push({dir:Pe.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,I.height),this.heightRange.max=Math.max(this.heightRange.max,I.height);for(const I of this.edges){const D=this.vertices[I.a].position,L=this.vertices[I.b].position,T=Pe.vec2.subtract(Pe.vec2.create(),L,D),k=Pe.vec2.length(T),z=Pe.vec2.scale(Pe.vec2.create(),T,1/k);this.edgeProps.push({vec:T,dir:z,len:k});const O=this.vertexProps[I.a].dir,B=this.vertexProps[I.b].dir;Pe.vec2.add(O,O,z),Pe.vec2.add(B,B,z)}for(const I of this.vertexProps)I.dir[0]===0&&I.dir[1]===0||Pe.vec2.normalize(I.dir,I.dir);this.tessellate(x)}}pointElevation(o){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(o);if(c==null)return 0;const[f,g]=c;return((p,x,I)=>(1-I)*p+I*x)(this.vertices[this.edges[f].a].height,this.vertices[this.edges[f].b].height,g)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(this.edges.length===0)return;let c=0,f=Number.POSITIVE_INFINITY,g=0;const p=Pe.vec2.fromValues(o.x,o.y);for(let x=0;x<this.edges.length;x++){const I=this.edges[x],D=this.edgeProps[x].dir,L=new dr(p,this.edgeProps[x].dir),T=this.vertices[I.a].position,k=this.vertices[I.b].position,z=Pe.vec2.create(),O=Pe.vec2.create(),B=L.intersectsPlane(T,this.vertexProps[I.a].dir,z),U=L.intersectsPlane(k,this.vertexProps[I.b].dir,O);if(!B||!U)continue;const X=Pe.vec2.subtract(Pe.vec2.create(),O,z),J=Pe.vec2.subtract(Pe.vec2.create(),p,z),ce=Pe.vec2.dot(X,X),le=ce>0?Pe.vec2.dot(J,X)/ce:0,ie=Bn(le,0,1),ge=Math.abs((le-ie)*this.edgeProps[x].len),be=Pe.vec2.subtract(Pe.vec2.create(),p,T),Se=ge+Math.abs(Pe.vec2.dot(be,Pe.vec2.fromValues(D[1],-D[0])));Se<f&&(c=x,f=Se,g=ie)}return[c,g]}tessellate(o){for(let c=this.edges.length-1;c>=0;--c){const f=this.edges[c].a,g=this.edges[c].b,{position:p,height:x,extent:I}=this.vertices[f],{position:D,height:L,extent:T}=this.vertices[g],k=this.vertexProps[f].dir,z=this.vertexProps[g].dir,O=Pe.vec3.fromValues(p[0]/o,p[1]/o,x),B=Pe.vec3.fromValues(D[0]/o,D[1]/o,L),U=Pe.vec3.fromValues(k[1],-k[0],0);Pe.vec3.scale(U,U,I);const X=Pe.vec3.fromValues(z[1],-z[0],0);if(Pe.vec3.scale(X,X,T),this.distSqLines(Pe.vec3.fromValues(O[0]+.5*U[0],O[1]+.5*U[1],O[2]+.5*U[2]),Pe.vec3.fromValues(B[0]-.5*X[0],B[1]-.5*X[1],B[2]-.5*X[2]),Pe.vec3.fromValues(O[0]-.5*U[0],O[1]-.5*U[1],O[2]-.5*U[2]),Pe.vec3.fromValues(B[0]+.5*X[0],B[1]+.5*X[1],B[2]+.5*X[2]))<=.05*.05)continue;const J=this.vertices.length,ce=Pe.vec2.add(Pe.vec2.create(),p,D);this.vertices.push({position:Pe.vec2.scale(ce,ce,.5),height:.5*(x+L),extent:.5*(I+T)});const le=Pe.vec2.add(Pe.vec2.create(),k,z);this.vertexProps.push({dir:Pe.vec2.normalize(le,le)}),this.edges.splice(c,1),this.edgeProps.splice(c,1),this.edges.push({a:f,b:J}),this.edges.push({a:J,b:g});const ie=Pe.vec2.subtract(Pe.vec2.create(),this.vertices[J].position,p),ge=Pe.vec2.length(ie),be={vec:ie,dir:Pe.vec2.scale(Pe.vec2.create(),ie,1/ge),len:ge};this.edgeProps.push(be),this.edgeProps.push(be)}}distSqLines(o,c,f,g){const p=Pe.vec3.subtract(Pe.vec3.create(),c,o),x=Pe.vec3.subtract(Pe.vec3.create(),g,f),I=Pe.vec3.subtract(Pe.vec3.create(),o,f),D=Pe.vec3.dot(p,p),L=Pe.vec3.dot(p,x),T=Pe.vec3.dot(p,I),k=Pe.vec3.dot(x,x),z=Pe.vec3.dot(x,I),O=D*k-L*L;if(O===0){const ce=Pe.vec3.dot(I,x)/Pe.vec3.dot(x,x),le=Pe.vec3.lerp(Pe.vec3.create(),f,g,ce);return Pe.vec3.squaredDistance(le,o)}const B=(L*z-T*k)/O,U=(D*z-L*T)/O,X=Pe.vec3.lerp(Pe.vec3.create(),o,c,B),J=Pe.vec3.lerp(Pe.vec3.create(),f,g,U);return Pe.vec3.squaredDistance(X,J)}}class xre{constructor(o,c){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(c)||(this.zScale=Math.pow(2,c.z-o.z),this.xOffset=(o.x*this.zScale-c.x)*sn,this.yOffset=(o.y*this.zScale-c.y)*sn)}constantElevation(o,c){if(o.constantHeight!=null)return this.computeBiasedHeight(o.constantHeight,c)}pointElevation(o,c,f){const g=this.constantElevation(c,f);return g??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(o),f))}computeBiasedHeight(o,c){return c<=0?o:o+c*Es(0,c,o>=0?o:Math.abs(.5*o))}}Tn(OM,"ElevationFeature");class Q5{constructor(){this.polygons=new Map}add(o,...c){this.polygons.has(o)?this.polygons.get(o).push(...c):this.polygons.set(o,c)}merge(o){for(const[c,f]of o.polygons)this.add(c,...f)}}class fg{constructor(){this.portals=[]}static evaluate(o){if(o.length===0)return new fg;let c=[];for(const L of o)c.push(...L.portals);if(c.length===0)return new fg;const f=(L,T)=>L<=0&&T<=0||L>=sn&&T>=sn;for(const L of c){const T=L.va,k=L.vb;(f(T.x,k.x)||f(T.y,k.y))&&(L.type="border")}const g=c.filter(L=>L.type!=="unevaluated"),p=c.filter(L=>L.type==="unevaluated");if(p.length===0)return new fg;p.sort((L,T)=>L.hash===T.hash?L.isTunnel===T.isTunnel?0:L.isTunnel?-1:1:L.hash<T.hash?1:-1),c=g.concat(p);let x=g.length,I=x,D=x;do if(I++,I===c.length||c[x].hash!==c[I].hash){if(I-x==2){D<x&&(c[D]=c[x],c[x]=null);const L=c[D],T=c[I-1];L.type=L.isTunnel!==T.isTunnel?"tunnel":"polygon",L.connection={a:L.connection.a,b:T.connection.a},D++}x=I}while(x!==c.length);return c.splice(D),c.sort((L,T)=>L.hash<T.hash?1:-1),{portals:c}}}Tn(fg,"ElevationPortalGraph"),Tn(Q5,"ElevationPolygons");class vre{constructor(o,c,f){this.outPositions=o,this.outNormals=c,this.outIndices=f,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(o,c,f){let g=o[2];f!=null&&(g*=f);const p=this.getVec3Bits(o)<<96n|this.getVec3Bits(c),x=this.vertexLookup.get(p);if(x!=null)return x;const I=this.outPositions.length;this.vertexLookup.set(p,I);const D=Math.trunc(16384*c[0]),L=Math.trunc(16384*c[1]),T=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(o[0],o[1],g),this.outNormals.emplaceBack(D,L,T),I}addVertices(o,c,...f){const g=[];for(const p of f){const x=this.addVertex(p,o,c);g.push(x)}return g}addTriangles(o,c,f){if(c&&f){const g=f.length===1,p=Pe.vec3.fromValues(0,0,0);for(let x=0;x<o.length;x+=3){const I=c[o[x+0]],D=c[o[x+1]],L=c[o[x+2]],T=g?f[0]:f[o[x+1]],k=g?f[0]:f[o[x+2]],z=this.addVertex(Pe.vec3.fromValues(I.x,I.y,g?f[0]:f[o[x+0]]),p),O=this.addVertex(Pe.vec3.fromValues(D.x,D.y,T),p),B=this.addVertex(Pe.vec3.fromValues(L.x,L.y,k),p);this.outIndices.emplaceBack(z,O,B)}}else for(let g=0;g<o.length;g+=3)this.outIndices.emplaceBack(o[g+0],o[g+1],o[g+2])}addQuad(o,c){const f=this.addVertices(c,void 0,...o.map(D=>Pe.vec3.fromValues(D.coord.x,D.coord.y,D.height))),[g,p,x,I]=f;this.addTriangles([g,p,x,x,I,g])}getBits(o){return this.view.setFloat32(0,o),BigInt(this.view.getUint32(0))}getVec3Bits(o){return this.getBits(o[0])<<64n|this.getBits(o[1])<<32n|this.getBits(o[2])}}class uh{constructor(o){this.unevaluatedPortals=new fg,this.portalPolygons=new Q5,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Qm,this.vertexNormals=new S1,this.indexArray=new la,this.tileToMeters=y(o)}addVertices(o,c){const f=this.unevalVertices.length;for(let g=0;g<o.length;g++)this.unevalVertices.push(o[g]),this.unevalHeights.push(c[g]);return f}addTriangles(o,c,f){const g=f?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of o)g.push(p+c)}addRenderableRing(o,c,f,g,p){const x=[new Ot(p.min.x,p.min.y),new Ot(p.max.x,p.min.y),new Ot(p.max.x,p.max.y),new Ot(p.min.x,p.max.y)];for(let I=0;I<f-1;I++){const D=c+I,L=D+1,T=this.unevalVertices[D],k=this.unevalVertices[L];if(!(T.x>=p.min.x&&T.x<=p.max.x&&T.y>=p.min.y&&T.y<=p.max.y||k.x>=p.min.x&&k.x<=p.max.x&&k.y>=p.min.y&&k.y<=p.max.y||tt(T,k,x))||this.isOnBorder(T.x,k.x)||this.isOnBorder(T.y,k.y))continue;const z=uh.computeEdgeHash(this.unevalVertices[D],this.unevalVertices[L]);let O,B=this.vertexHashLookup.get(uh.computePosHash(T));B!=null?O=B.next:(B=this.vertexHashLookup.get(uh.computePosHash(k)),O=B!=null?B.prev:z),this.unevalEdges.push({polygonIdx:o,a:D,b:L,hash:z,portalHash:O,isTunnel:g,type:"unevaluated"})}}addPortalCandidates(o,c,f,g,p){if(c.length===0)return;this.portalPolygons.add(o,{geometry:c,zLevel:p});const x=c[0];this.vertexHashLookup.clear();let I=uh.computeEdgeHash(x[x.length-2],x[x.length-1]);for(let D=0;D<x.length-1;D++){const L=x[D+0],T=x[D+1],k=Pe.vec2.fromValues(T.x-L.x,T.y-L.y),z=Pe.vec2.length(k);if(z===0)continue;let O="unevaluated";const B=g.pointElevation(L),U=g.pointElevation(T);Math.abs(B)<.01&&Math.abs(U)<.01?O="entrance":(this.isOnBorder(L.x,T.x)||this.isOnBorder(L.y,T.y))&&(O="border");const X=uh.computeEdgeHash(L,T);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:L,vb:T,vab:k,length:z,hash:X,isTunnel:f,type:O});const J=uh.computePosHash(L);this.vertexHashLookup.set(J,{prev:I,next:X}),I=X}}construct(o){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),f=k=>{k.primitiveLength=this.indexArray.length-k.primitiveOffset},g=new vre(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const p=c(),x=c(),I=c(),D=(k,z)=>{k.sort((B,U)=>B.type===z&&U.type!==z?-1:B.type!==z&&U.type===z?1:0);const O=k.findIndex(B=>B.type!==z);return O>=0?O:k.length};let L=0;this.unevalEdges.length>0&&(L=D(this.unevalEdges,"none"),this.constructBridgeStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:L},this.tileToMeters));const T=c();if(this.unevalEdges.length>0){const k=this.unevalEdges.splice(L),z=D(k,"tunnel")+L;this.unevalEdges.push(...k),this.constructTunnelStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:L},{min:L,max:z})}f(I),g.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),f(T),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),f(x),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),f(p),this.maskSegments=xs.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.depthSegments=xs.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableSegments=xs.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=xs.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}upload(o){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,ire.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,sre.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(o,c,f,g){const p=new Map;for(let x=f;x<g;x++){const I=c[x],D=I.a,L=I.b;p.has(D)||p.set(D,{}),p.has(L)||p.set(L,{});const T=p.get(D),k=p.get(L);o[L]>0&&(T.to=L),o[D]>0&&(k.from=D)}return p}constructBridgeStructures(o,c,f,g,p,x){const I=this.computeVertexConnections(f,g,p.min,p.max),D=1/x,L=.5*D,T=z=>Pe.vec3.fromValues(c[z].x,c[z].y,f[z]*D),k=z=>{const O=I.get(z),B=O.from,U=O.to;if(!B||!U)return;const X=T(B),J=T(z),ce=T(U),le=Pe.vec3.fromValues(0,0,0);if(!Pe.vec3.exactEquals(X,J)){const ge=Pe.vec3.sub(Pe.vec3.create(),J,X);Pe.vec3.add(le,le,Pe.vec3.normalize(ge,ge))}if(!Pe.vec3.exactEquals(ce,J)){const ge=Pe.vec3.sub(Pe.vec3.create(),ce,J);Pe.vec3.add(le,le,Pe.vec3.normalize(ge,ge))}const ie=Pe.vec3.len(le);return ie>0?Pe.vec3.scale(le,le,1/ie):void 0};for(let z=p.min;z<p.max;z++){const O=g[z],B=this.prepareEdgePoints(c,f,O,(Yt,Zn)=>Yt>=Zn);if(B==null)continue;const U=B[0],X=B[1],J=Pe.vec3.fromValues(U.coord.x,U.coord.y,D*U.height),ce=Pe.vec3.fromValues(X.coord.x,X.coord.y,D*X.height);if(Pe.vec3.exactEquals(J,ce))continue;const le=Pe.vec3.sub(Pe.vec3.create(),ce,J);Pe.vec3.normalize(le,le);const ie=Yt=>Pe.vec3.normalize(Yt,Yt),ge=k(O.a)||le,be=k(O.b)||le,Se=ie(Pe.vec3.fromValues(ge[1],-ge[0],0)),Ve=ie(Pe.vec3.fromValues(be[1],-be[0],0)),Le=ie(Pe.vec3.cross(Pe.vec3.create(),Se,ge)),Be=ie(Pe.vec3.cross(Pe.vec3.create(),Ve,be)),Qe=Pe.vec3.create(),Ue=[Pe.vec3.add(Pe.vec3.create(),J,Pe.vec3.scale(Qe,Pe.vec3.sub(Qe,Se,Le),L)),Pe.vec3.add(Pe.vec3.create(),J,Pe.vec3.scale(Qe,Pe.vec3.add(Qe,Se,Le),L)),Pe.vec3.add(Pe.vec3.create(),J,Pe.vec3.scale(Qe,Le,L)),J],Je=[Pe.vec3.add(Pe.vec3.create(),ce,Pe.vec3.scale(Qe,Pe.vec3.sub(Qe,Ve,Be),L)),Pe.vec3.add(Pe.vec3.create(),ce,Pe.vec3.scale(Qe,Pe.vec3.add(Qe,Ve,Be),L)),Pe.vec3.add(Pe.vec3.create(),ce,Pe.vec3.scale(Qe,Be,L)),ce],[lt,st]=o.addVertices(Se,x,Ue[0],Ue[1]),[mt,pt]=o.addVertices(Ve,x,Je[0],Je[1]);o.addTriangles([lt,st,mt,st,pt,mt]);const[vt,_t]=o.addVertices(Le,x,Ue[1],Ue[2]),[Et,qt]=o.addVertices(Be,x,Je[1],Je[2]);o.addTriangles([vt,_t,Et,_t,qt,Et]);const[Ht,Cn]=o.addVertices(Pe.vec3.negate(Se,Se),x,Ue[2],Ue[3]),[Qt,ln]=o.addVertices(Pe.vec3.negate(Ve,Ve),x,Je[2],Je[3]);o.addTriangles([Ht,Cn,Qt,Cn,ln,Qt])}}constructTunnelStructures(o,c,f,g,p,x){const I=D=>Pe.vec3.normalize(D,D);for(let D=p.min;D<p.max;D++){const L=this.prepareEdgePoints(c,f,g[D],(O,B)=>O<=B);if(L==null)continue;const[T,k]=L,z=I(Pe.vec3.fromValues(k.coord.y-T.coord.y,-(k.coord.x-T.coord.x),0));o.addQuad([T,k,{coord:k.coord,height:g[D].isTunnel?-.1:0},{coord:T.coord,height:g[D].isTunnel?-.1:0}],z)}for(let D=x.min;D<x.max;D++){const L=g[D],T=c[L.a],k=c[L.b],z=I(Pe.vec3.fromValues(k.y-T.y,-(k.x-T.x),0));o.addQuad([{coord:k,height:0},{coord:T,height:0},{coord:T,height:f[L.a]+4},{coord:k,height:f[L.b]+4}],z),o.addQuad([{coord:T,height:0},{coord:k,height:0},{coord:k,height:f[L.b]+4},{coord:T,height:f[L.a]+4}],z)}}prepareEdgePoints(o,c,f,g){const p=o[f.a],x=o[f.b];let I=c[f.a],D=c[f.b];if(!(I!==0&&g(I,0)||D!==0&&g(D,0)))return;const L=p.clone(),T=x.clone();if(g(I,0)){if(!g(D,0)){const k=D/(D-I);T.x=Wn(T.x,L.x,k),T.y=Wn(T.y,L.y,k),D=Wn(D,I,k)}}else{const k=I/(I-D);L.x=Wn(L.x,T.x,k),L.y=Wn(L.y,T.y,k),I=Wn(I,D,k)}return[{coord:L,height:I},{coord:T,height:D}]}prepareEdges(o,c){if(c.length===0)return;c.sort((I,D)=>I.hash===D.hash?D.polygonIdx-I.polygonIdx:D.hash>I.hash?1:-1);let f=0,g=0,p=0,x=c[f].polygonIdx;do g++,(g===c.length||c[f].hash!==c[g].hash)&&((g-f==1||c[g-1].polygonIdx!==x)&&(p<f&&(c[p]=c[f],c[f]=null),c[p].type="none",p++),f=g,f!==c.length&&(x=c[f].polygonIdx));while(f!==c.length);if(c.splice(p),c.length!==0&&o.length!==0){c.sort((L,T)=>L.hash<T.hash?1:-1);let I=0,D=0;for(;I!==c.length&&D!==o.length;){const L=c[I],T=o[D];L.portalHash>T.hash?I++:T.hash>L.portalHash?D++:(L.type=T.type,I++)}}}isOnBorder(o,c){return o<=0&&c<=0||o>=sn&&c>=sn}static computeEdgeHash(o,c){return(o.y===c.y&&o.x>c.x||o.y>c.y)&&([o,c]=[c,o]),BigInt(uh.computePosHash(o))<<32n|BigInt(uh.computePosHash(c))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}class LM{constructor(o,c){this.layoutVertexArray=new sh,this.indexArray=new la,this.lineIndexArray=new Qh,this.triangleSegments=new xs,this.lineSegments=new xs,this.programConfigurations=new ed(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new Hd)}update(o,c,f,g,p,x,I){this.programConfigurations.updatePaintArrays(o,c,p,f,g,x,I)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,nre.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,rre.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,c,f,g,p,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,f,g,p,x)}}class FM{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new LM(o,!1),this.elevationBufferData=new LM(o,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(o,c){}populate(o,c,f,g){this.hasPattern=MM("fill",this.layers,this.pixelRatio,c);const p=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:I,id:D,index:L,sourceLayerIndex:T}of o){const k=this.layers[0]._featureFilter.needGeometry,z=Y(I,k);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),z,f))continue;const O=p?p.evaluate(z,{},f,c.availableImages):void 0,B={id:D,properties:I.properties,type:I.type,sourceLayerIndex:T,index:L,geometry:k?z.geometry:G(I,f,g),patterns:{},sortKey:O};x.push(B)}p&&x.sort((I,D)=>I.sortKey-D.sortKey);for(const I of x){const{geometry:D,index:L,sourceLayerIndex:T}=I;if(this.hasPattern){const k=PM("fill",this.layers,I,this.zoom,this.pixelRatio,c);this.patternFeatures.push(k)}else this.addFeature(I,D,L,f,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(o[L].feature,D,L,T,this.index)}}update(o,c,f,g,p,x,I){this.bufferData.update(o,c,f,g,p,x,I),this.elevationBufferData.update(o,c,f,g,p,x,I)}addFeatures(o,c,f,g,p,x){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,c,f,g,x,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,c,f,g,p,x=[],I,D){const L=RE(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(o,L,g,f,D):this.addGeometry(L,this.bufferData),this.bufferData.populatePaintArrays(o,f,p,x,g,I),this.elevationBufferData.populatePaintArrays(o,f,p,x,g,I)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o){this.elevatedStructures&&this.elevatedStructures.construct(o)}addElevatedRoadFeature(o,c,f,g,p){const x=new Array,I=this.getElevationFeature(o,p);if(I){x.push({polygons:c,elevationFeature:I,elevationTileID:f});for(const D of x)if(D.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new uh(D.elevationTileID));const T=D.elevationFeature.isTunnel();let k=0;o.properties.hasOwnProperty(K5)&&(k=+o.properties[K5]);for(const z of D.polygons)this.elevatedStructures.addPortalCandidates(D.elevationFeature.id,z,T,D.elevationFeature,k)}const L=new xre(f,D.elevationTileID);this.addElevatedGeometry(D.polygons,L,D.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,g)}}else this.addGeometry(c,this.bufferData)}addElevatedGeometry(o,c,f,g,p){const x={elevation:f,elevationSampler:c,bias:g,index:p},[I,D]=this.addGeometry(o,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:I,max:D}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,I),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,D))}addGeometry(o,c,f){let g=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,x=null;f&&(x=f.elevationSampler.constantElevation(f.elevation,f.bias),x!=null&&(g=x,p=x));const I=(D,L,T)=>{if(f!=null)if(L.push(D),x!=null)c.elevatedLayoutVertexArray.emplaceBack(x),T.push(x);else{const k=f.elevationSampler.pointElevation(D,f.elevation,f.bias);c.elevatedLayoutVertexArray.emplaceBack(k),T.push(k),g=Math.min(g,k),p=Math.max(p,k)}};for(const D of o){let L=0;for(const le of D)L+=le.length;const T=c.triangleSegments.prepareSegment(L,c.layoutVertexArray,c.indexArray),k=T.vertexLength,z=[],O=[],B=[],U=[],X=[],J=c.layoutVertexArray.length;for(const le of D){if(le.length===0)continue;le!==D[0]&&O.push(z.length/2);const ie=c.lineSegments.prepareSegment(le.length,c.layoutVertexArray,c.lineIndexArray),ge=ie.vertexLength;f&&X.push(c.layoutVertexArray.length-J),I(le[0],B,U),c.layoutVertexArray.emplaceBack(le[0].x,le[0].y),c.lineIndexArray.emplaceBack(ge+le.length-1,ge),z.push(le[0].x),z.push(le[0].y);for(let be=1;be<le.length;be++)I(le[be],B,U),c.layoutVertexArray.emplaceBack(le[be].x,le[be].y),c.lineIndexArray.emplaceBack(ge+be-1,ge+be),z.push(le[be].x),z.push(le[be].y);ie.vertexLength+=le.length,ie.primitiveLength+=le.length}const ce=q1(z,O);for(let le=0;le<ce.length;le+=3)c.indexArray.emplaceBack(k+ce[le],k+ce[le+1],k+ce[le+2]);if(f&&this.elevationMode==="hd-road-base"){const le=f.elevation.isTunnel(),ie=f.elevation.safeArea,ge=this.elevatedStructures.addVertices(B,U);this.elevatedStructures.addTriangles(ce,ge,le);const be=X.length;if(be>0){for(let Se=0;Se<be-1;Se++)this.elevatedStructures.addRenderableRing(f.index,X[Se]+ge,X[Se+1]-X[Se],le,ie);this.elevatedStructures.addRenderableRing(f.index,X[be-1]+ge,B.length-X[be-1],le,ie)}}T.vertexLength+=L,T.primitiveLength+=ce.length/3}return[g,p]}getElevationFeature(o,c){if(!c)return;const f=+o.properties[dg];return f!=null?c.find(g=>g.id===f):void 0}}let J5,eB,tB,nB;Tn(FM,"FillBucket",{omit:["layers","patternFeatures"]}),Tn(LM,"FillBufferData"),Tn(uh,"ElevatedStructures");class BM{constructor(o,c,f,g){if(this.triangleCount=c.length/3,this.min=new Ot(0,0),this.max=new Ot(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||o.length===0)return;const[p,x]=[o[0].clone(),o[0].clone()];for(let k=1;k<o.length;++k){const z=o[k];p.x=Math.min(p.x,z.x),p.y=Math.min(p.y,z.y),x.x=Math.max(x.x,z.x),x.y=Math.max(x.y,z.y)}if(g){const k=Math.ceil(Math.max(x.x-p.x,x.y-p.y)/g);f=Math.max(f,k)}if(f===0)return;this.min=p,this.max=x;const I=this.max.sub(this.min);I.x=Math.max(I.x,1),I.y=Math.max(I.y,1);const D=Math.max(I.x,I.y)/f;this.cellsX=Math.max(1,Math.ceil(I.x/D)),this.cellsY=Math.max(1,Math.ceil(I.y/D)),this.xScale=1/D,this.yScale=1/D;const L=[];for(let k=0;k<this.triangleCount;k++){const z=o[c[3*k+0]].sub(this.min),O=o[c[3*k+1]].sub(this.min),B=o[c[3*k+2]].sub(this.min),U=rd(Math.floor(Math.min(z.x,O.x,B.x)),this.xScale,this.cellsX),X=rd(Math.floor(Math.max(z.x,O.x,B.x)),this.xScale,this.cellsX),J=rd(Math.floor(Math.min(z.y,O.y,B.y)),this.yScale,this.cellsY),ce=rd(Math.floor(Math.max(z.y,O.y,B.y)),this.yScale,this.cellsY),le=new Ot(0,0),ie=new Ot(0,0),ge=new Ot(0,0),be=new Ot(0,0);for(let Se=J;Se<=ce;++Se){le.y=ie.y=Se*D,ge.y=be.y=(Se+1)*D;for(let Ve=U;Ve<=X;++Ve)le.x=ge.x=Ve*D,ie.x=be.x=(Ve+1)*D,(At(z,O,B,le,ie,be)||At(z,O,B,le,be,ge))&&L.push({cellIdx:Se*this.cellsX+Ve,triIdx:k})}}if(L.length===0)return;L.sort((k,z)=>k.cellIdx-z.cellIdx||k.triIdx-z.triIdx);let T=0;for(;T<L.length;){const k=L[T].cellIdx,z={start:this.payload.length,len:0};for(;T<L.length&&L[T].cellIdx===k;)++z.len,this.payload.push(L[T++].triIdx);this.cells[k]=z}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,c){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const f=rd(o.x-this.min.x,this.xScale,this.cellsX),g=rd(o.y-this.min.y,this.yScale,this.cellsY),p=this.cells[g*this.cellsX+f];if(p){this._lazyInitLookup();for(let x=0;x<p.len;x++){const I=this.payload[p.start+x],D=Math.floor(I/8),L=1<<I%8;if(!(this.lookup[D]&L)&&(this.lookup[D]|=L,c.push(I),c.length===this.triangleCount))return}}}query(o,c,f){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>c.x||o.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const g=rd(o.x-this.min.x,this.xScale,this.cellsX),p=rd(c.x-this.min.x,this.xScale,this.cellsX),x=rd(o.y-this.min.y,this.yScale,this.cellsY),I=rd(c.y-this.min.y,this.yScale,this.cellsY);for(let D=x;D<=I;D++)for(let L=g;L<=p;L++){const T=this.cells[D*this.cellsX+L];if(T)for(let k=0;k<T.len;k++){const z=this.payload[T.start+k],O=Math.floor(z/8),B=1<<z%8;if(!(this.lookup[O]&B)&&(this.lookup[O]|=B,f.push(z),f.length===this.triangleCount))return}}}}function rd(d,o,c){return Math.max(0,Math.min(c-1,Math.floor(d*o)))}Tn(BM,"TriangleGridIndex");class rB{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[]}updateFootprints(o,c){for(const f of this.footprints)c.push({footprint:f,id:o})}populate(o,c,f,g){const p=[];for(const{feature:x,id:I,index:D,sourceLayerIndex:L}of o){const T=this.layers[0]._featureFilter.needGeometry,k=Y(x,T);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),k,f))continue;const z={id:I,properties:x.properties,type:x.type,sourceLayerIndex:L,index:D,geometry:T?k.geometry:G(x,f,g),patterns:{}};p.push(z)}for(const x of p){const{geometry:I,index:D,sourceLayerIndex:L}=x;this.addFeature(x,I,D,f,{},c.availableImages,c.brightness),c.featureIndex.insert(o[D].feature,I,D,L,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(o){}update(o,c,f,g,p,x,I){}destroy(){}addFeature(o,c,f,g,p,x=[],I){for(const D of RE(c,2)){const L=[],T=[],k=[],z=new Ot(1/0,1/0),O=new Ot(-1/0,-1/0);for(const X of D)if(X.length!==0){X!==D[0]&&k.push(T.length/2);for(let J=0;J<X.length;J++)T.push(X[J].x),T.push(X[J].y),L.push(X[J]),z.x=Math.min(z.x,X[J].x),z.y=Math.min(z.y,X[J].y),O.x=Math.max(O.x,X[J].x),O.y=Math.max(O.y,X[J].y)}const B=q1(T,k),U=new BM(L,B,8,256);this.footprints.push({vertices:L,indices:B,grid:U,min:z,max:O})}}}Tn(rB,"ClipBucket",{omit:["layers"]});const bre=yi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),wre=yi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ere=yi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Sre=yi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Tre=yi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Cre=yi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ire}=bre;class pg extends Ot{constructor(o,c,f){super(o,c),this.z=f}}class iB extends pg{constructor(o,c,f,g){super(o,c,f),this.w=g}}function PE(d,o,c,f){const g=[],p=f===0?(x,I,D,L,T,k)=>{x.push(new Ot(k,D+(k-I)/(L-I)*(T-D)))}:(x,I,D,L,T,k)=>{x.push(new Ot(I+(k-D)/(T-D)*(L-I),k))};for(const x of d){const I=[];for(const D of x){if(D.length<=2)continue;const L=[];for(let z=0;z<D.length-1;z++){const O=D[z].x,B=D[z].y,U=D[z+1].x,X=D[z+1].y,J=f===0?O:B,ce=f===0?U:X;J<o?ce>o&&p(L,O,B,U,X,o):J>c?ce<c&&p(L,O,B,U,X,c):L.push(D[z]),ce<o&&J>=o&&p(L,O,B,U,X,o),ce>c&&J<=c&&p(L,O,B,U,X,c)}let T=D[D.length-1];const k=f===0?T.x:T.y;k>=o&&k<=c&&L.push(T),L.length&&(T=L[L.length-1],L[0].x===T.x&&L[0].y===T.y||L.push(L[0]),I.push(L))}I.length&&g.push(I)}return g}function sB(d,o,c,f){const g=c==="x"?"y":"x",p=(f-d[c])/(o[c]-d[c]);d[g]=d[g]+(o[g]-d[g])*p,d[c]=f,d.hasOwnProperty("z")&&(d.z=Wn(d.z,o.z,p)),d.hasOwnProperty("w")&&(d.w=Wn(d.w,o.w,p))}function oB(d,o,c,f){const g=c,p=f;for(const x of["x","y"]){let I=d,D=o;I[x]>=D[x]&&(I=o,D=d),I[x]<g&&D[x]>g&&sB(I,D,x,g),I[x]<p&&D[x]>p&&sB(D,I,x,p)}}const DE=Number.MAX_SAFE_INTEGER;function aB(d,o,c,f){return d.order<o||d.order===DE||!(d.clipMask&c)||function(g,p){return p.length!==0&&p.find(x=>x===g)===void 0}(f,d.clipScope)}function kE(d,o){return d.x-o.x||d.y-o.y}function lB(d,o){return kE(d.min,o.min)===0&&kE(d.max,o.max)===0}function zM(d,o){return!(d.min.x>o.max.x||d.max.x<o.min.x||d.min.y>o.max.y||d.max.y<o.min.y)}function jM(d,o){if(d.length!==o.length)return!1;for(let c=0;c<d.length;c++)if(d[c].sourceId!==o[c].sourceId||!lB(d[c],o[c])||d[c].order!==o[c].order||d[c].clipMask!==o[c].clipMask||!Sr(d[c].clipScope,o[c].clipScope))return!1;return!0}function cB(d,o,c){const f=1/sn,g=1/(1<<c.canonical.z),p=(o.x*f+c.canonical.x)*g+c.wrap,x=(o.y*f+c.canonical.y)*g;return{min:new Ot((d.x*f+c.canonical.x)*g+c.wrap,(d.y*f+c.canonical.y)*g),max:new Ot(p,x)}}function Are(d,o,c){const f=1<<c.canonical.z,g=((o.x-c.wrap)*f-c.canonical.x)*sn,p=(o.y*f-c.canonical.y)*sn;return{min:new Ot(((d.x-c.wrap)*f-c.canonical.x)*sn,(d.y*f-c.canonical.y)*sn),max:new Ot(g,p)}}function uB(d,o,c,f,g,p,x){const I=d.indices,D=d.vertices,L=[];for(let T=f;T<f+g;T+=3){const k=o[c[T+0]+p],z=o[c[T+1]+p],O=o[c[T+2]+p],B=Math.min(k.x,z.x,O.x),U=Math.max(k.x,z.x,O.x),X=Math.min(k.y,z.y,O.y),J=Math.max(k.y,z.y,O.y);L.length=0,d.grid.query(new Ot(B,X),new Ot(U,J),L);for(let ce=0;ce<L.length;ce++){const le=L[ce];if(At(D[I[3*le+0]],D[I[3*le+1]],D[I[3*le+2]],k,z,O,x))return!0}}return!1}function hB(d,o,c,f){if(!d||!c)return!1;let g=d.vertices;if(!o.canonical.equals(f.canonical)||o.wrap!==f.wrap){if(c.vertices.length<d.vertices.length)return hB(c,f,d,o);const p=o.canonical,x=f.canonical,I=Math.pow(2,x.z-p.z);g=d.vertices.map(D=>new Ot((D.x+p.x*sn)*I-x.x*sn,(D.y+p.y*sn)*I-x.y*sn))}return uB(c,g,d.indices,0,d.indices.length,0,0)}function dB(d,o,c,f){const g=Math.pow(2,f.z-c.z);return new Ot((d+c.x*sn)*g-f.x*sn,(o+c.y*sn)*g-f.y*sn)}function fB(d,o){const c=[];o.grid.queryPoint(d,c);const f=o.indices,g=o.vertices;for(let p=0;p<c.length;p++){const x=c[p];if(Xe([g[f[3*x+0]],g[f[3*x+1]],g[f[3*x+2]]],d))return!0}return!1}const VM=[new Ot(0,0),new Ot(sn,0),new Ot(sn,sn),new Ot(0,sn)];function pB(d,o){const c=[];let f=[];if(!o||d.length<2)return[d];if(d.length===2)return tt(d[0],d[1],VM)?[d]:[];for(let g=0;g<d.length+2;g++){const p=d[g%d.length],x=d[(g+1)%d.length],I=tt(g===0?d[d.length-1]:d[(g-1)%d.length],p,VM),D=tt(p,x,VM),L=I||D;L&&f.push(p),L&&D||f.length>0&&(f.length>1&&c.push(f),f=[])}return f.length>1&&c.push(f),c}const UM=gp.VectorTileFeature.types,Rre=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Mre=["fill-extrusion-flood-light-ground-radius"],Pre=Math.pow(2,13),Dre=Math.pow(2,15)-1,mB=new Ot(0,1),_p=2147483648;function K1(d,o,c,f,g,p,x,I){d.emplaceBack((o<<1)+x,(c<<1)+p,(Math.floor(f*Pre)<<1)+g,Math.round(I))}function Z1(d,o,c){d.emplaceBack(o.x*sn,o.y*sn,c?1:0)}function NE(d,o,c,f,g,p){d.emplaceBack(o.x,o.y,(c.x<<1)+f,(c.y<<1)+g,p)}function Q1(d,o,c){d.emplaceBack(o.x,o.y,o.z,c[0]*16384,c[1]*16384,c[2]*16384)}class gB{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class _B{constructor(){this.centroidXY=new Ot(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ot(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ot(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ot(this.max.x-this.min.x,this.max.y-this.min.y)}}class yB{constructor(){this.acc=new Ot(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,c){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=c.x,o.min.y=o.max.y=c.y)}appendEdge(o,c,f){this.accCount++,this.acc._add(c);let g=!!this.borders;c.x<o.min.x?(o.min.x=c.x,g=!0):c.x>o.max.x&&(o.max.x=c.x,g=!0),c.y<o.min.y?(o.min.y=c.y,g=!0):c.y>o.max.y&&(o.max.y=c.y,g=!0),((c.x===0||c.x===sn)&&c.x===f.x)!=((c.y===0||c.y===sn)&&c.y===f.y)&&this.processBorderOverlap(c,f),g&&this.checkBorderIntersection(c,f)}checkBorderIntersection(o,c){c.x<0!=o.x<0&&this.addBorderIntersection(0,Wn(c.y,o.y,(0-c.x)/(o.x-c.x))),c.x>sn!=o.x>sn&&this.addBorderIntersection(1,Wn(c.y,o.y,(sn-c.x)/(o.x-c.x))),c.y<0!=o.y<0&&this.addBorderIntersection(2,Wn(c.x,o.x,(0-c.y)/(o.y-c.y))),c.y>sn!=o.y>sn&&this.addBorderIntersection(3,Wn(c.x,o.x,(sn-c.y)/(o.y-c.y)))}addBorderIntersection(o,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[o];c<f[0]&&(f[0]=c),c>f[1]&&(f[1]=c)}processBorderOverlap(o,c){if(o.x===c.x){if(o.y===c.y)return;const f=o.x===0?0:1;this.addBorderIntersection(f,c.y),this.addBorderIntersection(f,o.y)}else{const f=o.y===0?2:3;this.addBorderIntersection(f,c.x),this.addBorderIntersection(f,o.x)}}centroid(){return this.accCount===0?new Ot(0,0):new Ot(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,c)=>o+ +(c[0]!==Number.MAX_VALUE),0):0}}function xB(d,o){const c=d.add(o)._unit(),f=Bn(d.x*c.x+d.y*c.y,-1,1);var g,p,x;return x=Math.acos(f),Math.min(4,Math.max(-4,Math.tan(x)))/4*Dre*((g=d).x*(p=o).y-g.y*p.x<0?-1:1)}const kre=[d=>d.x<0,d=>d.x>sn,d=>d.y<0,d=>d.y>sn];function Nre(d,o,c,f){const g=[4];if(f===0)return g;c._mult(f);const p=d.sub(c),x=o.sub(c),I=[d,o,p,x];for(let D=0;D<4;D++)for(const L of I)if(kre[D](L)){g.push(D);break}return g}class vB{constructor(o){this.vertexArray=new Mc,this.indexArray=new la,this.programConfigurations=new ed(o.layers,{zoom:o.zoom,lut:o.lut},c=>Mre.includes(c)),this._segments=new xs,this.hiddenByLandmarkVertexArray=new N1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(o,c,f,g=!1){const p=o.length;if(p>2){let x=Math.max(0,this._segments.get().length-1);const I=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let D;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const L=o[0],T=o[1];D=xB(L.sub(o[p-1])._perp()._unit(),T.sub(L)._perp()._unit())}for(let L=0;L<p;L++){const T=L===p-1?0:L+1,k=o[L],z=o[T],O=o[T===p-1?0:T+1],B=z.sub(k)._perp()._unit(),U=xB(B,O.sub(z)._perp()._unit()),X=D,J=U;if(HM(k,z,c)||g&&EB(k,c)&&EB(z,c)){D=U;continue}const ce=I.vertexLength;NE(this.vertexArray,k,z,1,1,X),NE(this.vertexArray,k,z,1,0,X),NE(this.vertexArray,k,z,0,1,J),NE(this.vertexArray,k,z,0,0,J),I.vertexLength+=4;const le=Nre(k,z,B,f);for(const ie of le)this._segmentToGroundQuads[x].push({id:ce,region:ie}),this._segmentToRegionTriCounts[x][ie]+=2,I.primitiveLength+=2;D=U}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),c=o.length;for(let f=0;f<c;f++)this._segmentToGroundQuads[f].sort((g,p)=>g.region-p.region);for(let f=0;f<c;f++){const g=this._segmentToGroundQuads[f],p=o[f],x=this._segmentToRegionTriCounts[f];x.reduce((D,L)=>D+L,0);let I=0;for(let D=0;D<=4;D++){const L=x[D];if(L!==0){let T=this.regionSegments[D];T||(T=this.regionSegments[D]=new xs);const k={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+I,vertexLength:p.vertexLength,primitiveLength:L};T.get().push(k)}I+=L}for(let D=0;D<g.length;D++){const L=g[D].id;this.indexArray.emplaceBack(L,L+1,L+3),this.indexArray.emplaceBack(L,L+3,L+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,c,f,g,p,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,c,f,g,p,x)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,wre.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,c,f,g,p,x,I){this.hasData()&&this.programConfigurations.updatePaintArrays(o,c,f,g,p,x,I)}updateHiddenByLandmark(o){if(!this.hasData())return;const c=o.groundVertexCount+o.groundVertexArrayOffset;if(o.groundVertexCount===0)return;const f=o.flags&_p?1:0;for(let g=o.groundVertexArrayOffset;g<c;++g)this.hiddenByLandmarkVertexArray.emplace(g,f);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,Tre.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const c=this.regionSegments[o];c&&c.destroy()}}}}class OE{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new la,this.footprintVertices=new sh,this.footprintSegments=[],this.layoutVertexArray=new oh,this.centroidVertexArray=new ig,this.wallVertexArray=new yE,this.indexArray=new la,this.programConfigurations=new ed(o.layers,{zoom:o.zoom,lut:o.lut},c=>Rre.includes(c)),this.segments=new xs,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new vB(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,c){}populate(o,c,f,g){this.features=[],this.hasPattern=MM("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=y(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:x,index:I,sourceLayerIndex:D}of o){const L=this.layers[0]._featureFilter.needGeometry,T=Y(p,L);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),T,f))continue;const k={id:x,sourceLayerIndex:D,index:I,geometry:L?T.geometry:G(p,f,g),properties:p.properties,type:p.type,patterns:{}},z=this.layoutVertexArray.length,O=UM[k.type]==="Polygon";if(this.hasPattern)this.features.push(PM("fill-extrusion",this.layers,k,this.zoom,this.pixelRatio,c));else if(this.wallMode)for(const B of k.geometry)for(const U of pB(B,O))this.addFeature(k,[U],I,f,{},c.availableImages,g,c.brightness);else this.addFeature(k,k.geometry,I,f,{},c.availableImages,g,c.brightness);c.featureIndex.insert(p,k.geometry,I,D,this.index,z)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,c,f,g,p,x){for(const I of this.features){const D=UM[I.type]==="Polygon",{geometry:L}=I;if(this.wallMode)for(const T of L)for(const k of pB(T,D))this.addFeature(I,[k],I.index,c,f,g,p,x);else this.addFeature(I,L,I.index,c,f,g,p,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(o,c,f,g,p,x,I){this.programConfigurations.updatePaintArrays(o,c,p,f,g,x,I),this.groundEffect.update(o,c,p,f,g,x,I)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ire),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,Sre.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Cre.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Ere.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,f,g,p,x,I,D){const L=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,T=[new Ot(0,0),new Ot(sn,sn)],k=I.projection,z=k.name==="globe",O=this.wallMode||UM[o.type]==="Polygon",B=new yB;B.centroidDataIndex=this.centroidData.length;const U=new _B,X=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},g)<=0,J=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},g);let ce;if(U.height=J,U.vertexArrayOffset=this.layoutVertexArray.length,U.groundVertexArrayOffset=this.groundEffect.vertexArray.length,z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new n0),this.wallMode){if(z)return void Nr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;ce=function(Be){const Qe=Be[0].x===Be[Be.length-1].x&&Be[0].y===Be[Be.length-1].y;(function(ln){let Yt=0;const Zn=ln.length;for(let bn=0;bn<Zn;bn++)Yt+=(ln[(bn+1)%Zn].x-ln[bn].x)*(ln[(bn+1)%Zn].y+ln[bn].y);return Yt>=0})(Be)||(Be=Be.reverse());const Je={geometry:[],joinNormals:[],indices:[]},lt=[],st=[],mt=[];let pt=Be.length;for(;pt>=2&&Be[pt-1].equals(Be[pt-2]);)pt--;if(pt<(Qe?3:2))return Je;let vt,_t,Et,qt,Ht,Cn=0;for(;Cn<pt-1&&Be[Cn].equals(Be[Cn+1]);)Cn++;Qe&&(vt=Be[pt-2],Ht=Be[Cn].sub(vt)._unit()._perp());for(let ln=Cn;ln<pt;ln++){if(Et=ln===pt-1?Qe?Be[Cn+1]:void 0:Be[ln+1],Et&&Be[ln].equals(Et))continue;Ht&&(qt=Ht),vt&&(_t=vt),vt=Be[ln],Ht=Et?Et.sub(vt)._unit()._perp():qt,qt=qt||Ht;let Yt=qt.add(Ht);Yt.x===0&&Yt.y===0||Yt._unit();const Zn=Yt.x*Ht.x+Yt.y*Ht.y,bn=Zn!==0?1/Zn:1/0,Pn=qt.x*Ht.y-qt.y*Ht.x>0;let ar="miter";const Pr=2;ar==="miter"&&bn>Pr&&(ar="bevel"),ar==="bevel"&&(bn>100&&(ar="flipbevel"),bn<Pr&&(ar="miter"));const fr=(jr,Mr,Hr,gi)=>{const $i=new Ot(jr.x,jr.y),lr=new Ot(jr.x,jr.y);$i.x+=Mr.x*gi,$i.y+=Mr.y*gi,lr.x-=Mr.x*Math.max(Hr,1),lr.y-=Mr.y*Math.max(Hr,1),mt.push(Mr),lt.push($i),st.push(lr)};if(ar==="miter")Yt._mult(bn),fr(vt,Yt,0,0);else if(ar==="flipbevel")Yt=Ht.mult(-1),fr(vt,Yt,0,0),fr(vt,Yt.mult(-1),0,0);else{const jr=-Math.sqrt(bn*bn-1),Mr=Pn?jr:0,Hr=Pn?0:jr;_t&&fr(vt,qt,Mr,Hr),Et&&fr(vt,Ht,Mr,Hr)}}Je.geometry=[...lt,...st.reverse(),lt[0]],Je.joinNormals=[...mt,...mt.reverse(),mt[mt.length-1]];const Qt=Je.geometry.length-1;for(let ln=0;ln<Qt/2;ln++)if(ln+1<Qt/2){let Yt=ln,Zn=ln+1,bn=Qt-1-ln,Pn=Qt-2-ln;Yt=Yt===0?Qt-1:Yt-1,Zn=Zn===0?Qt-1:Zn-1,bn=bn===0?Qt-1:bn-1,Pn=Pn===0?Qt-1:Pn-1,Je.indices.push(bn),Je.indices.push(Zn),Je.indices.push(Yt),Je.indices.push(bn),Je.indices.push(Pn),Je.indices.push(Zn)}return Je}(c[0]),c=[ce.geometry]}const le=(Be,Qe)=>Be<(Qe.length-1)/2||Be===Qe.length-1,ie=this.wallMode?[c]:RE(c,500);for(let Be=ie.length-1;Be>=0;Be--){const Qe=ie[Be];(Qe.length===0||(ge=Qe[0]).every(Ue=>Ue.x<=0)||ge.every(Ue=>Ue.x>=sn)||ge.every(Ue=>Ue.y<=0)||ge.every(Ue=>Ue.y>=sn))&&ie.splice(Be,1)}var ge;let be;if(z)be=IB(ie,T,g);else{be=[];for(const Be of ie)be.push({polygon:Be,bounds:T})}const Se=O?this.edgeRadius:0,Ve=Se>0&&this.zoom<17,Le=(Be,Qe)=>{if(Be.length===0)return!1;const Ue=Be[Be.length-1];return Qe.x===Ue.x&&Qe.y===Ue.y};for(const{polygon:Be,bounds:Qe}of be){let Ue=0,Je=0;for(const pt of Be)O&&!pt[0].equals(pt[pt.length-1])&&pt.push(pt[0]),Je+=O?pt.length-1:pt.length;const lt=this.segments.prepareSegment((O?5:4)*Je,this.layoutVertexArray,this.indexArray);U.footprintSegIdx<0&&(U.footprintSegIdx=this.footprintSegments.length),U.polygonSegIdx<0&&(U.polygonSegIdx=this.polygonSegments.length);const st={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},mt=new gB;if(mt.vertexOffset=this.footprintVertices.length,mt.indexOffset=3*this.footprintIndices.length,mt.ringIndices=[],O){const pt=[],vt=[];Ue=lt.vertexLength;for(let Et=0;Et<Be.length;Et++){const qt=Be[Et];qt.length&&Et!==0&&vt.push(pt.length/2);const Ht=[];let Cn,Qt;Cn=qt[1].sub(qt[0])._perp()._unit(),mt.ringIndices.push(qt.length-1);for(let ln=1;ln<qt.length;ln++){const Yt=qt[ln],Zn=qt[ln===qt.length-1?1:ln+1],bn=Yt.clone();if(Se){Qt=Zn.sub(Yt)._perp()._unit();const Pn=Cn.add(Qt)._unit(),ar=Se*Math.min(4,1/(Cn.x*Pn.x+Cn.y*Pn.y));bn.x+=ar*Pn.x,bn.y+=ar*Pn.y,bn.x=Math.round(bn.x),bn.y=Math.round(bn.y),Cn=Qt}if(!X||Se!==0&&!Ve||Le(Ht,bn)||Ht.push(bn),K1(this.layoutVertexArray,bn.x,bn.y,0,0,1,1,0),this.wallMode){const Pn=le(ln,qt);Z1(this.wallVertexArray,ce.joinNormals[ln],!Pn)}lt.vertexLength++,this.footprintVertices.emplaceBack(Yt.x,Yt.y),pt.push(Yt.x,Yt.y),z&&Q1(this.layoutVertexExtArray,k.projectTilePoint(bn.x,bn.y,g),k.upVector(g,bn.x,bn.y))}X&&(Se===0||Ve)&&(Ht.length!==0&&Le(Ht,Ht[0])&&Ht.pop(),this.groundEffect.addData(Ht,Qe,L))}const _t=this.wallMode?ce.indices:q1(pt,vt);for(let Et=0;Et<_t.length;Et+=3)this.footprintIndices.emplaceBack(mt.vertexOffset+_t[Et+0],mt.vertexOffset+_t[Et+1],mt.vertexOffset+_t[Et+2]),this.indexArray.emplaceBack(Ue+_t[Et],Ue+_t[Et+2],Ue+_t[Et+1]),lt.primitiveLength++;mt.indexCount+=_t.length,mt.vertexCount+=this.footprintVertices.length-mt.vertexOffset}for(let pt=0;pt<Be.length;pt++){const vt=Be[pt];B.startRing(U,vt[0]);let _t=vt.length>4&&SB(vt[vt.length-2],vt[0],vt[1]),Et=Se?Ore(vt[vt.length-2],vt[0],vt[1],Se):0;const qt=[];let Ht,Cn,Qt;Cn=vt[1].sub(vt[0])._perp()._unit();let ln=!0;for(let Yt=1,Zn=0;Yt<vt.length;Yt++){let bn=vt[Yt-1],Pn=vt[Yt];const ar=vt[Yt===vt.length-1?1:Yt+1];if(B.appendEdge(U,Pn,bn),HM(Pn,bn,Qe)){Se&&(Cn=ar.sub(Pn)._perp()._unit(),ln=!ln);continue}const Pr=Pn.sub(bn)._perp(),fr=Pr.x/(Math.abs(Pr.x)+Math.abs(Pr.y)),jr=Pr.y>0?1:0,Mr=bn.dist(Pn);if(Zn+Mr>32768&&(Zn=0),Se){Qt=ar.sub(Pn)._perp()._unit();let lr=wB(bn,Pn,ar,bB(Cn,Qt),Se);isNaN(lr)&&(lr=0);const ti=Pn.sub(bn)._unit();bn=bn.add(ti.mult(Et))._round(),Pn=Pn.add(ti.mult(-lr))._round(),Et=lr,Cn=Qt,X&&this.zoom>=17&&(Le(qt,bn)||qt.push(bn),Le(qt,Pn)||qt.push(Pn))}const Hr=lt.vertexLength,gi=vt.length>4&&SB(bn,Pn,ar);let $i=TB(Zn,_t,ln);if(K1(this.layoutVertexArray,bn.x,bn.y,fr,jr,0,0,$i),K1(this.layoutVertexArray,bn.x,bn.y,fr,jr,0,1,$i),this.wallMode){const lr=le(Yt-1,vt),ti=ce.joinNormals[Yt-1];Z1(this.wallVertexArray,ti,lr),Z1(this.wallVertexArray,ti,lr)}if(Zn+=Mr,$i=TB(Zn,gi,!ln),_t=gi,K1(this.layoutVertexArray,Pn.x,Pn.y,fr,jr,0,0,$i),K1(this.layoutVertexArray,Pn.x,Pn.y,fr,jr,0,1,$i),this.wallMode){const lr=le(Yt,vt),ti=ce.joinNormals[Yt];Z1(this.wallVertexArray,ti,lr),Z1(this.wallVertexArray,ti,lr)}if(lt.vertexLength+=4,this.indexArray.emplaceBack(Hr+0,Hr+1,Hr+2),this.indexArray.emplaceBack(Hr+1,Hr+3,Hr+2),lt.primitiveLength+=2,Se){const lr=Ue+(Yt===1?vt.length-2:Yt-2),ti=Yt===1?Ue:lr+1;if(this.indexArray.emplaceBack(Hr+1,lr,Hr+3),this.indexArray.emplaceBack(lr,ti,Hr+3),lt.primitiveLength+=2,Ht===void 0&&(Ht=Hr),!HM(ar,vt[Yt],Qe)){const ms=Yt===vt.length-1?Ht:lt.vertexLength;this.indexArray.emplaceBack(Hr+2,Hr+3,ms),this.indexArray.emplaceBack(Hr+3,ms+1,ms),this.indexArray.emplaceBack(Hr+3,ti,ms+1),lt.primitiveLength+=3}ln=!ln}if(z){const lr=this.layoutVertexExtArray,ti=k.projectTilePoint(bn.x,bn.y,g),ms=k.projectTilePoint(Pn.x,Pn.y,g),Ss=k.upVector(g,bn.x,bn.y),ks=k.upVector(g,Pn.x,Pn.y);Q1(lr,ti,Ss),Q1(lr,ti,Ss),Q1(lr,ms,ks),Q1(lr,ms,ks)}}O&&(Ue+=vt.length-1),X&&Se&&this.zoom>=17&&(qt.length!==0&&Le(qt,qt[0])&&qt.pop(),this.groundEffect.addData(qt,Qe,L,Se>0))}this.footprintSegments.push(mt),st.triangleCount=this.indexArray.length-st.triangleArrayOffset,this.polygonSegments.push(st),++U.footprintSegLen,++U.polygonSegLen}if(U.vertexCount=this.layoutVertexArray.length-U.vertexArrayOffset,U.groundVertexCount=this.groundEffect.vertexArray.length-U.groundVertexArrayOffset,U.vertexCount!==0){if(U.centroidXY=B.borders?mB:this.encodeCentroid(B,U),this.centroidData.push(U),B.borders){this.featuresOnBorder.push(B);const Be=this.featuresOnBorder.length-1;for(let Qe=0;Qe<B.borders.length;Qe++)B.borders[Qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Qe].push(Be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,p,x,g,D),this.groundEffect.addPaintPropertiesData(o,f,p,x,g,D),this.maxHeight=Math.max(this.maxHeight,J)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((c,f)=>this.featuresOnBorder[c].borders[o][0]-this.featuresOnBorder[f].borders[o][0])}splitToSubtiles(){const o=[];for(let I=0;I<this.centroidData.length;I++){const D=this.centroidData[I],L=+(D.min.y+D.max.y>sn),T=2*L+(+(D.min.x+D.max.x>sn)^L);for(let k=0;k<D.polygonSegLen;k++){const z=D.polygonSegIdx+k;o.push({centroidIdx:I,subtile:T,polygonSegmentIdx:z,triangleSegmentIdx:this.polygonSegments[z].triangleSegIdx})}}const c=new la;o.sort((I,D)=>I.triangleSegmentIdx===D.triangleSegmentIdx?I.subtile-D.subtile:I.triangleSegmentIdx-D.triangleSegmentIdx);let f=0,g=0,p=0;for(const I of o){if(I.triangleSegmentIdx!==f)break;p++}const x=o.length;for(;g!==o.length;){f=o[g].triangleSegmentIdx;let I=0,D=g,L=g;for(let T=D;T<p&&o[T].subtile===I;T++)L++;for(;D!==p;){const T=o[D];I=T.subtile;const k=this.centroidData[T.centroidIdx].min.clone(),z=this.centroidData[T.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[f].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[f].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let B=D;B<L;B++){const U=o[B],X=this.polygonSegments[U.polygonSegmentIdx],J=this.centroidData[U.centroidIdx].min,ce=this.centroidData[U.centroidIdx].max,le=this.indexArray.uint16;for(let ie=X.triangleArrayOffset;ie<X.triangleArrayOffset+X.triangleCount;ie++)c.emplaceBack(le[3*ie],le[3*ie+1],le[3*ie+2]);O.primitiveLength+=X.triangleCount,k.x=Math.min(k.x,J.x),k.y=Math.min(k.y,J.y),z.x=Math.max(z.x,ce.x),z.y=Math.max(z.y,ce.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:k,max:z}),D=L;for(let B=D;B<p&&o[B].subtile===o[D].subtile;B++)L++}g=p;for(let T=g;T<x&&o[T].triangleSegmentIdx===o[g].triangleSegmentIdx;T++)p++}c._trim(),this.indexArray=c}getVisibleSegments(o,c,f){const g=new xs;if(this.wallMode){for(const U of this.triangleSubSegments)g.segments.push(U.segment);return g}let p=0,x=0;const I=1<<o.canonical.z;if(c){const U=c.getMinMaxForTile(o);U&&(p=U.min,x=U.max)}x+=this.maxHeight;const D=o.toUnwrapped();let L;const T=[D.canonical.x/I+D.wrap,D.canonical.y/I],k=[(D.canonical.x+1)/I+D.wrap,(D.canonical.y+1)/I],z=(U,X,J)=>[U[0]*(1-J[0])+X[0]*J[0],U[1]*(1-J[1])+X[1]*J[1]],O=[],B=[];for(const U of this.triangleSubSegments){O[0]=U.min.x/sn,O[1]=U.min.y/sn,B[0]=U.max.x/sn,B[1]=U.max.y/sn;const X=z(T,k,O),J=z(T,k,B);if(new Nn([X[0],X[1],p],[J[0],J[1],x]).intersectsPrecise(f)===0){L&&(g.segments.push(L),L=void 0);continue}const ce=U.segment;L&&L.vertexOffset!==ce.vertexOffset&&(g.segments.push(L),L=void 0),L?(L.vertexLength+=ce.vertexLength,L.primitiveLength+=ce.primitiveLength):L={vertexOffset:ce.vertexOffset,primitiveLength:ce.primitiveLength,vertexLength:ce.vertexLength,primitiveOffset:ce.primitiveOffset,sortKey:void 0,vaos:{}}}return L&&g.segments.push(L),g}encodeCentroid(o,c){const f=o.centroid(),g=c.span(),p=Math.min(7,Math.round(g.x*this.tileToMeter/10)),x=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new Ot(Bn(f.x,1,sn-1)<<3|p,Bn(f.y,1,sn-1)<<3|x)}encodeBorderCentroid(o){if(!o.borders)return new Ot(0,0);const c=o.borders,f=Number.MAX_VALUE;if(c[0][0]!==f||c[1][0]!==f){const g=c[0][0]!==f?0:1;return new Ot(6|(c[0][0]!==f?0:65528),(c[g][0]+c[g][1])/2<<3|6)}{const g=c[2][0]!==f?2:3;return new Ot((c[g][0]+c[g][1])/2<<3|6,6|(c[2][0]!==f?0:65528))}}showCentroid(o){const c=this.centroidData[o.centroidDataIndex];c.flags&=_p,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const c=o.vertexArrayOffset,f=o.vertexCount+o.vertexArrayOffset,g=o.flags&_p?mB:o.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==g.y||p!==g.x){for(let x=c;x<f;++x)this.centroidVertexArray.emplace(x,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,c,f){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(o.toUnwrapped());if(jM(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const p=[];for(const x of this.activeReplacements){if(x.order<f)continue;const I=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-o.canonical.z));for(const D of this.centroidData)if(!(D.flags&_p||x.min.x>D.max.x||D.min.x>x.max.x||x.min.y>D.max.y||D.min.y>x.max.y))for(let L=0;L<D.footprintSegLen;L++){const T=this.footprintSegments[D.footprintSegIdx+L];if(p.length=0,Lre(this.footprintVertices,T.vertexOffset,T.vertexCount,x.footprintTileId.canonical,o.canonical,p),uB(x.footprint,p,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-I)){D.flags|=_p;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,c,f){let g=!1;for(let p=0;p<f.footprintSegLen;p++){const x=this.footprintSegments[f.footprintSegIdx+p];let I=0;for(const D of x.ringIndices){for(let L=I,T=D+I-1;L<D+I;T=L++){const k=this.footprintVertices.int16[2*(L+x.vertexOffset)+0],z=this.footprintVertices.int16[2*(L+x.vertexOffset)+1],O=this.footprintVertices.int16[2*(T+x.vertexOffset)+1];z>c!=O>c&&o<(this.footprintVertices.int16[2*(T+x.vertexOffset)+0]-k)*(c-z)/(O-z)+k&&(g=!g)}I=D}}return g}getHeightAtTileCoord(o,c){let f=Number.NEGATIVE_INFINITY,g=!0;const p=4*(o+sn)*sn+(c+sn);if(this.partLookup.hasOwnProperty(p)){const x=this.partLookup[p];return x?{height:x.height,hidden:!!(x.flags&_p)}:void 0}for(const x of this.centroidData)o>x.max.x||x.min.x>o||c>x.max.y||x.min.y>c||this.footprintContainsPoint(o,c,x)&&x&&x.height>f&&(f=x.height,this.partLookup[p]=x,g=!!(x.flags&_p));if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:g};this.partLookup[p]=void 0}}function bB(d,o){const c=d.add(o)._unit();return d.x*c.x+d.y*c.y}function Ore(d,o,c,f){const g=o.sub(d)._perp()._unit(),p=c.sub(o)._perp()._unit();return wB(d,o,c,bB(g,p),f)}function wB(d,o,c,f,g){const p=Math.sqrt(1-f*f);return Math.min(d.dist(o)/3,o.dist(c)/3,g*p/f)}function HM(d,o,c){return d.x<c[0].x&&o.x<c[0].x||d.x>c[1].x&&o.x>c[1].x||d.y<c[0].y&&o.y<c[0].y||d.y>c[1].y&&o.y>c[1].y}function EB(d,o){return d.x<o[0].x||d.x>o[1].x||d.y<o[0].y||d.y>o[1].y}function SB(d,o,c){if(d.x<0||d.x>=sn||o.x<0||o.x>=sn||c.x<0||c.x>=sn)return!1;const f=c.sub(o),g=f.perp(),p=d.sub(o);return(f.x*p.x+f.y*p.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(p.x*p.x+p.y*p.y))>-.866&&g.x*p.x+g.y*p.y<0}function TB(d,o,c){const f=o?2|d:-3&d;return c?1|f:-2&f}function CB(){const d=Math.PI/32,o=Math.tan(d),c=Yd;return c*Math.sqrt(1+2*o*o)-c}function IB(d,o,c){const f=1<<c.z,g=Bl(c.x/f),p=Bl((c.x+1)/f),x=ca(c.y/f),I=ca((c.y+1)/f);return function(D,L,T,k,z=0,O){const B=[];if(!D.length||!T||!k)return B;const U=(be,Se)=>{for(const Ve of be)B.push({polygon:Ve,bounds:Se})},X=Math.ceil(Math.log2(T)),J=Math.ceil(Math.log2(k)),ce=X-J,le=[];for(let be=0;be<Math.abs(ce);be++)le.push(ce>0?0:1);for(let be=0;be<Math.min(X,J);be++)le.push(0),le.push(1);let ie=D;if(ie=PE(ie,L[0].y-z,L[1].y+z,1),ie=PE(ie,L[0].x-z,L[1].x+z,0),!ie.length)return B;const ge=[];for(le.length?ge.push({polygons:ie,bounds:L,depth:0}):U(ie,L);ge.length;){const be=ge.pop(),Se=be.depth,Ve=le[Se],Le=be.bounds[0],Be=be.bounds[1],Qe=Ve===0?Le.x:Le.y,Ue=Ve===0?Be.x:Be.y,Je=O?O(Ve,Qe,Ue):.5*(Qe+Ue),lt=PE(be.polygons,Qe-z,Je+z,Ve),st=PE(be.polygons,Je-z,Ue+z,Ve);if(lt.length){const mt=[Le,new Ot(Ve===0?Je:Be.x,Ve===1?Je:Be.y)];le.length>Se+1?ge.push({polygons:lt,bounds:mt,depth:Se+1}):U(lt,mt)}if(st.length){const mt=[new Ot(Ve===0?Je:Le.x,Ve===1?Je:Le.y),Be];le.length>Se+1?ge.push({polygons:st,bounds:mt,depth:Se+1}):U(st,mt)}}return B}(d,o,Math.ceil((p-g)/11.25),Math.ceil((x-I)/11.25),1,(D,L,T)=>{if(D===0)return .5*(L+T);{const k=ca((c.y+L/sn)/f);return(Ca(.5*(ca((c.y+T/sn)/f)+k))*f-c.y)*sn}})}function Lre(d,o,c,f,g,p){const x=Math.pow(2,f.z-g.z);for(let I=0;I<c;I++){let D=d.int16[2*(I+o)+0],L=d.int16[2*(I+o)+1];D=(D+g.x*sn)*x-f.x*sn,L=(L+g.y*sn)*x-f.y*sn,p.push(new Ot(D,L))}}let AB,RB;function J1(d,o){return d.x*o.x+d.y*o.y}function MB(d,o){if(d.length===1){let c=0;const f=o[c++];let g;for(;!g||f.equals(g);)if(g=o[c++],!g)return 1/0;for(;c<o.length;c++){const p=o[c],x=d[0],I=g.sub(f),D=p.sub(f),L=x.sub(f),T=J1(I,I),k=J1(I,D),z=J1(D,D),O=J1(L,I),B=J1(L,D),U=T*z-k*k,X=(z*O-k*B)/U,J=(T*B-k*O)/U,ce=f.z*(1-X-J)+g.z*X+p.z*J;if(isFinite(ce))return ce}return 1/0}{let c=1/0;for(const f of o)c=Math.min(c,f.z);return c}}function PB(d,o,c,f,g,p,x,I){const D=x*g.getElevationAt(d,o,!0,!0),L=p[0]!==0,T=L?p[1]===0?x*(p[0]/7-450):x*function(k,z,O){const B=Math.floor(z[0]/8),U=Math.floor(z[1]/8),X=10*(z[0]-8*B),J=10*(z[1]-8*U),ce=k.getElevationAt(B,U,!0,!0),le=k.getMeterToDEM(O),ie=Math.floor(.5*(X*le-1)),ge=Math.floor(.5*(J*le-1)),be=k.tileCoordToPixel(B,U),Se=2*ie+1,Ve=2*ge+1,Le=function(st,mt,pt,vt,_t){return[st.getElevationAtPixel(mt,pt,!0),st.getElevationAtPixel(mt+_t,pt,!0),st.getElevationAtPixel(mt,pt+_t,!0),st.getElevationAtPixel(mt+vt,pt+_t,!0)]}(k,be.x-ie,be.y-ge,Se,Ve),Be=Math.abs(Le[0]-Le[1]),Qe=Math.abs(Le[2]-Le[3]),Ue=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),Je=Math.min(.25,.5*le*(Be+Qe)/Se),lt=Math.min(.25,.5*le*Ue/Ve);return ce+Math.max(Je*X,lt*J)}(g,p,I):D;return{base:D+(c===0?-1:c),top:L?Math.max(T+f,D+c+2):D+f}}Tn(OE,"FillExtrusionBucket",{omit:["layers","features"]}),Tn(_B,"PartData"),Tn(gB,"FootprintSegment"),Tn(yB,"BorderCentroidData"),Tn(vB,"GroundEffect");const Fre=yi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Bre=yi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:zre}=Fre,jre=yi([{name:"a_packed",components:3,type:"Float32"}]),{members:Vre}=jre,Ure=yi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Hre}=Ure;class DB{constructor(o,c){this.width=o,this.height=c,this.nextRow=0,this.image=new mp({width:o,height:c}),this.positions={},this.uploaded=!1}getDash(o,c){const f=this.getKey(o,c);return this.positions[f]}trim(){const o=this.width,c=this.height=Tr(this.nextRow);this.image.resize({width:o,height:c})}getKey(o,c){return o.join(",")+c}getDashRanges(o,c,f){const g=[];let p=o.length%2==1?-o[o.length-1]*f:0,x=o[0]*f,I=!0;g.push({left:p,right:x,isDash:I,zeroLength:o[0]===0});let D=o[0];for(let L=1;L<o.length;L++){I=!I;const T=o[L];p=D*f,D+=T,x=D*f,g.push({left:p,right:x,isDash:I,zeroLength:T===0})}return g}addRoundDash(o,c,f){const g=c/2;for(let p=-f;p<=f;p++){const x=this.width*(this.nextRow+f+p);let I=0,D=o[I];for(let L=0;L<this.width;L++){L/D.right>1&&(D=o[++I]);const T=Math.abs(L-D.left),k=Math.abs(L-D.right),z=Math.min(T,k);let O;const B=p/f*(g+1);if(D.isDash){const U=g-Math.abs(B);O=Math.sqrt(z*z+U*U)}else O=g-Math.sqrt(z*z+B*B);this.image.data[x+L]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(o,c){for(let D=o.length-1;D>=0;--D){const L=o[D],T=o[D+1];L.zeroLength?o.splice(D,1):T&&T.isDash===L.isDash&&(T.left=L.left,o.splice(D,1))}const f=o[0],g=o[o.length-1];f.isDash===g.isDash&&(f.left=g.left-this.width,g.right=f.right+this.width);const p=this.width*this.nextRow;let x=0,I=o[x];for(let D=0;D<this.width;D++){D/I.right>1&&(I=o[++x]);const L=Math.abs(D-I.left),T=Math.abs(D-I.right),k=Math.min(L,T);this.image.data[p+D]=Math.max(0,Math.min(255,(I.isDash?k:-k)+c+128))}}addDash(o,c){const f=this.getKey(o,c);if(this.positions[f])return this.positions[f];const g=c==="round",p=g?7:0,x=2*p+1;if(this.nextRow+x>this.height)return Nr("LineAtlas out of space"),null;o.length===0&&o.push(1);let I=0;for(let T=0;T<o.length;T++)o[T]<0&&(Nr("Negative value is found in line dasharray, replacing values with 0"),o[T]=0),I+=o[T];if(I!==0){const T=this.width/I,k=this.getDashRanges(o,this.width,T);g?this.addRoundDash(k,T,p):this.addRegularDash(k,c==="square"?.5*T:0)}const D=this.nextRow+p;this.nextRow+=x;const L={tl:[D,p],br:[I,0]};return this.positions[f]=L,L}}Tn(DB,"LineAtlas");const Wre=gp.VectorTileFeature.types,$re=Math.cos(Math.PI/180*37.5),qre=Math.cos(Math.PI/180*5);class WM{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new T1,this.layoutVertexArray2=new Jc,this.patternVertexArray=new Jc,this.indexArray=new la,this.programConfigurations=new ed(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new xs,this.maxLineLength=0,this.zOffsetVertexArray=new Jc,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:sn/64}updateFootprints(o,c){}populate(o,c,f,g){this.hasPattern=MM("line",this.layers,this.pixelRatio,c);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=y(f);const x=this.layers[0].layout.get("line-z-offset"),I=x.isConstant()&&!x.constantOr(0),D=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=D==="sea"||D==="ground"||!I&&D==="none",this.hasZOffset&&D==="none"&&Nr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const L=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&L!==void 0;const T=[];for(const{feature:B,id:U,index:X,sourceLayerIndex:J}of o){const ce=this.layers[0]._featureFilter.needGeometry,le=Y(B,ce);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),le,f))continue;const ie=p?p.evaluate(le,{},f):void 0,ge={id:U,properties:B.properties,type:B.type,sourceLayerIndex:J,index:X,geometry:ce?le.geometry:G(B,f,g),patterns:{},sortKey:ie};T.push(ge)}p&&T.sort((B,U)=>B.sortKey-U.sortKey);const{lineAtlas:k,featureIndex:z}=c,O=this.addConstantDashes(k);for(const B of T){const{geometry:U,index:X,sourceLayerIndex:J}=B;if(O&&this.addFeatureDashes(B,k),this.hasPattern){const ce=PM("line",this.layers,B,this.zoom,this.pixelRatio,c);this.patternFeatures.push(ce)}else this.addFeature(B,U,X,f,k.positions,c.availableImages,c.brightness);z.insert(o[X].feature,U,X,J,this.index)}}addConstantDashes(o){let c=!1;for(const f of this.layers){const g=f.paint.get("line-dasharray").value,p=f.layout.get("line-cap").value;if(g.kind!=="constant"||p.kind!=="constant")c=!0;else{const x=p.value,I=g.value;if(!I)continue;o.addDash(I,x)}}return c}addFeatureDashes(o,c){const f=this.zoom;for(const g of this.layers){const p=g.paint.get("line-dasharray").value,x=g.layout.get("line-cap").value;if(p.kind==="constant"&&x.kind==="constant")continue;let I,D;if(p.kind==="constant"){if(I=p.value,!I)continue}else I=p.evaluate({zoom:f},o);D=x.kind==="constant"?x.value:x.evaluate({zoom:f},o),c.addDash(I,D),o.patterns[g.id]=c.getKey(I,D)}}update(o,c,f,g,p,x,I){this.programConfigurations.updatePaintArrays(o,c,p,f,g,x,I)}addFeatures(o,c,f,g,p,x){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,c,f,g,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Vre)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,Hre)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,Bre.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,zre),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,f,g,p,x,I){const D=this.layers[0].layout,L=D.get("line-join").evaluate(o,{}),T=D.get("line-cap").evaluate(o,{}),k=D.get("line-miter-limit"),z=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o,this.zOffsetValue=D.get("line-z-offset").value;const O=this.layers[0].paint.get("line-width").value;O.kind!=="constant"&&O.isLineProgressConstant===!1&&(this.variableWidthValue=O);for(const B of c)this.addLine(B,o,g,L,T,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,p,x,g,I)}addLine(o,c,f,g,p,x,I){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const D=g==="none";if(this.patternJoinNone=this.hasPattern&&D,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<o.length-1;le++)this.totalDistance+=o[le].dist(o[le+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=Wre[c.type]==="Polygon";let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let k=0;for(;k<T-1&&o[k].equals(o[k+1]);)k++;if(T<(L?3:2))return;g==="bevel"&&(x=1.05);const z=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let O,B,U,X,J,ce;this.e1=this.e2=-1,L&&(O=o[T-2],J=o[k].sub(O)._unit()._perp());for(let le=k;le<T;le++){if(U=le===T-1?L?o[k+1]:void 0:o[le+1],U&&o[le].equals(U))continue;J&&(X=J),O&&(B=O),O=o[le],ce=this.evaluateLineProgressFeatures(B?B.dist(O):0),J=U?U.sub(O)._unit()._perp():X,X=X||J;const ie=B&&U;let ge=ie?g:L||D?"butt":p;const be=X.x*J.x+X.y*J.y;if(D){const lt=function(st){if(st.patternJoinNone){const mt=st.segmentPoints.length/2,pt=st.lineSoFar-st.segmentStart;for(let vt=0;vt<mt;++vt){const _t=st.segmentPoints[2*vt+1],Et=Math.round(st.segmentPoints[2*vt])+.5+.25*_t;st.patternVertexArray.emplaceBack(Et,pt,st.segmentStart),st.patternVertexArray.emplaceBack(Et,pt,st.segmentStart)}st.segmentPoints.length=0}st.e1=st.e2=-1};if(ie&&be<qre){this.updateDistance(B,O),this.addCurrentVertex(O,X,1,1,z,ce),lt(this),this.addCurrentVertex(O,J,-1,-1,z,ce);continue}if(B){if(!U){this.updateDistance(B,O),this.addCurrentVertex(O,X,1,1,z,ce),lt(this);continue}ge="miter"}}let Se=X.add(J);Se.x===0&&Se.y===0||Se._unit();const Ve=Se.x*J.x+Se.y*J.y,Le=Ve!==0?1/Ve:1/0,Be=2*Math.sqrt(2-2*Ve),Qe=Ve<$re&&B&&U,Ue=X.x*J.y-X.y*J.x>0,Je=this.overscaling<=16?15*sn/(512*this.overscaling):0;if(ie&&ge==="round"){if(Le<I)ge="miter";else if(Le<=2){const lt=$M(O,-10,sn+10);ge=this.hasZOffset&&(lt||this.hasCrossSlope)?"miter":"fakeround"}}if(ge==="miter"&&Le>x&&(ge="bevel"),ge==="bevel"&&(Le>2&&(ge="flipbevel"),Le<x&&(ge="miter")),B&&!(ge==="miter"&&Qe)&&this.updateDistance(B,O),ge==="miter")if(Qe){const lt=O.dist(B);if(lt>2*Je){const mt=O.sub(O.sub(B)._mult(Je/lt)._round());this.updateDistance(B,mt),this.addCurrentVertex(mt,X,0,0,z,ce),B=mt}this.updateDistance(B,O),Se._mult(Le),this.addCurrentVertex(O,Se,0,0,z,ce);const st=O.dist(U);if(st>2*Je){const mt=O.add(U.sub(O)._mult(Je/st)._round());this.updateDistance(O,mt),this.addCurrentVertex(mt,J,0,0,z,ce),O=mt}}else Se._mult(Le),this.addCurrentVertex(O,Se,0,0,z,ce);else if(ge==="flipbevel"){if(Le>100)Se=J.mult(-1);else{const lt=Le*X.add(J).mag()/X.sub(J).mag();Se._perp()._mult(lt*(Ue?-1:1))}this.addCurrentVertex(O,Se,0,0,z,ce),this.addCurrentVertex(O,Se.mult(-1),0,0,z,ce)}else if(ge==="bevel"||ge==="fakeround"){ce!=null&&B&&this.addCurrentVertex(O,X,-1,-1,z,ce);const lt=O.dist(B)<=2*Je&&ge!=="bevel",st=Se.mult(Ue?1:-1);st._mult(Le);const mt=J.mult(Ue?-1:1),pt=X.mult(Ue?-1:1),vt=this.evaluateLineProgressFeatures(this.distance);if(ce==null&&(this.addHalfVertex(O,st.x,st.y,!1,!Ue,0,z,vt),lt||this.addHalfVertex(O,st.x+2*pt.x,st.y+2*pt.y,!1,Ue,0,z,vt)),ge==="fakeround"){const _t=Math.round(180*Be/Math.PI/20);this.addHalfVertex(O,pt.x,pt.y,!1,Ue,0,z,vt);for(let Et=0;Et<_t;Et++){let qt=Et/_t;if(qt!==.5){const Cn=qt-.5;qt+=qt*Cn*(qt-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*Cn*Cn+(.848013+be*(.215638*be-1.06021)))}const Ht=mt.sub(pt)._mult(qt)._add(pt)._unit();this.addHalfVertex(O,Ht.x,Ht.y,!1,Ue,0,z,vt)}this.addHalfVertex(O,mt.x,mt.y,!1,Ue,0,z,vt)}lt||ce!=null||this.addHalfVertex(O,st.x+2*mt.x,st.y+2*mt.y,!1,Ue,0,z,vt),ce!=null&&U&&this.addCurrentVertex(O,J,1,1,z,ce)}else ge==="butt"?this.addCurrentVertex(O,Se,0,0,z,ce):ge==="square"?(B||this.addCurrentVertex(O,Se,-1,-1,z,ce),this.addCurrentVertex(O,Se,0,0,z,ce),B&&this.addCurrentVertex(O,Se,1,1,z,ce)):ge==="round"&&(B&&(this.addCurrentVertex(O,X,0,0,z,ce),this.addCurrentVertex(O,X,1,1,z,ce,!0)),U&&(this.addCurrentVertex(O,J,-1,-1,z,ce,!0),this.addCurrentVertex(O,J,0,0,z,ce)))}}addVerticesTo(o,c,f,g,p,x,I,D,L,T){const k=(c.w-o.w)/this.tessellationStep|0;let z=0;const O=this.scaledDistance;if(k>1){this.lineSoFar=o.w;const U=(c.x-o.x)/k,X=(c.y-o.y)/k,J=(c.z-o.z)/k,ce=(c.w-o.w)/k;for(let le=1;le<k;++le){o.x+=U,o.y+=X,o.z+=J,this.lineSoFar+=ce,z+=ce;const ie=this.evaluateLineProgressFeatures(this.prevDistance+z);this.scaledDistance=(this.prevDistance+z)/this.totalDistance,this.addHalfVertex(o,f,g,T,!1,I,L,ie),this.addHalfVertex(o,p,x,T,!0,-D,L,ie)}}this.lineSoFar=c.w,this.scaledDistance=O;const B=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,f,g,T,!1,I,L,B),this.addHalfVertex(c,p,x,T,!0,-D,L,B)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):Nr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}:{zOffset:0,variableWidth:c}}addCurrentVertex(o,c,f,g,p,x,I=!1){const D=c.x+c.y*f,L=c.y-c.x*f,T=c.y*g-c.x,k=-c.y-c.x*g;if(x!=null){const z=this.hasZOffset,O=-10,B=sn+10,U=x.zOffset,X=new iB(o.x,o.y,U,this.lineSoFar),J=!!z&&$M(o,O,B),ce=this.lineSoFar,le=this.distance;if(this.currentVertex)if(J){const ie=this.currentVertexIsOutside,ge=this.currentVertex,be=new iB(o.x,o.y,U,this.lineSoFar);if(oB(ge,be,O,B),!$M(be,O,B)){if(ie){this.e1=this.e2=-1,this.distance-=ge.dist(X),this.lineSoFar=ge.w;const Se=this.evaluateLineProgressFeatures(ge.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ge,D,L,I,!1,f,p,Se),this.addHalfVertex(ge,T,k,I,!0,-g,p,Se),this.prevDistance=this.distance}this.distance=this.prevDistance+ge.dist(be),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ge,be,D,L,T,k,f,g,p,I),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const ie=this.currentVertex;if(this.currentVertexIsOutside){oB(ie,X,O,B),this.e1=this.e2=-1,this.distance-=ie.dist(X),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ie.w;const ge=this.evaluateLineProgressFeatures(ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ie,D,L,I,!1,f,p,ge),this.addHalfVertex(ie,T,k,I,!0,-g,p,ge),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ie,X,D,L,T,k,f,g,p,I)}else J||(this.addHalfVertex(o,D,L,I,!1,f,p,x),this.addHalfVertex(o,T,k,I,!0,-g,p,x));this.currentVertex=X,this.currentVertexIsOutside=J,this.lineSoFar=ce}else this.addHalfVertex(o,D,L,I,!1,f,p,x),this.addHalfVertex(o,T,k,I,!0,-g,p,x)}addHalfVertex({x:o,y:c},f,g,p,x,I,D,L){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,I)),this.layoutVertexArray.emplaceBack((o<<1)+(p?1:0),(c<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(I===0?0:I<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const k=Wn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,k)}const T=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),D.primitiveLength++),x?this.e2=T:this.e1=T,L!=null&&this.zOffsetVertexArray.emplaceBack(L.zOffset,L.variableWidth,L.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,c){this.prevDistance=this.distance,this.distance+=o.dist(c),this.updateScaledDistance()}}function $M(d,o,c){return d.x<o||d.x>c||d.y<o||d.y>c}let kB,NB;function OB(d,o,c){return o*(sn/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}Tn(WM,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const LB=(d,o,c)=>(1-c)*d+c*o;function FB(d,o){return 1/OB(d,1,o.tileZoom)}function BB(d,o,c,f){return d.translatePosMatrix(f||o.tileID.projMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const zB=d=>{const o=[];jB(d)&&o.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const c=d.paint.get("line-trim-offset");c[0]===0&&c[1]===0||o.push("RENDER_LINE_TRIM_OFFSET"),d.paint.get("line-border-width").constantOr(1)!==0&&o.push("RENDER_LINE_BORDER");const f=d.layout.get("line-join").constantOr("miter")==="none",g=!!d.paint.get("line-pattern").constantOr(1);return f&&g&&o.push("LINE_JOIN_NONE"),o};function jB(d){const o=d.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}let qM;const VB=()=>qM||(qM={layout:kB||(kB=new Ds({"line-cap":new Sn(St.layout_line["line-cap"]),"line-join":new Sn(St.layout_line["line-join"]),"line-miter-limit":new on(St.layout_line["line-miter-limit"]),"line-round-limit":new on(St.layout_line["line-round-limit"]),"line-sort-key":new Sn(St.layout_line["line-sort-key"]),"line-z-offset":new Sn(St.layout_line["line-z-offset"]),"line-elevation-reference":new on(St.layout_line["line-elevation-reference"]),"line-cross-slope":new on(St.layout_line["line-cross-slope"]),visibility:new on(St.layout_line.visibility),"line-width-unit":new on(St.layout_line["line-width-unit"])})),paint:NB||(NB=new Ds({"line-opacity":new Sn(St.paint_line["line-opacity"]),"line-color":new Sn(St.paint_line["line-color"]),"line-translate":new on(St.paint_line["line-translate"]),"line-translate-anchor":new on(St.paint_line["line-translate-anchor"]),"line-width":new Sn(St.paint_line["line-width"]),"line-gap-width":new Sn(St.paint_line["line-gap-width"]),"line-offset":new Sn(St.paint_line["line-offset"]),"line-blur":new Sn(St.paint_line["line-blur"]),"line-dasharray":new Sn(St.paint_line["line-dasharray"]),"line-pattern":new Sn(St.paint_line["line-pattern"]),"line-gradient":new sp(St.paint_line["line-gradient"]),"line-trim-offset":new on(St.paint_line["line-trim-offset"]),"line-trim-fade-range":new on(St.paint_line["line-trim-fade-range"]),"line-trim-color":new on(St.paint_line["line-trim-color"]),"line-emissive-strength":new on(St.paint_line["line-emissive-strength"]),"line-border-width":new Sn(St.paint_line["line-border-width"]),"line-border-color":new Sn(St.paint_line["line-border-color"]),"line-occlusion-opacity":new on(St.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},qM);class Gre extends Sn{possiblyEvaluate(o,c){return c=new Wi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition}),super.possiblyEvaluate(o,c)}evaluate(o,c,f,g){return c=Oi({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(o,c,f,g)}}let ev;function UB(d,o){return o>0?o+2*d:d}const Yre=yi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xre=yi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Kre=yi([{name:"a_projected_pos",components:4,type:"Float32"}],4);yi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zre=yi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Qre=yi([{name:"a_texb",components:2,type:"Uint16"}]),Jre=yi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),eie=yi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const HB=yi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tie=yi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);yi([{name:"triangle",components:3,type:"Uint16"}]),yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),yi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),yi([{type:"Float32",name:"offsetX"}]),yi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ra=24;const hh=128;function WB(d,o,c,f,g){if(d.kind==="camera")return d.maxSize;if(d.kind==="composite"){const p=o.possiblyEvaluate(new Wi(d.maxZoom),c).evaluate(g,{},c),x=o.possiblyEvaluate(new Wi(d.minZoom),c).evaluate(g,{},c);return Math.max(p,x)}return o.possiblyEvaluate(new Wi(f)).evaluate(g,{},c)}function GM(d,o){const{expression:c}=o;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Wi(d+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=c;let p=0;for(;p<f.length&&f[p]<=d;)p++;p=Math.max(0,p-1);let x=p;for(;x<f.length&&f[x]<d+1;)x++;x=Math.min(f.length-1,x);const I=f[p],D=f[x];return c.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:g}:{kind:"camera",minZoom:I,maxZoom:D,minSize:c.evaluate(new Wi(I)),maxSize:c.evaluate(new Wi(D)),interpolationType:g}}}function LE(d,{uSize:o,uSizeT:c},{lowerSize:f,upperSize:g}){return d.kind==="source"?f/hh:d.kind==="composite"?Wn(f/hh,g/hh,c):o}function g0(d,o,c=1){let f=0,g=0;if(d.kind==="constant")g=d.layoutSize*c;else if(d.kind!=="source"){const{interpolationType:p,minZoom:x,maxZoom:I}=d,D=p?Bn(lc.interpolationFactor(p,o,x,I),0,1):0;d.kind==="camera"?g=Wn(d.minSize,d.maxSize,D)*c:f=D*c}return{uSizeT:f,uSize:g}}var nie=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:hh,evaluateSizeForFeature:LE,evaluateSizeForZoom:g0,getRasterizedIconSize:WB,getSizeData:GM});function rie(d,o,c){return d.sections.forEach(f=>{f.text=function(g,p,x){const I=p.layout.get("text-transform").evaluate(x,{});return I==="uppercase"?g=g.toLocaleUpperCase():I==="lowercase"&&(g=g.toLocaleLowerCase()),Rc.applyArabicShaping&&(g=Rc.applyArabicShaping(g)),g}(f.text,o,c)}),d}const tv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function iie(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}function sie(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}var $B,YM,qB,XM={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function oie(){return $B||($B=1,XM.read=function(d,o,c,f,g){var p,x,I=8*g-f-1,D=(1<<I)-1,L=D>>1,T=-7,k=c?g-1:0,z=c?-1:1,O=d[o+k];for(k+=z,p=O&(1<<-T)-1,O>>=-T,T+=I;T>0;p=256*p+d[o+k],k+=z,T-=8);for(x=p&(1<<-T)-1,p>>=-T,T+=f;T>0;x=256*x+d[o+k],k+=z,T-=8);if(p===0)p=1-L;else{if(p===D)return x?NaN:1/0*(O?-1:1);x+=Math.pow(2,f),p-=L}return(O?-1:1)*x*Math.pow(2,p-f)},XM.write=function(d,o,c,f,g,p){var x,I,D,L=8*p-g-1,T=(1<<L)-1,k=T>>1,z=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=f?0:p-1,B=f?1:-1,U=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,x=T):(x=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-x))<1&&(x--,D*=2),(o+=x+k>=1?z/D:z*Math.pow(2,1-k))*D>=2&&(x++,D/=2),x+k>=T?(I=0,x=T):x+k>=1?(I=(o*D-1)*Math.pow(2,g),x+=k):(I=o*Math.pow(2,k-1)*Math.pow(2,g),x=0));g>=8;d[c+O]=255&I,O+=B,I/=256,g-=8);for(x=x<<g|I,L+=g;L>0;d[c+O]=255&x,O+=B,x/=256,L-=8);d[c+O-B]|=128*U}),XM}function GB(){if(qB)return YM;qB=1,YM=o;var d=oie();function o(ie){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ie)?ie:new Uint8Array(ie||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var c=4294967296,f=1/c,g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function p(ie){return ie.type===o.Bytes?ie.readVarint()+ie.pos:ie.pos+1}function x(ie,ge,be){return be?4294967296*ge+(ie>>>0):4294967296*(ge>>>0)+(ie>>>0)}function I(ie,ge,be){var Se=ge<=16383?1:ge<=2097151?2:ge<=268435455?3:Math.floor(Math.log(ge)/(7*Math.LN2));be.realloc(Se);for(var Ve=be.pos-1;Ve>=ie;Ve--)be.buf[Ve+Se]=be.buf[Ve]}function D(ie,ge){for(var be=0;be<ie.length;be++)ge.writeVarint(ie[be])}function L(ie,ge){for(var be=0;be<ie.length;be++)ge.writeSVarint(ie[be])}function T(ie,ge){for(var be=0;be<ie.length;be++)ge.writeFloat(ie[be])}function k(ie,ge){for(var be=0;be<ie.length;be++)ge.writeDouble(ie[be])}function z(ie,ge){for(var be=0;be<ie.length;be++)ge.writeBoolean(ie[be])}function O(ie,ge){for(var be=0;be<ie.length;be++)ge.writeFixed32(ie[be])}function B(ie,ge){for(var be=0;be<ie.length;be++)ge.writeSFixed32(ie[be])}function U(ie,ge){for(var be=0;be<ie.length;be++)ge.writeFixed64(ie[be])}function X(ie,ge){for(var be=0;be<ie.length;be++)ge.writeSFixed64(ie[be])}function J(ie,ge){return(ie[ge]|ie[ge+1]<<8|ie[ge+2]<<16)+16777216*ie[ge+3]}function ce(ie,ge,be){ie[be]=ge,ie[be+1]=ge>>>8,ie[be+2]=ge>>>16,ie[be+3]=ge>>>24}function le(ie,ge){return(ie[ge]|ie[ge+1]<<8|ie[ge+2]<<16)+(ie[ge+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(ie,ge,be){for(be=be||this.length;this.pos<be;){var Se=this.readVarint(),Ve=Se>>3,Le=this.pos;this.type=7&Se,ie(Ve,ge,this),this.pos===Le&&this.skip(Se)}return ge},readMessage:function(ie,ge){return this.readFields(ie,ge,this.readVarint()+this.pos)},readFixed32:function(){var ie=J(this.buf,this.pos);return this.pos+=4,ie},readSFixed32:function(){var ie=le(this.buf,this.pos);return this.pos+=4,ie},readFixed64:function(){var ie=J(this.buf,this.pos)+J(this.buf,this.pos+4)*c;return this.pos+=8,ie},readSFixed64:function(){var ie=J(this.buf,this.pos)+le(this.buf,this.pos+4)*c;return this.pos+=8,ie},readFloat:function(){var ie=d.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ie},readDouble:function(){var ie=d.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ie},readVarint:function(ie){var ge,be,Se=this.buf;return ge=127&(be=Se[this.pos++]),be<128?ge:(ge|=(127&(be=Se[this.pos++]))<<7,be<128?ge:(ge|=(127&(be=Se[this.pos++]))<<14,be<128?ge:(ge|=(127&(be=Se[this.pos++]))<<21,be<128?ge:function(Ve,Le,Be){var Qe,Ue,Je=Be.buf;if(Qe=(112&(Ue=Je[Be.pos++]))>>4,Ue<128||(Qe|=(127&(Ue=Je[Be.pos++]))<<3,Ue<128)||(Qe|=(127&(Ue=Je[Be.pos++]))<<10,Ue<128)||(Qe|=(127&(Ue=Je[Be.pos++]))<<17,Ue<128)||(Qe|=(127&(Ue=Je[Be.pos++]))<<24,Ue<128)||(Qe|=(1&(Ue=Je[Be.pos++]))<<31,Ue<128))return x(Ve,Qe,Le);throw new Error("Expected varint not more than 10 bytes")}(ge|=(15&(be=Se[this.pos]))<<28,ie,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ie=this.readVarint();return ie%2==1?(ie+1)/-2:ie/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ie=this.readVarint()+this.pos,ge=this.pos;return this.pos=ie,ie-ge>=12&&g?function(be,Se,Ve){return g.decode(be.subarray(Se,Ve))}(this.buf,ge,ie):function(be,Se,Ve){for(var Le="",Be=Se;Be<Ve;){var Qe,Ue,Je,lt=be[Be],st=null,mt=lt>239?4:lt>223?3:lt>191?2:1;if(Be+mt>Ve)break;mt===1?lt<128&&(st=lt):mt===2?(192&(Qe=be[Be+1]))==128&&(st=(31&lt)<<6|63&Qe)<=127&&(st=null):mt===3?(Ue=be[Be+2],(192&(Qe=be[Be+1]))==128&&(192&Ue)==128&&((st=(15&lt)<<12|(63&Qe)<<6|63&Ue)<=2047||st>=55296&&st<=57343)&&(st=null)):mt===4&&(Ue=be[Be+2],Je=be[Be+3],(192&(Qe=be[Be+1]))==128&&(192&Ue)==128&&(192&Je)==128&&((st=(15&lt)<<18|(63&Qe)<<12|(63&Ue)<<6|63&Je)<=65535||st>=1114112)&&(st=null)),st===null?(st=65533,mt=1):st>65535&&(st-=65536,Le+=String.fromCharCode(st>>>10&1023|55296),st=56320|1023&st),Le+=String.fromCharCode(st),Be+=mt}return Le}(this.buf,ge,ie)},readBytes:function(){var ie=this.readVarint()+this.pos,ge=this.buf.subarray(this.pos,ie);return this.pos=ie,ge},readPackedVarint:function(ie,ge){if(this.type!==o.Bytes)return ie.push(this.readVarint(ge));var be=p(this);for(ie=ie||[];this.pos<be;)ie.push(this.readVarint(ge));return ie},readPackedSVarint:function(ie){if(this.type!==o.Bytes)return ie.push(this.readSVarint());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readSVarint());return ie},readPackedBoolean:function(ie){if(this.type!==o.Bytes)return ie.push(this.readBoolean());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readBoolean());return ie},readPackedFloat:function(ie){if(this.type!==o.Bytes)return ie.push(this.readFloat());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readFloat());return ie},readPackedDouble:function(ie){if(this.type!==o.Bytes)return ie.push(this.readDouble());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readDouble());return ie},readPackedFixed32:function(ie){if(this.type!==o.Bytes)return ie.push(this.readFixed32());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readFixed32());return ie},readPackedSFixed32:function(ie){if(this.type!==o.Bytes)return ie.push(this.readSFixed32());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readSFixed32());return ie},readPackedFixed64:function(ie){if(this.type!==o.Bytes)return ie.push(this.readFixed64());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readFixed64());return ie},readPackedSFixed64:function(ie){if(this.type!==o.Bytes)return ie.push(this.readSFixed64());var ge=p(this);for(ie=ie||[];this.pos<ge;)ie.push(this.readSFixed64());return ie},skip:function(ie){var ge=7&ie;if(ge===o.Varint)for(;this.buf[this.pos++]>127;);else if(ge===o.Bytes)this.pos=this.readVarint()+this.pos;else if(ge===o.Fixed32)this.pos+=4;else{if(ge!==o.Fixed64)throw new Error("Unimplemented type: "+ge);this.pos+=8}},writeTag:function(ie,ge){this.writeVarint(ie<<3|ge)},realloc:function(ie){for(var ge=this.length||16;ge<this.pos+ie;)ge*=2;if(ge!==this.length){var be=new Uint8Array(ge);be.set(this.buf),this.buf=be,this.length=ge}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ie){this.realloc(4),ce(this.buf,ie,this.pos),this.pos+=4},writeSFixed32:function(ie){this.realloc(4),ce(this.buf,ie,this.pos),this.pos+=4},writeFixed64:function(ie){this.realloc(8),ce(this.buf,-1&ie,this.pos),ce(this.buf,Math.floor(ie*f),this.pos+4),this.pos+=8},writeSFixed64:function(ie){this.realloc(8),ce(this.buf,-1&ie,this.pos),ce(this.buf,Math.floor(ie*f),this.pos+4),this.pos+=8},writeVarint:function(ie){(ie=+ie||0)>268435455||ie<0?function(ge,be){var Se,Ve;if(ge>=0?(Se=ge%4294967296|0,Ve=ge/4294967296|0):(Ve=~(-ge/4294967296),4294967295^(Se=~(-ge%4294967296))?Se=Se+1|0:(Se=0,Ve=Ve+1|0)),ge>=18446744073709552e3||ge<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");be.realloc(10),function(Le,Be,Qe){Qe.buf[Qe.pos++]=127&Le|128,Le>>>=7,Qe.buf[Qe.pos++]=127&Le|128,Le>>>=7,Qe.buf[Qe.pos++]=127&Le|128,Le>>>=7,Qe.buf[Qe.pos++]=127&Le|128,Qe.buf[Qe.pos]=127&(Le>>>=7)}(Se,0,be),function(Le,Be){var Qe=(7&Le)<<4;Be.buf[Be.pos++]|=Qe|((Le>>>=3)?128:0),Le&&(Be.buf[Be.pos++]=127&Le|((Le>>>=7)?128:0),Le&&(Be.buf[Be.pos++]=127&Le|((Le>>>=7)?128:0),Le&&(Be.buf[Be.pos++]=127&Le|((Le>>>=7)?128:0),Le&&(Be.buf[Be.pos++]=127&Le|((Le>>>=7)?128:0),Le&&(Be.buf[Be.pos++]=127&Le)))))}(Ve,be)}(ie,this):(this.realloc(4),this.buf[this.pos++]=127&ie|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=127&(ie>>>=7)|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=127&(ie>>>=7)|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=ie>>>7&127))))},writeSVarint:function(ie){this.writeVarint(ie<0?2*-ie-1:2*ie)},writeBoolean:function(ie){this.writeVarint(!!ie)},writeString:function(ie){ie=String(ie),this.realloc(4*ie.length),this.pos++;var ge=this.pos;this.pos=function(Se,Ve,Le){for(var Be,Qe,Ue=0;Ue<Ve.length;Ue++){if((Be=Ve.charCodeAt(Ue))>55295&&Be<57344){if(!Qe){Be>56319||Ue+1===Ve.length?(Se[Le++]=239,Se[Le++]=191,Se[Le++]=189):Qe=Be;continue}if(Be<56320){Se[Le++]=239,Se[Le++]=191,Se[Le++]=189,Qe=Be;continue}Be=Qe-55296<<10|Be-56320|65536,Qe=null}else Qe&&(Se[Le++]=239,Se[Le++]=191,Se[Le++]=189,Qe=null);Be<128?Se[Le++]=Be:(Be<2048?Se[Le++]=Be>>6|192:(Be<65536?Se[Le++]=Be>>12|224:(Se[Le++]=Be>>18|240,Se[Le++]=Be>>12&63|128),Se[Le++]=Be>>6&63|128),Se[Le++]=63&Be|128)}return Le}(this.buf,ie,this.pos);var be=this.pos-ge;be>=128&&I(ge,be,this),this.pos=ge-1,this.writeVarint(be),this.pos+=be},writeFloat:function(ie){this.realloc(4),d.write(this.buf,ie,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ie){this.realloc(8),d.write(this.buf,ie,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ie){var ge=ie.length;this.writeVarint(ge),this.realloc(ge);for(var be=0;be<ge;be++)this.buf[this.pos++]=ie[be]},writeRawMessage:function(ie,ge){this.pos++;var be=this.pos;ie(ge,this);var Se=this.pos-be;Se>=128&&I(be,Se,this),this.pos=be-1,this.writeVarint(Se),this.pos+=Se},writeMessage:function(ie,ge,be){this.writeTag(ie,o.Bytes),this.writeRawMessage(ge,be)},writePackedVarint:function(ie,ge){ge.length&&this.writeMessage(ie,D,ge)},writePackedSVarint:function(ie,ge){ge.length&&this.writeMessage(ie,L,ge)},writePackedBoolean:function(ie,ge){ge.length&&this.writeMessage(ie,z,ge)},writePackedFloat:function(ie,ge){ge.length&&this.writeMessage(ie,T,ge)},writePackedDouble:function(ie,ge){ge.length&&this.writeMessage(ie,k,ge)},writePackedFixed32:function(ie,ge){ge.length&&this.writeMessage(ie,O,ge)},writePackedSFixed32:function(ie,ge){ge.length&&this.writeMessage(ie,B,ge)},writePackedFixed64:function(ie,ge){ge.length&&this.writeMessage(ie,U,ge)},writePackedSFixed64:function(ie,ge){ge.length&&this.writeMessage(ie,X,ge)},writeBytesField:function(ie,ge){this.writeTag(ie,o.Bytes),this.writeBytes(ge)},writeFixed32Field:function(ie,ge){this.writeTag(ie,o.Fixed32),this.writeFixed32(ge)},writeSFixed32Field:function(ie,ge){this.writeTag(ie,o.Fixed32),this.writeSFixed32(ge)},writeFixed64Field:function(ie,ge){this.writeTag(ie,o.Fixed64),this.writeFixed64(ge)},writeSFixed64Field:function(ie,ge){this.writeTag(ie,o.Fixed64),this.writeSFixed64(ge)},writeVarintField:function(ie,ge){this.writeTag(ie,o.Varint),this.writeVarint(ge)},writeSVarintField:function(ie,ge){this.writeTag(ie,o.Varint),this.writeSVarint(ge)},writeStringField:function(ie,ge){this.writeTag(ie,o.Bytes),this.writeString(ge)},writeFloatField:function(ie,ge){this.writeTag(ie,o.Fixed32),this.writeFloat(ge)},writeDoubleField:function(ie,ge){this.writeTag(ie,o.Fixed64),this.writeDouble(ge)},writeBooleanField:function(ie,ge){this.writeVarintField(ie,!!ge)}},YM}var FE=v(GB());const KM=3;function aie(d,o,c){o.glyphs=[],d===1&&c.readMessage(lie,o)}function lie(d,o,c){if(d===3){const{id:f,bitmap:g,width:p,height:x,left:I,top:D,advance:L}=c.readMessage(cie,{});o.glyphs.push({id:f,bitmap:new mp({width:p+2*KM,height:x+2*KM},g),metrics:{width:p,height:x,left:I,top:D,advance:L}})}else d===4?o.ascender=c.readSVarint():d===5&&(o.descender=c.readSVarint())}function cie(d,o,c){d===1?o.id=c.readVarint():d===2?o.bitmap=c.readBytes():d===3?o.width=c.readVarint():d===4?o.height=c.readVarint():d===5?o.left=c.readSVarint():d===6?o.top=c.readSVarint():d===7&&(o.advance=c.readVarint())}const uie=KM,fc={horizontal:1,vertical:2,horizontalOnly:3};class nv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,c){const f=new nv;return f.scale=o||1,f.fontStack=c,f}static forImage(o){const c=new nv;return c.image=o,c}}class _0{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c,f){const g=new _0;for(let p=0;p<o.sections.length;p++){const x=o.sections[p];x.image?g.addImageSection(x,f):g.addTextSection(x,c)}return g}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(c,f){let g="";for(let p=0;p<c.length;p++){const x=c.charCodeAt(p+1)||null,I=c.charCodeAt(p-1)||null;g+=!f&&(x&&f1(x)&&!tv[c[p+1]]||I&&f1(I)&&!tv[c[p-1]])||!tv[c[p]]?c[p]:tv[c[p]]}return g}(this.text,o)}trim(){let o=0;for(let f=0;f<this.text.length&&BE[this.text.charCodeAt(f)];f++)o++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&BE[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const f=new _0;return f.text=this.text.substring(o,c),f.sectionIndex=this.sectionIndex.slice(o,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(nv.forText(o.scale,o.fontStack||c));const f=this.sections.length-1;for(let g=0;g<o.text.length;++g)this.sectionIndex.push(f)}addImageSection(o,c){const f=o.image?o.image.getPrimary():null;if(!f)return void Nr("Can't add FormattedSection with an empty image.");f.scaleSelf(c);const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCodePoint(g),this.sections.push(nv.forImage(f)),this.sectionIndex.push(this.sections.length-1)):Nr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ZM(d,o,c,f,g,p,x,I,D,L,T,k,z,O,B,U=1){const X=_0.fromFeature(d,g,U);k===fc.vertical&&X.verticalizePunctuation(z);let J=[];const ce=function(Se,Ve,Le,Be,Qe,Ue){if(!Se)return[];const Je=[],lt=function(vt,_t,Et,qt,Ht,Cn){let Qt=0;for(let ln=0;ln<vt.length();ln++){const Yt=vt.getSection(ln);Qt+=YB(vt.getCodePoint(ln),Yt,qt,Ht,_t,Cn)}return Qt/Math.max(1,Math.ceil(Qt/Et))}(Se,Ve,Le,Be,Qe,Ue),st=Se.text.indexOf("")>=0;let mt=0;for(let vt=0;vt<Se.length();vt++){const _t=Se.getSection(vt),Et=Se.getCodePoint(vt);if(BE[Et]||(mt+=YB(Et,_t,Be,Qe,Ve,Ue)),vt<Se.length()-1){const qt=!((pt=Et)<11904||!(Gn["Bopomofo Extended"](pt)||Gn.Bopomofo(pt)||Gn["CJK Compatibility Forms"](pt)||Gn["CJK Compatibility Ideographs"](pt)||Gn["CJK Compatibility"](pt)||Gn["CJK Radicals Supplement"](pt)||Gn["CJK Strokes"](pt)||Gn["CJK Symbols and Punctuation"](pt)||Gn["CJK Unified Ideographs Extension A"](pt)||Gn["CJK Unified Ideographs"](pt)||Gn["Enclosed CJK Letters and Months"](pt)||Gn["Halfwidth and Fullwidth Forms"](pt)||Gn.Hiragana(pt)||Gn["Ideographic Description Characters"](pt)||Gn["Kangxi Radicals"](pt)||Gn["Katakana Phonetic Extensions"](pt)||Gn.Katakana(pt)||Gn["Vertical Forms"](pt)||Gn["Yi Radicals"](pt)||Gn["Yi Syllables"](pt)));(hie[Et]||qt||_t.image)&&Je.push(KB(vt+1,mt,lt,Je,die(Et,Se.getCodePoint(vt+1),qt&&st),!1))}}var pt;return ZB(KB(Se.length(),mt,lt,Je,0,!0))}(X,L,p,o,f,O),{processBidirectionalText:le,processStyledBidirectionalText:ie}=Rc;if(le&&X.sections.length===1){const Se=le(X.toString(),ce);for(const Ve of Se){const Le=new _0;Le.text=Ve,Le.sections=X.sections;for(let Be=0;Be<Ve.length;Be++)Le.sectionIndex.push(0);J.push(Le)}}else if(ie){const Se=ie(X.text,X.sectionIndex,ce);for(const Ve of Se){const Le=new _0;Le.text=Ve[0],Le.sectionIndex=Ve[1],Le.sections=X.sections,J.push(Le)}}else J=function(Se,Ve){const Le=[],Be=Se.text;let Qe=0;for(const Ue of Ve)Le.push(Se.substring(Qe,Ue)),Qe=Ue;return Qe<Be.length&&Le.push(Se.substring(Qe,Be.length)),Le}(X,ce);const ge=[],be={positionedLines:ge,text:X.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Se,Ve,Le,Be,Qe,Ue,Je,lt,st,mt,pt,vt){let _t=0,Et=0,qt=0;const Ht=lt==="right"?1:lt==="left"?0:.5;let Cn=!1;for(const Pn of Qe){const ar=Pn.getSections();for(const Pr of ar){if(Pr.image)continue;const fr=Ve[Pr.fontStack];if(fr&&(Cn=fr.ascender!==void 0&&fr.descender!==void 0,!Cn))break}if(!Cn)break}let Qt=0;for(const Pn of Qe){Pn.trim();const ar=Pn.getMaxScale(),Pr=(ar-1)*Ra,fr={positionedGlyphs:[],lineOffset:0};Se.positionedLines[Qt]=fr;const jr=fr.positionedGlyphs;let Mr=0;if(!Pn.length()){Et+=Ue,++Qt;continue}let Hr=0,gi=0;for(let lr=0;lr<Pn.length();lr++){const ti=Pn.getSection(lr),ms=Pn.getSectionIndex(lr),Ss=Pn.getCodePoint(lr);let ks=ti.scale,Us=null,Hi=null,Vo=null,gl=Ra,_o=0;st===fc.vertical&&((ln=Ss)===12312||ln===12313||ln===12316||ln===12540||ln===12448)&&(st=fc.horizontal);const Eo=!(st===fc.horizontal||!pt&&!G_(Ss)||pt&&(BE[Ss]||rE(Ss)));if(ti.image){const $a=Be.get(ti.image.toString());if(!$a)continue;Vo=ti.image,Se.iconsInText=Se.iconsInText||!0,Hi=$a.paddedRect;const ha=$a.displaySize;ks=ks*Ra/vt,Us={width:ha[0],height:ha[1],left:0,top:-3,advance:Eo?ha[1]:ha[0],localGlyph:!1},_o=Cn?-Us.height*ks:ar*Ra-17-ha[1]*ks,gl=Us.advance;const nu=(Eo?ha[0]:ha[1])*ks-Ra*ar;nu>0&&nu>Mr&&(Mr=nu)}else{const $a=Le[ti.fontStack];if(!$a)continue;$a[Ss]&&(Hi=$a[Ss]);const ha=Ve[ti.fontStack];if(!ha)continue;const nu=ha.glyphs[Ss];if(!nu)continue;if(Us=nu.metrics,gl=Ss!==8203?Ra:0,Cn){const wp=ha.ascender!==void 0?Math.abs(ha.ascender):0,Ou=ha.descender!==void 0?Math.abs(ha.descender):0,gh=(wp+Ou)*ks;Hr<gh&&(Hr=gh,gi=(wp-Ou)/2*ks),_o=-wp*ks}else _o=(ar-ks)*Ra-17}Eo?(Se.verticalizable=!0,jr.push({glyph:Ss,image:Vo,x:_t,y:Et+_o,vertical:Eo,scale:ks,localGlyph:Us.localGlyph,fontStack:ti.fontStack,sectionIndex:ms,metrics:Us,rect:Hi}),_t+=gl*ks+mt):(jr.push({glyph:Ss,image:Vo,x:_t,y:Et+_o,vertical:Eo,scale:ks,localGlyph:Us.localGlyph,fontStack:ti.fontStack,sectionIndex:ms,metrics:Us,rect:Hi}),_t+=Us.advance*ks+mt)}jr.length!==0&&(qt=Math.max(_t-mt,qt),Cn?QB(jr,Ht,Mr,gi,Ue*ar/2):QB(jr,Ht,Mr,0,Ue/2)),_t=0;const $i=Ue*ar+Mr;fr.lineOffset=Math.max(Mr,Pr),Et+=$i,++Qt}var ln;const Yt=Et,{horizontalAlign:Zn,verticalAlign:bn}=QM(Je);(function(Pn,ar,Pr,fr,jr,Mr){const Hr=(ar-Pr)*jr,gi=-Mr*fr;for(const $i of Pn)for(const lr of $i.positionedGlyphs)lr.x+=Hr,lr.y+=gi})(Se.positionedLines,Ht,Zn,bn,qt,Yt),Se.top+=-bn*Yt,Se.bottom=Se.top+Yt,Se.left+=-Zn*qt,Se.right=Se.left+qt,Se.hasBaseline=Cn}(be,o,c,f,J,x,I,D,k,L,z,B),!function(Se){for(const Ve of Se)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(ge))return be}const BE={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hie={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function YB(d,o,c,f,g,p){if(o.image){const x=f.get(o.image.toString());return x?x.displaySize[0]*o.scale*Ra/p+g:0}{const x=c[o.fontStack],I=x&&x.glyphs[d];return I?I.metrics.advance*o.scale+g:0}}function XB(d,o,c,f){const g=Math.pow(d-o,2);return f?d<o?g/2:2*g:g+Math.abs(c)*c}function die(d,o,c){let f=0;return d===10&&(f-=1e4),c&&(f+=150),d!==40&&d!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function KB(d,o,c,f,g,p){let x=null,I=XB(o,c,g,p);for(const D of f){const L=XB(o-D.x,c,g,p)+D.badness;L<=I&&(x=D,I=L)}return{index:d,x:o,priorBreak:x,badness:I}}function ZB(d){return d?ZB(d.priorBreak).concat(d.index):[]}function QM(d){let o=.5,c=.5;switch(d){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function QB(d,o,c,f,g){if(!(o||c||f||g))return;const p=d.length-1,x=d[p],I=(x.x+x.metrics.advance*x.scale)*o;for(let D=0;D<=p;D++)d[D].x-=I,d[D].y+=c+f+g}function fie(d,o,c,f){const{horizontalAlign:g,verticalAlign:p}=QM(f),x=c[0]-d.displaySize[0]*g,I=c[1]-d.displaySize[1]*p;return{imagePrimary:d,imageSecondary:o,top:I,bottom:I+d.displaySize[1],left:x,right:x+d.displaySize[0]}}function JB(d,o,c,f,g,p){const x=d.imagePrimary;let I;if(x.content){const X=x.content,J=x.pixelRatio||1;I=[X[0]/J,X[1]/J,x.displaySize[0]-X[2]/J,x.displaySize[1]-X[3]/J]}const D=o.left*p,L=o.right*p;let T,k,z,O;c==="width"||c==="both"?(O=g[0]+D-f[3],k=g[0]+L+f[1]):(O=g[0]+(D+L-x.displaySize[0])/2,k=O+x.displaySize[0]);const B=o.top*p,U=o.bottom*p;return c==="height"||c==="both"?(T=g[1]+B-f[0],z=g[1]+U+f[2]):(T=g[1]+(B+U-x.displaySize[1])/2,z=T+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:T,right:k,bottom:z,left:O,collisionPadding:I}}class Kd extends Ot{constructor(o,c,f,g,p){super(o,c),this.angle=g,this.z=f,p!==void 0&&(this.segment=p)}clone(){return new Kd(this.x,this.y,this.z,this.angle,this.segment)}}function ez(d,o,c,f,g){if(o.segment===void 0)return!0;let p=o,x=o.segment+1,I=0;for(;I>-c/2;){if(x--,x<0)return!1;I-=d[x].dist(p),p=d[x]}I+=d[x].dist(d[x+1]),x++;const D=[];let L=0;for(;I<c/2;){const T=d[x],k=d[x+1];if(!k)return!1;let z=d[x-1].angleTo(T)-T.angleTo(k);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:z}),L+=z;I-D[0].distance>f;)L-=D.shift().angleDelta;if(L>g)return!1;x++,I+=T.dist(k)}return!0}function tz(d){let o=0;for(let c=0;c<d.length-1;c++)o+=d[c].dist(d[c+1]);return o}function nz(d,o,c){return d?.6*o*c:0}function rz(d,o){return Math.max(d?d.right-d.left:0,o?o.right-o.left:0)}function pie(d,o,c,f,g,p){const x=nz(c,g,p),I=rz(c,f)*p;let D=0;const L=tz(d)/2;for(let T=0;T<d.length-1;T++){const k=d[T],z=d[T+1],O=k.dist(z);if(D+O>L){const B=(L-D)/O,U=Wn(k.x,z.x,B),X=Wn(k.y,z.y,B),J=new Kd(U,X,0,z.angleTo(k),T);return!x||ez(d,J,I,x,o)?J:void 0}D+=O}}function mie(d,o,c,f,g,p,x,I,D){const L=nz(f,p,x),T=rz(f,g),k=T*x,z=d[0].x===0||d[0].x===D||d[0].y===0||d[0].y===D;return o-k<o/4&&(o=k+o/4),iz(d,z?o/2*I%o:(T/2+2*p)*x*I%o,o,L,c,k,z,!1,D)}function iz(d,o,c,f,g,p,x,I,D){const L=p/2,T=tz(d);let k=0,z=o-c,O=[];for(let B=0;B<d.length-1;B++){const U=d[B],X=d[B+1],J=U.dist(X),ce=X.angleTo(U);for(;z+c<k+J;){z+=c;const le=(z-k)/J,ie=Wn(U.x,X.x,le),ge=Wn(U.y,X.y,le);if(ie>=0&&ie<D&&ge>=0&&ge<D&&z-L>=0&&z+L<=T){const be=new Kd(ie,ge,0,ce,B);f&&!ez(d,be,p,f,g)||O.push(be)}}k+=J}return I||O.length||x||(O=iz(d,k/2,c,f,g,p,x,!0,D)),O}function sz(d,o,c,f,g){const p=[];for(let x=0;x<d.length;x++){const I=d[x];let D;for(let L=0;L<I.length-1;L++){let T=I[L],k=I[L+1];T.x<o&&k.x<o||(T.x<o?T=new Ot(o,T.y+(o-T.x)/(k.x-T.x)*(k.y-T.y))._round():k.x<o&&(k=new Ot(o,T.y+(o-T.x)/(k.x-T.x)*(k.y-T.y))._round()),T.y<c&&k.y<c||(T.y<c?T=new Ot(T.x+(c-T.y)/(k.y-T.y)*(k.x-T.x),c)._round():k.y<c&&(k=new Ot(T.x+(c-T.y)/(k.y-T.y)*(k.x-T.x),c)._round()),T.x>=f&&k.x>=f||(T.x>=f?T=new Ot(f,T.y+(f-T.x)/(k.x-T.x)*(k.y-T.y))._round():k.x>=f&&(k=new Ot(f,T.y+(f-T.x)/(k.x-T.x)*(k.y-T.y))._round()),T.y>=g&&k.y>=g||(T.y>=g?T=new Ot(T.x+(g-T.y)/(k.y-T.y)*(k.x-T.x),g)._round():k.y>=g&&(k=new Ot(T.x+(g-T.y)/(k.y-T.y)*(k.x-T.x),g)._round()),D&&T.equals(D[D.length-1])||(D=[T],p.push(D)),D.push(k)))))}}return p}function oz(d){let o=0,c=0;for(const x of d)o+=x.w*x.h,c=Math.max(c,x.w);d.sort((x,I)=>I.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let g=0,p=0;for(const x of d)for(let I=f.length-1;I>=0;I--){const D=f[I];if(!(x.w>D.w||x.h>D.h)){if(x.x=D.x,x.y=D.y,p=Math.max(p,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===D.w&&x.h===D.h){const L=f.pop();I<f.length&&(f[I]=L)}else x.h===D.h?(D.x+=x.w,D.w-=x.w):x.w===D.w?(D.y+=x.h,D.h-=x.h):(f.push({x:D.x+x.w,y:D.y,w:D.w-x.w,h:x.h}),D.y+=x.h,D.h-=x.h);break}}return{w:g,h:p,fill:o/(g*p)||0}}Tn(Kd,"Anchor");const y0=1;class rv{static getImagePositionScale(o,c,f){if(c&&o&&o.options&&o.options.transform){const g=o.options.transform;return{x:g.a,y:g.d}}return{x:f,y:f}}constructor(o,c,f,g){this.paddedRect=o;const{pixelRatio:p,version:x,stretchX:I,stretchY:D,content:L,sdf:T,usvg:k}=c;this.pixelRatio=p,this.stretchX=I,this.stretchY=D,this.content=L,this.version=x,this.padding=f,this.sdf=T,this.scale=rv.getImagePositionScale(g,k,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function az(d,o,c){const f=hl.parse(d),g=function(p,x,I=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*I[0])+2*x,h:(p.data?p.data.height:p.height*I[1])+2*x}}(o,c,[f.options.transform.a,f.options.transform.d]);return{bin:g,imagePosition:new rv(g,o,c,f),imageVariant:f}}class lz{constructor(o,c,f){const g=new Map,p=new Map;this.haveRenderCallbacks=[];const x=[];this.addImages(o,g,y0,x),this.addImages(c,p,2,x);const{w:I,h:D}=oz(x),L=new Aa({width:I||1,height:D||1});for(const[T,k]of o.entries()){const z=g.get(T).paddedRect;Aa.copy(k.data,L,{x:0,y:0},{x:z.x+y0,y:z.y+y0},k.data,f,k.sdf)}for(const[T,k]of c.entries()){const z=p.get(T),O=z.paddedRect;let B=z.padding;const U=O.x+B,X=O.y+B,J=k.data.width,ce=k.data.height;B=B>1?B-1:B,Aa.copy(k.data,L,{x:0,y:0},{x:U,y:X},k.data,f),Aa.copy(k.data,L,{x:0,y:ce-B},{x:U,y:X-B},{width:J,height:B},f),Aa.copy(k.data,L,{x:0,y:0},{x:U,y:X+ce},{width:J,height:B},f),Aa.copy(k.data,L,{x:J-B,y:0},{x:U-B,y:X},{width:B,height:ce},f),Aa.copy(k.data,L,{x:0,y:0},{x:U+J,y:X},{width:B,height:ce},f),Aa.copy(k.data,L,{x:J-B,y:ce-B},{x:U-B,y:X-B},{width:B,height:B},f),Aa.copy(k.data,L,{x:0,y:ce-B},{x:U+J,y:X-B},{width:B,height:B},f),Aa.copy(k.data,L,{x:0,y:0},{x:U+J,y:X+ce},{width:B,height:B},f),Aa.copy(k.data,L,{x:J-B,y:0},{x:U-B,y:X+ce},{width:B,height:B},f)}this.lut=f,this.image=L,this.iconPositions=g,this.patternPositions=p}addImages(o,c,f,g){for(const[p,x]of o.entries()){const{bin:I,imagePosition:D,imageVariant:L}=az(p,x,f);c.set(p,D),g.push(I),x.hasRenderCallback&&this.haveRenderCallbacks.push(L.id)}}patchUpdatedImages(o,c,f){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>o.hasImage(g,f)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,f);for(const g of o.getUpdatedImages(f)){for(const p of this.iconPositions.keys()){const x=hl.parse(p);if(mr.isEqual(x.id,g)){const I=o.getImage(g,f);this.patchUpdatedImage(this.iconPositions.get(p),I,c)}}for(const p of this.patternPositions.keys()){const x=hl.parse(p);if(mr.isEqual(x.id,g)){const I=o.getImage(g,f);this.patchUpdatedImage(this.patternPositions.get(p),I,c)}}}}patchUpdatedImage(o,c,f){if(!o||!c||o.version===c.version)return;o.version=c.version;const[g,p]=o.tl,x=o.sdf;if(this.lut||x){const I={width:c.data.width,height:c.data.height},D=new Aa(I);Aa.copy(c.data,D,{x:0,y:0},{x:0,y:0},I,this.lut,x),f.update(D,{position:{x:g,y:p}})}else f.update(c.data,{position:{x:g,y:p}})}}Tn(rv,"ImagePosition"),Tn(lz,"ImageAtlas");const zE=1e20;function cz(d,o,c,f,g,p,x,I,D){for(let L=o;L<o+f;L++)uz(d,c*p+L,p,g,x,I,D);for(let L=c;L<c+g;L++)uz(d,L*p+o,1,f,x,I,D)}function uz(d,o,c,f,g,p,x){p[0]=0,x[0]=-1e20,x[1]=zE,g[0]=d[o];for(let I=1,D=0,L=0;I<f;I++){g[I]=d[o+I*c];const T=I*I;do{const k=p[D];L=(g[I]-g[k]+T-k*k)/(I-k)/2}while(L<=x[D]&&--D>-1);D++,p[D]=I,x[D]=L,x[D+1]=zE}for(let I=0,D=0;I<f;I++){for(;x[D+1]<I;)D++;const L=p[D],T=I-L;d[o+I*c]=g[L]+T*T}}const dh=2,JM={none:0,ideographs:1,all:2};class x0{constructor(o,c,f){this.requestManager=o,this.localGlyphMode=c,this.localFontFamily=f,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,c){this.urls[c]=o}getGlyphs(o,c,f){const g=[],p=this.urls[c]||Te.GLYPHS_URL;for(const x in o)for(const I of o[x])g.push({stack:x,id:I});cs(g,({stack:x,id:I},D)=>{let L=this.entries[x];L||(L=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=L.glyphs[I];if(T!==void 0)return void D(null,{stack:x,id:I,glyph:T});if(T=this._tinySDF(L,x,I),T)return L.glyphs[I]=T,void D(null,{stack:x,id:I,glyph:T});const k=Math.floor(I/256);if(256*k>65535)return Nr("glyphs > 65535 not supported"),void D(null,{stack:x,id:I,glyph:T});if(L.ranges[k])return void D(null,{stack:x,id:I,glyph:T});let z=L.requests[k];z||(z=L.requests[k]=[],x0.loadGlyphRange(x,k,p,this.requestManager,(O,B)=>{if(B){L.ascender=B.ascender,L.descender=B.descender;for(const U in B.glyphs)this._doesCharSupportLocalGlyph(+U)||(L.glyphs[+U]=B.glyphs[+U]);L.ranges[k]=!0}for(const U of z)U(O,B);delete L.requests[k]})),z.push((O,B)=>{O?D(O):B&&D(null,{stack:x,id:I,glyph:B.glyphs[I]||null})})},(x,I)=>{if(x)f(x);else if(I){const D={};for(const{stack:L,id:T,glyph:k}of I)D[L]===void 0&&(D[L]={}),D[L].glyphs===void 0&&(D[L].glyphs={}),D[L].glyphs[T]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},D[L].ascender=this.entries[L].ascender,D[L].descender=this.entries[L].descender;f(null,D)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==JM.none&&(this.localGlyphMode===JM.all?!!this.localFontFamily:!!this.localFontFamily&&(Gn["CJK Unified Ideographs"](o)||Gn["Hangul Syllables"](o)||Gn.Hiragana(o)||Gn.Katakana(o)||Gn["CJK Symbols and Punctuation"](o)||Gn["CJK Unified Ideographs Extension A"](o)||Gn["CJK Unified Ideographs Extension B"](o)||Gn.Osage(o)))}_tinySDF(o,c,f){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let p=o.tinySDF;if(!p){let U="400";/bold/i.test(c)?U="900":/medium/i.test(c)?U="500":/light/i.test(c)&&(U="200"),p=o.tinySDF=new x0.TinySDF({fontFamily:g,fontWeight:U,fontSize:24*dh,buffer:3*dh,radius:8*dh}),p.fontWeight=U}if(this.localGlyphs[p.fontWeight][f])return this.localGlyphs[p.fontWeight][f];const x=String.fromCodePoint(f),{data:I,width:D,height:L,glyphWidth:T,glyphHeight:k,glyphLeft:z,glyphTop:O,glyphAdvance:B}=p.draw(x);return this.localGlyphs[p.fontWeight][f]={id:f,bitmap:new mp({width:D,height:L},I),metrics:{width:T/dh,height:k/dh,left:z/dh,top:O/dh-27,advance:B/dh,localGlyph:!0}}}}x0.loadGlyphRange=function(d,o,c,f,g){const p=256*o,x=p+255,I=f.transformRequest(f.normalizeGlyphsURL(c).replace("{fontstack}",d).replace("{range}",`${p}-${x}`),qr.Glyphs);xa(I,(D,L)=>{if(D)g(D);else if(L){const T={},k=function(z){return new FE(z).readFields(aie,{})}(L);for(const z of k.glyphs)T[z.id]=z;g(null,{glyphs:T,ascender:k.ascender,descender:k.descender})}})},x0.TinySDF=class{constructor({fontSize:d=24,buffer:o=3,radius:c=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:p="normal",fontStyle:x="normal"}={}){this.buffer=o,this.cutoff=f,this.radius=c;const I=this.size=d+4*o,D=this._createCanvas(I),L=this.ctx=D.getContext("2d",{willReadFrequently:!0});L.font=`${x} ${p} ${d}px ${g}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(d){const o=document.createElement("canvas");return o.width=o.height=d,o}draw(d){const{width:o,actualBoundingBoxAscent:c,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:p}=this.ctx.measureText(d),x=Math.ceil(c),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-g))),D=Math.min(this.size-this.buffer,x+Math.ceil(f)),L=I+2*this.buffer,T=D+2*this.buffer,k=Math.max(L*T,0),z=new Uint8ClampedArray(k),O={data:z,width:L,height:T,glyphWidth:I,glyphHeight:D,glyphTop:x,glyphLeft:0,glyphAdvance:o};if(I===0||D===0)return O;const{ctx:B,buffer:U,gridInner:X,gridOuter:J}=this;B.clearRect(U,U,I,D),B.fillText(d,U,U+x);const ce=B.getImageData(U,U,I,D);J.fill(zE,0,k),X.fill(0,0,k);for(let le=0;le<D;le++)for(let ie=0;ie<I;ie++){const ge=ce.data[4*(le*I+ie)+3]/255;if(ge===0)continue;const be=(le+U)*L+ie+U;if(ge===1)J[be]=0,X[be]=zE;else{const Se=.5-ge;J[be]=Se>0?Se*Se:0,X[be]=Se<0?Se*Se:0}}cz(J,0,0,L,T,L,this.f,this.v,this.z),cz(X,U,U,I,D,L,this.f,this.v,this.z);for(let le=0;le<k;le++){const ie=Math.sqrt(J[le])-Math.sqrt(X[le]);z[le]=Math.round(255-255*(ie/this.radius+this.cutoff))}return O}};const mg=y0;function hz(d,o){return d+o[1]-o[0]}function dz(d,o,c,f,g=1){const p=[],x=d.imagePrimary,I=x.pixelRatio,D=x.paddedRect.w-2*mg,L=x.paddedRect.h-2*mg,T=(d.right-d.left)*g,k=(d.bottom-d.top)*g,z=x.stretchX||[[0,D]],O=x.stretchY||[[0,L]],B=z.reduce(hz,0),U=O.reduce(hz,0),X=D-B,J=L-U;let ce=0,le=B,ie=0,ge=U,be=0,Se=X,Ve=0,Le=J;if(x.content&&f){const Qe=x.content;ce=jE(z,0,Qe[0]),ie=jE(O,0,Qe[1]),le=jE(z,Qe[0],Qe[2]),ge=jE(O,Qe[1],Qe[3]),be=Qe[0]-ce,Ve=Qe[1]-ie,Se=Qe[2]-Qe[0]-le,Le=Qe[3]-Qe[1]-ge}const Be=(Qe,Ue,Je,lt)=>{const st=VE(Qe.stretch-ce,le,T,d.left*g),mt=UE(Qe.fixed-be,Se,Qe.stretch,B),pt=VE(Ue.stretch-ie,ge,k,d.top*g),vt=UE(Ue.fixed-Ve,Le,Ue.stretch,U),_t=VE(Je.stretch-ce,le,T,d.left*g),Et=UE(Je.fixed-be,Se,Je.stretch,B),qt=VE(lt.stretch-ie,ge,k,d.top*g),Ht=UE(lt.fixed-Ve,Le,lt.stretch,U),Cn=new Ot(st,pt),Qt=new Ot(_t,pt),ln=new Ot(_t,qt),Yt=new Ot(st,qt),Zn=new Ot(mt/I,vt/I),bn=new Ot(Et/I,Ht/I),Pn=o*Math.PI/180;if(Pn){const Hr=Math.sin(Pn),gi=Math.cos(Pn),$i=[gi,-Hr,Hr,gi];Cn._matMult($i),Qt._matMult($i),Yt._matMult($i),ln._matMult($i)}const ar=Qe.stretch+Qe.fixed,Pr=Je.stretch+Je.fixed,fr=Ue.stretch+Ue.fixed,jr=lt.stretch+lt.fixed,Mr=d.imageSecondary;return{tl:Cn,tr:Qt,bl:Yt,br:ln,texPrimary:{x:x.paddedRect.x+mg+ar,y:x.paddedRect.y+mg+fr,w:Pr-ar,h:jr-fr},texSecondary:Mr?{x:Mr.paddedRect.x+mg+ar,y:Mr.paddedRect.y+mg+fr,w:Pr-ar,h:jr-fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zn,pixelOffsetBR:bn,minFontScaleX:Se/I/T,minFontScaleY:Le/I/k,isSDF:c}};if(f&&(x.stretchX||x.stretchY)){const Qe=fz(z,X,B),Ue=fz(O,J,U);for(let Je=0;Je<Qe.length-1;Je++){const lt=Qe[Je],st=Qe[Je+1];for(let mt=0;mt<Ue.length-1;mt++)p.push(Be(lt,Ue[mt],st,Ue[mt+1]))}}else p.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:L+1}));return p}function jE(d,o,c){let f=0;for(const g of d)f+=Math.max(o,Math.min(c,g[1]))-Math.max(o,Math.min(c,g[0]));return f}function fz(d,o,c){const f=[{fixed:-1,stretch:0}];for(const[g,p]of d){const x=f[f.length-1];f.push({fixed:g-x.stretch,stretch:x.stretch}),f.push({fixed:g-x.stretch,stretch:x.stretch+(p-g)})}return f.push({fixed:o+mg,stretch:c}),f}function VE(d,o,c,f){return d/o*c+f}function UE(d,o,c,f){return d-o*c/f}function gie(d,o,c,f){const g=o+d.positionedLines[f].lineOffset;return f===0?c+g/2:c+(g+(o+d.positionedLines[f-1].lineOffset))/2}function _ie(d,o=1,c=!1){let f=1/0,g=1/0,p=-1/0,x=-1/0;const I=d[0];for(let O=0;O<I.length;O++){const B=I[O];(!O||B.x<f)&&(f=B.x),(!O||B.y<g)&&(g=B.y),(!O||B.x>p)&&(p=B.x),(!O||B.y>x)&&(x=B.y)}const D=Math.min(p-f,x-g);let L=D/2;const T=new th([],yie);if(D===0)return new Ot(f,g);for(let O=f;O<p;O+=D)for(let B=g;B<x;B+=D)T.push(new v0(O+L,B+L,L,d));let k=function(O){let B=0,U=0,X=0;const J=O[0];for(let ce=0,le=J.length,ie=le-1;ce<le;ie=ce++){const ge=J[ce],be=J[ie],Se=ge.x*be.y-be.x*ge.y;U+=(ge.x+be.x)*Se,X+=(ge.y+be.y)*Se,B+=3*Se}return new v0(U/B,X/B,0,O)}(d),z=T.length;for(;T.length;){const O=T.pop();(O.d>k.d||!k.d)&&(k=O,c&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,z)),O.max-k.d<=o||(L=O.h/2,T.push(new v0(O.p.x-L,O.p.y-L,L,d)),T.push(new v0(O.p.x+L,O.p.y-L,L,d)),T.push(new v0(O.p.x-L,O.p.y+L,L,d)),T.push(new v0(O.p.x+L,O.p.y+L,L,d)),z+=4)}return c&&(console.log(`num probes: ${z}`),console.log(`best distance: ${k.d}`)),k.p}function yie(d,o){return o.max-d.max}class v0{constructor(o,c,f,g){this.p=new Ot(o,c),this.h=f,this.d=function(p,x){let I=!1,D=1/0;for(let L=0;L<x.length;L++){const T=x[L];for(let k=0,z=T.length,O=z-1;k<z;O=k++){const B=T[k],U=T[O];B.y>p.y!=U.y>p.y&&p.x<(U.x-B.x)*(p.y-B.y)/(U.y-B.y)+B.x&&(I=!I),D=Math.min(D,Ze(p,B,U))}}return(I?1:-1)*Math.sqrt(D)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const eP=Number.POSITIVE_INFINITY,xie=Math.sqrt(2);function pz(d,[o,c]){let f=0,g=0;if(c===eP){o<0&&(o=0);const p=o/xie;switch(d){case"top-right":case"top-left":g=p-7;break;case"bottom-right":case"bottom-left":g=7-p;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(d){case"top-right":case"bottom-right":f=-p;break;case"top-left":case"bottom-left":f=p;break;case"left":f=o;break;case"right":f=-o}}else{switch(o=Math.abs(o),c=Math.abs(c),d){case"top-right":case"top-left":case"top":g=c-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-c}switch(d){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}}return[f,g]}function mz(d,o,c,f,g,p,x,I){if(!d)return;const D=WB(o,c,f,g,p);return d.scaleSelf(D*I*x)}function gz(d,o,c,f,g,p,x,I){return{iconPrimary:mz(d.getPrimary(),o,c,f,g,p,x,I),iconSecondary:mz(d.getSecondary(),o,c,f,g,p,x,I)}}function _z(d,o,c,f){if(!d)return;const g=o.get(c.toString());if(d.imagePrimary=g,f){const p=o.get(f.toString());d.imageSecondary=p}}function vie(d,o){for(const c in d.horizontal)yz(d.horizontal[c],o);yz(d.vertical,o)}function yz(d,o){if(d){for(const c of d.positionedLines)for(const f of c.positionedGlyphs)if(f.image!==null){const g=f.image.toString();f.rect=o.get(g).paddedRect}}}function tP(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bie(d,o,c,f,g,p,x,I,D){const L=nP(p.horizontal)||p.vertical,T=c.get("icon-text-fit-padding").evaluate(f,{},g);let k,z=o;return o&&D!=="none"&&(d.allowVerticalPlacement&&p.vertical&&(k=JB(o,p.vertical,D,T,I,x)),L&&(z=JB(o,L,D,T,I,x))),{defaultShapedIcon:z,verticallyShapedIcon:k}}function wie(d,o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J,ce,le){let ie=x.textMaxSize.evaluate(o,{},z);ie===void 0?ie=I*x.textScaleFactor:ie*=x.textScaleFactor;const ge=d.layers[0].layout,be=nP(c.horizontal)||c.vertical,Se=O.name==="globe",Ve=Ra,Le=d.tilePixelRatio*ie/Ve,Be=(mt=d.overscaling,d.zoom>18&&mt>2&&(mt>>=1),Math.max(sn/(512*mt),1)*ge.get("symbol-spacing")),Qe=ge.get("text-padding")*d.tilePixelRatio,Ue=ge.get("icon-padding")*d.tilePixelRatio,Je=Mn(ge.get("text-max-angle")),lt=ge.get("icon-rotation-alignment")==="map"&&le!=="point",st=Be/2;var mt;d.hasAnyIconTextFit===!1&&X!=="none"&&(d.hasAnyIconTextFit=!0);const pt=o.properties?+o.properties[dg]:null,vt=pt&&d.elevationFeatureIdToIndex?d.elevationFeatureIdToIndex.get(pt):65535,_t=(Et,qt,Ht)=>{if(qt.x<0||qt.x>=sn||qt.y<0||qt.y>=sn)return;let Cn=null;if(Se){const{x:Qt,y:ln,z:Yt}=O.projectTilePoint(qt.x,qt.y,Ht);Cn={anchor:new Kd(Qt,ln,Yt,0,void 0),up:O.upVector(Ht,qt.x,qt.y)}}(function(Qt,ln,Yt,Zn,bn,Pn,ar,Pr,fr,jr,Mr,Hr,gi,$i,lr,ti,ms,Ss,ks,Us,Hi,Vo,gl,_o,Eo,$a,ha,nu,wp){const Ou=Qt.addToLineVertexArray(ln,Zn);let gh,Ep,Sp,vg,e8,t8,n8,r8=0,i8=0,s8=0,o8=0,OP=-1,LP=-1;const id={};let a8=Fn("");const bg=Yt?Yt.anchor:ln,FP=nu!=="none";let BP=0,zP=0;if(fr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[BP,zP]=fr.layout.get("text-offset").evaluate(Hi,{},Eo).map(ru=>ru*Ra):(BP=fr.layout.get("text-radial-offset").evaluate(Hi,{},Eo)*Ra,zP=eP),Qt.allowVerticalPlacement&&bn.vertical){const ru=bn.vertical;if(lr)t8=rP(ru),Pr&&(n8=rP(Pr));else{const pc=fr.layout.get("text-rotate").evaluate(Hi,{},Eo)+90;Sp=HE(jr,bg,ln,Mr,Hr,gi,ru,$i,pc,ti),Pr&&(vg=HE(jr,bg,ln,Mr,Hr,gi,Pr,Ss,pc))}}if(Pn){const ru=Qt.iconSizeData,pc=fr.layout.get("icon-rotate").evaluate(Hi,{},Eo),wv=dz(Pn,pc,gl,FP,Vo.iconScaleFactor),VP=Pr?dz(Pr,pc,gl,FP,Vo.iconScaleFactor):void 0;Ep=HE(jr,bg,ln,Mr,Hr,gi,Pn,Ss,pc,null),r8=4*wv.length;let wg=null;ru.kind==="source"?(wg=[hh*fr.layout.get("icon-size").evaluate(Hi,{},Eo)*Vo.iconScaleFactor],wg[0]>yp&&Nr(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${iv}. Reduce your "icon-size".`)):ru.kind==="composite"&&(wg=[hh*Vo.compositeIconSizes[0].evaluate(Hi,{},Eo)*Vo.iconScaleFactor,hh*Vo.compositeIconSizes[1].evaluate(Hi,{},Eo)*Vo.iconScaleFactor],(wg[0]>yp||wg[1]>yp)&&Nr(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${iv}. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,wv,wg,Us,ks,Hi,!1,Yt,ln,Ou.lineStartIndex,Ou.lineLength,-1,_o,Eo,$a,ha),OP=Qt.icon.placedSymbolArray.length-1,VP&&(i8=4*VP.length,Qt.addSymbols(Qt.icon,VP,wg,Us,ks,Hi,fc.vertical,Yt,ln,Ou.lineStartIndex,Ou.lineLength,-1,_o,Eo,$a,ha),LP=Qt.icon.placedSymbolArray.length-1)}for(const ru in bn.horizontal){const pc=bn.horizontal[ru];gh||(a8=Fn(pc.text),lr?e8=rP(pc):gh=HE(jr,bg,ln,Mr,Hr,gi,pc,$i,fr.layout.get("text-rotate").evaluate(Hi,{},Eo),ti));const wv=pc.positionedLines.length===1;if(s8+=xz(Qt,Yt,ln,pc,ar,fr,lr,Hi,ti,Ou,bn.vertical?fc.horizontal:fc.horizontalOnly,wv?Object.keys(bn.horizontal):[ru],id,OP,Vo,_o,Eo,$a),wv)break}bn.vertical&&(o8+=xz(Qt,Yt,ln,bn.vertical,ar,fr,lr,Hi,ti,Ou,fc.vertical,["vertical"],id,LP,Vo,_o,Eo,$a));let Tp=-1;const jP=(ru,pc)=>ru?Math.max(ru,pc):pc;Tp=jP(e8,Tp),Tp=jP(t8,Tp),Tp=jP(n8,Tp);const eoe=Tp>-1?1:0;Qt.glyphOffsetArray.length>=65535&&Nr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Hi.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,Hi.sortKey),Qt.symbolInstances.emplaceBack(ln.x,ln.y,bg.x,bg.y,bg.z,id.right>=0?id.right:-1,id.center>=0?id.center:-1,id.left>=0?id.left:-1,id.vertical>=0?id.vertical:-1,OP,LP,a8,gh!==void 0?gh:Qt.collisionBoxArray.length,gh!==void 0?gh+1:Qt.collisionBoxArray.length,Sp!==void 0?Sp:Qt.collisionBoxArray.length,Sp!==void 0?Sp+1:Qt.collisionBoxArray.length,Ep!==void 0?Ep:Qt.collisionBoxArray.length,Ep!==void 0?Ep+1:Qt.collisionBoxArray.length,vg||Qt.collisionBoxArray.length,vg?vg+1:Qt.collisionBoxArray.length,Mr,s8,o8,r8,i8,eoe,0,BP,zP,Tp,0,FP?1:0,wp)})(d,qt,Cn,Et,c,f,p,g,d.layers[0],d.collisionBoxArray,o.index,o.sourceLayerIndex,d.index,Qe,ce,L,0,Ue,lt,J,o,x,T,k,z,B,U,X,vt)};if(le==="line")for(const Et of sz(o.geometry,0,0,sn,sn)){const qt=mie(Et,Be,Je,c.vertical||be,f,Ve,Le,d.overscaling,sn);for(const Ht of qt)be&&Eie(d,be.text,st,Ht)||_t(Et,Ht,z)}else if(le==="line-center"){for(const Et of o.geometry)if(Et.length>1){const qt=pie(Et,Je,c.vertical||be,f,Ve,Le);qt&&_t(Et,qt,z)}}else if(o.type==="Polygon")for(const Et of RE(o.geometry,0)){const qt=_ie(Et,16);_t(Et[0],new Kd(qt.x,qt.y,0,0,void 0),z)}else if(o.type==="LineString")for(const Et of o.geometry)_t(Et,new Kd(Et[0].x,Et[0].y,0,0,void 0),z);else if(o.type==="Point")for(const Et of o.geometry)for(const qt of Et)_t([qt],new Kd(qt.x,qt.y,0,0,void 0),z)}const iv=255,yp=iv*hh;function xz(d,o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X,J){const ce=function(ge,be,Se,Ve,Le,Be,Qe,Ue){const Je=[];if(be.positionedLines.length===0)return Je;const lt=Ve.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,st=function(Et){const qt=Et[0],Ht=Et[1],Cn=qt*Ht;return Cn>0?[qt,-Ht]:Cn<0?[-qt,Ht]:qt===0?[Ht,qt]:[Ht,-qt]}(Se);let mt=Math.abs(be.top-be.bottom);for(const Et of be.positionedLines)mt-=Et.lineOffset;const pt=be.positionedLines.length,vt=mt/pt;let _t=be.top-Se[1];for(let Et=0;Et<pt;++Et){const qt=be.positionedLines[Et];_t=gie(be,vt,_t,Et);for(const Ht of qt.positionedGlyphs){if(!Ht.rect)continue;const Cn=Ht.rect||{};let Qt=uie+1,ln=!0,Yt=1,Zn=0;if(Ht.image){const Hi=Qe.get(Ht.image.toString());if(!Hi)continue;if(Hi.sdf){Nr("SDF images are not supported in formatted text and will be ignored.");continue}ln=!1,Yt=Hi.pixelRatio,Qt=y0/Yt}const bn=(Le||Ue)&&Ht.vertical,Pn=Ht.metrics.advance*Ht.scale/2,ar=Ht.metrics,Pr=Ht.rect;if(Pr===null)continue;Ue&&be.verticalizable&&(Zn=Ht.image?Pn-Ht.metrics.width*Ht.scale/2:0);const fr=Le?[Ht.x+Pn,Ht.y]:[0,0];let jr=[0,0],Mr=[0,0],Hr=!1;Le||(bn?(Mr=[Ht.x+Pn+st[0],Ht.y+st[1]-Zn],Hr=!0):jr=[Ht.x+Pn+Se[0],Ht.y+Se[1]-Zn]);const gi=Pr.w*Ht.scale/(Yt*(Ht.localGlyph?dh:1)),$i=Pr.h*Ht.scale/(Yt*(Ht.localGlyph?dh:1));let lr,ti,ms,Ss;if(bn){const Hi=Ht.y-_t,Vo=new Ot(-Pn,Pn-Hi),gl=-Math.PI/2,_o=new Ot(...Mr);lr=new Ot(-Pn+jr[0],jr[1]),lr._rotateAround(gl,Vo)._add(_o),lr.x+=-Hi+Pn,lr.y-=(ar.left-Qt)*Ht.scale;const Eo=Ht.image?ar.advance*Ht.scale:Ra*Ht.scale,$a=String.fromCodePoint(Ht.glyph);iie($a)?lr.x+=(1-Qt)*Ht.scale:sie($a)?lr.x+=Eo-ar.height*Ht.scale+(-Qt-1)*Ht.scale:lr.x+=Ht.image||ar.width+2*Qt===Pr.w&&ar.height+2*Qt===Pr.h?(Eo-$i)/2:(Eo-(ar.height+2*Qt)*Ht.scale)/2,ti=new Ot(lr.x,lr.y-gi),ms=new Ot(lr.x+$i,lr.y),Ss=new Ot(lr.x+$i,lr.y-gi)}else{const Hi=(ar.left-Qt)*Ht.scale-Pn+jr[0],Vo=(-ar.top-Qt)*Ht.scale+jr[1],gl=Hi+gi,_o=Vo+$i;lr=new Ot(Hi,Vo),ti=new Ot(gl,Vo),ms=new Ot(Hi,_o),Ss=new Ot(gl,_o)}if(lt){let Hi;Hi=Le?new Ot(0,0):Hr?new Ot(st[0],st[1]):new Ot(Se[0],Se[1]),lr._rotateAround(lt,Hi),ti._rotateAround(lt,Hi),ms._rotateAround(lt,Hi),Ss._rotateAround(lt,Hi)}const ks=new Ot(0,0),Us=new Ot(0,0);Je.push({tl:lr,tr:ti,bl:ms,br:Ss,texPrimary:Cn,texSecondary:void 0,writingMode:be.writingMode,glyphOffset:fr,sectionIndex:Ht.sectionIndex,isSDF:ln,pixelOffsetTL:ks,pixelOffsetBR:Us,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,f,D,p,x,I,g,d.allowVerticalPlacement),le=d.textSizeData;let ie=null;le.kind==="source"?(ie=[hh*p.layout.get("text-size").evaluate(I,{},X)*B.textScaleFactor],ie[0]>yp&&Nr(`${d.layerIds[0]}: Value for "text-size" is >= ${iv}. Reduce your "text-size".`)):le.kind==="composite"&&(ie=[hh*B.compositeTextSizes[0].evaluate(I,{},X)*B.textScaleFactor,hh*B.compositeTextSizes[1].evaluate(I,{},X)*B.textScaleFactor],(ie[0]>yp||ie[1]>yp)&&Nr(`${d.layerIds[0]}: Value for "text-size" is >= ${iv}. Reduce your "text-size".`)),d.addSymbols(d.text,ce,ie,D,x,I,T,o,c,L.lineStartIndex,L.lineLength,O,U,X,J,!1);for(const ge of k)z[ge]=d.text.placedSymbolArray.length-1;return 4*ce.length}function nP(d){for(const o in d)return d[o];return null}function HE(d,o,c,f,g,p,x,I,D,L){let T=x.top,k=x.bottom,z=x.left,O=x.right;const B=x.collisionPadding;if(B&&(z-=B[0],T-=B[1],O+=B[2],k+=B[3]),D){const U=new Ot(z,T),X=new Ot(O,T),J=new Ot(z,k),ce=new Ot(O,k),le=Mn(D);let ie=new Ot(0,0);L&&(ie=new Ot(L[0],L[1])),U._rotateAround(le,ie),X._rotateAround(le,ie),J._rotateAround(le,ie),ce._rotateAround(le,ie),z=Math.min(U.x,X.x,J.x,ce.x),O=Math.max(U.x,X.x,J.x,ce.x),T=Math.min(U.y,X.y,J.y,ce.y),k=Math.max(U.y,X.y,J.y,ce.y)}return d.emplaceBack(o.x,o.y,o.z,c.x,c.y,z,T,O,k,I,f,g,p),d.length-1}function rP(d){d.collisionPadding&&(d.top-=d.collisionPadding[1],d.bottom+=d.collisionPadding[3]);const o=d.bottom-d.top;return o>0?Math.max(10,o):null}function Eie(d,o,c,f){const g=d.compareText;if(o in g){const p=g[o];for(let x=p.length-1;x>=0;x--)if(f.dist(p[x])<c)return!0}else g[o]=[];return g[o].push(f),!1}function vz(d,o){const c=d.fovAboveCenter,f=d.elevation?d.elevation.getMinElevationBelowMSL()*o:0,g=(d._camera.position[2]*d.worldSize-f)/Math.cos(d._pitch),p=Math.sin(c)*g/Math.sin(Math.max(Math.PI/2-d._pitch-c,.01));let x=Math.sin(d._pitch)*p+g;const I=g*(1/d._horizonShift);if(!d.elevation||d.elevation.exaggeration()===0){let D=Math.max(d.zoom-17,0);d.isOrthographic&&(D/=10),x*=1+D}return Math.min(1.01*x,I)}function sv(d,o){if(!o.isReprojectedInTileSpace)return{scale:1<<d.z,x:d.x,y:d.y,x2:d.x+1,y2:d.y+1,projection:o};const c=Math.pow(2,-d.z),f=d.x*c,g=(d.x+1)*c,p=d.y*c,x=(d.y+1)*c,I=Bl(f),D=Bl(g),L=ca(p),T=ca(x),k=o.project(I,L),z=o.project(D,L),O=o.project(D,T),B=o.project(I,T);let U=Math.min(k.x,z.x,O.x,B.x),X=Math.min(k.y,z.y,O.y,B.y),J=Math.max(k.x,z.x,O.x,B.x),ce=Math.max(k.y,z.y,O.y,B.y);const le=c/16;function ie(be,Se,Ve,Le,Be,Qe){const Ue=(Ve+Be)/2,Je=(Le+Qe)/2,lt=o.project(Bl(Ue),ca(Je)),st=Math.max(0,U-lt.x,X-lt.y,lt.x-J,lt.y-ce);U=Math.min(U,lt.x),J=Math.max(J,lt.x),X=Math.min(X,lt.y),ce=Math.max(ce,lt.y),st>le&&(ie(be,lt,Ve,Le,Ue,Je),ie(lt,Se,Ue,Je,Be,Qe))}ie(k,z,f,p,g,p),ie(z,O,g,p,g,x),ie(O,B,g,x,f,x),ie(B,k,f,x,f,p),U-=le,X-=le,J+=le,ce+=le;const ge=1/Math.max(J-U,ce-X);return{scale:ge,x:U*ge,y:X*ge,x2:J*ge,y2:ce*ge,projection:o}}function bz(d,{x:o,y:c},f=0){return new Ot(((o-f)*d.scale-d.x)*sn,(c*d.scale-d.y)*sn)}const Sie=Pe.mat4.identity(new Float32Array(16));class xp{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,c){return{x:0,y:0,z:0}}unproject(o,c){return new xi(0,0)}projectTilePoint(o,c,f){return{x:o,y:c,z:0}}locationPoint(o,c,f,g=!0){return o._coordinatePoint(o.locationCoordinate(c,f),g)}pixelsPerMeter(o,c){return Ia(1,o)*c}pixelSpaceConversion(o,c,f){return 1}farthestPixelDistance(o){return vz(o,o.pixelsPerMeter)}pointCoordinate(o,c,f,g){const p=o.horizonLineFromTop(!1),x=new Ot(c,Math.max(p,f));return o.rayIntersectionCoordinate(o.pointRayIntersection(x,g))}pointCoordinate3D(o,c,f){const g=new Ot(c,f);if(o.elevation)return o.elevation.pointCoordinate(g);{const p=this.pointCoordinate(o,g.x,g.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(o,c){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,c.x,c.y);const f=o.horizonLineFromTop();return c.y<f}createInversionMatrix(o,c){return Sie}createTileMatrix(o,c,f){let g,p,x;const I=f.canonical,D=Pe.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const L=sv(I,this);g=1,p=L.x+f.wrap*L.scale,x=L.y,Pe.mat4.scale(D,D,[g/L.scale,g/L.scale,o.pixelsPerMeter/c])}else g=c/o.zoomScale(I.z),p=(I.x+Math.pow(2,I.z)*f.wrap)*g,x=I.y*g;return Pe.mat4.translate(D,D,[p,x,0]),Pe.mat4.scale(D,D,[g/sn,g/sn,1]),D}upVector(o,c,f){return[0,0,1]}upVectorScale(o,c,f){return{metersToTile:1}}}class Tie extends xp{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[c,f]=this.parallels=o.parallels||[29.5,45.5],g=Math.sin(Mn(c));this.n=(g+Math.sin(Mn(f)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(o,c){const{n:f,c:g,r0:p}=this,x=Mn(o-this.center[0]),I=Mn(c),D=Math.sqrt(g-2*f*Math.sin(I))/f;return{x:D*Math.sin(x*f),y:D*Math.cos(x*f)-p,z:0}}unproject(o,c){const{n:f,c:g,r0:p}=this,x=p+c;let I=Math.atan2(o,Math.abs(x))*Math.sign(x);x*f<0&&(I-=Math.PI*Math.sign(o)*Math.sign(x));const D=Mn(this.center[0])*f;I=Si(I,-Math.PI-D,Math.PI-D);const L=Bn(jt(I/f)+this.center[0],-180,180),T=Math.asin(Bn((g-(o*o+x*x)*f*f)/(2*f),-1,1)),k=Bn(jt(T),-85.051129,pl);return new xi(L,k)}}const ov=1.340264,av=-.081106,lv=893e-6,cv=.003796,WE=Math.sqrt(3)/2;class Cie extends xp{project(o,c){c=c/180*Math.PI,o=o/180*Math.PI;const f=Math.asin(WE*Math.sin(c)),g=f*f,p=g*g*g;return{x:.5*(o*Math.cos(f)/(WE*(ov+3*av*g+p*(7*lv+9*cv*g)))/Math.PI+.5),y:1-.5*(f*(ov+av*g+p*(lv+cv*g))/Math.PI+1),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,g=f*f,p=g*g*g;for(let T,k,z,O=0;O<12&&(k=f*(ov+av*g+p*(lv+cv*g))-c,z=ov+3*av*g+p*(7*lv+9*cv*g),T=k/z,f=Bn(f-T,-Math.PI/3,Math.PI/3),g=f*f,p=g*g*g,!(Math.abs(T)<1e-12));++O);const x=WE*o*(ov+3*av*g+p*(7*lv+9*cv*g))/Math.cos(f),I=Math.asin(Math.sin(f)/WE),D=Bn(180*x/Math.PI,-180,180),L=Bn(180*I/Math.PI,-85.051129,pl);return new xi(D,L)}}class Iie extends xp{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,c){return{x:.5+o/360,y:.5-c/360,z:0}}unproject(o,c){const f=360*(o-.5),g=Bn(360*(.5-c),-85.051129,pl);return new xi(f,g)}}const b0=Math.PI/2;function $E(d){return Math.tan((b0+d)/2)}class Aie extends xp{constructor(o){super(o),this.center=o.center||[0,30];const[c,f]=this.parallels=o.parallels||[30,30];let g=Mn(c),p=Mn(f);this.southernCenter=g+p<0,this.southernCenter&&(g=-g,p=-p);const x=Math.cos(g),I=$E(g);this.n=g===p?Math.sin(g):Math.log(x/Math.cos(p))/Math.log($E(p)/I),this.f=x*Math.pow($E(g),this.n)/this.n}project(o,c){c=Mn(c),this.southernCenter&&(c=-c),o=Mn(o-this.center[0]);const f=1e-6,{n:g,f:p}=this;p>0?c<-b0+f&&(c=-b0+f):c>b0-f&&(c=b0-f);const x=p/Math.pow($E(c),g);let I=x*Math.sin(g*o),D=p-x*Math.cos(g*o);return I=.5*(I/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:I,y:this.southernCenter?D:1-D,z:0}}unproject(o,c){o=(2*o-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:f,f:g}=this,p=g-c,x=Math.sign(p),I=Math.sign(f)*Math.sqrt(o*o+p*p);let D=Math.atan2(o,Math.abs(p))*x;p*f<0&&(D-=Math.PI*Math.sign(o)*x);const L=Bn(jt(D/f)+this.center[0],-180,180),T=Bn(jt(2*Math.atan(Math.pow(g/I,1/f))-b0),-85.051129,pl);return new xi(L,this.southernCenter?-T:T)}}class wz extends xp{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,c){return{x:Pu(o),y:Ca(c),z:0}}unproject(o,c){const f=Bl(o),g=ca(c);return new xi(f,g)}}const Ez=Mn(pl);class Rie extends xp{project(o,c){const f=(c=Mn(c))*c,g=f*f;return{x:.5*((o=Mn(o))*(.8707-.131979*f+g*(g*(.003971*f-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+f*(.015085+g*(.028874*f-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,g=25,p=0,x=f*f;do{x=f*f;const L=x*x;p=(f*(1.007226+x*(.015085+L*(.028874*x-.044475-.005916*L)))-c)/(1.007226+x*(.045255+L*(.259866*x-.311325-.005916*11*L))),f=Bn(f-p,-Ez,Ez)}while(Math.abs(p)>1e-6&&--g>0);x=f*f;const I=Bn(jt(o/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),D=jt(f);return new xi(I,D)}}const Sz=Mn(pl);class Mie extends xp{project(o,c){c=Mn(c),o=Mn(o);const f=Math.cos(c),g=2/Math.PI,p=Math.acos(f*Math.cos(o/2)),x=Math.sin(p)/p,I=.5*(o*g+2*f*Math.sin(o/2)/x)||0,D=.5*(c+Math.sin(c)/x)||0;return{x:.5*(I/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(o,c){let f=o=(2*o-.5)*Math.PI,g=c=(2*(1-c)-1)*Math.PI,p=25;const x=1e-6;let I=0,D=0;do{const L=Math.cos(g),T=Math.sin(g),k=2*T*L,z=T*T,O=L*L,B=Math.cos(f/2),U=Math.sin(f/2),X=2*B*U,J=U*U,ce=1-O*B*B,le=ce?1/ce:0,ie=ce?Math.acos(L*B)*Math.sqrt(1/ce):0,ge=.5*(2*ie*L*U+2*f/Math.PI)-o,be=.5*(ie*T+g)-c,Se=.5*le*(O*J+ie*L*B*z)+1/Math.PI,Ve=le*(X*k/4-ie*T*U),Le=.125*le*(k*U-ie*T*O*X),Be=.5*le*(z*B+ie*J*L)+.5,Qe=Ve*Le-Be*Se;I=(be*Ve-ge*Be)/Qe,D=(ge*Le-be*Se)/Qe,f=Bn(f-I,-Math.PI,Math.PI),g=Bn(g-D,-Sz,Sz)}while((Math.abs(I)>x||Math.abs(D)>x)&&--p>0);return new xi(jt(f),jt(g))}}class Tz extends xp{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Mn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,c){const{scale:f,cosPhi:g}=this;return{x:Mn(o)*g*f+.5,y:-Math.sin(Mn(c))/g*f+.5,z:0}}unproject(o,c){const{scale:f,cosPhi:g}=this,p=-(c-.5)/f,x=Bn(jt((o-.5)/f)/g,-180,180),I=Math.asin(Bn(p*g,-1,1)),D=Bn(jt(I),-85.051129,pl);return new xi(x,D)}}class Pie extends wz{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,c,f){const g=bi(o,c,f),p=ps(Mo(f));return Pe.vec3.transformMat4(g,g,p),{x:g[0],y:g[1],z:g[2]}}locationPoint(o,c,f){const g=Gd(c.lat,c.lng),p=Pe.vec3.normalize([],g),x=f?o._centerAltitude+f:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(c),o._centerAltitude):o._centerAltitude,I=Ia(1,0)*sn*x;Pe.vec3.scaleAndAdd(g,g,p,I);const D=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(D,o.pixelMatrix,o.globeMatrix),Pe.vec3.transformMat4(g,g,D),new Ot(g[0],g[1])}pixelsPerMeter(o,c){return Ia(1,0)*c}pixelSpaceConversion(o,c,f){const g=Ia(1,o)*c,p=Wn(Ia(1,45)*c,g,f);return this.pixelsPerMeter(o,c)/p}createTileMatrix(o,c,f){const g=Po(Mo(f.canonical));return Pe.mat4.multiply(new Float64Array(16),o.globeMatrix,g)}createInversionMatrix(o,c){const{center:f}=o,g=ps(Mo(c));return Pe.mat4.rotateY(g,g,Mn(f.lng)),Pe.mat4.rotateX(g,g,Mn(f.lat)),Pe.mat4.scale(g,g,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(o,c,f,g){return mi(o,c,f,!0)||new a(0,0)}pointCoordinate3D(o,c,f){const g=this.pointCoordinate(o,c,f,0);return[g.x,g.y,g.z]}isPointAboveHorizon(o,c){return!mi(o,c.x,c.y,!1)}farthestPixelDistance(o){const c=function(g,p){const x=g.cameraToCenterDistance,I=g._centerAltitude*p,D=g._camera,L=g._camera.forward(),T=Pe.vec3.add([],Pe.vec3.scale([],L,-x),[0,0,I]),k=g.worldSize/(2*Math.PI),z=[0,0,-k],O=g.width/g.height,B=Math.tan(g.fovAboveCenter),U=Pe.vec3.scale([],D.up(),B),X=Pe.vec3.scale([],D.right(),B*O),J=Pe.vec3.normalize([],Pe.vec3.add([],Pe.vec3.add([],L,U),X)),ce=[];let le;if(new sr(T,J).closestPointOnSphere(z,k,ce)){const ie=Pe.vec3.add([],ce,z),ge=Pe.vec3.sub([],ie,T);le=Math.cos(g.fovAboveCenter)*Pe.vec3.length(ge)}else{const ie=Pe.vec3.sub([],T,z),ge=Pe.vec3.sub([],z,T);Pe.vec3.normalize(ge,ge);const be=Pe.vec3.length(ie)-k;le=Math.sqrt(be*(be+2*k));const Se=Math.acos(le/(k+be))-Math.acos(Pe.vec3.dot(L,ge));le*=Math.cos(Se)}return 1.01*le}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),f=ml(o.zoom);if(f>0){const g=vz(o,Ia(1,o.center.lat)*o.worldSize),p=o.worldSize/(2*Math.PI),x=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Wn(c,g+p*(1-Math.cos(x)),Math.pow(f,10))}return c}upVector(o,c,f){return bi(c,f,o,1)}upVectorScale(o){return{metersToTile:ei(Ui(Mo(o)))}}}function Cz(d){const o=d.parallels,c=!!o&&Math.abs(o[0]+o[1])<.01;switch(d.name){case"mercator":return new wz(d);case"equirectangular":return new Iie(d);case"naturalEarth":return new Rie(d);case"equalEarth":return new Cie(d);case"winkelTripel":return new Mie(d);case"albers":return c?new Tz(d):new Tie(d);case"lambertConformalConic":return c?new Tz(d):new Aie(d);case"globe":return new Pie(d)}throw new Error(`Invalid projection name: ${d.name}`)}const Die=gp.VectorTileFeature.types,kie=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qE(d,o,c,f,g,p,x,I,D,L,T,k,z){const O=I?Math.min(yp,Math.round(I[0])):0,B=I?Math.min(yp,Math.round(I[1])):0;d.emplaceBack(o,c,Math.round(32*f),Math.round(32*g),p,x,(O<<1)+(D?1:0),B,16*L,16*T,256*k,256*z)}function GE(d,o,c){d.emplaceBack(o,c)}function YE(d,o,c,f,g,p,x){d.emplaceBack(o,c,f,g,p,x)}function XE(d,o,c,f,g){d.emplaceBack(o,c,f,g),d.emplaceBack(o,c,f,g),d.emplaceBack(o,c,f,g),d.emplaceBack(o,c,f,g)}function Nie(d){for(const o of d.sections)if(iE(o.text))return!0;return!1}class iP{constructor(o){this.layoutVertexArray=new C1,this.indexArray=new la,this.programConfigurations=o,this.segments=new xs,this.dynamicLayoutVertexArray=new Wd,this.opacityVertexArray=new A1,this.placedSymbolArray=new fE,this.iconTransitioningVertexArray=new Qh,this.globeExtVertexArray=new I1,this.zOffsetVertexArray=new Hd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(o,c,f,g,p){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Yre.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Kre.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,kie,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,Qre.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Xre.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,Zre.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Tn(iP,"SymbolBuffers");class sP{constructor(o,c,f){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new f,this.segments=new xs,this.collisionVertexArray=new P1,this.collisionVertexArrayExt=new Wd}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Jre.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,eie.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tn(sP,"CollisionBuffers");class KE{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pe.mat4.identity([]),this.placementViewportMatrix=Pe.mat4.identity([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=GM(this.zoom,c["text-size"]),this.iconSizeData=GM(this.zoom,c["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),p=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(x=>fc[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new iP(new ed(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new iP(new ed(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new gE,this.lineVertexArray=new ng,this.symbolInstances=new mE}calculateGlyphDependencies(o,c,f,g,p){for(const x of o){const I=x.codePointAt(0);if(I===void 0)break;if(c[I]=!0,g&&p&&I<=65535){const D=tv[x];D&&(c[D.charCodeAt(0)]=!0)}}}updateFootprints(o,c){}updateReplacement(o,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!jM(this.activeReplacements,f)&&(this.activeReplacements=f,!0)}populate(o,c,f,g){const p=this.layers[0],x=p.layout,I=this.projection.name==="globe",D=x.get("text-font"),L=x.get("text-field"),T=x.get("icon-image"),[k,z]=x.get("icon-size-scale-range"),O=Bn(c.scaleFactor||1,k,z),B=(L.value.kind!=="constant"||L.value.value instanceof Rs&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(D.value.kind!=="constant"||D.value.value.length>0),U=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,X=x.get("symbol-sort-key");if(this.features=[],!B&&!U)return;const J=c.iconDependencies,ce=c.glyphDependencies,le=c.availableImages,ie=new Wi(this.zoom);for(const{feature:ge,id:be,index:Se,sourceLayerIndex:Ve}of o){const Le=p._featureFilter.needGeometry,Be=Y(ge,Le);if(!p._featureFilter.filter(ie,Be,f))continue;if(Le||(Be.geometry=G(ge,f,g)),I&&ge.type!==1&&f.z<=5){const st=Be.geometry,mt=.98078528056,pt=(vt,_t)=>{const Et=bi(vt.x,vt.y,f,1),qt=bi(_t.x,_t.y,f,1);return Pe.vec3.dot(Et,qt)<mt};for(let vt=0;vt<st.length;vt++)st[vt]=C(st[vt],pt)}let Qe,Ue;if(B){const st=p.getValueAndResolveTokens("text-field",Be,f,le),mt=Rs.factory(st);Nie(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||K_()==="unavailable"||this.hasRTLText&&Rc.isParsed())&&(Qe=rie(mt,p,Be))}if(U){const st=p.getValueAndResolveTokens("icon-image",Be,f,le);Ue=st instanceof hi?st:hi.build(st)}if(!Qe&&!Ue)continue;const Je=this.sortFeaturesByKey?X.evaluate(Be,{},f):void 0,lt={id:be,text:Qe,icon:Ue,index:Se,sourceLayerIndex:Ve,geometry:Be.geometry,properties:ge.properties,type:Die[ge.type],sortKey:Je};if(this.features.push(lt),Ue){const st=this.layers[0]._unevaluatedLayout._values,{iconPrimary:mt,iconSecondary:pt}=gz(Ue,this.iconSizeData,st["icon-size"],f,this.zoom,lt,this.pixelRatio,O),vt=mt.id.toString();if(J.has(vt)?J.get(vt).push(mt):J.set(vt,[mt]),pt){const _t=pt.id.toString();J.has(_t)?J.get(_t).push(pt):J.set(_t,[pt])}}if(Qe){const st=D.evaluate(Be,{},f).join(","),mt=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fc.vertical)>=0;for(const pt of Qe.sections)if(pt.image){const vt=pt.image.getPrimary().scaleSelf(this.pixelRatio),_t=vt.id.toString(),Et=J.get(_t)||[];Et.push(vt),J.set(_t,Et)}else{const vt=d1(Qe.toString()),_t=pt.fontStack||st,Et=ce[_t]=ce[_t]||{};this.calculateGlyphDependencies(pt.text,Et,mt,this.allowVerticalPlacement,vt)}}}if(x.get("symbol-placement")==="line"&&(this.features=function(ge){const be={},Se={},Ve=[];let Le=0;function Be(lt){Ve.push(ge[lt]),Le++}function Qe(lt,st,mt){const pt=Se[lt];return delete Se[lt],Se[st]=pt,Ve[pt].geometry[0].pop(),Ve[pt].geometry[0]=Ve[pt].geometry[0].concat(mt[0]),pt}function Ue(lt,st,mt){const pt=be[st];return delete be[st],be[lt]=pt,Ve[pt].geometry[0].shift(),Ve[pt].geometry[0]=mt[0].concat(Ve[pt].geometry[0]),pt}function Je(lt,st,mt){const pt=mt?st[0][st[0].length-1]:st[0][0];return`${lt}:${pt.x}:${pt.y}`}for(let lt=0;lt<ge.length;lt++){const st=ge[lt],mt=st.geometry,pt=st.text?st.text.toString():null;if(!pt){Be(lt);continue}const vt=Je(pt,mt),_t=Je(pt,mt,!0);if(vt in Se&&_t in be&&Se[vt]!==be[_t]){const Et=Ue(vt,_t,mt),qt=Qe(vt,_t,Ve[Et].geometry);delete be[vt],delete Se[_t],Se[Je(pt,Ve[qt].geometry,!0)]=qt,Ve[Et].geometry=null}else vt in Se?Qe(vt,_t,mt):_t in be?Ue(vt,_t,mt):(Be(lt),be[vt]=Le-1,Se[_t]=Le-1)}return Ve.filter(lt=>lt.geometry)}(this.features)),x.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ge of c.elevationFeatures)this.elevationFeatureIdToIndex.set(ge.id,this.elevationFeatures.length),this.elevationFeatures.push(ge)}}else x.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ge,be)=>ge.sortKey-be.sortKey)}update(o,c,f,g,p,x,I){this.text.programConfigurations.updatePaintArrays(o,c,p,f,g,x,I),this.icon.programConfigurations.updatePaintArrays(o,c,p,f,g,x,I)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);if(f.elevationFeatureIndex===65535)continue;const g=this.elevationFeatures[f.elevationFeatureIndex];if(g){const p=.05+g.pointElevation(new Ot(f.tileAnchorX,f.tileAnchorY));f.zOffset!==p&&(o=!0,f.zOffset=p)}}o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(p,x,I)=>{f+=x,f>p.length&&p.resize(f);for(let D=-x;D<0;D++)p.emplace(D+f,I)},c=(p,x,I)=>{g+=x,g>p.length&&p.resize(g);for(let D=-x;D<0;D++)p.emplace(D+g,I)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let f=0,g=0;for(let p=0;p<this.symbolInstances.length;p++){const x=this.symbolInstances.get(p),{numHorizontalGlyphVertices:I,numVerticalGlyphVertices:D,numIconVertices:L}=x,T=x.zOffset,k=L>0;if((I>0||D>0)&&(o(this.text.zOffsetVertexArray,I,T),o(this.text.zOffsetVertexArray,D,T)),k){const{placedIconSymbolIndex:z,verticalPlacedIconSymbolIndex:O}=x;z>=0&&c(this.icon.zOffsetVertexArray,L,T),O>=0&&c(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Cz(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const f=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:g,y:p}of c)this.lineVertexArray.emplaceBack(g,p);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,c,f,g,p,x,I,D,L,T,k,z,O,B,U,X){const J=o.indexArray,ce=o.layoutVertexArray,le=o.globeExtVertexArray,ie=o.segments.prepareSegment(4*c.length,ce,J,this.canOverlap?x.sortKey:void 0),ge=this.glyphOffsetArray.length,be=ie.vertexLength,Se=this.allowVerticalPlacement&&I===fc.vertical?Math.PI/2:0,Ve=x.text&&x.text.sections;for(let Be=0;Be<c.length;Be++){const{tl:Qe,tr:Ue,bl:Je,br:lt,texPrimary:st,texSecondary:mt,pixelOffsetTL:pt,pixelOffsetBR:vt,minFontScaleX:_t,minFontScaleY:Et,glyphOffset:qt,isSDF:Ht,sectionIndex:Cn}=c[Be],Qt=ie.vertexLength,ln=qt[1];if(qE(ce,L.x,L.y,Qe.x,ln+Qe.y,st.x,st.y,f,Ht,pt.x,pt.y,_t,Et),qE(ce,L.x,L.y,Ue.x,ln+Ue.y,st.x+st.w,st.y,f,Ht,vt.x,pt.y,_t,Et),qE(ce,L.x,L.y,Je.x,ln+Je.y,st.x,st.y+st.h,f,Ht,pt.x,vt.y,_t,Et),qE(ce,L.x,L.y,lt.x,ln+lt.y,st.x+st.w,st.y+st.h,f,Ht,vt.x,vt.y,_t,Et),D){const{x:Yt,y:Zn,z:bn}=D.anchor,[Pn,ar,Pr]=D.up;YE(le,Yt,Zn,bn,Pn,ar,Pr),YE(le,Yt,Zn,bn,Pn,ar,Pr),YE(le,Yt,Zn,bn,Pn,ar,Pr),YE(le,Yt,Zn,bn,Pn,ar,Pr),XE(o.dynamicLayoutVertexArray,Yt,Zn,bn,Se)}else XE(o.dynamicLayoutVertexArray,L.x,L.y,L.z,Se);if(X){const Yt=mt||st;GE(o.iconTransitioningVertexArray,Yt.x,Yt.y),GE(o.iconTransitioningVertexArray,Yt.x+Yt.w,Yt.y),GE(o.iconTransitioningVertexArray,Yt.x,Yt.y+Yt.h),GE(o.iconTransitioningVertexArray,Yt.x+Yt.w,Yt.y+Yt.h)}J.emplaceBack(Qt,Qt+1,Qt+2),J.emplaceBack(Qt+1,Qt+2,Qt+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qt[0]),Be!==c.length-1&&Cn===c[Be+1].sectionIndex||o.programConfigurations.populatePaintArrays(ce.length,x,x.index,{},O,B,U,Ve&&Ve[Cn])}const Le=D?D.anchor:L;o.placedSymbolArray.emplaceBack(Le.x,Le.y,Le.z,L.x,L.y,ge,this.glyphOffsetArray.length-ge,be,T,k,L.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],I,0,!1,0,z,0)}_commitLayoutVertex(o,c,f,g,p,x,I){o.emplaceBack(c,f,g,p,x,Math.round(I.x),Math.round(I.y))}_addCollisionDebugVertices(o,c,f,g,p,x,I){const D=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),L=D.vertexLength,T=I.tileAnchorX,k=I.tileAnchorY;for(let O=0;O<4;O++)f.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(f.collisionVertexArrayExt,c,o.padding,I.zOffset),this._commitLayoutVertex(f.layoutVertexArray,g,p,x,T,k,new Ot(o.x1,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,g,p,x,T,k,new Ot(o.x2,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,g,p,x,T,k,new Ot(o.x2,o.y2)),this._commitLayoutVertex(f.layoutVertexArray,g,p,x,T,k,new Ot(o.x1,o.y2)),D.vertexLength+=4;const z=f.indexArray;z.emplaceBack(L,L+1),z.emplaceBack(L+1,L+2),z.emplaceBack(L+2,L+3),z.emplaceBack(L+3,L),D.primitiveLength+=4}_addTextDebugCollisionBoxes(o,c,f,g,p,x){for(let I=g;I<p;I++){const D=f.get(I),L=this.getSymbolInstanceTextSize(o,x,c,I);this._addCollisionDebugVertices(D,L,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(o,c,f,g,p,x){for(let I=g;I<p;I++){const D=f.get(I),L=this.getSymbolInstanceIconSize(o,c,x.placedIconSymbolIndex);this._addCollisionDebugVertices(D,L,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,x)}}generateCollisionDebugBuffers(o,c,f){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sP(Jm,HB.members,Qh),this.iconCollisionBox=new sP(Jm,HB.members,Qh);const g=g0(this.iconSizeData,o),p=g0(this.textSizeData,o,f);for(let x=0;x<this.symbolInstances.length;x++){const I=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(p,o,c,I.textBoxStartIndex,I.textBoxEndIndex,I),this._addTextDebugCollisionBoxes(p,o,c,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I),this._addIconDebugCollisionBoxes(g,o,c,I.iconBoxStartIndex,I.iconBoxEndIndex,I),this._addIconDebugCollisionBoxes(g,o,c,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I)}}getSymbolInstanceTextSize(o,c,f,g){const p=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:g),x=LE(this.textSizeData,o,p)/Ra;return this.tilePixelRatio*x}getSymbolInstanceIconSize(o,c,f){const g=this.icon.placedSymbolArray.get(f),p=LE(this.iconSizeData,o,g);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(o,c,f,g){o.emplaceBack(c,-f,-f,g),o.emplaceBack(c,f,-f,g),o.emplaceBack(c,f,f,g),o.emplaceBack(c,-f,f,g)}_updateTextDebugCollisionBoxes(o,c,f,g,p,x,I){for(let D=g;D<p;D++){const L=f.get(D),T=this.getSymbolInstanceTextSize(o,x,c,D);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,L.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(o,c,f,g,p,x,I){for(let D=g;D<p;D++){const L=f.get(D),T=this.getSymbolInstanceIconSize(o,c,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,L.padding,x.zOffset)}}updateCollisionDebugBuffers(o,c,f,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=g0(this.iconSizeData,o,g),x=g0(this.textSizeData,o,f);for(let I=0;I<this.symbolInstances.length;I++){const D=this.symbolInstances.get(I);this._updateTextDebugCollisionBoxes(x,o,c,D.textBoxStartIndex,D.textBoxEndIndex,D,f),this._updateTextDebugCollisionBoxes(x,o,c,D.verticalTextBoxStartIndex,D.verticalTextBoxEndIndex,D,f),this._updateIconDebugCollisionBoxes(p,o,c,D.iconBoxStartIndex,D.iconBoxEndIndex,D,g),this._updateIconDebugCollisionBoxes(p,o,c,D.verticalIconBoxStartIndex,D.verticalIconBoxEndIndex,D,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,c,f,g,p,x,I,D,L){const T={};if(c<f){const{x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie,featureIndex:ge}=o.get(c);T.textBox={x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie},T.textFeatureIndex=ge}if(g<p){const{x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie,featureIndex:ge}=o.get(g);T.verticalTextBox={x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie},T.verticalTextFeatureIndex=ge}if(x<I){const{x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie,featureIndex:ge}=o.get(x);T.iconBox={x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie},T.iconFeatureIndex=ge}if(D<L){const{x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie,featureIndex:ge}=o.get(D);T.verticalIconBox={x1:k,y1:z,x2:O,y2:B,padding:U,projectedAnchorX:X,projectedAnchorY:J,projectedAnchorZ:ce,tileAnchorX:le,tileAnchorY:ie},T.verticalIconFeatureIndex=ge}return T}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,c){const f=o.placedSymbolArray.get(c),g=f.vertexStartIndex+4*f.numGlyphs;for(let p=f.vertexStartIndex;p<g;p+=4)o.indexArray.emplaceBack(p,p+1,p+2),o.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(o),f=Math.cos(o),g=[],p=[],x=[];for(let I=0;I<this.symbolInstances.length;++I){x.push(I);const D=this.symbolInstances.get(I);g.push(0|Math.round(c*D.tileAnchorX+f*D.tileAnchorY)),p.push(D.featureIndex)}return x.sort((I,D)=>g[I]-g[D]||p[D]-p[I]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:I,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:L}=f;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),p>=0&&p!==g&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&x!==p&&x!==g&&this.addIndicesForPlacedSymbol(this.text,x),I>=0&&this.addIndicesForPlacedSymbol(this.text,I),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Iz,Az,oP;Tn(KE,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),KE.addDynamicAttributes=XE;class Rz{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Vr,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tn(Rz,"FormatSectionOverride",{omit:["defaultValue"]});const aP=()=>oP||(oP={layout:Iz||(Iz=new Ds({"symbol-placement":new on(St.layout_symbol["symbol-placement"]),"symbol-spacing":new on(St.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new on(St.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Sn(St.layout_symbol["symbol-sort-key"]),"symbol-z-order":new on(St.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new on(St.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new on(St.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new on(St.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new on(St.layout_symbol["icon-ignore-placement"]),"icon-optional":new on(St.layout_symbol["icon-optional"]),"icon-rotation-alignment":new on(St.layout_symbol["icon-rotation-alignment"]),"icon-size":new Sn(St.layout_symbol["icon-size"]),"icon-size-scale-range":new on(St.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Sn(St.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Sn(St.layout_symbol["icon-text-fit-padding"]),"icon-image":new Sn(St.layout_symbol["icon-image"]),"icon-rotate":new Sn(St.layout_symbol["icon-rotate"]),"icon-padding":new on(St.layout_symbol["icon-padding"]),"icon-keep-upright":new on(St.layout_symbol["icon-keep-upright"]),"icon-offset":new Sn(St.layout_symbol["icon-offset"]),"icon-anchor":new Sn(St.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new on(St.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new on(St.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new on(St.layout_symbol["text-rotation-alignment"]),"text-field":new Sn(St.layout_symbol["text-field"]),"text-font":new Sn(St.layout_symbol["text-font"]),"text-size":new Sn(St.layout_symbol["text-size"]),"text-size-scale-range":new on(St.layout_symbol["text-size-scale-range"]),"text-max-width":new Sn(St.layout_symbol["text-max-width"]),"text-line-height":new Sn(St.layout_symbol["text-line-height"]),"text-letter-spacing":new Sn(St.layout_symbol["text-letter-spacing"]),"text-justify":new Sn(St.layout_symbol["text-justify"]),"text-radial-offset":new Sn(St.layout_symbol["text-radial-offset"]),"text-variable-anchor":new on(St.layout_symbol["text-variable-anchor"]),"text-anchor":new Sn(St.layout_symbol["text-anchor"]),"text-max-angle":new on(St.layout_symbol["text-max-angle"]),"text-writing-mode":new on(St.layout_symbol["text-writing-mode"]),"text-rotate":new Sn(St.layout_symbol["text-rotate"]),"text-padding":new on(St.layout_symbol["text-padding"]),"text-keep-upright":new on(St.layout_symbol["text-keep-upright"]),"text-transform":new Sn(St.layout_symbol["text-transform"]),"text-offset":new Sn(St.layout_symbol["text-offset"]),"text-allow-overlap":new on(St.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new on(St.layout_symbol["text-ignore-placement"]),"text-optional":new on(St.layout_symbol["text-optional"]),visibility:new on(St.layout_symbol.visibility)})),paint:Az||(Az=new Ds({"icon-opacity":new Sn(St.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Sn(St.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Sn(St.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Sn(St.paint_symbol["text-emissive-strength"]),"icon-color":new Sn(St.paint_symbol["icon-color"]),"icon-halo-color":new Sn(St.paint_symbol["icon-halo-color"]),"icon-halo-width":new Sn(St.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Sn(St.paint_symbol["icon-halo-blur"]),"icon-translate":new on(St.paint_symbol["icon-translate"]),"icon-translate-anchor":new on(St.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Sn(St.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Sn(St.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Sn(St.paint_symbol["text-occlusion-opacity"]),"text-color":new Sn(St.paint_symbol["text-color"],{runtimeType:oo,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new Sn(St.paint_symbol["text-halo-color"]),"text-halo-width":new Sn(St.paint_symbol["text-halo-width"]),"text-halo-blur":new Sn(St.paint_symbol["text-halo-blur"]),"text-translate":new on(St.paint_symbol["text-translate"]),"text-translate-anchor":new on(St.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new on(St.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new on(St.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new on(St.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new on(St.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Sn(St.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},oP);class ZE extends Qo{constructor(o,c,f,g){super(o,aP(),c,f,g),this._colorAdjustmentMatrix=Pe.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=o.paint!==void 0&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,c){super.recalculate(o,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const p of f)g.indexOf(p)<0&&g.push(p);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,c,f,g){return this._saturation===o&&this._contrast===c&&this._brightnessMin===f&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(p,x,I,D){p=It(p),x=io(x);const L=Pe.mat4.create(),T=p/3,k=1-2*T,z=[k,T,T,0,T,k,T,0,T,T,k,0,0,0,0,1],O=.5-.5*x,B=D-I;return Pe.mat4.multiply(L,[B,0,0,0,0,B,0,0,0,0,B,0,I,I,I,1],[x,0,0,0,0,x,0,0,0,0,x,0,O,O,O,1]),Pe.mat4.multiply(L,L,z),L}(o,c,f,g),this._saturation=o,this._contrast=c,this._brightnessMin=f,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,c,f,g){const p=this.layout.get(o).evaluate(c,{},f,g),x=this._unevaluatedLayout._values[o];return x.isDataDriven()||H_(x.value)||!p?p:function(I,D){return D.replace(/{([^{}]+)}/g,(L,T)=>T in I?String(I[T]):"")}(c.properties,p)}createBucket(o){return new KE(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of aP().paint.overridableProperties){if(!ZE.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),f=new Rz(c),g=new a1(f,c.property.specification,this.scope,this.options);let p=null;p=c.value.kind==="constant"||c.value.kind==="source"?new l1("source",g):new Qf("composite",g,c.value.zoomStops,c.value._interpolationType),this.paint._values[o]=new rp(c.property,p,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&ZE.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const f=o.get("text-field"),g=aP().paint.properties[c];let p=!1;const x=I=>{for(const D of I)if(g.overrides&&g.overrides.hasOverride(D))return void(p=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Rs)x(f.value.value.sections);else if(f.value.kind==="source"){const I=L=>{p||(L instanceof Zt&&Ki(L.value)===Pl?x(L.value.sections):L instanceof dl?x(L.sections):L.eachChild(I))},D=f.value;D._styleExpression&&I(D._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,c,f){return{config:new qd(this,{zoom:c,lut:f}),overrideFog:!1}}}let Mz,Pz,Dz,kz;var lP=yi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function cP(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function uP(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class hP{constructor(o,c,f,g){this.context=o,this.format=f,this.useMipmap=g&&g.useMipmap,this.texture=o.gl.createTexture(),this.update(c,{premultiply:g&&g.premultiply})}update(o,c){const f=o&&o instanceof HTMLVideoElement&&o.width===0?o.videoWidth:o.width,g=o&&o instanceof HTMLVideoElement&&o.height===0?o.videoHeight:o.height,{context:p}=this,{gl:x}=p,{x:I,y:D}=c&&c.position?c.position:{x:0,y:0},L=I+f,T=D+g;!this.size||this.size[0]===L&&this.size[1]===T||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!c||c.premultiply!==!1));const k=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&L>0&&T>0){const z=this.useMipmap?Math.floor(Math.log2(Math.max(L,T)))+1:1;x.texStorage2D(x.TEXTURE_2D,z,this.format,L,T),this.size=[L,T]}if(this.size)if(k)x.texSubImage2D(x.TEXTURE_2D,0,I,D,cP(this.format),uP(this.format),o);else{const z=o.data;z&&x.texSubImage2D(x.TEXTURE_2D,0,I,D,f,g,cP(this.format),uP(this.format),z)}this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(o,c,f=!1){const{context:g}=this,{gl:p}=g;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!f?o===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),c!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,c),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(o,c,f,g){const{context:p}=this,{gl:x}=p;x.bindTexture(x.TEXTURE_2D,this.texture),c!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,c),this.magFilter=c),o!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?o===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),f!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,f),this.wrapS=f),g!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,g),this.wrapT=g)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class QE{constructor(o,c){this.context=o,this.texture=c}bind(o,c){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),o!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,o),this.minFilter=o),c!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,c),this.wrapS=c)}}function JE(d,o,c,f,g,p,x,I){const D=[d,o,1,c,f,1,g,p,1],L=[x,I,1],T=Pe.mat3.adjoint([],D),[k,z,O]=Pe.vec3.transformMat3(L,L,T);return Pe.mat3.multiply(D,D,[k,0,0,0,z,0,0,0,O])}function Nz(d,o,c,f,g,p,x,I){const D=function(L,T,k,z,O,B,U,X){const J=JE(0,0,1,0,1,1,0,1),ce=JE(L,T,k,z,O,B,U,X),le=Pe.mat3.adjoint([],J);return Pe.mat3.multiply(ce,ce,le)}(d,o,c,f,g,p,x,I);return[D[2]/D[8]/sn,D[5]/D[8]/sn]}function eS(d){return[d[0],Math.min(Math.max(d[1],-85.051129),pl)]}class Oz extends qs{constructor(o,c,f,g){super(),this.id=o,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=c,this._dirty=!1}load(o,c){if(this._loaded=c||!1,this.fire(new zi("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=zs(this.map._requestManager.transformRequest(this.url,qr.Image),(f,g)=>{this._imageRequest=null,this._loaded=!0,f?this.fire(new so(f)):g&&(this.image=g instanceof HTMLImageElement?Mt.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new QE(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new zi("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof QE||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=o[0][1],f=o[0][1];for(const p of o)p[1]>f&&(f=p[1]),p[1]<c&&(c=p[1]);const g=(f+c)/2;if(g>pl?this.onNorthPole=!0:g<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=o.map(a.fromLngLat);this.tileID=function(x){let I=1/0,D=1/0,L=-1/0,T=-1/0;for(const U of x)I=Math.min(I,U.x),D=Math.min(D,U.y),L=Math.max(L,U.x),T=Math.max(T,U.y);const k=Math.max(L-I,T-D),z=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),O=Math.pow(2,z);let B=Math.floor((I+L)/2*O);return B>1&&(B-=1),new Ut(z,B,Math.floor((D+T)/2*O))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new zi("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const J in this.tiles){const ce=this.tiles[J];ce.state!=="loaded"&&(ce.state="loaded",ce.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=sv(new Ut(0,0,0),this.map.transform.projection),f=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(J){const ce=J[1].x-J[0].x,le=J[1].y-J[0].y,ie=J[2].x-J[1].x,ge=J[2].y-J[1].y,be=J[3].x-J[2].x,Se=J[3].y-J[2].y,Ve=J[0].x-J[3].x,Le=J[0].y-J[3].y,Be=ce*ge-ie*le,Qe=ie*Se-be*ge,Ue=be*Le-Ve*Se,Je=Ve*le-ce*Le;return Be>0&&Qe>0&&Ue>0&&Je>0||Be<0&&Qe<0&&Ue<0&&Je<0}(f))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=sv(this.tileID,this.map.transform.projection),[p,x,I,D]=this.coordinates.map(J=>{const ce=g.projection.project(J[0],J[1]);return bz(g,ce)._round()});this.perspectiveTransform=Nz(p.x,p.y,x.x,x.y,I.x,I.y,D.x,D.y);const L=this._boundsArray=new oh;L.emplaceBack(p.x,p.y,0,0),L.emplaceBack(x.x,x.y,sn,0),L.emplaceBack(D.x,D.y,0,sn),L.emplaceBack(I.x,I.y,sn,sn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(L,lP.members),this.boundsSegments=xs.simpleSegment(0,0,4,2);const T=[],k=[eS((z=this.coordinates)[0]),eS(z[1]),eS(z[2]),eS(z[3])];var z;const[O,B,U,X]=function(J){let ce=J[0][0],le=ce,ie=J[0][1],ge=ie;for(let be=1;be<J.length;be++)J[be][0]<ce?ce=J[be][0]:J[be][0]>le&&(le=J[be][0]),J[be][1]<ie?ie=J[be][1]:J[be][1]>ge&&(ge=J[be][1]);return[ce,ie,le-ce,ge-ie]}(k);{const J=new oh,[ce,le,ie,ge]=function(pt){let vt=pt[0].x,_t=vt,Et=pt[0].y,qt=Et;for(let Ht=1;Ht<pt.length;Ht++)pt[Ht].x<vt?vt=pt[Ht].x:pt[Ht].x>_t&&(_t=pt[Ht].x),pt[Ht].y<Et?Et=pt[Ht].y:pt[Ht].y>qt&&(qt=pt[Ht].y);return[vt,Et,_t-vt,qt-Et]}(f),be=pt=>[(pt.x-ce)/ie,(pt.y-le)/ge],[Se,Ve,Le,Be]=f.map(be),Qe=function(pt,vt,_t,Et,qt,Ht,Cn,Qt){const ln=JE(0,0,1,0,1,1,0,1),Yt=JE(pt,vt,_t,Et,qt,Ht,Cn,Qt),Zn=Pe.mat3.adjoint([],Yt);return Pe.mat3.multiply(ln,ln,Zn)}(Se[0],Se[1],Ve[0],Ve[1],Le[0],Le[1],Be[0],Be[1]);this.elevatedGlobePerspectiveTransform=Nz(Se[0],Se[1],Ve[0],Ve[1],Le[0],Le[1],Be[0],Be[1]);const Ue=(pt,vt)=>{T.push(pt.lng);const _t=Math.round((pt.lng-O)/U*sn),Et=Math.round((pt.lat-B)/X*sn),qt=be(vt),Ht=Pe.vec3.transformMat3([],[qt[0],qt[1],1],Qe),Cn=Math.round(Ht[0]/Ht[2]*sn),Qt=Math.round(Ht[1]/Ht[2]*sn);J.emplaceBack(_t,Et,Cn,Qt)},Je=f[3].x-f[0].x,lt=f[3].y-f[0].y,st=f[2].x-f[1].x,mt=f[2].y-f[1].y;for(let pt=0;pt<65;pt++){const vt=pt/64,_t=[f[0].x+vt*Je,f[0].y+vt*lt],Et=[f[1].x+vt*st,f[1].y+vt*mt],qt=Et[0]-_t[0],Ht=Et[1]-_t[1];for(let Cn=0;Cn<65;Cn++){const Qt=Cn/64,ln={x:_t[0]+qt*Qt,y:_t[1]+Ht*Qt};Ue(c.projection.unproject(ln.x,ln.y),ln)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(J,lP.members)}{this.maxLongitudeTriangleSize=0;let J=[],ce=new la;const le=(ie,ge,be)=>{ce.emplaceBack(ie,ge,be);const Se=T[ie],Ve=T[ge],Le=T[be],Be=Math.min(Math.min(Se,Ve),Le),Qe=Math.max(Math.max(Se,Ve),Le)-Be;Qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Qe),J.push(Be+Qe/2)};for(let ie=0;ie<64;ie++)for(let ge=0;ge<64;ge++){const be=65*ie+ge,Se=be+1,Ve=be+65,Le=Ve+1;le(be,Ve,Se),le(Se,Ve,Le)}[J,ce]=function(ie,ge){const be=Array.from({length:ie.length},(Le,Be)=>Be);be.sort((Le,Be)=>ie[Le]-ie[Be]);const Se=[],Ve=new la;for(let Le=0;Le<be.length;Le++){const Be=be[Le];Se.push(ie[Be]);const Qe=3*Be,Ue=Qe+1;Ve.emplaceBack(ge.uint16[Qe],ge.uint16[Ue],ge.uint16[Ue+1])}return[Se,Ve]}(J,ce),this.elevatedGlobeTrianglesCenterLongitudes=J,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(ce)}this.elevatedGlobeSegments=xs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,U/sn,0,X/sn,0,0,B,O,0])}prepare(){const o=Object.keys(this.tiles).length!==0;if(this.tileID&&!o)return;const c=this.map.painter.context,f=c.gl;!this._dirty||this.texture instanceof QE||(this.texture?this.texture.update(this.image):(this.texture=new hP(c,this.image,f.RGBA8),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(c)}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const f=this.elevatedGlobeTrianglesCenterLongitudes;let g=(p=o+180)+360*Math.round((f[0]-p)/360);var p;const x=new xs,I=(k,z)=>{x.segments.push({vertexOffset:0,primitiveOffset:k,vertexLength:c.segments[0].vertexLength,primitiveLength:z,sortKey:void 0,vaos:{}})},D=.51*this.maxLongitudeTriangleSize;if(Math.abs(f[0]-g)<=D){const k=sc(f,0,f.length,g+D);return k===f.length||I(k,ia(f,k+1,f.length,g+360-D)-k),x}g<f[0]&&(g+=360);const L=ia(f,0,f.length,g-D);if(L===f.length)return I(0,f.length),x;I(0,L-0);const T=sc(f,L+1,f.length,g+D);return T!==f.length&&I(T,f.length-T),x}}const Oie=(Math.pow(256,2)-1)/16907520;class Lz extends Qo{constructor(o,c,f,g){super(o,{layout:Dz||(Dz=new Ds({visibility:new on(St.layout_raster.visibility)})),paint:kz||(kz=new Ds({"raster-opacity":new on(St.paint_raster["raster-opacity"]),"raster-color":new sp(St.paint_raster["raster-color"]),"raster-color-mix":new on(St.paint_raster["raster-color-mix"]),"raster-color-range":new on(St.paint_raster["raster-color-range"]),"raster-hue-rotate":new on(St.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new on(St.paint_raster["raster-brightness-min"]),"raster-brightness-max":new on(St.paint_raster["raster-brightness-max"]),"raster-saturation":new on(St.paint_raster["raster-saturation"]),"raster-contrast":new on(St.paint_raster["raster-contrast"]),"raster-resampling":new on(St.paint_raster["raster-resampling"]),"raster-fade-duration":new on(St.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new on(St.paint_raster["raster-emissive-strength"]),"raster-array-band":new on(St.paint_raster["raster-array-band"]),"raster-elevation":new on(St.paint_raster["raster-elevation"]),"raster-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},c,f,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof Oz&&(o._source.onNorthPole||o._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(o){o!=="raster-color"&&o!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[f,g]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(f)&&isNaN(g)||f===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=$1({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:f,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[f,g])}}let Fz,Bz,zz,jz,Vz;class Uz extends Qo{constructor(o,c,f,g){super(o,{layout:Fz||(Fz=new Ds({visibility:new on(St["layout_raster-particle"].visibility)})),paint:Bz||(Bz=new Ds({"raster-particle-array-band":new on(St["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new on(St["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new sp(St["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new on(St["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new on(St["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new on(St["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new on(St["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new on(St["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},c,f,g),this._updateColorRamp(),this.lastInvalidatedAt=Mt.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){o!=="raster-particle-color"&&o!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),o==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=$1({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Mt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Lie extends Qo{constructor(o,c){super(o,{},c,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(o){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function dP(d,o,c){const f=[0,0,1],g=Pe.quat.identity([]);return Pe.quat.rotateY(g,g,c?-Mn(d)+Math.PI:Mn(d)),Pe.quat.rotateX(g,g,-Mn(o)),Pe.vec3.transformQuat(f,f,g),Pe.vec3.normalize(f,f)}function Hz(d,o){const c=tS(d.projection,d.zoom,d.width,d.height),f=function(p,x,I,D,L){const T=new xi(I.lng-180*vp,I.lat),k=new xi(I.lng+180*vp,I.lat),z=p.project(T.lng,T.lat),O=p.project(k.lng,k.lat),B=-Math.atan2(O.y-z.y,O.x-z.x),U=a.fromLngLat(I);U.y=Bn(U.y,-1+vp,1-vp);const X=U.toLngLat(),J=p.project(X.lng,X.lat),ce=a.fromLngLat(X);ce.x+=vp;const le=ce.toLngLat(),ie=p.project(le.lng,le.lat),ge=$z(ie.x-J.x,ie.y-J.y,B),be=a.fromLngLat(X);be.y+=vp;const Se=be.toLngLat(),Ve=p.project(Se.lng,Se.lat),Le=$z(Ve.x-J.x,Ve.y-J.y,B),Be=Math.abs(ge.x)/Math.abs(Le.y),Qe=Pe.mat4.identity([]);Pe.mat4.rotateZ(Qe,Qe,-B*(1-(L?0:D)));const Ue=Pe.mat4.identity([]);return Pe.mat4.scale(Ue,Ue,[1,1-(1-Be)*D,1]),Ue[4]=-Le.x/Le.y*D,Pe.mat4.rotateZ(Ue,Ue,B),Pe.mat4.multiply(Ue,Qe,Ue),Ue}(d.projection,0,d.center,c,o),g=Wz(d);return Pe.mat4.scale(f,f,[g,g,1]),f}function Wz(d){const o=d.projection,c=tS(d.projection,d.zoom,d.width,d.height),f=fP(o,d.center),g=fP(o,xi.convert(o.center));return Math.pow(2,f*c+(1-c)*g)}function tS(d,o,c,f,g=1/0){const p=d.range;if(!p)return 0;const x=Math.min(g,Math.max(c,f)),I=Math.log(x/1024)/Math.LN2;return Es(p[0]+I,p[1]+I,o)}const vp=1/4e4;function fP(d,o){const c=Bn(o.lat,-85.051129,pl),f=new xi(o.lng-180*vp,c),g=new xi(o.lng+180*vp,c),p=d.project(f.lng,c),x=d.project(g.lng,c),I=a.fromLngLat(f),D=a.fromLngLat(g),L=x.x-p.x,T=x.y-p.y,k=D.x-I.x,z=D.y-I.y,O=Math.sqrt((k*k+z*z)/(L*L+T*T));return Math.log(O)/Math.LN2}function $z(d,o,c){const f=Math.cos(c),g=Math.sin(c);return{x:d*f-o*g,y:d*g+o*f}}function qz(d,o,c){Pe.mat4.identity(d),Pe.mat4.rotateZ(d,d,Mn(o[2])),Pe.mat4.rotateX(d,d,Mn(o[0])),Pe.mat4.rotateY(d,d,Mn(o[1])),Pe.mat4.scale(d,d,c),Pe.mat4.multiply(d,d,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function nS(d,o,c,f,g,p,x,I){const D=[c[0]-o[0],c[1]-o[1],0],L=[f[0]-o[0],f[1]-o[1],0];if(Pe.vec3.length(D)<1e-12||Pe.vec3.length(L)<1e-12)return Pe.quat.identity(d);const T=Pe.vec3.cross([],D,L);Pe.vec3.normalize(T,T),Pe.vec3.subtract(L,f,o),D[2]=(p-g)*I,L[2]=(x-g)*I;const k=D;return Pe.vec3.cross(k,D,L),Pe.vec3.normalize(k,k),Pe.quat.rotationTo(d,T,k)}function pP(d,o,c=!1){const f=ml(o.zoom),g=function(p,x,I){const D=x.worldSize,L=[p[12],p[13],p[14]],T=ca(L[1]/D),k=Bl(L[0]/D),z=Pe.mat4.identity([]),O=Ia(1,T)*D,B=Ia(1,0)*D*nd(T,x.zoom),U=1/Du(D);let X=B*U;if(I){const ie=tS(x.projection,x.zoom,x.width,x.height,1024);X=U*x.projection.pixelSpaceConversion(x.center.lat,D,ie)}const J=Gd(T,k);Pe.vec3.add(J,J,Pe.vec3.scale([],Pe.vec3.normalize([],J),O*X*L[2]));const ce=function(ie){const ge=[ie[0],ie[1],ie[2]];let be=[0,1,0];const Se=Pe.vec3.cross([],be,ge);return Pe.vec3.cross(be,ge,Se),Pe.vec3.squaredLength(be)===0&&(be=[0,1,0],Pe.vec3.cross(Se,ge,be)),Pe.vec3.normalize(Se,Se),Pe.vec3.normalize(be,be),Pe.vec3.normalize(ge,ge),[Se[0],Se[1],Se[2],0,be[0],be[1],be[2],0,ge[0],ge[1],ge[2],0,ie[0],ie[1],ie[2],1]}(J);Pe.mat4.scale(z,z,[X,X,X*O]),Pe.mat4.translate(z,z,[-L[0],-L[1],-L[2]]);const le=Pe.mat4.multiply([],x.globeMatrix,ce);return Pe.mat4.multiply(le,le,z),Pe.mat4.multiply(le,le,p),le}(d,o,c);if(f>0){const p=function(x,I){const D=I.worldSize,L=Ia(1,0)*D*nd(I.center.lat,I.zoom)/Du(D),T=Ia(1,I.center.lat)*D,k=Pe.mat4.identity([]);return Pe.mat4.rotateY(k,k,Mn(I.center.lng)),Pe.mat4.rotateX(k,k,Mn(I.center.lat)),Pe.mat4.translate(k,k,[0,0,Ja]),Pe.mat4.scale(k,k,[L,L,L*T]),Pe.mat4.translate(k,k,[I.point.x-.5*D,I.point.y-.5*D,0]),Pe.mat4.multiply(k,k,x),Pe.mat4.multiply(k,I.globeMatrix,k)}(d,o);return function(x,I,D){const L=(B,U,X)=>{const J=Pe.vec3.length(B),ce=Pe.vec3.length(U),le=zo(B,U,X);return Pe.vec3.scale(le,le,1/Pe.vec3.length(le)*Wn(J,ce,X))},T=L([x[0],x[1],x[2]],[I[0],I[1],I[2]],D),k=L([x[4],x[5],x[6]],[I[4],I[5],I[6]],D),z=L([x[8],x[9],x[10]],[I[8],I[9],I[10]],D),O=zo([x[12],x[13],x[14]],[I[12],I[13],I[14]],D);return[T[0],T[1],T[2],0,k[0],k[1],k[2],0,z[0],z[1],z[2],0,O[0],O[1],O[2],1]}(g,p,f)}return g}function Gz(d,o,c,f){const g=Nn.projectAabbCorners(f,c);let p=Number.MAX_VALUE,x=-1;for(let L=0;L<g.length;++L){const T=g[L];T[0]=(.5*T[0]+.5)*o.width,T[1]=(.5-.5*T[1])*o.height,T[2]<p&&(x=L,p=T[2])}const I=L=>new Ot(g[L][0],g[L][1]);let D;switch(x){case 0:case 6:D=[I(1),I(5),I(4),I(7),I(3),I(2),I(1)];break;case 1:case 7:D=[I(0),I(4),I(5),I(6),I(2),I(3),I(0)];break;case 3:case 5:D=[I(1),I(0),I(4),I(7),I(6),I(2),I(1)];break;default:D=[I(1),I(5),I(6),I(7),I(3),I(0),I(1)]}if(we(d,D))return p}const Fie=yi([{name:"a_pos_3f",components:3,type:"Float32"}]),Bie=yi([{name:"a_color_3f",components:3,type:"Float32"}]),zie=yi([{name:"a_color_4f",components:4,type:"Float32"}]),jie=yi([{name:"a_uv_2f",components:2,type:"Float32"}]),Vie=yi([{name:"a_normal_3f",components:3,type:"Float32"}]),Uie=yi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Hie=yi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Yz={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class rS{constructor(o,c,f,g){this.message=(o?`${o}: `:"")+f,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Xz(d,o){const c=d.indexOf("://")===-1;try{return new URL(d,c&&o?"http://example.com":void 0),!0}catch{return!1}}class Kz{constructor(o,c){this.feature=o,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Zz{constructor(){this.instancedDataArray=new a0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class mP{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(o,c){}populate(o,c,f,g){this.tileToMeter=y(f);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:I,index:D,sourceLayerIndex:L}of o){const T=I??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),k=Y(x,p);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),k,f))continue;const z={id:T,sourceLayerIndex:L,index:D,geometry:p?k.geometry:G(x,f,g),properties:x.properties,type:x.type,patterns:{}},O=this.addFeature(z,z.geometry,k);O&&c.featureIndex.insert(x,z.geometry,D,L,this.index,this.instancesPerModel[O].instancedDataArray.length,sn/32)}this.lookup=null}update(o,c,f,g){for(const p in this.instancesPerModel){const x=this.instancesPerModel[p];for(const I in o)x.idToFeaturesIndex.hasOwnProperty(I)&&(this.evaluate(x.features[x.idToFeaturesIndex[I]],o[I],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const g of f.features){const p=this.layers[0],x=g.feature,I=this.canonical,D=p.paint.get("model-rotation").evaluate(x,{},I),L=p.paint.get("model-scale").evaluate(x,{},I),T=p.paint.get("model-translation").evaluate(x,{},I);Pe.vec3.exactEquals(g.rotation,D)&&Pe.vec3.exactEquals(g.scale,L)&&Pe.vec3.exactEquals(g.translation,T)||(this.evaluate(g,g.featureStates,f,!0),o=!0)}}return o}updateReplacement(o,c,f,g){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(jM(this.activeReplacements,p))return!1;this.activeReplacements=p;let x=!1;for(const I in this.instancesPerModel){const D=this.instancesPerModel[I],L=D.instancedDataArray;for(const T of D.features){const k=T.instancedDataOffset,z=T.instancedDataCount;for(let O=0;O<z;O++){const B=16*(O+k);let U=L.float32[B+0];const X=U>sn;U=X?U-sn:U;const J=Math.floor(U),ce=L.float32[B+1];let le=!1;for(const ie of this.activeReplacements)if(!aB(ie,f,Yz.Model,g)&&!(ie.min.x>J||J>ie.max.x||ie.min.y>ce||ce>ie.max.y)&&(le=fB(dB(J,ce,o.canonical,ie.footprintTileId.canonical),ie.footprint),le))break;L.float32[B]=le?U+sn:U,x=x||le!==X}}}return x}isEmpty(){for(const o in this.instancesPerModel)if(this.instancesPerModel[o].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length<0||f.instancedDataArray.length===0||(f.instancedDataBuffer?f.instancedDataBuffer.updateData(f.instancedDataArray):f.instancedDataBuffer=o.createVertexBuffer(f.instancedDataArray,Uie.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length!==0&&f.instancedDataBuffer&&f.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(o&&this.modelUris)for(const c of this.modelUris)o.removeModel(c,"")}addFeature(o,c,f){const g=this.layers[0],p=g.layout.get("model-id").evaluate(f,{},this.canonical);if(!p)return Nr(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),p;Xz(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new Zz);const x=this.instancesPerModel[p],I=x.instancedDataArray,D=new Kz(f,I.length);for(const L of c)for(const T of L){if(T.x<0||T.x>=sn||T.y<0||T.y>=sn)continue;const k=(this.lookupDim-1)/sn,z=this.lookupDim*(T.y*k|0)+T.x*k|0;if(this.lookup){if(this.lookup[z]!==0)continue;this.lookup[z]=1}this.instanceCount++;const O=I.length;I.resize(O+1),x.instancesEvaluatedElevation.push(0),I.float32[16*O]=T.x,I.float32[16*O+1]=T.y}return D.instancedDataCount=x.instancedDataArray.length-D.instancedDataOffset,D.instancedDataCount>0&&(o.id&&(x.idToFeaturesIndex[o.id]=x.features.length),x.features.push(D),this.evaluate(D,{},x,!1)),p}getModelUris(){return this.modelUris}evaluate(o,c,f,g){const p=this.layers[0],x=o.feature,I=this.canonical,D=o.rotation=p.paint.get("model-rotation").evaluate(x,c,I),L=o.scale=p.paint.get("model-scale").evaluate(x,c,I),T=o.translation=p.paint.get("model-translation").evaluate(x,c,I),k=p.paint.get("model-color").evaluate(x,c,I);k.a=p.paint.get("model-color-mix-intensity").evaluate(x,c,I);const z=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,L[0]),Math.max(L[1],L[2])),qz(z,D,L);const O=Math.round(100*k.a)+k.b/1.05;for(let B=0;B<o.instancedDataCount;++B){const U=o.instancedDataOffset+B,X=16*U,J=f.instancedDataArray.float32;let ce=0;g&&(ce=J[X+6]-f.instancesEvaluatedElevation[U]);const le=0|J[X+1];J[X]=(0|J[X])+k.r/1.05,J[X+1]=le+k.g/1.05,J[X+2]=O,J[X+3]=1/(I.z>10?this.tileToMeter:y(I,le)),J[X+4]=T[0],J[X+5]=T[1],J[X+6]=T[2]+ce,J[X+7]=z[0],J[X+8]=z[1],J[X+9]=z[2],J[X+10]=z[4],J[X+11]=z[5],J[X+12]=z[6],J[X+13]=z[8],J[X+14]=z[9],J[X+15]=z[10],f.instancesEvaluatedElevation[U]=T[2]}}}let Qz,Jz;Tn(mP,"ModelBucket",{omit:["layers"]}),Tn(Zz,"PerModelAttributes"),Tn(Kz,"ModelFeature");const gg=64,w0={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function e6(d,o,c,f,g,p,x,I,D,L=!1){const T=c.zoom,k=c.project(f),z=nd(f.lat,T),O=1/z;Pe.mat4.identity(d),Pe.mat4.translate(d,d,[k.x+x[0]*O,k.y+x[1]*O,x[2]]);let B=1,U=1;const X=c.worldSize;if(L){if(c.projection.name==="mercator"){let ie=0;c.elevation&&(ie=c.elevation.getAtPointOrZero(new a(k.x/X,k.y/X),0));const ge=Pe.vec4.transformMat4([],[k.x,k.y,ie,1],c.projMatrix)[3]/c.cameraToCenterDistance;B=ge,U=ge*nd(c.center.lat,T)}else if(c.projection.name==="globe"){const ie=pP(d,c),ge=Pe.mat4.multiply([],c.projMatrix,ie),be=[0,0,0,1];Pe.vec4.transformMat4(be,be,ge);const Se=be[3]/c.cameraToCenterDistance,Ve=ml(T),Le=c.projection.pixelsPerMeter(f.lat,X)*nd(f.lat,T),Be=c.projection.pixelsPerMeter(c.center.lat,X)*nd(c.center.lat,T);B=Se/Wn(Le,TE(c.center.lat),Ve),U=Se*z/Le,B*=Be,U*=Be}}else B=O;Pe.mat4.scale(d,d,[B,B,U]);const J=[...d],ce=o.orientation,le=[];if(qz(le,[ce[0]+g[0],ce[1]+g[1],ce[2]+g[2]],p),Pe.mat4.multiply(d,J,le),I&&c.elevation){let ie=0;const ge=[];if(D&&c.elevation){ie=function(Ve,Le,Be,Qe,Ue){const Je=Le.elevation;if(!Je)return 0;const lt=Nn.projectAabbCorners(Be,Qe),st=Ia(1,Ue.lat)*Le.worldSize,mt=function(Zn,bn){const Pn=[0,0,1],ar=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Pr of ar){const fr=Zn[Pr.corners[0]],jr=Zn[Pr.corners[1]],Mr=Zn[Pr.corners[2]],Hr=[jr[0]-fr[0],jr[1]-fr[1],bn*(jr[2]-fr[2])],gi=Pe.vec3.cross(Hr,Hr,[Mr[0]-fr[0],Mr[1]-fr[1],bn*(Mr[2]-fr[2])]);Pe.vec3.normalize(gi,gi),Pr.dotProductWithUp=Pe.vec3.dot(gi,Pn)}return ar.sort((Pr,fr)=>Pr.dotProductWithUp-fr.dotProductWithUp),ar[0].corners}(lt,st),pt=lt[mt[0]],vt=lt[mt[1]],_t=lt[mt[2]],Et=lt[mt[3]],qt=Je.getAtPointOrZero(new a(pt[0]/Le.worldSize,pt[1]/Le.worldSize),0),Ht=Je.getAtPointOrZero(new a(vt[0]/Le.worldSize,vt[1]/Le.worldSize),0),Cn=Je.getAtPointOrZero(new a(_t[0]/Le.worldSize,_t[1]/Le.worldSize),0),Qt=Je.getAtPointOrZero(new a(Et[0]/Le.worldSize,Et[1]/Le.worldSize),0),ln=(qt+Qt)/2,Yt=(Ht+Cn)/2;return ln>Yt?Ht<Cn?nS(Ve,vt,Et,pt,Ht,Qt,qt,st):nS(Ve,_t,pt,Et,Cn,qt,Qt,st):qt<Qt?nS(Ve,pt,vt,_t,qt,Ht,Cn,st):nS(Ve,Et,_t,vt,Qt,Cn,Ht,st),Math.max(ln,Yt)}(ge,c,o.aabb,d,f);const be=Pe.mat4.fromQuat([],ge),Se=Pe.mat4.multiply([],be,le);Pe.mat4.multiply(d,J,Se)}else ie=c.elevation.getAtPointOrZero(new a(k.x/X,k.y/X),0);ie!==0&&(d[14]+=ie)}}function uv(d,o,c=!1){d.uploaded||(d.gfxTexture=new hP(o,d.image,c?o.gl.R8:o.gl.RGBA8,{useMipmap:d.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),d.uploaded=!0,d.image=null)}function Wie(d,o,c){d.indexBuffer=o.createIndexBuffer(d.indexArray,!1,!0),d.vertexBuffer=o.createVertexBuffer(d.vertexArray,Fie.members,!1,!0),d.normalArray&&(d.normalBuffer=o.createVertexBuffer(d.normalArray,Vie.members,!1,!0)),d.texcoordArray&&(d.texcoordBuffer=o.createVertexBuffer(d.texcoordArray,jie.members,!1,!0)),d.colorArray&&(d.colorBuffer=o.createVertexBuffer(d.colorArray,(d.colorArray.bytesPerElement===12?Bie:zie).members,!1,!0)),d.featureArray&&(d.pbrBuffer=o.createVertexBuffer(d.featureArray,Hie.members,!0)),d.segments=xs.simpleSegment(0,0,d.vertexArray.length,d.indexArray.length);const f=d.material;f.pbrMetallicRoughness.baseColorTexture&&uv(f.pbrMetallicRoughness.baseColorTexture,o),f.pbrMetallicRoughness.metallicRoughnessTexture&&uv(f.pbrMetallicRoughness.metallicRoughnessTexture,o),f.normalTexture&&uv(f.normalTexture,o),f.occlusionTexture&&uv(f.occlusionTexture,o,c),f.emissionTexture&&uv(f.emissionTexture,o)}function gP(d,o,c){if(d.meshes)for(const f of d.meshes)Wie(f,o,c);if(d.children)for(const f of d.children)gP(f,o,c)}function iS(d){if(d.meshes)for(const o of d.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(d.children)for(const o of d.children)iS(o)}function _P(d){if(d.meshes)for(const c of d.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((o=c.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(d.children)for(const c of d.children)_P(c)}class E0{constructor(o,c,f){this._demTile=o,this._dem=this._demTile.dem,this._scale=c,this._offset=f}static create(o,c,f){const g=f||o.findDEMTileFor(c);if(!g||!g.dem)return;const p=g.dem,x=g.tileID,I=1<<c.canonical.z-x.canonical.z;return new E0(g,p.dim/sn/I,[(c.canonical.x/I-x.canonical.x)*p.dim,(c.canonical.y/I-x.canonical.y)*p.dim])}tileCoordToPixel(o,c){const f=c*this._scale+this._offset[1],g=Math.floor(o*this._scale+this._offset[0]),p=Math.floor(f);return new Ot(g,p)}getElevationAt(o,c,f,g){const p=o*this._scale+this._offset[0],x=c*this._scale+this._offset[1],I=Math.floor(p),D=Math.floor(x),L=this._dem;return g=!!g,f?Wn(Wn(L.get(I,D,g),L.get(I,D+1,g),x-D),Wn(L.get(I+1,D,g),L.get(I+1,D+1,g),x-D),p-I):L.get(I,D,g)}getElevationAtPixel(o,c,f){return this._dem.get(o,c,!!f)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Ia(1,o)*this._dem.stride}}const yP=new Float32Array(262144),_g=new Uint8Array(262144);function t6(d){let o=0;if(d.meshes)for(const c of d.meshes)o=Math.max(o,c.aabb.max[2]);if(d.children)for(const c of d.children)o=Math.max(o,t6(c));return o}function n6(d,o,c){if(d.meshes)for(const f of d.meshes){if(f.aabb.min[0]===1/0)continue;const g=Nn.applyTransform(f.aabb,d.matrix);c.insert(o,g.min[0],g.min[1],g.max[0],g.max[1])}if(d.children)for(const f of d.children)n6(f,o,c)}const r6=["","wall","door","roof","window","lamp","logo"];class i6{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:t6(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const c=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const f of this.node.meshes)this.node.lightMeshIndex!==o&&(f.transformedAabb=Nn.applyTransformFast(f.aabb,this.node.matrix),c.encapsulate(f.transformedAabb)),o++;this.aabb=c}return this.aabb}}class sS{constructor(o,c,f,g,p,x,I){this.id=f,this.layers=o,this.layerIds=this.layers.map(D=>D.fqid),this.stateDependentLayerIds=this.layers.filter(D=>D.isStateDependent()).map(D=>D.id),this.modelTraits|=w0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=w0.HasMapboxMeshFeatures),p&&(this.modelTraits|=w0.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const D of c)this.nodesInfo.push(new i6(D)),n6(D,I.featureIndexArray.length,I.grid),I.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,I.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(o,c){for(const f of this.getNodesInfo()){const g=f.node;g.footprint&&c.push({footprint:g.footprint,id:o})}}update(o){const c=Object.keys(o).length!==0;if(c&&!this.stateDependentLayers.length)return;const f=c?this.stateDependentLayers:this.layers;if(!Sr(o,this.states))for(const g of f)this.evaluate(g,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const f of c){const g=f.node;this.uploaded?this.updatePbrBuffer(g):gP(g,o,!0)}for(const f of c)iS(f.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let c=!1;if(!o.meshes)return c;for(const f of o.meshes)f.pbrBuffer&&(f.pbrBuffer.updateData(f.featureArray),c=!0);return c}needsReEvaluation(o,c,f){const g=o.transform.projectionOptions,p=o.style.getBrightness(),x=this.brightness!==p;if(!this.uploaded||this.dirty||g.name!==this.projection.name||hv(f.paint.get("model-color").value,x)||hv(f.paint.get("model-color-mix-intensity").value,x)||hv(f.paint.get("model-roughness").value,x)||hv(f.paint.get("model-emissive-strength").value,x)||hv(f.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=g,this.brightness=p;const I=this.getNodesInfo();for(const D of I)D.state=null;return!0}return!1}evaluateScale(o,c){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const f=this.getNodesInfo(),g=this.id.canonical;for(const p of f){const x=p.feature;p.evaluatedScale=c.paint.get("model-scale").evaluate(x,{},g)}}evaluate(o,c){const f=this.getNodesInfo();for(const g of f){if(!g.node.meshes)continue;const p=g.feature,x=c&&c[p.id];if(Sr(x,g.state))continue;g.state=structuredClone(x);const I=g.node.meshes&&g.node.meshes[0].featureData,D=g.evaluatedColor[2],L=g.evaluatedRMEA[2],T=this.id.canonical;if(g.hasTranslucentParts=!1,I){for(let k=0;k<r6.length;k++){const z=r6[k];z.length&&(p.properties.part=z);const O=o.paint.get("model-color").evaluate(p,x,T).toRenderColor(null),B=o.paint.get("model-color-mix-intensity").evaluate(p,x,T);g.evaluatedColor[k]=[O.r,O.g,O.b,B],g.evaluatedRMEA[k][0]=o.paint.get("model-roughness").evaluate(p,x,T),g.evaluatedRMEA[k][2]=o.paint.get("model-emissive-strength").evaluate(p,x,T),g.evaluatedRMEA[k][3]=O.a,g.emissionHeightBasedParams[k]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,x,T),!g.hasTranslucentParts&&O.a<1&&(g.hasTranslucentParts=!0)}delete p.properties.part,qie(g,D!==g.evaluatedColor[2]||L!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(p,x,T);g.evaluatedScale=o.paint.get("model-scale").evaluate(p,x,T),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,c,f,g){const p=o.findDEMTileFor(f);if(p&&(p.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const x=E0.create(o,f,p);if(!x)return;this.modelTraits&w0.HasMapboxMeshFeatures&&this.updateDEM(o,x,f,g);for(const I of this.getNodesInfo()){const D=I.node;if(!D.footprint||!D.footprint.vertices||!D.footprint.vertices.length)continue;const L=D.footprint.vertices;let T=x.getElevationAt(L[0].x,L[0].y,!0,!0);for(let k=1;k<L.length;k++)T=Math.min(T,x.getElevationAt(L[k].x,L[k].y,!0,!0));D.elevation=T}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=c}}updateDEM(o,c,f,g){let p=c._dem._modifiedForSources[g];if(p===void 0&&(c._dem._modifiedForSources[g]=[],p=c._dem._modifiedForSources[g]),p.includes(f.canonical))return;const x=c._dem.dim;p.push(f.canonical);let I=!1;for(const D of this.getNodesInfo()){const L=D.node;if(!L.footprint||!L.footprint.grid)continue;const T=L.footprint.grid,k=c.tileCoordToPixel(T.min.x,T.min.y),z=c.tileCoordToPixel(T.max.x,T.max.y),O=Math.min(Math.min(x-z.y,k.x),Math.min(k.y,x-z.x));if(O<0)continue;const B=Bn(O,2,5);let U=Math.max(0,k.x-B),X=Math.max(0,k.y-B),J=Math.min(z.x+B,x-1),ce=Math.min(z.y+B,x-1);for(let be=X;be<=ce;++be)for(let Se=U;Se<=J;++Se)_g[be*x+Se]=255;let le=0,ie=0;for(let be=0;be<T.cellsY;++be)for(let Se=0;Se<T.cellsX;++Se){if(!T.cells[be*T.cellsX+Se])continue;const Ve=c.tileCoordToPixel(T.min.x+Se/T.xScale,T.min.y+be/T.yScale),Le=c.tileCoordToPixel(T.min.x+(Se+1)/T.xScale,T.min.y+(be+1)/T.yScale);for(let Be=Ve.y;Be<=Math.min(Le.y+1,x-1);++Be)for(let Qe=Ve.x;Qe<=Math.min(Le.x+1,x-1);++Qe)_g[Be*x+Qe]===255&&(_g[Be*x+Qe]=0,le+=c.getElevationAtPixel(Qe,Be),ie++)}const ge=le/ie;U=Math.max(1,k.x-B),X=Math.max(1,k.y-B),J=Math.min(z.x+B,x-2),ce=Math.min(z.y+B,x-2),I=!0;for(let be=X;be<=ce;++be)for(let Se=U;Se<=J;++Se)_g[be*x+Se]===0&&(yP[be*x+Se]=c._dem.set(Se,be,ge));for(let be=1;be<B;++be){U=Math.max(1,k.x-be),X=Math.max(1,k.y-be),J=Math.min(z.x+be,x-2),ce=Math.min(z.y+be,x-2);for(let Se=X;Se<=ce;++Se)for(let Ve=U;Ve<=J;++Ve){const Le=Se*x+Ve;if(_g[Le]===255){let Be=0,Qe=0,Ue=-1,Je=-1;for(let lt=-1;lt<=1;++lt)for(let st=-1;st<=1;++st){const mt=(Se+lt)*x+Ve+st;if(_g[mt]>=be)continue;const pt=yP[mt],vt=Math.abs(pt);vt>Qe&&(Be=pt,Qe=vt,Ue=st,Je=lt)}if(Qe>.1){const lt=1-(be+.5*Math.abs(Ue*Je))/B;let st=c._dem.get(Ve,Se)+Be*lt;const mt=c._dem.get(Ve+Ue,Se+Je),pt=c._dem.get(Ve-Ue,Se-Je,!0);(st-mt)*(st-pt)>0&&(st=(mt+pt)/2),yP[Le]=c._dem.set(Ve,Se,st),_g[Le]=be}}}}}I&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=Mt.now())}setFilter(o){this.filter=o?b1(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new Wi(this.id.overscaledZ),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const c of o)iS(c.node),_P(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(o.toUnwrapped()),g=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const x=g[p].node;g[p].hiddenByReplacement=!!x.footprint&&!f.find(I=>I.footprint===x.footprint)}}getHeightAtTileCoord(o,c){const f=this.getNodesInfo(),g=[],p=[0,0,0],x=Pe.mat4.identity([]);for(let I=0;I<this.nodesInfo.length;I++){const D=f[I],L=D.node.meshes[0],T=L.transformedAabb;if(o<T.min[0]||c<T.min[1]||o>T.max[0]||c>T.max[1])continue;if(D.node.hidden===!0)return{height:1/0,maxHeight:D.feature.properties.height,hidden:!1,verticalScale:D.evaluatedScale[2]};Pe.mat4.invert(x,D.node.matrix),p[0]=o,p[1]=c,Pe.vec3.transformMat4(p,p,x);const k=(p[0]-L.aabb.min[0])/(L.aabb.max[0]-L.aabb.min[0])*gg|0,z=Math.min(63,(p[1]-L.aabb.min[1])/(L.aabb.max[1]-L.aabb.min[1])*gg|0)*gg+Math.min(63,k),O=L.heightmap[z];if(!(O<0&&D.node.footprint))return D.hiddenByReplacement?void 0:{height:O,maxHeight:D.feature.properties.height,hidden:!1,verticalScale:D.evaluatedScale[2]};if(D.node.footprint.grid.query(new Ot(o,c),new Ot(o,c),g),g.length>0)return{height:void 0,maxHeight:D.feature.properties.height,hidden:D.hiddenByReplacement,verticalScale:D.evaluatedScale[2]}}}}function hv(d,o){return!d.isLightConstant&&o}function $ie(d,o,c,f,g,p,x,I){let D=(61440&o|(61440&o)>>4)>>8,L=(3840&o|(3840&o)>>4)>>4,T=240&o|(240&o)>>4;c[3]>0&&(D=Wn(D,255*c[0],c[3]),L=Wn(L,255*c[1],c[3]),T=Wn(T,255*c[2],c[3]));const k=D<<8|L,z=T<<8|Math.floor(255*f[3]),O=function(be){const Se=Bn(be,0,2);return Math.min(Math.round(.5*Se*255),255)}(f[2])<<8|15*f[0]<<4|15*f[1],B=Bn(g[0],0,1),U=Bn(g[1],0,1),X=Bn(g[2],0,1),J=Bn(g[3],0,1);let ce,le,ie,ge;if(B!==U&&x!==p&&U!==B){const be=x-p;le=1/(be*(U-B)),ie=-(p+be*B)/(be*(U-B));const Se=Bn(g[4],-1,1);ge=Math.pow(10,Se),ce=255*X<<8|255*J}else ce=65535,le=0,ie=1,ge=1;if(d.emplaceBack(k,z,O,ce,le,ie,ge),I){const be=I.length;I.clear();for(let Se=0;Se<be;Se++)I.emplaceBack(k,z,O,ce,le,ie,ge)}}function qie(d,o,c){const f=d.node;let g=0;const p=c&w0.HasMeshoptCompression;for(const x of f.meshes){if(f.lights&&f.lightMeshIndex===g||!x.featureData)continue;x.featureArray=new l0,x.featureArray.reserve(x.featureData.length);let I=o;for(const D of x.featureData){const L=p?65535&D:D>>16&65535,T=p?D>>16&65535:65535&D,k=(15&T)<8?15&T:0,z=d.evaluatedRMEA[k],O=d.evaluatedColor[k],B=d.emissionHeightBasedParams[k];let U;if(I&&k===2&&f.lights&&(U=new l0,U.resize(10*f.lights.length)),$ie(x.featureArray,L,O,z,B,x.aabb.min[2],x.aabb.max[2],U),U&&I){I=!1;const X=f.meshes[f.lightMeshIndex];X.featureArray=U,X.featureArray._trim()}}x.featureArray._trim(),g++}}function s6(d,o,c,f){const g=1<<d.z;o.lat=ca((f/sn+d.y)/g),o.lng=Bl((c/sn+d.x)/g)}Tn(sS,"Tiled3dModelBucket",{omit:["layers"]}),Tn(i6,"Tiled3dModelFeature");const Gie={circle:class extends Qo{constructor(d,o,c,f){super(d,{layout:yt||(yt=new Ds({"circle-sort-key":new Sn(St.layout_circle["circle-sort-key"]),"circle-elevation-reference":new on(St.layout_circle["circle-elevation-reference"]),visibility:new on(St.layout_circle.visibility)})),paint:Ft||(Ft=new Ds({"circle-radius":new Sn(St.paint_circle["circle-radius"]),"circle-color":new Sn(St.paint_circle["circle-color"]),"circle-blur":new Sn(St.paint_circle["circle-blur"]),"circle-opacity":new Sn(St.paint_circle["circle-opacity"]),"circle-translate":new on(St.paint_circle["circle-translate"]),"circle-translate-anchor":new on(St.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new on(St.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new on(St.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Sn(St.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Sn(St.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Sn(St.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new on(St.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f)}createBucket(d){return new he(d)}queryRadius(d){const o=d;return xt("circle-radius",this,o)+xt("circle-stroke-width",this,o)+Bt(this.paint.get("circle-translate"))}queryIntersectsFeature(d,o,c,f,g,p,x,I){const D=Jt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),L=this.paint.get("circle-radius").evaluate(o,c)+this.paint.get("circle-stroke-width").evaluate(o,c);return p0(d,f,p,x,I,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",D,L)}getProgramIds(){return["circle"]}getDefaultProgramParams(d,o,c){const f=pp(this);return{config:new qd(this,{zoom:o,lut:c}),defines:f,overrideFog:!1}}},heatmap:class extends Qo{createBucket(d){return new M5(d)}constructor(d,o,c,f){super(d,{layout:P5||(P5=new Ds({visibility:new on(St.layout_heatmap.visibility)})),paint:D5||(D5=new Ds({"heatmap-radius":new Sn(St.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Sn(St.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new on(St.paint_heatmap["heatmap-intensity"]),"heatmap-color":new sp(St.paint_heatmap["heatmap-color"]),"heatmap-opacity":new on(St.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(d){return xt("heatmap-radius",this,d)}queryIntersectsFeature(d,o,c,f,g,p,x,I){const D=this.paint.get("heatmap-radius").evaluate(o,c);return p0(d,f,p,x,I,!0,!0,new Ot(0,0),D)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(d,o,c){return d==="heatmap"?{config:new qd(this,{zoom:o,lut:c}),overrideFog:!1}:{}}},hillshade:class extends Qo{constructor(d,o,c,f){super(d,{layout:k5||(k5=new Ds({visibility:new on(St.layout_hillshade.visibility)})),paint:N5||(N5=new Ds({"hillshade-illumination-direction":new on(St.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new on(St.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new on(St.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new on(St.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new on(St.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new on(St.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new on(St.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(d,o,c){return{overrideFog:!1}}},fill:class extends Qo{constructor(d,o,c,f){super(d,{layout:J5||(J5=new Ds({"fill-sort-key":new Sn(St.layout_fill["fill-sort-key"]),visibility:new on(St.layout_fill.visibility),"fill-elevation-reference":new on(St.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Sn(St.layout_fill["fill-construct-bridge-guard-rail"])})),paint:eB||(eB=new Ds({"fill-antialias":new on(St.paint_fill["fill-antialias"]),"fill-opacity":new Sn(St.paint_fill["fill-opacity"]),"fill-color":new Sn(St.paint_fill["fill-color"]),"fill-outline-color":new Sn(St.paint_fill["fill-outline-color"]),"fill-translate":new on(St.paint_fill["fill-translate"]),"fill-translate-anchor":new on(St.paint_fill["fill-translate-anchor"]),"fill-pattern":new Sn(St.paint_fill["fill-pattern"]),"fill-emissive-strength":new on(St.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Sn(St.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Sn(St.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Sn(St.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f)}getProgramIds(){const d=this.paint.get("fill-pattern"),o=d&&d.constantOr(1),c=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(d,o,c){return{config:new qd(this,{zoom:o,lut:c}),overrideFog:!1}}recalculate(d,o){super.recalculate(d,o);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new FM(d)}queryRadius(){return Bt(this.paint.get("fill-translate"))}queryIntersectsFeature(d,o,c,f,g,p){return!d.queryGeometry.isAboveHorizon&&Ee(zt(d.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),f)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(d){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const o=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return d!=null?o&&!d:o}},"fill-extrusion":class extends Qo{constructor(d,o,c,f){super(d,{layout:AB||(AB=new Ds({visibility:new on(St["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new on(St["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:RB||(RB=new Ds({"fill-extrusion-opacity":new on(St["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Sn(St["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new on(St["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new on(St["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Sn(St["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Sn(St["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Sn(St["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new on(St["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new on(St["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new on(St["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new on(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new on(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new on(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new on(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new on(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new on(St["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new on(St["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Sn(St["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Sn(St["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new on(St["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new on(St["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new on(St["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new on(St["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Sn(St["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Sn(St["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new on(St["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new OE(d)}queryRadius(){return Bt(this.paint.get("fill-extrusion-translate"))}is3D(d){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(d,o,c,f,g,p,x,I,D){const L=Jt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(o,c),k=this.paint.get("fill-extrusion-base").evaluate(o,c),z=[0,0],O=I&&p.elevation,B=p.elevation?p.elevation.exaggeration():1,U=d.tile.getBucket(this);if(O&&U instanceof OE){const ie=U.centroidVertexArray,ge=D+1;ge<ie.length&&(z[0]=ie.geta_centroid_pos0(ge),z[1]=ie.geta_centroid_pos1(ge))}if(z[0]===0&&z[1]===1)return!1;p.projection.name==="globe"&&(f=IB([f],[new Ot(0,0),new Ot(sn,sn)],d.tileID.canonical).map(ie=>ie.polygon).flat());const X=O?I:null,[J,ce]=function(ie,ge,be,Se,Ve,Le,Be,Qe,Ue,Je,lt){return ie.projection.name==="globe"?function(st,mt,pt,vt,_t,Et,qt,Ht,Cn,Qt,ln){const Yt=[],Zn=[],bn=st.projection.upVectorScale(ln,st.center.lat,st.worldSize).metersToTile,Pn=[0,0,0,1],ar=[0,0,0,1],Pr=(jr,Mr,Hr,gi)=>{jr[0]=Mr,jr[1]=Hr,jr[2]=gi,jr[3]=1},fr=CB();pt>0&&(pt+=fr),vt+=fr;for(const jr of mt){const Mr=[],Hr=[];for(const gi of jr){const $i=gi.x+_t.x,lr=gi.y+_t.y,ti=st.projection.projectTilePoint($i,lr,ln),ms=st.projection.upVector(ln,gi.x,gi.y);let Ss=pt,ks=vt;if(qt){const Us=PB($i,lr,pt,vt,qt,Ht,Cn,Qt);Ss+=Us.base,ks+=Us.top}pt!==0?Pr(Pn,ti.x+ms[0]*bn*Ss,ti.y+ms[1]*bn*Ss,ti.z+ms[2]*bn*Ss):Pr(Pn,ti.x,ti.y,ti.z),Pr(ar,ti.x+ms[0]*bn*ks,ti.y+ms[1]*bn*ks,ti.z+ms[2]*bn*ks),Pe.vec3.transformMat4(Pn,Pn,Et),Pe.vec3.transformMat4(ar,ar,Et),Mr.push(new pg(Pn[0],Pn[1],Pn[2])),Hr.push(new pg(ar[0],ar[1],ar[2]))}Yt.push(Mr),Zn.push(Hr)}return[Yt,Zn]}(ie,ge,be,Se,Ve,Le,Be,Qe,Ue,Je,lt):Be?function(st,mt,pt,vt,_t,Et,qt,Ht,Cn){const Qt=[],ln=[],Yt=[0,0,0,1];for(const Zn of st){const bn=[],Pn=[];for(const ar of Zn){const Pr=ar.x+vt.x,fr=ar.y+vt.y,jr=PB(Pr,fr,mt,pt,Et,qt,Ht,Cn);Yt[0]=Pr,Yt[1]=fr,Yt[2]=jr.base,Yt[3]=1,Pe.vec4.transformMat4(Yt,Yt,_t),Yt[3]=Math.max(Yt[3],1e-5);const Mr=new pg(Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]);Yt[0]=Pr,Yt[1]=fr,Yt[2]=jr.top,Yt[3]=1,Pe.vec4.transformMat4(Yt,Yt,_t),Yt[3]=Math.max(Yt[3],1e-5);const Hr=new pg(Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]);bn.push(Mr),Pn.push(Hr)}Qt.push(bn),ln.push(Pn)}return[Qt,ln]}(ge,be,Se,Ve,Le,Be,Qe,Ue,Je):function(st,mt,pt,vt,_t){const Et=[],qt=[],Ht=_t[8]*mt,Cn=_t[9]*mt,Qt=_t[10]*mt,ln=_t[11]*mt,Yt=_t[8]*pt,Zn=_t[9]*pt,bn=_t[10]*pt,Pn=_t[11]*pt;for(const ar of st){const Pr=[],fr=[];for(const jr of ar){const Mr=jr.x+vt.x,Hr=jr.y+vt.y,gi=_t[0]*Mr+_t[4]*Hr+_t[12],$i=_t[1]*Mr+_t[5]*Hr+_t[13],lr=_t[2]*Mr+_t[6]*Hr+_t[14],ti=_t[3]*Mr+_t[7]*Hr+_t[15],ms=gi+Ht,Ss=$i+Cn,ks=lr+Qt,Us=Math.max(ti+ln,1e-5),Hi=gi+Yt,Vo=$i+Zn,gl=lr+bn,_o=Math.max(ti+Pn,1e-5);Pr.push(new pg(ms/Us,Ss/Us,ks/Us)),fr.push(new pg(Hi/_o,Vo/_o,gl/_o))}Et.push(Pr),qt.push(fr)}return[Et,qt]}(ge,be,Se,Ve,Le)}(p,f,k,T,L,x,X,z,B,p.center.lat,d.tileID.canonical),le=d.queryGeometry;return function(ie,ge,be){let Se=1/0;Ee(be,ge)&&(Se=MB(be,ge[0]));for(let Ve=0;Ve<ge.length;Ve++){const Le=ge[Ve],Be=ie[Ve];for(let Qe=0;Qe<Le.length-1;Qe++){const Ue=Le[Qe],Je=[Ue,Le[Qe+1],Be[Qe+1],Be[Qe],Ue];we(be,Je)&&(Se=Math.min(Se,MB(be,Je)))}}return Se!==1/0&&Se}(J,ce,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends Qo{constructor(d,o,c,f){const g=VB();super(d,g,o,c,f),g.layout&&(this.layout=new ip(g.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(d){if(d==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Au,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(d,o){super.recalculate(d,o),this.paint._values["line-floorwidth"]=(()=>{if(ev)return ev;const c=VB();return ev=new Gre(c.paint.properties["line-width"].specification),ev.useIntegerZoom=!0,ev})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new WM(d)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(d,o,c){const f=zB(this);return{config:new qd(this,{zoom:o,lut:c}),defines:f,overrideFog:!1}}queryRadius(d){const o=d,c=UB(xt("line-width",this,o),xt("line-gap-width",this,o)),f=xt("line-offset",this,o);return c/2+Math.abs(f)+Bt(this.paint.get("line-translate"))}queryIntersectsFeature(d,o,c,f,g,p){if(d.queryGeometry.isAboveHorizon)return!1;const x=zt(d.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),I=d.pixelToTileUnitsFactor/2*UB(this.paint.get("line-width").evaluate(o,c),this.paint.get("line-gap-width").evaluate(o,c)),D=this.paint.get("line-offset").evaluate(o,c);return D&&(f=function(L,T){const k=[],z=new Ot(0,0);for(let O=0;O<L.length;O++){const B=L[O],U=[];for(let X=0;X<B.length;X++){const J=B[X],ce=B[X+1],le=X===0?z:J.sub(B[X-1])._unit()._perp(),ie=X===B.length-1?z:ce.sub(J)._unit()._perp(),ge=le._add(ie)._unit();ge._mult(1/(ge.x*ie.x+ge.y*ie.y)),U.push(ge._mult(T)._add(J))}k.push(U)}return k}(f,D*d.pixelToTileUnitsFactor)),function(L,T,k){for(let z=0;z<T.length;z++){const O=T[z];if(L.length>=3){for(let B=0;B<O.length;B++)if(Xe(L,O[B]))return!0}if(Ce(L,O,k))return!0}return!1}(x,f,I)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(d){return!this.hasElevatedBuckets}},symbol:ZE,background:class extends Qo{constructor(d,o,c,f){super(d,{layout:Mz||(Mz=new Ds({visibility:new on(St.layout_background.visibility)})),paint:Pz||(Pz=new Ds({"background-pitch-alignment":new on(St.paint_background["background-pitch-alignment"]),"background-color":new on(St.paint_background["background-color"]),"background-pattern":new on(St.paint_background["background-pattern"]),"background-opacity":new on(St.paint_background["background-opacity"]),"background-emissive-strength":new on(St.paint_background["background-emissive-strength"]),"background-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(d,o,c){return{overrideFog:!1}}is3D(d){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Lz,"raster-particle":Uz,sky:class extends Qo{constructor(d,o,c,f){super(d,{layout:zz||(zz=new Ds({visibility:new on(St.layout_sky.visibility)})),paint:jz||(jz=new Ds({"sky-type":new on(St.paint_sky["sky-type"]),"sky-atmosphere-sun":new on(St.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new on(St.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new on(St.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new on(St.paint_sky["sky-gradient-radius"]),"sky-gradient":new sp(St.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new on(St.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new on(St.paint_sky["sky-atmosphere-color"]),"sky-opacity":new on(St.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="sky-gradient"?this._updateColorRamp():d!=="sky-atmosphere-sun"&&d!=="sky-atmosphere-halo-color"&&d!=="sky-atmosphere-color"&&d!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(d){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=d.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(d,o){if(this.paint.get("sky-type")==="atmosphere"){const f=this.paint.get("sky-atmosphere-sun"),g=!f,p=d.style.light,x=p.properties.get("position");return g&&p.properties.get("anchor")==="viewport"&&Nr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?dP(x.azimuthal,90-x.polar,o):dP(f[0],90-f[1],o)}const c=this.paint.get("sky-gradient-center");return dP(c[0],90-c[1],o)}isSky(){return!0}markSkyboxValid(d){this._skyboxInvalidated=!1,this._lightPosition=d.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const d=this.paint.get("sky-type");return d==="atmosphere"?["skyboxCapture","skybox"]:d==="gradient"?["skyboxGradient"]:null}},slot:class extends Qo{constructor(d,o,c,f){super(d,{paint:Vz||(Vz=new Ds({}))},o,null)}},model:class extends Qo{constructor(d,o,c,f){super(d,{layout:Qz||(Qz=new Ds({visibility:new on(St.layout_model.visibility),"model-id":new Sn(St.layout_model["model-id"])})),paint:Jz||(Jz=new Ds({"model-opacity":new Sn(St.paint_model["model-opacity"]),"model-rotation":new Sn(St.paint_model["model-rotation"]),"model-scale":new Sn(St.paint_model["model-scale"]),"model-translation":new Sn(St.paint_model["model-translation"]),"model-color":new Sn(St.paint_model["model-color"]),"model-color-mix-intensity":new Sn(St.paint_model["model-color-mix-intensity"]),"model-type":new on(St.paint_model["model-type"]),"model-cast-shadows":new on(St.paint_model["model-cast-shadows"]),"model-receive-shadows":new on(St.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new on(St.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Sn(St.paint_model["model-emissive-strength"]),"model-roughness":new Sn(St.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Sn(St.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new on(St.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new on(St.paint_model["model-front-cutoff"]),"model-color-use-theme":new Sn({type:"string",default:"default","property-type":"data-driven"})}))},o,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new mP(d)}getProgramIds(){return["model"]}is3D(d){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(d){return d instanceof sS?sn-1:0}queryIntersectsFeature(d,o,c,f,g,p){if(!this.modelManager)return!1;const x=this.modelManager,I=d.tile.getBucket(this);if(!(I&&I instanceof mP))return!1;for(const D in I.instancesPerModel){const L=I.instancesPerModel[D],T=o.id!==void 0?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(L.idToFeaturesIndex.hasOwnProperty(T)){const k=L.features[L.idToFeaturesIndex[T]],z=x.getModel(D,this.scope);if(!z)return!1;let O=Pe.mat4.create();const B=new xi(0,0),U=I.canonical;let X=Number.MAX_VALUE;for(let J=0;J<k.instancedDataCount;++J){const ce=16*(k.instancedDataOffset+J),le=L.instancedDataArray.float32,ie=[le[ce+4],le[ce+5],le[ce+6]];s6(U,B,le[ce],0|le[ce+1]),e6(O,z,p,B,k.rotation,k.scale,ie,!1,!1,!1),p.projection.name==="globe"&&(O=pP(O,p));const ge=Pe.mat4.multiply([],p.projMatrix,O),be=d.queryGeometry,Se=Gz(be.isPointQuery()?be.screenBounds:be.screenGeometry,p,ge,z.aabb);Se!=null&&(X=Math.min(Se,X))}return X!==Number.MAX_VALUE&&X}}return!1}_handleOverridablePaintPropertyUpdate(d,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven()||d!=="model-color"&&d!=="model-color-mix-intensity"&&d!=="model-rotation"&&d!=="model-scale"&&d!=="model-translation"&&d!=="model-emissive-strength")}_isPropertyZoomDependent(d){const o=this._transitionablePaint._values[d];return o!=null&&o.value!=null&&o.value.expression!=null&&o.value.expression instanceof Qf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Qo{constructor(d,o,c,f){super(d,{layout:tB||(tB=new Ds({"clip-layer-types":new on(St.layout_clip["clip-layer-types"]),"clip-layer-scope":new on(St.layout_clip["clip-layer-scope"])})),paint:nB||(nB=new Ds({}))},o,c,f)}recalculate(d,o){super.recalculate(d,o)}createBucket(d){return new rB(d)}is3D(d){return!0}}};class Yie{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Xie{constructor(){this.tasks={},this.taskQueue=[],Li(["process"],this),this.invoker=new Yie(this.process),this.nextId=0}add(o,c){const f=this.nextId++,g=function({type:p,isSymbolTile:x,zoom:I}){return I=I||0,p==="message"?0:p!=="maybePrepare"||x?p!=="parseTile"||x?p==="parseTile"&&x?300-I:p==="maybePrepare"&&x?400-I:500:200-I:100-I}(c);if(g===0){try{o()}finally{}return null}return this.tasks[f]={fn:o,metadata:c,priority:g,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const c=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let o=null,c=1/0;for(let g=0;g<this.taskQueue.length;g++){const p=this.tasks[this.taskQueue[g]];p.priority<c&&(c=p.priority,o=g)}if(o===null)return null;const f=this.taskQueue[o];return this.taskQueue.splice(o,1),f}remove(){this.invoker.remove()}}class o6{constructor(o,c,f){this.target=o,this.parent=c,this.mapId=f,this.callbacks={},this.cancelCallbacks={},Li(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Xie}send(o,c,f,g,p=!1,x){const I=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(f.metadata=x,this.callbacks[I]=f);const D=new Set;return this.target.postMessage({id:I,type:o,hasCallback:!!f,targetMapId:g,mustQueue:p,sourceMapId:this.mapId,data:Yh(c,D)},D),{cancel:()=>{f&&delete this.callbacks[I],this.target.postMessage({id:I,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(o){const c=o.data;if(!c)return;const f=c.id;if(f&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const g=this.cancelCallbacks[f];delete this.cancelCallbacks[f],g&&g.cancel()}else if(c.mustQueue||Zr()){const g=this.callbacks[f],p=this.scheduler.add(()=>this.processTask(f,c),g&&g.metadata||{type:"message"});p&&(this.cancelCallbacks[f]=p)}else this.processTask(f,c)}processTask(o,c){if(delete this.cancelCallbacks[o],c.type==="<response>"){const f=this.callbacks[o];delete this.callbacks[o],f&&(c.error?f(cc(c.error)):f(null,cc(c.data)))}else{const f=new Set,g=c.hasCallback?(x,I)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:x?Yh(x):null,data:Yh(I,f)},f)}:()=>{},p=cc(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,p,g);else if(this.parent.getWorkerSource){const x=c.type.split(".");this.parent.getWorkerSource(c.sourceMapId,x[0],p.source,p.scope)[x[1]](p,g)}else g(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var dv={workerUrl:"",workerClass:null,workerParams:void 0};const xP="mapboxgl_preloaded_worker_pool";class yg{constructor(){this.active={}}acquire(o,c=yg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(dv.workerClass!=null?new dv.workerClass:new self.Worker(dv.workerUrl,dv.workerParams));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xP]}numActive(){return Object.keys(this.active).length}}yg.workerCount=2;class S0{constructor(o,c,f="Worker",g=yg.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=hr();const p=this.workerPool.acquire(this.id,g);for(let x=0;x<p.length;x++){const I=new S0.Actor(p[x],c,this.id);I.name=`${f} ${x}`,this.actors.push(I)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,f){cs(this.actors,(g,p)=>{g.send(o,c,p)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}let fv,vP;function oS(){return fv||(fv=new yg),fv}S0.Actor=o6;const bP=new Qr(0,0,0);var wP=(d=>(d[d.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",d[d.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",d[d.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",d))(wP||{}),aS=(d=>(d[d.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",d[d.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",d[d.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",d[d.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",d))(aS||{}),pv=(d=>(d[d.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",d[d.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",d[d.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",d[d.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",d[d.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",d))(pv||{}),a6=(d=>(d[d.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",d[d.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",d[d.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",d))(a6||{}),T0=(d=>(d[d.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",d[d.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",d[d.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",d[d.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",d[d.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",d[d.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",d))(T0||{}),l6=(d=>(d[d.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",d[d.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",d[d.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",d))(l6||{});function Kie(d,o,c){d===1&&o.icons.push(function(f,g){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:x}=p;if(x.content_area){const{content_area:I}=x;I.top==null&&(I.top=I.left),I.width==null&&(I.width=p.usvg_tree.width),I.height==null&&(I.height=I.width)}return x.stretch_x&&x.stretch_x.length&&c6(x,"x"),x.stretch_y&&x.stretch_y.length&&c6(x,"y"),p}(f.readFields(Zie,{name:void 0},g))}(c,c.readVarint()+c.pos))}function c6(d,o){const c=[],f=d[`stretch_${o}`];let g=null;for(let p=0;p<f.length;p++)g===null?g=c.length===0?f[0]:c[c.length-1][1]+f[p]:(c.push([g,g+f[p]]),g=null);d[`stretch_${o}_areas`]=c}function Zie(d,o,c){d===1?o.name=c.readString():d===2?o.metadata=function(f,g){return f.readFields(Qie,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},g)}(c,c.readVarint()+c.pos):d===3&&(o.usvg_tree=function(f,g){return f.readFields(tse,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},g)}(c,c.readVarint()+c.pos),o.data="usvg_tree")}function Qie(d,o,c){d===1?o.stretch_x=c.readPackedVarint():d===2?o.stretch_y=c.readPackedVarint():d===3?o.content_area=function(f,g){return f.readFields(Jie,{left:0},g)}(c,c.readVarint()+c.pos):d===4&&o.variables.push(function(f,g){return f.readFields(ese,{name:void 0},g)}(c,c.readVarint()+c.pos))}function Jie(d,o,c){d===1?o.left=c.readVarint():d===2?o.width=c.readVarint():d===3?o.top=c.readVarint():d===4&&(o.height=c.readVarint())}function ese(d,o,c){d===1?o.name=c.readString():d===2&&(o.rgb_color=uS(c.readVarint()),o.value="rgb_color")}function tse(d,o,c){d===1?o.width=o.height=c.readVarint():d===2?o.height=c.readVarint():d===3?o.children.push(lS(c,c.readVarint()+c.pos)):d===4?o.linear_gradients.push(function(f,g){return f.readFields(lse,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},g)}(c,c.readVarint()+c.pos)):d===5?o.radial_gradients.push(function(f,g){return f.readFields(use,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},g)}(c,c.readVarint()+c.pos)):d===7?o.clip_paths.push(function(f,g){return f.readFields(hse,{children:[]},g)}(c,c.readVarint()+c.pos)):d===8&&o.masks.push(function(f,g){const p=f.readFields(dse,{left:0,width:20,mask_type:1,children:[]},g);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(c,c.readVarint()+c.pos))}function lS(d,o){return d.readFields(nse,{},o)}function nse(d,o,c){d===1?(o.group=function(f,g){return f.readFields(rse,{opacity:255,children:[]},g)}(c,c.readVarint()+c.pos),o.node="group"):d===2&&(o.path=function(f,g){return f.readFields(sse,{paint_order:1,commands:[],step:1,diffs:[],rule:1},g)}(c,c.readVarint()+c.pos),o.node="path")}function rse(d,o,c){d===1?o.transform=cS(c,c.readVarint()+c.pos):d===2?o.opacity=c.readVarint():d===5?o.clip_path_idx=c.readVarint():d===6?o.mask_idx=c.readVarint():d===7&&o.children.push(lS(c,c.readVarint()+c.pos))}function cS(d,o){return d.readFields(ise,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function ise(d,o,c){d===1?o.sx=c.readFloat():d===2?o.ky=c.readFloat():d===3?o.kx=c.readFloat():d===4?o.sy=c.readFloat():d===5?o.tx=c.readFloat():d===6&&(o.ty=c.readFloat())}function sse(d,o,c){d===1?o.fill=function(f,g){return f.readFields(ose,{rgb_color:bP,paint:"rgb_color",opacity:255},g)}(c,c.readVarint()+c.pos):d===2?o.stroke=function(f,g){return f.readFields(ase,{rgb_color:bP,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},g)}(c,c.readVarint()+c.pos):d===3?o.paint_order=c.readVarint():d===5?c.readPackedVarint(o.commands):d===6?o.step=c.readFloat():d===7?c.readPackedSVarint(o.diffs):d===8&&(o.rule=c.readVarint())}function ose(d,o,c){d===1?(o.rgb_color=uS(c.readVarint()),o.paint="rgb_color"):d===2?(o.linear_gradient_idx=c.readVarint(),o.paint="linear_gradient_idx"):d===3?(o.radial_gradient_idx=c.readVarint(),o.paint="radial_gradient_idx"):d===5&&(o.opacity=c.readVarint())}function uS(d){return new Qr((d>>16&255)/255,(d>>8&255)/255,(255&d)/255,1)}function ase(d,o,c){d===1?(o.rgb_color=uS(c.readVarint()),o.paint="rgb_color"):d===2?(o.linear_gradient_idx=c.readVarint(),o.paint="linear_gradient_idx"):d===3?(o.radial_gradient_idx=c.readVarint(),o.paint="radial_gradient_idx"):d===5?c.readPackedFloat(o.dasharray):d===6?o.dashoffset=c.readFloat():d===7?o.miterlimit=c.readFloat():d===8?o.opacity=c.readVarint():d===9?o.width=c.readFloat():d===10?o.linecap=c.readVarint():d===11&&(o.linejoin=c.readVarint())}function lse(d,o,c){d===1?o.transform=cS(c,c.readVarint()+c.pos):d===2?o.spread_method=c.readVarint():d===3?o.stops.push(u6(c,c.readVarint()+c.pos)):d===4?o.x1=c.readFloat():d===5?o.y1=c.readFloat():d===6?o.x2=c.readFloat():d===7&&(o.y2=c.readFloat())}function u6(d,o){return d.readFields(cse,{offset:0,opacity:255,rgb_color:bP},o)}function cse(d,o,c){d===1?o.offset=c.readFloat():d===2?o.opacity=c.readVarint():d===3&&(o.rgb_color=uS(c.readVarint()))}function use(d,o,c){d===1?o.transform=cS(c,c.readVarint()+c.pos):d===2?o.spread_method=c.readVarint():d===3?o.stops.push(u6(c,c.readVarint()+c.pos)):d===4?o.cx=c.readFloat():d===5?o.cy=c.readFloat():d===6?o.r=c.readFloat():d===7?o.fx=c.readFloat():d===8?o.fy=c.readFloat():d===9&&(o.fr=c.readFloat())}function hse(d,o,c){d===1?o.transform=cS(c,c.readVarint()+c.pos):d===2?o.clip_path_idx=c.readVarint():d===3&&o.children.push(lS(c,c.readVarint()+c.pos))}function dse(d,o,c){d===1?o.left=o.top=c.readFloat():d===2?o.width=o.height=c.readFloat():d===3?o.top=c.readFloat():d===4?o.height=c.readFloat():d===5?o.mask_type=c.readVarint():d===6?o.mask_idx=c.readVarint():d===7&&o.children.push(lS(c,c.readVarint()+c.pos))}class fse{static calculate(o={},c=[]){const f=new Map,g=new Map;if(Object.keys(o).length===0)return f;c.forEach(p=>{g.set(p.name,p.rgb_color||new Qr(0,0,0))});for(const[p,x]of Object.entries(o))g.has(p)?f.set(g.get(p).toStringPremultipliedAlpha(),x):console.warn(`Ignoring unknown image variable "${p}"`);return f}}function C0(d,o=255,c){const f=o/255,g=d.toStringPremultipliedAlpha(),p=c.has(g)?c.get(g).clone():d.clone();return p.a*=f,p.toString()}function mv(d,o){if(!Dt()){const c=document.createElement("canvas");return c.width=d,c.height=o,c}return new OffscreenCanvas(d,o)}function pse(d,o){const c=fse.calculate(o.params,d.metadata?d.metadata.variables:[]),f=d.usvg_tree,g=f.width,p=f.height,x=o.transform?o.transform:new DOMMatrix,I=Math.max(1,Math.round(g*x.a)),D=Math.max(1,Math.round(p*x.d)),L=new DOMMatrix([I/g,0,0,D/p,0,0]),T=mv(I,D).getContext("2d");return EP(T,L,f,f,c),T.getImageData(0,0,I,D)}function EP(d,o,c,f,g){for(const p of f.children)h6(d,o,c,p,g)}function h6(d,o,c,f,g){f.group?(d.save(),function(p,x,I,D,L){const T=D.mask_idx!=null?I.masks[D.mask_idx]:null,k=D.clip_path_idx!=null?I.clip_paths[D.clip_path_idx]:null;if(D.transform&&(x=hS(D.transform).preMultiplySelf(x)),!function(B,U,X){return B.opacity!==255||U||X}(D,k!=null,T!=null))return void EP(p,x,I,D,L);const z=mv(p.canvas.width,p.canvas.height),O=z.getContext("2d");EP(O,x,I,D,L),k&&y6(O,x,I,k),T&&x6(O,x,I,T,L),p.globalAlpha=D.opacity/255,p.drawImage(z,0,0)}(d,o,c,f.group,g),d.restore()):f.path&&(d.save(),function(p,x,I,D,L){const T=v6(D);p.setTransform(x),D.paint_order===a6.PAINT_ORDER_FILL_AND_STROKE?(d6(p,I,D,T,L),p6(p,I,D,T,L)):(p6(p,I,D,T,L),d6(p,I,D,T,L))}(d,o,c,f.path,g),d.restore())}function d6(d,o,c,f,g){const p=c.fill;if(!p)return;const x=p.opacity/255;switch(p.paint){case"rgb_color":d.fillStyle=C0(p.rgb_color,p.opacity,g);break;case"linear_gradient_idx":d.fillStyle=m6(d,o.linear_gradients[p.linear_gradient_idx],x,g);break;case"radial_gradient_idx":d.fillStyle=g6(d,o.radial_gradients[p.radial_gradient_idx],x,g)}d.fill(f,f6(c))}function f6(d){return d.rule===wP.PATH_RULE_NON_ZERO?"nonzero":d.rule===wP.PATH_RULE_EVEN_ODD?"evenodd":void 0}function p6(d,o,c,f,g){const p=c.stroke;if(!p)return;d.lineWidth=p.width,d.miterLimit=p.miterlimit,d.setLineDash(p.dasharray),d.lineDashOffset=p.dashoffset;const x=p.opacity/255;switch(p.paint){case"rgb_color":d.strokeStyle=C0(p.rgb_color,p.opacity,g);break;case"linear_gradient_idx":d.strokeStyle=m6(d,o.linear_gradients[p.linear_gradient_idx],x,g);break;case"radial_gradient_idx":d.strokeStyle=g6(d,o.radial_gradients[p.radial_gradient_idx],x,g)}switch(p.linejoin){case pv.LINE_JOIN_MITER_CLIP:case pv.LINE_JOIN_MITER:d.lineJoin="miter";break;case pv.LINE_JOIN_ROUND:d.lineJoin="round";break;case pv.LINE_JOIN_BEVEL:d.lineJoin="bevel"}switch(p.linecap){case aS.LINE_CAP_BUTT:d.lineCap="butt";break;case aS.LINE_CAP_ROUND:d.lineCap="round";break;case aS.LINE_CAP_SQUARE:d.lineCap="square"}d.stroke(f)}function m6(d,o,c,f){if(o.stops.length===1){const z=o.stops[0];return C0(z.rgb_color,z.opacity*c,f)}const g=hS(o.transform),{x1:p,y1:x,x2:I,y2:D}=o,L=g.transformPoint(new DOMPoint(p,x)),T=g.transformPoint(new DOMPoint(I,D)),k=d.createLinearGradient(L.x,L.y,T.x,T.y);for(const z of o.stops)k.addColorStop(z.offset,C0(z.rgb_color,z.opacity*c,f));return k}function g6(d,o,c,f){if(o.stops.length===1){const z=o.stops[0];return C0(z.rgb_color,z.opacity*c,f)}const g=hS(o.transform),{fx:p,fy:x,cx:I,cy:D}=o,L=g.transformPoint(new DOMPoint(p,x)),T=g.transformPoint(new DOMPoint(I,D)),k=d.createRadialGradient(L.x,L.y,0,T.x,T.y,o.r*((g.a+g.d)/2));for(const z of o.stops)k.addColorStop(z.offset,C0(z.rgb_color,z.opacity*c,f));return k}function _6(d,o,c,f){const g=f.transform?hS(f.transform).preMultiplySelf(o):o,p=mv(d.canvas.width,d.canvas.height),x=p.getContext("2d");for(const D of f.children)if(D.group)_6(x,g,c,D.group);else if(D.path){const L=D.path,T=new Path2D;T.addPath(v6(L),g),x.fill(T,f6(L))}const I=f.clip_path_idx!=null?c.clip_paths[f.clip_path_idx]:null;I&&y6(x,g,c,I),d.globalCompositeOperation="source-over",d.drawImage(p,0,0)}function y6(d,o,c,f){const g=mv(d.canvas.width,d.canvas.height);_6(g.getContext("2d"),o,c,f),d.globalCompositeOperation="destination-in",d.drawImage(g,0,0)}function x6(d,o,c,f,g){if(f.children.length===0)return;const p=f.mask_idx!=null?c.masks[f.mask_idx]:null;p&&x6(d,o,c,p,g);const x=d.canvas.width,I=d.canvas.height,D=mv(x,I),L=D.getContext("2d"),T=f.width,k=f.height,z=f.left,O=f.top,B=new Path2D,U=new Path2D;U.rect(z,O,T,k),B.addPath(U,o),L.clip(B);for(const ce of f.children)h6(L,o,c,ce,g);const X=L.getImageData(0,0,x,I),J=X.data;if(f.mask_type===l6.MASK_TYPE_LUMINANCE)for(let ce=0;ce<J.length;ce+=4)J[ce+3]=J[ce+3]/255*(.2126*J[ce]+.7152*J[ce+1]+.0722*J[ce+2]);L.putImageData(X,0,0),d.globalCompositeOperation="destination-in",d.drawImage(D,0,0)}function hS(d){return d?new DOMMatrix([d.sx,d.ky,d.kx,d.sy,d.tx,d.ty]):new DOMMatrix}function v6(d){const o=new Path2D,c=d.step;let f=d.diffs[0]*c,g=d.diffs[1]*c;o.moveTo(f,g);for(let p=0,x=2;p<d.commands.length;p++)switch(d.commands[p]){case T0.PATH_COMMAND_MOVE:f+=d.diffs[x++]*c,g+=d.diffs[x++]*c,o.moveTo(f,g);break;case T0.PATH_COMMAND_LINE:f+=d.diffs[x++]*c,g+=d.diffs[x++]*c,o.lineTo(f,g);break;case T0.PATH_COMMAND_QUAD:{const I=f+d.diffs[x++]*c,D=g+d.diffs[x++]*c;f=I+d.diffs[x++]*c,g=D+d.diffs[x++]*c,o.quadraticCurveTo(I,D,f,g);break}case T0.PATH_COMMAND_CUBIC:{const I=f+d.diffs[x++]*c,D=g+d.diffs[x++]*c,L=I+d.diffs[x++]*c,T=D+d.diffs[x++]*c;f=L+d.diffs[x++]*c,g=T+d.diffs[x++]*c,o.bezierCurveTo(I,D,L,T,f,g);break}case T0.PATH_COMMAND_CLOSE:o.closePath()}return o}class dS{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const c=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,c),c}put(o,c){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,c)}delete(o){this.cache.delete(o)}}Tn(dS,"LRUCache");class SP{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new Aa(o,o.data)}getFromCache(o,c,f){return this.cacheMap.has(f)||this.cacheMap.set(f,new dS(150)),this.cacheMap.get(f).get(ap(o.toString(),c))}setInCache(o,c,f,g){this.cacheDependenciesMap.has(g)||this.cacheDependenciesMap.set(g,new Map),this.cacheMap.has(g)||this.cacheMap.set(g,new dS(150));const p=this.cacheDependenciesMap.get(g),x=ap(o.id.toString(),f);p.get(x)||p.set(x,new Set);const I=this.cacheMap.get(g),D=o.toString();p.get(x).add(D),I.put(ap(o.toString(),f),c)}removeImagesFromCacheByIds(o,c,f=0){if(!this.cacheMap.has(f)||!this.cacheDependenciesMap.has(f))return;const g=this.cacheMap.get(f),p=this.cacheDependenciesMap.get(f);for(const x of o){const I=ap(x.toString(),c);if(p.has(I)){for(const D of p.get(I))g.delete(D);p.delete(I)}}}rasterize(o,c,f,g,p=pse){const x=this.getFromCache(o,f,g);if(x)return x.clone();const I=p(c.icon,o.options),D=SP._getImage(I);return this.setInCache(o,D,f,g),D.clone()}}class b6{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,c){const f=this.toIdx(o,c);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(o,c){return this.leaves[this.toIdx(o,c)]}toIdx(o,c){return c*this.size+o}}function w6(d,o,c,f){let g=0,p=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(f[x])<1e-15){if(c[x]<d[x]||c[x]>o[x])return null}else{const I=1/f[x];let D=(d[x]-c[x])*I,L=(o[x]-c[x])*I;if(D>L){const T=D;D=L,L=T}if(D>g&&(g=D),L<p&&(p=L),g>p)return null}return g}function E6(d,o,c,f,g,p,x,I,D,L,T){const k=f-d,z=g-o,O=p-c,B=x-d,U=I-o,X=D-c,J=T[1]*X-T[2]*U,ce=T[2]*B-T[0]*X,le=T[0]*U-T[1]*B,ie=k*J+z*ce+O*le;if(Math.abs(ie)<1e-15)return null;const ge=1/ie,be=L[0]-d,Se=L[1]-o,Ve=L[2]-c,Le=(be*J+Se*ce+Ve*le)*ge;if(Le<0||Le>1)return null;const Be=Se*O-Ve*z,Qe=Ve*k-be*O,Ue=be*z-Se*k,Je=(T[0]*Be+T[1]*Qe+T[2]*Ue)*ge;return Je<0||Le+Je>1?null:(B*Be+U*Qe+X*Ue)*ge}function S6(d,o,c){return(d-o)/(c-o)}function T6(d,o,c,f,g,p,x,I,D){const L=1<<c,T=p-f,k=x-g,z=(d+1)/L*T+f,O=(o+0)/L*k+g,B=(o+1)/L*k+g;I[0]=(d+0)/L*T+f,I[1]=O,D[0]=z,D[1]=B}class C6{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(p){const x=Math.ceil(Math.log2(p.dim/8)),I=[];let D=Math.ceil(Math.pow(2,x));const L=1/D,T=(O,B,U,X,J)=>{const ce=X?1:0,le=(O+1)*U-ce,ie=B*U,ge=(B+1)*U-ce;J[0]=O*U,J[1]=ie,J[2]=le,J[3]=ge};let k=new b6(D);const z=[];for(let O=0;O<D*D;O++){T(O%D,Math.floor(O/D),L,!1,z);const B=bp(z[0],z[1],p),U=bp(z[2],z[1],p),X=bp(z[2],z[3],p),J=bp(z[0],z[3],p);k.minimums.push(Math.min(B,U,X,J)),k.maximums.push(Math.max(B,U,X,J)),k.leaves.push(1)}for(I.push(k),D/=2;D>=1;D/=2){const O=I[I.length-1];k=new b6(D);for(let B=0;B<D*D;B++){T(B%D,Math.floor(B/D),2,!0,z);const U=O.getElevation(z[0],z[1]),X=O.getElevation(z[2],z[1]),J=O.getElevation(z[2],z[3]),ce=O.getElevation(z[0],z[3]),le=O.isLeaf(z[0],z[1]),ie=O.isLeaf(z[2],z[1]),ge=O.isLeaf(z[2],z[3]),be=O.isLeaf(z[0],z[3]),Se=Math.min(U.min,X.min,J.min,ce.min),Ve=Math.max(U.max,X.max,J.max,ce.max),Le=le&&ie&&ge&&be;k.maximums.push(Ve),k.minimums.push(Se),k.leaves.push(Ve-Se<=5&&Le?1:0)}I.push(k)}return I}(this.dem),f=c.length-1,g=c[f];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(c,0,0,f,0)}raycastRoot(o,c,f,g,p,x,I=1){return w6([o,c,-100],[f,g,this.maximums[0]*I],p,x)}raycast(o,c,f,g,p,x,I=1){if(!this.nodeCount)return null;const D=this.raycastRoot(o,c,f,g,p,x,I);if(D==null)return null;const L=[],T=[],k=[],z=[],O=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:B,t:U,nodex:X,nodey:J,depth:ce}=O.pop();if(this.leaves[B]){T6(X,J,ce,o,c,f,g,k,z);const ie=1<<ce,ge=(X+0)/ie,be=(X+1)/ie,Se=(J+0)/ie,Ve=(J+1)/ie,Le=bp(ge,Se,this.dem)*I,Be=bp(be,Se,this.dem)*I,Qe=bp(be,Ve,this.dem)*I,Ue=bp(ge,Ve,this.dem)*I,Je=E6(k[0],k[1],Le,z[0],k[1],Be,z[0],z[1],Qe,p,x),lt=E6(z[0],z[1],Qe,k[0],z[1],Ue,k[0],k[1],Le,p,x),st=Math.min(Je!==null?Je:Number.MAX_VALUE,lt!==null?lt:Number.MAX_VALUE);if(st!==Number.MAX_VALUE)return st;{const mt=Pe.vec3.scaleAndAdd([],p,x,U);if(I6(Le,Be,Ue,Qe,S6(mt[0],k[0],z[0]),S6(mt[1],k[1],z[1]))>=mt[2])return U}continue}let le=0;for(let ie=0;ie<this._siblingOffset.length;ie++){T6((X<<1)+this._siblingOffset[ie][0],(J<<1)+this._siblingOffset[ie][1],ce+1,o,c,f,g,k,z),k[2]=-100,z[2]=this.maximums[this.childOffsets[B]+ie]*I;const ge=w6(k,z,p,x);if(ge!=null){const be=ge;L[ie]=be;let Se=!1;for(let Ve=0;Ve<le&&!Se;Ve++)be>=L[T[Ve]]&&(T.splice(Ve,0,ie),Se=!0);Se||(T[le]=ie),le++}}for(let ie=0;ie<le;ie++){const ge=T[ie];O.push({idx:this.childOffsets[B]+ge,t:L[ge],nodex:(X<<1)+this._siblingOffset[ge][0],nodey:(J<<1)+this._siblingOffset[ge][1],depth:ce+1})}}return null}_addNode(o,c,f){return this.minimums.push(o),this.maximums.push(c),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(o,c,f,g,p){if(o[g].isLeaf(c,f)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const x=g-1,I=o[x];let D=0,L=0;for(let T=0;T<this._siblingOffset.length;T++){const k=2*c+this._siblingOffset[T][0],z=2*f+this._siblingOffset[T][1],O=I.getElevation(k,z),B=I.isLeaf(k,z),U=this._addNode(O.min,O.max,B);B&&(D|=1<<T),L||(L=U)}for(let T=0;T<this._siblingOffset.length;T++)D&1<<T||this._construct(o,2*c+this._siblingOffset[T][0],2*f+this._siblingOffset[T][1],x,L+T)}}function I6(d,o,c,f,g,p){return Wn(Wn(d,c,p),Wn(o,f,p),g)}function bp(d,o,c){const f=c.dim,g=Bn(d*f-.5,0,f-1),p=Bn(o*f-.5,0,f-1),x=Math.floor(g),I=Math.floor(p),D=Math.min(x+1,f-1),L=Math.min(I+1,f-1);return I6(c.get(x,I),c.get(D,I),c.get(x,L),c.get(D,L),g-x,p-I)}const mse={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function gse(d,o,c){return(256*d*256+256*o+c)/10-1e4}function _se(d,o,c){return 256*d+o+c/256-32768}class fS{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,c,f,g=!1){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void Nr(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const p=this.dim=c.height-2,x=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let D=0;D<p;D++)x[this._idx(-1,D)]=x[this._idx(0,D)],x[this._idx(p,D)]=x[this._idx(p-1,D)],x[this._idx(D,-1)]=x[this._idx(D,0)],x[this._idx(D,p)]=x[this._idx(D,p-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(p,-1)]=x[this._idx(p-1,0)],x[this._idx(-1,p)]=x[this._idx(0,p-1)],x[this._idx(p,p)]=x[this._idx(p-1,p-1)]}const I=f==="terrarium"?_se:gse;for(let D=0;D<x.length;++D){const L=4*D;this.floatView[D]=I(this.pixels[L],this.pixels[L+1],this.pixels[L+2])}this._timestamp=Mt.now()}_buildQuadTree(){this._tree=new C6(this)}get(o,c,f=!1){f&&(o=Bn(o,-1,this.dim),c=Bn(c,-1,this.dim));const g=this._idx(o,c);return this.floatView[g]}set(o,c,f){const g=this._idx(o,c),p=this.floatView[g];return this.floatView[g]=f,f-p}static getUnpackVector(o){return mse[o]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}static pack(o,c){const f=[0,0,0,0],g=fS.getUnpackVector(c);let p=Math.floor((o+g[3])/g[2]);return f[2]=p%256,p=Math.floor(p/256),f[1]=p%256,p=Math.floor(p/256),f[0]=p,f}getPixels(){return new F5({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,c,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,p=c*this.dim+this.dim,x=f*this.dim,I=f*this.dim+this.dim;switch(c){case-1:g=p-1;break;case 1:p=g+1}switch(f){case-1:x=I-1;break;case 1:I=x+1}const D=-c*this.dim,L=-f*this.dim;for(let T=x;T<I;T++)for(let k=g;k<p;k++){const z=4*this._idx(k,T),O=4*this._idx(k+D,T+L);this.pixels[z+0]=o.pixels[O+0],this.pixels[z+1]=o.pixels[O+1],this.pixels[z+2]=o.pixels[O+2],this.pixels[z+3]=o.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function yse(d,o,c){d===1?o.headerLength=c.readFixed32():d===2?o.x=c.readVarint():d===3?o.y=c.readVarint():d===4?o.z=c.readVarint():d===5&&o.layers.push(function(f,g){return f.readFields(Ese,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)}(c,c.readVarint()+c.pos))}function xse(d,o,c){d===1?(o.delta_filter=function(f,g){return f.readFields(vse,{blockSize:0},g)}(c,c.readVarint()+c.pos),o.filter="delta_filter"):d===2?(c.readVarint(),o.filter="zigzag_filter"):d===3?(c.readVarint(),o.filter="bitshuffle_filter"):d===4&&(c.readVarint(),o.filter="byteshuffle_filter")}function vse(d,o,c){d===1&&(o.blockSize=c.readVarint())}function bse(d,o,c){d===1?(c.readVarint(),o.codec="gzip_data"):d===2?(c.readVarint(),o.codec="jpeg_image"):d===3?(c.readVarint(),o.codec="webp_image"):d===4&&(c.readVarint(),o.codec="png_image")}function wse(d,o,c){let f=0,g=0;d===1?o.firstByte=c.readFixed64():d===2?o.lastByte=c.readFixed64():d===3?o.filters.push(function(p,x){return p.readFields(xse,{},x)}(c,c.readVarint()+c.pos)):d===4?o.codec=function(p,x){return p.readFields(bse,{},x)}(c,c.readVarint()+c.pos):d===5?g=c.readFloat():d===6?f=c.readFloat():d===7?o.bands.push(c.readString()):d===8?o.offset=c.readDouble():d===9&&(o.scale=c.readDouble()),o.offset===0&&(o.offset=g),o.scale===0&&(o.scale=f)}function Ese(d,o,c){d===1?o.version=c.readVarint():d===2?o.name=c.readString():d===3?o.units=c.readString():d===4?o.tileSize=c.readVarint():d===5?o.buffer=c.readVarint():d===6?o.pixelFormat=c.readVarint():d===7&&o.dataIndex.push(function(f,g){return f.readFields(wse,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)}(c,c.readVarint()+c.pos))}function Sse(d,o,c){if(d===2)(function(f,g,p){f.readFields(Tse,p,g)})(c,c.readVarint()+c.pos,o);else if(d===3)throw new Error("Not implemented")}function Tse(d,o,c){if(d===1){let f=0;const g=c.readVarint()+c.pos;for(;c.pos<g;)o[f++]=c.readVarint()}}function Cse(d,o){if(o.length!==4)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let c=o[3];for(let f=2;f>=1;f--){const g=f===1?1:0,p=f===2?1:0;for(let x=0;x<o[0];x++){const I=o[1]*x;for(let D=g;D<o[1];D++){const L=o[2]*(D+I);for(let T=p;T<o[2];T++){const k=o[3]*(T+L);for(let z=0;z<o[3];z++){const O=k+z;d[O]+=d[O-c]}}}}c*=o[f]}return d}function Ise(d){for(let o=0,c=d.length;o<c;o++)d[o]=d[o]>>>1^-(1&d[o]);return d}function Ase(d,o){switch(o){case"uint32":return d;case"uint16":for(let c=0;c<d.length;c+=2){const f=d[c],g=d[c+1];d[c]=(240&f)>>4|(61440&f)>>8|(240&g)<<4|61440&g,d[c+1]=15&f|(3840&f)>>4|(15&g)<<8|(3840&g)<<4}return d;case"uint8":for(let c=0;c<d.length;c+=4){const f=d[c],g=d[c+1],p=d[c+2],x=d[c+3];d[c+0]=(192&f)>>6|(192&g)>>4|(192&p)>>2|192&x,d[c+1]=(48&f)>>4|(48&g)>>2|48&p|(48&x)<<2,d[c+2]=(12&f)>>2|12&g|(12&p)<<2|(12&x)<<4,d[c+3]=3&f|(3&g)<<2|(3&p)<<4|(3&x)<<6}return d;default:throw new Error(`Invalid pixel format, "${o}"`)}}Tn(fS,"DEMData"),Tn(C6,"DemMinMaxQuadTree",{omit:["dem"]});var tu=Uint8Array,gv=Uint16Array,Rse=Int32Array,A6=new tu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),R6=new tu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mse=new tu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M6=function(d,o){for(var c=new gv(31),f=0;f<31;++f)c[f]=o+=1<<d[f-1];var g=new Rse(c[30]);for(f=1;f<30;++f)for(var p=c[f];p<c[f+1];++p)g[p]=p-c[f]<<5|f;return{b:c,r:g}},P6=M6(A6,2),D6=P6.b,Pse=P6.r;D6[28]=258,Pse[258]=28;for(var Dse=M6(R6,0).b,k6=new gv(32768),wo=0;wo<32768;++wo){var I0=(43690&wo)>>1|(21845&wo)<<1;k6[wo]=((65280&(I0=(61680&(I0=(52428&I0)>>2|(13107&I0)<<2))>>4|(3855&I0)<<4))>>8|(255&I0)<<8)>>1}var _v=function(d,o,c){for(var f=d.length,g=0,p=new gv(o);g<f;++g)d[g]&&++p[d[g]-1];var x,I=new gv(o);for(g=1;g<o;++g)I[g]=I[g-1]+p[g-1]<<1;x=new gv(1<<o);var D=15-o;for(g=0;g<f;++g)if(d[g])for(var L=g<<4|d[g],T=o-d[g],k=I[d[g]-1]++<<T,z=k|(1<<T)-1;k<=z;++k)x[k6[k]>>D]=L;return x},yv=new tu(288);for(wo=0;wo<144;++wo)yv[wo]=8;for(wo=144;wo<256;++wo)yv[wo]=9;for(wo=256;wo<280;++wo)yv[wo]=7;for(wo=280;wo<288;++wo)yv[wo]=8;var N6=new tu(32);for(wo=0;wo<32;++wo)N6[wo]=5;var kse=_v(yv,9),Nse=_v(N6,5),TP=function(d){for(var o=d[0],c=1;c<d.length;++c)d[c]>o&&(o=d[c]);return o},fh=function(d,o,c){var f=o/8|0;return(d[f]|d[f+1]<<8)>>(7&o)&c},CP=function(d,o){var c=o/8|0;return(d[c]|d[c+1]<<8|d[c+2]<<16)>>(7&o)},Ose=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ph=function(d,o,c){var f=new Error(o||Ose[d]);if(f.code=d,Error.captureStackTrace&&Error.captureStackTrace(f,ph),!c)throw f;return f},Lse=new tu(0),Fse=typeof TextDecoder<"u"&&new TextDecoder;try{Fse.decode(Lse,{stream:!0})}catch{}const Bse={gzip_data:"gzip"};class Nu extends Error{constructor(o){super(o),this.name="MRTError"}}const zse={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},O6={uint32:1,uint16:2,uint8:4},jse={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let IP;class pS{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const c=this.layers[o];if(!c)throw new Nu(`Layer '${o}' not found`);return c}getHeaderLength(o){const c=new Uint8Array(o),f=new DataView(o);if(c[0]!==13)throw new Nu("File is not a valid MRT.");return f.getUint32(1,!0)}parseHeader(o){const c=new Uint8Array(o),f=this.getHeaderLength(o);if(c.length<f)throw new Nu(`Expected header with length >= ${f} but got buffer of length ${c.length}`);const g=function(p,x){return p.readFields(yse,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new IP(c.subarray(0,f)));if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new Nu(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const p of g.layers)this.layers[p.name]=new L6(p,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const c=[],f=this.getLayer(o.layerName);for(let g of o.blockIndices){const p=f.dataIndex[g],x=p.firstByte-o.firstByte,I=p.lastByte-o.firstByte;if(f._blocksInProgress.has(g))continue;const D={layerName:f.name,firstByte:x,lastByte:I,pixelFormat:f.pixelFormat,blockIndex:g,blockShape:[p.bands.length].concat(f.bandShape),buffer:f.buffer,codec:p.codec.codec,filters:p.filters.map(L=>L.filter)};f._blocksInProgress.add(g),c.push(D)}return new F6(c,()=>{c.forEach(g=>f._blocksInProgress.delete(g.blockIndex))},(g,p)=>{if(c.forEach(x=>f._blocksInProgress.delete(x.blockIndex)),g)throw g;p.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class L6{constructor({version:o,name:c,units:f,tileSize:g,pixelFormat:p,buffer:x,dataIndex:I},D){if(this.version=o,this.version!==1)throw new Nu(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=c,this.units=f,this.tileSize=g,this.buffer=x,this.pixelFormat=zse[p],this.dataIndex=I,this.bandShape=[g+2*x,g+2*x,O6[this.pixelFormat]],this._decodedBlocks=new dS(D?D.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return O6[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const c=o.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,o.data)}getBlockForBand(o){let c=0;switch(typeof o){case"string":for(const[f,g]of this.dataIndex.entries()){for(const[p,x]of g.bands.entries())if(x===o)return{bandIndex:c+p,blockIndex:f,blockBandIndex:p};c+=g.bands.length}break;case"number":for(const[f,g]of this.dataIndex.entries()){if(o>=c&&o<c+g.bands.length)return{bandIndex:o,blockIndex:f,blockBandIndex:o-c};c+=g.bands.length}break;default:throw new Nu(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(o){let c=1/0,f=-1/0;const g=[],p=new Set;for(const x of o){const{blockIndex:I}=this.getBlockForBand(x);if(I<0)throw new Nu(`Invalid band: ${JSON.stringify(x)}`);const D=this.dataIndex[I];g.includes(I)||g.push(I),p.add(I),c=Math.min(c,D.firstByte),f=Math.max(f,D.lastByte)}if(p.size>this.cacheSize)throw new Nu(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:f,blockIndices:g}}hasBand(o){const{blockIndex:c}=this.getBlockForBand(o);return c>=0}hasDataForBand(o){const{blockIndex:c}=this.getBlockForBand(o);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(o){const{blockIndex:c,blockBandIndex:f}=this.getBlockForBand(o);if(c<0)throw new Nu(`Band not found: ${JSON.stringify(o)}`);const g=this._decodedBlocks.get(c.toString());if(!g)throw new Nu(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[c],x=this.bandShape.reduce((L,T)=>L*T,1),I=f*x,D=g.subarray(I,I+x);return{data:D,bytes:new Uint8Array(D.buffer).subarray(D.byteOffset,D.byteOffset+D.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}pS.setPbf=function(d){IP=d};class F6{constructor(o,c,f){this.tasks=o,this._onCancel=c,this._onComplete=f,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,c){this._finalized||(this._onComplete(o,c),this._finalized=!0)}}pS.performDecoding=function(d,o){const c=new Uint8Array(d);return Promise.all(o.tasks.map(f=>{const{layerName:g,firstByte:p,lastByte:x,pixelFormat:I,blockShape:D,blockIndex:L,filters:T,codec:k}=f,z=c.subarray(p,x+1),O=new Uint32Array(D[0]*D[1]*D[2]);let B;if(k!=="gzip_data")throw new Nu(`Unhandled codec: ${k}`);return B=function(U,X){if(!globalThis.DecompressionStream&&X==="gzip_data")return Promise.resolve(((ie=function(Se){Se[0]==31&&Se[1]==139&&Se[2]==8||ph(6,"invalid gzip data");var Ve=Se[3],Le=10;4&Ve&&(Le+=2+(Se[10]|Se[11]<<8));for(var Be=(Ve>>3&1)+(Ve>>4&1);Be>0;Be-=!Se[Le++]);return Le+(2&Ve)}(le=U))+8>le.length&&ph(6,"invalid gzip data"),function(Se,Ve,Le,Be){var Qe=Se.length;if(!Qe||Ve.f&&!Ve.l)return Le||new tu(0);var Ue=!Le,Je=Ue||Ve.i!=2,lt=Ve.i;Ue&&(Le=new tu(3*Qe));var st,mt,pt=function(Ep){var Sp=Le.length;if(Ep>Sp){var vg=new tu(Math.max(2*Sp,Ep));vg.set(Le),Le=vg}},vt=Ve.f||0,_t=Ve.p||0,Et=Ve.b||0,qt=Ve.l,Ht=Ve.d,Cn=Ve.m,Qt=Ve.n,ln=8*Qe;do{if(!qt){vt=fh(Se,_t,1);var Yt=fh(Se,_t+1,3);if(_t+=3,!Yt){var Zn=Se[(lr=4+((_t+7)/8|0))-4]|Se[lr-3]<<8,bn=lr+Zn;if(bn>Qe){lt&&ph(0);break}Je&&pt(Et+Zn),Le.set(Se.subarray(lr,bn),Et),Ve.b=Et+=Zn,Ve.p=_t=8*bn,Ve.f=vt;continue}if(Yt==1)qt=kse,Ht=Nse,Cn=9,Qt=5;else if(Yt==2){var Pn=fh(Se,_t,31)+257,ar=fh(Se,_t+10,15)+4,Pr=Pn+fh(Se,_t+5,31)+1;_t+=14;for(var fr=new tu(Pr),jr=new tu(19),Mr=0;Mr<ar;++Mr)jr[Mse[Mr]]=fh(Se,_t+3*Mr,7);_t+=3*ar;var Hr=TP(jr),gi=(1<<Hr)-1,$i=_v(jr,Hr);for(Mr=0;Mr<Pr;){var lr,ti=$i[fh(Se,_t,gi)];if(_t+=15&ti,(lr=ti>>4)<16)fr[Mr++]=lr;else{var ms=0,Ss=0;for(lr==16?(Ss=3+fh(Se,_t,3),_t+=2,ms=fr[Mr-1]):lr==17?(Ss=3+fh(Se,_t,7),_t+=3):lr==18&&(Ss=11+fh(Se,_t,127),_t+=7);Ss--;)fr[Mr++]=ms}}var ks=fr.subarray(0,Pn),Us=fr.subarray(Pn);Cn=TP(ks),Qt=TP(Us),qt=_v(ks,Cn),Ht=_v(Us,Qt)}else ph(1);if(_t>ln){lt&&ph(0);break}}Je&&pt(Et+131072);for(var Hi=(1<<Cn)-1,Vo=(1<<Qt)-1,gl=_t;;gl=_t){var _o=(ms=qt[CP(Se,_t)&Hi])>>4;if((_t+=15&ms)>ln){lt&&ph(0);break}if(ms||ph(2),_o<256)Le[Et++]=_o;else{if(_o==256){gl=_t,qt=null;break}var Eo=_o-254;_o>264&&(Eo=fh(Se,_t,(1<<(nu=A6[Mr=_o-257]))-1)+D6[Mr],_t+=nu);var $a=Ht[CP(Se,_t)&Vo],ha=$a>>4;if($a||ph(3),_t+=15&$a,Us=Dse[ha],ha>3){var nu=R6[ha];Us+=CP(Se,_t)&(1<<nu)-1,_t+=nu}if(_t>ln){lt&&ph(0);break}Je&&pt(Et+131072);var wp=Et+Eo;if(Et<Us){var Ou=0-Us,gh=Math.min(Us,wp);for(Ou+Et<0&&ph(3);Et<gh;++Et)Le[Et]=(void 0)[Ou+Et]}for(;Et<wp;++Et)Le[Et]=Le[Et-Us]}}Ve.l=qt,Ve.p=gl,Ve.b=Et,Ve.f=vt,qt&&(vt=1,Ve.m=Cn,Ve.d=Ht,Ve.n=Qt)}while(!vt);return Et!=Le.length&&Ue?(st=Le,((mt=Et)==null||mt>st.length)&&(mt=st.length),new tu(st.subarray(0,mt))):Le.subarray(0,Et)}(le.subarray(ie,-8),{i:2},new tu(((J=le)[(ce=J.length)-4]|J[ce-3]<<8|J[ce-2]<<16|J[ce-1]<<24)>>>0))));var J,ce,le,ie;const ge=Bse[X];if(!ge)throw new Error(`Unhandled codec: ${X}`);const be=new globalThis.DecompressionStream(ge);return new Response(new Blob([U]).stream().pipeThrough(be)).arrayBuffer().then(Se=>new Uint8Array(Se))}(z,k).then(U=>(function(X,J){X.readFields(Sse,J)}(new IP(U),O),new jse[I](O.buffer))),B.then(U=>{for(let X=T.length-1;X>=0;X--)switch(T[X]){case"delta_filter":Cse(U,D);break;case"zigzag_filter":Ise(U);break;case"bitshuffle_filter":Ase(U,I);break;default:throw new Nu(`Unhandled filter "${T[X]}"`)}return{layerName:g,blockIndex:L,data:U}}).catch(U=>{throw U})}))},Tn(F6,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Tn(pS,"MapboxRasterTile"),Tn(L6,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let xv,AP,mh,A0,RP,R0=null;function B6(){return Zr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:AP||Te.DRACO_URL}function z6(){if(Zr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(A0)return A0;const d=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return A0=WebAssembly.validate(d)?Te.MESHOPT_SIMD_URL:Te.MESHOPT_URL,A0}const mS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Vse={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},vv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function j6(d,o,c){const f=c.json.bufferViews.length,g=c.buffers.length;o.bufferView=f,c.json.bufferViews[f]={buffer:g,byteLength:d.byteLength},c.buffers[g]=d}const MP="KHR_draco_mesh_compression";function Use(d,o){const c=d.extensions&&d.extensions[MP];if(!c)return;const f=new mh.Decoder,g=W6(o,c.bufferView),p=new mh.Mesh;if(!f.DecodeArrayToMesh(g,g.byteLength,p))throw new Error("Failed to decode Draco mesh");const x=o.json.accessors[d.indices],I=mS[x.componentType],D=x.count*I.BYTES_PER_ELEMENT,L=mh._malloc(D);I===Uint16Array?f.GetTrianglesUInt16Array(p,D,L):f.GetTrianglesUInt32Array(p,D,L),j6(mh.memory.buffer.slice(L,L+D),x,o),mh._free(L);for(const T of Object.keys(c.attributes)){const k=f.GetAttributeByUniqueId(p,c.attributes[T]),z=o.json.accessors[d.attributes[T]],O=Vse[z.componentType],B=z.count*vv[z.type]*mS[z.componentType].BYTES_PER_ELEMENT,U=mh._malloc(B);f.GetAttributeDataArrayForAllPoints(p,k,mh[O],B,U),j6(mh.memory.buffer.slice(U,U+B),z,o),mh._free(U)}f.destroy(),p.destroy(),delete d.extensions[MP]}const gS="EXT_meshopt_compression";function Hse(d,o){if(!d.extensions||!d.extensions[gS])return;const c=d.extensions[gS],f=new Uint8Array(o.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),g=new Uint8Array(c.count*c.byteStride);RP.decodeGltfBuffer(g,c.count,c.byteStride,f,c.mode,c.filter),d.buffer=o.buffers.length,d.byteOffset=0,o.buffers[d.buffer]=g.buffer,delete d.extensions[gS]}const V6=1179937895,U6=new TextDecoder("utf8");function H6(d,o){return new URL(d,o).href}function Wse(d,o,c,f){return fetch(H6(d.uri,f)).then(g=>g.arrayBuffer()).then(g=>{o.buffers[c]=g})}function W6(d,o){const c=d.json.bufferViews[o];return new Uint8Array(d.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function $se(d,o,c,f){if(d.uri){const g=H6(d.uri,f);return fetch(g).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{o.images[c]=p})}if(d.bufferView!==void 0){const g=W6(o,d.bufferView),p=new Blob([g],{type:d.mimeType});return createImageBitmap(p).then(x=>{o.images[c]=x})}}function $6(d,o=0,c){const f={json:null,images:[],buffers:[]};if(new Uint32Array(d,o,1)[0]===V6){const T=new Uint32Array(d,o);let k=2;const z=(T[k++]>>2)-3,O=T[k++]>>2;if(k++,f.json=JSON.parse(U6.decode(T.subarray(k,k+O))),k+=O,k<z){const B=T[k++];k++;const U=o+(k<<2);f.buffers[0]=d.slice(U,U+B)}}else f.json=JSON.parse(U6.decode(new Uint8Array(d,o)));const{buffers:g,images:p,meshes:x,extensionsUsed:I,bufferViews:D}=f.json;let L=Promise.resolve();if(g){const T=[];for(let k=0;k<g.length;k++){const z=g[k];z.uri?T.push(Wse(z,f,k,c)):f.buffers[k]||(f.buffers[k]=null)}L=Promise.all(T)}return L.then(()=>{const T=[],k=I&&I.includes(MP),z=I&&I.includes(gS);if(k&&T.push(function(){if(!mh)return xv??(xv=function(O){let B,U=null;function X(){B=new Uint8Array(U.buffer)}function J(){throw new Error("Unexpected Draco error.")}const ce={a:{a:J,d:function(le,ie,ge){return B.copyWithin(le,ie,ie+ge)},c:function(le){const ie=B.length,ge=Math.max(le>>>0,Math.ceil(1.2*ie)),be=Math.ceil((ge-ie)/65536);try{return U.grow(be),X(),!0}catch{return!1}},b:J}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(O,ce):O.then(le=>le.arrayBuffer()).then(le=>WebAssembly.instantiate(le,ce))).then(le=>{const{Rb:ie,Qb:ge,P:be,T:Se,X:Ve,Ja:Le,La:Be,Qa:Qe,Va:Ue,Wa:Je,eb:lt,jb:st,f:mt,e:pt,yb:vt,zb:_t,Ab:Et,Bb:qt,Db:Ht,Gb:Cn}=le.instance.exports;U=pt;const Qt=(()=>{let ln=0,Yt=0,Zn=0,bn=0;return Pn=>{Zn&&(ie(bn),ie(ln),Yt+=Zn,Zn=ln=0),ln||(Yt+=128,ln=ge(Yt));const ar=Pn.length+7&-8;let Pr=ln;ar>=Yt&&(Zn=ar,Pr=bn=ge(ar));for(let fr=0;fr<Pn.length;fr++)B[Pr+fr]=Pn[fr];return Pr}})();return X(),mt(),{memory:pt,_free:ie,_malloc:ge,Mesh:class{constructor(){this.ptr=be()}destroy(){Se(this.ptr)}},Decoder:class{constructor(){this.ptr=Le()}destroy(){st(this.ptr)}DecodeArrayToMesh(ln,Yt,Zn){const bn=Qt(ln),Pn=Be(this.ptr,bn,Yt,Zn.ptr);return!!Ve(Pn)}GetAttributeByUniqueId(ln,Yt){return{ptr:Qe(this.ptr,ln.ptr,Yt)}}GetTrianglesUInt16Array(ln,Yt,Zn){Ue(this.ptr,ln.ptr,Yt,Zn)}GetTrianglesUInt32Array(ln,Yt,Zn){Je(this.ptr,ln.ptr,Yt,Zn)}GetAttributeDataArrayForAllPoints(ln,Yt,Zn,bn,Pn){lt(this.ptr,ln.ptr,Yt.ptr,Zn,bn,Pn)}},DT_INT8:vt(),DT_UINT8:_t(),DT_INT16:Et(),DT_UINT16:qt(),DT_UINT32:Ht(),DT_FLOAT32:Cn()}})}(fetch(B6())),xv.then(O=>{mh=O,xv=void 0}))}()),z&&T.push(function(){if(RP)return;const O=function(B){let U;const X=WebAssembly.instantiateStreaming(B,{}).then(le=>{U=le.instance,U.exports.__wasm_call_ctors()}),J={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ce={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:X,supported:!0,decodeGltfBuffer(le,ie,ge,be,Se,Ve){(function(Le,Be,Qe,Ue,Je,lt,st){const mt=Le.exports.sbrk,pt=Ue+3&-4,vt=mt(pt*Je),_t=mt(lt.length),Et=new Uint8Array(Le.exports.memory.buffer);Et.set(lt,_t);const qt=Be(vt,Ue,Je,_t,lt.length);if(qt===0&&st&&st(vt,pt,Je),Qe.set(Et.subarray(vt,vt+Ue*Je)),mt(vt-mt(0)),qt!==0)throw new Error(`Malformed buffer data: ${qt}`)})(U,U.exports[ce[Se]],le,ie,ge,be,U.exports[J[Ve]])}}}(fetch(z6()));return O.ready.then(()=>{RP=O})}()),p)for(let O=0;O<p.length;O++)T.push($se(p[O],f,O,c));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(k&&x)for(const{primitives:O}of x)for(const B of O)Use(B,f);if(z&&x&&D)for(const O of D)Hse(O,f);return f})})}function xg(d,o){const c=d.json.bufferViews[o.bufferView],f=mS[o.componentType];return new f(d.buffers[c.buffer],(o.byteOffset||0)+(c.byteOffset||0),o.count*(c.byteStride&&c.byteStride!==vv[o.type]*f.BYTES_PER_ELEMENT?c.byteStride/f.BYTES_PER_ELEMENT:vv[o.type]))}function PP(d,o,c,f){const g=mS[o.componentType],p=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),x=d.json.bufferViews[o.bufferView],I=x.byteStride?x.byteStride/g.BYTES_PER_ELEMENT:vv[o.type],D=c.float32,L=D.length/c.capacity;for(let T=0,k=0;T<o.count*I;T+=I,k+=L)for(let z=0;z<L;z++)D[k+z]=f[T+z]*p;c._trim()}function qse(d,o,c){const f=d.indices,g=d.attributes,p={};p.indexArray=new la;const x=o.json.accessors[f],I=x.count/3;p.indexArray.reserve(I);const D=xg(o,x);for(let z=0;z<I;z++)p.indexArray.emplaceBack(D[3*z],D[3*z+1],D[3*z+2]);p.indexArray._trim(),p.vertexArray=new Jc;const L=o.json.accessors[g.POSITION];p.vertexArray.reserve(L.count);const T=xg(o,L);for(let z=0;z<L.count;z++)p.vertexArray.emplaceBack(T[3*z],T[3*z+1],T[3*z+2]);if(p.vertexArray._trim(),p.aabb=new Nn(L.min,L.max),p.centroid=function(z,O){const B=[0,0,0],U=z.length;if(U>0){for(let X=0;X<U;X++){const J=3*z[X];B[0]+=O[J],B[1]+=O[J+1],B[2]+=O[J+2]}B[0]/=U,B[1]/=U,B[2]/=U}return B}(D,T),g.COLOR_0!==void 0){const z=o.json.accessors[g.COLOR_0],O=vv[z.type],B=xg(o,z);p.colorArray=O===3?new Jc:new Wd,p.colorArray.resize(z.count),PP(o,z,p.colorArray,B)}if(g.NORMAL!==void 0){p.normalArray=new Jc;const z=o.json.accessors[g.NORMAL];p.normalArray.resize(z.count);const O=xg(o,z);PP(o,z,p.normalArray,O)}if(g.TEXCOORD_0!==void 0&&c.length>0){p.texcoordArray=new cp;const z=o.json.accessors[g.TEXCOORD_0];p.texcoordArray.resize(z.count);const O=xg(o,z);PP(o,z,p.texcoordArray,O)}if(g._FEATURE_ID_RGBA4444!==void 0){const z=o.json.accessors[g._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=xg(o,z))}g._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(xg(o,o.json.accessors[g._FEATURE_RGBA4444]).buffer));const k=d.material;return p.material=function(z,O){const{emissiveFactor:B=[0,0,0],alphaMode:U="OPAQUE",alphaCutoff:X=.5,normalTexture:J,occlusionTexture:ce,emissiveTexture:le,doubleSided:ie}=z,{baseColorFactor:ge=[1,1,1,1],metallicFactor:be=1,roughnessFactor:Se=1,baseColorTexture:Ve,metallicRoughnessTexture:Le}=z.pbrMetallicRoughness||{},Be=ce?O[ce.index]:void 0;if(ce&&ce.extensions&&ce.extensions.KHR_texture_transform&&Be){const Qe=ce.extensions.KHR_texture_transform;Be.offsetScale=[Qe.offset[0],Qe.offset[1],Qe.scale[0],Qe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Qr(...ge),metallicFactor:be,roughnessFactor:Se,baseColorTexture:Ve?O[Ve.index]:void 0,metallicRoughnessTexture:Le?O[Le.index]:void 0},doubleSided:ie,emissiveFactor:B,alphaMode:U,alphaCutoff:X,normalTexture:J?O[J.index]:void 0,occlusionTexture:Be,emissionTexture:le?O[le.index]:void 0,defined:z.defined===void 0}}(k!==void 0?o.json.materials[k]:{defined:!1},c),p}function q6(d,o,c){const{matrix:f,rotation:g,translation:p,scale:x,mesh:I,extras:D,children:L}=d,T={};if(T.matrix=f||Pe.mat4.fromRotationTranslationScale([],g||[0,0,0,1],p||[0,0,0],x||[1,1,1]),I!==void 0){T.meshes=c[I];const k=T.anchor=[0,0];for(const z of T.meshes){const{min:O,max:B}=z.aabb;k[0]+=O[0]+B[0],k[1]+=O[1]+B[1]}k[0]=Math.floor(k[0]/T.meshes.length/2),k[1]=Math.floor(k[1]/T.meshes.length/2)}if(D&&(D.id&&(T.id=D.id),D.lights&&(T.lights=function(k){if(!k.length)return[];const z=function(J){const ce=atob(J),le=new Uint8Array(ce.length);for(let ie=0;ie<ce.length;ie++)le[ie]=ce.codePointAt(ie);return le}(k),O=[],B=z.length/24,U=new Uint16Array(z.buffer),X=new Float32Array(z.buffer);for(let J=0;J<B;J++){const ce=U[2*J*6]/30,le=U[2*J*6+1]/30,ie=U[2*J*6+10]/100,ge=X[6*J+1],be=X[6*J+2],Se=X[6*J+3],Ve=X[6*J+4],Le=Se-ge,Be=Ve-be,Qe=Math.hypot(Le,Be);O.push({pos:[ge+.5*Le,be+.5*Be,le],normal:[Be/Qe,-Le/Qe,0],width:Qe,height:ce,depth:ie,points:[ge,be,Se,Ve]})}return O}(D.lights))),L){const k=[];for(const z of L)k.push(q6(o.json.nodes[z],o,c));T.children=k}return T}function Gse(d){if(d.vertices.length===0||d.indices.length===0)return null;const o=new BM(d.vertices,d.indices,8,256),[c,f]=[o.min.clone(),o.max.clone()];return{vertices:d.vertices,indices:d.indices,grid:o,min:c,max:f}}function Yse(d){if(!d.extras||!d.extras.ground)return null;const o=d.extras.ground;if(!o||!Array.isArray(o)||o.length===0)return null;const c=o[0];if(!c||!Array.isArray(c)||c.length===0)return null;const f=[];for(const x of c){if(!Array.isArray(x)||x.length!==2)continue;const I=x[0],D=x[1];typeof I=="number"&&typeof D=="number"&&f.push(new Ot(I,D))}if(f.length<3)return null;f.length>1&&f[f.length-1].equals(f[0])&&f.pop();let g=0;for(let x=0;x<f.length;x++){const I=f[x],D=f[(x+1)%f.length],L=f[(x+2)%f.length];g+=(I.x-D.x)*(L.y-D.y)-(L.x-D.x)*(I.y-D.y)}g>0&&f.reverse();const p=q1(f.flatMap(x=>[x.x,x.y]),[]);return p.length===0?null:{vertices:f,indices:p}}function Xse(d,o){const c=[],f=[];let g=0;const p=[];for(const x of d){g=c.length;const I=x.vertexArray.float32,D=x.indexArray.uint16;for(let L=0;L<x.vertexArray.length;L++)p[0]=I[3*L+0],p[1]=I[3*L+1],p[2]=I[3*L+2],Pe.vec3.transformMat4(p,p,o),c.push(new Ot(p[0],p[1]));for(let L=0;L<3*x.indexArray.length;L++)f.push(D[L]+g)}if(f.length%3!=0)return null;for(let x=0;x<f.length;x+=3){const I=c[f[x+0]],D=c[f[x+1]],L=c[f[x+2]];(I.x-D.x)*(L.y-D.y)-(L.x-D.x)*(I.y-D.y)>0&&([f[x+1],f[x+2]]=[f[x+2],f[x+1]])}return{vertices:c,indices:f}}function G6(d){const o=function(D,L){const T=[],k=WebGL2RenderingContext;if(D.json.textures)for(const z of D.json.textures){const O={magFilter:k.LINEAR,minFilter:k.NEAREST,wrapS:k.REPEAT,wrapT:k.REPEAT};z.sampler!==void 0&&Object.assign(O,D.json.samplers[z.sampler]),T.push({image:L[z.source],sampler:O,uploaded:!1})}return T}(d,d.images),c=function(D,L){const T=[];for(const k of D.json.meshes){const z=[];for(const O of k.primitives)z.push(qse(O,D,L));T.push(z)}return T}(d,o),{scenes:f,scene:g,nodes:p}=d.json,x=f?f[g||0].nodes:p,I=[];for(const D of x)I.push(q6(p[D],d,c));return function(D,L,T){const k={},z=new Set;for(let O=0;O<D.length;O++){const B=T[L[O]];if(!B.extras)continue;const U=B.extras["mapbox:footprint:version"],X=B.extras["mapbox:footprint:id"];(U||X)&&z.add(O),U==="1.0.0"&&X&&(k[X]=O)}for(let O=0;O<D.length;O++){if(z.has(O))continue;const B=D[O],U=T[L[O]];if(!U.extras)continue;let X=null;B.id in k&&(X=Xse(D[k[B.id]].meshes,B.matrix)),X||(X=Yse(U)),X&&(B.footprint=Gse(X))}if(z.size>0){const O=Array.from(z.values()).sort((B,U)=>B-U);for(let B=O.length-1;B>=0;B--)D.splice(O[B],1)}}(I,x,d.json.nodes),I}function Kse(d){d.heightmap=new Float32Array(4096),d.heightmap.fill(-1);const o=d.vertexArray.float32,c=d.aabb.min[0]-1,f=d.aabb.min[1]-1,g=gg/(d.aabb.max[0]-c+2),p=gg/(d.aabb.max[1]-f+2);for(let x=0;x<o.length;x+=3){const I=o[x+2],D=(o[x+0]-c)*g|0,L=(o[x+1]-f)*p|0;I>d.heightmap[L*gg+D]&&(d.heightmap[L*gg+D]=I)}}function Zse(d,o){const c={};c.indexArray=new la,c.indexArray.reserve(4*d.length),c.vertexArray=new Jc,c.vertexArray.reserve(10*d.length),c.colorArray=new Wd,c.vertexArray.reserve(10*d.length);let f=0;for(const x of d){const I=Math.min(10,Math.max(4,1.3*x.height))*o,D=[-x.normal[1],x.normal[0],0],L=Math.min(.29,.1*x.width/x.depth),T=x.width-2*x.depth*o*(L+.01),k=Pe.vec3.scaleAndAdd([],x.pos,D,T/2),z=Pe.vec3.scaleAndAdd([],x.pos,D,-T/2),O=[k[0],k[1],k[2]+x.height],B=[z[0],z[1],z[2]+x.height],U=Pe.vec3.scaleAndAdd([],x.normal,D,L);Pe.vec3.scale(U,U,I);const X=Pe.vec3.scaleAndAdd([],x.normal,D,-L);Pe.vec3.scale(X,X,I),Pe.vec3.add(U,k,U),Pe.vec3.add(X,z,X),k[2]+=.1,z[2]+=.1,c.vertexArray.emplaceBack(U[0],U[1],U[2]),c.vertexArray.emplaceBack(X[0],X[1],X[2]),c.vertexArray.emplaceBack(k[0],k[1],k[2]),c.vertexArray.emplaceBack(z[0],z[1],z[2]),c.vertexArray.emplaceBack(O[0],O[1],O[2]),c.vertexArray.emplaceBack(B[0],B[1],B[2]),c.vertexArray.emplaceBack(k[0],k[1],k[2]),c.vertexArray.emplaceBack(z[0],z[1],z[2]),c.vertexArray.emplaceBack(U[0],U[1],U[2]),c.vertexArray.emplaceBack(X[0],X[1],X[2]);const J=T/I/2;c.colorArray.emplaceBack(-J-L,-1,J,.8),c.colorArray.emplaceBack(J+L,-1,J,.8),c.colorArray.emplaceBack(-J,0,J,1.3),c.colorArray.emplaceBack(J,0,J,1.3),c.colorArray.emplaceBack(J+L,-.8,J,.7),c.colorArray.emplaceBack(J+L,-.8,J,.7),c.colorArray.emplaceBack(0,0,J,1.3),c.colorArray.emplaceBack(0,0,J,1.3),c.colorArray.emplaceBack(J+L,-1.2,J,.8),c.colorArray.emplaceBack(J+L,-1.2,J,.8),c.indexArray.emplaceBack(6+f,4+f,8+f),c.indexArray.emplaceBack(7+f,9+f,5+f),c.indexArray.emplaceBack(0+f,1+f,2+f),c.indexArray.emplaceBack(1+f,3+f,2+f),f+=10}const g={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Qr.white,g.pbrMetallicRoughness=p,c.material=g,c.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}class Y6{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const f=o[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const Qse=["id","tile","layer","source","sourceLayer","state"];class M0{constructor(o,c,f,g,p){this.type="Feature",this._vectorTileFeature=o,this._z=c,this._x=f,this._y=g,this.properties=o.properties,this.id=p}clone(){const o=new M0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of Qse)this[c]!==void 0&&(o[c]=this[c]);return o}}class X6{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Jf(sn,16,0),this.featureIndexArray=new Fl,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,c,f,g,p,x=0,I=0){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,p,x);const L=this.grid;for(let T=0;T<c.length;T++){const k=c[T],z=[1/0,1/0,-1/0,-1/0];for(let O=0;O<k.length;O++){const B=k[O];z[0]=Math.min(z[0],B.x),z[1]=Math.min(z[1],B.y),z[2]=Math.max(z[2],B.x),z[3]=Math.max(z[3],B.y)}I!==0&&(z[0]-=I,z[1]-=I,z[2]+=I,z[3]+=I),z[0]<sn&&z[1]<sn&&z[2]>=0&&z[3]>=0&&L.insert(D,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gp.VectorTile(new FE(this.rawTileData)).layers,this.sourceLayerCoder=new Y6(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,c){const{tilespaceGeometry:f,transform:g,tileTransform:p,pixelPosMatrix:x,availableImages:I}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const D=f.bufferedTilespaceBounds,L=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(O,B,U,X)=>Ke(f.bufferedTilespaceGeometry,O,B,U,X));L.sort(Jse);let T=null;g.elevation&&L.length>0&&(T=E0.create(g.elevation,this.tileID));const k={};let z;for(let O=0;O<L.length;O++){const B=L[O];if(B===z)continue;z=B;const U=this.featureIndexArray.get(B);let X=null;this.is3DTile?this.loadMatchingModelFeature(k,U,o,f,g):this.loadMatchingFeature(k,U,o,I,(J,ce,le,ie=0)=>(X||(X=G(J,this.tileID.canonical,p)),ce.queryIntersectsFeature(f,J,le,X,this.z,g,x,T,ie)))}return k}loadMatchingFeature(o,c,f,g,p){const{featureIndex:x,bucketIndex:I,sourceLayerIndex:D,layoutVertexArrayOffset:L}=c,T=this.bucketLayerIDs[I],k=f.layers,z=Object.keys(k);if(z.length&&!function(J,ce){for(let le=0;le<J.length;le++)if(ce.indexOf(J[le])>=0)return!0;return!1}(z,T))return;const O=f.sourceCache,B=this.sourceLayerCoder.decode(D),U=this.vtLayers[B].feature(x),X=this.getId(U,B);for(let J=0;J<T.length;J++){const ce=T[J];if(!k[ce])continue;const{styleLayer:le,targets:ie}=k[ce];let ge={};X!==void 0&&(ge=O.getFeatureState(le.sourceLayer,X));const be=!p||p(U,le,ge,L);if(!be)continue;const Se=new M0(U,this.z,this.x,this.y,X);Se.tile=this.tileID.canonical,Se.state=ge;let Ve=this.serializedLayersCache.get(ce);Ve||(Ve=le.serialize(),Ve.id=ce,this.serializedLayersCache.set(ce,Ve)),Se.source=Ve.source,Se.sourceLayer=Ve["source-layer"],Se.layer=Oi({},Ve),Se.layer.paint=K6(Ve.paint,le.paint,U,ge,g),Se.layer.layout=K6(Ve.layout,le.layout,U,ge,g);let Le=!1;for(const Be of ie){this.updateFeatureProperties(Se,Be);const{filter:Qe}=Be;if(Qe){if(U.properties=Se.properties,Qe.needGeometry){const Ue=Y(U,!0);if(!Qe.filter(new Wi(this.tileID.overscaledZ),Ue,this.tileID.canonical))continue}else if(!Qe.filter(new Wi(this.tileID.overscaledZ),U))continue}Le=!0,Be.targetId&&this.addFeatureVariant(Se,Be)}Le&&this.appendToResult(o,ce,x,Se,be)}}loadMatchingModelFeature(o,c,f,g,p){const x=this.bucketLayerIDs[0][0],I=f.layers;if(!I[x])return;const{styleLayer:D,targets:L}=I[x];if(D.type!=="model")return;const T=g.tile,k=c.featureIndex,z=T.getBucket(D);if(!(z&&z instanceof sS))return;const O=function(Ve,Le,Be,Qe){const Ue=Ve.getNodesInfo()[Le];if(Ue.hiddenByReplacement||!Ue.node.meshes)return;let Je=Number.MAX_VALUE;const lt=Ue.node,st=Be.tile,mt=Qe.calculatePosMatrix(st.tileID.toUnwrapped(),Qe.worldSize),pt=Ue.evaluatedScale;let vt=0;Qe.elevation&&lt.elevation&&(vt=lt.elevation*Qe.elevation.exaggeration()),Pe.mat4.translate(mt,mt,[(lt.anchor?lt.anchor[0]:0)*(pt[0]-1),(lt.anchor?lt.anchor[1]:0)*(pt[1]-1),vt]),Pe.mat4.scale(mt,mt,pt);const _t=Be.queryGeometry,Et=_t.isPointQuery()?_t.screenBounds:_t.screenGeometry,qt=function(Cn){const Qt=Pe.mat4.multiply([],mt,Cn.matrix);Pe.mat4.multiply(Qt,Qe.expandedFarZProjMatrix,Qt);for(let ln=0;ln<Cn.meshes.length;++ln){const Yt=Cn.meshes[ln];if(ln===Cn.lightMeshIndex)continue;const Zn=Gz(Et,Qe,Qt,Yt.aabb);Zn!=null&&(Je=Math.min(Zn,Je))}if(Cn.children)for(const ln of Cn.children)qt(ln)};if(qt(lt),Je===Number.MAX_VALUE)return;const Ht=new xi(0,0);return s6(st.tileID.canonical,Ht,Ue.node.anchor[0],Ue.node.anchor[1]),{intersectionZ:Je,position:Ht,feature:Ue.feature}}(z,k,g,p);if(!O)return;const{z:B,x:U,y:X}=T.tileID.canonical,{feature:J,intersectionZ:ce,position:le}=O;let ie={};J.id!==void 0&&(ie=f.sourceCache.getFeatureState(D.sourceLayer,J.id));const ge=new M0({},B,U,X,J.id);ge.tile=this.tileID.canonical,ge.state=ie,ge.properties=J.properties,ge.geometry={type:"Point",coordinates:[le.lng,le.lat]};let be=this.serializedLayersCache.get(x);be||(be=D.serialize(),be.id=x,this.serializedLayersCache.set(x,be)),ge.source=be.source,ge.sourceLayer=be["source-layer"],ge.layer=Oi({},be);let Se=!1;for(const Ve of L){this.updateFeatureProperties(ge,Ve);const{filter:Le}=Ve;if(Le){if(J.properties=ge.properties,Le.needGeometry){if(!Le.filter(new Wi(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!Le.filter(new Wi(this.tileID.overscaledZ),J))continue}Se=!0,Ve.targetId&&this.addFeatureVariant(ge,Ve)}Se&&this.appendToResult(o,x,k,ge,ce)}updateFeatureProperties(o,c,f){if(c.properties){const g={};for(const p in c.properties){const x=c.properties[p].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,f);x!=null&&(g[p]=x)}o.properties=g}}addFeatureVariant(o,c,f){const g={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(g.properties=o.properties),o.variants=o.variants||{},o.variants[c.targetId]=o.variants[c.targetId]||[],o.variants[c.targetId].push(g)}appendToResult(o,c,f,g,p){let x=o[c];x===void 0&&(x=o[c]=[]),x.push({featureIndex:f,feature:g,intersectionZ:p})}lookupSymbolFeatures(o,c,f,g,p){const x={};this.loadVTLayers();for(const I of o)this.loadMatchingFeature(x,{bucketIndex:c,sourceLayerIndex:f,featureIndex:I,layoutVertexArrayOffset:0},g,p);return x}loadFeature(o){const{featureIndex:c,sourceLayerIndex:f}=o;this.loadVTLayers();const g=this.sourceLayerCoder.decode(f),p=this.vtFeatures[g];if(p[c])return p[c];const x=this.vtLayers[g].feature(c);return p[c]=x,x}hasLayer(o){for(const c of this.bucketLayerIDs)for(const f of c)if(o===f)return!0;return!1}getId(o,c){let f=o.id;if(this.promoteId){const g=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(g!=null)if(Array.isArray(g)){if(!this.promoteIdExpression){const p=Zf(g);if(p.result!=="success"){const x=p.value.map(I=>`${I.key}: ${I.message}`).join(", ");return void Nr(`Failed to create expression for promoteId: ${x}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ac),f=this.promoteIdExpression.evaluate({zoom:0},o)}else f=o.properties[g];typeof f=="boolean"&&(f=Number(f))}return f}}function K6(d,o,c,f,g){return pi(d,(p,x)=>{const I=o instanceof ip?o.get(x):null;return I&&I.evaluate?I.evaluate(c,f,g):I})}function Jse(d,o){return o-d}Tn(X6,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Z6=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class DP{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(o,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const p=Z6[15&f];if(!p)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(o,2,1),[I]=new Uint32Array(o,4,1);return new DP(I,x,p,o)}constructor(o,c=64,f=Float64Array,g){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const p=Z6.indexOf(this.ArrayType),x=2*o*this.ArrayType.BYTES_PER_ELEMENT,I=o*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-I%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+D,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+x+I+D),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+D,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=o)}add(o,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=c,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return kP(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,c,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:I}=this,D=[0,p.length-1,0],L=[];for(;D.length;){const T=D.pop()||0,k=D.pop()||0,z=D.pop()||0;if(k-z<=I){for(let X=z;X<=k;X++){const J=x[2*X],ce=x[2*X+1];J>=o&&J<=f&&ce>=c&&ce<=g&&L.push(p[X])}continue}const O=z+k>>1,B=x[2*O],U=x[2*O+1];B>=o&&B<=f&&U>=c&&U<=g&&L.push(p[O]),(T===0?o<=B:c<=U)&&(D.push(z),D.push(O-1),D.push(1-T)),(T===0?f>=B:g>=U)&&(D.push(O+1),D.push(k),D.push(1-T))}return L}within(o,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:p,nodeSize:x}=this,I=[0,g.length-1,0],D=[],L=f*f;for(;I.length;){const T=I.pop()||0,k=I.pop()||0,z=I.pop()||0;if(k-z<=x){for(let X=z;X<=k;X++)J6(p[2*X],p[2*X+1],o,c)<=L&&D.push(g[X]);continue}const O=z+k>>1,B=p[2*O],U=p[2*O+1];J6(B,U,o,c)<=L&&D.push(g[O]),(T===0?o-f<=B:c-f<=U)&&(I.push(z),I.push(O-1),I.push(1-T)),(T===0?o+f>=B:c+f>=U)&&(I.push(O+1),I.push(k),I.push(1-T))}return D}}function kP(d,o,c,f,g,p){if(g-f<=c)return;const x=f+g>>1;Q6(d,o,x,f,g,p),kP(d,o,c,f,x-1,1-p),kP(d,o,c,x+1,g,1-p)}function Q6(d,o,c,f,g,p){for(;g>f;){if(g-f>600){const L=g-f+1,T=c-f+1,k=Math.log(L),z=.5*Math.exp(2*k/3),O=.5*Math.sqrt(k*z*(L-z)/L)*(T-L/2<0?-1:1);Q6(d,o,c,Math.max(f,Math.floor(c-T*z/L+O)),Math.min(g,Math.floor(c+(L-T)*z/L+O)),p)}const x=o[2*c+p];let I=f,D=g;for(bv(d,o,f,c),o[2*g+p]>x&&bv(d,o,f,g);I<D;){for(bv(d,o,I,D),I++,D--;o[2*I+p]<x;)I++;for(;o[2*D+p]>x;)D--}o[2*f+p]===x?bv(d,o,f,D):(D++,bv(d,o,D,g)),D<=c&&(f=D+1),c<=D&&(g=D-1)}}function bv(d,o,c,f){NP(d,c,f),NP(o,2*c,2*f),NP(o,2*c+1,2*f+1)}function NP(d,o,c){const f=d[o];d[o]=d[c],d[c]=f}function J6(d,o,c,f){const g=d-c,p=o-f;return g*g+p*p}s.$=Mi,s.A=zi,s.B=hl,s.C=ap,s.D=S0,s.E=qs,s.F=2,s.G=rv,s.H=oz,s.I=mr,s.J=class extends rS{},s.K=kl,s.L=Or,s.M=oE,s.N=s1,s.O=Kf,s.P=Ot,s.Q=K2,s.R=qr,s.S=H_,s.T=hP,s.U=Q_,s.V=rS,s.W=c1,s.X=Zf,s.Y=jd,s.Z=nh,s._=Gh,s.a=function(d){return Te.API_CDN_URL_REGEX.test(d)},s.a$=Y,s.a0=Za,s.a1=v1,s.a2=V_,s.a3=j_,s.a4=function(d){const o=d.value;let c=[];if(!o)return c;const f=kl(o);return f!=="string"?(c=c.concat([new rS(d.key,o,`string expected, "${f}" found`)]),c):(Xz(o,!0)||(c=c.concat([new rS(d.key,o,`invalid url "${o}"`)])),c)},s.a5=St,s.a6=x1,s.a7=Ds,s.a8=on,s.a9=class{constructor(d){this.specification=d}possiblyEvaluate(d,o){return Sc(d.expression.evaluate(o))}interpolate(d,o,c){return{x:Wn(d.x,o.x,c),y:Wn(d.y,o.y,c),z:Wn(d.z,o.z,c),azimuthal:Wn(d.azimuthal,o.azimuthal,c),polar:Wn(d.polar,o.polar,c)}}},s.aA=function(d,o){const c={};for(let f=0;f<o.length;f++){const g=o[f];g in d&&(c[g]=d[g])}return c},s.aB=td,s.aC=Ca,s.aD=class{constructor(d){this.entries={},this.scheduler=d}request(d,o,c,f){const g=this.entries[d]=this.entries[d]||{callbacks:[]};if(g.result){const[p,x]=g.result;return this.scheduler?this.scheduler.add(()=>{f(p,x)},o):f(p,x),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=c((p,x)=>{g.result=[p,x];for(const I of g.callbacks)this.scheduler?this.scheduler.add(()=>{I(p,x)},o):I(p,x);setTimeout(()=>delete this.entries[d],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(p=>p!==f),g.callbacks.length||(g.cancel(),delete this.entries[d]))}}},s.aE=function(d,o,c){const f=JSON.stringify(d.request);return d.data&&(this.deduped.entries[f]={result:[null,d.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:d.isSymbolTile,zoom:d.tileZoom},g=>{const p=xa(d.request,(x,I,D,L)=>{x?g(x):I&&g(null,{vectorTile:c?void 0:new gp.VectorTile(new FE(I)),rawData:I,cacheControl:D,expires:L})});return()=>{p.cancel(),g()}},o)},s.aF=function(d){li++,li>ir&&(d.getActor().send("enforceCacheSizeLimit",Jn),li=0)},s.aG=function(d){return d<=1?1:Math.pow(2,Math.floor(Math.log(d)/Math.LN2))},s.aH=Wt,s.aI=Lz,s.aJ=Uz,s.aK=Oz,s.aL=function(d,o){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let f=0;f<d.length;f++){const g=document.createElement("source");Eu(d[f])||(c.crossOrigin="Anonymous"),g.src=d[f],c.appendChild(g)}return{cancel:()=>{}}},s.aM=QE,s.aN=function(d){return fetch(d).then(o=>o.arrayBuffer()).then(o=>$6(o,0,d))},s.aO=G6,s.aP=class{constructor(d,o,c,f){this.id=d,this.position=o!=null?new xi(o[0],o[1]):new xi(0,0),this.orientation=c??[0,0,0],this.nodes=f,this.uploaded=!1,this.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(d,o){if(Pe.mat4.multiply(d.matrix,o,d.matrix),d.meshes)for(const c of d.meshes){const f=Nn.applyTransformFast(c.aabb,d.matrix);this.aabb.encapsulate(f)}if(d.children)for(const c of d.children)this._applyTransformations(c,d.matrix)}computeBoundsAndApplyParent(){const d=Pe.mat4.identity([]);for(const o of this.nodes)this._applyTransformations(o,d)}computeModelMatrix(d,o,c,f,g,p,x=!1){e6(this.matrix,this,d.transform,this.position,o,c,f,g,p,x)}upload(d){if(!this.uploaded){for(const o of this.nodes)gP(o,d);for(const o of this.nodes)iS(o);this.uploaded=!0}}destroy(){for(const d of this.nodes)_P(d)}},s.aQ=Li,s.aR=sv,s.aS=Bl,s.aT=ca,s.aU=oh,s.aV=la,s.aW=hr,s.aX=tg,s.aY=KE,s.aZ=function(){Rc.isLoading()||Rc.isLoaded()||K_()!=="deferred"||sE()},s.a_=b1,s.aa=Wi,s.ab=Qf,s.ac=a,s.ad=Pe,s.ae=Es,s.af=ip,s.ag=ml,s.ah=Wn,s.ai=sn,s.aj=Bd,s.ak=Mn,s.al=Qr,s.am=class{constructor(d){this.specification=d}possiblyEvaluate(d,o){return function([c,f]){const g=Sc([1,c,f]);return{x:g.x,y:g.y,z:g.z}}(d.expression.evaluate(o))}interpolate(d,o,c){return{x:Wn(d.x,o.x,c),y:Wn(d.y,o.y,c),z:Wn(d.z,o.z,c)}}},s.an=function(d,o,c=0,f=!0){const g=new Ot(c,c),p=d.sub(g),x=o.add(g),I=[p,new Ot(x.x,p.y),x,new Ot(p.x,x.y)];return f&&I.push(p.clone()),I},s.ao=function(d,o){const c=[];for(let f=0;f<d.length;f++){const g=Si(f-1,-1,d.length-1),p=Si(f+1,-1,d.length-1),x=d[f],I=d[p],D=d[g].sub(x).unit(),L=I.sub(x).unit(),T=L.angleWithSep(D.x,D.y),k=D.add(L).unit().mult(-1*o/Math.sin(T/2));c.push(x.add(k))}return c},s.ap=bz,s.aq=Ke,s.ar=function(d,o,c=0){return Pe.vec3.fromValues(((o.x-c)*d.scale-d.x)*sn,(o.y*d.scale-d.y)*sn,U1(o.z,o.y))},s.as=sr,s.at=OB,s.au=function(d){let o=1/0,c=1/0,f=-1/0,g=-1/0;for(const p of d)o=Math.min(o,p.x),c=Math.min(c,p.y),f=Math.max(f,p.x),g=Math.max(g,p.y);return{min:new Ot(o,c),max:new Ot(f,g)}},s.av=Pu,s.aw=Xe,s.ax=_,s.ay=Bn,s.az=Ja,s.b=function(d){return Te.API_FONTS_REGEX.test(d)},s.b$=tS,s.b0=M0,s.b1=ra,s.b2=WM,s.b3=FM,s.b4=G,s.b5=sh,s.b6=o0,s.b7=Qn,s.b8=xs,s.b9=q1,s.bA=fB,s.bB=tP,s.bC=pz,s.bD=QM,s.bE=DP,s.bF=Si,s.bG=za,s.bH=Ia,s.bI=function(d,o,c){d[4*o+0]=c[0],d[4*o+1]=c[1],d[4*o+2]=c[2],d[4*o+3]=c[3]},s.bJ=cg,s.bK=Pc,s.bL=up,s.bM=ao,s.bN=ag,s.bO=xi,s.bP=Cz,s.bQ=Rt,s.bR=yr,s.bS=Wz,s.bT=Ut,s.bU=Wa,s.bV=function(d,o,c,f,g,p,x,I,D){if(D.name==="globe")return Wa(d,o,new Ut(c,f,g),!1);const L=sv({z:c,x:f,y:g},D);return new Nn([(p+L.x/L.scale)*o,o*(L.y/L.scale),x],[(p+L.x2/L.scale)*o,o*(L.y2/L.scale),I])},s.bW=function(d,o,c){let f=0;for(let g=0;g<2;++g)d[g]>0&&(f+=(d[g]-0)*(d[g]-0)),o[g]<0&&(f+=(0-o[g])*(0-o[g]));return f},s.bX=pl,s.bY=EE,s.bZ=function(d){const o=Pe.mat4.identity(new Float64Array(16));Pe.mat4.multiply(o,d.pixelMatrix,d.globeMatrix);const c=[0,uc,0],f=[0,hc,0];return Pe.vec3.transformMat4(c,c,o),Pe.vec3.transformMat4(f,f,o),[c[0]>0&&c[0]<=d.width&&c[1]>0&&c[1]<=d.height&&!jl(d,new xi(d.center.lat,90)),f[0]>0&&f[0]<=d.width&&f[1]>0&&f[1]<=d.height&&!jl(d,new xi(d.center.lat,-90))]},s.b_=function(d,o){const{scale:c}=d.tileTransform,f=c*sn/(d.tileSize*Math.pow(2,o.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return Pe.mat2.scale(new Float32Array(4),o.inverseAdjustmentMatrix,[f,f])},s.ba=lP,s.bb=function(d,o){const c=ml(o.zoom);if(c===0)return Mo(d);const f=di(d),g=bs(f),p=Pu(f.getWest())*o.worldSize,x=Pu(f.getEast())*o.worldSize,I=Ca(f.getNorth())*o.worldSize,D=Ca(f.getSouth())*o.worldSize,L=[p,I,0],T=[x,I,0],k=[p,D,0],z=[x,D,0],O=Pe.mat4.invert([],o.globeMatrix);return Pe.vec3.transformMat4(L,L,O),Pe.vec3.transformMat4(T,T,O),Pe.vec3.transformMat4(k,k,O),Pe.vec3.transformMat4(z,z,O),g[0]=zo(g[0],k,c),g[1]=zo(g[1],z,c),g[2]=zo(g[2],T,c),g[3]=zo(g[3],L,c),Nn.fromPoints(g)},s.bc=ps,s.bd=bi,s.be=zo,s.bf=lp,s.bg=gr,s.bh=pS,s.bi=FE,s.bj=xa,s.bk=function(d,o){const c=[];for(const f in d)f in o||c.push(f);return c},s.bl=cs,s.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bn=Sr,s.bo=function(d,o){const{x:c,y:f}=d.point,g=Dc(c,f,d.worldSize/d._pixelsPerMercatorPixel,0,0);return Pe.mat4.multiply(g,g,Po(Mo(o)))},s.bp=g0,s.bq=fc,s.br=LE,s.bs=function(d,o,c,f,g){const p=5*o+2;d.float32[p+0]=c,d.float32[p+1]=f,d.float32[p+2]=g},s.bt=XE,s.bu=sz,s.bv=we,s.bw=Ra,s.bx=aB,s.by=Yz,s.bz=dB,s.c=qe,s.c$=zB,s.c0=Hz,s.c1=function(d){const o=Hz(d,!0);return Pe.mat2.invert([],[o[0],o[1],o[4],o[5]])},s.c2=Kr,s.c3=function(d){const{x:o,y:c}=d.point,{lng:f,lat:g}=d._center;return Dc(o,c,d.worldSize,f,g)},s.c4=jt,s.c5=dn,s.c6=hp,s.c7=function(d){const o=Math.round((d+45+360)%360/90)%4;return Ln[o]},s.c8=45,s.c9=fo,s.cA=vE,s.cB=class extends Mu{constructor(d){super(d),this.current=B1}set(d,o,c){if(this.fetchUniformLocation(d,o)){for(let f=0;f<9;f++)if(c[f]!==this.current[f]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},s.cC=un,s.cD=function(d,o,c){const f=ml(c.zoom),g=d.style.map._antialias,p=d.terrain&&d.terrain.exaggeration()>0;return f===0&&!g&&!p},s.cE=function(d){const o=d.pixelsPerMeter,c=o/Ia(1,d.center.lat),f=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(f,f,[d.point.x,d.point.y,0]),Pe.mat4.scale(f,f,[c,c,o]),Float32Array.from(f)},s.cF=di,s.cG=function(d){const o=pl-5;d=Bn(d,-80.051129,o)/o*90;const c=Math.pow(Math.abs(Math.sin(Mn(d))),3);return Math.round(c*(d0.length-1))},s.cH=function(d,o,c,f){const g=o.getNorth(),p=o.getSouth(),x=o.getWest(),I=o.getEast(),D=1<<d.z,L=I-x,T=g-p,k=L/dp,z=-T/d0[c],O=[0,k,0,z,0,0,g,x,0];if(d.z>0){const B=180/f;Pe.mat3.multiply(O,O,[B/L+1,0,0,0,B/T+1,0,-.5*B/k,.5*B/z,1])}return O[2]=D,O[5]=d.x,O[8]=d.y,O},s.cI=Mo,s.cJ=function(d,o,c){const f=Pe.mat4.identity(new Float64Array(16)),g=(o/(1<<d)-.5)*Math.PI*2;return Pe.mat4.rotateY(f,c.globeMatrix,g),Float32Array.from(f)},s.cK=class{isDataAvailableAtPoint(d){const o=this._source();if(this.isUsingMockSource()||!o||d.y<0||d.y>1)return!1;const c=o.getSource().maxzoom,f=1<<c,g=Math.floor(d.x),p=Math.floor((d.x-g)*f),x=Math.floor(d.y*f),I=this.findDEMTileFor(new Wt(c,g,c,p,x));return!(!I||!I.dem)}getAtPointOrZero(d,o=0){return this.getAtPoint(d,o)||0}getAtPoint(d,o,c=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const f=this._source();if(!f||d.y<0||d.y>1)return o;const g=f.getSource().maxzoom,p=1<<g,x=Math.floor(d.x),I=d.x-x,D=new Wt(g,x,g,Math.floor(I*p),Math.floor(d.y*p)),L=this.findDEMTileFor(D);if(!L||!L.dem)return o;const T=L.dem,k=1<<L.tileID.canonical.z,z=(I*k-L.tileID.canonical.x)*T.dim,O=(d.y*k-L.tileID.canonical.y)*T.dim,B=Math.floor(z),U=Math.floor(O);return(c?this.exaggeration():1)*Wn(Wn(T.get(B,U),T.get(B,U+1),O-U),Wn(T.get(B+1,U),T.get(B+1,U+1),O-U),z-B)}getAtTileOffset(d,o,c){const f=1<<d.canonical.z;return this.getAtPointOrZero(new a(d.wrap+(d.canonical.x+o/sn)/f,(d.canonical.y+c/sn)/f))}getAtTileOffsetFunc(d,o,c,f){return g=>{const p=this.getAtTileOffset(d,g.x,g.y),x=f.upVector(d.canonical,g.x,g.y),I=f.upVectorScale(d.canonical,o,c).metersToTile;return Pe.vec3.scale(x,x,p*I),x}}getForTilePoints(d,o,c,f){if(this.isUsingMockSource())return!1;const g=E0.create(this,d,f);return!!g&&(o.forEach(p=>{p[2]=this.exaggeration()*g.getElevationAt(p[0],p[1],c)}),!0)}getMinMaxForTile(d){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(d);if(!o||!o.dem)return null;const c=o.dem.tree,f=o.tileID,g=1<<d.canonical.z-f.canonical.z;let p=d.canonical.x/g-f.canonical.x,x=d.canonical.y/g-f.canonical.y,I=0;for(let D=0;D<d.canonical.z-f.canonical.z&&!c.leaves[I];D++){p*=2,x*=2;const L=2*Math.floor(x)+Math.floor(p);I=c.childOffsets[I]+L,p%=1,x%=1}return{min:this.exaggeration()*c.minimums[I],max:this.exaggeration()*c.maximums[I]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(d,o,c){throw new Error("Pure virtual method called.")}pointCoordinate(d){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(d){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const d=this.visibleDemTiles;if(d.length===0)return null;let o=!1,c=Number.MAX_VALUE,f=Number.MIN_VALUE;for(const g of d){const p=this.getMinMaxForTile(g.tileID);p&&(c=Math.min(c,p.min),f=Math.max(f,p.max),o=!0)}return o?{min:c,max:f}:null}},s.cL=F5,s.cM=ei,s.cN=function(d,o){return[Math.pow(d[0],2.2)*o,Math.pow(d[1],2.2)*o,Math.pow(d[2],2.2)*o]},s.cO=zl,s.cP=It,s.cQ=io,s.cR=256,s.cS=function(d,o){const c=[0,0,0],f=ps(Mo(o.canonical));return Pe.vec3.transformMat4(c,c,f),Pe.vec3.transformMat4(c,c,d),c},s.cT=d=>({u_camera_to_center_distance:new ao(d),u_extrude_scale:new z1(d),u_device_pixel_ratio:new ao(d),u_matrix:new cg(d),u_inv_rot_matrix:new cg(d),u_merc_center:new Pc(d),u_tile_id:new up(d),u_zoom_transition:new ao(d),u_up_dir:new up(d),u_emissive_strength:new ao(d)}),s.cU=d=>({u_matrix:new cg(d),u_pixels_to_tile_units:new z1(d),u_device_pixel_ratio:new ao(d),u_width_scale:new ao(d),u_floor_width_scale:new ao(d),u_units_to_pixels:new Pc(d),u_dash_image:new ag(d),u_gradient_image:new ag(d),u_image_height:new ao(d),u_texsize:new Pc(d),u_tile_units_to_pixels:new ao(d),u_alpha_discard_threshold:new ao(d),u_trim_offset:new Pc(d),u_trim_fade_range:new Pc(d),u_trim_color:new lg(d),u_emissive_strength:new ao(d),u_zbias_factor:new ao(d),u_tile_to_meter:new ao(d)}),s.cV=d=>({u_matrix:new cg(d),u_texsize:new Pc(d),u_pixels_to_tile_units:new z1(d),u_device_pixel_ratio:new ao(d),u_width_scale:new ao(d),u_floor_width_scale:new ao(d),u_image:new ag(d),u_units_to_pixels:new Pc(d),u_tile_units_to_pixels:new ao(d),u_alpha_discard_threshold:new ao(d),u_trim_offset:new Pc(d),u_trim_fade_range:new Pc(d),u_trim_color:new lg(d),u_emissive_strength:new ao(d),u_zbias_factor:new ao(d),u_tile_to_meter:new ao(d)}),s.cW=M1,s.cX=tie,s.cY=nie,s.cZ=pp,s.c_=(d,o,c,f,g,p)=>{const x=d.transform,I=x.projection.name==="globe";let D;if(p.paint.get("circle-pitch-alignment")==="map")if(I){const T=zl(x.zoom,o.canonical)*x._pixelsPerMercatorPixel;D=Float32Array.from([T,0,0,T])}else D=x.calculatePixelsToTileUnitsMatrix(c);else D=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const L={u_camera_to_center_distance:d.transform.getCameraToCenterDistance(x.projection),u_matrix:d.translatePosMatrix(o.projMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Mt.devicePixelRatio,u_extrude_scale:D,u_inv_rot_matrix:H1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(I){L.u_inv_rot_matrix=f,L.u_merc_center=g,L.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],L.u_zoom_transition=ml(x.zoom);const T=g[0]*sn,k=g[1]*sn;L.u_up_dir=x.projection.upVector(new Ut(0,0,0),T,k)}return L},s.ca=f0,s.cb=lg,s.cc=function(d,o,c){const f=Math.sqrt(d*d+o*o+c*c),g=f>0?Math.acos(c/f)*Wr:0;let p=d!==0||o!==0?Math.atan2(-o,-d)*Wr+90:0;return p<0&&(p+=360),[f,p,g]},s.cd=y,s.ce=Nn,s.cf=Sc,s.cg=function(d){return[Math.pow(d[0],1/2.2),Math.pow(d[1],1/2.2),Math.pow(d[2],1/2.2)]},s.ch=function(d,o){return d.readFields(Kie,{icons:[]},o)},s.ci=function(d){return d({pluginStatus:fl,pluginURL:Xh}),ep.on("pluginStateChange",d),d},s.cj=oS,s.ck=x0,s.cl=JM,s.cm=Ti,s.cn=Xm,s.co=hn,s.cp=Fn,s.cq=Rr,s.cr=function(d){const o=d.indexOf(e0);return o>=0?d.slice(0,o):d},s.cs=function(d){return d.indexOf(e0)>=0},s.ct=function(d){const o=d.indexOf(e0);return o>=0?d.slice(o+1):""},s.cu=function(d){const o=[],c=d.id;return c===void 0&&o.push({message:`layers.${c}: missing required property "id"`}),d.render===void 0&&o.push({message:`layers.${c}: missing required method "render"`}),d.renderingMode&&d.renderingMode!=="2d"&&d.renderingMode!=="3d"&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},s.cv=function(d,o,c,f){return d.type==="custom"?new Lie(d,o):new Gie[d.type](d,o,c,f)},s.cw=rn,s.cx=class extends M0{constructor(d,o){super(d._vectorTileFeature,d._z,d._x,d._y,d.id),d.state&&(this.state=Object.assign({},d.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=d.source,this.sourceLayer=d.sourceLayer,this.layer=d.layer)}toJSON(){const d=super.toJSON();return d.target=this.target,d.namespace=this.namespace,d}},s.cy=ep,s.cz=Ko,s.d=function(d){return Te.API_TILEJSON_REGEX.test(d)},s.d$=Y6,s.d0=hi,s.d1=(d,o,c,f,g,p,x,I)=>{const D=d.transform,L=D.pitch<15?LB(.07,.7,Bn((14-D.zoom)/5,0,1)):.07,T=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:BB(d,o,c,f),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:D.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:g,u_width_scale:p,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:FB(o,D),u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:I,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toRenderColor(T?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:y(o.tileID.canonical,0)}},s.d2=(d,o,c,f,g,p,x,I,D)=>{const L=d.transform,T=L.calculatePixelsToTileUnitsMatrix(o),k=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",z=L.pitch<15?LB(.07,.7,Bn((14-L.zoom)/5,0,1)):.07;return{u_matrix:BB(d,o,c,f),u_pixels_to_tile_units:T,u_device_pixel_ratio:p,u_width_scale:x,u_floor_width_scale:I,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:jB(c)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:FB(o,d.transform),u_alpha_discard_threshold:0,u_trim_offset:D,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toRenderColor(k?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:y(o.tileID.canonical,0)}},s.d3=Tr,s.d4=$1,s.d5=U1,s.d6=CB,s.d7=pn,s.d8=OE,s.d9=_p,s.dA=DE,s.dB=Xn,s.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dD=Ni,s.dE=CM,s.dF=Gd,s.dG=function([d,o,c]){const f=Math.hypot(d,o,c),g=Math.atan2(d,c),p=.5*Math.PI-Math.acos(-o/f);return new xi(jt(g),jt(p))},s.dH=fP,s.dI=function(d){const o=d.navigator?d.navigator.userAgent:null;return!!function(c){if(Tc==null){const f=c.navigator?c.navigator.userAgent:null;Tc=!!c.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return Tc}(d)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dJ=function(d,o){Jn=d,ir=o},s.dK=jl,s.dL=kc,s.dM=function(d){const o=[0,0,0],c=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(c,d.pixelMatrix,d.globeMatrix),Pe.vec3.transformMat4(o,o,c),new Ot(o[0],o[1])},s.dN=function(d,o,c=!1){if(fl===m1||fl===Ru||fl===g1)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xh=Mt.resolveURL(d),fl=m1,_1=o,X_(),c||sE()},s.dO=K_,s.dP=function(){oS().acquire(xP)},s.dQ=function(){const d=fv;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(xP),fv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dR=yg,s.dS=function(d){const o=si();if(!o)return;const c=o.delete(yn);d&&c.catch(d).then(()=>d())},s.dT=dv,s.dU=B6,s.dV=function(d){AP=Mt.resolveURL(d),R0||(R0=new S0(oS(),new qs)),R0.broadcast("setDracoUrl",AP)},s.dW=z6,s.dX=function(d){A0=Mt.resolveURL(d),R0||(R0=new S0(oS(),new qs)),R0.broadcast("setMeshoptUrl",A0)},s.dY=Tn,s.dZ=mp,s.d_=dh,s.da=450,s.db=7,s.dc=Oie,s.dd=yi,s.de=c0,s.df=256,s.dg=Po,s.dh=Jc,s.di=Ll,s.dj=s0,s.dk=function(d,o,c,f,g){return Bn((d-o)/(c-o)*(g-f)+f,f,g)},s.dl=t1,s.dm=nd,s.dn=class{constructor(d,o,c,f){this.context=d,this.format=f,this.size=c,this.texture=d.gl.createTexture();const[g,p,x]=this.size,{gl:I}=d;I.bindTexture(I.TEXTURE_3D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),I.texImage3D(I.TEXTURE_3D,0,this.format,g,p,x,0,cP(this.format),uP(this.format),o.data)}bind(d,o){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_3D,this.texture),d!==this.minFilter&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MAG_FILTER,d),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MIN_FILTER,d),this.minFilter=d),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}},s.dp=pP,s.dq=[1,1,1],s.dr=E0,s.ds=w0,s.dt=Qh,s.du=cp,s.dv=Yd,s.dw=k1,s.dx=D1,s.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ot(1/0,1/0),max:new Ot(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(d,o=!1){const c=cB(new Ot(0,0),new Ot(sn,sn),d),f=[];if(o&&!zM(c,this._globalClipBounds))return f;for(const g of this._activeRegions){if(g.hiddenByOverlap||!zM(c,g))continue;const p=Are(g.min,g.max,d);f.push({min:p.min,max:p.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return f}setSources(d){this._setSources(d.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const c=[];for(const f of o.cache.getVisibleCoordinates()){const g=o.cache.getTile(f).buckets[o.layer];g&&g.updateFootprints(f.toUnwrapped(),c)}return c},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(d){const o=d.getFootprints();if(o.length===0)return;const c=d.getOrder(),f=d.getClipMask(),g=d.getClipScope();for(const p of o){if(!p.footprint)continue;const x=cB(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:c,clipMask:f,clipScope:g})}this._sourceIds.push(d.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,c)=>o.priority-c.priority||kE(o.min,c.min)||kE(o.max,c.max)||o.order-c.order||o.clipMask-c.clipMask||function(f,g){const p=(x,I)=>x+I;return f.length-g.length||f.reduce(p,"").localeCompare(g.reduce(p,""))}(o.clipScope,c.clipScope));let d=this._activeRegions.length!==this._prevRegions.length;if(!d){let o=0;for(;!d&&o!==this._activeRegions.length;){const c=this._activeRegions[o],f=this._prevRegions[o];d=c.priority!==f.priority||!lB(c,f)||c.order!==f.order||c.clipMask!==f.clipMask||!Sr(c.clipScope,f.clipScope),++o}}if(d){++this._updateTime;for(const c of this._activeRegions)c.order!==DE&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const o=c=>{const f=this._activeRegions;if(c>=f.length)return c;const g=f[c].priority;for(;c<f.length&&f[c].priority===g;)++c;return c};if(this._sourceIds.length>1){let c=0,f=o(c);for(;c!==f;){let g=c;const p=c;for(;g!==f;){const x=this._activeRegions[g];x.hiddenByOverlap=!1;for(let I=0;I<p;I++){const D=this._activeRegions[I];if(!D.hiddenByOverlap&&x.order===DE&&zM(x,D)&&(x.hiddenByOverlap=hB(x.footprint,x.tileId,D.footprint,D.tileId),x.hiddenByOverlap))break}++g}c=f,f=o(c)}}}}_setSources(d){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=d.length-1;o>=0;o--)this._addSource(d[o]);this._computeReplacement()}},s.dz=class{constructor(d){this._createGrid(d),this._createPoles(d)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const d of this._poleSegments)d.destroy();for(const d of this._gridSegments)d.withSkirts.destroy(),d.withoutSkirts.destroy()}_fillGridMeshWithLods(d,o){const c=new sh,f=new la,g=[],p=d+1+2,x=o[0]+1,I=o[0]+1+(1+o.length),D=(L,T,k)=>{let z=L===p-1?L-2:L===0?L:L-1;return z+=k?24575:0,[z,T]};for(let L=0;L<p;++L)c.emplaceBack(...D(L,0,!0));for(let L=0;L<x;++L)for(let T=0;T<p;++T)c.emplaceBack(...D(T,L,(T===0||T===p-1)&&!0));for(let L=0;L<o.length;++L){const T=o[L];for(let k=0;k<p;++k)c.emplaceBack(...D(k,T,!0))}for(let L=0;L<o.length;++L){const T=f.length,k=o[L]+1+2,z=new la;for(let U=0;U<k-1;U++){const X=U===k-2,J=X?p*(I-o.length+L-U):p;for(let ce=0;ce<p-1;ce++){const le=U*p+ce;U===0||X||ce===0||ce===p-2?(z.emplaceBack(le+1,le,le+J),z.emplaceBack(le+J,le+J+1,le+1)):(f.emplaceBack(le+1,le,le+J),f.emplaceBack(le+J,le+J+1,le+1))}}const O=xs.simpleSegment(0,T,c.length,f.length-T);for(let U=0;U<z.uint16.length;U+=3)f.emplaceBack(z.uint16[U],z.uint16[U+1],z.uint16[U+2]);const B=xs.simpleSegment(0,T,c.length,f.length-T);g.push({withoutSkirts:O,withSkirts:B})}return{vertices:c,indices:f,segments:g}}_createGrid(d){const o=this._fillGridMeshWithLods(dp,d0);this._gridSegments=o.segments,this._gridBuffer=d.createVertexBuffer(o.vertices,Qn.members),this._gridIndexBuffer=d.createIndexBuffer(o.indices,!0)}_createPoles(d){const o=new la;for(let x=0;x<=dp;x++)o.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=d.createIndexBuffer(o,!0);const c=new Ll,f=new Ll,g=new Ll,p=new Ll;this._poleSegments=[];for(let x=0,I=0;x<hp;x++){const D=360/(1<<x);c.emplaceBack(0,-Ja,0,.5,0),f.emplaceBack(0,-Ja,0,.5,1),g.emplaceBack(0,-Ja,0,.5,.5),p.emplaceBack(0,-Ja,0,.5,.5);for(let L=0;L<=dp;L++){let T=L/dp,k=0;const z=Wn(0,D,T),[O,B,U]=fp(ku,ch,z,Ja);c.emplaceBack(O,B,U,T,k),f.emplaceBack(O,B,U,T,1-k);const X=Mn(z);T=.5+.5*Math.sin(X),k=.5+.5*Math.cos(X),g.emplaceBack(O,B,U,T,k),p.emplaceBack(O,B,U,T,1-k)}this._poleSegments.push(xs.simpleSegment(I,0,66,64)),I+=66}this._poleNorthVertexBuffer=d.createVertexBuffer(c,kn,!1),this._poleSouthVertexBuffer=d.createVertexBuffer(f,kn,!1),this._texturedPoleNorthVertexBuffer=d.createVertexBuffer(g,kn,!1),this._texturedPoleSouthVertexBuffer=d.createVertexBuffer(p,kn,!1)}getGridBuffers(d,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[d].withSkirts:this._gridSegments[d].withoutSkirts]}getPoleBuffers(d,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[d]]}},s.e=Te,s.e0=X6,s.e1=DB,s.e2=dg,s.e3="hd_road_elevation",s.e4=class{static parseFrom(d,o){const c=Xd.parse(d);if(!c)return[];let{vertices:f,features:g}=c;const p=1/y(o);g.sort((L,T)=>L.id-T.id),f.sort((L,T)=>L.id-T.id||L.idx-T.idx),f=f.filter((L,T,k)=>T===k.findIndex(z=>z.id===L.id&&z.idx===L.idx));const x=new Array;let I=0;const D=f.length;for(const L of g){if(L.constantHeight){x.push(new OM(L.id,L.bounds,L.constantHeight));continue}for(;I!==D&&f[I].id<L.id;)I++;if(I===D||f[I].id!==L.id)continue;const T=new Array,k=new Array,z=I;for(;I!==D&&f[I].id===L.id;){const O=f[I];if(T.push({position:O.position,height:O.height,extent:O.extent}),I!==z&&f[I-1].idx===O.idx-1){const B=I-z;k.push({a:B-1,b:B})}I++}x.push(new OM(L.id,L.bounds,void 0,T,k,p))}return x}},s.e5=pi,s.e6=fg,s.e7=az,s.e8=y0,s.e9=function(d,o,c,f,g,p,x,I=1,D){d.createArrays(),d.tilePixelRatio=sn/(512*d.overscaling),d.compareText={},d.iconsNeedLinear=!1;const L=d.layers[0].layout,T=d.layers[0]._unevaluatedLayout._values,k={};k.scaleFactor=I,k.textSizeScaleRange=L.get("text-size-scale-range"),k.iconSizeScaleRange=L.get("icon-size-scale-range");const[z,O]=k.textSizeScaleRange,[B,U]=k.iconSizeScaleRange;k.textScaleFactor=Bn(k.scaleFactor,z,O),k.iconScaleFactor=Bn(k.scaleFactor,B,U);const X=T["text-size"],J=T["icon-size"];if(d.textSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ve}=d.textSizeData;k.compositeTextSizes=[X.possiblyEvaluate(new Wi(Se),p),X.possiblyEvaluate(new Wi(Ve),p)]}if(d.iconSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ve}=d.iconSizeData;k.compositeIconSizes=[J.possiblyEvaluate(new Wi(Se),p),J.possiblyEvaluate(new Wi(Ve),p)]}k.layoutTextSize=X.possiblyEvaluate(new Wi(x+1),p),k.layoutIconSize=J.possiblyEvaluate(new Wi(x+1),p),k.textMaxSize=X.possiblyEvaluate(new Wi(18),p);const ce=L.get("symbol-placement"),le=L.get("text-rotation-alignment")==="map"&&ce!=="point",ie=L.get("text-size");let ge=!1;const be=[];for(const Se of d.features){const Ve=L.get("text-font").evaluate(Se,{},p).join(","),Le=ie.evaluate(Se,{},p)*k.textScaleFactor,Be=k.layoutTextSize.evaluate(Se,{},p)*k.textScaleFactor,Qe=k.layoutIconSize.evaluate(Se,{},p)*k.iconScaleFactor,Ue={horizontal:{},vertical:void 0},Je=Se.text;let lt,st=[0,0];if(Je){const Yt=Je.toString(),Zn=L.get("text-letter-spacing").evaluate(Se,{},p)*Ra,bn=L.get("text-line-height").evaluate(Se,{},p)*Ra,Pn=fM(Yt)?Zn:0,ar=L.get("text-anchor").evaluate(Se,{},p),Pr=L.get("text-variable-anchor");if(!Pr){const gi=L.get("text-radial-offset").evaluate(Se,{},p);st=gi?pz(ar,[gi*Ra,eP]):L.get("text-offset").evaluate(Se,{},p).map($i=>$i*Ra)}let fr=le?"center":L.get("text-justify").evaluate(Se,{},p);const jr=ce==="point",Mr=jr?L.get("text-max-width").evaluate(Se,{},p)*Ra:1/0,Hr=gi=>{d.allowVerticalPlacement&&d1(Yt)&&(Ue.vertical=ZM(Je,o,c,g,Ve,Mr,bn,ar,gi,Pn,st,fc.vertical,!0,Be,Le,D))};if(!le&&Pr){const gi=fr==="auto"?Pr.map(lr=>tP(lr)):[fr];let $i=!1;for(let lr=0;lr<gi.length;lr++){const ti=gi[lr];if(!Ue.horizontal[ti])if($i)Ue.horizontal[ti]=Ue.horizontal[0];else{const ms=ZM(Je,o,c,g,Ve,Mr,bn,"center",ti,Pn,st,fc.horizontal,!1,Be,Le,D);ms&&(Ue.horizontal[ti]=ms,$i=ms.positionedLines.length===1)}}Hr("left")}else{if(fr==="auto"&&(fr=tP(ar)),jr||L.get("text-writing-mode").indexOf("horizontal")>=0||!d1(Yt)){const gi=ZM(Je,o,c,g,Ve,Mr,bn,ar,fr,Pn,st,fc.horizontal,!1,Be,Le,D);gi&&(Ue.horizontal[fr]=gi)}Hr(jr?"left":fr)}}let mt,pt,vt,_t,Et,qt=!1;if(Se.icon&&Se.icon.hasPrimary()){const Yt=gz(Se.icon,d.iconSizeData,T["icon-size"],p,d.zoom,Se,D,k.iconScaleFactor);mt=Yt.iconPrimary,pt=Yt.iconSecondary;const Zn=mt.toString(),bn=f.get(Zn);bn&&(vt=L.get("icon-offset").evaluate(Se,{},p),_t=L.get("icon-anchor").evaluate(Se,{},p),Et=L.get("icon-text-fit").evaluate(Se,{},p),lt=fie(g.get(Zn),pt?g.get(pt.toString()):void 0,vt,_t),qt=bn.sdf,d.sdfIcons===void 0?d.sdfIcons=bn.sdf:d.sdfIcons!==bn.sdf&&Nr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(bn.pixelRatio!==d.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(d.iconsNeedLinear=!0))}ge=ge||!(!Se.icon||!Se.icon.hasSecondary());const Ht=nP(Ue.horizontal)||Ue.vertical;d.iconsInText||(d.iconsInText=!!Ht&&Ht.iconsInText);const Cn=Be*k.textScaleFactor/Ra,{defaultShapedIcon:Qt,verticallyShapedIcon:ln}=bie(d,lt,L,Se,p,Ue,Cn,vt,Et);lt=Qt,be.push({feature:Se,shapedTextOrientations:Ue,shapedText:Ht,shapedIcon:lt,iconPrimary:mt,iconSecondary:pt,iconOffset:vt,iconAnchor:_t,verticallyShapedIcon:ln,layoutTextSize:Be,layoutIconSize:Qe,textOffset:st,isSDFIcon:qt,iconTextFit:Et})}return{featureData:be,sizes:k,hasAnySecondaryIcon:ge,textAlongLine:le,symbolPlacement:ce}},s.ea=lz,s.eb=function(d,o,c,f,g,p,x,I,D,L){const{featureData:T,hasAnySecondaryIcon:k,sizes:z,textAlongLine:O,symbolPlacement:B}=o;for(const U of T){const{shapedIcon:X,verticallyShapedIcon:J,feature:ce,shapedTextOrientations:le,shapedText:ie,layoutTextSize:ge,textOffset:be,isSDFIcon:Se,iconPrimary:Ve,iconSecondary:Le,iconTextFit:Be,iconOffset:Qe}=U;_z(X,L.iconPositions,Ve,Le),_z(J,L.iconPositions,Ve,Le),vie(le,L.iconPositions),(ie||X)&&wie(d,ce,le,X,J,D,z,ge,0,be,Se,f,g,x,I,k,Be,Qe,O,B)}c&&d.generateCollisionDebugBuffers(p,d.collisionBoxArray,z.textScaleFactor)},s.ec=gp,s.ed=fS,s.ee=Yn,s.ef=X5,s.eg=GB,s.eh=v,s.ei=function(d){let o=0;if(new Uint32Array(d,0,1)[0]!==V6){const c=new Uint32Array(d,0,7),[,,f,g,p,x]=c;o=c.byteLength+g+p+x+p,(f!==d.byteLength||o>=d.byteLength)&&Nr("Invalid b3dm header information.")}return $6(d,o)},s.ej=function(d,o){const c=G6(d);for(const f of c){for(const g of f.meshes)Kse(g);f.lights&&(f.lightMeshIndex=f.meshes.length,f.meshes.push(Zse(f.lights,o)))}return c},s.ek=sS,s.el=o6,s.em=Rc,s.en=function(d){er(),vr?.then(o=>{o.keys().then(c=>{for(let f=0;f<c.length-d;f++)o.delete(c[f])})})},s.f=function(d){return d.indexOf("mapbox:")===0},s.g=function(d,o){return Ko(Oi(d,{method:"GET"}),o)},s.h=Me,s.i=function(d){return Te.API_STYLE_REGEX.test(d)&&!qe(d)},s.j=function(d){return decodeURIComponent(atob(d).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(d){return btoa(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,(o,c)=>String.fromCharCode(+("0x"+c))))},s.l=Oi,s.m=zr,s.n=function(d,o){return Ko(Oi(d,{type:"json"}),o)},s.o=zs,s.p=function(d,o){return Ko(Oi(d,{method:"POST"}),o)},s.q=Mt,s.r=Aa,s.s=function(d){try{const o=self[d];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=Dt,s.u=function(){return function d(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,d)}()},s.v=function(d){return!!d&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(d)},s.w=Nr,s.x=function(){return vP||(vP=new yg),vP},s.y=SP,s.z=so}),l(["./shared"],function(s){function v(It){const Te=It?It.url.toString():void 0;return Te?performance.getEntriesByName(Te):[]}function w(It){if(typeof It=="number"||typeof It=="boolean"||typeof It=="string"||It==null)return JSON.stringify(It);if(Array.isArray(It)){let Me="[";for(const qe of It)Me+=`${w(qe)},`;return`${Me}]`}let Te="{";for(const Me of Object.keys(It).sort())Te+=`${Me}:${w(It[Me])},`;return`${Te}}`}function A(It){let Te="";for(const Me of s.bm)(It.type!=="model"||Me!=="minzoom"&&Me!=="maxzoom")&&(Te+=`/${w(It[Me])}`);return Te}class F{constructor(Te){this.keyCache={},this._layers={},this._layerConfigs={},Te&&this.replace(Te)}replace(Te,Me){this._layerConfigs={},this._layers={},this.update(Te,[],Me)}update(Te,Me,qe){this._options=qe;for(const rt of Te)this._layerConfigs[rt.id]=rt,(this._layers[rt.id]=s.cv(rt,this.scope,null,this._options)).compileFilter(qe),this.keyCache[rt.id]&&delete this.keyCache[rt.id];for(const rt of Me)delete this.keyCache[rt],delete this._layerConfigs[rt],delete this._layers[rt];this.familiesBySource={};const nt=function(rt,ct){const Tt={};for(let ht=0;ht<rt.length;ht++){const Dt=rt[ht];let Mt=ct&&ct[Dt.id];!Mt&&(Mt=A(Dt),Dt.type==="line"&&Dt.paint)&&function hn(yn){return typeof yn=="string"&&yn==="line-progress"||(Array.isArray(yn)?yn.some(hn):!(!yn||typeof yn!="object")&&Object.values(yn).some(hn))}(Dt.paint["line-width"])&&(Mt+=`/${w(Dt.paint["line-width"])}`),ct&&(ct[Dt.id]=Mt);let Kt=Tt[Mt];Kt||(Kt=Tt[Mt]=[]),Kt.push(Dt)}const ut=[];for(const ht in Tt)ut.push(Tt[ht]);return ut}(Object.values(this._layerConfigs),this.keyCache);for(const rt of nt){const ct=rt.map(Kt=>this._layers[Kt.id]),Tt=ct[0];if(Tt.visibility==="none")continue;const ut=Tt.source||"";let ht=this.familiesBySource[ut];ht||(ht=this.familiesBySource[ut]={});const Dt=Tt.sourceLayer||"_geojsonTileLayer";let Mt=ht[Dt];Mt||(Mt=ht[Dt]=[]),Mt.push(ct)}}}const W=1*s.d_;class K{constructor(Te){const Me={},qe=[];for(const Tt in Te){const ut=Te[Tt],ht=Me[Tt]={};for(const Dt in ut.glyphs){const Mt=ut.glyphs[+Dt];if(!Mt||Mt.bitmap.width===0||Mt.bitmap.height===0)continue;const Kt=Mt.metrics.localGlyph?W:1,hn={x:0,y:0,w:Mt.bitmap.width+2*Kt,h:Mt.bitmap.height+2*Kt};qe.push(hn),ht[Dt]=hn}}const{w:nt,h:rt}=s.H(qe),ct=new s.dZ({width:nt||1,height:rt||1});for(const Tt in Te){const ut=Te[Tt];for(const ht in ut.glyphs){const Dt=ut.glyphs[+ht];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;const Mt=Me[Tt][ht],Kt=Dt.metrics.localGlyph?W:1;s.dZ.copy(Dt.bitmap,ct,{x:0,y:0},{x:Mt.x+Kt,y:Mt.y+Kt},Dt.bitmap)}}this.image=ct,this.positions=Me}}s.dY(K,"GlyphAtlas");class Q{constructor(Te){this.tileID=new s.aH(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),this.tileZoom=Te.tileZoom,this.uid=Te.uid,this.zoom=Te.zoom,this.lut=Te.lut,this.canonical=Te.tileID.canonical,this.pixelRatio=Te.pixelRatio,this.tileSize=Te.tileSize,this.source=Te.source,this.scope=Te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Te.showCollisionBoxes,this.collectResourceTiming=!!Te.request&&Te.request.collectResourceTiming,this.promoteId=Te.promoteId,this.isSymbolTile=Te.isSymbolTile,this.tileTransform=s.aR(Te.tileID.canonical,Te.projection),this.projection=Te.projection,this.worldview=Te.worldview,this.localizableLayerIds=Te.localizableLayerIds,this.brightness=Te.brightness,this.extraShadowCaster=!!Te.extraShadowCaster,this.tessellationStep=Te.tessellationStep,this.scaleFactor=Te.scaleFactor}parse(Te,Me,qe,nt,rt){this.status="parsing",this.data=Te,this.collisionBoxArray=new s.aX;const ct=new s.d$(Object.keys(Te.layers).sort()),Tt=new s.e0(this.tileID,this.promoteId);Tt.bucketLayerIDs=[];const ut={},ht=new s.e1(256,256),Dt={featureIndex:Tt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ht,availableImages:qe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Mt=Me.familiesBySource[this.source];for(const er in Mt){const li=Te.layers[er];if(!li)continue;let zr=!1,oi=!1,an=!1;for(const Xo of Mt[er])Xo[0].type==="symbol"?zr=!0:oi=!0,Xo[0].is3D()&&Xo[0].type!=="model"&&(an=!0);if(this.extraShadowCaster&&!an||this.isSymbolTile===!0&&!zr||this.isSymbolTile===!1&&!oi)continue;li.version===1&&s.w(`Vector tile source "${this.source}" layer "${er}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bs=ct.encode(er),ci=[];let xo=!1;for(let Xo=0,qr=0;Xo<li.length;Xo++){const Gr=li.feature(Xo),Ti=Tt.getId(Gr,er);if(this.localizableLayerIds&&this.localizableLayerIds.has(er)){const Ko=Gr.properties?Gr.properties.worldview:null;if(this.worldview&&typeof Ko=="string")if(Ko==="all")Gr.properties.$localized=!0;else{if(!Ko.split(",").includes(this.worldview))continue;Gr.properties.$localized=!0,Gr.properties.worldview=this.worldview}}!xo&&Gr.properties&&Gr.properties.hasOwnProperty(s.e2)&&(xo=!0),ci.push({feature:Gr,id:Ti,index:qr,sourceLayerIndex:Bs}),qr++}xo&&!Dt.elevationFeatures&&Te.layers.hasOwnProperty(s.e3)&&(Dt.elevationFeatures=s.e4.parseFrom(Te.layers[s.e3],this.canonical));for(const Xo of Mt[er]){const qr=Xo[0];(!this.extraShadowCaster||qr.is3D()&&qr.type!=="model")&&(this.isSymbolTile!==void 0&&qr.type==="symbol"!==this.isSymbolTile||qr.minzoom&&this.zoom<Math.floor(qr.minzoom)||qr.maxzoom&&this.zoom>=qr.maxzoom||qr.visibility!=="none"&&(Z(Xo,this.zoom,Dt.brightness,qe),(ut[qr.id]=qr.createBucket({index:Tt.bucketLayerIDs.length,layers:Xo,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bs,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(ci,Dt,this.tileID.canonical,this.tileTransform),Tt.bucketLayerIDs.push(Xo.map(Gr=>s.C(Gr.id,Gr.scope)))))}}let Kt,hn,yn,Jn,ir,xr;ht.trim();const vr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ii=()=>{if(Kt)return this.status="done",rt(Kt);if(this.extraShadowCaster)this.status="done",rt(null,{buckets:Object.values(ut).filter(er=>!er.isEmpty()),featureIndex:Tt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Dt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(hn&&yn&&Jn){const er=new K(hn),li=new Map;for(const[an,Bs]of yn.entries()){const{imagePosition:ci}=s.e7(an,Bs,s.e8);li.set(an,ci)}const zr={};for(const an in ut){const Bs=ut[an];Bs instanceof s.aY&&(Z(Bs.layers,this.zoom,Dt.brightness,qe),zr[an]=s.e9(Bs,hn,er.positions,yn,li,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const oi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(nt,yn,ir,()=>{oi.iconsPending=!1,si(zr,er,oi)}),this.rasterizeIfNeeded(nt,Jn,xr,()=>{oi.patternsPending=!1,si(zr,er,oi)})}},si=(er,li,zr,oi)=>{if(zr.iconsPending||zr.patternsPending)return;const an=new s.ea(yn,Jn,this.lut);for(const Bs in ut){const ci=ut[Bs];if(Bs in er)s.eb(ci,er[Bs],this.showCollisionBoxes,qe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,yn,an);else if(ci.hasPattern&&(ci instanceof s.b2||ci instanceof s.b3||ci instanceof s.d8)){Z(ci.layers,this.zoom,Dt.brightness,qe);const xo=Object.fromEntries(an.patternPositions);ci.addFeatures(Dt,this.tileID.canonical,xo,qe,this.tileTransform,this.brightness)}}this.status="done",rt(null,{buckets:Object.values(ut).filter(Bs=>!Bs.isEmpty()),featureIndex:Tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:li.image,lineAtlas:ht,imageAtlas:an,brightness:Dt.brightness})};if(!this.extraShadowCaster){const er=s.e5(Dt.glyphDependencies,oi=>Object.keys(oi).map(Number));Object.keys(er).length?nt.send("getGlyphs",{uid:this.uid,stacks:er,scope:this.scope},(oi,an)=>{Kt||(Kt=oi,hn=an,ii())},void 0,!1,vr):hn={};const li=Array.from(Dt.iconDependencies.keys()).map(oi=>s.I.parse(oi));li.length?nt.send("getImages",{images:li,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(oi,an)=>{Kt||(Kt=oi,yn=new Map,ir=this.updateImageMapAndGetImageTaskQueue(yn,an,Dt.iconDependencies),ii())},void 0,!1,vr):(yn=new Map,ir=new Map);const zr=Array.from(Dt.patternDependencies.keys()).map(oi=>s.I.parse(oi));zr.length?nt.send("getImages",{images:zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(oi,an)=>{Kt||(Kt=oi,Jn=new Map,xr=this.updateImageMapAndGetImageTaskQueue(Jn,an,Dt.patternDependencies),ii())},void 0,!1,vr):(Jn=new Map,xr=new Map)}if(Dt.elevationFeatures&&Dt.elevationFeatures.length>0){const er=[];for(const zr of Object.values(ut))if(zr instanceof s.b3){const oi=zr.getUnevaluatedPortalGraph();oi&&er.push(oi)}const li=s.e6.evaluate(er);for(const zr of Object.values(ut))zr instanceof s.b3&&zr.setEvaluatedPortalGraph(li)}ii()}rasterizeIfNeeded(Te,Me,qe,nt){Array.from(Me.values()).some(rt=>rt.usvg)?this.rasterize(Te,Me,qe,nt):nt()}updateImageMapAndGetImageTaskQueue(Te,Me,qe){const nt=new Map;for(const rt of Me.keys()){const ct=qe.get(rt)||[];for(const Tt of ct){const ut=Tt.toString(),ht=Me.get(Tt.id.toString());ht.usvg?nt.has(ut)||(nt.set(ut,Tt),Te.set(ut,Object.assign({},ht))):Te.set(ut,ht)}}return nt}rasterize(Te,Me,qe,nt){this.rasterizeTask=Te.send("rasterizeImages",{scope:this.scope,tasks:qe},(rt,ct)=>{if(!rt)for(const[Tt,ut]of ct.entries()){const ht=Object.assign(Me.get(Tt),{data:ut});Me.set(Tt,ht)}nt()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Z(It,Te,Me,qe){const nt=new s.aa(Te,{brightness:Me});for(const rt of It)rt.recalculate(nt,qe)}class oe extends s.E{constructor(Te,Me,qe,nt,rt,ct){super(),this.actor=Te,this.layerIndex=Me,this.availableImages=qe,this.loadVectorData=rt||s.aE,this.loading={},this.loaded={},this.deduped=new s.aD(Te.scheduler),this.isSpriteLoaded=nt,this.scheduler=Te.scheduler,this.brightness=ct}loadTile(Te,Me){const qe=Te.uid,nt=Te&&Te.request,rt=nt&&nt.collectResourceTiming,ct=this.loading[qe]=new Q(Te);ct.abort=this.loadVectorData(Te,(Tt,ut)=>{const ht=!this.loading[qe];if(delete this.loading[qe],ct.cancelRasterize(),ht||Tt||!ut)return ct.status="done",ht||(this.loaded[qe]=ct),Me(Tt);const Dt=ut.rawData,Mt={};ut.expires&&(Mt.expires=ut.expires),ut.cacheControl&&(Mt.cacheControl=ut.cacheControl),ct.vectorTile=ut.vectorTile||new s.ec.VectorTile(new s.bi(Dt));const Kt=()=>{ct.parse(ct.vectorTile,this.layerIndex,this.availableImages,this.actor,(hn,yn)=>{if(hn||!yn)return Me(hn);const Jn={};if(rt){const ir=v(nt);ir.length>0&&(Jn.resourceTiming=JSON.parse(JSON.stringify(ir)))}Me(null,s.l({rawTileData:Dt.slice(0)},yn,Mt,Jn))})};this.isSpriteLoaded?Kt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Kt,{type:"parseTile",isSymbolTile:Te.isSymbolTile,zoom:Te.tileZoom}):Kt()}),this.loaded=this.loaded||{},this.loaded[qe]=ct})}reloadTile(Te,Me){const qe=this.loaded,nt=Te.uid;if(qe&&qe[nt]){const rt=qe[nt];rt.scaleFactor=Te.scaleFactor,rt.showCollisionBoxes=Te.showCollisionBoxes,rt.projection=Te.projection,rt.brightness=Te.brightness,rt.tileTransform=s.aR(Te.tileID.canonical,Te.projection),rt.extraShadowCaster=Te.extraShadowCaster,rt.lut=Te.lut;const ct=(Tt,ut)=>{const ht=rt.reloadCallback;ht&&(delete rt.reloadCallback,rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,ht)),Me(Tt,ut)};rt.status==="parsing"?rt.reloadCallback=ct:rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,ct):ct())}else Me(null,void 0)}abortTile(Te,Me){const qe=Te.uid,nt=this.loading[qe];nt&&(nt.abort&&nt.abort(),delete this.loading[qe]),Me()}removeTile(Te,Me){const qe=this.loaded,nt=Te.uid;qe&&qe[nt]&&delete qe[nt],Me()}}class ae{loadTile(Te,Me){const{uid:qe,encoding:nt,rawImageData:rt,padding:ct}=Te,Tt=ImageBitmap&&rt instanceof ImageBitmap?this.getImageData(rt,ct):rt;Me(null,new s.ed(qe,Tt,nt,ct<1))}reloadTile(Te,Me){Me(null,null)}abortTile(Te,Me){Me()}removeTile(Te,Me){Me()}getImageData(Te,Me){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Te.width,Te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Te.width,this.offscreenCanvas.height=Te.height,this.offscreenCanvasContext.drawImage(Te,0,0,Te.width,Te.height);const qe=this.offscreenCanvasContext.getImageData(-Me,-Me,Te.width+2*Me,Te.height+2*Me);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),qe}}s.bh.setPbf(s.bi);class me{constructor(Te){this._mrt=new s.bh(Te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Te.uid,this.tileID=Te.tileID,this.source=Te.source}parse(Te,Me){const qe=this._mrt;this.status="parsing",this._entireBuffer=Te;try{qe.parseHeader(Te),this._isHeaderLoaded=!0;const nt=[];for(const rt in qe.layers){const ct=qe.getLayer(rt),Tt=ct.getDataRange(ct.getBandList()),ut=qe.createDecodingTask(Tt),ht=Te.slice(Tt.firstByte,Tt.lastByte+1),Dt=s.bh.performDecoding(ht,ut).then(Mt=>ut.complete(null,Mt)).catch(Mt=>ut.complete(Mt,null));nt.push(Dt)}Promise.allSettled(nt).then(()=>Me(null,qe))}catch(nt){Me(nt)}}}class pe{constructor(Te){this.actor=Te,this.loading={},this.loaded={}}loadTile(Te,Me){const qe=Te.uid,nt=Te.request,rt=this.loading[qe]=new me(Te),{cancel:ct}=s.bj(nt,(Tt,ut,ht,Dt)=>{const Mt=!this.loading[qe];if(delete this.loading[qe],Mt||Tt||!ut)return rt.status="done",Mt||(this.loaded[qe]=rt),Me(Tt);rt.parse(ut,(Kt,hn)=>{if(Kt||!hn)return Me(Kt);Me(null,hn,ht,Dt)}),this.loaded[qe]=rt});rt.abort=ct}reloadTile(Te,Me){Me(null,void 0)}abortTile(Te,Me){const qe=Te.uid,nt=this.loading[qe];nt&&(nt.abort&&nt.abort(),delete this.loading[qe]),Me()}removeTile(Te,Me){const qe=Te.uid;this.loaded[qe]&&delete this.loaded[qe],Me()}decodeRasterArray({task:Te,buffer:Me},qe){s.bh.performDecoding(Me,Te).then(nt=>qe(null,nt)).catch(nt=>qe(nt))}}const _e=s.ec.VectorTileFeature.prototype.toGeoJSON;class De{constructor(Te){this._feature=Te,this.extent=s.ai,this.type=Te.type,this.properties=Te.tags,"id"in Te&&!isNaN(Te.id)&&(this.id=parseInt(Te.id,10))}loadGeometry(){if(this._feature.type===1){const Te=[];for(const Me of this._feature.geometry)Te.push([new s.P(Me[0],Me[1])]);return Te}{const Te=[];for(const Me of this._feature.geometry){const qe=[];for(const nt of Me)qe.push(new s.P(nt[0],nt[1]));Te.push(qe)}return Te}}toGeoJSON(Te,Me,qe){return _e.call(this,Te,Me,qe)}}class Ae{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ai,this.length=Te.length,this._features=Te}feature(Te){return new De(this._features[Te])}}const re=64/4096,fe=128;class ye{constructor(){this.features=new Map}clear(){this.features.clear()}load(Te=[],Me){for(const qe of Te){const nt=qe.id;if(nt==null)continue;let rt=this.features.get(nt);rt&&this.updateCache(rt,Me),qe.geometry?(rt=Ie(qe),this.updateCache(rt,Me),this.features.set(nt,rt)):this.features.delete(nt),this.updateCache(rt,Me)}}updateCache(Te,Me){for(const{canonical:qe,uid:nt}of Object.values(Me)){const{z:rt,x:ct,y:Tt}=qe;ue(Te,Math.pow(2,rt),ct,Tt)&&delete Me[nt]}}getTile(Te,Me,qe){const nt=Math.pow(2,Te),rt=[];for(const ct of this.features.values())ue(ct,nt,Me,qe)&&rt.push(He(ct,nt,Me,qe));return{features:rt}}getFeatures(){return[...this.features.values()]}}function ue({minX:It,minY:Te,maxX:Me,maxY:qe},nt,rt,ct){return It<(rt+1+re)/nt&&Te<(ct+1+re)/nt&&Me>(rt-re)/nt&&qe>(ct-re)/nt}function Ie(It){const{id:Te,geometry:Me,properties:qe}=It;if(!Me)return;if(Me.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:nt,coordinates:rt}=Me,ct={id:Te,type:1,geometry:[],tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Tt=ct.geometry;if(nt==="Point")Oe(rt,Tt,ct);else if(nt==="MultiPoint")for(const ut of rt)Oe(ut,Tt,ct);else if(nt==="LineString")ct.type=2,ze(rt,Tt,ct);else if(nt==="MultiLineString")ct.type=2,ft(rt,Tt,ct);else if(nt==="Polygon")ct.type=3,ft(rt,Tt,ct,!0);else{if(nt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ct.type=3;for(const ut of rt)ft(ut,Tt,ct,!0)}return ct}function Oe([It,Te],Me,qe){const nt=s.av(It);let rt=s.aC(Te);rt=rt<0?0:rt>1?1:rt,Me.push(nt,rt),qe.minX=Math.min(qe.minX,nt),qe.minY=Math.min(qe.minY,rt),qe.maxX=Math.max(qe.maxX,nt),qe.maxY=Math.max(qe.maxY,rt)}function ze(It,Te,Me,qe=!1,nt=!1){const rt=[];for(const ct of It)Oe(ct,rt,Me);Te.push(rt),qe&&function(ct,Tt){let ut=0;for(let ht=0,Dt=ct.length,Mt=Dt-2;ht<Dt;Mt=ht,ht+=2)ut+=(ct[ht]-ct[Mt])*(ct[ht+1]+ct[Mt+1]);if(ut>0===Tt)for(let ht=0,Dt=ct.length;ht<Dt/2;ht+=2){const Mt=ct[ht],Kt=ct[ht+1];ct[ht]=ct[Dt-2-ht],ct[ht+1]=ct[Dt-1-ht],ct[Dt-2-ht]=Mt,ct[Dt-1-ht]=Kt}}(rt,nt)}function ft(It,Te,Me,qe=!1){for(let nt=0;nt<It.length;nt++)ze(It[nt],Te,Me,qe,nt===0)}function He(It,Te,Me,qe){const{id:nt,type:rt,geometry:ct,tags:Tt}=It,ut=[];if(rt===1)(function(ht,Dt,Mt,Kt,hn){for(let yn=0;yn<ht.length;yn+=2){const Jn=Math.round(s.ai*(ht[yn+0]*Dt-Mt)),ir=Math.round(s.ai*(ht[yn+1]*Dt-Kt));hn.push([Jn,ir])}})(ct,Te,Me,qe,ut);else for(const ht of ct)bt(ht,Te,Me,qe,ut);return{id:nt,type:rt,geometry:ut,tags:Tt}}function bt(It,Te,Me,qe,nt){const ct=s.ai+fe;let Tt;for(let ut=0;ut<It.length-2;ut+=2){let ht=Math.round(s.ai*(It[ut+0]*Te-Me)),Dt=Math.round(s.ai*(It[ut+1]*Te-qe)),Mt=Math.round(s.ai*(It[ut+2]*Te-Me)),Kt=Math.round(s.ai*(It[ut+3]*Te-qe));const hn=Mt-ht,yn=Kt-Dt;ht<-128&&Mt<-128||(ht<-128?(Dt+=Math.round(yn*((-128-ht)/hn)),ht=-128):Mt<-128&&(Kt=Dt+Math.round(yn*((-128-ht)/hn)),Mt=-128),Dt<-128&&Kt<-128||(Dt<-128?(ht+=Math.round(hn*((-128-Dt)/yn)),Dt=-128):Kt<-128&&(Mt=ht+Math.round(hn*((-128-Dt)/yn)),Kt=-128),ht>=ct&&Mt>=ct||(ht>=ct?(Dt+=Math.round(yn*((ct-ht)/hn)),ht=ct):Mt>=ct&&(Kt=Dt+Math.round(yn*((ct-ht)/hn)),Mt=ct),Dt>=ct&&Kt>=ct||(Dt>=ct?(ht+=Math.round(hn*((ct-Dt)/yn)),Dt=ct):Kt>=ct&&(Mt=ht+Math.round(hn*((ct-Dt)/yn)),Kt=ct),Tt&&ht===Tt[Tt.length-1][0]&&Dt===Tt[Tt.length-1][1]||(Tt=[[ht,Dt]],nt.push(Tt)),Tt.push([Mt,Kt])))))}}var Nt,wt,it,nn={exports:{}},In=function(){if(it)return nn.exports;it=1;var It=s.eg(),Te=function(){if(wt)return Nt;wt=1;var Dt=s.ee(),Mt=s.ef().VectorTileFeature;function Kt(yn,Jn){this.options=Jn||{},this.features=yn,this.length=yn.length}function hn(yn,Jn){this.id=typeof yn.id=="number"?yn.id:void 0,this.type=yn.type,this.rawGeometry=yn.type===1?[yn.geometry]:yn.geometry,this.properties=yn.tags,this.extent=Jn||4096}return Nt=Kt,Kt.prototype.feature=function(yn){return new hn(this.features[yn],this.options.extent)},hn.prototype.loadGeometry=function(){var yn=this.rawGeometry;this.geometry=[];for(var Jn=0;Jn<yn.length;Jn++){for(var ir=yn[Jn],xr=[],vr=0;vr<ir.length;vr++)xr.push(new Dt(ir[vr][0],ir[vr][1]));this.geometry.push(xr)}return this.geometry},hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yn=this.geometry,Jn=1/0,ir=-1/0,xr=1/0,vr=-1/0,ii=0;ii<yn.length;ii++)for(var si=yn[ii],er=0;er<si.length;er++){var li=si[er];Jn=Math.min(Jn,li.x),ir=Math.max(ir,li.x),xr=Math.min(xr,li.y),vr=Math.max(vr,li.y)}return[Jn,xr,ir,vr]},hn.prototype.toGeoJSON=Mt.prototype.toGeoJSON,Nt}();function Me(Dt){var Mt=new It;return function(Kt,hn){for(var yn in Kt.layers)hn.writeMessage(3,qe,Kt.layers[yn])}(Dt,Mt),Mt.finish()}function qe(Dt,Mt){var Kt;Mt.writeVarintField(15,Dt.version||1),Mt.writeStringField(1,Dt.name||""),Mt.writeVarintField(5,Dt.extent||4096);var hn={keys:[],values:[],keycache:{},valuecache:{}};for(Kt=0;Kt<Dt.length;Kt++)hn.feature=Dt.feature(Kt),Mt.writeMessage(2,nt,hn);var yn=hn.keys;for(Kt=0;Kt<yn.length;Kt++)Mt.writeStringField(3,yn[Kt]);var Jn=hn.values;for(Kt=0;Kt<Jn.length;Kt++)Mt.writeMessage(4,ht,Jn[Kt])}function nt(Dt,Mt){var Kt=Dt.feature;Kt.id!==void 0&&Mt.writeVarintField(1,Kt.id),Mt.writeMessage(2,rt,Dt),Mt.writeVarintField(3,Kt.type),Mt.writeMessage(4,ut,Kt)}function rt(Dt,Mt){var Kt=Dt.feature,hn=Dt.keys,yn=Dt.values,Jn=Dt.keycache,ir=Dt.valuecache;for(var xr in Kt.properties){var vr=Kt.properties[xr],ii=Jn[xr];if(vr!==null){ii===void 0&&(hn.push(xr),Jn[xr]=ii=hn.length-1),Mt.writeVarint(ii);var si=typeof vr;si!=="string"&&si!=="boolean"&&si!=="number"&&(vr=JSON.stringify(vr));var er=si+":"+vr,li=ir[er];li===void 0&&(yn.push(vr),ir[er]=li=yn.length-1),Mt.writeVarint(li)}}}function ct(Dt,Mt){return(Mt<<3)+(7&Dt)}function Tt(Dt){return Dt<<1^Dt>>31}function ut(Dt,Mt){for(var Kt=Dt.loadGeometry(),hn=Dt.type,yn=0,Jn=0,ir=Kt.length,xr=0;xr<ir;xr++){var vr=Kt[xr],ii=1;hn===1&&(ii=vr.length),Mt.writeVarint(ct(1,ii));for(var si=hn===3?vr.length-1:vr.length,er=0;er<si;er++){er===1&&hn!==1&&Mt.writeVarint(ct(2,si-1));var li=vr[er].x-yn,zr=vr[er].y-Jn;Mt.writeVarint(Tt(li)),Mt.writeVarint(Tt(zr)),yn+=li,Jn+=zr}hn===3&&Mt.writeVarint(ct(7,1))}}function ht(Dt,Mt){var Kt=typeof Dt;Kt==="string"?Mt.writeStringField(1,Dt):Kt==="boolean"?Mt.writeBooleanField(7,Dt):Kt==="number"&&(Dt%1!=0?Mt.writeDoubleField(3,Dt):Dt<0?Mt.writeSVarintField(6,Dt):Mt.writeVarintField(5,Dt))}return nn.exports=Me,nn.exports.fromVectorTileJs=Me,nn.exports.fromGeojsonVt=function(Dt,Mt){Mt=Mt||{};var Kt={};for(var hn in Dt)Kt[hn]=new Te(Dt[hn].features,Mt),Kt[hn].name=hn,Kt[hn].version=Mt.version,Kt[hn].extent=Mt.extent;return Me({layers:Kt})},nn.exports.GeoJSONWrapper=Te,nn.exports}(),wn=s.eh(In);const Xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:It=>It},On=Math.fround||(cr=new Float32Array(1),It=>(cr[0]=+It,cr[0]));var cr;const En=3,fn=5,ur=6;class br{constructor(Te){this.options=Object.assign(Object.create(Xt),Te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Te){const{log:Me,minZoom:qe,maxZoom:nt}=this.options;Me&&console.time("total time");const rt=`prepare ${Te.length} points`;Me&&console.time(rt),this.points=Te;const ct=[];for(let ut=0;ut<Te.length;ut++){const ht=Te[ut];if(!ht.geometry)continue;const[Dt,Mt]=ht.geometry.coordinates,Kt=On(rr(Dt)),hn=On(Yn(Mt));ct.push(Kt,hn,1/0,ut,-1,1),this.options.reduce&&ct.push(0)}let Tt=this.trees[nt+1]=this._createTree(ct);Me&&console.timeEnd(rt);for(let ut=nt;ut>=qe;ut--){const ht=+Date.now();Tt=this.trees[ut]=this._createTree(this._cluster(Tt,ut)),Me&&console.log("z%d: %d clusters in %dms",ut,Tt.numItems,+Date.now()-ht)}return Me&&console.timeEnd("total time"),this}getClusters(Te,Me){let qe=((Te[0]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,Te[1]));let rt=Te[2]===180?180:((Te[2]+180)%360+360)%360-180;const ct=Math.max(-90,Math.min(90,Te[3]));if(Te[2]-Te[0]>=360)qe=-180,rt=180;else if(qe>rt){const Mt=this.getClusters([qe,nt,180,ct],Me),Kt=this.getClusters([-180,nt,rt,ct],Me);return Mt.concat(Kt)}const Tt=this.trees[this._limitZoom(Me)],ut=Tt.range(rr(qe),Yn(ct),rr(rt),Yn(nt)),ht=Tt.data,Dt=[];for(const Mt of ut){const Kt=this.stride*Mt;Dt.push(ht[Kt+fn]>1?Pe(ht,Kt,this.clusterProps):this.points[ht[Kt+En]])}return Dt}getChildren(Te){const Me=this._getOriginId(Te),qe=this._getOriginZoom(Te),nt="No cluster with the specified id.",rt=this.trees[qe];if(!rt)throw new Error(nt);const ct=rt.data;if(Me*this.stride>=ct.length)throw new Error(nt);const Tt=this.options.radius/(this.options.extent*Math.pow(2,qe-1)),ut=rt.within(ct[Me*this.stride],ct[Me*this.stride+1],Tt),ht=[];for(const Dt of ut){const Mt=Dt*this.stride;ct[Mt+4]===Te&&ht.push(ct[Mt+fn]>1?Pe(ct,Mt,this.clusterProps):this.points[ct[Mt+En]])}if(ht.length===0)throw new Error(nt);return ht}getLeaves(Te,Me,qe){const nt=[];return this._appendLeaves(nt,Te,Me=Me||10,qe=qe||0,0),nt}getTile(Te,Me,qe){const nt=this.trees[this._limitZoom(Te)],rt=Math.pow(2,Te),{extent:ct,radius:Tt}=this.options,ut=Tt/ct,ht=(qe-ut)/rt,Dt=(qe+1+ut)/rt,Mt={features:[]};return this._addTileFeatures(nt.range((Me-ut)/rt,ht,(Me+1+ut)/rt,Dt),nt.data,Me,qe,rt,Mt),Me===0&&this._addTileFeatures(nt.range(1-ut/rt,ht,1,Dt),nt.data,rt,qe,rt,Mt),Me===rt-1&&this._addTileFeatures(nt.range(0,ht,ut/rt,Dt),nt.data,-1,qe,rt,Mt),Mt.features.length?Mt:null}getClusterExpansionZoom(Te){let Me=this._getOriginZoom(Te)-1;for(;Me<=this.options.maxZoom;){const qe=this.getChildren(Te);if(Me++,qe.length!==1)break;Te=qe[0].properties.cluster_id}return Me}_appendLeaves(Te,Me,qe,nt,rt){const ct=this.getChildren(Me);for(const Tt of ct){const ut=Tt.properties;if(ut&&ut.cluster?rt+ut.point_count<=nt?rt+=ut.point_count:rt=this._appendLeaves(Te,ut.cluster_id,qe,nt,rt):rt<nt?rt++:Te.push(Tt),Te.length===qe)break}return rt}_createTree(Te){const Me=new s.bE(Te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let qe=0;qe<Te.length;qe+=this.stride)Me.add(Te[qe],Te[qe+1]);return Me.finish(),Me.data=Te,Me}_addTileFeatures(Te,Me,qe,nt,rt,ct){for(const Tt of Te){const ut=Tt*this.stride,ht=Me[ut+fn]>1;let Dt,Mt,Kt;if(ht)Dt=jn(Me,ut,this.clusterProps),Mt=Me[ut],Kt=Me[ut+1];else{const Jn=this.points[Me[ut+En]];Dt=Jn.properties;const[ir,xr]=Jn.geometry.coordinates;Mt=rr(ir),Kt=Yn(xr)}const hn={type:1,geometry:[[Math.round(this.options.extent*(Mt*rt-qe)),Math.round(this.options.extent*(Kt*rt-nt))]],tags:Dt};let yn;yn=ht||this.options.generateId?Me[ut+En]:this.points[Me[ut+En]].id,yn!==void 0&&(hn.id=yn),ct.features.push(hn)}}_limitZoom(Te){return Math.max(this.options.minZoom,Math.min(Math.floor(+Te),this.options.maxZoom+1))}_cluster(Te,Me){const{radius:qe,extent:nt,reduce:rt,minPoints:ct}=this.options,Tt=qe/(nt*Math.pow(2,Me)),ut=Te.data,ht=[],Dt=this.stride;for(let Mt=0;Mt<ut.length;Mt+=Dt){if(ut[Mt+2]<=Me)continue;ut[Mt+2]=Me;const Kt=ut[Mt],hn=ut[Mt+1],yn=Te.within(ut[Mt],ut[Mt+1],Tt),Jn=ut[Mt+fn];let ir=Jn;for(const xr of yn){const vr=xr*Dt;ut[vr+2]>Me&&(ir+=ut[vr+fn])}if(ir>Jn&&ir>=ct){let xr,vr=Kt*Jn,ii=hn*Jn,si=-1;const er=(Mt/Dt<<5)+(Me+1)+this.points.length;for(const li of yn){const zr=li*Dt;if(ut[zr+2]<=Me)continue;ut[zr+2]=Me;const oi=ut[zr+fn];vr+=ut[zr]*oi,ii+=ut[zr+1]*oi,ut[zr+4]=er,rt&&(xr||(xr=this._map(ut,Mt,!0),si=this.clusterProps.length,this.clusterProps.push(xr)),rt(xr,this._map(ut,zr)))}ut[Mt+4]=er,ht.push(vr/ir,ii/ir,1/0,er,-1,ir),rt&&ht.push(si)}else{for(let xr=0;xr<Dt;xr++)ht.push(ut[Mt+xr]);if(ir>1)for(const xr of yn){const vr=xr*Dt;if(!(ut[vr+2]<=Me)){ut[vr+2]=Me;for(let ii=0;ii<Dt;ii++)ht.push(ut[vr+ii])}}}}return ht}_getOriginId(Te){return Te-this.points.length>>5}_getOriginZoom(Te){return(Te-this.points.length)%32}_map(Te,Me,qe){if(Te[Me+fn]>1){const ct=this.clusterProps[Te[Me+ur]];return qe?Object.assign({},ct):ct}const nt=this.points[Te[Me+En]].properties,rt=this.options.map(nt);return qe&&rt===nt?Object.assign({},rt):rt}}function Pe(It,Te,Me){return{type:"Feature",id:It[Te+En],properties:jn(It,Te,Me),geometry:{type:"Point",coordinates:[(qe=It[Te],360*(qe-.5)),Ot(It[Te+1])]}};var qe}function jn(It,Te,Me){const qe=It[Te+fn],nt=qe>=1e4?`${Math.round(qe/1e3)}k`:qe>=1e3?Math.round(qe/100)/10+"k":qe,rt=It[Te+ur],ct=rt===-1?{}:Object.assign({},Me[rt]);return Object.assign(ct,{cluster:!0,cluster_id:It[Te+En],point_count:qe,point_count_abbreviated:nt})}function rr(It){return It/360+.5}function Yn(It){const Te=Math.sin(It*Math.PI/180),Me=.5-.25*Math.log((1+Te)/(1-Te))/Math.PI;return Me<0?0:Me>1?1:Me}function Ot(It){const Te=(180-360*It)*Math.PI/180;return 360*Math.atan(Math.exp(Te))/Math.PI-90}function Sr(It,Te,Me,qe){let nt=qe;const rt=Te+(Me-Te>>1);let ct,Tt=Me-Te;const ut=It[Te],ht=It[Te+1],Dt=It[Me],Mt=It[Me+1];for(let Kt=Te+3;Kt<Me;Kt+=3){const hn=fi(It[Kt],It[Kt+1],ut,ht,Dt,Mt);if(hn>nt)ct=Kt,nt=hn;else if(hn===nt){const yn=Math.abs(Kt-rt);yn<Tt&&(ct=Kt,Tt=yn)}}nt>qe&&(ct-Te>3&&Sr(It,Te,ct,qe),It[ct+2]=nt,Me-ct>3&&Sr(It,ct,Me,qe))}function fi(It,Te,Me,qe,nt,rt){let ct=nt-Me,Tt=rt-qe;if(ct!==0||Tt!==0){const ut=((It-Me)*ct+(Te-qe)*Tt)/(ct*ct+Tt*Tt);ut>1?(Me=nt,qe=rt):ut>0&&(Me+=ct*ut,qe+=Tt*ut)}return ct=It-Me,Tt=Te-qe,ct*ct+Tt*Tt}function Wr(It,Te,Me,qe){const nt={id:It??null,type:Te,geometry:Me,tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")Mn(nt,Me);else if(Te==="Polygon")Mn(nt,Me[0]);else if(Te==="MultiLineString")for(const rt of Me)Mn(nt,rt);else if(Te==="MultiPolygon")for(const rt of Me)Mn(nt,rt[0]);return nt}function Mn(It,Te){for(let Me=0;Me<Te.length;Me+=3)It.minX=Math.min(It.minX,Te[Me]),It.minY=Math.min(It.minY,Te[Me+1]),It.maxX=Math.max(It.maxX,Te[Me]),It.maxY=Math.max(It.maxY,Te[Me+1])}function jt(It,Te,Me,qe){if(!Te.geometry)return;const nt=Te.geometry.coordinates;if(nt&&nt.length===0)return;const rt=Te.geometry.type,ct=Math.pow(Me.tolerance/((1<<Me.maxZoom)*Me.extent),2);let Tt=[],ut=Te.id;if(Me.promoteId?ut=Te.properties[Me.promoteId]:Me.generateId&&(ut=qe||0),rt==="Point")Ln(nt,Tt);else if(rt==="MultiPoint")for(const ht of nt)Ln(ht,Tt);else if(rt==="LineString")un(nt,Tt,ct,!1);else if(rt==="MultiLineString"){if(Me.lineMetrics){for(const ht of nt)Tt=[],un(ht,Tt,ct,!1),It.push(Wr(ut,"LineString",Tt,Te.properties));return}Xn(nt,Tt,ct,!1)}else if(rt==="Polygon")Xn(nt,Tt,ct,!0);else{if(rt!=="MultiPolygon"){if(rt==="GeometryCollection"){for(const ht of Te.geometry.geometries)jt(It,{id:ut,geometry:ht,properties:Te.properties},Me,qe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ht of nt){const Dt=[];Xn(ht,Dt,ct,!0),Tt.push(Dt)}}It.push(Wr(ut,rt,Tt,Te.properties))}function Ln(It,Te){Te.push(Ni(It[0]),Bn(It[1]),0)}function un(It,Te,Me,qe){let nt,rt,ct=0;for(let ut=0;ut<It.length;ut++){const ht=Ni(It[ut][0]),Dt=Bn(It[ut][1]);Te.push(ht,Dt,0),ut>0&&(ct+=qe?(nt*Dt-ht*rt)/2:Math.sqrt(Math.pow(ht-nt,2)+Math.pow(Dt-rt,2))),nt=ht,rt=Dt}const Tt=Te.length-3;Te[2]=1,Sr(Te,0,Tt,Me),Te[Tt+2]=1,Te.size=Math.abs(ct),Te.start=0,Te.end=Te.size}function Xn(It,Te,Me,qe){for(let nt=0;nt<It.length;nt++){const rt=[];un(It[nt],rt,Me,qe),Te.push(rt)}}function Ni(It){return It/360+.5}function Bn(It){const Te=Math.sin(It*Math.PI/180),Me=.5-.25*Math.log((1+Te)/(1-Te))/Math.PI;return Me<0?0:Me>1?1:Me}function Es(It,Te,Me,qe,nt,rt,ct,Tt){if(qe/=Te,rt>=(Me/=Te)&&ct<qe)return It;if(ct<Me||rt>=qe)return null;const ut=[];for(const ht of It){const Dt=ht.geometry;let Mt=ht.type;const Kt=nt===0?ht.minX:ht.minY,hn=nt===0?ht.maxX:ht.maxY;if(Kt>=Me&&hn<qe){ut.push(ht);continue}if(hn<Me||Kt>=qe)continue;let yn=[];if(Mt==="Point"||Mt==="MultiPoint")Si(Dt,yn,Me,qe,nt);else if(Mt==="LineString")cs(Dt,yn,Me,qe,nt,!1,Tt.lineMetrics);else if(Mt==="MultiLineString")mn(Dt,yn,Me,qe,nt,!1);else if(Mt==="Polygon")mn(Dt,yn,Me,qe,nt,!0);else if(Mt==="MultiPolygon")for(const Jn of Dt){const ir=[];mn(Jn,ir,Me,qe,nt,!0),ir.length&&yn.push(ir)}if(yn.length){if(Tt.lineMetrics&&Mt==="LineString"){for(const Jn of yn)ut.push(Wr(ht.id,Mt,Jn,ht.tags));continue}Mt!=="LineString"&&Mt!=="MultiLineString"||(yn.length===1?(Mt="LineString",yn=yn[0]):Mt="MultiLineString"),Mt!=="Point"&&Mt!=="MultiPoint"||(Mt=yn.length===3?"Point":"MultiPoint"),ut.push(Wr(ht.id,Mt,yn,ht.tags))}}return ut.length?ut:null}function Si(It,Te,Me,qe,nt){for(let rt=0;rt<It.length;rt+=3){const ct=It[rt+nt];ct>=Me&&ct<=qe&&hr(Te,It[rt],It[rt+1],It[rt+2])}}function cs(It,Te,Me,qe,nt,rt,ct){let Tt=Oi(It);const ut=nt===0?Tr:Li;let ht,Dt,Mt=It.start;for(let ir=0;ir<It.length-3;ir+=3){const xr=It[ir],vr=It[ir+1],ii=It[ir+2],si=It[ir+3],er=It[ir+4],li=nt===0?xr:vr,zr=nt===0?si:er;let oi=!1;ct&&(ht=Math.sqrt(Math.pow(xr-si,2)+Math.pow(vr-er,2))),li<Me?zr>Me&&(Dt=ut(Tt,xr,vr,si,er,Me),ct&&(Tt.start=Mt+ht*Dt)):li>qe?zr<qe&&(Dt=ut(Tt,xr,vr,si,er,qe),ct&&(Tt.start=Mt+ht*Dt)):hr(Tt,xr,vr,ii),zr<Me&&li>=Me&&(Dt=ut(Tt,xr,vr,si,er,Me),oi=!0),zr>qe&&li<=qe&&(Dt=ut(Tt,xr,vr,si,er,qe),oi=!0),!rt&&oi&&(ct&&(Tt.end=Mt+ht*Dt),Te.push(Tt),Tt=Oi(It)),ct&&(Mt+=ht)}let Kt=It.length-3;const hn=It[Kt],yn=It[Kt+1],Jn=nt===0?hn:yn;Jn>=Me&&Jn<=qe&&hr(Tt,hn,yn,It[Kt+2]),Kt=Tt.length-3,rt&&Kt>=3&&(Tt[Kt]!==Tt[0]||Tt[Kt+1]!==Tt[1])&&hr(Tt,Tt[0],Tt[1],Tt[2]),Tt.length&&Te.push(Tt)}function Oi(It){const Te=[];return Te.size=It.size,Te.start=It.start,Te.end=It.end,Te}function mn(It,Te,Me,qe,nt,rt){for(const ct of It)cs(ct,Te,Me,qe,nt,rt,!1)}function hr(It,Te,Me,qe){It.push(Te,Me,qe)}function Tr(It,Te,Me,qe,nt,rt){const ct=(rt-Te)/(qe-Te);return hr(It,rt,Me+(nt-Me)*ct,1),ct}function Li(It,Te,Me,qe,nt,rt){const ct=(rt-Me)/(nt-Me);return hr(It,Te+(qe-Te)*ct,rt,1),ct}function pi(It,Te){const Me=[];for(let qe=0;qe<It.length;qe++){const nt=It[qe],rt=nt.type;let ct;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")ct=rn(nt.geometry,Te);else if(rt==="MultiLineString"||rt==="Polygon"){ct=[];for(const Tt of nt.geometry)ct.push(rn(Tt,Te))}else if(rt==="MultiPolygon"){ct=[];for(const Tt of nt.geometry){const ut=[];for(const ht of Tt)ut.push(rn(ht,Te));ct.push(ut)}}Me.push(Wr(nt.id,rt,ct,nt.tags))}return Me}function rn(It,Te){const Me=[];Me.size=It.size,It.start!==void 0&&(Me.start=It.start,Me.end=It.end);for(let qe=0;qe<It.length;qe+=3)Me.push(It[qe]+Te,It[qe+1],It[qe+2]);return Me}function Rr(It,Te){if(It.transformed)return It;const Me=1<<It.z,qe=It.x,nt=It.y;for(const rt of It.features){const ct=rt.geometry,Tt=rt.type;if(rt.geometry=[],Tt===1)for(let ut=0;ut<ct.length;ut+=2)rt.geometry.push($r(ct[ut],ct[ut+1],Te,Me,qe,nt));else for(let ut=0;ut<ct.length;ut++){const ht=[];for(let Dt=0;Dt<ct[ut].length;Dt+=2)ht.push($r(ct[ut][Dt],ct[ut][Dt+1],Te,Me,qe,nt));rt.geometry.push(ht)}}return It.transformed=!0,It}function $r(It,Te,Me,qe,nt,rt){return[Math.round(Me*(It*qe-nt)),Math.round(Me*(Te*qe-rt))]}function Nr(It,Te,Me,qe,nt){const rt=Te===nt.maxZoom?0:nt.tolerance/((1<<Te)*nt.extent),ct={features:[],numPoints:0,numSimplified:0,numFeatures:It.length,source:null,x:Me,y:qe,z:Te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Tt of It)ri(ct,Tt,rt,nt);return ct}function ri(It,Te,Me,qe){const nt=Te.geometry,rt=Te.type,ct=[];if(It.minX=Math.min(It.minX,Te.minX),It.minY=Math.min(It.minY,Te.minY),It.maxX=Math.max(It.maxX,Te.maxX),It.maxY=Math.max(It.maxY,Te.maxY),rt==="Point"||rt==="MultiPoint")for(let Tt=0;Tt<nt.length;Tt+=3)ct.push(nt[Tt],nt[Tt+1]),It.numPoints++,It.numSimplified++;else if(rt==="LineString")Ec(ct,nt,It,Me,!1,!1);else if(rt==="MultiLineString"||rt==="Polygon")for(let Tt=0;Tt<nt.length;Tt++)Ec(ct,nt[Tt],It,Me,rt==="Polygon",Tt===0);else if(rt==="MultiPolygon")for(let Tt=0;Tt<nt.length;Tt++){const ut=nt[Tt];for(let ht=0;ht<ut.length;ht++)Ec(ct,ut[ht],It,Me,!0,ht===0)}if(ct.length){let Tt=Te.tags||null;if(rt==="LineString"&&qe.lineMetrics){Tt={};for(const ht in Te.tags)Tt[ht]=Te.tags[ht];Tt.mapbox_clip_start=nt.start/nt.size,Tt.mapbox_clip_end=nt.end/nt.size}const ut={geometry:ct,type:rt==="Polygon"||rt==="MultiPolygon"?3:rt==="LineString"||rt==="MultiLineString"?2:1,tags:Tt};Te.id!==null&&(ut.id=Te.id),It.features.push(ut)}}function Ec(It,Te,Me,qe,nt,rt){const ct=qe*qe;if(qe>0&&Te.size<(nt?ct:qe))return void(Me.numPoints+=Te.length/3);const Tt=[];for(let ut=0;ut<Te.length;ut+=3)(qe===0||Te[ut+2]>ct)&&(Me.numSimplified++,Tt.push(Te[ut],Te[ut+1])),Me.numPoints++;nt&&function(ut,ht){let Dt=0;for(let Mt=0,Kt=ut.length,hn=Kt-2;Mt<Kt;hn=Mt,Mt+=2)Dt+=(ut[Mt]-ut[hn])*(ut[Mt+1]+ut[hn+1]);if(Dt>0===ht)for(let Mt=0,Kt=ut.length;Mt<Kt/2;Mt+=2){const hn=ut[Mt],yn=ut[Mt+1];ut[Mt]=ut[Kt-2-Mt],ut[Mt+1]=ut[Kt-1-Mt],ut[Kt-2-Mt]=hn,ut[Kt-1-Mt]=yn}}(Tt,rt),It.push(Tt)}const Sc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Zr{constructor(Te,Me){const qe=(Me=this.options=function(rt,ct){for(const Tt in ct)rt[Tt]=ct[Tt];return rt}(Object.create(Sc),Me)).debug;if(qe&&console.time("preprocess data"),Me.maxZoom<0||Me.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Me.promoteId&&Me.generateId)throw new Error("promoteId and generateId cannot be used together.");let nt=function(rt,ct){const Tt=[];if(rt.type==="FeatureCollection")for(let ut=0;ut<rt.features.length;ut++)jt(Tt,rt.features[ut],ct,ut);else jt(Tt,rt.type==="Feature"?rt:{geometry:rt},ct);return Tt}(Te,Me);this.tiles={},this.tileCoords=[],qe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Me.indexMaxZoom,Me.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),nt=function(rt,ct){const Tt=ct.buffer/ct.extent;let ut=rt;const ht=Es(rt,1,-1-Tt,Tt,0,-1,2,ct),Dt=Es(rt,1,1-Tt,2+Tt,0,-1,2,ct);return(ht||Dt)&&(ut=Es(rt,1,-Tt,1+Tt,0,-1,2,ct)||[],ht&&(ut=pi(ht,1).concat(ut)),Dt&&(ut=ut.concat(pi(Dt,-1)))),ut}(nt,Me),nt.length&&this.splitTile(nt,0,0,0),qe&&(nt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Te,Me,qe,nt,rt,ct,Tt){const ut=[Te,Me,qe,nt],ht=this.options,Dt=ht.debug;for(;ut.length;){nt=ut.pop(),qe=ut.pop(),Me=ut.pop(),Te=ut.pop();const Mt=1<<Me,Kt=ra(Me,qe,nt);let hn=this.tiles[Kt];if(!hn&&(Dt>1&&console.time("creation"),hn=this.tiles[Kt]=Nr(Te,Me,qe,nt,ht),this.tileCoords.push({z:Me,x:qe,y:nt}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Me,qe,nt,hn.numFeatures,hn.numPoints,hn.numSimplified),console.timeEnd("creation"));const oi=`z${Me}`;this.stats[oi]=(this.stats[oi]||0)+1,this.total++}if(hn.source=Te,rt==null){if(Me===ht.indexMaxZoom||hn.numPoints<=ht.indexMaxPoints)continue}else{if(Me===ht.maxZoom||Me===rt)continue;if(rt!=null){const oi=rt-Me;if(qe!==ct>>oi||nt!==Tt>>oi)continue}}if(hn.source=null,Te.length===0)continue;Dt>1&&console.time("clipping");const yn=.5*ht.buffer/ht.extent,Jn=.5-yn,ir=.5+yn,xr=1+yn;let vr=null,ii=null,si=null,er=null,li=Es(Te,Mt,qe-yn,qe+ir,0,hn.minX,hn.maxX,ht),zr=Es(Te,Mt,qe+Jn,qe+xr,0,hn.minX,hn.maxX,ht);Te=null,li&&(vr=Es(li,Mt,nt-yn,nt+ir,1,hn.minY,hn.maxY,ht),ii=Es(li,Mt,nt+Jn,nt+xr,1,hn.minY,hn.maxY,ht),li=null),zr&&(si=Es(zr,Mt,nt-yn,nt+ir,1,hn.minY,hn.maxY,ht),er=Es(zr,Mt,nt+Jn,nt+xr,1,hn.minY,hn.maxY,ht),zr=null),Dt>1&&console.timeEnd("clipping"),ut.push(vr||[],Me+1,2*qe,2*nt),ut.push(ii||[],Me+1,2*qe,2*nt+1),ut.push(si||[],Me+1,2*qe+1,2*nt),ut.push(er||[],Me+1,2*qe+1,2*nt+1)}}getTile(Te,Me,qe){Te=+Te,Me=+Me,qe=+qe;const nt=this.options,{extent:rt,debug:ct}=nt;if(Te<0||Te>24)return null;const Tt=1<<Te,ut=ra(Te,Me=Me+Tt&Tt-1,qe);if(this.tiles[ut])return Rr(this.tiles[ut],rt);ct>1&&console.log("drilling down to z%d-%d-%d",Te,Me,qe);let ht,Dt=Te,Mt=Me,Kt=qe;for(;!ht&&Dt>0;)Dt--,Mt>>=1,Kt>>=1,ht=this.tiles[ra(Dt,Mt,Kt)];return ht&&ht.source?(ct>1&&(console.log("found parent tile z%d-%d-%d",Dt,Mt,Kt),console.time("drilling down")),this.splitTile(ht.source,Dt,Mt,Kt,Te,Me,qe),ct>1&&console.timeEnd("drilling down"),this.tiles[ut]?Rr(this.tiles[ut],rt):null):null}}function ra(It,Te,Me){return 32*((1<<It)*Me+Te)+It}function Tc(It,Te){const Me=It.tileID.canonical;if(!this._geoJSONIndex)return void Te(null,null);const qe=this._geoJSONIndex.getTile(Me.z,Me.x,Me.y);if(!qe)return void Te(null,null);const nt=new Ae(qe.features);let rt=wn(nt);rt.byteOffset===0&&rt.byteLength===rt.buffer.byteLength||(rt=new Uint8Array(rt)),Te(null,{vectorTile:nt,rawData:rt.buffer})}class za extends oe{constructor(Te,Me,qe,nt,rt,ct){super(Te,Me,qe,nt,Tc,ct),rt&&(this.loadGeoJSON=rt),this._dynamicIndex=new ye}loadData(Te,Me){const qe=Te&&Te.request,nt=qe&&qe.collectResourceTiming;this.loadGeoJSON(Te,(rt,ct)=>{if(rt||!ct)return Me(rt);if(typeof ct!="object")return Me(new Error(`Input data given to '${Te.source}' is not a valid GeoJSON object.`));{try{if(Te.filter){const ut=s.X(Te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ut.result==="error")throw new Error(ut.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));ct.features=ct.features.filter(ht=>ut.value.evaluate({zoom:0},ht))}Te.dynamic?(ct.type==="Feature"&&(ct={type:"FeatureCollection",features:[ct]}),Te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ct.features,this.loaded),Te.cluster&&(ct.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Te.cluster?new br(function({superclusterOptions:ut,clusterProperties:ht}){if(!ht||!ut)return ut;const Dt={},Mt={},Kt={accumulated:null,zoom:0},hn={properties:null},yn=Object.keys(ht);for(const Jn of yn){const[ir,xr]=ht[Jn],vr=s.X(xr),ii=s.X(typeof ir=="string"?[ir,["accumulated"],["get",Jn]]:ir);Dt[Jn]=vr.value,Mt[Jn]=ii.value}return ut.map=Jn=>{hn.properties=Jn;const ir={};for(const xr of yn)ir[xr]=Dt[xr].evaluate(Kt,hn);return ir},ut.reduce=(Jn,ir)=>{hn.properties=ir;for(const xr of yn)Kt.accumulated=Jn[xr],Jn[xr]=Mt[xr].evaluate(Kt,hn)},ut}(Te)).load(ct.features):Te.dynamic?this._dynamicIndex:function(ut,ht){return new Zr(ut,ht)}(ct,Te.geojsonVtOptions)}catch(ut){return Me(ut)}const Tt={};if(nt){const ut=v(qe);ut&&(Tt.resourceTiming={},Tt.resourceTiming[Te.source]=JSON.parse(JSON.stringify(ut)))}Me(null,Tt)}})}reloadTile(Te,Me){const qe=this.loaded;return qe&&qe[Te.uid]?Te.partial?Me(null,void 0):super.reloadTile(Te,Me):this.loadTile(Te,Me)}loadGeoJSON(Te,Me){if(Te.request)s.n(Te.request,Me);else{if(typeof Te.data!="string")return Me(new Error(`Input data given to '${Te.source}' is not a valid GeoJSON object.`));try{return Me(null,JSON.parse(Te.data))}catch{return Me(new Error(`Input data given to '${Te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Te,Me){try{Me(null,this._geoJSONIndex.getClusterExpansionZoom(Te.clusterId))}catch(qe){Me(qe)}}getClusterChildren(Te,Me){try{Me(null,this._geoJSONIndex.getChildren(Te.clusterId))}catch(qe){Me(qe)}}getClusterLeaves(Te,Me){try{Me(null,this._geoJSONIndex.getLeaves(Te.clusterId,Te.limit,Te.offset))}catch(qe){Me(qe)}}}class ia{constructor(Te,Me){this.tileID=new s.aH(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),this.tileZoom=Te.tileZoom,this.uid=Te.uid,this.zoom=Te.zoom,this.canonical=Te.tileID.canonical,this.pixelRatio=Te.pixelRatio,this.tileSize=Te.tileSize,this.source=Te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Te.projection,this.brightness=Me}parse(Te,Me,qe,nt){this.status="parsing";const rt=new s.aH(qe.tileID.overscaledZ,qe.tileID.wrap,qe.tileID.canonical.z,qe.tileID.canonical.x,qe.tileID.canonical.y),ct=[],Tt=Me.familiesBySource[qe.source],ut=new s.e0(rt,qe.promoteId);return ut.bucketLayerIDs=[],ut.is3DTile=!0,s.ei(Te).then(ht=>{if(!ht)return nt(new Error("Could not parse tile"));const Dt=s.ej(ht,1/s.cd(qe.tileID.canonical)),Mt=ht.json.extensionsUsed&&ht.json.extensionsUsed.includes("MAPBOX_mesh_features")||ht.json.asset.extras&&ht.json.asset.extras.MAPBOX_mesh_features,Kt=ht.json.extensionsUsed&&ht.json.extensionsUsed.includes("EXT_meshopt_compression"),hn=new s.aa(this.zoom,{brightness:this.brightness});for(const yn in Tt)for(const Jn of Tt[yn]){const ir=Jn[0];ut.bucketLayerIDs.push(Jn.map(vr=>s.C(vr.id,vr.scope))),ir.recalculate(hn,[]);const xr=new s.ek(Jn,Dt,rt,Mt,Kt,this.brightness,ut);Mt||(xr.needsUpload=!0),ct.push(xr),xr.evaluate(ir)}this.status="done",nt(null,{buckets:ct,featureIndex:ut,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ht=>nt(new Error(ht.message)))}}class sc{constructor(Te,Me,qe,nt,rt,ct){this.actor=Te,this.layerIndex=Me,this.availableImages=qe,this.brightness=ct,this.loading={},this.loaded={}}loadTile(Te,Me){const qe=Te.uid,nt=this.loading[qe]=new ia(Te,this.brightness);s.bj(Te.request,(rt,ct)=>{const Tt=!this.loading[qe];return delete this.loading[qe],Tt||rt?(nt.status="done",Tt||(this.loaded[qe]=nt),Me(rt)):ct&&ct.byteLength!==0?void nt.parse(ct,this.layerIndex,Te,(ut,ht)=>{nt.status="done",this.loaded=this.loaded||{},this.loaded[qe]=nt,ut||!ht?Me(ut):Me(null,ht)}):(nt.status="done",this.loaded[qe]=nt,Me())})}reloadTile(Te,Me){const qe=this.loaded,nt=Te.uid;if(qe&&qe[nt]){const rt=qe[nt];rt.projection=Te.projection,rt.brightness=Te.brightness;const ct=(Tt,ut)=>{rt.reloadCallback&&(delete rt.reloadCallback,this.loadTile(Te,Me)),Me(Tt,ut)};rt.status==="parsing"?rt.reloadCallback=ct:rt.status==="done"&&this.loadTile(Te,Me)}}abortTile(Te,Me){const qe=Te.uid;this.loading[qe]&&delete this.loading[qe],Me()}removeTile(Te,Me){const qe=this.loaded,nt=Te.uid;qe&&qe[nt]&&delete qe[nt],Me()}}class io{constructor(Te){this.self=Te,this.actor=new s.el(Te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.projections={},this.defaultProjection=s.bP({name:"mercator"}),this.workerSourceTypes={vector:oe,geojson:za,"raster-dem":ae,"raster-array":pe,"batched-model":sc},this.workerSources={},this.self.registerWorkerSource=(Me,qe)=>{if(this.workerSourceTypes[Me])throw new Error(`Worker source with name "${Me}" already registered.`);this.workerSourceTypes[Me]=qe},this.self.registerRTLTextPlugin=Me=>{if(s.em.isParsed())throw new Error("RTL text plugin already registered.");s.em.applyArabicShaping=Me.applyArabicShaping,s.em.processBidirectionalText=Me.processBidirectionalText,s.em.processStyledBidirectionalText=Me.processStyledBidirectionalText}}clearCaches(Te,Me,qe){delete this.layerIndexes[Te],delete this.availableImages[Te],delete this.workerSources[Te],qe()}checkIfReady(Te,Me,qe){qe()}setReferrer(Te,Me){this.referrer=Me}spriteLoaded(Te,{scope:Me,isLoaded:qe}){if(this.isSpriteLoaded[Te]||(this.isSpriteLoaded[Te]={}),this.isSpriteLoaded[Te][Me]=qe,this.workerSources[Te]&&this.workerSources[Te][Me])for(const nt in this.workerSources[Te][Me]){const rt=this.workerSources[Te][Me][nt];for(const ct in rt){const Tt=rt[ct];Tt instanceof oe&&(Tt.isSpriteLoaded=qe,Tt.fire(new s.A("isSpriteLoaded")))}}}setImages(Te,{scope:Me,images:qe},nt){if(this.availableImages[Te]||(this.availableImages[Te]={}),this.availableImages[Te][Me]=qe,this.workerSources[Te]&&this.workerSources[Te][Me]){for(const rt in this.workerSources[Te][Me]){const ct=this.workerSources[Te][Me][rt];for(const Tt in ct)ct[Tt].availableImages=qe}nt()}else nt()}setProjection(Te,Me){this.projections[Te]=s.bP(Me)}setBrightness(Te,Me,qe){this.brightness=Me,qe()}setLayers(Te,Me,qe){this.getLayerIndex(Te,Me.scope).replace(Me.layers,Me.options),qe()}updateLayers(Te,Me,qe){this.getLayerIndex(Te,Me.scope).update(Me.layers,Me.removedIds,Me.options),qe()}loadTile(Te,Me,qe){Me.projection=this.projections[Te]||this.defaultProjection,this.getWorkerSource(Te,Me.type,Me.source,Me.scope).loadTile(Me,qe)}decodeRasterArray(Te,Me,qe){this.getWorkerSource(Te,Me.type,Me.source,Me.scope).decodeRasterArray(Me,qe)}reloadTile(Te,Me,qe){Me.projection=this.projections[Te]||this.defaultProjection,this.getWorkerSource(Te,Me.type,Me.source,Me.scope).reloadTile(Me,qe)}abortTile(Te,Me,qe){this.getWorkerSource(Te,Me.type,Me.source,Me.scope).abortTile(Me,qe)}removeTile(Te,Me,qe){this.getWorkerSource(Te,Me.type,Me.source,Me.scope).removeTile(Me,qe)}removeSource(Te,Me,qe){if(!(this.workerSources[Te]&&this.workerSources[Te][Me.scope]&&this.workerSources[Te][Me.scope][Me.type]&&this.workerSources[Te][Me.scope][Me.type][Me.source]))return;const nt=this.workerSources[Te][Me.scope][Me.type][Me.source];delete this.workerSources[Te][Me.scope][Me.type][Me.source],nt.removeSource!==void 0?nt.removeSource(Me,qe):qe()}loadWorkerSource(Te,Me,qe){try{this.self.importScripts(Me.url),qe()}catch(nt){qe(nt.toString())}}syncRTLPluginState(Te,Me,qe){try{s.em.setState(Me);const nt=s.em.getPluginURL();if(s.em.isLoaded()&&!s.em.isParsed()&&nt!=null){this.self.importScripts(nt);const rt=s.em.isParsed();qe(rt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${nt}`),rt)}}catch(nt){qe(nt.toString())}}setDracoUrl(Te,Me){this.dracoUrl=Me}getAvailableImages(Te,Me){this.availableImages[Te]||(this.availableImages[Te]={});let qe=this.availableImages[Te][Me];return qe||(qe=[]),qe}getLayerIndex(Te,Me){this.layerIndexes[Te]||(this.layerIndexes[Te]={});let qe=this.layerIndexes[Te][Me];return qe||(qe=this.layerIndexes[Te][Me]=new F,qe.scope=Me),qe}getWorkerSource(Te,Me,qe,nt){const rt=this.workerSources;return rt[Te]||(rt[Te]={}),rt[Te][nt]||(rt[Te][nt]={}),rt[Te][nt][Me]||(rt[Te][nt][Me]={}),this.isSpriteLoaded[Te]||(this.isSpriteLoaded[Te]={}),rt[Te][nt][Me][qe]||(rt[Te][nt][Me][qe]=new this.workerSourceTypes[Me]({send:(ct,Tt,ut,ht,Dt,Mt)=>{this.actor.send(ct,Tt,ut,Te,Dt,Mt)},scheduler:this.actor.scheduler},this.getLayerIndex(Te,nt),this.getAvailableImages(Te,nt),this.isSpriteLoaded[Te][nt],void 0,this.brightness)),rt[Te][nt][Me][qe]}rasterizeImages(Te,Me,qe){const nt=new Map;for(const[rt,{image:ct,imageVariant:Tt}]of Me.tasks.entries()){const ut=this.imageRasterizer.rasterize(Tt,ct,Me.scope,Te);nt.set(rt,ut)}qe(void 0,nt)}removeRasterizedImages(Te,Me,qe){this.imageRasterizer.removeImagesFromCacheByIds(Me.imageIds,Me.scope,Te),qe()}enforceCacheSizeLimit(Te,Me){s.en(Me)}getWorkerPerformanceMetrics(Te,Me,qe){qe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new io(self)),io}),l(["./shared"],function(s){var v="3.11.1";const w={create:"create",load:"load",fullLoad:"fullLoad"},A={mark(y){performance.mark(y)},measure(y,a,h){performance.measure(y,a,h)}};function F(y){const a=y.name.split("?")[0];return s.a(a)&&a.includes("mapbox-gl.js")?"javascript":s.a(a)&&a.includes("mapbox-gl.css")?"css":s.b(a)?"fontRange":s.c(a)?"sprite":s.i(a)?"style":s.d(a)?"tilejson":"other"}var W,K={},Q=function(){if(W)return K;function y(_){return!a(_)}function a(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,M,j=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(j);try{M=new Worker(H),C=!0}catch{C=!1}return M&&M.terminate(),URL.revokeObjectURL(H),C}()?function(){var C=document.createElement("canvas");C.width=C.height=1;var M=C.getContext("2d");if(!M)return!1;var j=M.getImageData(0,0,1,1);return j&&j.width===C.width}()?(h[E=_&&_.failIfMajorPerformanceCaveat]===void 0&&(h[E]=function(C){var M,j=function(H){var G=document.createElement("canvas"),Y=Object.create(y.webGLContextAttributes);return Y.failIfMajorPerformanceCaveat=H,G.getContext("webgl2",Y)}(C);if(!j)return!1;try{M=j.createShader(j.VERTEX_SHADER)}catch{return!1}return!(!M||j.isContextLost())&&(j.shaderSource(M,"void main() {}"),j.compileShader(M),j.getShaderParameter(M,j.COMPILE_STATUS)===!0)}(E)),h[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var E}W=1,K.supported=y,K.notSupportedReason=a;var h={};return y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},K}();function Z(y,a,h){const _=document.createElement(y);return a!=null&&(_.className=a),h&&h.appendChild(_),_}function oe(y,a,h){const _=document.createElementNS("http://www.w3.org/2000/svg",y);for(const E of Object.keys(a))_.setAttributeNS(null,E,String(a[E]));return h&&h.appendChild(_),_}const ae=typeof document<"u"?document.documentElement&&document.documentElement.style:null,me=ae&&ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let pe;function _e(){ae&&me&&(pe=ae[me],ae[me]="none")}function De(){ae&&me&&(ae[me]=pe)}function Ae(y){y.preventDefault(),y.stopPropagation(),window.removeEventListener("click",Ae,!0)}function re(){window.addEventListener("click",Ae,!0),window.setTimeout(()=>{window.removeEventListener("click",Ae,!0)},0)}function fe(y,a){const h=y.getBoundingClientRect();return Ie(y,h,a)}function ye(y,a){const h=y.getBoundingClientRect(),_=[];for(let E=0;E<a.length;E++)_.push(Ie(y,h,a[E]));return _}function ue(y){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&y.button===2&&y.ctrlKey?0:y.button}function Ie(y,a,h){const _=y.offsetWidth===a.width?1:y.offsetWidth/a.width;return new s.P((h.clientX-a.left)*_,(h.clientY-a.top)*_)}const Oe="01",ze="NO_ACCESS_TOKEN";class ft{constructor(a,h,_){this._transformRequestFn=a,this._customAccessToken=h,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const a=function(){let h="";for(let _=0;_<10;_++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Oe,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,h){return this._transformRequestFn&&this._transformRequestFn(a,h)||{url:a}}normalizeStyleURL(a,h){if(!s.f(a))return a;const _=bt(a);return _.params.push(`sdk=js-${v}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeGlyphsURL(a,h){if(!s.f(a))return a;const _=bt(a);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeModelURL(a,h){if(!s.f(a))return a;const _=bt(a);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeSourceURL(a,h,_,E){if(!s.f(a))return a;const C=bt(a);return C.path=`/v4/${C.authority}.json`,C.params.push("secure"),_&&C.params.push(`language=${_}`),E&&C.params.push(`worldview=${E}`),this._makeAPIURL(C,this._customAccessToken||h)}normalizeIconsetURL(a,h){const _=bt(a);return s.f(a)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||h)):Nt(_)}normalizeSpriteURL(a,h,_,E){const C=bt(a);return s.f(a)?(C.path=`/styles/v1${C.path}/sprite${h}${_}`,this._makeAPIURL(C,this._customAccessToken||E)):(C.path+=`${h}${_}`,Nt(C))}normalizeTileURL(a,h,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!s.f(a))return a;const E=bt(a);E.path=E.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||_&&E.authority!=="raster"&&_===512?"@2x":""}${s.m.supported?".webp":"$1"}`),E.authority==="raster"?E.path=`/${s.e.RASTER_URL_PREFIX}${E.path}`:E.authority==="rasterarrays"?E.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${E.path}`:E.authority==="3dtiles"?E.path=`/${s.e.TILES3D_URL_PREFIX}${E.path}`:(E.path=E.path.replace(/^.+\/v4\//,"/"),E.path=`/${s.e.TILE_URL_VERSION}${E.path}`);const C=this._customAccessToken||function(M){for(const j of M){const H=j.match(/^access_token=(.*)$/);if(H)return H[1]}return null}(E.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&C&&this._skuToken&&E.params.push(`sku=${this._skuToken}`),this._makeAPIURL(E,C)}canonicalizeTileURL(a,h){const _=bt(a);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return a;let E="mapbox://";_.path.match(/^\/raster\/v1\//)?E+=`raster/${_.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?E+=`rasterarrays/${_.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:E+=`tiles/${_.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let C=_.params;return h&&(C=C.filter(M=>!M.match(/^access_token=/))),C.length&&(E+=`?${C.join("&")}`),E}canonicalizeTileset(a,h){const _=!!h&&s.f(h),E=[];for(const C of a.tiles||[])s.h(C)?E.push(this.canonicalizeTileURL(C,_)):E.push(C);return E}_makeAPIURL(a,h){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",E=bt(s.e.API_URL);if(a.protocol=E.protocol,a.authority=E.authority,a.protocol==="http"){const C=a.params.indexOf("secure");C>=0&&a.params.splice(C,1)}if(E.path!=="/"&&(a.path=`${E.path}${a.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Nt(a);if(h=h||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return a.params=a.params.filter(C=>C.indexOf("access_token")===-1),a.params.push(`access_token=${h||""}`),Nt(a)}}const He=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bt(y){const a=y.match(He);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Nt(y){const a=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${a}`}const wt="mapbox.eventData";function it(y){if(!y)return null;const a=y.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(s.j(a[1]))}catch{return null}}class nn{constructor(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const h=it(s.e.ACCESS_TOKEN);let _="";return _=h&&h.u?s.k(h.u):s.e.ACCESS_TOKEN||"",a?`${wt}.${a}:${_}`:`${wt}:${_}`}fetchEventData(){const a=s.s("localStorage"),h=this.getStorageKey(),_=this.getStorageKey("uuid");if(a)try{const E=localStorage.getItem(h);E&&(this.eventData=JSON.parse(E));const C=localStorage.getItem(_);C&&(this.anonId=C)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const a=s.s("localStorage"),h=this.getStorageKey(),_=this.getStorageKey("uuid"),E=this.anonId;if(a&&E)try{localStorage.setItem(_,E),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,h,_,E){if(!s.e.EVENTS_URL)return;const C=bt(s.e.EVENTS_URL);C.params.push(`access_token=${E||s.e.ACCESS_TOKEN||""}`);const M={event:this.type,created:new Date(a).toISOString()},j=h?s.l(M,h):M,H={url:Nt(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([j])};this.pendingRequest=s.p(H,G=>{this.pendingRequest=null,_(G),this.saveEventData(),this.processRequests(E)})}queueRequest(a,h){this.queue.push(a),this.processRequests(h)}}const In=new class extends nn{constructor(y){super("appUserTurnstile"),this._customAccessToken=y}postTurnstileEvent(y,a){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(y)&&y.some(h=>s.f(h)||s.h(h))&&this.queueRequest(Date.now(),a)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=it(s.e.ACCESS_TOKEN),h=a?a.u:s.e.ACCESS_TOKEN;let _=h!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),_=!0);const E=this.queue.shift();if(this.eventData.lastSuccess){const C=new Date(this.eventData.lastSuccess),M=new Date(E),j=(E-this.eventData.lastSuccess)/864e5;_=_||j>=1||j<-1||C.getDate()!==M.getDate()}else _=!0;_?this.postEvent(E,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Oe,"enabled.telemetry":!1,userId:this.anonId},C=>{C||(this.eventData.lastSuccess=E,this.eventData.tokenU=h)},y):this.processRequests()}},wn=In.postTurnstileEvent.bind(In),Xt=new class extends nn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(y,a,h,_){this.skuToken=a,this.errorCb=_,s.e.EVENTS_URL&&(h||s.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},h):this.errorCb(new Error(ze)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:h}=this.queue.shift();a&&this.success[a]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Oe,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):a&&(this.success[a]=!0)},y))}remove(){this.errorCb=null}},On=Xt.postMapLoadEvent.bind(Xt),cr=new class extends nn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(y){let a=this.mapInstanceIdMap.get(y);return a||(a=s.u(),this.mapInstanceIdMap.set(y,a)),a}getEventId(y){const a=this.eventIdPerMapInstanceMap.get(y)||0;return this.eventIdPerMapInstanceMap.set(y,a+1),a}postStyleLoadEvent(y,a){const{map:h,style:_,importedStyles:E}=a;if(!s.e.EVENTS_URL||!y&&!s.e.ACCESS_TOKEN)return;const C=this.getMapInstanceId(h),M={mapInstanceId:C,eventId:this.getEventId(C),style:_};E.length&&(M.importedStyles=E),this.queueRequest({timestamp:Date.now(),payload:M},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:h}=this.queue.shift();this.postEvent(a,h,()=>{},y)}},En=cr.postStyleLoadEvent.bind(cr),fn=new class extends nn{constructor(){super("gljs.performance")}postPerformanceEvent(y,a){s.e.EVENTS_URL&&(y||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,performanceData:h}=this.queue.shift(),_=function(E){const C=performance.getEntriesByType("resource"),M=performance.getEntriesByType("mark"),j=function(he){const we={};if(he){for(const xe in he)if(xe!=="other")for(const Ee of he[xe]){const Ce=`${xe}ResolveRangeMin`,je=`${xe}ResolveRangeMax`,$e=`${xe}RequestCount`,We=`${xe}RequestCachedCount`;we[Ce]=Math.min(we[Ce]||1/0,Ee.startTime),we[je]=Math.max(we[je]||-1/0,Ee.responseEnd);const Ze=Ye=>{we[Ye]===void 0&&(we[Ye]=0),++we[Ye]};Ee.transferSize!==void 0&&Ee.transferSize===0&&Ze(We),Ze($e)}}return we}(function(he,we){const xe={};if(he)for(const Ee of he){const Ce=we(Ee);xe[Ce]===void 0&&(xe[Ce]=[]),xe[Ce].push(Ee)}return xe}(C,F)),H=window.devicePixelRatio,G=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Y=G?G.effectiveType:void 0,ne={counters:[],metadata:[],attributes:[]},ee=(he,we,xe)=>{xe!=null&&he.push({name:we,value:xe.toString()})};for(const he in j)ee(ne.counters,he,j[he]);if(E.interactionRange[0]!==1/0&&E.interactionRange[1]!==-1/0&&(ee(ne.counters,"interactionRangeMin",E.interactionRange[0]),ee(ne.counters,"interactionRangeMax",E.interactionRange[1])),M)for(const he of Object.keys(w)){const we=w[he],xe=M.find(Ee=>Ee.name===we);xe&&ee(ne.counters,we,xe.startTime)}return ee(ne.counters,"visibilityHidden",E.visibilityHidden),ee(ne.attributes,"style",function(he){if(he)for(const we of he){const xe=we.name.split("?")[0];if(s.i(xe)){const Ee=xe.split("/").slice(-2);if(Ee.length===2)return`mapbox://styles/${Ee[0]}/${Ee[1]}`}}}(C)),ee(ne.attributes,"terrainEnabled",E.terrainEnabled?"true":"false"),ee(ne.attributes,"fogEnabled",E.fogEnabled?"true":"false"),ee(ne.attributes,"projection",E.projection),ee(ne.attributes,"zoom",E.zoom),ee(ne.metadata,"devicePixelRatio",H),ee(ne.metadata,"connectionEffectiveType",Y),ee(ne.metadata,"navigatorUserAgent",navigator.userAgent),ee(ne.metadata,"screenWidth",window.screen.width),ee(ne.metadata,"screenHeight",window.screen.height),ee(ne.metadata,"windowWidth",window.innerWidth),ee(ne.metadata,"windowHeight",window.innerHeight),ee(ne.metadata,"mapWidth",E.width/H),ee(ne.metadata,"mapHeight",E.height/H),ee(ne.metadata,"webglRenderer",E.renderer),ee(ne.metadata,"webglVendor",E.vendor),ee(ne.metadata,"sdkVersion",v),ee(ne.metadata,"sdkIdentifier","mapbox-gl-js"),ne}(h);for(const E of _.metadata);for(const E of _.counters);for(const E of _.attributes);this.postEvent(a,_,()=>{},y)}},ur=fn.postPerformanceEvent.bind(fn),br=new class extends nn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(y,a,h,_){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const E=bt(s.e.API_URL+s.e.SESSION_PATH);E.params.push(`sku=${a||""}`),E.params.push(`access_token=${_||s.e.ACCESS_TOKEN||""}`);const C={url:Nt(E),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(C,M=>{this.pendingRequest=null,h(M),this.saveEventData(),this.processRequests(_)})}getSessionAPI(y,a,h,_){this.skuToken=a,this.errorCb=_,s.e.SESSION_PATH&&s.e.API_URL&&(h||s.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},h):this.errorCb(new Error(ze)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:h}=this.queue.shift();a&&this.success[a]||this.getSession(h,this.skuToken,_=>{_?this.errorCb(_):a&&(this.success[a]=!0)},y)}remove(){this.errorCb=null}},Pe=br.getSessionAPI.bind(br),jn=new Set;function rr(y,a){a?jn.add(y):jn.delete(y)}class Yn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,h){this._updatedSourceCaches[a]=h,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const h=a.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(a.id),this.setDirty()}removeLayer(a){const h=a.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][a.id]=a,this._updatedLayers[h].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const h in this._updatedLayers)a[h]=a[h]||{},a[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)a[h]=a[h]||{},a[h].removedIds=Object.keys(this._removedLayers[h]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(a){return this._updatedImages[a]?Array.from(this._updatedImages[a].values()):[]}updateImage(a,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(s.I.toString(a)),this.setDirty()}resetUpdatedImages(a){this._updatedImages[a]&&this._updatedImages[a].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ot(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class Sr extends s.E{constructor(a){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=a,a!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(a){this.loaded.set(a,!1),this.imageProviders.set(a,new Map),this.images.set(a,new Map),this.updatedImages.set(a,new Set),this.callbackDispatchedThisFrame.set(a,new Set),this.patterns.set(a,new Map),this.atlasImage.set(a,new s.r({width:1,height:1}))}removeScope(a){this.loaded.delete(a),this.imageProviders.delete(a),this.images.delete(a),this.updatedImages.delete(a),this.callbackDispatchedThisFrame.delete(a),this.patterns.delete(a),this.atlasImage.delete(a);const h=this.atlasTexture.get(a);h&&(h.destroy(),this.atlasTexture.delete(a))}addImageProvider(a,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(a.id,a)}removeImageProvider(a,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(a)}getPendingImageProviders(){const a=[];for(const h of this.imageProviders.values())for(const _ of h.values())_.hasPendingRequests()&&a.push(_);return a}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const a of this.loaded.keys())if(!this.loaded.get(a))return!1;return!0}setLoaded(a,h){if(this.loaded.get(h)!==a&&(this.loaded.set(h,a),a)){for(const{ids:_,callback:E}of this.requestors)this._notify(_,h,E);this.requestors=[]}}hasImage(a,h){return!!this.getImage(a,h)}getImage(a,h){return this.images.get(h).get(a.toString())}addImage(a,h,_){this._validate(a,_)&&this.images.get(h).set(a.toString(),_)}_validate(a,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new s.z(new Error(`Image "${a.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new s.z(new Error(`Image "${a.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new s.z(new Error(`Image "${a.name}" has invalid "content" value`))),_=!1),_}_validateStretch(a,h){if(!a)return!0;let _=0;for(const E of a){if(E[0]<_||E[1]<E[0]||h<E[1])return!1;_=E[1]}return!0}_validateContent(a,h){return a?a.length!==4||!h.usvg&&(a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3])?!1:!(a[2]<a[0]||a[3]<a[1]):!0}updateImage(a,h,_){const E=this.images.get(h).get(a.toString());_.version=E.version+1,this.images.get(h).set(a.toString(),_),this.updatedImages.get(h).add(a),this.removeFromImageRasterizerCache(a,h)}clearUpdatedImages(a){this.updatedImages.get(a).clear()}removeFromImageRasterizerCache(a,h){if(this.spriteFormat!=="raster")if(s.t()){const _={imageIds:[a],scope:h};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",_)}else this.imageRasterizer.removeImagesFromCacheByIds([a],h)}removeImage(a,h){const _=this.images.get(h),E=_.get(a.toString());_.delete(a.toString()),this.patterns.get(h).delete(a.toString()),this.removeFromImageRasterizerCache(a,h),E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(a){return Array.from(this.images.get(a).keys()).map(h=>s.I.from(h))}getImages(a,h,_){const E=[],C=[],M=this.imageProviders.get(h);for(const Y of a){if(!Y.iconsetId){E.push(Y);continue}const ne=M.get(Y.iconsetId);ne&&(this.getImage(Y,h)?C.push(Y):ne.addPendingRequest(Y))}if(E.length===0)return void this._notify(C,h,_);let j=!0;const H=!!this.loaded.get(h),G=this.images.get(h);if(!H)for(const Y of E)G.has(Y.toString())||(j=!1);H||j?this._notify(E,h,_):this.requestors.push({ids:E,scope:h,callback:_})}rasterizeImages({scope:a,tasks:h},_){const E=new Map;for(const[C,M]of h.entries()){const j=this.getImage(M.id,a);j&&E.set(C,{image:j,imageVariant:M})}this._rasterizeImages(a,E,_)}_rasterizeImages(a,h,_){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:h,scope:a},_);else{const E=new Map;for(const[C,{image:M,imageVariant:j}]of h.entries())E.set(C,this.imageRasterizer.rasterize(j,M,a,0));_(void 0,E)}}getUpdatedImages(a){return this.updatedImages.get(a)||new Set}_notify(a,h,_){const E=this.images.get(h),C=new Map;for(const M of a){const j=E.get(M.toString());if(!j){if(M.iconsetId)continue;s.w(`Image "${M.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new s.A("styleimagemissing",{id:M.name}));continue}const H={data:j.usvg?null:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,usvg:j.usvg,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:!!(j.userImage&&j.userImage.render)};j.usvg&&Object.assign(H,{width:j.icon.usvg_tree.width,height:j.icon.usvg_tree.height}),C.set(s.I.toString(M),H)}_(null,C)}getPixelSize(a){const{width:h,height:_}=this.atlasImage.get(a);return{width:h,height:_}}getPattern(a,h,_){const E=a.toString(),C=this.patterns.get(h),M=C.get(E),j=this.getImage(a,h);if(!j)return null;if(M){if(M.position.version===j.version)return M.position;M.position.version=j.version}else{if(j.usvg&&!j.data){const H=this.getPatternInFlightId(E,h);if(this.patternsInFlight.has(H))return null;this.patternsInFlight.add(H);const G=new s.B(a).scaleSelf(s.q.devicePixelRatio),Y=new Map([[G.toString(),{image:j,imageVariant:G}]]);return this._rasterizeImages(h,Y,(ne,ee)=>this.storePatternImage(G,h,j,_,ee)),null}this.storePattern(a,h,j)}return this._updatePatternAtlas(h,_),C.get(E).position}getPatternInFlightId(a,h){return s.C(a,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(a,h,_,E,C){const M=a.toString(),j=C?C.get(M):void 0;j&&(_.data=j,this.storePattern(a.id,h,_),this._updatePatternAtlas(h,E),this.patternsInFlight.delete(this.getPatternInFlightId(a.id.toString(),h)))}storePattern(a,h,_){const E={w:_.data.width+2*s.F,h:_.data.height+2*s.F,x:0,y:0},C=new s.G(E,_,s.F);this.patterns.get(h).set(a.toString(),{bin:E,position:C})}bind(a,h){const _=a.gl;let E=this.atlasTexture.get(h);E?this.dirty&&(E.update(this.atlasImage.get(h)),this.dirty=!1):(E=new s.T(a,this.atlasImage.get(h),_.RGBA8),this.atlasTexture.set(h,E)),E.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(a,h){const _=this.patterns.get(a),E=Array.from(_.values()).map(({bin:G})=>G),{w:C,h:M}=s.H(E),j=this.atlasImage.get(a);j.resize({width:C||1,height:M||1});const H=this.images.get(a);for(const[G,{bin:Y,position:ne}]of _.entries()){let ee=ne.padding;const he=Y.x+ee,we=Y.y+ee,xe=H.get(G).data,Ee=xe.width,Ce=xe.height;ee=ee>1?ee-1:ee,s.r.copy(xe,j,{x:0,y:0},{x:he,y:we},{width:Ee,height:Ce},h),s.r.copy(xe,j,{x:0,y:Ce-ee},{x:he,y:we-ee},{width:Ee,height:ee},h),s.r.copy(xe,j,{x:0,y:0},{x:he,y:we+Ce},{width:Ee,height:ee},h),s.r.copy(xe,j,{x:Ee-ee,y:0},{x:he-ee,y:we},{width:ee,height:Ce},h),s.r.copy(xe,j,{x:0,y:0},{x:he+Ee,y:we},{width:ee,height:Ce},h),s.r.copy(xe,j,{x:Ee-ee,y:Ce-ee},{x:he-ee,y:we-ee},{width:ee,height:ee},h),s.r.copy(xe,j,{x:0,y:Ce-ee},{x:he+Ee,y:we-ee},{width:ee,height:ee},h),s.r.copy(xe,j,{x:0,y:0},{x:he+Ee,y:we+Ce},{width:ee,height:ee},h),s.r.copy(xe,j,{x:Ee-ee,y:0},{x:he-ee,y:we+Ce},{width:ee,height:ee},h)}this.dirty=!0}beginFrame(){for(const a of this.images.keys())this.callbackDispatchedThisFrame.set(a,new Set)}dispatchRenderCallbacks(a,h){const _=this.images.get(h);for(const E of a){if(this.callbackDispatchedThisFrame.get(h).has(E.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(E.toString());const C=_.get(E.toString());Ot(C)&&this.updateImage(E,h,C)}}}function fi(y){const a=y.key,h=y.value,_=y.valueSpec||{},E=y.objectElementValidators||{},C=y.style,M=y.styleSpec;let j=[];const H=s.K(h);if(H!=="object")return[new s.V(a,h,`object expected, ${H} found`)];for(const G in h){const Y=G.split(".")[0];let ne;E[Y]?ne=E[Y]:_[Y]?ne=ri:E["*"]?ne=E["*"]:_["*"]&&(ne=ri),ne?j=j.concat(ne({key:(a&&`${a}.`)+G,value:h[G],valueSpec:_[Y]||_["*"],style:C,styleSpec:M,object:h,objectKey:G},h)):j.push(new s.J(a,h[G],`unknown property "${G}"`))}for(const G in _)E[G]||_[G].required&&_[G].default===void 0&&h[G]===void 0&&j.push(new s.V(a,h,`missing required property "${G}"`));return j}function Wr(y){const a=y.value,h=y.valueSpec,_=y.style,E=y.styleSpec,C=y.key,M=y.arrayElementValidator||ri;if(s.K(a)!=="array")return[new s.V(C,a,`array expected, ${s.K(a)} found`)];if(h.length&&a.length!==h.length)return[new s.V(C,a,`array length ${h.length} expected, length ${a.length} found`)];if(h["min-length"]&&a.length<h["min-length"])return[new s.V(C,a,`array length at least ${h["min-length"]} expected, length ${a.length} found`)];let j={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};E.$version<7&&(j.function=h.function),s.K(h.value)==="object"&&(j=h.value);let H=[];for(let G=0;G<a.length;G++)H=H.concat(M({array:a,arrayIndex:G,value:a[G],valueSpec:j,style:_,styleSpec:E,key:`${C}[${G}]`},!0));return H}function Mn(y){const a=y.key,h=y.value,_=y.valueSpec;let E=s.K(h);if(E==="number"&&h!=h&&(E="NaN"),E!=="number")return[new s.V(a,h,`number expected, ${E} found`)];if("minimum"in _){let C=_.minimum;if(s.K(_.minimum)==="array"&&(C=_.minimum[y.arrayIndex]),h<C)return[new s.V(a,h,`${h} is less than the minimum value ${C}`)]}if("maximum"in _){let C=_.maximum;if(s.K(_.maximum)==="array"&&(C=_.maximum[y.arrayIndex]),h>C)return[new s.V(a,h,`${h} is greater than the maximum value ${C}`)]}return[]}function jt(y){const a=y.valueSpec,h=s.M(y.value.type);let _,E,C,M={};const j=h!=="categorical"&&y.value.property===void 0,H=!j,G=s.K(y.value.stops)==="array"&&s.K(y.value.stops[0])==="array"&&s.K(y.value.stops[0][0])==="object",Y=fi({key:y.key,value:y.value,valueSpec:y.styleSpec.function,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{stops:function(he){if(h==="identity")return[new s.V(he.key,he.value,'identity function may not have a "stops" property')];let we=[];const xe=he.value;return we=we.concat(Wr({key:he.key,value:xe,valueSpec:he.valueSpec,style:he.style,styleSpec:he.styleSpec,arrayElementValidator:ne})),s.K(xe)==="array"&&xe.length===0&&we.push(new s.V(he.key,xe,"array must have at least one stop")),we},default:function(he){return ri({key:he.key,value:he.value,valueSpec:a,style:he.style,styleSpec:he.styleSpec})}}});return h==="identity"&&j&&Y.push(new s.V(y.key,y.value,'missing required property "property"')),h==="identity"||y.value.stops||Y.push(new s.V(y.key,y.value,'missing required property "stops"')),h==="exponential"&&y.valueSpec.expression&&!s.N(y.valueSpec)&&Y.push(new s.V(y.key,y.value,"exponential functions not supported")),y.styleSpec.$version>=8&&(H&&!s.O(y.valueSpec)?Y.push(new s.V(y.key,y.value,"property functions not supported")):j&&!s.Q(y.valueSpec)&&Y.push(new s.V(y.key,y.value,"zoom functions not supported"))),h!=="categorical"&&!G||y.value.property!==void 0||Y.push(new s.V(y.key,y.value,'"property" property is required')),Y;function ne(he){let we=[];const xe=he.value,Ee=he.key;if(s.K(xe)!=="array")return[new s.V(Ee,xe,`array expected, ${s.K(xe)} found`)];if(xe.length!==2)return[new s.V(Ee,xe,`array length 2 expected, length ${xe.length} found`)];if(G){if(s.K(xe[0])!=="object")return[new s.V(Ee,xe,`object expected, ${s.K(xe[0])} found`)];if(xe[0].zoom===void 0)return[new s.V(Ee,xe,"object stop key must have zoom")];if(xe[0].value===void 0)return[new s.V(Ee,xe,"object stop key must have value")];const Ce=s.M(xe[0].zoom);if(typeof Ce!="number")return[new s.V(Ee,xe[0].zoom,"stop zoom values must be numbers")];if(C&&C>Ce)return[new s.V(Ee,xe[0].zoom,"stop zoom values must appear in ascending order")];Ce!==C&&(C=Ce,E=void 0,M={}),we=we.concat(fi({key:`${Ee}[0]`,value:xe[0],valueSpec:{zoom:{}},style:he.style,styleSpec:he.styleSpec,objectElementValidators:{zoom:Mn,value:ee}}))}else we=we.concat(ee({key:`${Ee}[0]`,value:xe[0],style:he.style,styleSpec:he.styleSpec},xe));return s.S(s.U(xe[1]))?we.concat([new s.V(`${Ee}[1]`,xe[1],"expressions are not allowed in function stops.")]):we.concat(ri({key:`${Ee}[1]`,value:xe[1],valueSpec:a,style:he.style,styleSpec:he.styleSpec}))}function ee(he,we){const xe=s.K(he.value),Ee=s.M(he.value),Ce=he.value!==null?he.value:we;if(_){if(xe!==_)return[new s.V(he.key,Ce,`${xe} stop domain type must match previous stop domain type ${_}`)]}else _=xe;if(xe!=="number"&&xe!=="string"&&xe!=="boolean"&&typeof Ee!="number"&&typeof Ee!="string"&&typeof Ee!="boolean")return[new s.V(he.key,Ce,"stop domain value must be a number, string, or boolean")];if(xe!=="number"&&h!=="categorical"){let je=`number expected, ${xe} found`;return s.O(a)&&h===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(he.key,Ce,je)]}return h!=="categorical"||xe!=="number"||typeof Ee=="number"&&isFinite(Ee)&&Math.floor(Ee)===Ee?h!=="categorical"&&xe==="number"&&typeof Ee=="number"&&typeof E=="number"&&E!==void 0&&Ee<E?[new s.V(he.key,Ce,"stop domain values must appear in ascending order")]:(E=Ee,h==="categorical"&&Ee in M?[new s.V(he.key,Ce,"stop domain values must be unique")]:(M[Ee]=!0,[])):[new s.V(he.key,Ce,`integer expected, found ${String(Ee)}`)]}}function Ln(y){const a=(y.expressionContext==="property"?s.W:s.X)(s.U(y.value),y.valueSpec);if(a.result==="error")return a.value.map(_=>new s.V(`${y.key}${_.key}`,y.value,_.message));const h=a.value.expression||a.value._styleExpression.expression;if(y.expressionContext==="property"&&y.propertyKey==="text-font"&&!h.outputDefined())return[new s.V(y.key,y.value,`Invalid data expression for "${y.propertyKey}". Output values must be contained as literals within the expression.`)];if(y.expressionContext==="property"&&y.propertyType==="layout"&&!s.Y(h))return[new s.V(y.key,y.value,'"feature-state" data expressions are not supported with layout properties.')];if(y.expressionContext==="filter")return un(h,y);if(y.expressionContext&&y.expressionContext.indexOf("cluster")===0){if(!s.Z(h,["zoom","feature-state"]))return[new s.V(y.key,y.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(y.expressionContext==="cluster-initial"&&!s._(h))return[new s.V(y.key,y.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function un(y,a){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const E of a.valueSpec.expression.parameters)h.delete(E);if(h.size===0)return[];const _=[];return y instanceof s.$&&h.has(y.name)?[new s.V(a.key,a.value,`["${y.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(y.eachChild(E=>{_.push(...un(E,a))}),_)}function Xn(y){const a=y.key,h=y.value,_=y.valueSpec,E=[];return Array.isArray(_.values)?_.values.indexOf(s.M(h))===-1&&E.push(new s.V(a,h,`expected one of [${_.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(_.values).indexOf(s.M(h))===-1&&E.push(new s.V(a,h,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(h)} found`)),E}function Ni(y){return s.a1(s.U(y.value))?Ln(s.L({},y,{expressionContext:"filter",valueSpec:y.styleSpec[`filter_${y.layerType||"fill"}`]})):Bn(y)}function Bn(y){const a=y.value,h=y.key;if(s.K(a)!=="array")return[new s.V(h,a,`array expected, ${s.K(a)} found`)];const _=y.styleSpec;let E,C=[];if(a.length<1)return[new s.V(h,a,"filter array must have at least 1 element")];switch(C=C.concat(Xn({key:`${h}[0]`,value:a[0],valueSpec:_.filter_operator,style:y.style,styleSpec:y.styleSpec})),s.M(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&s.M(a[1])==="$type"&&C.push(new s.V(h,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&C.push(new s.V(h,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(E=s.K(a[1]),E!=="string"&&C.push(new s.V(`${h}[1]`,a[1],`string expected, ${E} found`)));for(let M=2;M<a.length;M++)E=s.K(a[M]),s.M(a[1])==="$type"?C=C.concat(Xn({key:`${h}[${M}]`,value:a[M],valueSpec:_.geometry_type,style:y.style,styleSpec:y.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&C.push(new s.V(`${h}[${M}]`,a[M],`string, number, or boolean expected, ${E} found`));break;case"any":case"all":case"none":for(let M=1;M<a.length;M++)C=C.concat(Bn({key:`${h}[${M}]`,value:a[M],style:y.style,styleSpec:y.styleSpec}));break;case"has":case"!has":E=s.K(a[1]),a.length!==2?C.push(new s.V(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):E!=="string"&&C.push(new s.V(`${h}[1]`,a[1],`string expected, ${E} found`))}return C}function Es(y,a){const h=y.key,_=y.style,E=y.layer,C=y.styleSpec,M=y.value,j=y.objectKey,H=C[`${a}_${y.layerType}`];if(!H)return[];const G=j.match(/^(.*)-use-theme$/);if(a==="paint"&&G&&H[G[1]])return s.S(M)?[].concat(ri({key:y.key,value:M,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:C,expressionContext:"property",propertyType:a,propertyKey:j})):ri({key:h,value:M,valueSpec:{type:"string"},style:_,styleSpec:C});const Y=j.match(/^(.*)-transition$/);if(a==="paint"&&Y&&H[Y[1]]&&H[Y[1]].transition)return ri({key:h,value:M,valueSpec:C.transition,style:_,styleSpec:C});const ne=y.valueSpec||H[j];if(!ne)return[new s.J(h,M,`unknown property "${j}"`)];let ee;if(s.K(M)==="string"&&s.O(ne)&&!ne.tokens&&(ee=/^{([^}]+)}$/.exec(M))){const we=`\`{ "type": "identity", "property": ${ee?JSON.stringify(ee[1]):'"_"'} }\``;return[new s.V(h,M,`"${j}" does not support interpolation syntax
Use an identity property function instead: ${we}.`)]}const he=[];if(y.layerType==="symbol")j!=="text-field"||!_||_.glyphs||_.imports||he.push(new s.V(h,M,'use of "text-field" requires a style "glyphs" property')),j==="text-font"&&s.a2(s.U(M))&&s.M(M.type)==="identity"&&he.push(new s.V(h,M,'"text-font" does not support identity functions'));else if(y.layerType==="model"&&a==="paint"&&E&&E.layout&&E.layout.hasOwnProperty("model-id")&&s.O(ne)&&(s.a3(ne)||s.Q(ne))){const we=s.W(s.U(M),ne),xe=we.value.expression||we.value._styleExpression.expression;xe&&!s.Z(xe,["measure-light"])&&(j==="model-emissive-strength"&&s._(xe)&&s.Y(xe)||he.push(new s.V(h,M,`${j} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return he.concat(ri({key:y.key,value:M,valueSpec:ne,style:_,styleSpec:C,expressionContext:"property",propertyType:a,propertyKey:j}))}function Si(y){return Es(y,"paint")}function cs(y){return Es(y,"layout")}function Oi(y){let a=[];const h=y.value,_=y.key,E=y.style,C=y.styleSpec;h.type||h.ref||a.push(new s.V(_,h,'either "type" or "ref" is required'));let M=s.M(h.type);const j=s.M(h.ref);if(h.id){const H=s.M(h.id);for(let G=0;G<y.arrayIndex;G++){const Y=E.layers[G];s.M(Y.id)===H&&a.push(new s.V(_,h.id,`duplicate layer id "${h.id}", previously used at line ${Y.id.__line__}`))}}if("ref"in h){let H;["type","source","source-layer","filter","layout"].forEach(G=>{G in h&&a.push(new s.V(_,h[G],`"${G}" is prohibited for ref layers`))}),E.layers.forEach(G=>{s.M(G.id)===j&&(H=G)}),H?H.ref?a.push(new s.V(_,h.ref,"ref cannot reference another ref layer")):M=s.M(H.type):typeof j=="string"&&a.push(new s.V(_,h.ref,`ref layer "${j}" not found`))}else if(M!=="background"&&M!=="sky"&&M!=="slot")if(h.source){const H=E.sources&&E.sources[h.source],G=H&&s.M(H.type);H?G==="vector"&&M==="raster"?a.push(new s.V(_,h.source,`layer "${h.id}" requires a raster source`)):G==="raster"&&M!=="raster"?a.push(new s.V(_,h.source,`layer "${h.id}" requires a vector source`)):G!=="vector"||h["source-layer"]?G==="raster-dem"&&M!=="hillshade"?a.push(new s.V(_,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(M)?M!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||G==="geojson"&&H.lineMetrics?M==="raster-particle"&&G!=="raster-array"&&a.push(new s.V(_,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):a.push(new s.V(_,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new s.V(_,h.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new s.V(_,h,`layer "${h.id}" must specify a "source-layer"`)):a.push(new s.V(_,h.source,`source "${h.source}" not found`))}else a.push(new s.V(_,h,'missing required property "source"'));return a=a.concat(fi({key:_,value:h,valueSpec:C.layer,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ri({key:`${_}.type`,value:h.type,valueSpec:C.layer.type,style:y.style,styleSpec:y.styleSpec,object:h,objectKey:"type"}),filter:H=>Ni(s.L({layerType:M},H)),layout:H=>fi({layer:h,key:H.key,value:H.value,valueSpec:{},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{"*":G=>cs(s.L({layerType:M},G))}}),paint:H=>fi({layer:h,key:H.key,value:H.value,valueSpec:{},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{"*":G=>Si(s.L({layerType:M,layer:h},G))}})}})),a}function mn(y){const a=y.value,h=y.key,_=s.K(a);return _!=="string"?[new s.V(h,a,`string expected, ${_} found`)]:[]}const hr={promoteId:function y({key:a,value:h}){if(s.K(h)==="string")return mn({key:a,value:h});if(Array.isArray(h)){const _=[],E=s.U(h),C=s.X(E);return C.result==="error"&&C.value.forEach(M=>{_.push(new s.V(`${a}${M.key}`,null,`${M.message}`))}),s.Z(C.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new s.V(`${a}`,null,"promoteId expression should be only feature dependent")),_}{const _=[];for(const E in h)_.push(...y({key:`${a}.${E}`,value:h[E]}));return _}}};function Tr(y){const a=y.value,h=y.key,_=y.styleSpec,E=y.style;if(!a.type)return[new s.V(h,a,'"type" is required')];const C=s.M(a.type);let M=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&(a.url||a.tiles||M.push(new s.J(h,a,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return M=M.concat(fi({key:h,value:a,valueSpec:_[`source_${C.replace("-","_")}`],style:y.style,styleSpec:_,objectElementValidators:hr})),M;case"geojson":if(M=fi({key:h,value:a,valueSpec:_.source_geojson,style:E,styleSpec:_,objectElementValidators:hr}),a.cluster)for(const j in a.clusterProperties){const[H,G]=a.clusterProperties[j],Y=typeof H=="string"?[H,["accumulated"],["get",j]]:H;M.push(...Ln({key:`${h}.${j}.map`,value:G,expressionContext:"cluster-map"})),M.push(...Ln({key:`${h}.${j}.reduce`,value:Y,expressionContext:"cluster-reduce"}))}return M;case"video":return fi({key:h,value:a,valueSpec:_.source_video,style:E,styleSpec:_});case"image":return fi({key:h,value:a,valueSpec:_.source_image,style:E,styleSpec:_});case"canvas":return[new s.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xn({key:`${h}.type`,value:a.type,valueSpec:{values:Li(_)}})}}function Li(y){return y.source.reduce((a,h)=>{const _=y[h];return _.type.type==="enum"&&(a=a.concat(Object.keys(_.type.values))),a},[])}function pi(y){const a=y.value,h=y.styleSpec,_=h.light,E=y.style;let C=[];const M=s.K(a);if(a===void 0)return C;if(M!=="object")return C=C.concat([new s.V("light",a,`object expected, ${M} found`)]),C;for(const j in a){const H=j.match(/^(.*)-transition$/),G=j.match(/^(.*)-use-theme$/);C=C.concat(G&&_[G[1]]?ri({key:j,value:a[j],valueSpec:{type:"string"},style:E,styleSpec:h}):H&&_[H[1]]&&_[H[1]].transition?ri({key:j,value:a[j],valueSpec:h.transition,style:E,styleSpec:h}):_[j]?ri({key:j,value:a[j],valueSpec:_[j],style:E,styleSpec:h}):[new s.V(j,a[j],`unknown property "${j}"`)])}return C}function rn(y){const a=y.value;let h=[];if(!a)return h;const _=s.K(a);if(_!=="object")return h=h.concat([new s.V("light-3d",a,`object expected, ${_} found`)]),h;const E=y.styleSpec,C=E["light-3d"],M=y.key,j=y.style,H=y.style.lights;for(const ne of["type","id"])if(!(ne in a))return h=h.concat([new s.V("light-3d",a,`missing property ${ne} on light`)]),h;if(a.type&&H)for(let ne=0;ne<y.arrayIndex;ne++){const ee=s.M(a.type),he=H[ne];s.M(he.type)===ee&&h.push(new s.V(M,a.id,`duplicate light type "${a.type}", previously defined at line ${he.id.__line__}`))}const G=`properties_light_${a.type}`;if(!(G in E))return h=h.concat([new s.V("light-3d",a,`Invalid light type ${a.type}`)]),h;const Y=E[G];for(const ne in a)if(ne==="properties"){const ee=a[ne],he=s.K(ee);if(he!=="object")return h=h.concat([new s.V("properties",ee,`object expected, ${he} found`)]),h;for(const we in ee)h=h.concat(Y[we]?ri({key:we,value:ee[we],valueSpec:Y[we],style:j,styleSpec:E}):[new s.J(y.key,ee[we],`unknown property "${we}"`)])}else{const ee=ne.match(/^(.*)-transition$/),he=ne.match(/^(.*)-use-theme$/);h=h.concat(he&&C[he[1]]?ri({key:ne,value:a[ne],valueSpec:{type:"string"},style:j,styleSpec:E}):ee&&C[ee[1]]&&C[ee[1]].transition?ri({key:ne,value:a[ne],valueSpec:E.transition,style:j,styleSpec:E}):C[ne]?ri({key:ne,value:a[ne],valueSpec:C[ne],style:j,styleSpec:E}):[new s.J(ne,a[ne],`unknown property "${ne}"`)])}return h}function Rr(y){const a=y.value,h=y.key,_=y.style,E=y.styleSpec,C=E.terrain;let M=[];const j=s.K(a);if(a===void 0||j==="null")return M;if(j!=="object")return M=M.concat([new s.V("terrain",a,`object expected, ${j} found`)]),M;for(const H in a){const G=H.match(/^(.*)-transition$/),Y=H.match(/^(.*)-use-theme$/);M=M.concat(Y&&C[Y[1]]?ri({key:H,value:a[H],valueSpec:{type:"string"},style:_,styleSpec:E}):G&&C[G[1]]&&C[G[1]].transition?ri({key:H,value:a[H],valueSpec:E.transition,style:_,styleSpec:E}):C[H]?ri({key:H,value:a[H],valueSpec:C[H],style:_,styleSpec:E}):[new s.J(H,a[H],`unknown property "${H}"`)])}if(a.source){const H=_.sources&&_.sources[a.source],G=H&&s.M(H.type);H?G!=="raster-dem"&&M.push(new s.V(h,a.source,`terrain cannot be used with a source of type ${String(G)}, it only be used with a "raster-dem" source type`)):M.push(new s.V(h,a.source,`source "${a.source}" not found`))}else M.push(new s.V(h,a,'terrain is missing required property "source"'));return M}function $r(y){const a=y.value,h=y.style,_=y.styleSpec,E=_.fog;let C=[];const M=s.K(a);if(a===void 0)return C;if(M!=="object")return C=C.concat([new s.V("fog",a,`object expected, ${M} found`)]),C;for(const j in a){const H=j.match(/^(.*)-transition$/),G=j.match(/^(.*)-use-theme$/);C=C.concat(G&&E[G[1]]?ri({key:j,value:a[j],valueSpec:{type:"string"},style:h,styleSpec:_}):H&&E[H[1]]&&E[H[1]].transition?ri({key:j,value:a[j],valueSpec:_.transition,style:h,styleSpec:_}):E[j]?ri({key:j,value:a[j],valueSpec:E[j],style:h,styleSpec:_}):[new s.J(j,a[j],`unknown property "${j}"`)])}return C}const Nr={"*":()=>[],array:Wr,boolean:function(y){const a=y.value,h=y.key,_=s.K(a);return _!=="boolean"?[new s.V(h,a,`boolean expected, ${_} found`)]:[]},number:Mn,color:function(y){const a=y.key,h=y.value,_=s.K(h);return _!=="string"?[new s.V(a,h,`color expected, ${_} found`)]:s.a0.parseCSSColor(h)===null?[new s.V(a,h,`color expected, "${h}" found`)]:[]},enum:Xn,filter:Ni,function:jt,layer:Oi,object:fi,source:Tr,model:s.a4,light:pi,"light-3d":rn,terrain:Rr,fog:$r,string:mn,formatted:function(y){return mn(y).length===0?[]:Ln(y)},resolvedImage:function(y){return mn(y).length===0?[]:Ln(y)},projection:function(y){const a=y.value,h=y.styleSpec,_=h.projection,E=y.style;let C=[];const M=s.K(a);if(M==="object")for(const j in a)C=C.concat(ri({key:j,value:a[j],valueSpec:_[j],style:E,styleSpec:h}));else M!=="string"&&(C=C.concat([new s.V("projection",a,`object or string expected, ${M} found`)]));return C},import:function(y){const{value:a,styleSpec:h}=y,{data:_,...E}=a;Object.defineProperty(E,"__line__",{value:a.__line__,enumerable:!1});let C=fi(s.L({},y,{value:E,valueSpec:h.import}));return s.M(E.id)===""&&C.push(new s.V(`${y.key}.id`,E,"import id can't be an empty string")),_&&(C=C.concat(Sc(_,h,{key:`${y.key}.data`}))),C},iconset:function(y){const a=y.value,h=y.key,_=y.styleSpec,E=y.style;if(!a.type)return[new s.V(h,a,'"type" is required')];const C=s.M(a.type);let M=[];if(M=M.concat(fi({key:h,value:a,valueSpec:_[`iconset_${C}`],style:E,styleSpec:_})),C==="source"&&a.source){const j=E.sources&&E.sources[a.source],H=j&&s.M(j.type);j?H!=="raster-array"&&M.push(new s.V(h,a.source,`iconset cannot be used with a source of type ${String(H)}, it only be used with a "raster-array" source type`)):M.push(new s.V(h,a.source,`source "${a.source}" not found`))}return M}};function ri(y,a=!1){const h=y.value,_=y.valueSpec,E=y.styleSpec;if(_.expression&&s.a2(s.M(h)))return jt(y);if(_.expression&&s.S(s.U(h)))return Ln(y);if(_.type&&Nr[_.type]){const C=Nr[_.type](y);return a===!0&&C.length>0&&s.K(y.value)==="array"?Ln(y):C}return fi(s.L({},y,{valueSpec:_.type?E[_.type]:_}))}function Ec(y){const a=y.value,h=y.key,_=mn(y);return _.length||(a.indexOf("{fontstack}")===-1&&_.push(new s.V(h,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&_.push(new s.V(h,a,'"glyphs" url must include a "{range}" token'))),_}function Sc(y,a=s.a5,h={}){return ri({key:h.key||"",value:y,valueSpec:a.$root,styleSpec:a,style:y,objectElementValidators:{glyphs:Ec,"*":()=>[]}})}function Zr(y,a=s.a5){return ct(Sc(y,a))}const ra=y=>ct(Tr(y)),Tc=y=>ct(pi(y)),za=y=>ct(rn(y)),ia=y=>ct(Rr(y)),sc=y=>ct($r(y)),io=y=>ct(function(a){const h=a.value,_=a.style,E=a.styleSpec,C=E.snow;let M=[];const j=s.K(h);if(h===void 0)return M;if(j!=="object")return M=M.concat([new s.V("snow",h,`object expected, ${j} found`)]),M;for(const H in h){const G=H.match(/^(.*)-transition$/);M=M.concat(G&&C[G[1]]&&C[G[1]].transition?ri({key:H,value:h[H],valueSpec:E.transition,style:_,styleSpec:E}):C[H]?ri({key:H,value:h[H],valueSpec:C[H],style:_,styleSpec:E}):[new s.J(H,h[H],`unknown property "${H}"`)])}return M}(y)),It=y=>ct(function(a){const h=a.value,_=a.style,E=a.styleSpec,C=E.rain;let M=[];const j=s.K(h);if(h===void 0)return M;if(j!=="object")return M=M.concat([new s.V("rain",h,`object expected, ${j} found`)]),M;for(const H in h){const G=H.match(/^(.*)-transition$/);M=M.concat(G&&C[G[1]]&&C[G[1]].transition?ri({key:H,value:h[H],valueSpec:E.transition,style:_,styleSpec:E}):C[H]?ri({key:H,value:h[H],valueSpec:C[H],style:_,styleSpec:E}):[new s.J(H,h[H],`unknown property "${H}"`)])}return M}(y)),Te=y=>ct(Oi(y)),Me=y=>ct(Ni(y)),qe=y=>ct(Si(y)),nt=y=>ct(cs(y)),rt=y=>ct(s.a4(y));function ct(y){return y.slice().sort((a,h)=>a.line&&h.line?a.line-h.line:0)}function Tt(y,a){let h=!1;if(a&&a.length)for(const _ of a)_ instanceof s.J?s.w(_.message):(y.fire(new s.z(new Error(_.message))),h=!0);return h}let ut;class ht extends s.E{constructor(a,h="flat"){super(),this._transitionable=new s.a6(ut||(ut=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(a,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h,_={}){this._validate(Tc,a,_)||(this._transitionable.setTransitionOrValue(a),this.id=h)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||_.validate!==!1)&&Tt(this,a.call(Zr,s.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Dt=class extends s.E{constructor(y,a,h,_){super(),this.scope=h,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),h,_),this._transitionable.setTransitionOrValue(y,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(y,a){this._transitionable.setTransitionOrValue(y,a)}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}getExaggeration(y){return this._transitioning.possiblyEvaluate(new s.aa(y)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const y=this._transitionable._values.exaggeration;if(!y)return null;const a=y.value.expression;if(!a)return null;let h=-1,_=-1,E=1;for(const C of a.zoomStops)E=a.evaluate(new s.aa(C)),E>.01?(h=C,_=-1):_=C;return E<.01&&h>0&&_>h?[h,_]:null}isZoomDependent(){const y=this._transitionable._values.exaggeration;return y!=null&&y.value!=null&&y.value.expression!=null&&y.value.expression instanceof s.ab}};const Mt=45,Kt=65,hn=.05;function yn(y,a,h,_){const E=s.ae(Mt,Kt,h),[C,M]=Jn(y,_);let j=1-Math.min(1,Math.exp((a-C)/(M-C)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*E*y.alpha}function Jn(y,a){const h=.5/Math.tan(.5*a);return[y.range[0]+h,y.range[1]+h]}function ir(y,a,h,_,E){const C=s.ad.vec3.transformMat4([],[a,h,_],E.mercatorFogMatrix);return yn(y,s.ad.vec3.length(C),E.pitch,E._fov)}function xr(y,a,h,_,E,C,M){const j=[[h,_,0],[E,_,0],[E,C,0],[h,C,0]];let H=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(const Y of j){const ne=s.ad.vec3.transformMat4([],Y,a),ee=s.ad.vec3.length(ne);H=Math.min(H,ee),G=Math.max(G,ee)}return[yn(y,H,M.pitch,M._fov),yn(y,G,M.pitch,M._fov)]}class vr extends s.E{constructor(a,h,_,E){super();const C=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(C,_,new Map(E)),this.set(a,E),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new s.af(C),this.scope=_}get state(){const a=this._transform,h=a.projection.name==="globe",_=s.ag(a.zoom),E=this.properties.get("range"),C=[.5,3];return{range:h?[s.ah(C[0],E[0],_),s.ah(C[1],E[1],_)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h,_={}){if(this._validate(sc,a,_))return;const E=s.l({},a);for(const C of Object.keys(s.a5.fog))E[C]===void 0&&(E[C]=s.a5.fog[C].default);this._options=E,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ae(Mt,Kt,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(_,E,C){const M=s.ac.fromLngLat(E),j=C.elevation?C.elevation.getAtPointOrZero(M):0;return ir(_,M.x,M.y,j,C)}(this.state,a,h):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(a.toUnwrapped());return xr(this.state,h,0,0,s.ai,s.ai,this._transform)}getOpacityForBounds(a,h,_,E,C){return this._transform.projection.supportsFog?xr(this.state,a,h,_,E,C,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Jn(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const _ of h){const E=a.points[_];let C;if(E[2]>=0)C=E;else{const M=a.points[_-4];C=s.aj(M,E,M[2]/(M[2]-E[2]))}if(ir(this.state,C[0],C[1],0,this._transform)>=hn)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||_.validate!==!1)&&Tt(this,a.call(Zr,s.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let ii,si,er,li,zr=class extends s.E{constructor(y,a,h,_){super();const E=ii||(ii=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(E,h,new Map(_)),this.set(y,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(E),this.scope=h}get state(){const y=this.properties.get("opacity"),a=this.properties.get("color"),h=this.properties.get("direction"),_=s.ak(h[0]),E=-Math.max(s.ak(h[1]),.01),C=[Math.cos(_)*Math.cos(E),Math.sin(_)*Math.cos(E),Math.sin(E)],M=this.properties.get("vignette"),j=this.properties.get("vignette-color");return j.a=M,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(a.r,a.g,a.b,a.a*y),direction:C,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:j}}get(){return this._transitionable.serialize()}set(y,a,h={}){if(this._validate(io,y,h))return;const _=s.l({},y);for(const E of Object.keys(s.a5.snow))_[E]===void 0&&(_[E]=s.a5.snow[E].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,a,h){return(!h||h.validate!==!1)&&Tt(this,y.call(Zr,s.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},oi=class extends s.E{constructor(y,a,h,_){super();const E=si||(si=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(E,h,new Map(_)),this.set(y,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(E),this.scope=h}get state(){const y=this.properties.get("opacity"),a=this.properties.get("color"),h=this.properties.get("direction"),_=s.ak(h[0]),E=-Math.max(s.ak(h[1]),.01),C=[Math.cos(_)*Math.cos(E),Math.sin(_)*Math.cos(E),Math.sin(E)],M=this.properties.get("vignette-color");return M.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(a.r,a.g,a.b,a.a*y),direction:C,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(y,a,h={}){if(this._validate(It,y,h))return;const _=s.l({},y);for(const E of Object.keys(s.a5.rain))_[E]===void 0&&(_[E]=s.a5.rain[E].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,a,h){return(!h||h.validate!==!1)&&Tt(this,y.call(Zr,s.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class an extends s.E{constructor(a,h,_,E){super(),this.scope=_,this._options=a,this.properties=new s.af(h),this._transitionable=new s.a6(h,_,new Map(E)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,h){this._options=a,this._transitionable.setTransitionOrValue(a.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Bs{constructor(a,h,_,E){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,E)}static createFromScreenPoints(a,h){let _,E;if(a instanceof s.P||typeof a[0]=="number"){const C=s.P.convert(a);_=[C],E=h.isPointAboveHorizon(C)}else{const C=s.P.convert(a[0]),M=s.P.convert(a[1]);_=[C,M],E=s.an(C,M).every(j=>h.isPointAboveHorizon(j))}return new Bs(_,h.getCameraPoint(),E,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return s.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],E=s.an(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?E[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(E[3]=this.cameraPoint)),s.ao(E,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],E=s.an(h,_,a),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:E[0]=C,E[4]=C.clone();break;case 1:E.splice(1,0,C);break;case 2:E[1]=C;break;case 3:E.splice(4,0,C);break;case 5:E.splice(2,0,C);break;case 6:E[3]=C;break;case 7:E.splice(3,0,C);break;case 8:E[2]=C}return E}containsTile(a,h,_,E=0){const C=a.queryPadding/h._pixelsPerMercatorPixel+1,M=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let j=a.tileID.wrap+(M.unwrapped?E:0);const H=M.polygon.map(Ee=>s.ap(a.tileTransform,Ee,j));if(!s.aq(H,0,0,s.ai,s.ai))return;j=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const G=this.screenGeometryMercator.polygon.map(Ee=>s.ar(a.tileTransform,Ee,j)),Y=G.map(Ee=>new s.P(Ee[0],Ee[1])),ne=h.getFreeCameraOptions().position||new s.ac(0,0,0),ee=s.ar(a.tileTransform,ne,j),he=G.map(Ee=>{const Ce=s.ad.vec3.sub(Ee,Ee,ee);return s.ad.vec3.normalize(Ce,Ce),new s.as(ee,Ce)}),we=s.at(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Y,tilespaceRays:he,bufferedTilespaceGeometry:H,bufferedTilespaceBounds:(xe=s.au(H),xe.min.x=s.ay(xe.min.x,0,s.ai),xe.min.y=s.ay(xe.min.y,0,s.ai),xe.max.x=s.ay(xe.max.x,0,s.ai),xe.max.y=s.ay(xe.max.y,0,s.ai),xe),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:we};var xe}_bufferedScreenMercator(a,h){const _=Xo(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let E;return E=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=E,E}}_bufferedCameraMercator(a,h){const _=Xo(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let E;return E=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=E,E}}_projectAndResample(a,h){const _=function(C,M){const j=s.ad.mat4.multiply([],M.pixelMatrix,M.globeMatrix),H=[0,-s.az,0,1],G=[0,s.az,0,1],Y=[0,0,0,1];s.ad.vec4.transformMat4(H,H,j),s.ad.vec4.transformMat4(G,G,j),s.ad.vec4.transformMat4(Y,Y,j);const ne=new s.P(H[0]/H[3],H[1]/H[3]),ee=new s.P(G[0]/G[3],G[1]/G[3]),he=s.aw(C,ne)&&H[3]<Y[3],we=s.aw(C,ee)&&G[3]<Y[3];if(!he&&!we)return null;const xe=function(Xe,Ke,tt){for(let at=1;at<Xe.length;at++){const At=xo(Ke.pointCoordinate3D(Xe[at-1]).x),xt=xo(Ke.pointCoordinate3D(Xe[at]).x);if(tt<0){if(At<xt)return{idx:at,t:-At/(xt-1-At)}}else if(xt<At)return{idx:at,t:(1-At)/(xt+1-At)}}return null}(C,M,he?-1:1);if(!xe)return null;const{idx:Ee,t:Ce}=xe;let je=Ee>1?ci(C.slice(0,Ee),M):[],$e=Ee<C.length?ci(C.slice(Ee),M):[];je=je.map(Xe=>new s.P(xo(Xe.x),Xe.y)),$e=$e.map(Xe=>new s.P(xo(Xe.x),Xe.y));const We=[...je];We.length===0&&We.push($e[$e.length-1]);const Ze=s.ah(We[We.length-1].y,($e.length===0?je[0]:$e[0]).y,Ce);let Ye;return Ye=he?[new s.P(0,Ze),new s.P(0,0),new s.P(1,0),new s.P(1,Ze)]:[new s.P(1,Ze),new s.P(1,1),new s.P(0,1),new s.P(0,Ze)],We.push(...Ye),$e.length===0?We.push(je[0]):We.push(...$e),{polygon:We.map(Xe=>new s.ac(Xe.x,Xe.y)),unwrapped:!1}}(a,h);if(_)return _;const E=function(C,M){let j=!1,H=-1/0,G=0;for(let ne=0;ne<C.length-1;ne++)C[ne].x>H&&(H=C[ne].x,G=ne);for(let ne=0;ne<C.length-1;ne++){const ee=(G+ne)%(C.length-1),he=C[ee],we=C[ee+1];Math.abs(he.x-we.x)>.5&&(he.x<we.x?(he.x+=1,ee===0&&(C[C.length-1].x+=1)):(we.x+=1,ee+1===C.length-1&&(C[0].x+=1)),j=!0)}const Y=s.av(M.center.lng);return j&&Y<Math.abs(Y-1)&&C.forEach(ne=>{ne.x-=1}),{polygon:C,unwrapped:j}}(ci(a,h).map(C=>new s.P(xo(C.x),C.y)),h);return{polygon:E.polygon.map(C=>new s.ac(C.x,C.y)),unwrapped:E.unwrapped}}}function ci(y,a){return s.ax(y,h=>{const _=a.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function xo(y){return y<0?1+y%1:y%1}function Xo(y){return 100*y|0}function qr(y,a,h,_,E){const C=function(j,H){if(j)return E(j);if(H){if(y.url&&H.tiles&&y.tiles&&delete y.tiles,H.variants){if(!Array.isArray(H.variants))return E(new Error("variants must be an array"));for(const Y of H.variants){if(Y==null||typeof Y!="object"||Y.constructor!==Object)return E(new Error("variant must be an object"));if(!Array.isArray(Y.capabilities))return E(new Error("capabilities must be an array"));if(Y.capabilities.length===1&&Y.capabilities[0]==="meshopt"){H=s.l(H,Y);break}}}const G=s.aA(s.l({},H,y),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);G.tiles=a.canonicalizeTileset(G,y.url),E(null,G)}},M=function(j,H,G){if(!j)return null;if(!H&&!G)return j;G=G||j.worldview_default;const Y=Object.values(j.language||{});if(Y.length===0)return null;const ne=Object.values(j.worldview||{});if(ne.length===0)return null;const ee=Y.every(we=>we===H),he=ne.every(we=>we===G);return ee&&he?j:H in(j.language_options||{})||G in(j.worldview_options||{})?null:j.language_options&&j.worldview_options?j:null}(y.data,h,_);return M?s.q.frame(()=>C(null,M)):y.url?s.n(a.transformRequest(a.normalizeSourceURL(y.url,null,h,_),s.R.Source),C):s.q.frame(()=>{const{data:j,...H}=y;C(null,H)})}class Gr{constructor(a,h,_){this.bounds=s.aB.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),_=Math.floor(s.av(this.bounds.getWest())*h),E=Math.floor(s.aC(this.bounds.getNorth())*h),C=Math.ceil(s.av(this.bounds.getEast())*h),M=Math.ceil(s.aC(this.bounds.getSouth())*h);return a.x>=_&&a.x<C&&a.y>=E&&a.y<M}}class Ti extends s.E{constructor(a,h,_,E){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.aA(h,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E),this._tileWorkers={},this._deduped=new s.aD}load(a){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=qr(this._options,this.map._requestManager,h,_,(E,C)=>{if(this._tileJSONRequest=null,this._loaded=!0,E)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new s.z(E));else if(C){if(s.l(this,C),this.hasWorldviews=!!C.worldview_options,C.worldview_default&&(this.worldviewDefault=C.worldview_default),C.vector_layers){this.vectorLayers=C.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const M of C.vector_layers)this.vectorLayerIds.push(M.id),C.worldview&&C.worldview[M.source]&&this.localizableLayerIds.add(M.id)}C.bounds&&(this.tileBounds=new Gr(C.bounds,this.minzoom,this.maxzoom)),wn(C.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}a&&a(E)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(a,h){const _=a.tileID.canonical.url(this.tiles,this.scheme),E=this.map._requestManager.normalizeTileURL(_),C=this.map._requestManager.transformRequest(E,s.R.Tile),M=this.map.style?this.map.style.getLut(this.scope):null,j=M?{image:M.image.clone()}:null,H={request:C,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,lut:j,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(_)&&(H.worldview=this.map.getWorldview()||this.worldviewDefault,H.localizableLayerIds=this.localizableLayerIds),H.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",H,G.bind(this));else if(a.actor=this._tileWorkers[E]=this._tileWorkers[E]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",H,G.bind(this),void 0,!0);else{const Y=s.aE.call({deduped:this._deduped},H,(ne,ee)=>{ne||!ee?G.call(this,ne):(H.data={cacheControl:ee.cacheControl,expires:ee.expires,rawData:ee.rawData.slice(0)},a.actor&&a.actor.send("loadTile",H,G.bind(this),void 0,!0))},!0);a.request={cancel:Y}}function G(Y,ne){return delete a.request,a.aborted?h(null):Y&&Y.status!==404?h(Y):(ne&&ne.resourceTiming&&(a.resourceTiming=ne.resourceTiming),this.map._refreshExpiredTiles&&ne&&a.setExpiryData(ne),a.loadVectorData(ne,this.map.painter),s.aF(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,h){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ko extends s.E{constructor(a,h,_,E){super(),this.id=a,this.dispatcher=_,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},h),s.l(this,s.aA(h,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._tileJSONRequest=qr(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new s.z(h)):_&&(s.l(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(E=>E.id)),_.bounds&&(this.tileBounds=new Gr(_.bounds,this.minzoom,this.maxzoom)),wn(_.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),a&&a(h)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const _=s.q.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=s.o(this.map._requestManager.transformRequest(E,s.R.Tile),(C,M,j,H)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):C?(a.state="errored",h(C)):M?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:j,expires:H}),a.setTexture(M,this.map.painter),a.state="loaded",s.aF(this.dispatcher),void h(null)):h(null)))}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h&&h()}unloadTile(a,h){a.texture&&a.texture instanceof s.T?(a.destroy(!0),a.texture&&a.texture instanceof s.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xa extends Ko{constructor(a,h,_,E){super(a,h,_,E),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.l({type:"raster-array"},h)}triggerRepaint(a){const h=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);h&&h.enabled&&_&&h._clearRenderCacheForTile(_.id,a.tileID),this.map.triggerRepaint()}loadTile(a,h){const _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(_,s.R.Tile),C={request:E,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};a.source=this.id,a.scope=this.scope,a.requestParams=E,a.actor||(a.actor=this.dispatcher.getActor());const M=(j,H,G,Y)=>{if(delete a.request,a.aborted)return a.state="unloaded",h(null);if(j)return j.name==="AbortError"?void 0:(a.state="errored",h(j));if(this.map._refreshExpiredTiles&&H&&a.setExpiryData({cacheControl:G,expires:Y}),this.partial)a.state="empty";else{if(!H)return h(null);a.state="loaded",a._isHeaderLoaded=!0,a._mrt=H}h(null)};a.request=this.partial?a.fetchHeader(void 0,M.bind(this)):a.actor.send("loadTile",C,M.bind(this),void 0,!0)}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,h){const _=a.texture;_&&_ instanceof s.T?(a.destroy(!0),this.map.painter.saveTileTexture(_)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,h,_){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(h,_,(E,C)=>{if(E)return a.state="errored",this.fire(new s.z(E)),void this.triggerRepaint(a);C&&(a._isHeaderLoaded=!0,a.setTexture(C,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:C})=>C===a),_=h&&h.fields,E=_&&_.bands&&_.bands;return E?E[0]:0}getTextureDescriptor(a,h,_){if(!a)return;const E=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!E)return;let C=null;h instanceof s.aI?C=h.paint.get("raster-array-band"):h instanceof s.aJ&&(C=h.paint.get("raster-particle-array-band"));const M=C||this.getInitialBand(E);if(M!=null)if(a.textureDescriptor){if(!a.updateNeeded(E,M)||_)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,E,M)}getImages(a,h){const _=new Map;for(const E of a)for(const C of h){const[M,j]=C.split("/"),H=E.getLayer(M);if(!H||!H.hasBand(j)||!H.hasDataForBand(j))continue;const{bytes:G,tileSize:Y,buffer:ne}=H.getBandView(j),ee=Y+2*ne,he={data:new s.r({width:ee,height:ee},G),pixelRatio:2,sdf:!1,usvg:!1,version:0};_.set(C,he)}return _}}const Eu={vector:Ti,raster:Ko,"raster-dem":class extends Ko{constructor(y,a,h,_){super(y,a,h,_),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(y,a){const h=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(E,C){E&&(y.state="errored",a(E)),C&&(y.dem=C,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",a(null))}y.request=s.o(this.map._requestManager.transformRequest(h,s.R.Tile),function(E,C,M,j){if(delete y.request,y.aborted)y.state="unloaded",a(null);else if(E)y.state="errored",a(E);else if(C){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:M,expires:j});const H=ImageBitmap&&C instanceof ImageBitmap&&s.t(),G=1-(C.width-s.aG(C.width))/2;G<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const Y=H?C:s.q.getImageData(C,G),ne={uid:y.uid,tileID:y.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:Y,encoding:this.encoding,padding:G};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadTile",ne,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(y){const a=y.canonical,h=Math.pow(2,a.z),_=(a.x-1+h)%h,E=a.x===0?y.wrap-1:y.wrap,C=(a.x+1+h)%h,M=a.x+1===h?y.wrap+1:y.wrap,j={};return j[new s.aH(y.overscaledZ,E,a.z,_,a.y).key]={backfilled:!1},j[new s.aH(y.overscaledZ,M,a.z,C,a.y).key]={backfilled:!1},a.y>0&&(j[new s.aH(y.overscaledZ,E,a.z,_,a.y-1).key]={backfilled:!1},j[new s.aH(y.overscaledZ,y.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},j[new s.aH(y.overscaledZ,M,a.z,C,a.y-1).key]={backfilled:!1}),a.y+1<h&&(j[new s.aH(y.overscaledZ,E,a.z,_,a.y+1).key]={backfilled:!1},j[new s.aH(y.overscaledZ,y.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},j[new s.aH(y.overscaledZ,M,a.z,C,a.y+1).key]={backfilled:!1}),j}},"raster-array":xa,geojson:class extends s.E{constructor(y,a,h,_){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=a.data,this._options=s.l({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const E=s.ai/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*E,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*E,extent:s.ai,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:s.ai,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*E,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}updateData(y){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof y!="string"&&(y.type==="Feature"&&(y={type:"FeatureCollection",features:[y]}),y.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof y!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const a=new Map;for(const h of this._data.features)a.set(h.id,h);for(const h of y.features)a.set(h.id,h);this._data.features=[...a.values()]}else this._data=y;return this._updateWorkerData(!0),this}getClusterExpansionZoom(y,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id,scope:this.scope},a),this}getClusterChildren(y,a){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id,scope:this.scope},a),this}getClusterLeaves(y,a,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:y,limit:a,offset:h},_),this}_updateWorkerData(y=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const a=s.l({append:y},this.workerOptions);a.scope=this.scope;const h=this._data;typeof h=="string"?(a.request=this.map._requestManager.transformRequest(s.q.resolveURL(h),s.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(_,E)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new s.z(_));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&E&&E.resourceTiming&&E.resourceTiming[this.id]&&(C.resourceTiming=E.resourceTiming[this.id]),y&&(this._partialReload=!0),this.fire(new s.A("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(y),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const y=s.C(this.id,this.scope);this.map.style.clearSource(y),this._updateWorkerData()}loadTile(y,a){const h=y.actor?"reloadTile":"loadTile";y.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,E=_?{image:_.image.clone()}:null,C=this._partialReload,M={type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:E,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:C};y.request=this.actor.send(h,M,(j,H)=>C&&!H?(y.state="loaded",a(null)):(delete y.request,y.destroy(),y.aborted?a(null):j?a(j):(y.loadVectorData(H,this.map.painter,h==="reloadTile"),a(null))),void 0,h==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y,a){this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id,scope:this.scope}),y.destroy()}onRemove(y){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(y,a,h,_){super(y,a,h,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,s.R.Source).url);s.aL(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new s.z(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const a=this.video.seekable;y<a.start(0)||y>a.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(y,this.video,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.E{constructor(y,a,h,_){super(),this.id=y,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){const y=[];for(const a in this._options.models){const h=this._options.models[a],_=s.aN(this.map._requestManager.transformRequest(h.uri,s.R.Model).url).then(E=>{if(!E)return;const C=s.aO(E),M=new s.aP(a,h.position,h.orientation,C);M.computeBoundsAndApplyParent(),this.models.push(M)}).catch(E=>{this.fire(new s.z(new Error(`Could not load model ${a} from ${h.uri}: ${E.message}`)))});y.push(_)}return Promise.allSettled(y).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this.fire(new s.z(new Error(`Could not load models: ${a.message}`)))})}onAdd(y){this.map=y,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(y,a){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(y,a,h,_){super(),this.type="batched-model",this.id=y,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(y){this.map=y,this.load()}reload(){this.cancelTileJSONRequest();const y=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(y))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(y){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=qr(this._options,this.map._requestManager,a,h,(_,E)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new s.z(_))):E&&(s.l(this,E),E.bounds&&(this.tileBounds=new Gr(E.bounds,this.minzoom,this.maxzoom)),wn(E.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),y&&y(_)})}hasTransition(){return!1}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loaded(){return this._loaded}loadTile(y,a){const h=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,s.R.Tile),data:void 0,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:y.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(y.actor&&y.state!=="expired")if(y.state==="loading")y.reloadCallback=a;else{if(y.buckets){const C=Object.values(y.buckets);for(const M of C)M.dirty=!0;return void(y.state="loaded")}y.request=y.actor.send("reloadTile",_,E.bind(this))}else y.actor=this.dispatcher.getActor(),y.request=y.actor.send("loadTile",_,E.bind(this),void 0,!0);function E(C,M){return y.aborted?a(null):C&&C.status!==404?a(C):(this.map._refreshExpiredTiles&&M&&y.setExpiryData(M),y.loadModelData(M,this.map.painter),y.state="loaded",void a(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aK{constructor(y,a,h,_){super(y,a,h,_),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(C=>typeof C!="number"))||this.fire(new s.z(new s.V(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${y}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${y}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(y){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?!y&&!this._playing||this.texture instanceof s.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(a,this.canvas,a.gl.RGBA8,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends s.E{constructor(y,a,h,_){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Gr(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.aA(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this.map=y,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:a,y:h,z:_}=y.canonical;return this._implementation.hasTile({x:a,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,a){const{x:h,y:_,z:E}=y.tileID.canonical,C=new AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:E},{signal:C.signal})).then(function(M){return delete y.request,y.aborted?(y.state="unloaded",a(null)):M===void 0?(y.state="errored",a(null)):M===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",a(null)):function(j){return j instanceof ImageData||j instanceof HTMLCanvasElement||j instanceof ImageBitmap||j instanceof HTMLImageElement}(M)?(this.loadTileData(y,M),y.state="loaded",void a(null)):(y.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(M=>{M.name!=="AbortError"&&(y.state="errored",a(M))}),y.request.cancel=()=>C.abort()}loadTileData(y,a){y.setTexture(a,this.map.painter)}unloadTile(y,a){if(y.texture&&y.texture instanceof s.T?(y.destroy(!0),y.texture&&y.texture instanceof s.T&&this.map.painter.saveTileTexture(y.texture)):y.destroy(),this._implementation.unloadTile){const{x:h,y:_,z:E}=y.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:E})}a&&a()}abortTile(y,a){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){const y=s.C(this.id,this.scope);this.map.style.clearSource(y)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},$s=function(y,a,h,_){const E=new Eu[a.type](y,a,h,_);if(E.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${E.id}`);return s.aQ(["load","abort","unload","serialize","prepare"],E),E};function Ka(y,a,h=""){return`${h}:${a.id||""}:${a.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:E,importId:C}=_;return`featureset:${E}${C?`:import:${C}`:""}`}}(y.target)}`}function Su(y,a,h,_=""){if(y.uniqueFeatureID){const E=Ka(y,a,_);if(h.has(E))return!0;h.add(E)}return!1}function zs(y,a,h,_,E=!1){const C=a.sourceCache.transform,M=a.sourceCache.tilesIn(y,a.has3DLayers,E);M.sort(va);const j=[];for(const H of M){const G=H.tile.queryRenderedFeatures(a,H,h,_,C,E);Object.keys(G).length&&j.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:G})}return j.length===0?{}:function(H){const G={},Y={};for(const ne of H){const ee=ne.queryResults,he=ne.wrappedTileID,we=Y[he]=Y[he]||{};for(const xe in ee){const Ee=ee[xe],Ce=we[xe]=we[xe]||{},je=G[xe]=G[xe]||[];for(const $e of Ee)Ce[$e.featureIndex]||(Ce[$e.featureIndex]=!0,je.push($e))}}return G}(j)}function Ml(y,a,h,_,E){const C={},M=_.queryRenderedSymbols(y),j=[];for(const H of Object.keys(M).map(Number))j.push(E[H]);j.sort(va);for(const H of j){const G=H.featureIndex.lookupSymbolFeatures(M[H.bucketInstanceId],H.bucketIndex,H.sourceLayerIndex,a,h);for(const Y in G){const ne=C[Y]=C[Y]||[],ee=G[Y];ee.sort((he,we)=>{const xe=H.featureSortOrder;if(xe){const Ee=xe.indexOf(he.featureIndex);return xe.indexOf(we.featureIndex)-Ee}return we.featureIndex-he.featureIndex});for(const he of ee)ne.push(he)}}return C}function Uf(y,a){const h=y.getRenderableIds().map(C=>y.getTileByID(C)),_=[],E={};for(let C=0;C<h.length;C++){const M=h[C],j=M.tileID.canonical.key;E[j]||(E[j]=!0,M.querySourceFeatures(_,a))}return _}function va(y,a){const h=y.tileID,_=a.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Ii(y,a){const h={};if(!a)return h;for(const _ of y){const E=_.layerIds.map(C=>a.getLayer(C)).filter(Boolean);if(E.length!==0){_.layers=E,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(C=>E.filter(M=>M.id===C)[0]));for(const C of E)h[C.fqid]=_}}return h}const ns=32,Vt=33,ot=new Uint16Array(8184);for(let y=0;y<2046;y++){let a=y+2,h=0,_=0,E=0,C=0,M=0,j=0;for(1&a?E=C=M=ns:h=_=j=ns;(a>>=1)>1;){const G=h+E>>1,Y=_+C>>1;1&a?(E=h,C=_,h=M,_=j):(h=E,_=C,E=M,C=j),M=G,j=Y}const H=4*y;ot[H+0]=h,ot[H+1]=_,ot[H+2]=E,ot[H+3]=C}const Fn=new Uint16Array(2178),zi=new Uint8Array(1089),so=new Uint16Array(1089);function Zc(y){return y===0?-.03125:y===32?.03125:0}const Tu={type:2,extent:s.ai,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ai+1,0),new s.P(s.ai+1,s.ai+1),new s.P(0,s.ai+1),new s.P(0,0)]]};class qs{constructor(a,h,_,E,C){this.tileID=a,this.uid=s.aW(),this.uses=0,this.tileSize=h,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=C,E&&E.style&&(this._lastUpdatedBrightness=E.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",E&&E.transform&&(this.projection=E.transform.projection)}registerFadeDuration(a){const h=a+this.timeAdded;h<s.q.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,h,_){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=Ii(a.buckets,h.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const C=this.buckets[E];if(C instanceof s.aY){if(this.hasSymbolBuckets=!0,!_)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const C=this.buckets[E];if(C instanceof s.aY&&C.hasRTLText){this.hasRTLText=!0,s.aZ();break}}this.queryPadding=0;for(const E in this.buckets){const C=this.buckets[E],M=h.style.getOwnLayer(E);if(!M)continue;const j=M.queryRadius(C);this.queryPadding=Math.max(this.queryPadding,j)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new s.aX}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(a,h,_){a&&(a.resourceTiming&&(this.resourceTiming=a.resourceTiming),this.buckets=Object.assign({},this.buckets,Ii(a.buckets,h.style)),a.featureIndex&&(this.latestFeatureIndex=a.featureIndex))}getBucket(a){return this.buckets[a.fqid]}upload(a){for(const E in this.buckets){const C=this.buckets[E];C.uploadPending()&&C.upload(a)}const h=a.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new s.T(a,_.image,h.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(a,this.glyphAtlasImage,h.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(a,this.lineAtlas.image,h.R8),this.lineAtlas.uploaded=!0)}prepare(a,h,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,_),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const E=h.style.getBrightness();(this._lastUpdatedBrightness||E)&&(this._lastUpdatedBrightness&&E&&Math.abs(this._lastUpdatedBrightness-E)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==E),this._lastUpdatedBrightness=E))}queryRenderedFeatures(a,h,_,E,C,M){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const j=function(H,G){const Y=s.ad.mat4.fromScaling([],[.5*H.width,.5*-H.height,1]);return s.ad.mat4.translate(Y,Y,[1,-1,0]),s.ad.mat4.multiply(Y,Y,H.calculateProjMatrix(G.toUnwrapped())),Float32Array.from(Y)}(C,this.tileID);return this.latestFeatureIndex.query(a,{tilespaceGeometry:h,pixelPosMatrix:j,transform:E,availableImages:_,tileTransform:this.tileTransform})}querySourceFeatures(a,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const E=_.loadVTLayers(),C=h?h.sourceLayer:"",M=E._geojsonTileLayer||E[C];if(!M)return;const j=s.a_(h&&h.filter),{z:H,x:G,y:Y}=this.tileID.canonical,ne={z:H,x:G,y:Y};for(let ee=0;ee<M.length;ee++){const he=M.feature(ee);if(j.needGeometry){const Ee=s.a$(he,!0);if(!j.filter(new s.aa(this.tileID.overscaledZ),Ee,this.tileID.canonical))continue}else if(!j.filter(new s.aa(this.tileID.overscaledZ),he))continue;const we=_.getId(he,C),xe=new s.b0(he,H,G,Y,we);xe.tile=ne,a.push(xe)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(a){const h=this.expirationTime;if(a.cacheControl){const _=s.b1(a.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const _=Date.now();let E=!1;if(this.expirationTime>_)E=!1;else if(h)if(this.expirationTime<h)E=!0;else{const C=this.expirationTime-h;C?this.expirationTime=_+Math.max(C,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(a){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&a&&this.updateBuckets(a)}updateBuckets(a,h){if(!this.latestFeatureIndex||!a.style)return;const _=this.latestFeatureIndex.loadVTLayers(),E=a.style.listImages(),C=a.style.getBrightness();for(const M in this.buckets){if(!a.style.hasLayer(M))continue;const j=this.buckets[M],H=j.layers[0],G=H.sourceLayer||"_geojsonTileLayer",Y=_[G],ne=a.style.getLayerSourceCache(H);let ee={};ne&&(ee=ne._state.getState(G,void 0));const he=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},we=Object.keys(ee).length>0&&!h;we&&!j.stateDependentLayers.length&&!h||j.update(ee,Y,E,he,we?j.stateDependentLayers:j.layers,h,C),(j instanceof s.b2||j instanceof s.b3)&&a._terrain&&a._terrain.enabled&&ne&&j.uploadPending()&&a._terrain._clearRenderCacheForTile(ne.id,this.tileID);const xe=a&&a.style&&a.style.getOwnLayer(M);xe&&(this.queryPadding=Math.max(this.queryPadding,xe.queryRadius(j)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=s.q.now()+a}setTexture(a,h){const _=h.context,E=_.gl;this.texture=this.texture||h.getTileTexture(a.width),this.texture&&this.texture instanceof s.T?this.texture.update(a):(this.texture=new s.T(_,a,E.RGBA8,{useMipmap:!0}),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE))}setDependencies(a,h){const _={};for(const E of h)_[E]=!0;this.dependencies[a]=_}hasDependency(a,h){for(const _ of a){const E=this.dependencies[_];if(E){for(const C of h)if(E[C])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const _=s.b4(Tu,this.tileID.canonical,this.tileTransform)[0],E=new s.b5,C=new s.b6;for(let M=0;M<_.length;M++){const{x:j,y:H}=_[M];E.emplaceBack(j,H),C.emplaceBack(M)}C.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(C),this._tileDebugBuffer=a.createVertexBuffer(E,s.b7.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,E.length,C.length)}_makeTileBoundsBuffers(a,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const _=s.b4(Tu,this.tileID.canonical,this.tileTransform)[0];let E,C;if(this.isRaster){const M=function(j,H){const G=s.aR(j,H),Y=Math.pow(2,j.z);for(let Ee=0;Ee<Vt;Ee++)for(let Ce=0;Ce<Vt;Ce++){const je=s.aS((j.x+(Ce+Zc(Ce))/ns)/Y),$e=s.aT((j.y+(Ee+Zc(Ee))/ns)/Y),We=H.project(je,$e),Ze=Ee*Vt+Ce;Fn[2*Ze+0]=Math.round((We.x*G.scale-G.x)*s.ai),Fn[2*Ze+1]=Math.round((We.y*G.scale-G.y)*s.ai)}zi.fill(0),so.fill(0);for(let Ee=2045;Ee>=0;Ee--){const Ce=4*Ee,je=ot[Ce+0],$e=ot[Ce+1],We=ot[Ce+2],Ze=ot[Ce+3],Ye=je+We>>1,Xe=$e+Ze>>1,Ke=Ye+Xe-$e,tt=Xe+je-Ye,at=$e*Vt+je,At=Ze*Vt+We,xt=Xe*Vt+Ye,Bt=Math.hypot((Fn[2*at+0]+Fn[2*At+0])/2-Fn[2*xt+0],(Fn[2*at+1]+Fn[2*At+1])/2-Fn[2*xt+1])>=16;zi[xt]=zi[xt]||(Bt?1:0),Ee<1022&&(zi[xt]=zi[xt]||zi[($e+tt>>1)*Vt+(je+Ke>>1)]||zi[(Ze+tt>>1)*Vt+(We+Ke>>1)])}const ne=new s.aU,ee=new s.aV;let he=0;function we(Ee,Ce){const je=Ce*Vt+Ee;return so[je]===0&&(ne.emplaceBack(Fn[2*je+0],Fn[2*je+1],Ee*s.ai/ns,Ce*s.ai/ns),so[je]=++he),so[je]-1}function xe(Ee,Ce,je,$e,We,Ze){const Ye=Ee+je>>1,Xe=Ce+$e>>1;if(Math.abs(Ee-We)+Math.abs(Ce-Ze)>1&&zi[Xe*Vt+Ye])xe(We,Ze,Ee,Ce,Ye,Xe),xe(je,$e,We,Ze,Ye,Xe);else{const Ke=we(Ee,Ce),tt=we(je,$e),at=we(We,Ze);ee.emplaceBack(Ke,tt,at)}}return xe(0,0,ns,ns,ns,0),xe(ns,ns,0,0,0,ns),{vertices:ne,indices:ee}}(this.tileID.canonical,h);E=M.vertices,C=M.indices}else{E=new s.aU,C=new s.aV;for(const{x:j,y:H}of _)E.emplaceBack(j,H,0,0);const M=s.b9(E.int16,void 0,4);for(let j=0;j<M.length;j+=3)C.emplaceBack(M[j],M[j+1],M[j+2])}this._tileBoundsBuffer=a.createVertexBuffer(E,s.ba.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(C),this._tileBoundsSegments=s.b8.simpleSegment(0,0,E.length,C.length)}_makeGlobeTileDebugBuffers(a,h){const _=h.projection;if(!_||_.name!=="globe"||h.freezeTileCoverage)return;const E=this.tileID.canonical,C=s.bb(E,h),M=s.bc(C),j=s.ag(h.zoom);let H;j>0&&(H=s.ad.mat4.invert(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,E,h,M,H,j),this._makeGlobeTileDebugTextBuffer(a,E,h,M,H,j)}_globePoint(a,h,_,E,C,M,j){let H=s.bd(a,h,_);if(M){const G=1<<_.z,Y=s.av(E.center.lng),ne=s.aC(E.center.lat),ee=(_.x+.5)/G-Y;let he=0;ee>.5?he=-1:ee<-.5&&(he=1);let we=(a/s.ai+_.x)/G+he,xe=(h/s.ai+_.y)/G;we=(we-Y)*E._pixelsPerMercatorPixel+Y,xe=(xe-ne)*E._pixelsPerMercatorPixel+ne;const Ee=[we*E.worldSize,xe*E.worldSize,0];s.ad.vec3.transformMat4(Ee,Ee,M),H=s.be(H,Ee,j)}return s.ad.vec3.transformMat4(H,H,C)}_makeGlobeTileDebugBorderBuffer(a,h,_,E,C,M){const j=new s.b5,H=new s.b6,G=new s.bf,Y=(ee,he,we,xe,Ee)=>{const Ce=(we-ee)/(Ee-1),je=(xe-he)/(Ee-1),$e=j.length;for(let We=0;We<Ee;We++){const Ze=ee+We*Ce,Ye=he+We*je;j.emplaceBack(Ze,Ye);const Xe=this._globePoint(Ze,Ye,h,_,E,C,M);G.emplaceBack(Xe[0],Xe[1],Xe[2]),H.emplaceBack($e+We)}},ne=s.ai;Y(0,0,ne,0,16),Y(ne,0,ne,ne,16),Y(ne,ne,0,ne,16),Y(0,ne,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(H),this._tileDebugBuffer=a.createVertexBuffer(j,s.b7.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(G,s.bg.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,j.length,H.length)}_makeGlobeTileDebugTextBuffer(a,h,_,E,C,M){const j=s.ai/4,H=new s.b5,G=new s.aV,Y=new s.bf,ne=25;G.reserve(32),H.reserve(ne),Y.reserve(ne);const ee=(he,we)=>ne*he+we;for(let he=0;he<ne;he++){const we=he*j;for(let xe=0;xe<ne;xe++){const Ee=xe*j;H.emplaceBack(Ee,we);const Ce=this._globePoint(Ee,we,h,_,E,C,M);Y.emplaceBack(Ce[0],Ce[1],Ce[2])}}for(let he=0;he<4;he++)for(let we=0;we<4;we++){const xe=ee(he,we),Ee=ee(he,we+1),Ce=ee(he+1,we),je=ee(he+1,we+1);G.emplaceBack(xe,Ee,Ce),G.emplaceBack(Ce,Ee,je)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(G),this._tileDebugTextBuffer=a.createVertexBuffer(H,s.b7.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(Y,s.bg.members),this._tileDebugTextSegments=s.b8.simpleSegment(0,0,ne,32)}destroy(a=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bh.setPbf(s.bi);class mr extends qs{constructor(a,h,_,E,C){super(a,h,_,E,C),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(a){return this._mrt&&this._mrt.getLayer(a)}setTexture(a,h){const _=h.context,E=_.gl;this.texture=this.texture||h.getTileTexture(a.width),this.texture&&this.texture instanceof s.T?this.texture.update(a,{premultiply:!1}):this.texture=new s.T(_,a,E.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(a=16384,h){const _=this._mrt=new s.bh(30),E=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=s.bj(E,(C,M,j,H)=>{if(C)h(C);else try{const G=_.getHeaderLength(M);if(G>a)return void(this.request=this.fetchHeader(G,h));_.parseHeader(M),this._isHeaderLoaded=!0;let Y=0;for(const ne of Object.values(_.layers))Y=Math.max(Y,ne.dataIndex[ne.dataIndex.length-1].lastByte);M.byteLength>=Y&&(this.entireBuffer=M),h(null,this.entireBuffer||M,j,H)}catch(G){h(G)}}),this.request}fetchBand(a,h,_){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void _(new Error("Tile header is not ready"));const C=this.actor;if(!C)return void _(new Error("Can't fetch tile band without an actor"));let M;const j=(ne,ee)=>{M.complete(ne,ee),ne?_(ne):(this.updateTextureDescriptor(a,h),_(null,this.textureDescriptor&&this.textureDescriptor.img))},H=(ne,ee)=>{if(ne)return _(ne);const he=C.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ee,task:M},j,void 0,!0);this._workQueue.push(()=>{he&&he.cancel(),M.cancel()})},G=E.getLayer(a);if(!G)return void _(new Error(`Unknown sourceLayer "${a}"`));if(G.hasDataForBand(h))return this.updateTextureDescriptor(a,h),void _(null,this.textureDescriptor?this.textureDescriptor.img:null);const Y=G.getDataRange([h]);if(M=E.createDecodingTask(Y),!M||M.tasks.length)if(this.flushQueues(),this.entireBuffer)H(null,this.entireBuffer.slice(Y.firstByte,Y.lastByte+1));else{const ne=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Y.firstByte}-${Y.lastByte}`}}),ee=s.bj(ne,H);this._fetchQueue.push(()=>{ee.cancel(),M.cancel()})}else _(null)}updateNeeded(a,h){return(!this.textureDescriptor||this.textureDescriptor.band!==h||this.textureDescriptor.layer!==a)&&this.state!=="errored"}updateTextureDescriptor(a,h){if(!this._mrt)return;const _=this._mrt.getLayer(a);if(!_||!_.hasBand(h)||!_.hasDataForBand(h))return;const{bytes:E,tileSize:C,buffer:M,offset:j,scale:H}=_.getBandView(h),G=C+2*M,Y=new s.r({width:G,height:G},E),ne=this.texture;ne&&ne instanceof s.T&&ne.update(Y,{premultiply:!1}),this.textureDescriptor={layer:a,band:h,img:Y,buffer:M,offset:j,tileSize:C,format:_.pixelFormat,mix:[H,256*H,65536*H,16777216*H]}}}class js{constructor(a,h){this.max=a,this.onRemove=h,this.reset()}reset(){for(const a in this.data)for(const h of this.data[a])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(a,h,_){const E=a.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);const C={value:h,timeout:void 0};if(_!==void 0&&(C.timeout=setTimeout(()=>{this.remove(a,C)},_)),this.data[E].push(C),this.order.push(E),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const h=this.data[a].shift();return h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),h.value}getByKey(a){const h=this.data[a];return h?h[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,h){if(!this.has(a))return this;const _=a.wrapped().key,E=h===void 0?0:this.data[_].indexOf(h),C=this.data[_][E];return this.data[_].splice(E,1),C.timeout&&clearTimeout(C.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(C.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(a){const h=[];for(const _ in this.data)for(const E of this.data[_])a(E.value)||h.push(E);for(const _ of h)this.remove(_.value.tileID,_)}}class Wh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,h,_){const E=String(h);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][E]=this.stateChanges[a][E]||{},s.l(this.stateChanges[a][E],_),this.deletedStates[a]===null){this.deletedStates[a]={};for(const C in this.state[a])C!==E&&(this.deletedStates[a][C]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][E]===null){this.deletedStates[a][E]={};for(const C in this.state[a][E])_[C]||(this.deletedStates[a][E][C]=null)}else for(const C in _)this.deletedStates[a]&&this.deletedStates[a][E]&&this.deletedStates[a][E][C]===null&&delete this.deletedStates[a][E][C]}removeFeatureState(a,h,_){if(this.deletedStates[a]===null)return;const E=String(h);if(this.deletedStates[a]=this.deletedStates[a]||{},_&&h!==void 0)this.deletedStates[a][E]!==null&&(this.deletedStates[a][E]=this.deletedStates[a][E]||{},this.deletedStates[a][E][_]=null);else if(h!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][E])for(_ in this.deletedStates[a][E]={},this.stateChanges[a][E])this.deletedStates[a][E][_]=null;else this.deletedStates[a][E]=null;else this.deletedStates[a]=null}getState(a,h){const _=this.state[a]||{},E=this.stateChanges[a]||{},C=this.deletedStates[a];if(C===null)return{};if(h!==void 0){const j=String(h),H=s.l({},_[j],E[j]);if(C){const G=C[h];if(G===null)return{};for(const Y in G)delete H[Y]}return H}const M=s.l({},_,E);if(C)for(const j in C)delete M[j];return M}initializeTileState(a,h){a.refreshFeatureState(h)}coalesceChanges(a,h){const _={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const C={};for(const M in this.stateChanges[E])this.state[E][M]||(this.state[E][M]={}),s.l(this.state[E][M],this.stateChanges[E][M]),C[M]=this.state[E][M];_[E]=C}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const C={};if(this.deletedStates[E]===null)for(const M in this.state[E])C[M]={},this.state[E][M]={};else for(const M in this.deletedStates[E]){if(this.deletedStates[E][M]===null)this.state[E][M]={};else if(this.state[E][M])for(const j of Object.keys(this.deletedStates[E][M]))delete this.state[E][M][j];C[M]=this.state[E][M]}_[E]=_[E]||{},s.l(_[E],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const E in a)a[E].refreshFeatureState(h)}}class Za extends s.E{constructor(a,h,_){super(),this.id=a,this._onlySymbols=_,h.on("data",E=>{E.dataType==="source"&&E.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new js(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Wh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles)if(!this._tiles[a].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,h){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,h)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a)}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a)}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(a),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Qr).map(a=>a.key)}getRenderableIds(a,h){const _=[];for(const E in this._tiles)this._isIdRenderable(+E,a,h)&&_.push(this._tiles[E]);return a?_.sort((E,C)=>{const M=E.tileID,j=C.tileID,H=new s.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle),G=new s.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle);return M.overscaledZ-j.overscaledZ||G.y-H.y||G.x-H.x}).map(E=>E.tileID.key):_.map(E=>E.tileID).sort(Qr).map(E=>E.key)}hasRenderableParent(a){const h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(a,h,_){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())&&(_||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,h){const _=this._tiles[a];_&&(_.state!=="loading"&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,a,h)))}_tileLoaded(a,h,_,E){if(E)if(a.state="errored",E.status!==404)this._source.fire(new s.z(E,{tile:a}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:a})),!(a.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const C=this.map.painter.terrain;this.update(this.transform,C.getScaledDemTileSize(),!0),C.resetTileLookupCache(this.id)}else this.update(this.transform)}else a.timeAdded=s.q.now(),_==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const h=this.getRenderableIds();for(let E=0;E<h.length;E++){const C=h[E];if(a.neighboringTiles&&a.neighboringTiles[C]){const M=this.getTileByID(C);_(a,M),_(M,a)}}function _(E,C){if(!E.dem||E.dem.borderReady)return;E.needsHillshadePrepare=!0,E.needsDEMTextureUpload=!0;let M=C.tileID.canonical.x-E.tileID.canonical.x;const j=C.tileID.canonical.y-E.tileID.canonical.y,H=Math.pow(2,E.tileID.canonical.z),G=C.tileID.key;M===0&&j===0||Math.abs(j)>1||(Math.abs(M)>1&&(Math.abs(M+H)===1?M+=H:Math.abs(M-H)===1&&(M-=H)),C.dem&&E.dem&&(E.dem.backfillBorder(C.dem,M,j),E.neighboringTiles&&E.neighboringTiles[G]&&(E.neighboringTiles[G].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,h,_,E){for(const C in this._tiles){let M=this._tiles[C];if(E[C]||!M.hasData()||M.tileID.overscaledZ<=h||M.tileID.overscaledZ>_)continue;let j=M.tileID;for(;M&&M.tileID.overscaledZ>h+1;){const G=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[G.key],M&&M.hasData()&&(j=G)}let H=j;for(;H.overscaledZ>h;)if(H=H.scaledTo(H.overscaledZ-1),a[H.key]){E[j.key]=j;break}}}findLoadedParent(a,h){if(a.key in this._loadedParentTiles){const _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=h?_:null}for(let _=a.overscaledZ-1;_>=h;_--){const E=a.scaledTo(_),C=this._getLoadedTile(E);if(C)return C}}_getLoadedTile(a){const h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,h){h=h||this._source.tileSize;const _=Math.ceil(a.width/h)+1,E=Math.ceil(a.height/h)+1,C=Math.floor(_*E*5),M=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,C):C,j=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(j)}handleWrapJump(a){const h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){const _={};for(const E in this._tiles){const C=this._tiles[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),_[C.tileID.key]=C}this._tiles=_;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(+E,this._tiles[E])}}update(a,h,_,E){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(a,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const C=this._source.type==="batched-model";let M,j=this._source.maxzoom;const H=this.map&&this.map.painter?this.map.painter._terrain:null;if(H&&H.sourceCache===this&&H.attenuationRange()){const ne=H.attenuationRange()[0],ee=Math.floor(ne)-Math.log2(H.getDemUpscale());j>ee&&(j=ee)}if(this.used||this.usedForTerrain){if(this._source.tileID)M=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(ne=>new s.aH(ne.canonical.z,ne.wrap,ne.canonical.z,ne.canonical.x,ne.canonical.y));else if(this.tileCoverLift!==0){const ne=a.clone();ne.tileCoverLift=this.tileCoverLift,M=ne.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:j,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:C}),this._source.minzoom<=1&&a.projection.name==="globe"&&(M.push(new s.aH(1,0,1,0,0)),M.push(new s.aH(1,0,1,1,0)),M.push(new s.aH(1,0,1,0,1)),M.push(new s.aH(1,0,1,1,1)))}else if(M=a.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:j,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:C}),this._source.hasTile){const ne=this._source.hasTile.bind(this._source);M=M.filter(ee=>ne(ee))}}else M=[];if(M.length>0&&this.castsShadows&&E&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ja(this._source.type)){const ne=a.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),ee=Math.min(ne,this._source.maxzoom);if(C){const he=a.extendTileCover(M,ee);for(const we of he)M.push(we)}else{const he=a.extendTileCover(M,ee,E);for(const we of he)this._shadowCasterTiles[we.key]=!0,M.push(we)}}const G=this._updateRetainedTiles(M);if(ja(this._source.type)&&M.length!==0){const ne={},ee={},he=Object.keys(G);for(const xe of he){const Ee=G[xe],Ce=this._tiles[xe];if(!Ce||Ce.fadeEndTime&&Ce.fadeEndTime<=s.q.now())continue;const je=this.findLoadedParent(Ee,Math.max(Ee.overscaledZ-Za.maxOverzooming,this._source.minzoom));je&&(this._addTile(je.tileID),ne[je.tileID.key]=je.tileID),ee[xe]=Ee}const we=M[M.length-1].overscaledZ;for(const xe in this._tiles){const Ee=this._tiles[xe];if(G[xe]||!Ee.hasData())continue;let Ce=Ee.tileID;for(;Ce.overscaledZ>we;){Ce=Ce.scaledTo(Ce.overscaledZ-1);const je=this._tiles[Ce.key];if(je&&je.hasData()&&ee[Ce.key]){G[xe]=Ee.tileID;break}}}for(const xe in ne)G[xe]||(this._coveredTiles[xe]=!0,G[xe]=ne[xe])}for(const ne in G)this._tiles[ne].clearFadeHold();const Y=s.bk(this._tiles,G);for(const ne of Y){const ee=this._tiles[ne];ee.hasSymbolBuckets&&!ee.holdingForFade()?ee.setHoldDuration(this.map._fadeDuration):ee.hasSymbolBuckets&&!ee.symbolFadeFinished()||this._removeTile(+ne)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const h={};if(a.length===0)return h;const _={},E=a.reduce((G,Y)=>Math.min(G,Y.overscaledZ),1/0),C=a[0].overscaledZ,M=Math.max(C-Za.maxOverzooming,this._source.minzoom),j=Math.max(C+Za.maxUnderzooming,this._source.minzoom),H={};for(const G of a){const Y=this._addTile(G);h[G.key]=G,Y.hasData()||E<this._source.maxzoom&&(H[G.key]=G)}this._retainLoadedChildren(H,E,j,h);for(const G of a){let Y=this._tiles[G.key];if(Y.hasData())continue;if(G.canonical.z>=this._source.maxzoom){const ee=G.children(this._source.maxzoom)[0],he=this.getTile(ee);if(he&&he.hasData()){h[ee.key]=ee;continue}}else{const ee=G.children(this._source.maxzoom);if(h[ee[0].key]&&h[ee[1].key]&&h[ee[2].key]&&h[ee[3].key])continue}let ne=Y.wasRequested();for(let ee=G.overscaledZ-1;ee>=M;--ee){const he=G.scaledTo(ee);if(_[he.key]||(_[he.key]=!0,Y=this.getTile(he),!Y&&ne&&(Y=this._addTile(he)),Y&&(h[he.key]=he,ne=Y.wasRequested(),Y.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const h=[];let _,E=this._tiles[a].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){_=this._loadedParentTiles[E.key];break}h.push(E.key);const C=E.scaledTo(E.overscaledZ-1);if(_=this._getLoadedTile(C),_)break;E=C}for(const C of h)this._loadedParentTiles[C]=_}}_addTile(a){let h=this._tiles[a.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),h;h=this._cache.getAndRemove(a),h&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));const _=!!h;if(!_){const E=this.map?this.map.painter:null,C=this._source.tileSize*a.overscaleFactor();h=this._source.type==="raster-array"?new mr(a,C,this.transform.tileZoom,E,this._isRaster):new qs(a,C,this.transform.tileZoom,E,this._isRaster),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))}return h?(h.uses++,this._tiles[a.key]=h,_||this._source.fire(new s.A("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null}_setTileReloadTimer(a,h){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const _=h.getExpiryTimeout();_&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},_))}_removeTile(a){const h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,h,_){const E=[],C=this.transform;if(!C)return E;const M=C.projection.name==="globe",j=s.av(C.center.lng);for(const H in this._tiles){const G=this._tiles[H];if(_&&G.clearQueryDebugViz(),G.holdingForFade())continue;let Y;if(M){const ne=G.tileID.canonical;if(ne.z===0){const ee=[Math.abs(s.ay(j,...Wn(ne,-1))-j),Math.abs(s.ay(j,...Wn(ne,1))-j)];Y=[0,2*ee.indexOf(Math.min(...ee))-1]}else{const ee=[Math.abs(s.ay(j,...Wn(ne,-1))-j),Math.abs(s.ay(j,...Wn(ne,0))-j),Math.abs(s.ay(j,...Wn(ne,1))-j)];Y=[ee.indexOf(Math.min(...ee))-1]}}else Y=[0];for(const ne of Y){const ee=a.containsTile(G,C,h,ne);ee&&E.push(ee)}}return E}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,h){const _=this.getRenderableIds(a,h).map(C=>this._tiles[C].tileID),E=this.transform.projection.name==="globe";for(const C of _)C.projMatrix=this.transform.calculateProjMatrix(C.toUnwrapped()),C.expandedProjMatrix=E?this.transform.calculateProjMatrix(C.toUnwrapped(),!1,!0):C.projMatrix;return _}sortCoordinatesByDistance(a){const h=a.slice(),_=this.transform._camera.position,E=this.transform._camera.forward(),C={};for(const M of h){const j=1/(1<<M.canonical.z);C[M.key]=((M.canonical.x+.5)*j+M.wrap-_[0])*E[0]+((M.canonical.y+.5)*j-_[1])*E[1]-_[2]*E[2]}return h.sort((M,j)=>C[M.key]-C[j.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(ja(this._source.type))for(const a in this._tiles){const h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(a,h,_){this._state.updateState(a=a||"_geojsonTileLayer",h,_)}removeFeatureState(a,h,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,_)}getFeatureState(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)}setDependencies(a,h,_){const E=this._tiles[a];E&&E.setDependencies(h,_)}reloadTilesForDependencies(a,h){for(const _ in this._tiles)this._tiles[_].hasDependency(a,h)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(a,h))}_preloadTiles(a,h){if(!this._sourceLoaded){const H=()=>{this._sourceLoaded&&(this._source.off("data",H),this._preloadTiles(a,h))};return void this._source.on("data",H)}const _=new Map,E=Array.isArray(a)?a:[a],C=this.map.painter.terrain,M=this.usedForTerrain&&C?C.getScaledDemTileSize():this._source.tileSize;for(const H of E){const G=H.coveringTiles({tileSize:M,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Y of G)_.set(Y.key,Y);this.usedForTerrain&&H.updateElevation(!1)}const j=Array.from(_.values());s.bl(j,(H,G)=>{const Y=new qs(H,this._source.tileSize*H.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Y,ne=>{this._source.type==="raster-dem"&&Y.dem&&this._backfillDEM(Y),G(ne,Y)})},h)}}function Qr(y,a){const h=Math.abs(2*y.wrap)-+(y.wrap<0),_=Math.abs(2*a.wrap)-+(a.wrap<0);return y.overscaledZ-a.overscaledZ||_-h||a.canonical.y-y.canonical.y||a.canonical.x-y.canonical.x}function ja(y){return y==="raster"||y==="image"||y==="video"||y==="custom"}function Wn(y,a){const h=1<<y.z;return[y.x/h+a,(y.x+1)/h+a]}Za.maxOverzooming=10,Za.maxUnderzooming=3;class Bd{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const a=!1,h=!1;for(const _ in this.style._mergedLayers){const E=this.style._mergedLayers[_];if(E.type==="fill-extrusion")this.layers.push({layer:E,visible:a,visibilityChanged:h});else if(E.type==="model"){const C=this.style.getLayerSource(E);C&&C.type==="batched-model"&&this.layers.push({layer:E,visible:a,visibilityChanged:h})}}}onNewFrame(a){this.layersGotHidden=!1;for(const h of this.layers){const _=h.layer;let E=!1;_.type==="fill-extrusion"?E=!_.isHidden(a)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(E=!_.isHidden(a)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!E&&h.visible,h.visible=E}}updateZOffset(a,h){this.currentBuildingBuckets=[];for(const E of this.layers){const C=E.layer,M=this.style.getLayerSourceCache(C);let j=1;C.type==="fill-extrusion"&&(j=E.visible?C.paint.get("fill-extrusion-vertical-scale"):0);let H=M?M.getTile(h):null;if(!H&&M&&h.canonical.z>M.getSource().minzoom){let G=h.scaledTo(Math.min(M.getSource().maxzoom,h.overscaledZ-1));for(;G.overscaledZ>=M.getSource().minzoom&&(H=M.getTile(G),!H&&G.overscaledZ!==0);)G=G.scaledTo(G.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:H?H.getBucket(C):null,tileID:H?H.tileID:h,verticalScale:j})}a.hasAnyZOffset=!1;let _=!1;for(let E=0;E<a.symbolInstances.length;E++){const C=a.symbolInstances.get(E),M=C.zOffset,j=this._getHeightAtTileOffset(h,C.tileAnchorX,C.tileAnchorY);C.zOffset=j!==Number.NEGATIVE_INFINITY?j:M,_||M===C.zOffset||(_=!0),a.hasAnyZOffset||C.zOffset===0||(a.hasAnyZOffset=!0)}_&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,h,_,E){let C=h,M=_;if(a.canonical.z!==E.canonical.z){const j=E.canonical,H=1/(1<<a.canonical.z-j.z);C=(h+a.canonical.x*s.ai)*H-j.x*s.ai|0,M=(_+a.canonical.y*s.ai)*H-j.y*s.ai|0}return{tileX:C,tileY:M}}_getHeightAtTileOffset(a,h,_){let E,C;for(let M=0;M<this.layers.length;++M){if(this.layers[M].layer.type!=="fill-extrusion")continue;const{bucket:j,tileID:H,verticalScale:G}=this.currentBuildingBuckets[M];if(!j)continue;const{tileX:Y,tileY:ne}=this._mapCoordToOverlappingTile(a,h,_,H),ee=j.getHeightAtTileCoord(Y,ne);ee&&ee.height!==void 0&&(ee.hidden?E=ee.height:C=Math.max(ee.height*G,C||0))}if(C!==void 0)return C;for(let M=0;M<this.layers.length;++M){const j=this.layers[M];if(j.layer.type!=="model"||!j.visible)continue;const{bucket:H,tileID:G}=this.currentBuildingBuckets[M];if(!H)continue;const{tileX:Y,tileY:ne}=this._mapCoordToOverlappingTile(a,h,_,G),ee=H.getHeightAtTileCoord(Y,ne);if(ee&&!ee.hidden)return ee.height===void 0&&E!==void 0?Math.min(ee.maxHeight,E)*ee.verticalScale:ee.height?ee.height*ee.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function fo(y,a){const h={};for(const _ in y)_!=="ref"&&(h[_]=y[_]);return s.bm.forEach(_=>{_ in a&&(h[_]=a[_])}),h}function ba(y){y=y.slice();const a=Object.create(null);for(let h=0;h<y.length;h++)a[y[h].id]=y[h];for(let h=0;h<y.length;h++)"ref"in y[h]&&(y[h]=fo(y[h],a[y[h].ref]));return y}const Or={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ir(y,a,h){h.push({command:Or.addSource,args:[y,a[y]]})}function $h(y,a,h){a.push({command:Or.removeSource,args:[y]}),h[y]=!0}function Vr(y,a,h,_){$h(y,h,_),Ir(y,a,h)}function vn(y,a,h){let _;for(_ in y[h])if(y[h].hasOwnProperty(_)&&_!=="data"&&!s.bn(y[h][_],a[h][_]))return!1;for(_ in a[h])if(a[h].hasOwnProperty(_)&&_!=="data"&&!s.bn(y[h][_],a[h][_]))return!1;return!0}function ui(y,a,h,_,E,C){let M;for(M in a=a||{},y=y||{})y.hasOwnProperty(M)&&(s.bn(y[M],a[M])||h.push({command:C,args:[_,M,a[M],E]}));for(M in a)a.hasOwnProperty(M)&&!y.hasOwnProperty(M)&&(s.bn(y[M],a[M])||h.push({command:C,args:[_,M,a[M],E]}))}function Ur(y){return y.id}function oo(y,a){return y[a.id]=a,y}class Va{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.ay(a,0,1);let h=1,_=this._distances[h];const E=a*this.paddedLength+this.padding;for(;_<E&&h<this._distances.length;)_=this._distances[++h];const C=h-1,M=this._distances[C],j=_-M,H=j>0?(E-M)/j:0;return this.points[C].mult(1-H).add(this.points[h].mult(H))}}class Yr{constructor(a,h,_){const E=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(h/_);for(let M=0;M<this.xCellCount*this.yCellCount;M++)E.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,_,E,C){this._forEachCell(h,_,E,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(E),this.bboxes.push(C)}insertCircle(a,h,_,E){this._forEachCell(h-E,_-E,h+E,_+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(_),this.circles.push(E)}_insertBoxCell(a,h,_,E,C,M){this.boxCells[C].push(M)}_insertCircleCell(a,h,_,E,C,M){this.circleCells[C].push(M)}_query(a,h,_,E,C,M){if(_<0||a>this.width||E<0||h>this.height)return!C&&[];const j=[];if(a<=0&&h<=0&&this.width<=_&&this.height<=E){if(C)return!0;for(let H=0;H<this.boxKeys.length;H++)j.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const G=this.circles[3*H],Y=this.circles[3*H+1],ne=this.circles[3*H+2];j.push({key:this.circleKeys[H],x1:G-ne,y1:Y-ne,x2:G+ne,y2:Y+ne})}return M?j.filter(M):j}return this._forEachCell(a,h,_,E,this._queryCell,j,{hitTest:C,seenUids:{box:{},circle:{}}},M),C?j.length>0:j}_queryCircle(a,h,_,E,C){const M=a-_,j=a+_,H=h-_,G=h+_;if(j<0||M>this.width||G<0||H>this.height)return!E&&[];const Y=[];return this._forEachCell(M,H,j,G,this._queryCellCircle,Y,{hitTest:E,circle:{x:a,y:h,radius:_},seenUids:{box:{},circle:{}}},C),E?Y.length>0:Y}query(a,h,_,E,C){return this._query(a,h,_,E,!1,C)}hitTest(a,h,_,E,C){return this._query(a,h,_,E,!0,C)}hitTestCircle(a,h,_,E){return this._queryCircle(a,h,_,!0,E)}_queryCell(a,h,_,E,C,M,j,H){const G=j.seenUids,Y=this.boxCells[C];if(Y!==null){const ee=this.bboxes;for(const he of Y)if(!G.box[he]){G.box[he]=!0;const we=4*he;if(a<=ee[we+2]&&h<=ee[we+3]&&_>=ee[we+0]&&E>=ee[we+1]&&(!H||H(this.boxKeys[he]))){if(j.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[he],x1:ee[we],y1:ee[we+1],x2:ee[we+2],y2:ee[we+3]})}}}const ne=this.circleCells[C];if(ne!==null){const ee=this.circles;for(const he of ne)if(!G.circle[he]){G.circle[he]=!0;const we=3*he;if(this._circleAndRectCollide(ee[we],ee[we+1],ee[we+2],a,h,_,E)&&(!H||H(this.circleKeys[he]))){if(j.hitTest)return M.push(!0),!0;{const xe=ee[we],Ee=ee[we+1],Ce=ee[we+2];M.push({key:this.circleKeys[he],x1:xe-Ce,y1:Ee-Ce,x2:xe+Ce,y2:Ee+Ce})}}}}}_queryCellCircle(a,h,_,E,C,M,j,H){const G=j.circle,Y=j.seenUids,ne=this.boxCells[C];if(ne!==null){const he=this.bboxes;for(const we of ne)if(!Y.box[we]){Y.box[we]=!0;const xe=4*we;if(this._circleAndRectCollide(G.x,G.y,G.radius,he[xe+0],he[xe+1],he[xe+2],he[xe+3])&&(!H||H(this.boxKeys[we])))return M.push(!0),!0}}const ee=this.circleCells[C];if(ee!==null){const he=this.circles;for(const we of ee)if(!Y.circle[we]){Y.circle[we]=!0;const xe=3*we;if(this._circlesCollide(he[xe],he[xe+1],he[xe+2],G.x,G.y,G.radius)&&(!H||H(this.circleKeys[we])))return M.push(!0),!0}}}_forEachCell(a,h,_,E,C,M,j,H){const G=this._convertToXCellCoord(a),Y=this._convertToYCellCoord(h),ne=this._convertToXCellCoord(_),ee=this._convertToYCellCoord(E);for(let he=G;he<=ne;he++)for(let we=Y;we<=ee;we++)if(C.call(this,a,h,_,E,this.xCellCount*we+he,M,j,H))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,_,E,C,M){const j=E-a,H=C-h,G=_+M;return G*G>j*j+H*H}_circleAndRectCollide(a,h,_,E,C,M,j){const H=(M-E)/2,G=Math.abs(a-(E+H));if(G>H+_)return!1;const Y=(j-C)/2,ne=Math.abs(h-(C+Y));if(ne>Y+_)return!1;if(G<=H||ne<=Y)return!0;const ee=G-H,he=ne-Y;return ee*ee+he*he<=_*_}}const Oo={unknown:0,flipRequired:1,flipNotRequired:2},Pl=Math.tan(85*Math.PI/180);function sa(y,a,h,_,E,C,M){const j=s.ad.mat4.create();if(h)if(C.name==="globe"){const H=s.bo(E,a);s.ad.mat4.multiply(j,j,H)}else{const H=s.ad.mat2.invert([],M);j[0]=H[0],j[1]=H[1],j[4]=H[2],j[5]=H[3],_||s.ad.mat4.rotateZ(j,j,E.angle)}else s.ad.mat4.multiply(j,E.labelPlaneMatrix,y);return j}function Ci(y,a,h,_,E,C,M){const j=sa(y,a,h,_,E,C,M);return C.name==="globe"&&h||(j[2]=j[6]=j[10]=j[14]=0),j}function us(y,a,h,_,E,C,M){if(h){if(C.name==="globe"){const j=sa(y,a,h,_,E,C,M);return s.ad.mat4.invert(j,j),s.ad.mat4.multiply(j,y,j),j}{const j=s.ad.mat4.clone(y),H=s.ad.mat4.identity([]);return H[0]=M[0],H[1]=M[1],H[4]=M[2],H[5]=M[3],s.ad.mat4.multiply(j,j,H),_||s.ad.mat4.rotateZ(j,j,-E.angle),j}}return E.glCoordMatrix}function oa(y,a,h,_){const E=[y,a,h,1];h?s.ad.vec4.transformMat4(E,E,_):Ki(E,E,_);const C=E[3];return E[0]/=C,E[1]/=C,E[2]/=C,E}function po(y,a){return Math.min(.5+y/a*.5,1.5)}function Qu(y,a){const h=y[0]/y[3],_=y[1]/y[3];return h>=-a[0]&&h<=a[0]&&_>=-a[1]&&_<=a[1]}function Cc(y,a,h,_,E,C,M,j,H,G){const Y=h.transform,ne=_?y.textSizeData:y.iconSizeData,ee=s.bp(ne,h.transform.zoom),he=Y.projection.name==="globe",we=[256/h.width*2+1,256/h.height*2+1],xe=_?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;xe.clear();let Ee=null;he&&(Ee=_?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const Ce=y.lineVertexArray,je=_?y.text.placedSymbolArray:y.icon.placedSymbolArray,$e=h.transform.width/h.transform.height;let We,Ze=!1;for(let Ye=0;Ye<je.length;Ye++){const Xe=je.get(Ye),{numGlyphs:Ke,writingMode:tt}=Xe;if(tt!==s.bq.vertical||Ze||We===s.bq.horizontal||(Ze=!0),We=tt,(Xe.hidden||tt===s.bq.vertical)&&!Ze){aa(Ke,xe);continue}Ze=!1;const at=new s.P(Xe.tileAnchorX,Xe.tileAnchorY);let{x:At,y:xt,z:Bt}=Y.projection.projectTilePoint(at.x,at.y,G.canonical);if(H){const[pn,xn,kn]=H(at);At+=pn,xt+=xn,Bt+=kn}const zt=[At,xt,Bt,1];if(s.ad.vec4.transformMat4(zt,zt,a),!Qu(zt,we)){aa(Ke,xe);continue}const Jt=zt[3],yt=po(h.transform.getCameraToCenterDistance(Y.projection),Jt),Ft=s.br(ne,ee,Xe),gt=M?Ft/yt:Ft*yt,Lt=oa(At,xt,Bt,E);if(Lt[3]<=0){aa(Ke,xe);continue}let kt={};const Ut=s.ak(y.layers[0].layout.get("text-max-angle")),Rt=Math.cos(Ut),Wt=M?null:H,dn=Rs(Xe,gt,!1,j,a,E,C,y.glyphOffsetArray,Ce,xe,Ee,Lt,at,kt,$e,Wt,Y.projection,G,M,Rt);Ze=dn.useVertical,Wt&&dn.needsFlipping&&(kt={}),(dn.notEnoughRoom||Ze||dn.needsFlipping&&Rs(Xe,gt,!0,j,a,E,C,y.glyphOffsetArray,Ce,xe,Ee,Lt,at,kt,$e,Wt,Y.projection,G,M,Rt).notEnoughRoom)&&aa(Ke,xe)}_?(y.text.dynamicLayoutVertexBuffer.updateData(xe),Ee&&y.text.globeExtVertexBuffer&&y.text.globeExtVertexBuffer.updateData(Ee)):(y.icon.dynamicLayoutVertexBuffer.updateData(xe),Ee&&y.icon.globeExtVertexBuffer&&y.icon.globeExtVertexBuffer.updateData(Ee))}function Ic(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee){const{lineStartIndex:Ce,glyphStartIndex:je,segment:$e}=j,We=je+j.numGlyphs,Ze=Ce+j.lineLength,Ye=a.getoffsetX(je),Xe=a.getoffsetX(We-1),Ke=Dl(y*Ye,h,_,E,C,M,$e,Ce,Ze,H,G,Y,ne,ee,!0,he,we,xe,Ee);if(!Ke)return null;const tt=Dl(y*Xe,h,_,E,C,M,$e,Ce,Ze,H,G,Y,ne,ee,!0,he,we,xe,Ee);return tt?{first:Ke,last:tt}:null}function Cu(y,a,h,_){return y===s.bq.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:y===s.bq.vertical?_>0?{needsFlipping:!0}:null:a!==Oo.unknown&&function(E,C){return E===0||Math.abs(C/E)>Pl}(h,_)?a===Oo.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Rs(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee,Ce,je,$e){const We=a/24,Ze=y.lineOffsetX*We,Ye=y.lineOffsetY*We,{lineStartIndex:Xe,glyphStartIndex:Ke,numGlyphs:tt,segment:at,writingMode:At,flipState:xt}=y,Bt=Xe+y.lineLength,zt=Jt=>{if(Y){const[Lt,kt,Ut]=Jt.up,Rt=G.length;s.bs(Y,Rt+0,Lt,kt,Ut),s.bs(Y,Rt+1,Lt,kt,Ut),s.bs(Y,Rt+2,Lt,kt,Ut),s.bs(Y,Rt+3,Lt,kt,Ut)}const[yt,Ft,gt]=Jt.point;s.bt(G,yt,Ft,gt,Jt.angle)};if(tt>1){const Jt=Ic(We,j,Ze,Ye,h,ne,ee,y,H,C,he,xe,!1,Ee,Ce,je,$e);if(!Jt)return{notEnoughRoom:!0};if(_&&!h){let[yt,Ft,gt]=Jt.first.point,[Lt,kt,Ut]=Jt.last.point;[yt,Ft]=oa(yt,Ft,gt,M),[Lt,kt]=oa(Lt,kt,Ut,M);const Rt=Cu(At,xt,(Lt-yt)*we,kt-Ft);if(y.flipState=Rt&&Rt.needsFlipping?Oo.flipRequired:Oo.flipNotRequired,Rt)return Rt}zt(Jt.first);for(let yt=Ke+1;yt<Ke+tt-1;yt++){const Ft=Dl(We*j.getoffsetX(yt),Ze,Ye,h,ne,ee,at,Xe,Bt,H,C,he,xe,!1,!1,Ee,Ce,je,$e);if(!Ft)return G.length-=4*(yt-Ke),{notEnoughRoom:!0};zt(Ft)}zt(Jt.last)}else{if(_&&!h){const yt=oa(ee.x,ee.y,0,E),Ft=Xe+at+1,gt=new s.P(H.getx(Ft),H.gety(Ft)),Lt=oa(gt.x,gt.y,0,E),kt=Lt[3]>0?Lt:hi(ee,gt,yt,1,E,void 0,Ee,Ce.canonical),Ut=Cu(At,xt,(kt[0]-yt[0])*we,kt[1]-yt[1]);if(y.flipState=Ut&&Ut.needsFlipping?Oo.flipRequired:Oo.flipNotRequired,Ut)return Ut}const Jt=Dl(We*j.getoffsetX(Ke),Ze,Ye,h,ne,ee,at,Xe,Bt,H,C,he,xe,!1,!1,Ee,Ce,je,$e);if(!Jt)return{notEnoughRoom:!0};zt(Jt)}return{}}function hl(y,a,h,_,E){const{x:C,y:M,z:j}=_.projectTilePoint(y.x,y.y,a);if(!E)return oa(C,M,j,h);const[H,G,Y]=E(y);return oa(C+H,M+G,j+Y,h)}function hi(y,a,h,_,E,C,M,j){const H=hl(y.sub(a)._unit()._add(y),j,E,M,C);return s.ad.vec3.sub(H,h,H),s.ad.vec3.normalize(H,H),s.ad.vec3.scaleAndAdd(H,h,H,_)}function Dl(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee,Ce,je){const $e=_?y-a:y+a;let We=$e>0?1:-1,Ze=0;_&&(We*=-1,Ze=Math.PI),We<0&&(Ze+=Math.PI);let Ye=j+M+(We>0?0:1)|0,Xe=E,Ke=E,tt=0,at=0;const At=Math.abs($e),xt=[],Bt=[];let zt=C,Jt=zt,yt=s.ad.vec3.zero([]);const Ft=()=>hi(Jt,zt,Ke,At-tt+1,Y,ee,xe,Ee.canonical);for(;tt+at<=At;){if(Ye+=We,Ye<j||Ye>=H)return null;if(Ke=Xe,Jt=zt,xt.push(Ke),he&&Bt.push(Jt),zt=new s.P(G.getx(Ye),G.gety(Ye)),Xe=ne[Ye],!Xe){const kn=hl(zt,Ee.canonical,Y,xe,ee);Xe=kn[3]>0?ne[Ye]=kn:Ft()}tt+=at;const pn=s.ad.vec3.sub([],Xe,Ke),xn=s.ad.vec3.distance(Ke,Xe);if(h&&xn>0&&at>0&&s.ad.vec3.dot(yt,pn)/(at*xn)<je)return null;at=xn,yt=pn}we&&ee&&(ne[Ye]&&(Xe=Ft(),at=s.ad.vec3.distance(Ke,Xe),yt=s.ad.vec3.sub([],Xe,Ke)),ne[Ye]=Xe);const gt=(At-tt)/at,Lt=zt.sub(Jt)._mult(gt)._add(Jt),kt=s.ad.vec3.scaleAndAdd([],Ke,yt,gt);let Ut=[0,0,1],Rt=yt[0],Wt=yt[1];if(Ce&&(Ut=xe.upVector(Ee.canonical,Lt.x,Lt.y),Ut[0]!==0||Ut[1]!==0||Ut[2]!==1)){const pn=[Ut[2],0,-Ut[0]],xn=s.ad.vec3.cross([],Ut,pn);s.ad.vec3.normalize(pn,pn),s.ad.vec3.normalize(xn,xn),Rt=s.ad.vec3.dot(yt,pn),Wt=s.ad.vec3.dot(yt,xn)}if(h){const pn=s.ad.vec3.cross([],Ut,yt);s.ad.vec3.normalize(pn,pn),s.ad.vec3.scaleAndAdd(kt,kt,pn,h*We)}const dn=Ze+Math.atan2(Wt,Rt);return xt.push(kt),he&&Bt.push(Lt),{point:kt,angle:dn,path:xt,tilePath:Bt,up:Ut}}function aa(y,a){const h=a.length,_=h+4*y;a.resize(_),a.float32.fill(-1/0,4*h,4*_)}function Ki(y,a,h){const _=a[0],E=a[1];return y[0]=h[0]*_+h[4]*E+h[12],y[1]=h[1]*_+h[5]*E+h[13],y[3]=h[3]*_+h[7]*E+h[15],y}const Gs=100;class Zt{constructor(a,h,_=new Yr(a.width+200,a.height+200,25),E=new Yr(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=E,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Gs,this.screenBottomBoundary=a.height+Gs,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,_,E,C,M,j,H){let G=_.projectedAnchorX,Y=_.projectedAnchorY,ne=_.projectedAnchorZ;const ee=_.elevation,he=_.tileID,we=a.getProjection();if(ee&&he){const[Ye,Xe,Ke]=we.upVector(he.canonical,_.tileAnchorX,_.tileAnchorY),tt=we.upVectorScale(he.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;G+=Ye*ee*tt,Y+=Xe*ee*tt,ne+=Ke*ee*tt}const xe=this.projectAndGetPerspectiveRatio(j,G,Y,ne,_.tileID,we.name==="globe"||!!ee||this.transform.pitch>0,we),Ee=M*xe.perspectiveRatio,Ce=(_.x1*h+E.x-_.padding)*Ee+xe.point.x,je=(_.y1*h+E.y-_.padding)*Ee+xe.point.y,$e=(_.x2*h+E.x+_.padding)*Ee+xe.point.x,We=(_.y2*h+E.y+_.padding)*Ee+xe.point.y,Ze=xe.perspectiveRatio<=.55||xe.occluded;return!this.isInsideGrid(Ce,je,$e,We)||!C&&this.grid.hitTest(Ce,je,$e,We,H)||Ze?{box:[],offscreen:!1,occluded:xe.occluded}:{box:[Ce,je,$e,We],offscreen:this.isOffscreen(Ce,je,$e,We),occluded:!1}}placeCollisionCircles(a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe){const Ee=[],Ce=this.transform.elevation,je=a.getProjection(),$e=Ce?Ce.getAtTileOffsetFunc(xe,this.transform.center.lat,this.transform.worldSize,je):null,We=new s.P(_.tileAnchorX,_.tileAnchorY);let{x:Ze,y:Ye,z:Xe}=je.projectTilePoint(We.x,We.y,xe.canonical);if($e){const[Ut,Rt,Wt]=$e(We);Ze+=Ut,Ye+=Rt,Xe+=Wt}const Ke=je.name==="globe",tt=this.projectAndGetPerspectiveRatio(j,Ze,Ye,Xe,xe,Ke||!!Ce||this.transform.pitch>0,je),{perspectiveRatio:at}=tt,At=(ne?M/at:M*at)/s.bw,xt=oa(Ze,Ye,Xe,H),Bt=_.lineOffsetX*At,zt=_.lineOffsetY*At,Jt=s.ak(a.layers[0].layout.get("text-max-angle")),yt=Math.cos(Jt),Ft=tt.signedDistanceFromCamera>0?Ic(At,C,Bt,zt,!1,xt,We,_,E,H,{},Ce&&!ne?$e:null,ne&&!!Ce,je,xe,ne,yt):null;let gt=!1,Lt=!1,kt=!0;if(Ft&&!tt.occluded){const Ut=.5*he*at+we,Rt=new s.P(-100,-100),Wt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),dn=new Va,{first:pn,last:xn}=Ft,kn=pn.path.length;let gr=[];for(let sr=kn-1;sr>=1;sr--)gr.push(pn.path[sr]);for(let sr=1;sr<xn.path.length;sr++)gr.push(xn.path[sr]);const Qn=2.5*Ut;G&&(gr=gr.map(([sr,Kr,vi],Zi)=>($e&&!Ke&&(vi=$e(Zi<kn-1?pn.tilePath[kn-1-Zi]:xn.tilePath[Zi-kn+2])[2]),oa(sr,Kr,vi,G))),gr.some(sr=>sr[3]<=0)&&(gr=[]));let dr=[];if(gr.length>0){let sr=1/0,Kr=-1/0,vi=1/0,Zi=-1/0;for(const Br of gr)sr=Math.min(sr,Br[0]),vi=Math.min(vi,Br[1]),Kr=Math.max(Kr,Br[0]),Zi=Math.max(Zi,Br[1]);Kr>=Rt.x&&sr<=Wt.x&&Zi>=Rt.y&&vi<=Wt.y&&(dr=[gr.map(Br=>new s.P(Br[0],Br[1]))],(sr<Rt.x||Kr>Wt.x||vi<Rt.y||Zi>Wt.y)&&(dr=s.bu(dr,Rt.x,Rt.y,Wt.x,Wt.y)))}for(const sr of dr){dn.reset(sr,.25*Ut);let Kr=0;Kr=dn.length<=.5*Ut?1:Math.ceil(dn.paddedLength/Qn)+1;for(let vi=0;vi<Kr;vi++){const Zi=vi/Math.max(Kr-1,1),Br=dn.lerp(Zi),vs=Br.x+Gs,yr=Br.y+Gs;Ee.push(vs,yr,Ut,0);const Nn=vs-Ut,ei=yr-Ut,Ai=vs+Ut,mi=yr+Ut;if(kt=kt&&this.isOffscreen(Nn,ei,Ai,mi),Lt=Lt||this.isInsideGrid(Nn,ei,Ai,mi),!h&&this.grid.hitTestCircle(vs,yr,Ut,ee)&&(gt=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:gt,occluded:!1}}}}return{circles:!Y&&gt||!Lt?[]:Ee,offscreen:kt,collisionDetected:gt,occluded:tt.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,E=1/0,C=-1/0,M=-1/0;for(const Y of a){const ne=new s.P(Y.x+Gs,Y.y+Gs);_=Math.min(_,ne.x),E=Math.min(E,ne.y),C=Math.max(C,ne.x),M=Math.max(M,ne.y),h.push(ne)}const j=this.grid.query(_,E,C,M).concat(this.ignoredGrid.query(_,E,C,M)),H={},G={};for(const Y of j){const ne=Y.key;if(H[ne.bucketInstanceId]===void 0&&(H[ne.bucketInstanceId]={}),H[ne.bucketInstanceId][ne.featureIndex])continue;const ee=[new s.P(Y.x1,Y.y1),new s.P(Y.x2,Y.y1),new s.P(Y.x2,Y.y2),new s.P(Y.x1,Y.y2)];s.bv(h,ee)&&(H[ne.bucketInstanceId][ne.featureIndex]=!0,G[ne.bucketInstanceId]===void 0&&(G[ne.bucketInstanceId]=[]),G[ne.bucketInstanceId].push(ne.featureIndex))}return G}insertCollisionBox(a,h,_,E,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:E,collisionGroupID:C},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,_,E,C){const M=h?this.ignoredGrid:this.grid,j={bucketInstanceId:_,featureIndex:E,collisionGroupID:C};for(let H=0;H<a.length;H+=4)M.insertCircle(j,a[H],a[H+1],a[H+2])}projectAndGetPerspectiveRatio(a,h,_,E,C,M,j){const H=[h,_,E,1];let G=!1;E||this.transform.pitch>0?(s.ad.vec4.transformMat4(H,H,a),this.fogState&&C&&j.name!=="globe"&&(G=function(ee,he,we,xe,Ee,Ce){const je=Ce.calculateFogTileMatrix(Ee),$e=[he,we,xe];return s.ad.vec3.transformMat4($e,$e,je),yn(ee,s.ad.vec3.length($e),Ce.pitch,Ce._fov)}(this.fogState,h,_,E,C.toUnwrapped(),this.transform)>.9)):Ki(H,H,a);const Y=H[3];return{point:new s.P((H[0]/Y+1)/2*this.transform.width+Gs,(-H[1]/Y+1)/2*this.transform.height+Gs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(j)/Y*.5,1.5),signedDistanceFromCamera:Y,occluded:M&&H[2]>Y||G}}isOffscreen(a,h,_,E){return _<Gs||a>=this.screenRightBoundary||E<Gs||h>this.screenBottomBoundary}isInsideGrid(a,h,_,E){return _>=0&&a<this.gridRightBoundary&&E>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=s.ad.mat4.identity([]);return s.ad.mat4.translate(a,a,[-100,-100,0]),a}}function _r(y,a,h){const _=a.createTileMatrix(y,y.worldSize,h.toUnwrapped());return s.ad.mat4.multiply(new Float32Array(16),y.projMatrix,_)}function vo(y,a,h){if(a.projection.name===h.projection.name)return y.projMatrix;const _=h.clone();return _.setProjection(a.projection),_r(_,a.getProjection(),y)}function Lo(y,a,h){return a.name===h.projection.name?y.projMatrix:_r(h,a,y)}class dl{constructor(a,h,_,E){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):E&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class oc{constructor(a,h,_,E,C,M=!1){this.text=new dl(a?a.text:null,h,_,C),this.icon=new dl(a?a.icon:null,h,E,C),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kl{constructor(a,h,_,E=!1){this.text=a,this.icon=h,this.skipFade=_,this.clipped=E}}class zd{constructor(){this.invProjMatrix=s.ad.mat4.create(),this.viewportMatrix=s.ad.mat4.create(),this.circles=[]}}class Ua{constructor(a,h,_,E,C){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=E,this.tileID=C}}class mo{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[a]}}function ac(y,a,h,_,E){const{horizontalAlign:C,verticalAlign:M}=s.bD(y),j=-(C-.5)*a,H=-(M-.5)*h,G=s.bC(y,_);return new s.P(j+G[0]*E,H+G[1]*E)}function Mi(y,a,h,_,E){const C=new s.P(y,a);return h&&C._rotate(_?E:-E),C}class Ju{constructor(a,h,_,E,C,M){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Zt(this.transform,C),this.buildingIndex=M,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new mo(_),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,_,E,C=1){const M=_.getBucket(h),j=_.latestFeatureIndex;if(!M||!j||h.fqid!==M.layerIds[0])return;const H=M.layers[0].layout,G=M.layers[0].paint,Y=_.collisionBoxArray,ne=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),ee=_.tileSize/s.ai,he=_.tileID.toUnwrapped();this.transform.setProjection(M.projection);const we=(xe=_.tileID,Ee=M.getProjection(),Ce=this.transform,Ee.name===this.projection?Ce.calculateProjMatrix(xe.toUnwrapped()):_r(Ce,Ee,xe));var xe,Ee,Ce;const je=H.get("text-pitch-alignment")==="map",$e=H.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const We=h.dynamicFilter(),Ze=h.dynamicFilterNeedsFeature(),Ye=this.transform.calculatePixelsToTileUnitsMatrix(_),Xe=Ci(we,_.tileID.canonical,je,$e,this.transform,M.getProjection(),Ye);let Ke=null;if(je){const Ft=us(we,_.tileID.canonical,je,$e,this.transform,M.getProjection(),Ye);Ke=s.ad.mat4.multiply([],this.transform.labelPlaneMatrix,Ft)}let tt=null;We&&_.latestFeatureIndex&&(tt={unwrappedTileID:he,dynamicFilter:We,dynamicFilterNeedsFeature:Ze}),this.retainedQueryData[M.bucketInstanceId]=new Ua(M.bucketInstanceId,j,M.sourceLayerIndex,M.index,_.tileID);const[at,At]=M.layers[0].layout.get("text-size-scale-range"),xt=s.ay(C,at,At),[Bt,zt]=H.get("icon-size-scale-range"),Jt=s.ay(C,Bt,zt),yt={bucket:M,layout:H,paint:G,posMatrix:we,textLabelPlaneMatrix:Xe,labelToScreenMatrix:Ke,clippingData:tt,scale:ne,textPixelRatio:ee,holdingForFade:_.holdingForFade(),collisionBoxArray:Y,partiallyEvaluatedTextSize:s.bp(M.textSizeData,this.transform.zoom,xt),partiallyEvaluatedIconSize:s.bp(M.iconSizeData,this.transform.zoom,Jt),collisionGroup:this.collisionGroups.get(M.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(E)for(const Ft of M.sortKeyRanges){const{sortKey:gt,symbolInstanceStart:Lt,symbolInstanceEnd:kt}=Ft;a.push({sortKey:gt,symbolInstanceStart:Lt,symbolInstanceEnd:kt,parameters:yt})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:yt})}attemptAnchorPlacement(a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee,Ce,je){const{textOffset0:$e,textOffset1:We,crossTileID:Ze}=ee,Ye=[$e,We],Xe=ac(a,_,E,Ye,C),Ke=this.collisionIndex.placeCollisionBox(we,C,h,Mi(Xe.x,Xe.y,M,j,this.transform.angle),ne,H,G,Y.predicate);if(Ee){const tt=we.getSymbolInstanceIconSize(je,this.transform.zoom,ee.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(we,tt,Ee,Mi(Xe.x,Xe.y,M,j,this.transform.angle),ne,H,G,Y.predicate).box.length===0)return}if(Ke.box.length>0){let tt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]&&this.prevPlacement.placements[Ze]&&this.prevPlacement.placements[Ze].text&&(tt=this.prevPlacement.variableOffsets[Ze].anchor),this.variableOffsets[Ze]={textOffset:Ye,width:_,height:E,anchor:a,textScale:C,prevAnchor:tt},this.markUsedJustification(we,a,ee,xe),we.allowVerticalPlacement&&(this.markUsedOrientation(we,xe,ee),this.placedOrientations[Ze]=xe),{shift:Xe,placedGlyphBoxes:Ke}}}placeLayerBucketPart(a,h,_,E,C=1){const{bucket:M,layout:j,paint:H,posMatrix:G,textLabelPlaneMatrix:Y,labelToScreenMatrix:ne,clippingData:ee,textPixelRatio:he,holdingForFade:we,collisionBoxArray:xe,partiallyEvaluatedTextSize:Ee,partiallyEvaluatedIconSize:Ce,collisionGroup:je,latestFeatureIndex:$e}=a.parameters,We=j.get("text-optional"),Ze=j.get("icon-optional"),Ye=j.get("text-allow-overlap"),Xe=j.get("icon-allow-overlap"),Ke=j.get("text-rotation-alignment")==="map",tt=j.get("text-pitch-alignment")==="map",at=H.get("symbol-z-offset"),At=j.get("symbol-elevation-reference")==="sea",[xt,Bt]=j.get("text-size-scale-range"),[zt,Jt]=j.get("icon-size-scale-range"),yt=s.ay(C,xt,Bt),Ft=s.ay(C,zt,Jt);this.transform.setProjection(M.projection);let gt=Ye&&(Xe||!M.hasIconData()||Ze),Lt=Xe&&(Ye||!M.hasTextData()||We);const kt=!at.isConstant();!M.collisionArrays&&xe&&M.deserializeCollisionBoxes(xe),_&&E&&M.updateCollisionDebugBuffers(this.transform.zoom,xe,yt,Ft);const Ut=(Rt,Wt,dn)=>{const{crossTileID:pn,numVerticalGlyphVertices:xn}=Rt;let kn=null;if(ee&&ee.dynamicFilterNeedsFeature||kt){const di=this.retainedQueryData[M.bucketInstanceId];kn=$e.loadFeature({featureIndex:Rt.featureIndex,bucketIndex:di.bucketIndex,sourceLayerIndex:di.sourceLayerIndex,layoutVertexArrayOffset:0})}if(ee&&!(0,ee.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},kn,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new s.P(Rt.tileAnchorX,Rt.tileAnchorY),this.transform.calculateDistanceTileData(ee.unwrappedTileID)))return this.placements[pn]=new kl(!1,!1,!1,!0),void h.add(pn);const gr=at.evaluate(kn,{});if(h.has(pn))return;if(we)return void(this.placements[pn]=new kl(!1,!1,!1));let Qn=!1,dr=!1,sr=!0,Kr=!1,vi=!1,Zi=null,Br={box:null,offscreen:null,occluded:null},vs={box:null},yr=null,Nn=null,ei=null,Ai=0,mi=0,Vs=0;dn.textFeatureIndex?Ai=dn.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(Ai=Rt.featureIndex),dn.verticalTextFeatureIndex&&(mi=dn.verticalTextFeatureIndex);const go=di=>{di.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const bs=this.transform.elevation;di.elevation=At?gr:gr+(bs?bs.getAtTileOffset(di.tileID,di.tileAnchorX,di.tileAnchorY):0),di.elevation+=Rt.zOffset},Mo=dn.textBox;if(Mo){go(Mo);const di=bi=>{let Ui=s.bq.horizontal;if(M.allowVerticalPlacement&&!bi&&this.prevPlacement){const ua=this.prevPlacement.placedOrientations[pn];ua&&(this.placedOrientations[pn]=ua,Ui=ua,this.markUsedOrientation(M,Ui,Rt))}return Ui},bs=(bi,Ui)=>{if(M.allowVerticalPlacement&&xn>0&&dn.verticalTextBox){for(const ua of M.writingModes)if(ua===s.bq.vertical?(Br=Ui(),vs=Br):Br=bi(),Br&&Br.box&&Br.box.length)break}else Br=bi()};if(j.get("text-variable-anchor")){let bi=j.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[pn]){const ps=this.prevPlacement.variableOffsets[pn];bi.indexOf(ps.anchor)>0&&(bi=bi.filter(Po=>Po!==ps.anchor),bi.unshift(ps.anchor))}const Ui=(ps,Po,Du)=>{const zl=M.getSymbolInstanceTextSize(Ee,Rt,this.transform.zoom,Wt),Dc=(ps.x2-ps.x1)*zl+2*ps.padding,ml=(ps.y2-ps.y1)*zl+2*ps.padding,kc=Rt.hasIconTextFit&&!Xe?Po:null;kc&&go(kc);let jl={box:[],offscreen:!1,occluded:!1};const lh=Ye?2*bi.length:bi.length;for(let ku=0;ku<lh;++ku){const ch=this.attemptAnchorPlacement(bi[ku%bi.length],ps,Dc,ml,zl,Ke,tt,he,G,je,ku>=bi.length,Rt,Wt,M,Du,kc,Ee,Ce);if(ch&&(jl=ch.placedGlyphBoxes,jl&&jl.box&&jl.box.length)){Qn=!0,Zi=ch.shift;break}}return jl};bs(()=>Ui(Mo,dn.iconBox,s.bq.horizontal),()=>{const ps=dn.verticalTextBox;return ps&&go(ps),M.allowVerticalPlacement&&!(Br&&Br.box&&Br.box.length)&&xn>0&&ps?Ui(ps,dn.verticalIconBox,s.bq.vertical):{box:null,offscreen:null,occluded:null}}),Br&&(Qn=Br.box,sr=Br.offscreen,Kr=Br.occluded);const ua=di(!(!Br||!Br.box));if(!Qn&&this.prevPlacement){const ps=this.prevPlacement.variableOffsets[pn];ps&&(this.variableOffsets[pn]=ps,this.markUsedJustification(M,ps.anchor,Rt,ua))}}else{const bi=(Ui,ua)=>{const ps=M.getSymbolInstanceTextSize(Ee,Rt,this.transform.zoom,Wt,C),Po=this.collisionIndex.placeCollisionBox(M,ps,Ui,new s.P(0,0),Ye,he,G,je.predicate);return Po&&Po.box&&Po.box.length&&(this.markUsedOrientation(M,ua,Rt),this.placedOrientations[pn]=ua),Po};bs(()=>bi(Mo,s.bq.horizontal),()=>{const Ui=dn.verticalTextBox;return M.allowVerticalPlacement&&xn>0&&Ui?(go(Ui),bi(Ui,s.bq.vertical)):{box:null,offscreen:null,occluded:null}}),di(!!(Br&&Br.box&&Br.box.length))}}if(yr=Br,Qn=yr&&yr.box&&yr.box.length>0,sr=yr&&yr.offscreen,Kr=yr&&yr.occluded,Rt.useRuntimeCollisionCircles){const di=M.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex>=0?Rt.centerJustifiedTextSymbolIndex:Rt.verticalPlacedTextSymbolIndex),bs=s.br(M.textSizeData,Ee,di),bi=j.get("text-padding");Nn=this.collisionIndex.placeCollisionCircles(M,Ye,di,M.lineVertexArray,M.glyphOffsetArray,bs,G,Y,ne,_,tt,je.predicate,Rt.collisionCircleDiameter*bs/s.bw,bi,this.retainedQueryData[M.bucketInstanceId].tileID),Qn=Ye||Nn.circles.length>0&&!Nn.collisionDetected,sr=sr&&Nn.offscreen,Kr=Nn.occluded}if(dn.iconFeatureIndex&&(Vs=dn.iconFeatureIndex),dn.iconBox){const di=bs=>{go(bs);const bi=Rt.hasIconTextFit&&Zi?Mi(Zi.x,Zi.y,Ke,tt,this.transform.angle):new s.P(0,0),Ui=M.getSymbolInstanceIconSize(Ce,this.transform.zoom,Rt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,Ui,bs,bi,Xe,he,G,je.predicate)};vs&&vs.box&&vs.box.length&&dn.verticalIconBox?(ei=di(dn.verticalIconBox),dr=ei.box.length>0):(ei=di(dn.iconBox),dr=ei.box.length>0),sr=sr&&ei.offscreen,vi=ei.occluded}const zo=We||Rt.numHorizontalGlyphVertices===0&&xn===0,dc=Ze||Rt.numIconVertices===0;if(zo||dc?dc?zo||(dr=dr&&Qn):Qn=dr&&Qn:dr=Qn=dr&&Qn,Qn&&yr&&yr.box&&this.collisionIndex.insertCollisionBox(yr.box,j.get("text-ignore-placement"),M.bucketInstanceId,vs&&vs.box&&mi?mi:Ai,je.ID),dr&&ei&&this.collisionIndex.insertCollisionBox(ei.box,j.get("icon-ignore-placement"),M.bucketInstanceId,Vs,je.ID),Nn&&(Qn&&this.collisionIndex.insertCollisionCircles(Nn.circles,j.get("text-ignore-placement"),M.bucketInstanceId,Ai,je.ID),_)){const di=M.bucketInstanceId;let bs=this.collisionCircleArrays[di];bs===void 0&&(bs=this.collisionCircleArrays[di]=new zd);for(let bi=0;bi<Nn.circles.length;bi+=4)bs.circles.push(Nn.circles[bi+0]),bs.circles.push(Nn.circles[bi+1]),bs.circles.push(Nn.circles[bi+2]),bs.circles.push(Nn.collisionDetected?1:0)}const Wa=M.projection.name!=="globe";gt=gt&&(Wa||!Kr),Lt=Lt&&(Wa||!vi),this.placements[pn]=new kl(Qn||gt,dr||Lt,sr||M.justReloaded),h.add(pn)};if(M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,this.retainedQueryData[M.bucketInstanceId].tileID),M.elevationType==="road"&&M.updateRoadElevation(),M.updateZOffset(),M.sortFeaturesByY){const Rt=M.getSortedSymbolIndexes(this.transform.angle);for(let Wt=Rt.length-1;Wt>=0;--Wt){const dn=Rt[Wt];Ut(M.symbolInstances.get(dn),dn,M.collisionArrays[dn])}M.hasAnyZOffset&&s.w(`${M.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(M.hasAnyZOffset){const Rt=M.getSortedIndexesByZOffset();for(let Wt=0;Wt<Rt.length;++Wt){const dn=Rt[Wt];Ut(M.symbolInstances.get(dn),dn,M.collisionArrays[dn])}}else for(let Rt=a.symbolInstanceStart;Rt<a.symbolInstanceEnd;Rt++)Ut(M.symbolInstances.get(Rt),Rt,M.collisionArrays[Rt]);if(_&&M.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[M.bucketInstanceId];s.ad.mat4.invert(Rt.invProjMatrix,G),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(a,h,_,E){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:H,crossTileID:G}=_,Y=s.bB(h),ne=E===s.bq.vertical?H:Y==="left"?C:Y==="center"?M:Y==="right"?j:-1;C>=0&&(a.text.placedSymbolArray.get(C).crossTileID=ne>=0&&C!==ne?0:G),M>=0&&(a.text.placedSymbolArray.get(M).crossTileID=ne>=0&&M!==ne?0:G),j>=0&&(a.text.placedSymbolArray.get(j).crossTileID=ne>=0&&j!==ne?0:G),H>=0&&(a.text.placedSymbolArray.get(H).crossTileID=ne>=0&&H!==ne?0:G)}markUsedOrientation(a,h,_){const E=h===s.bq.horizontal||h===s.bq.horizontalOnly?h:0,C=h===s.bq.vertical?h:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:H,verticalPlacedTextSymbolIndex:G}=_,Y=a.text.placedSymbolArray;M>=0&&(Y.get(M).placedOrientation=E),j>=0&&(Y.get(j).placedOrientation=E),H>=0&&(Y.get(H).placedOrientation=E),G>=0&&(Y.get(G).placedOrientation=C)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const E=h?h.symbolFadeChange(a):1,C=h?h.opacities:{},M=h?h.variableOffsets:{},j=h?h.placedOrientations:{};for(const H in this.placements){const G=this.placements[H],Y=C[H];Y?(this.opacities[H]=new oc(Y,E,G.text,G.icon,null,G.clipped),_=_||G.text!==Y.text.placed||G.icon!==Y.icon.placed):(this.opacities[H]=new oc(null,E,G.text,G.icon,G.skipFade,G.clipped),_=_||G.text||G.icon)}for(const H in C){const G=C[H];if(!this.opacities[H]){const Y=new oc(G,E,!1,!1);Y.isHidden()||(this.opacities[H]=Y,_=_||G.text.placed||G.icon.placed)}}for(const H in M)this.variableOffsets[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.variableOffsets[H]=M[H]);for(const H in j)this.placedOrientations[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.placedOrientations[H]=j[H]);_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h,_,E){const C=new Set;for(const M of h){const j=M.getBucket(a);j&&M.latestFeatureIndex&&a.fqid===j.layerIds[0]&&(this.updateBucketOpacities(j,C,M,M.collisionBoxArray,_,E,M.tileID,a.scope),j.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(j,M.tileID),j.elevationType==="road"&&j.updateRoadElevation(),j.updateZOffset())}}updateBucketOpacities(a,h,_,E,C,M,j,H){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const G=a.layers[0].layout,Y=a.layers[0].paint,ne=!!a.layers[0].dynamicFilter(),ee=new oc(null,0,!1,!1,!0),he=G.get("text-allow-overlap"),we=G.get("icon-allow-overlap"),xe=G.get("text-variable-anchor"),Ee=G.get("text-rotation-alignment")==="map",Ce=G.get("text-pitch-alignment")==="map",je=Y.get("symbol-z-offset"),$e=G.get("symbol-elevation-reference")==="sea",We=!je.isConstant(),Ze=new oc(null,0,he&&(we||!a.hasIconData()||G.get("icon-optional")),we&&(he||!a.hasTextData()||G.get("text-optional")),!0);!a.collisionArrays&&E&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(E);const Ye=(Ke,tt,at)=>{for(let At=0;At<tt/4;At++)Ke.opacityVertexArray.emplaceBack(at)};let Xe=0;M&&a.updateReplacement(j,M);for(let Ke=0;Ke<a.symbolInstances.length;Ke++){const tt=a.symbolInstances.get(Ke),{numHorizontalGlyphVertices:at,numVerticalGlyphVertices:At,crossTileID:xt,numIconVertices:Bt,tileAnchorX:zt,tileAnchorY:Jt}=tt;let yt=null;const Ft=this.retainedQueryData[a.bucketInstanceId];We&&tt&&Ft&&(yt=_.latestFeatureIndex.loadFeature({featureIndex:tt.featureIndex,bucketIndex:Ft.bucketIndex,sourceLayerIndex:Ft.sourceLayerIndex,layoutVertexArrayOffset:0}));const gt=je.evaluate(yt,{}),Lt=h.has(xt);let kt=this.opacities[xt];Lt?kt=ee:kt||(kt=Ze,this.opacities[xt]=kt),h.add(xt);const Ut=at>0||At>0,Rt=Bt>0,Wt=this.placedOrientations[xt],dn=Wt===s.bq.vertical,pn=Wt===s.bq.horizontal||Wt===s.bq.horizontalOnly;!Ut&&!Rt||kt.isHidden()||Xe++;let xn=!1;if((Ut||Rt)&&M)for(const kn of a.activeReplacements){if(s.bx(kn,C,s.by.Symbol,H)||kn.min.x>zt||zt>kn.max.x||kn.min.y>Jt||Jt>kn.max.y)continue;const gr=s.bz(zt,Jt,j.canonical,kn.footprintTileId.canonical);if(xn=s.bA(gr,kn.footprint),xn)break}if(Ut){const kn=xn?Ea:Fo(kt.text);Ye(a.text,at,dn?Ea:kn),Ye(a.text,At,pn?Ea:kn);const gr=kt.text.isHidden(),{leftJustifiedTextSymbolIndex:Qn,centerJustifiedTextSymbolIndex:dr,rightJustifiedTextSymbolIndex:sr,verticalPlacedTextSymbolIndex:Kr}=tt,vi=a.text.placedSymbolArray,Zi=gr||dn?1:0;Qn>=0&&(vi.get(Qn).hidden=Zi),dr>=0&&(vi.get(dr).hidden=Zi),sr>=0&&(vi.get(sr).hidden=Zi),Kr>=0&&(vi.get(Kr).hidden=gr||pn?1:0);const Br=this.variableOffsets[xt];Br&&this.markUsedJustification(a,Br.anchor,tt,Wt);const vs=this.placedOrientations[xt];vs&&(this.markUsedJustification(a,"left",tt,vs),this.markUsedOrientation(a,vs,tt))}if(Rt){const kn=xn?Ea:Fo(kt.icon),{placedIconSymbolIndex:gr,verticalPlacedIconSymbolIndex:Qn}=tt,dr=a.icon.placedSymbolArray,sr=kt.icon.isHidden()?1:0;gr>=0&&(Ye(a.icon,Bt,dn?Ea:kn),dr.get(gr).hidden=sr),Qn>=0&&(Ye(a.icon,tt.numVerticalIconVertices,pn?Ea:kn),dr.get(Qn).hidden=sr)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const kn=a.collisionArrays[Ke];if(kn){let gr=new s.P(0,0),Qn=!0;if(kn.textBox||kn.verticalTextBox){if(xe){const sr=this.variableOffsets[xt];sr?(gr=ac(sr.anchor,sr.width,sr.height,sr.textOffset,sr.textScale),Ee&&gr._rotate(Ce?this.transform.angle:-this.transform.angle)):Qn=!1}ne&&(Qn=!kt.clipped),kn.textBox&&bo(a.textCollisionBox.collisionVertexArray,kt.text.placed,!Qn||dn,gt,$e,gr.x,gr.y),kn.verticalTextBox&&bo(a.textCollisionBox.collisionVertexArray,kt.text.placed,!Qn||pn,gt,$e,gr.x,gr.y)}const dr=Qn&&!!(!pn&&kn.verticalIconBox);kn.iconBox&&bo(a.iconCollisionBox.collisionVertexArray,kt.icon.placed,dr,gt,$e,tt.hasIconTextFit?gr.x:0,tt.hasIconTextFit?gr.y:0),kn.verticalIconBox&&bo(a.iconCollisionBox.collisionVertexArray,kt.icon.placed,!dr,gt,$e,tt.hasIconTextFit?gr.x:0,tt.hasIconTextFit?gr.y:0)}}}if(a.fullyClipped=Xe===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Ke.invProjMatrix,a.placementViewportMatrix=Ke.viewportMatrix,a.collisionCircleArray=Ke.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function bo(y,a,h,_,E,C,M){y.emplaceBack(a?1:0,h?1:0,C||0,M||0,_,E?1:0),y.emplaceBack(a?1:0,h?1:0,C||0,M||0,_,E?1:0),y.emplaceBack(a?1:0,h?1:0,C||0,M||0,_,E?1:0),y.emplaceBack(a?1:0,h?1:0,C||0,M||0,_,E?1:0)}const fs=Math.pow(2,25),Lr=Math.pow(2,24),Hf=Math.pow(2,17),Is=Math.pow(2,16),wa=Math.pow(2,9),eo=Math.pow(2,8),Wf=Math.pow(2,1);function Fo(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,h=Math.floor(127*y.opacity);return h*fs+a*Lr+h*Hf+a*Is+h*wa+a*eo+h*Wf+a}const Ea=0;class q{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,h,_,E,C,M){const j=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(j,E,a[this._currentTileIndex],this._sortAcrossTiles,M),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((H,G)=>H.sortKey-G.sortKey));this._currentPartIndex<j.length;){const H=j[this._currentPartIndex];if(h.placeLayerBucketPart(H,this._seenCrossTileIDs,_,H.symbolInstanceStart===0,M),this._currentPartIndex++,C())return!0}return!1}}class ve{constructor(a,h,_,E,C,M,j,H,G){this.placement=new Ju(a,C,M,j,H,G),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(a,h,_,E,C){const M=s.q.now(),j=()=>{const H=s.q.now()-M;return!this._forceFullPlacement&&H>2};for(;this._currentPlacementIndex>=0;){const H=h[a[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(H.type==="symbol"&&(!H.minzoom||H.minzoom<=G)&&(!H.maxzoom||H.maxzoom>G)){const Y=H,ne=Y.layout.get("symbol-z-elevate"),ee=Y.layout.get("symbol-sort-key").constantOr(1)!==void 0,he=Y.layout.get("symbol-z-order"),we=he==="viewport-y"||he==="auto"&&!(he!=="viewport-y"&&ee),xe=Y.layout.get("text-allow-overlap")||Y.layout.get("icon-allow-overlap")||Y.layout.get("text-ignore-placement")||Y.layout.get("icon-ignore-placement"),Ee=we&&xe,Ce=this._inProgressLayer=this._inProgressLayer||new q(Y),je=s.C(H.source,H.scope);if(Ce.continuePlacement(ne||Ee?E[je]:_[je],this.placement,this._showCollisionBoxes,H,j,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const ke=512/s.ai/2;class et{constructor(a,h,_){this.tileID=a,this.bucketInstanceId=_,this.index=new s.bE(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const E=a.canonical.x*s.ai,C=a.canonical.y*s.ai;for(let M=0;M<h.length;M++){const{key:j,crossTileID:H,tileAnchorX:G,tileAnchorY:Y}=h.get(M),ne=Math.floor((E+G)*ke),ee=Math.floor((C+Y)*ke);this.index.add(ne,ee),this.keys.push(j),this.crossTileIDs.push(H)}this.index.finish()}findMatches(a,h,_){const E=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),C=ke/Math.pow(2,h.canonical.z-this.tileID.canonical.z),M=h.canonical.x*s.ai,j=h.canonical.y*s.ai;for(let H=0;H<a.length;H++){const G=a.get(H);if(G.crossTileID)continue;const{key:Y,tileAnchorX:ne,tileAnchorY:ee}=G,he=Math.floor((M+ne)*C),we=Math.floor((j+ee)*C),xe=this.index.range(he-E,we-E,he+E,we+E);for(const Ee of xe){const Ce=this.crossTileIDs[Ee];if(this.keys[Ee]===Y&&!_.has(Ce)){_.add(Ce),G.crossTileID=Ce;break}}}}}class Gt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class en{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(h!==0)for(const _ in this.indexes){const E=this.indexes[_],C={};for(const M in E){const j=E[M];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+h),C[j.tileID.key]=j}this.indexes[_]=C}this.lng=a}addBucket(a,h,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const E=this.usedCrossTileIDs[a.overscaledZ];for(const C in this.indexes){const M=this.indexes[C];if(Number(C)>a.overscaledZ)for(const j in M){const H=M[j];H.tileID.isChildOf(a)&&H.findMatches(h.symbolInstances,a,E)}else{const j=M[a.scaledTo(Number(C)).key];j&&j.findMatches(h.symbolInstances,a,E)}}for(let C=0;C<h.symbolInstances.length;C++){const M=h.symbolInstances.get(C);M.crossTileID||(M.crossTileID=_.generate(),E.add(M.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new et(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const _ of h.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let h=!1;for(const _ in this.indexes){const E=this.indexes[_];for(const C in E)a[E[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,E[C]),delete E[C],h=!0)}return h}}class Kn{constructor(){this.layerIndexes={},this.crossTileIDs=new Gt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,_,E){let C=this.layerIndexes[a.fqid];C===void 0&&(C=this.layerIndexes[a.fqid]=new en);let M=!1;const j={};E.name!=="globe"&&C.handleWrapJump(_);for(const H of h){const G=H.getBucket(a);G&&a.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(H.tileID,G,this.crossTileIDs)&&(M=!0),j[G.bucketInstanceId]=!0)}return C.removeStaleBuckets(j)&&(M=!0),M}pruneUnusedLayers(a){const h={};a.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const ji=771;class nr{constructor(a,h,_,E){this.blendFunction=a,this.blendColor=h,this.mask=_,this.blendEquation=E}}nr.Replace=[1,0,1,0],nr.disabled=new nr(nr.Replace,s.al.transparent,[!1,!1,!1,!1]),nr.unblended=new nr(nr.Replace,s.al.transparent,[!0,!0,!0,!0]),nr.alphaBlended=new nr([1,ji,1,ji],s.al.transparent,[!0,!0,!0,!0]),nr.alphaBlendedNonPremultiplied=new nr([770,ji,770,ji],s.al.transparent,[!0,!0,!0,!0]),nr.multiply=new nr([774,0,774,0],s.al.transparent,[!0,!0,!0,!0]);class gn{constructor(a,h,_){this.func=a,this.mask=h,this.range=_}}gn.ReadOnly=!1,gn.ReadWrite=!0,gn.disabled=new gn(519,gn.ReadOnly,[0,1]);const As=7680;class Un{constructor(a,h,_,E,C,M){this.test=a,this.ref=h,this.mask=_,this.fail=E,this.depthFail=C,this.pass=M}}Un.disabled=new Un({func:519,mask:0},0,0,As,As,As);const Ms=1029,Bo=2305;class qn{constructor(a,h,_){this.enable=a,this.mode=h,this.frontFace=_}}function eh(y,a){const h=s.bG(y,3);s.ad.mat4.fromQuat(y,a),s.bI(y,3,h)}function Qc(y,a){const h=s.ad.quat.identity([]);return s.ad.quat.rotateZ(h,h,-a),s.ad.quat.rotateX(h,h,-y),h}function qh(y,a){const h=[y[0],y[1],0],_=[a[0],a[1],0];if(s.ad.vec3.length(h)>=1e-15){const M=s.ad.vec3.normalize([],h);s.ad.vec3.scale(_,M,s.ad.vec3.dot(_,M)),a[0]=_[0],a[1]=_[1]}const E=s.ad.vec3.cross([],a,y);if(s.ad.vec3.len(E)<1e-15)return null;const C=Math.atan2(-E[1],E[0]);return Qc(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),C)}qn.disabled=new qn(!1,Ms,Bo),qn.backCCW=new qn(!0,Ms,Bo),qn.backCW=new qn(!0,Ms,2304),qn.frontCW=new qn(!0,1028,2304),qn.frontCCW=new qn(!0,1028,Bo);class $f{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof s.ac?a:new s.ac(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=s.bF(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const _=this.position,E=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(a)):0,C=s.ac.fromLngLat(a,E),M=[C.x-_.x,C.y-_.y,C.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=qh(M,h)}setPitchBearing(a,h){this.orientation=Qc(s.ak(a),s.ak(-h))}}class Ha{constructor(a,h){this._transform=s.ad.mat4.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new s.ac(a[0],a[1],a[2])}get position(){const a=s.bG(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&s.bI(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||s.ad.quat.identity([]),a&&eh(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=Qc(a,h),eh(this._transform,this._orientation)}forward(){const a=s.bG(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=s.bG(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=s.bG(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const _=new Float64Array(16);return s.ad.mat4.invert(_,this.getWorldToCamera(a,h)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,h,_){const E=this.position;s.ad.vec3.scale(E,E,-a);const C=new Float64Array(16);return s.ad.mat4.fromScaling(C,[_,_,_]),s.ad.mat4.translate(C,C,E),C[10]*=h,C}getWorldToCamera(a,h){const _=new Float64Array(16),E=new Float64Array(4),C=this.position;return s.ad.quat.conjugate(E,this._orientation),s.ad.vec3.scale(C,C,-a),s.ad.mat4.fromQuat(_,E),s.ad.mat4.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(a,h,_,E){const C=new Float64Array(16);return s.ad.mat4.perspective(C,a,h,_,E),C}getCameraToClipOrthographic(a,h,_,E,C,M){const j=new Float64Array(16);return s.ad.mat4.ortho(j,a,h,_,E,C,M),j}getDistanceToElevation(a,h=!1){const _=a===0?0:s.bH(a,h?s.aT(this.position[1]):this.position[1]),E=this.forward();return(_-this.position[2])/E[2]}clone(){return new Ha([...this.position],[...this.orientation])}}const Ps={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class th{constructor(a=0,h=0,_=0,E=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=_,this.right=E}interpolate(a,h,_){return h.top!=null&&a.top!=null&&(this.top=s.ah(a.top,h.top,_)),h.bottom!=null&&a.bottom!=null&&(this.bottom=s.ah(a.bottom,h.bottom,_)),h.left!=null&&a.left!=null&&(this.left=s.ah(a.left,h.left,_)),h.right!=null&&a.right!=null&&(this.right=s.ah(a.right,h.right,_)),this}getCenter(a,h){const _=s.ay((this.left+a-this.right)/2,0,a),E=s.ay((this.top+h-this.bottom)/2,0,h);return new s.P(_,E)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new th(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const sn=15;class Vi{constructor(a,h,_,E,C,M,j){this.tileSize=512,this._renderWorldCopies=C===void 0||C,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=E??60,this.setProjection(M),this.setMaxBounds(j),this.width=0,this.height=0,this._center=new s.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new th,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ha,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const a=new Vi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a._allowWorldUnderZoom=this._allowWorldUnderZoom,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<sn}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return s.aA(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=s.bP(this.projectionOptions);const _=this.getProjection(),E=!s.bn(h,_);return E&&this._calcMatrices(),this.mercatorFromTransition=!1,E}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bP({name:"mercator"});const h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bF(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=s.ad.mat2.create(),s.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=s.ay(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=s.ak(a),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let E=0,C=0;for(let M=0;M<h.length;M++){const j=new s.P(h[M][0]*this.width,_+h[M][1]*(this.height-_)),H=a.pointCoordinate(j);if(!H)continue;const G=1/Math.hypot(H[0]-this._camera.position[0],H[1]-this._camera.position[1]);E+=H[3]*G,C+=G}return C===0?NaN:E/C}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,E=this._mercatorZfromZoom(a),C=this._mercatorZfromZoom(this._maxZoom),M=Math.max(E-_,C);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const E=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,_));return s.ay(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!s.ad.quat.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];s.ad.vec3.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new $f;return h.position=new s.ac(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!s.ad.quat.length(a))return!1;s.ad.quat.normalize(a,a);const h=s.ad.vec3.transformQuat([],[0,0,-1],a),_=s.ad.vec3.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;const E=qh(h,_);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;a[2]=s.ay(a[2],E/_,E/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,_){this._unmodified=!1,this._edgeInsets.interpolate(a,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new s.bQ(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new s.P(0,0)),E=this.pointCoordinate(new s.P(this.width,0)),C=this.pointCoordinate(new s.P(this.width,this.height)),M=this.pointCoordinate(new s.P(0,this.height)),j=Math.floor(Math.min(_.x,E.x,C.x,M.x)),H=Math.floor(Math.max(_.x,E.x,C.x,M.x)),G=1;for(let Y=j-G;Y<=H+G;Y++)Y!==0&&h.push(new s.bQ(Y,a))}return h}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(a,h,_){let E=[];const C=_!==void 0,M=!C;if(M&&this.zoom<h||C&&_[0]===0&&_[1]===0)return E;const j=new Set,H=(Y,ne,ee,he,we)=>{const xe=s.c5(ne,Y,ee,he,we);j.has(xe)||(E.push(new s.aH(Y,ne,ee,he,we)),j.add(xe))};for(let Y=0;Y<a.length;Y++){const ne=a[Y];if(M&&ne.canonical.z!==h)continue;const ee=ne.canonical,he=ne.overscaledZ,we=ne.wrap,xe=1<<ee.z,Ee=ee.x+1<xe,Ce=ee.x>0,je=ee.y+1<xe,$e=ee.y>0,We=ne.wrap-(Ce?0:1),Ze=ne.wrap+(Ee?0:1),Ye=Ce?ee.x-1:xe-1,Xe=Ee?ee.x+1:0;if(C)_[0]<0?(H(he,Ze,ee.z,Xe,ee.y),_[1]<0&&je&&(H(he,we,ee.z,ee.x,ee.y+1),H(he,Ze,ee.z,Xe,ee.y+1)),_[1]>0&&$e&&(H(he,we,ee.z,ee.x,ee.y-1),H(he,Ze,ee.z,Xe,ee.y-1))):_[0]>0?(H(he,We,ee.z,Ye,ee.y),_[1]<0&&je&&(H(he,we,ee.z,ee.x,ee.y+1),H(he,We,ee.z,Ye,ee.y+1)),_[1]>0&&$e&&(H(he,we,ee.z,ee.x,ee.y-1),H(he,We,ee.z,Ye,ee.y-1))):_[1]<0&&je?H(he,we,ee.z,ee.x,ee.y+1):$e&&H(he,we,ee.z,ee.x,ee.y-1);else{const Ke=ne.visibleQuadrants;1&Ke&&(H(he,We,ee.z,Ye,ee.y),$e&&(H(he,we,ee.z,ee.x,ee.y-1),H(he,We,ee.z,Ye,ee.y-1))),2&Ke&&(H(he,Ze,ee.z,Xe,ee.y),$e&&(H(he,we,ee.z,ee.x,ee.y-1),H(he,Ze,ee.z,Xe,ee.y-1))),4&Ke&&(H(he,We,ee.z,Ye,ee.y),je&&(H(he,we,ee.z,ee.x,ee.y+1),H(he,We,ee.z,Ye,ee.y+1))),8&Ke&&(H(he,Ze,ee.z,Xe,ee.y),je&&(H(he,we,ee.z,ee.x,ee.y+1),H(he,Ze,ee.z,Xe,ee.y+1)))}}const G=[];for(const Y of E)E.some(ne=>Y.isChildOf(ne))||G.push(Y);if(E=G.filter(Y=>!a.some(ne=>!!(Y.overscaledZ<h&&ne.isChildOf(Y))||Y.equals(ne)||Y.isChildOf(ne))),M){const Y=1<<h,ne=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=[Y*ne.x,Y*ne.y],he=4,we=he*he;E=E.filter(xe=>{const Ee=xe.canonical.x+.5-ee[0],Ce=xe.canonical.y+.5-ee[1];return Ee*Ee+Ce*Ce<we})}return E}coveringTiles(a){let h=this.coveringZoomLevel(a);const _=h,E=this.elevation&&this.elevation.exaggeration(),C=E&&!a.isTerrainDEM,M=this.projection.name==="mercator";if(a.minzoom!==void 0&&h<a.minzoom)return[];a.maxzoom!==void 0&&h>a.maxzoom&&(h=a.maxzoom);const j=this.locationCoordinate(this.center),H=this.center.lat,G=1<<h,Y=[G*j.x,G*j.y,0],ne=this.projection.name==="globe",ee=!ne,he=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,ee),we=ne?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),xe=G*s.bH(1,this.center.lat),Ee=this._camera.position[2]/s.bH(1,this.center.lat),Ce=[G*we.x,G*we.y,Ee*(ee?1:xe)],je=ne||E,$e=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),We=this.isLODDisabled(!0)?h:0;let Ze;if(this._elevation&&a.isTerrainDEM)Ze=1e4*this._elevation.exaggeration();else if(this._elevation){const gt=this._elevation.getMinMaxForVisibleTiles();Ze=gt?gt.max:this._centerAltitude}else Ze=this._centerAltitude;const Ye=a.isTerrainDEM?-Ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,Xe=this.projection.isReprojectedInTileSpace?s.bS(this):1,Ke=gt=>{const kt=new s.ac(gt.x+25e-6,gt.y,gt.z),Ut=new s.ac(gt.x,gt.y+25e-6,gt.z),Rt=gt.toLngLat(),Wt=kt.toLngLat(),dn=Ut.toLngLat(),pn=this.locationCoordinate(Rt),xn=this.locationCoordinate(Wt),kn=this.locationCoordinate(dn),gr=Math.hypot(xn.x-pn.x,xn.y-pn.y),Qn=Math.hypot(kn.x-pn.x,kn.y-pn.y);return Math.sqrt(gr*Qn)*Xe/25e-6},tt=gt=>{const Lt=Ze,kt=Ye;return{aabb:s.bV(this,G,0,0,0,gt,kt,Lt,this.projection),zoom:0,x:0,y:0,minZ:kt,maxZ:Lt,wrap:gt,fullyVisible:!1}},at=[];let At=[];const xt=h,Bt=a.reparseOverscaled?_:h,zt=(Ee-this._centerAltitude)*xe,Jt=gt=>{if(!this._elevation||!gt.tileID||!M)return;const Lt=this._elevation.getMinMaxForTile(gt.tileID),kt=gt.aabb;Lt?(kt.min[2]=Lt.min,kt.max[2]=Lt.max,kt.center[2]=(kt.min[2]+kt.max[2])/2):(gt.shouldSplit=Ft(gt),gt.shouldSplit||(kt.min[2]=kt.max[2]=kt.center[2]=this._centerAltitude))},yt=(gt,Lt)=>{if(.707*Lt<gt)return 1;const kt=Lt/gt;return kt/(1.4144271570014144+(Math.pow(1.1,kt-1.4144271570014144+1)-1)/(1.1-1)-1)},Ft=gt=>{if(gt.zoom<We)return!0;if(gt.zoom===xt)return!1;if(gt.shouldSplit!=null)return gt.shouldSplit;const Lt=gt.aabb.distanceX(Ce),kt=gt.aabb.distanceY(Ce);let Ut=zt,Rt=1;if(ne){Ut=gt.aabb.distanceZ(Ce);const Qn=Math.pow(2,gt.zoom),dr=s.aT((gt.y+1)/Qn),sr=s.aT(gt.y/Qn),Kr=Math.min(Math.max(H,dr),sr),vi=s.ca(Kr)/s.ca(H);if(Rt=Kr===H?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vi/this._mercatorScaleRatio),this.zoom<=s.c6&&gt.zoom===xt-1&&vi>=.9)return!0}else if(C&&(Ut=gt.aabb.distanceZ(Ce)*xe),this.projection.isReprojectedInTileSpace&&_<=5){const Qn=Math.pow(2,gt.zoom),dr=Ke(new s.ac((gt.x+.5)/Qn,(gt.y+.5)/Qn));Rt=dr>.85?1:dr}if(!M){const Qn=Math.sqrt(Lt*Lt+kt*kt+Ut*Ut);let dr=(1<<xt-gt.zoom)*$e*Rt;return dr*=yt(Math.max(Ut,zt),Qn),Qn<dr}let Wt=Number.MAX_VALUE,dn=0;const pn=gt.aabb.getCorners(),xn=[];for(const Qn of pn){s.ad.vec3.sub(xn,Qn,Ce),ne||(C?xn[2]*=xe:xn[2]=zt);const dr=s.ad.vec3.dot(xn,this._camera.forward());dr<Wt&&(Wt=dr,dn=Math.abs(xn[2]))}let kn=(1<<xt-gt.zoom)*$e*Rt;if(kn*=yt(Math.max(dn,zt),Wt),Wt<kn)return!0;const gr=gt.aabb.closestPoint(Y);return gr[0]===Y[0]&&gr[1]===Y[1]};if(this.renderWorldCopies)for(let gt=1;gt<=3;gt++)at.push(tt(-gt)),at.push(tt(gt));for(at.push(tt(0));at.length>0;){const gt=at.pop(),Lt=gt.x,kt=gt.y;let Ut=gt.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(gt.y===0||gt.y===(1<<gt.zoom)-1);if(!Ut){let Wt=je?gt.aabb.intersects(he):gt.aabb.intersectsFlat(he);if(Wt===0&&Rt()){const dn=new s.bT(gt.zoom,Lt,kt);Wt=s.bU(this,G,dn,!0).intersects(he)}if(Wt===0)continue;Ut=Wt===2}if(gt.zoom!==xt&&Ft(gt))for(let Wt=0;Wt<4;Wt++){const dn=(Lt<<1)+Wt%2,pn=(kt<<1)+(Wt>>1),xn={aabb:M?gt.aabb.quadrant(Wt):s.bV(this,G,gt.zoom+1,dn,pn,gt.wrap,gt.minZ,gt.maxZ,this.projection),zoom:gt.zoom+1,x:dn,y:pn,wrap:gt.wrap,fullyVisible:Ut,tileID:void 0,shouldSplit:void 0,minZ:gt.minZ,maxZ:gt.maxZ};C&&!ne&&(xn.tileID=new s.aH(gt.zoom+1===xt?Bt:gt.zoom+1,gt.wrap,gt.zoom+1,dn,pn),Jt(xn)),at.push(xn)}else{const Wt=gt.zoom===xt?Bt:gt.zoom;if(a.minzoom&&a.minzoom>Wt)continue;let dn=0;if(!Ut){let gr=je?gt.aabb.intersectsPrecise(he):gt.aabb.intersectsPreciseFlat(he);if(gr===0&&Rt()){const Qn=new s.bT(gt.zoom,Lt,kt);gr=s.bU(this,G,Qn,!0).intersectsPrecise(he)}if(gr===0)continue;if(a.calculateQuadrantVisibility)if(he.containsPoint(gt.aabb.center))dn=15;else for(let Qn=0;Qn<4;Qn++)gt.aabb.quadrant(Qn).intersects(he)!==0&&(dn|=1<<Qn)}const pn=Y[0]-(.5+Lt+(gt.wrap<<gt.zoom))*(1<<h-gt.zoom),xn=Y[1]-.5-kt,kn=gt.tileID?gt.tileID:new s.aH(Wt,gt.wrap,gt.zoom,Lt,kt);a.calculateQuadrantVisibility&&(kn.visibleQuadrants=dn),At.push({tileID:kn,distanceSq:pn*pn+xn*xn})}}if(this.fogCullDistSq){const gt=this.fogCullDistSq,Lt=this.horizonLineFromTop();At=At.filter(kt=>{const Ut=[0,0,0,1],Rt=[s.ai,s.ai,0,1],Wt=this.calculateFogTileMatrix(kt.tileID.toUnwrapped());s.ad.vec4.transformMat4(Ut,Ut,Wt),s.ad.vec4.transformMat4(Rt,Rt,Wt);const dn=s.ad.vec4.min([],Ut,Rt),pn=s.ad.vec4.max([],Ut,Rt),xn=s.bW(dn,pn);if(xn===0)return!0;let kn=!1;const gr=this._elevation;if(gr&&xn>gt&&Lt!==0){const Qn=this.calculateProjMatrix(kt.tileID.toUnwrapped());let dr;a.isTerrainDEM||(dr=gr.getMinMaxForTile(kt.tileID)),dr||(dr={min:Ye,max:Ze});const sr=s.c7(this.rotation),Kr=[sr[0]*s.ai,sr[1]*s.ai,dr.max];s.ad.vec3.transformMat4(Kr,Kr,Qn),kn=(1-Kr[1])*this.height*.5<Lt}return xn<gt||kn})}return At.sort((gt,Lt)=>gt.distanceSq-Lt.distanceSq).map(gt=>gt.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=s.ay(a.lat,-s.bX,s.bX),_=this.projection.project(a.lng,h);return new s.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,h){let _,E;const C=this.centerPoint;if(this.projection.name==="globe"){const j=this.worldSize;_=(h.x-C.x)/j,E=(h.y-C.y)/j}else{const j=this.pointCoordinate(h),H=this.pointCoordinate(C);_=j.x-H.x,E=j.y-H.y}const M=this.locationCoordinate(a);this.setLocation(new s.ac(M.x-_,M.y-E))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a,h){return this.projection.locationPoint(this,a,h)}locationPoint3D(a,h){return this.projection.locationPoint(this,a,h,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a,h){return this.coordinateLocation(this.pointCoordinate3D(a,h))}locationCoordinate(a,h){const _=h?s.bH(h,a.lat):void 0,E=this.projection.project(a.lng,a.lat);return new s.ac(E.x,E.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const _=h??this._centerAltitude,E=[a.x,a.y,0,1],C=[a.x,a.y,1,1];s.ad.vec4.transformMat4(E,E,this.pixelMatrixInverse),s.ad.vec4.transformMat4(C,C,this.pixelMatrixInverse);const M=C[3];s.ad.vec4.scale(E,E,1/E[3]),s.ad.vec4.scale(C,C,1/M);const j=E[2],H=C[2];return{p0:E,p1:C,t:j===H?0:(_-j)/(H-j)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return s.ad.vec4.transformMat4(h,h,this.pixelMatrixInverse),s.ad.vec4.transformMat4(_,_,this.pixelMatrixInverse),s.ad.vec4.scale(h,h,1/h[3]),s.ad.vec4.scale(_,_,1/_[3]),h[2]=s.bH(h[2],this._center.lat)*this.worldSize,_[2]=s.bH(_[2],this._center.lat)*this.worldSize,s.ad.vec4.scale(h,h,1/this.worldSize),s.ad.vec4.scale(_,_,1/this.worldSize),new s.as([h[0],h[1],h[2]],s.ad.vec3.normalize([],s.ad.vec3.sub([],_,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:_,t:E}=a,C=s.bH(h[2],this._center.lat),M=s.bH(_[2],this._center.lat);return new s.ac(s.ah(h[0],_[0],E)/this.worldSize,s.ah(h[1],_[1],E)/this.worldSize,s.ah(C,M,E))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a,h){if(!this.elevation)return this.pointCoordinate(a,h);let _=this.projection.pointCoordinate3D(this,a.x,a.y);if(_)return new s.ac(_[0],_[1],_[2]);let E=0,C=this.horizonLineFromTop();if(a.y>C)return this.pointCoordinate(a,h);const M=.02*C,j=a.clone();for(let H=0;H<10&&C-E>M;H++){j.y=s.ah(E,C,.66);const G=this.projection.pointCoordinate3D(this,j.x,j.y);G?(C=j.y,_=G):E=j.y}return _?new s.ac(_[0],_[1],_[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=s.bY)return!this.isPointAboveHorizon(a);const h=this.pointCoordinate(a);return h.y>=0&&h.y<=1}_coordinatePoint(a,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,E=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return s.ad.vec4.transformMat4(E,E,this.pixelMatrix),E[3]>0?new s.P(E[0]/E[3],E[1]/E[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,C=this.pointLocation3D(new s.P(h,a)),M=this.pointLocation3D(new s.P(E,a)),j=this.pointLocation3D(new s.P(E,_)),H=this.pointLocation3D(new s.P(h,_));let G=Math.min(C.lng,M.lng,j.lng,H.lng),Y=Math.max(C.lng,M.lng,j.lng,H.lng),ne=Math.min(C.lat,M.lat,j.lat,H.lat),ee=Math.max(C.lat,M.lat,j.lat,H.lat);const he=Math.pow(2,-this.zoom)/16*270,we=this.projection.name==="globe"?1:4,xe=(Ee,Ce,je,$e,We)=>{const Ze=(Ee+je)/2,Ye=(Ce+$e)/2,Xe=new s.P(Ze,Ye),{lng:Ke,lat:tt}=this.pointLocation3D(Xe),at=Math.max(0,G-Ke,ne-tt,Ke-Y,tt-ee);G=Math.min(G,Ke),Y=Math.max(Y,Ke),ne=Math.min(ne,tt),ee=Math.max(ee,tt),(We<we||at>he)&&(xe(Ee,Ce,Ze,Ye,We+1),xe(Ze,Ye,je,$e,We+1))};if(xe(h,a,E,a,1),xe(E,a,E,_,1),xe(E,_,h,_,1),xe(h,_,h,a,1),this.projection.name==="globe"){const[Ee,Ce]=s.bZ(this);Ee?(ee=90,Y=180,G=-180):Ce&&(ne=-90,Y=180,G=-180)}return new s.aB(new s.bO(G,ne),new s.bO(Y,ee))}_getBoundsRectangular(a,h){const{top:_,left:E}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,j=new s.P(E,_),H=new s.P(M,_),G=new s.P(M,C),Y=new s.P(E,C);let ne=this.pointCoordinate(j,a),ee=this.pointCoordinate(H,a);const he=this.pointCoordinate(G,h),we=this.pointCoordinate(Y,h),xe=(Ee,Ce)=>(Ce.y-Ee.y)/(Ce.x-Ee.x);return ne.y>1&&ee.y>=0?ne=new s.ac((1-we.y)/xe(we,ne)+we.x,1):ne.y<0&&ee.y<=1&&(ne=new s.ac(-we.y/xe(we,ne)+we.x,0)),ee.y>1&&ne.y>=0?ee=new s.ac((1-he.y)/xe(he,ee)+he.x,1):ee.y<0&&ne.y<=1&&(ee=new s.ac(-he.y/xe(he,ee)+he.x,0)),new s.aB().extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(we)).extend(this.coordinateLocation(he))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=a.visibleDemTiles.reduce((_,E)=>{if(E.dem){const C=E.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-s.bX,this.maxLat=s.bX,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.av(this.minLng)*this.tileSize,this.worldMaxX=s.av(this.maxLng)*this.tileSize,this.worldMinY=s.aC(this.maxLat)*this.tileSize,this.worldMaxY=s.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,_=this._distanceTileDataCache;if(_[h])return _[h];const E=a.canonical,C=1/this.height,M=this.cameraWorldSize,j=M/this.zoomScale(E.z),H=(E.x+Math.pow(2,E.z)*a.wrap)*j,G=E.y*j,Y=this.point;Y.x*=M/this.worldSize,Y.y*=M/this.worldSize;const ne=this.angle,ee=Math.sin(-ne),he=-Math.cos(-ne);return _[h]={bearing:[ee,he],center:[(Y.x-H)*C,(Y.y-G)*C],scale:j/s.ai*C},_[h]}calculateFogTileMatrix(a){const h=a.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return s.ad.mat4.multiply(E,this.worldToFogMatrix,E),_[h]=new Float32Array(E),_[h]}calculateProjMatrix(a,h=!1,_=!1){const E=a.key;let C;if(C=_?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,C[E])return C[E];const M=this.calculatePosMatrix(a,this.worldSize);let j;return j=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,s.ad.mat4.multiply(M,j,M),C[E]=new Float32Array(M),C[E]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const E=s.b_(a,this);return _[h]=E,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,h=s.ad.mat4.fromScaling([],[a,a,a]);return s.ad.mat4.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const h=s.bH(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),E=this._camera.forward(),C=s.bH(1,this._center.lat);_[2]/=C,E[2]/=C,s.ad.vec3.normalize(E,E);const M=a.raycast(_,E,a.exaggeration());if(M){const j=s.ad.vec3.scaleAndAdd([],_,E,M),H=new s.ac(j[0],j[1],s.bH(j[2],s.aT(j[1]))),G=(H.z+s.ad.vec3.length([H.x-_[0],H.y-_[1],H.z-_[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=H.toAltitude(),this._center=this.coordinateLocation(H),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const h=this._elevation,_=s.bH(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(_),C=h.getAtPointOrZero(new s.ac(...E)),M=this.pixelsPerMeter/this.worldSize*C,j=this._minimumHeightOverTerrain(),H=E[2]-M;if(H<=j)if(H<0||a){const G=this.locationCoordinate(this._center,this._centerAltitude),Y=[E[0],E[1],G.z-E[2]],ne=s.ad.vec3.length(Y);Y[2]-=(j-H)/this._pixelsPerMercatorPixel;const ee=s.ad.vec3.length(Y);if(ee===0)return;s.ad.vec3.scale(Y,Y,ne/ee*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],G.z*this._pixelsPerMercatorPixel-Y[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const ee=this.center;return ee.lat=s.ay(ee.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(ee.lng=s.ay(ee.lng,this.minLng,this.maxLng)),this.center=ee,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:E}=this.point;let C=0,M=_,j=E;const H=this.width/2,G=this.height/2,Y=this.worldMinY*this.scale,ne=this.worldMaxY*this.scale;if(E-G<Y&&(j=Y+G),E+G>ne&&(j=ne-G),ne-Y<this.height&&(C=Math.max(C,this.height/(ne-Y)),j=(ne+Y)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ee=this.worldMinX*this.scale,he=this.worldMaxX*this.scale,we=this.worldSize/2-(ee+he)/2;M=(_+we+this.worldSize)%this.worldSize-we,M-H<ee&&(M=ee+H),M+H>he&&(M=he-H),he-ee<this.width&&(C=Math.max(C,this.width/(he-ee)),M=(he+ee)/2)}M===_&&j===E||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(M,j))),C&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bH(1,this.center.lat)/s.bH(1,s.c8));const E=s.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,E),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C=this.projection.zAxisUnit==="meters"?_:1,M=this._camera.getWorldToCamera(this.worldSize,C);let j;const H=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(H[8]=2*-a.x/this.width,H[9]=2*a.y/this.height,this.isOrthographic){let tt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),at=tt*this.aspect,At=-at,xt=-tt;at-=a.x,At-=a.x,tt+=a.y,xt+=a.y,j=this._camera.getCameraToClipOrthographic(At,at,xt,tt,this._nearZ,this._farZ),((Bt,zt,Jt,yt)=>{for(let Ft=0;Ft<16;Ft++)Bt[Ft]=s.ah(zt[Ft],Jt[Ft],yt)})(j,j,H,s.c9(this.pitch>=sn?1:this.pitch/sn))}else j=H;const G=s.ad.mat4.mul([],H,M);let Y=s.ad.mat4.mul([],j,M);if(this.projection.isReprojectedInTileSpace){const tt=this.locationCoordinate(this.center),at=s.ad.mat4.identity([]);s.ad.mat4.translate(at,at,[tt.x*this.worldSize,tt.y*this.worldSize,0]),s.ad.mat4.multiply(at,at,s.c0(this)),s.ad.mat4.translate(at,at,[-tt.x*this.worldSize,-tt.y*this.worldSize,0]),s.ad.mat4.multiply(Y,Y,at),s.ad.mat4.multiply(G,G,at),this.inverseAdjustmentMatrix=s.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.ad.mat4.scale([],Y,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=Y,this.invProjMatrix=s.ad.mat4.invert(new Float64Array(16),this.projMatrix),h){const tt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);tt[8]=2*-a.x/this.width,tt[9]=2*a.y/this.height,this.expandedFarZProjMatrix=s.ad.mat4.mul([],tt,M)}else this.expandedFarZProjMatrix=this.projMatrix;const ne=s.ad.mat4.invert([],j);this.frustumCorners=s.c2.fromInvProjectionMatrix(ne,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const ee=new Float32Array(16);s.ad.mat4.identity(ee),s.ad.mat4.scale(ee,ee,[1,-1,1]),s.ad.mat4.rotateX(ee,ee,this._pitch),s.ad.mat4.rotateZ(ee,ee,this.angle);const he=s.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.ad.mat4.clone(he);const we=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;he[8]=2*-a.x/this.width,he[9]=2*(a.y+we)/this.height,this.skyboxMatrix=s.ad.mat4.multiply(ee,he,ee);const xe=this.point,Ee=xe.x,Ce=xe.y,je=this.width%2/2,$e=this.height%2/2,We=Math.cos(this.angle),Ze=Math.sin(this.angle),Ye=Ee-Math.round(Ee)+We*je+Ze*$e,Xe=Ce-Math.round(Ce)+We*$e+Ze*je,Ke=new Float64Array(Y);if(s.ad.mat4.translate(Ke,Ke,[Ye>.5?Ye-1:Ye,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=Ke,Y=s.ad.mat4.create(),s.ad.mat4.scale(Y,Y,[this.width/2,-this.height/2,1]),s.ad.mat4.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=s.ad.mat4.create(),s.ad.mat4.scale(Y,Y,[1,-1,1]),s.ad.mat4.translate(Y,Y,[-1,-1,0]),s.ad.mat4.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=s.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},Y=s.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!Y)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Y,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.c3(this);const tt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad.vec3.transformMat4(tt,tt,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Y;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,C=[a,a,h];s.ad.vec3.scale(C,C,E),s.ad.vec3.scale(_,_,-1),s.ad.vec3.multiply(_,_,C);const M=s.ad.mat4.create();s.ad.mat4.translate(M,M,_),s.ad.mat4.scale(M,M,C),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,E)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),E=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-_[0]*C,E.y/this.worldSize-_[1]*C,a/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],E=a[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(C=Math.min((h-_)/E,1)),this._camera.position=s.ad.vec3.scaleAndAdd([],this._camera.position,a,C),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:E}=this._camera.getPitchBearing(),C=s.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.ak(this._maxPitch)),j=Math.max((a[2]-C)/Math.cos(_),M),H=this._zoomFromMercatorZ(j);s.ad.vec3.scaleAndAdd(a,a,h,j),this._pitch=s.ay(_,s.ak(this.minPitch),s.ak(this.maxPitch)),this.angle=s.bF(E,-Math.PI,Math.PI),this._setZoom(s.ay(H,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let h=0,_=s.bY,E=0,C=1/0;for(;_-h>1e-6&&_>h;){const M=h+.5*(_-h),j=this.tileSize*Math.pow(2,M),H=this.getCameraToCenterDistance(this.projection,M,j),G=this.scaleZoom(H/(a*this.tileSize)),Y=Math.abs(M-G);Y<C&&(C=Y,E=M),M<G?h=M:_=M}return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const _=Math.min(a.x,h.x),E=Math.max(a.x,h.x),C=Math.min(a.y,h.y),M=Math.max(a.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const j=[new s.P(_,C),new s.P(E,M),new s.P(_,M),new s.P(E,C)],H=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const Y of j){const ne=this.pointRayIntersection(Y);if(ne.t<0)return!0;const ee=this.rayIntersectionCoordinate(ne);if(ee.x<H||ee.y<0||ee.x>G||ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(a,h){const _=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,a)),E=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([h,_,E],C){const M=[h,_,E,1];s.ad.vec4.transformMat4(M,M,C);const j=M[3]=Math.max(M[3],1e-6);return M[0]/=j,M[1]/=j,M[2]/=j,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,a))}}getCameraToCenterDistance(a,h=this.zoom,_=this.worldSize){const E=s.b$(a,h,this.width,this.height,1024),C=a.pixelSpaceConversion(this.center.lat,_,E);let M=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(M=s.ah(1,M,s.c9(this.pitch>=sn?1:this.pitch/sn))),M}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.ad.mat4.multiply(a,a,this.globeMatrix),a}getFrustum(a){return s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}const Nl=(y,a)=>{if(a>0&&y.terrain&&s.w("Cutoff is currently disabled on terrain"),a<=0||y.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=y.transform,_=Math.max(Math.abs(h._zoom-(y.minCutoffZoom-1)),1),E=h.isLODDisabled(!1)?s.ae(60,45,h.pitch):s.ae(30,15,h.pitch),C=h._farZ-h._nearZ,M=a*h.height,j=((1-(H=E))*h.cameraToCenterDistance+H*(h._farZ+M))*_;var H;return{shouldRenderCutoff:E<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(j-h._nearZ)/C,(j-M-h._nearZ)/C]}}},Ne={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class m{constructor(a,h){this.aabb=a,this.lastCascade=h}}class b{add(a,h){const _=this.receivers[a.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],h.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],h.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],h.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],h.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],h.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],h.max[2])):this.receivers[a.key]=new m(h,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,h,_){const E=s.ce.fromPoints(a.points);let C=0;for(const M in this.receivers){const j=this.receivers[M];if(!j||!E.intersectsAabb(j.aabb))continue;j.aabb.min=E.closestPoint(j.aabb.min),j.aabb.max=E.closestPoint(j.aabb.max);const H=j.aabb.getCorners();for(let G=0;G<_.length;G++){let Y=!0;for(const ne of H){const ee=[ne[0]*h,ne[1]*h,ne[2]];if(s.ad.vec3.transformMat4(ee,ee,_[G].matrix),ee[0]<-1||ee[0]>1||ee[1]<-1||ee[1]>1){Y=!1;break}}if(j.lastCascade=G,C=Math.max(C,G),Y)break}}return C+1}}class S{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new b,this._depthMode=new gn(a.context.gl.LEQUAL,gn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(Ne,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(Ne,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),a.tp.registerParameter(Ne,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,h){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const E=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||E<=0||(this._shadowLayerCount=_.style.order.reduce((we,xe)=>{const Ee=_.style._mergedLayers[xe];return we+(Ee.hasShadowPass()&&!Ee.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const C=_.context,M=Ne.shadowMapResolution,j=Ne.shadowMapResolution;if(this._cascades.length===0||Ne.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let we=0;we<Ne.cascadeCount;++we){const xe=_._shadowMapDebug,Ee=C.gl,Ce=C.createFramebuffer(M,j,xe,"texture"),je=new s.T(C,{width:M,height:j,data:null},Ee.DEPTH_COMPONENT16);if(Ce.depthAttachment.set(je.texture),xe){const $e=new s.T(C,{width:M,height:j,data:null},Ee.RGBA8);Ce.colorAttachment.set($e.texture)}this._cascades.push({framebuffer:Ce,texture:je,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bR,scale:0})}}this.shadowDirection=N(h);let H=0;if(a.elevation){const we=a.elevation,xe=[1e4,-1e4];we.visibleDemTiles.filter(Ee=>Ee.dem).forEach(Ee=>{const Ce=Ee.dem.tree;xe[0]=Math.min(xe[0],Ce.minimums[0]),xe[1]=Math.max(xe[1],Ce.maximums[0])}),xe[0]!==1e4&&(H=(xe[1]-xe[0])*we.exaggeration())}const G=1.5*a.cameraToCenterDistance,Y=3*G,ne=new Float64Array(16);for(let we=0;we<this._cascades.length;++we){const xe=this._cascades[we];let Ee=a.height/50,Ce=1;Ne.cascadeCount===1?Ce=Y:we===0?Ce=G:(Ee=G,Ce=Y);const[je,$e]=$(a,this.shadowDirection,Ee,Ce,Ne.shadowMapResolution,H);xe.scale=a.scale,xe.matrix=je,xe.boundingSphereRadius=$e,s.ad.mat4.invert(ne,xe.matrix),xe.frustum=s.bR.fromInvProjectionMatrix(ne,1,0,!0),xe.far=Ce}const ee=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[ee].far,this._cascades[ee].far],this._uniformValues.u_shadow_intensity=E,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ne.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ne.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ps.ShadowMap0,this._uniformValues.u_shadowmap_1=Ps.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const he=_.transform.elevation;for(const we of this._groundShadowTiles){let xe={min:0,max:0};if(he){const Ee=he.getMinMaxForTile(we);Ee&&(xe=Ee)}this.addShadowReceiver(we.toUnwrapped(),xe.min,xe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,h){if(!this.enabled)return;const _=this.painter,E=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),E.viewport.set([0,0,Ne.shadowMapResolution,Ne.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){_.currentShadowCascade=C,E.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),E.clear({color:s.al.white,depth:1});for(const M of a.order){const j=a._mergedLayers[M];if(!j.hasShadowPass()||j.isHidden(_.transform.zoom))continue;const H=a.getLayerSourceCache(j),G=H?h[H.id]:void 0;(j.type==="model"||G&&G.length)&&_.renderLayer(_,H,j,G)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,h=a.style,_=a.context,E=h.directionalLight,C=h.ambientLight;if(!E||!C)return;const M=[],j=Nl(a,a.longestCutoffRange);j.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),M.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&M.push("NORMAL_OFFSET");const H=V(h,E,C),G=new gn(_.gl.LEQUAL,gn.ReadOnly,a.depthRangeFor3D);for(const Y of this._groundShadowTiles){const ne=Y.toUnwrapped(),ee=a.isTileAffectedByFog(Y),he=a.getOrCreateProgram("groundShadow",{defines:M,overrideFog:ee});this.setupShadows(ne,he),a.uploadCommonUniforms(_,he,ne,null,j);const we={u_matrix:a.transform.calculateProjMatrix(ne),u_ground_shadow_factor:H};he.draw(a,_.gl.TRIANGLES,G,Un.disabled,nr.multiply,qn.disabled,we,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,null,a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?nr.unblended:nr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){const h=this.painter.transform,_=h.calculatePosMatrix(a,h.worldSize);return s.ad.mat4.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(a){return s.ad.mat4.multiply(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,h,_,E=0){if(!this.enabled)return;const C=this.painter.transform,M=this.painter.context,j=M.gl,H=this._uniformValues,G=new Float64Array(16),Y=C.calculatePosMatrix(a,C.worldSize);for(let ne=0;ne<this._cascades.length;ne++)s.ad.mat4.multiply(G,this._cascades[ne].matrix,Y),H[ne===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(G),M.activeTexture.set(j.TEXTURE0+Ps.ShadowMap0+ne),this._cascades[ne].texture.bind(j.NEAREST,j.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){const ne=s.cd(a.canonical),ee=2/C.tileSize*s.ai/Ne.shadowMapResolution,he=ee*this._cascades[0].boundingSphereRadius,we=ee*this._cascades[this._cascades.length-1].boundingSphereRadius,xe=(_==="vector-tile"?1:3)/Math.pow(2,E-a.canonical.z-(1-C.zoom+Math.floor(C.zoom)));H.u_shadow_normal_offset=[ne,he*xe,we*xe],H.u_shadow_bias=[6e-5,.0012,.012]}else H.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(M,H)}setupShadowsFromMatrix(a,h,_=!1){if(!this.enabled)return;const E=this.painter.context,C=E.gl,M=this._uniformValues,j=new Float64Array(16);for(let H=0;H<Ne.cascadeCount;H++)s.ad.mat4.multiply(j,this._cascades[H].matrix,a),M[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(j),E.activeTexture.set(C.TEXTURE0+Ps.ShadowMap0+H),this._cascades[H].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=_,_){const H=Ne.normalOffset;M.u_shadow_normal_offset=[1,H,H],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(E,M)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,h,_,E){if(E[2]>=0)return{};const C=function(H,G,Y){const ne=Y/(1<<H.canonical.z);return new s.ce([H.canonical.x*ne+H.wrap*Y,H.canonical.y*ne+H.wrap*Y,0],[(H.canonical.x+1)*ne+H.wrap*Y,(H.canonical.y+1)*ne+H.wrap*Y,G])}(a,h,_).getCorners(),M=h/-E[2];E[0]<0?(s.ad.vec3.add(C[0],C[0],[E[0]*M,0,0]),s.ad.vec3.add(C[3],C[3],[E[0]*M,0,0])):E[0]>0&&(s.ad.vec3.add(C[1],C[1],[E[0]*M,0,0]),s.ad.vec3.add(C[2],C[2],[E[0]*M,0,0])),E[1]<0?(s.ad.vec3.add(C[0],C[0],[0,E[1]*M,0]),s.ad.vec3.add(C[1],C[1],[0,E[1]*M,0])):E[1]>0&&(s.ad.vec3.add(C[2],C[2],[0,E[1]*M,0]),s.ad.vec3.add(C[3],C[3],[0,E[1]*M,0]));const j={};return j.vertices=C,j.planes=[P(C[1],C[0],C[4]),P(C[2],C[1],C[5]),P(C[3],C[2],C[6]),P(C[0],C[3],C[7])],j}addShadowReceiver(a,h,_){this._receivers.add(a,s.ce.fromTileIdAndHeight(a,h,_))}getMaxCascadeForTile(a){const h=this._receivers.get(a);return h&&h.lastCascade?h.lastCascade:0}}function P(y,a,h){const _=s.ad.vec3.sub([],h,a),E=s.ad.vec3.sub([],y,a),C=s.ad.vec3.cross([],_,E),M=s.ad.vec3.length(C);return M===0?[0,0,1,0]:(s.ad.vec3.scale(C,C,1/M),[C[0],C[1],C[2],-s.ad.vec3.dot(C,a)])}function N(y){const a=y.properties.get("direction"),h=s.cc(a.x,a.y,a.z);h[2]=s.ay(h[2],0,75);const _=s.cf([h[0],h[1],h[2]]);return s.ad.vec3.fromValues(_.x,_.y,_.z)}function V(y,a,h){const _=a.properties.get("color-use-theme")==="none",E=a.properties.get("color"),C=a.properties.get("intensity"),M=a.properties.get("direction"),j=[M.x,M.y,M.z],H=h.properties.get("color-use-theme")==="none",G=h.properties.get("color"),Y=h.properties.get("intensity"),ne=Math.max(s.ad.vec3.dot([0,0,1],j),0),ee=[0,0,0];s.ad.vec3.scale(ee,G.toRenderColor(H?null:y.getLut(a.scope)).toArray01Linear().slice(0,3),Y);const he=[0,0,0];return s.ad.vec3.scale(he,E.toRenderColor(_?null:y.getLut(h.scope)).toArray01Linear().slice(0,3),ne*C),s.cg([ee[0]>0?ee[0]/(ee[0]+he[0]):0,ee[1]>0?ee[1]/(ee[1]+he[1]):0,ee[2]>0?ee[2]/(ee[2]+he[2]):0])}function $(y,a,h,_,E,C){const M=y.zoom,j=y.scale,H=y.worldSize,G=1/H,Y=y.aspect,ne=Math.sqrt(1+Y*Y)*Math.tan(.5*y.fovX),ee=ne*ne,he=_-h,we=_+h;let xe,Ee;ee>he/we?(xe=_,Ee=_*ne):(xe=.5*we*(1+ee),Ee=.5*Math.sqrt(he*he+2*(_*_+h*h)*ee+we*we*ee*ee));const Ce=y.projection.pixelsPerMeter(y.center.lat,H),je=y._camera.getCameraToWorldMercator(),$e=[0,0,-xe*G];s.ad.vec3.transformMat4($e,$e,je);let We=Ee*G;const Ze=y._edgeInsets;if(!(Ze.left===0&&Ze.top===0&&Ze.right===0&&Ze.bottom===0||Ze.left===Ze.right&&Ze.top===Ze.bottom)){const Ut=y._camera.getWorldToCamera(y.worldSize,y.projection.zAxisUnit==="meters"?Ce:1),Rt=y._camera.getCameraToClipPerspective(y._fov,y.width/y.height,h,_);Rt[8]=2*-y.centerOffset.x/y.width,Rt[9]=2*y.centerOffset.y/y.height;const Wt=new Float64Array(16);s.ad.mat4.mul(Wt,Rt,Ut);const dn=new Float64Array(16);s.ad.mat4.invert(dn,Wt);const pn=s.bR.fromInvProjectionMatrix(dn,H,M,!0);for(const xn of pn.points){const kn=((Ye=xn)[0]/=j,Ye[1]/=j,Ye[2]=s.bH(Ye[2],y._center.lat),Ye);We=Math.max(We,s.ad.vec3.len(s.ad.vec3.subtract([],$e,kn)))}}var Ye;We*=E/(E-1);const Xe=Math.acos(a[2]),Ke=Math.atan2(-a[0],-a[1]),tt=new Ha;tt.position=$e,tt.setPitchBearing(Xe,Ke);const at=tt.getWorldToCamera(H,Ce),At=We*H,xt=Math.min(y._mercatorZfromZoom(17)*H*-2,-2*At),Bt=tt.getCameraToClipOrthographic(-At,At,-At,At,xt,(At+C*Ce)/a[2]),zt=new Float64Array(16);s.ad.mat4.multiply(zt,Bt,at);const Jt=s.ad.vec3.fromValues(Math.floor(1e6*$e[0])/1e6*H,Math.floor(1e6*$e[1])/1e6*H,0),yt=.5*E,Ft=[0,0,0];s.ad.vec3.transformMat4(Ft,Jt,zt),s.ad.vec3.scale(Ft,Ft,yt);const gt=[Math.floor(Ft[0]),Math.floor(Ft[1]),Math.floor(Ft[2])],Lt=[0,0,0];s.ad.vec3.sub(Lt,Ft,gt),s.ad.vec3.scale(Lt,Lt,-1/yt);const kt=new Float64Array(16);return s.ad.mat4.identity(kt),s.ad.mat4.translate(kt,kt,Lt),s.ad.mat4.multiply(zt,kt,zt),[zt,At]}class te extends s.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(a,h){return s.aN(this.requestManager.transformRequest(h,s.R.Model).url).then(_=>{if(!_)return;const E=s.aO(_),C=new s.aP(a,void 0,void 0,E);return C.computeBoundsAndApplyParent(),C}).catch(_=>{if(_&&_.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${a} from ${h}: ${_.message}`)))})}load(a,h,_={keepNumReferences:!1}){this.models[h]||(this.models[h]={});const E=Object.keys(a);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+E.length;const C=[];for(const M of E)C.push(this.loadModel(M,a[M]));Promise.allSettled(C).then(M=>{for(let j=0;j<M.length;j++){const{status:H,value:G}=M[j];if(H==="fulfilled"&&G){const Y=this.models[h][E[j]];this.models[h][E[j]]={model:G,numReferences:_.keepNumReferences&&Y?Y.numReferences:1}}}this.numModelsLoading[h]-=E.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(M=>{this.fire(new s.z(new Error(`Could not load models: ${M.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,h){return!!this.getModel(a,h)}getModel(a,h){return this.models[h]||(this.models[h]={}),this.models[h][a]?this.models[h][a].model:void 0}addModel(a,h,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={}),this.hasModel(a,_)&&this.models[_][a].numReferences++,this.modelUris[_][a]=this.requestManager.normalizeModelURL(h),this.load({[a]:this.modelUris[_][a]},_)}addModels(a,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const _=this.modelUris[h];for(const E in a)this.models[h][E]={},_[E]=this.requestManager.normalizeModelURL(a[E]);this.load(_,h,{keepNumReferences:!0})}reloadModels(a){this.load(this.modelUris[a],a)}addModelsFromBucket(a,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const _={};for(const E of a)this.hasModel(E,h)?this.models[h][E].numReferences++:(this.modelUris[h][E]=this.requestManager.normalizeModelURL(E),_[E]=this.modelUris[h][E]);this.load(_,h)}removeModel(a,h){if(this.models[h]&&this.models[h][a]&&(this.models[h][a].numReferences--,this.models[h][a].numReferences===0)){const _=this.models[h][a].model;delete this.models[h][a],delete this.modelUris[h][a],_.destroy()}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,h){this.models[h]||(this.models[h]={});for(const _ in this.models[h])this.models[h][_].model&&this.models[h][_].model.upload(a.context)}}const de=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),Re={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Fe(y){return y=y||{},Object.assign(y,Re)}class Ge extends s.E{constructor(a){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=a,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(a=>{a.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=a.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=a.stylesheet.indoor.buildingFeaturesetId,this._scope=a.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:a=>(a.feature&&a.feature.properties.floorplan&&this.selectFloorplan(a.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(a){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(M,j){const[H,G]=M,{center:Y,radius:ne}=j,[ee,he]=Y,we=Math.abs(H-ee);return Math.sqrt((we>180?360-we:we)**2+(G-he)**2)<=ne}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone")));const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=new s.P(this._map.transform.width/2,this._map.transform.height/2),E=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],C=this._map.queryRenderedFeatures(a?E:_,h);C.length>0&&(this._selectedFloorplan&&C[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=C[0],this._floorplanSelected(!1)))}_floorplanSelected(a){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(C){const[[M,j],[H,G]]=C,Y=(H-M+360)%360,ne=Y>180?360-Y:Y;return{center:[(M+ne/2+360)%360,(j+G)/2],radius:Math.sqrt(ne**2+(G-j)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const h=this._floorplanStates[this._indoorData.id].selectedBuilding,_=this._floorplanStates[this._indoorData.id].selectedLevel;let E;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const C of this._indoorData.levels)C.id===this._selectedLevel.id&&(E=C.id);if(this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:E})),h){const C=this._indoorData.buildings.find(M=>M.id===h);this._buildingSelected(C,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(_){const C=this._indoorData.levels.find(M=>M.id===_);this._updateLevels(C,a)}else a&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(a,h){h&&a&&a.extent&&this._map.fitBounds(a.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=a?a.id:void 0;const _=this._indoorData.levels.filter(E=>a.levels.includes(E.id));this.fire(new s.A("buildingselected",{buildingId:a.id,levels:_}))}_levelSelected(a){if(a==="overview")this._updateLevels(void 0,!0);else{const h=this._indoorData.levels.find(_=>_.id===a);this._updateLevels(h,!0)}this.fire(new s.A("levelselected",{levelId:a==="overview"?void 0:a}))}_updateLevels(a,h){if(!a)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(h&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function _(G){const Y=G.indexOf("/floor/");if(Y===-1)return G;const ne=Y+7,ee=G.indexOf("/",ne);return ee===-1?G.slice(ne):G.slice(ne,ee)}this._selectedLevel=a,this._floorplanStates[this._indoorData.id].selectedLevel=a?a.id:void 0;const E=[],C={},M={},j={},H={};for(const G of this._indoorData.levels)if(E.push(G.id),C[G.id]=G.height,M[G.id]=G.base,a){if(this.mergeFloors){const Y=_(a.id),ne=_(G.id);j[G.id]=ne===Y?"true":"false"}else j[G.id]=G.id===a.id?"true":"false";H[G.id]=G.base<a.base?"true":"false"}else H[G.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",j]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",H]),a&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!a.isUnderground),h&&a.extent)){const G=this._map.cameraForBounds(a.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),Y=this._map.getZoom(),ne=G.zoom?Math.abs(Y-G.zoom):0;this._map.fitBounds(a.extent,ne>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:Y})}}selectFloorplan(a){const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],E=this._map.queryRenderedFeatures(_,h);if(E.length>0){for(const C of E)if(JSON.parse(C.properties["indoor-data"]).floorplanIDs.includes(a)){this._selectedFloorplan=C,this._floorplanSelected(!0);break}}}selectBuilding(a){const h=this._indoorData.buildings.find(_=>_.id===a);this._buildingSelected(h,!0)}selectLevel(a){this._levelSelected(a)}}function dt(y){if(!y.metadata||!y.metadata.content_area)return;const a=s.q.devicePixelRatio,{left:h,top:_,width:E,height:C}=y.metadata.content_area,M=h*a,j=_*a;return[M,j,M+E*a,j+C*a]}function Ct(y){if(y)return y.map(([a,h])=>[a*s.q.devicePixelRatio,h*s.q.devicePixelRatio])}class Pt{constructor(a,h,_){this.id=a,this.scope=h,this.sourceCache=_,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(a){this.missingRequests.has(a.name)||this.pendingRequests.has(a.name)||this.pendingRequests.add(a.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const a=new Map;if(!this.sourceCache.loaded())return a;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return a;const _=this.sourceCache.getSource();if(!(_ instanceof xa))return a;const E=h.map(M=>this.sourceCache.getTile(M)),C=_.getImages(E,Array.from(this.pendingRequests));for(const[M,j]of C)a.set(s.I.from({name:M,iconsetId:this.id}),j),this.pendingRequests.delete(M);for(const M of this.pendingRequests)this.missingRequests.add(M);return this.pendingRequests.clear(),a}}const $t=(y,a)=>Tt(y,a&&a.filter(h=>h.identifier!=="source.canvas")),tn=s.aA(Or,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Vn=s.aA(Or,["setCenter","setZoom","setBearing","setPitch"]),zn=new Set(["background","sky","slot","custom"]),Dn={version:8,layers:[],sources:{}},Pi={duration:300,delay:0};class Xr extends s.E{constructor(a,h={}){super(),this.map=a,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=s.l({},Pi),this._buildingIndex=new Bd(this),this.crossTileSymbolIndex=new Kn,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Yn,this.dispatcher=h.dispatcher?h.dispatcher:new s.D(s.cj(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Sr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new s.ck(a._requestManager,h.localFontFamily?s.cl.all:h.localIdeographFontFamily?s.cl.ideographs:s.cl.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new te(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",s.cm());const _=this;this._rtlTextPluginCallback=Xr.registerForPluginStateChange(E=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(C,M)=>{if(s.cn(C),M&&M.every(j=>j))for(const j in _._sourceCaches){const H=_._sourceCaches[j],G=H.getSource().type;G!=="vector"&&G!=="geojson"||H.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const C=this.getOwnSource(E.sourceId);if(C&&C.vectorLayerIds)for(const M in this._layers){const j=this._layers[M];j.source===C.id&&this._validateLayer(j)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(s.f(a))return a;const h=s.co(a);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${s.cp(JSON.stringify(a))}`}_diffStyle(a,h,_){this.globalId=this._getGlobalId(a);const E=(C,M)=>{try{M(null,this.setState(C,_))}catch(j){M(j,!1)}};if(typeof a=="string"){const C=this.map._requestManager.normalizeStyleURL(a),M=this.map._requestManager.transformRequest(C,s.R.Style);s.n(M,(j,H)=>{j?this.fire(new s.z(j)):H&&E(H,h)})}else typeof a=="object"&&E(a,h)}loadURL(a,h={}){this.fire(new s.A("dataloading",{dataType:"style"}));const _=typeof h.validate=="boolean"?h.validate:!s.f(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,h.accessToken),this.resolvedImports.add(a);const E=this.importsCache.get(a);if(E)return this._load(E,_);const C=this.map._requestManager.transformRequest(a,s.R.Style);this._request=s.n(C,(M,j)=>{if(this._request=null,M)this.fire(new s.z(M));else if(j)return this.importsCache.set(a,j),this._load(j,_)})}loadJSON(a,h={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=s.q.frame(()=>{this._request=null,this._load(a,h.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(Dn,!1)}_loadImports(a,h,_){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const E=[];for(const C of a){const M=this._createFragmentStyle(C),j=new Promise(Y=>{M.once("style.import.load",Y),M.once("error",Y)}).then(()=>this.mergeAll());if(E.push(j),this.resolvedImports.has(C.url)){M.loadEmpty();continue}const H=C.data||this.importsCache.get(C.url);H?(M.loadJSON(H,{validate:h}),this._isInternalStyle(H)&&(M.globalId=null)):C.url?M.loadURL(C.url,{validate:h}):M.loadEmpty();const G={style:M,id:C.id,config:C.config};if(_){const Y=this.fragments.findIndex(({id:ne})=>ne===_);this.fragments=this.fragments.slice(0,Y).concat(G).concat(this.fragments.slice(Y))}else this.fragments.push(G)}return Promise.allSettled(E)}getImportGlobalIds(a=this,h=new Set){for(const _ of a.fragments)_.style.globalId&&h.add(_.style.globalId),this.getImportGlobalIds(_.style,h);return[...h.values()]}_createFragmentStyle(a){const h=this.scope?s.C(a.id,this.scope):a.id;let _;const E=this._initialConfig&&this._initialConfig[h];(a.config||E)&&(_=s.l({},a.config,E));const C=new Xr(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:a["color-theme"],configDependentLayers:this._configDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,h){const _=a.indoor?Fe(a.schema):a.schema;if(this._isInternalStyle(a)){const M=s.l({},Dn,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(M,h)}if(this.updateConfig(this._config,_),h&&$t(this,Zr(a)))return;this._loaded=!0,this.stylesheet=s.cq(a);const E=()=>{for(const G in a.sources)this.addSource(G,a.sources[G],{validate:!1,isInitialLoad:!0});if(a.iconsets)for(const G in a.iconsets)this.addIconset(G,a.iconsets[G]);a.sprite?this._loadIconset(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(a.glyphs);const M=ba(this.stylesheet.layers);if(this._order=M.map(G=>G.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const G=this.stylesheet.lights[0];this.light=new ht(G.properties,G.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ht(this.stylesheet.light)),this._layers={};for(const G of M){const Y=s.cv(G,this.scope,this._styleColorTheme.lut,this.options);Y.configDependencies.size!==0&&this._configDependentLayers.add(Y.fqid),Y.setEventedParent(this,{layer:{id:Y.id}}),this._layers[Y.id]=Y;const ne=this.getOwnLayerSourceCache(Y),ee=!!this.directionalLight&&this.directionalLight.shadowsEnabled();ne&&Y.canCastShadows()&&ee&&(ne.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const j=this.stylesheet.terrain;j&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(j,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const H=this.isRootStyle();a.imports?this._loadImports(a.imports,h).then(()=>{this._reloadImports(),this.fire(new s.A(H?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(H?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const C=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(C){const M=this._evaluateColorThemeData(C);this._loadColorTheme(M).then(()=>{E()}).catch(j=>{s.w(`Couldn't load color theme from the stylesheet: ${j}`),E()})}else this._styleColorTheme.lut=null,E()}isRootStyle(){return this.importDepth===0}mergeAll(){let a,h,_,E,C,M,j,H,G,Y;const ne={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(ee=>{if(ee.stylesheet){if(ee.light!=null&&(a=ee.light),ee.stylesheet.lights)for(const he of ee.stylesheet.lights)he.type==="ambient"&&ee.ambientLight!=null&&(h=ee.ambientLight),he.type==="directional"&&ee.directionalLight!=null&&(_=ee.directionalLight);E=this._prioritizeTerrain(E,ee.terrain,ee.stylesheet.terrain),ee.stylesheet.fog&&ee.fog!=null&&(C=ee.fog),ee.stylesheet.snow&&ee.snow!=null&&(M=ee.snow),ee.stylesheet.rain&&ee.rain!=null&&(j=ee.rain),ee.stylesheet.camera!=null&&(Y=ee.stylesheet.camera),ee.stylesheet.projection!=null&&(H=ee.stylesheet.projection),ee.stylesheet.transition!=null&&(G=ee.stylesheet.transition),ne[ee.scope]=ee._styleColorTheme}}),this.light=a,this.ambientLight=h,this.directionalLight=_,this.fog=C,this.snow=M,this.rain=j,this._styleColorThemeForScope=ne,E===null?delete this.terrain:this.terrain=E,this.camera=Y||{"camera-projection":"perspective"},this.projection=H||{name:"mercator"},this.transition=s.l({},Pi,G),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){const h=_=>{for(const E of _.fragments)h(E.style);a(_)};h(this)}_prioritizeTerrain(a,h,_){const E=a&&a.drapeRenderMode===0;return _===null?h&&h.drapeRenderMode===0?h:E?a:null:h!=null&&(!a||E||h&&h.drapeRenderMode===1)?h:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{a=this._prioritizeTerrain(a,h.terrain,h.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(a=h.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},h={},_={};this.forEachFragmentStyle(E=>{for(const C in E._sourceCaches){const M=s.C(C,E.scope);a[M]=E._sourceCaches[C]}for(const C in E._otherSourceCaches){const M=s.C(C,E.scope);h[M]=E._otherSourceCaches[C]}for(const C in E._symbolSourceCaches){const M=s.C(C,E.scope);_[M]=E._symbolSourceCaches[C]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=_}mergeLayers(){const a={},h=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(C=>{for(const M of C._order){const j=C._layers[M];if(j.type==="slot"){const H=s.cr(M);if(a[H])continue;a[H]=[]}j.slot&&a[j.slot]?a[j.slot].push(j):h.push(j)}}),this._mergedOrder=[];const E=(C=[])=>{for(const M of C)if(M.type==="slot"){const j=s.cr(M.id);a[j]&&E(a[j]),this._mergedSlots.push(j)}else{const j=s.C(M.id,M.scope);this._mergedOrder.push(j),_[j]=M,M.is3D(!!this.terrain)&&(this._has3DLayers=!0),M.type==="circle"&&(this._hasCircleLayers=!0),M.type==="symbol"&&(this._hasSymbolLayers=!0),M.type==="clip"&&(this._clipLayerPresent=!0)}};E(h),this._mergedOrder.sort((C,M)=>{const j=_[C],H=_[M];return j.hasInitialOcclusionOpacityProperties?H.is3D(!!this.terrain)?1:0:j.is3D(!!this.terrain)&&H.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=s.l({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(h,_,E){const C=s.l({},_);for(const j of Object.keys(s.a5.colorTheme))C[j]===void 0&&(C[j]=s.a5.colorTheme[j].default);const M=new s.a6(de,h,new Map(E));return M.setTransitionOrValue(C,E),M.untransitioned().possiblyEvaluate(new s.aa(0))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,E)=>{const C="data:image/png;base64,";if(!a||a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let M=a;M.startsWith(C)||(M=C+M);const j=s.I.from("mapbox-reserved-lut"),H=new Image;H.src=M,H.onerror=()=>{this._styleColorTheme.lutLoading=!1,E(new Error("Failed to load image data"))},H.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void _();this._styleColorTheme.lutLoading=!1;const{width:G,height:Y,data:ne}=s.q.getImageData(H);if(Y>32)return void E(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==Y*Y)return void E(new Error("The width of the image must be equal to the height squared."));this.getImage(j,this.scope)&&this.removeImage(j,this.scope),this.addImage(j,this.scope,{data:new s.r({width:G,height:Y},ne),pixelRatio:1,sdf:!1,usvg:!1,version:0});const ee=this.imageManager.getImage(j,this.scope);ee?(this._styleColorTheme.lut={image:ee.data,data:a},_()):E(new Error("Missing LUT image."))}})}getLut(a){const h=this._styleColorThemeForScope[a];return h?h.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(h,_,E){let C,M,j;const H=s.q.devicePixelRatio>1?"@2x":"";let G=s.n(_.transformRequest(_.normalizeSpriteURL(h,H,".json"),s.R.SpriteJSON),(ee,he)=>{G=null,j||(j=ee,C=he,ne())}),Y=s.o(_.transformRequest(_.normalizeSpriteURL(h,H,".png"),s.R.SpriteImage),(ee,he)=>{Y=null,j||(j=ee,M=he,ne())});function ne(){if(j)E(j);else if(C&&M){const ee=s.q.getImageData(M),he={};for(const we in C){const{width:xe,height:Ee,x:Ce,y:je,sdf:$e,pixelRatio:We,stretchX:Ze,stretchY:Ye,content:Xe}=C[we],Ke=new s.r({width:xe,height:Ee});s.r.copy(ee,Ke,{x:Ce,y:je},{x:0,y:0},{width:xe,height:Ee},null),he[we]={data:Ke,pixelRatio:We,sdf:$e,stretchX:Ze,stretchY:Ye,content:Xe,usvg:!1}}E(null,he)}}return{cancel(){G&&(G.cancel(),G=null),Y&&(Y.cancel(),Y=null)}}}(a,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new s.z(h));else if(_){const E=new Map;for(const C in _)E.set(s.I.from(C),_[C]);this.addImages(E,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(a,h){if(h.type==="sprite")return void this._loadSprite(h.url);const _=this.getOwnSourceCache(h.source);if(!_)return void this.fire(new s.z(new Error(`Source "${h.source}" as specified by iconset "${a}" does not exist and cannot be used as an iconset source`)));const E=_.getSource();if(E.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${h.source}" as specified by iconset "${a}" is not a "raster-array" source and cannot be used as an iconset source`)));E.partial=!1;const C=new Pt(a,this.scope,_);this.imageManager.addImageProvider(C,this.scope)}removeIconset(a){this.imageManager.removeImageProvider(a,this.scope)}_loadIconset(a){if(!s.f(a)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(a);const h=this.map._spriteFormat==="auto";var _,E;this._spriteRequest=(E=(C,M)=>{if(this._spriteRequest=null,C)h?this._loadSprite(a):this.fire(new s.z(C));else if(M){const j=new Map;for(const H in M)j.set(s.I.from(H),M[H]);this.addImages(j,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.bj((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(a),s.R.Iconset),(C,M)=>{if(C)return void E(C);const j={},H=s.ch(new s.bi(M));for(const G of H.icons){const Y={version:1,pixelRatio:s.q.devicePixelRatio,content:dt(G),stretchX:G.metadata?Ct(G.metadata.stretch_x_areas):void 0,stretchY:G.metadata?Ct(G.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:G};j[G.name]=Y}E(null,j)}))}_validateLayer(a){const h=this.getOwnSource(a.source);if(!h)return;const _=a.sourceLayer;_&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.z(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,h)=>{const _=this.fragments[h];return _&&_.style&&(a.data=_.style.serialize()),a})}_serializeSources(){const a={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();a[_.id]||(a[_.id]=_.serialize())}return a}_serializeLayers(a){const h=[];for(const _ of a){const E=this._layers[_];E&&E.type!=="custom"&&h.push(E.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(a){return a?this.order:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const h=this.getOwnLayer(a);if(h)return h;this.fire(new s.z(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const h=this.getOwnSource(a);if(h)return h;this.fire(new s.z(new Error(`The source '${a}' does not exist in the map's style.`)))}precompilePrograms(a,h){const _=this.map.painter;if(_)for(let E=a.minzoom||0;E<(a.maxzoom||25.5);E++){const C=a.getProgramIds();if(C)for(const M of C){const j=a.getDefaultProgramParams(M,h.zoom,this._styleColorTheme.lut);j&&(_.style=this,this.fog&&(_._fogVisible=!0,j.overrideFog=!0,_.getOrCreateProgram(M,j)),_._fogVisible=!1,j.overrideFog=!1,_.getOrCreateProgram(M,j),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(j.overrideRtt=!0,_.getOrCreateProgram(M,j)))}}}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const h=this.calculateLightsBrightness();a.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const _=this._changes.isDirty();let E=!1;if(this._changes.isDirty()){const j=this._changes.getLayerUpdatesByScope();for(const H in j){const{updatedIds:G,removedIds:Y}=j[H];(G||Y)&&(this._updateWorkerLayers(H,G,Y),E=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this.snow&&this.snow.updateTransitions(a),this.rain&&this.rain.updateTransitions(a),this._changes.reset()}const C={};for(const j in this._mergedSourceCaches){const H=this._mergedSourceCaches[j];C[j]=H.used,H.used=!1,H.tileCoverLift=0}for(const j of this._mergedOrder){const H=this._mergedLayers[j];if(H.recalculate(a,this._availableImages),!H.isHidden(a.zoom)){const G=this.getLayerSourceCache(H);G&&(G.used=!0,G.tileCoverLift=Math.max(G.tileCoverLift,H.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(H,a)}):this.precompilePrograms(H,a))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&E&&this.mergeLayers();const M=this.imageManager.getPendingImageProviders();for(const j of M)j.sourceCache.used=!0;for(const j in C){const H=this._mergedSourceCaches[j];C[j]!==H.used&&H.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:H.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.snow&&this.snow.recalculate(a),this.rain&&this.rain.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const a=this.imageManager.getPendingImageProviders();for(const h of a){const _=h.resolvePendingRequests();this.addImages(_,h.scope)}}_updateTilesForChangedImages(){const a={};for(const h in this._mergedSourceCaches){const _=this._mergedSourceCaches[h].getSource().scope;a[_]=a[_]||this._changes.getUpdatedImages(_),a[_].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a[_])}for(const h in a)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(a,h,_){const E=this.getFragmentStyle(a);E&&this.dispatcher.broadcast("updateLayers",{layers:h?E._serializeLayers(h):[],scope:a,removedIds:_||[],options:E.options})}setState(a,h){if(this._checkLoaded(),$t(this,Zr(a)))return!1;(a=s.cq(a)).layers=ba(a.layers);const _=function(M,j){if(!M)return[{command:Or.setStyle,args:[j]}];let H=[];try{if(!s.bn(M.version,j.version))return[{command:Or.setStyle,args:[j]}];if(s.bn(M.center,j.center)||H.push({command:Or.setCenter,args:[j.center]}),s.bn(M.zoom,j.zoom)||H.push({command:Or.setZoom,args:[j.zoom]}),s.bn(M.bearing,j.bearing)||H.push({command:Or.setBearing,args:[j.bearing]}),s.bn(M.pitch,j.pitch)||H.push({command:Or.setPitch,args:[j.pitch]}),s.bn(M.sprite,j.sprite)||H.push({command:Or.setSprite,args:[j.sprite]}),s.bn(M.glyphs,j.glyphs)||H.push({command:Or.setGlyphs,args:[j.glyphs]}),s.bn(M.imports,j.imports)||function(he=[],we=[],xe){we=we||[];const Ee=(he=he||[]).map(Ur),Ce=we.map(Ur),je=he.reduce(oo,{}),$e=we.reduce(oo,{}),We=Ee.slice();let Ze,Ye,Xe,Ke;for(Ze=0,Ye=0;Ze<Ee.length;Ze++)Xe=Ee[Ze],$e.hasOwnProperty(Xe)?Ye++:(xe.push({command:Or.removeImport,args:[Xe]}),We.splice(We.indexOf(Xe,Ye),1));for(Ze=0,Ye=0;Ze<Ce.length;Ze++)Xe=Ce[Ce.length-1-Ze],We[We.length-1-Ze]!==Xe&&(je.hasOwnProperty(Xe)?(xe.push({command:Or.removeImport,args:[Xe]}),We.splice(We.lastIndexOf(Xe,We.length-Ye),1)):Ye++,Ke=We[We.length-Ze],xe.push({command:Or.addImport,args:[$e[Xe],Ke]}),We.splice(We.length-Ze,0,Xe));for(const tt of we){const at=je[tt.id];at&&!s.bn(at,tt)&&xe.push({command:Or.updateImport,args:[tt.id,tt]})}}(M.imports,j.imports,H),s.bn(M.transition,j.transition)||H.push({command:Or.setTransition,args:[j.transition]}),s.bn(M.light,j.light)||H.push({command:Or.setLight,args:[j.light]}),s.bn(M.fog,j.fog)||H.push({command:Or.setFog,args:[j.fog]}),s.bn(M.snow,j.snow)||H.push({command:Or.setSnow,args:[j.snow]}),s.bn(M.rain,j.rain)||H.push({command:Or.setRain,args:[j.rain]}),s.bn(M.projection,j.projection)||H.push({command:Or.setProjection,args:[j.projection]}),s.bn(M.lights,j.lights)||H.push({command:Or.setLights,args:[j.lights]}),s.bn(M.camera,j.camera)||H.push({command:Or.setCamera,args:[j.camera]}),s.bn(M.iconsets,j.iconsets)||function(he,we,xe){let Ee;for(Ee in we=we||{},he=he||{})he.hasOwnProperty(Ee)&&(we.hasOwnProperty(Ee)||xe.push({command:Or.removeIconset,args:[Ee]}));for(Ee in we){if(!we.hasOwnProperty(Ee))continue;const Ce=we[Ee];he.hasOwnProperty(Ee)?s.bn(he[Ee],Ce)||(xe.push({command:Or.removeIconset,args:[Ee]}),xe.push({command:Or.addIconset,args:[Ee,Ce]})):xe.push({command:Or.addIconset,args:[Ee,Ce]})}}(M.iconsets,j.iconsets,H),!s.bn(M["color-theme"],j["color-theme"]))return[{command:Or.setStyle,args:[j]}];const G={},Y=[];(function(he,we,xe,Ee){let Ce;for(Ce in we=we||{},he=he||{})he.hasOwnProperty(Ce)&&(we.hasOwnProperty(Ce)||$h(Ce,xe,Ee));for(Ce in we){if(!we.hasOwnProperty(Ce))continue;const je=we[Ce];he.hasOwnProperty(Ce)?s.bn(he[Ce],je)||(he[Ce].type==="geojson"&&je.type==="geojson"&&vn(he,we,Ce)?xe.push({command:Or.setGeoJSONSourceData,args:[Ce,je.data]}):Vr(Ce,we,xe,Ee)):Ir(Ce,we,xe)}})(M.sources,j.sources,Y,G);const ne=[];M.layers&&M.layers.forEach(he=>{he.source&&G[he.source]?H.push({command:Or.removeLayer,args:[he.id]}):ne.push(he)});let ee=M.terrain;ee&&G[ee.source]&&(H.push({command:Or.setTerrain,args:[void 0]}),ee=void 0),H=H.concat(Y),s.bn(ee,j.terrain)||H.push({command:Or.setTerrain,args:[j.terrain]}),function(he,we,xe){we=we||[];const Ee=(he=he||[]).map(Ur),Ce=we.map(Ur),je=he.reduce(oo,{}),$e=we.reduce(oo,{}),We=Ee.slice(),Ze=Object.create(null);let Ye,Xe,Ke,tt,at,At,xt;for(Ye=0,Xe=0;Ye<Ee.length;Ye++)Ke=Ee[Ye],$e.hasOwnProperty(Ke)?Xe++:(xe.push({command:Or.removeLayer,args:[Ke]}),We.splice(We.indexOf(Ke,Xe),1));for(Ye=0,Xe=0;Ye<Ce.length;Ye++)Ke=Ce[Ce.length-1-Ye],We[We.length-1-Ye]!==Ke&&(je.hasOwnProperty(Ke)?(xe.push({command:Or.removeLayer,args:[Ke]}),We.splice(We.lastIndexOf(Ke,We.length-Xe),1)):Xe++,At=We[We.length-Ye],xe.push({command:Or.addLayer,args:[$e[Ke],At]}),We.splice(We.length-Ye,0,Ke),Ze[Ke]=!0);for(Ye=0;Ye<Ce.length;Ye++)if(Ke=Ce[Ye],tt=je[Ke],at=$e[Ke],!Ze[Ke]&&!s.bn(tt,at))if(s.bn(tt.source,at.source)&&s.bn(tt["source-layer"],at["source-layer"])&&s.bn(tt.type,at.type)){for(xt in ui(tt.layout,at.layout,xe,Ke,null,Or.setLayoutProperty),ui(tt.paint,at.paint,xe,Ke,null,Or.setPaintProperty),s.bn(tt.slot,at.slot)||xe.push({command:Or.setSlot,args:[Ke,at.slot]}),s.bn(tt.filter,at.filter)||xe.push({command:Or.setFilter,args:[Ke,at.filter]}),s.bn(tt.minzoom,at.minzoom)&&s.bn(tt.maxzoom,at.maxzoom)||xe.push({command:Or.setLayerZoomRange,args:[Ke,at.minzoom,at.maxzoom]}),tt)tt.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&xt!=="slot"&&(xt.indexOf("paint.")===0?ui(tt[xt],at[xt],xe,Ke,xt.slice(6),Or.setPaintProperty):s.bn(tt[xt],at[xt])||xe.push({command:Or.setLayerProperty,args:[Ke,xt,at[xt]]}));for(xt in at)at.hasOwnProperty(xt)&&!tt.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&xt!=="slot"&&(xt.indexOf("paint.")===0?ui(tt[xt],at[xt],xe,Ke,xt.slice(6),Or.setPaintProperty):s.bn(tt[xt],at[xt])||xe.push({command:Or.setLayerProperty,args:[Ke,xt,at[xt]]}))}else xe.push({command:Or.removeLayer,args:[Ke]}),At=We[We.lastIndexOf(Ke)+1],xe.push({command:Or.addLayer,args:[at,At]})}(ne,j.layers,H)}catch(G){console.warn("Unable to compute style diff:",G),H=[{command:Or.setStyle,args:[j]}]}return H}(this.serialize(),a).filter(M=>!(M.command in Vn));if(_.length===0)return!1;const E=_.filter(M=>!(M.command in tn));if(E.length>0)throw new Error(`Unimplemented: ${E.map(M=>M.command).join(", ")}.`);const C=[];return _.forEach(M=>{C.push(this[M.command].apply(this,M.args))}),h&&Promise.all(C).then(h),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(a){const h=this.getFragmentStyle(a);h&&(h._availableImages=h.imageManager.listImages(a),h.dispatcher.broadcast("setImages",{scope:a,images:h._availableImages}))}addImages(a,h){for(const[_,E]of a.entries()){if(this.getImage(_,h))return this.fire(new s.z(new Error(`An image with the name "${_.name}" already exists.`)));this.imageManager.addImage(_,h,E),this._changes.updateImage(_,h)}return this._updateWorkerImages(h),this.fire(new s.A("data",{dataType:"style"})),this}addImage(a,h,_){return this.getImage(a,h)?this.fire(new s.z(new Error(`An image with the name "${a.name}" already exists.`))):(this.imageManager.addImage(a,h,_),this._changes.updateImage(a,h),this._updateWorkerImages(h),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(a,h,_,E=!1){this.imageManager.updateImage(a,h,_),E&&(this._changes.updateImage(a,h),this._updateWorkerImages(h),this.fire(new s.A("data",{dataType:"style"})))}getImage(a,h){return this.imageManager.getImage(a,h)}removeImage(a,h){return this.getImage(a,h)?(this.imageManager.removeImage(a,h),this._changes.updateImage(a,h),this._updateWorkerImages(h),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(a,h,_={}){return this._checkLoaded(),this._validate(rt,`models.${a}`,h,null,_)||(this.modelManager.addModel(a,h,this.scope),this._changes.setDirty()),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,h,_={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(ra,`sources.${a}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const E=$s(a,h,this.dispatcher,this);E.scope=this.scope,E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(E.id),source:E.serialize(),sourceId:E.id}));const C=M=>{const j=(M?"symbol:":"other:")+E.id,H=s.C(j,this.scope),G=this._sourceCaches[j]=new Za(H,E,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[E.id]=G,G.onAdd(this.map)};C(!1),h.type!=="vector"&&h.type!=="geojson"||C(!0),E.onAdd&&E.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const h=this.getOwnSource(a);if(!h)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===a)return this.fire(new s.z(new Error(`Source "${a}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new s.z(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const E=Object.entries(this.stylesheet.iconsets).find(([C,M])=>M.type==="source"&&M.source===a);if(E)return this.fire(new s.z(new Error(`Source "${a}" cannot be removed while iconset "${E[0]}" is using it.`)))}const _=this.getOwnSourceCaches(a);for(const E of _){const C=s.cr(E.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(E.id),E.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getOwnSource(a).setData(h),this._changes.setDirty()}getOwnSource(a){const h=this.getOwnSourceCache(a);return h&&h.getSource()}getOwnSources(){const a=[];for(const h in this._otherSourceCaches){const _=this.getOwnSourceCache(h);_&&a.push(_.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const h in a){const _=a[h]._tiles;for(const E in _){const C=_[E];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const E of a){if(this._validate(za,"lights",E))return;switch(E.type){case"ambient":if(this.ambientLight){const C=this.ambientLight;C.set(E),C.updateTransitions(h)}else this.ambientLight=new an(E,er||(er=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const C=this.directionalLight;C.set(E),C.updateTransitions(h)}else this.directionalLight=new an(E,li||(li=new s.a7({direction:new s.am(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=new s.aa(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,h=this.ambientLight;if(!a||!h)return;const _=ee=>.2126*(ee[0]<=.03928?ee[0]/12.92:Math.pow((ee[0]+.055)/1.055,2.4))+.7152*(ee[1]<=.03928?ee[1]/12.92:Math.pow((ee[1]+.055)/1.055,2.4))+.0722*(ee[2]<=.03928?ee[2]/12.92:Math.pow((ee[2]+.055)/1.055,2.4)),E=a.properties.get("color").toRenderColor(null).toArray01(),C=a.properties.get("intensity"),M=a.properties.get("direction"),j=1-s.cc(M.x,M.y,M.z)[2]/90,H=_(E)*C*j,G=h.properties.get("color").toRenderColor(null).toArray01(),Y=h.properties.get("intensity"),ne=_(G)*Y;return Number(((H+ne)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(!a)return this;if(s.cs(a)){const h=s.ct(a),_=this.fragments.find(({id:C})=>C===h);if(!_)throw new Error(`Style import '${a}' not found`);const E=s.cr(a);return _.style.getFragmentStyle(E)}{const h=this.fragments.find(({id:_})=>_===a);return h?h.style:void 0}}setFeaturesetSelectors(a){if(!a)return;const h={},_=(E,C="")=>`${E}::${C}`;this._featuresetSelectors={};for(const E in a){const C=this._featuresetSelectors[E]=[];for(const M of a[E].selectors){if(M.featureNamespace){const H=this.getOwnLayer(M.layer);if(!H){s.w(`Layer is undefined for selector: ${M.layer}`);continue}const G=_(H.source,H.sourceLayer);if(G in h&&h[G]!==M.featureNamespace){s.w(`"featureNamespace ${M.featureNamespace} of featureset ${E}'s selector is not associated to the same source, skip this selector`);continue}h[G]=M.featureNamespace}let j;if(M.properties)for(const H in M.properties){const G=s.X(M.properties[H]);G.result==="success"&&(j=j||{},j[H]=G.value)}C.push({layerId:M.layer,namespace:M.featureNamespace,properties:j,uniqueFeatureID:M._uniqueFeatureID})}}}getFeaturesetDescriptors(a){const h=this.getFragmentStyle(a);if(!h||!h.stylesheet.featuresets)return[];const _=[];for(const E in h.stylesheet.featuresets)_.push({featuresetId:E,importId:h.scope?h.scope:void 0});return _}getFeaturesetLayers(a,h){const _=this.getFragmentStyle(h),E=_.stylesheet.featuresets;if(!E||!E[a])return this.fire(new s.z(new Error(`The featureset '${a}' does not exist in the map's style and cannot be queried.`))),[];const C=[];for(const M of E[a].selectors){const j=_.getOwnLayer(M.layer);j&&C.push(j)}return C}getConfigProperty(a,h){const _=this.getFragmentStyle(a);if(!_)return null;const E=s.C(h,_.scope),C=_.options.get(E),M=C?C.value||C.default:null;return M?M.serialize():null}setConfigProperty(a,h,_){const E=this.getFragmentStyle(a);if(!E)return;const C=E.stylesheet.indoor?Fe(E.stylesheet.schema):E.stylesheet.schema;if(!C||!C[h])return;const M=s.X(_);if(M.result!=="success")return void $t(this,M.value);const j=M.value.expression,H=s.C(h,E.scope),G=E.options.get(H);if(!G)return;let Y;const{minValue:ne,maxValue:ee,stepValue:he,type:we,values:xe}=C[h],Ee=s.X(C[h].default);Ee.result==="success"&&(Y=Ee.value.expression),Y?(this.options.set(H,Object.assign({},G,{value:j,default:Y,minValue:ne,maxValue:ee,stepValue:he,type:we,values:xe})),this.updateConfigDependencies(h)):this.fire(new s.z(new Error(`No schema defined for the config option "${h}" in the "${a}" fragment.`)))}getConfig(a){const h=this.getFragmentStyle(a);if(!h)return null;const _=h.stylesheet.schema;if(!_)return null;const E={};for(const C in _){const M=s.C(C,h.scope),j=h.options.get(M),H=j?j.value||j.default:null;E[C]=H?H.serialize():null}return E}setConfig(a,h){const _=this.getFragmentStyle(a);_&&(_.updateConfig(h,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const h=this.getFragmentStyle(a);return h?h.stylesheet.schema:null}setSchema(a,h){const _=this.getFragmentStyle(a);_&&(_.stylesheet.schema=h,_.updateConfig(_._config,h),this.updateConfigDependencies())}updateConfig(a,h){if(this._config=a,a||h)if(h)for(const _ in h){let E,C;const M=s.X(h[_].default);if(M.result==="success"&&(E=M.value.expression),a&&a[_]!==void 0){const ee=s.X(a[_]);ee.result==="success"&&(C=ee.value.expression)}const{minValue:j,maxValue:H,stepValue:G,type:Y,values:ne}=h[_];if(E){const ee=s.C(_,this.scope);this.options.set(ee,{default:E,value:C,minValue:j,maxValue:H,stepValue:G,type:Y,values:ne})}else this.fire(new s.z(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(a){for(const h of this._configDependentLayers){const _=this.getLayer(h);if(_){if(a&&!_.configDependencies.has(a))continue;_.possiblyEvaluateVisibility(),this._updateLayer(_)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const _=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(_){const E=h._evaluateColorThemeData(_);(!h._styleColorTheme.lut&&E!==""||h._styleColorTheme.lut&&E!==h._styleColorTheme.lut.data)&&h.setColorTheme(_)}}),this._changes.setDirty()}addLayer(a,h,_={}){this._checkLoaded();const E=a.id;if(this._layers[E])return void this.fire(new s.z(new Error(`Layer with id "${E}" already exists on this map`)));let C;if(a.type==="custom"){if($t(this,s.cu(a)))return;C=s.cv(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(E,a.source),a=s.cq(a),a=s.l(a,{source:E})),this._validate(Te,`layers.${E}`,a,{arrayIndex:-1},_))return;C=s.cv(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:E}})}C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid);let M=this._order.length;if(h){const Y=this._order.indexOf(h);if(Y===-1)return void this.fire(new s.z(new Error(`Layer with id "${h}" does not exist on this map.`)));C.slot===this._layers[h].slot?M=Y:s.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,E),this._layerOrderChanged=!0,this._layers[E]=C;const j=this.getOwnLayerSourceCache(C),H=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&C.canCastShadows()&&H&&(j.castsShadows=!0);const G=this._changes.getRemovedLayer(C);if(G&&C.source&&j&&C.type!=="custom"){this._changes.discardLayerRemoval(C);const Y=s.C(C.source,C.scope);G.type!==C.type?this._changes.updateSourceCache(Y,"clear"):(this._changes.updateSourceCache(Y,"reload"),j.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(a,h){this._checkLoaded();const _=this._checkLayer(a);if(!_||a===h)return;const E=this._order.indexOf(a);this._order.splice(E,1);let C=this._order.length;if(h){const M=this._order.indexOf(h);if(M===-1)return void this.fire(new s.z(new Error(`Layer with id "${h}" does not exist on this map.`)));_.slot===this._layers[h].slot?C=M:s.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();const h=this._checkLayer(a);if(!h)return;h.setEventedParent(null);const _=this._order.indexOf(a);this._order.splice(_,1),delete this._layers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const E=this.getOwnLayerSourceCache(h);if(E&&E.castsShadows){let C=!1;for(const M in this._layers)if(this._layers[M].source===h.source&&this._layers[M].canCastShadows()){C=!0;break}E.castsShadows=C}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,_){this._checkLoaded();const E=this._checkLayer(a);E&&(E.minzoom===h&&E.maxzoom===_||(h!=null&&(E.minzoom=h),_!=null&&(E.maxzoom=_),this._updateLayer(E)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,h){this._checkLoaded();const _=this._checkLayer(a);_&&_.slot!==h&&(_.slot=h,this._updateLayer(_))}setFilter(a,h,_={}){this._checkLoaded();const E=this._checkLayer(a);if(E&&!s.bn(E.filter,h))return h==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(Me,`layers.${E.id}.filter`,h,{layerType:E.type},_)||(E.filter=s.cq(h),this._updateLayer(E)))}getFilter(a){const h=this._checkLayer(a);if(h)return s.cq(h.filter)}setLayoutProperty(a,h,_,E={}){this._checkLoaded();const C=this._checkLayer(a);if(C&&!s.bn(C.getLayoutProperty(h),_)){if(_!=null&&(!E||E.validate!==!1)&&$t(C,nt.call(Zr,{key:`layers.${a}.layout.${h}`,layerType:C.type,objectKey:h,value:_,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(h,_),C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),this._updateLayer(C)}}getLayoutProperty(a,h){const _=this._checkLayer(a);if(_)return _.getLayoutProperty(h)}setPaintProperty(a,h,_,E={}){this._checkLoaded();const C=this._checkLayer(a);if(!C||s.bn(C.getPaintProperty(h),_)||_!=null&&(!E||E.validate!==!1)&&$t(C,qe.call(Zr,{key:`layers.${a}.paint.${h}`,layerType:C.type,objectKey:h,value:_,styleSpec:s.a5})))return;const M=C.setPaintProperty(h,_);C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),M&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(a,h){const _=this._checkLayer(a);if(_)return _.getPaintProperty(h)}setFeatureState(a,h){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:H,importId:G}=a.target,Y=this.getFragmentStyle(G),ne=Y.getFeaturesetLayers(H);for(const{source:ee,sourceLayer:he}of ne)Y.setFeatureState({id:a.id,source:ee,sourceLayer:he},h)}else if("layerId"in a.target){const{layerId:H}=a.target,G=this.getLayer(H);this.setFeatureState({id:a.id,source:G.source,sourceLayer:G.sourceLayer},h)}return}const _=a.source,E=a.sourceLayer,C=this._checkSource(_);if(!C)return;const M=C.type;if(M==="geojson"&&E)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!E)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const j=this.getOwnSourceCaches(_);for(const H of j)H.setFeatureState(E,a.id,h)}removeFeatureState(a,h){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:H,importId:G}=a.target,Y=this.getFragmentStyle(G),ne=Y.getFeaturesetLayers(H);for(const{source:ee,sourceLayer:he}of ne)Y.removeFeatureState({id:a.id,source:ee,sourceLayer:he},h)}else if("layerId"in a.target){const{layerId:H}=a.target,G=this.getLayer(H);this.removeFeatureState({id:a.id,source:G.source,sourceLayer:G.sourceLayer},h)}return}const _=a.source,E=this._checkSource(_);if(!E)return;const C=E.type,M=C==="vector"?a.sourceLayer:void 0;if(C==="vector"&&!M)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const j=this.getOwnSourceCaches(_);for(const H of j)H.removeFeatureState(M,a.id,h)}getFeatureState(a){if(this._checkLoaded(),"target"in a){let C;if("featuresetId"in a.target){const{featuresetId:M,importId:j}=a.target,H=this.getFragmentStyle(j),G=H.getFeaturesetLayers(M);for(const{source:Y,sourceLayer:ne}of G){const ee=H.getFeatureState({id:a.id,source:Y,sourceLayer:ne});if(ee&&!C)C=ee;else if(!s.bn(C,ee))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in a.target){const{layerId:M}=a.target,j=this.getLayer(M);C=this.getFeatureState({id:a.id,source:j.source,sourceLayer:j.sourceLayer})}return C}const h=a.source,_=a.sourceLayer,E=this._checkSource(h);if(E){if(E.type!=="vector"||_)return a.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(_,a.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=s.l({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),h=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return s.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateFilteredLayers(a){for(const h of Object.values(this._mergedLayers))a(h)&&this._updateLayer(h)}_updateLayer(a){this._changes.updateLayer(a);const h=this.getLayerSourceCache(a),_=s.C(a.source,a.scope),E=this._changes.getUpdatedSourceCaches();a.source&&!E[_]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),h.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=j=>this._mergedLayers[j].is3D(!!this.terrain),_=this.order,E={},C=[];for(let j=_.length-1;j>=0;j--){const H=_[j];if(h(H)){E[H]=j;for(const G of a){const Y=G[H];if(Y)for(const ne of Y)C.push(ne)}}}C.sort((j,H)=>H.intersectionZ-j.intersectionZ);const M=[];for(let j=_.length-1;j>=0;j--){const H=_[j];if(h(H))for(let G=C.length-1;G>=0;G--){const Y=C[G].feature;if(Y.layer&&E[Y.layer.id]<j)break;M.push(Y),C.pop()}else for(const G of a){const Y=G[H];if(Y)for(const ne of Y)M.push(ne.feature)}}return M}queryRenderedFeatures(a,h,_){let E;h&&!Array.isArray(h)&&h.filter&&(this._validate(Me,"queryRenderedFeatures.filter",h.filter,null,h),E=s.a_(h.filter));const C={},M=Y=>{if(zn.has(Y.type))return;const ne=this.getOwnLayerSourceCache(Y),ee=C[ne.id]=C[ne.id]||{sourceCache:ne,layers:{},has3DLayers:!1};Y.is3D(!!this.terrain)&&(ee.has3DLayers=!0),ee.layers[Y.fqid]=ee.layers[Y.fqid]||{styleLayer:Y,targets:[]},ee.layers[Y.fqid].targets.push({filter:E})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const Y of h.layers){const ne=this._layers[Y];if(!ne)return this.fire(new s.z(new Error(`The layer '${Y}' does not exist in the map's style and cannot be queried for features.`))),[];M(ne)}}else for(const Y in this._layers)M(this._layers[Y]);const j=this._queryRenderedFeatures(a,C,_),H=this._flattenAndSortRenderedFeatures(j),G=[];for(const Y of H)s.ct(Y.layer.id)===this.scope&&G.push(Y);return G}queryRenderedFeatureset(a,h,_){let E;h&&!Array.isArray(h)&&h.filter&&(this._validate(Me,"queryRenderedFeatures.filter",h.filter,null,h),E=s.a_(h.filter));const C="mock",M=[];if(h&&h.target)M.push(Object.assign({},h,{targetId:C,filter:E}));else{const Y=this.getFeaturesetDescriptors();for(const ne of Y)M.push({targetId:C,filter:E,target:ne});for(const{style:ne}of this.fragments){const ee=ne.getFeaturesetDescriptors();for(const he of ee)M.push({targetId:C,filter:E,target:he})}}const j=this.queryRenderedTargets(a,M,_),H=[],G=new Set;for(const Y of j)for(const ne of Y.variants[C])Su(ne,Y,G)||H.push(new s.cx(Y,ne));return H}queryRenderedTargets(a,h,_){const E={},C=(j,H,G,Y)=>{const ne=E[H.id]=E[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};if(ne.layers[j.fqid]=ne.layers[j.fqid]||{styleLayer:j,targets:[]},j.is3D(!!this.terrain)&&(ne.has3DLayers=!0),!Y)return G.uniqueFeatureID=!1,void ne.layers[j.fqid].targets.push(G);ne.layers[j.fqid].targets.push(Object.assign({},G,{namespace:Y.namespace,properties:Y.properties,uniqueFeatureID:Y.uniqueFeatureID}))};for(const j of h)if("featuresetId"in j.target){const{featuresetId:H,importId:G}=j.target,Y=this.getFragmentStyle(G);if(!Y||!Y._featuresetSelectors)continue;const ne=Y._featuresetSelectors[H];if(!ne){this.fire(new s.z(new Error(`The featureset '${H}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const ee of ne){const he=Y.getOwnLayer(ee.layerId);he&&!zn.has(he.type)&&C(he,Y.getOwnLayerSourceCache(he),j,ee)}}else if("layerId"in j.target){const{layerId:H}=j.target,G=this.getLayer(H);if(!G||zn.has(G.type))continue;C(G,this.getLayerSourceCache(G),j)}const M=this._queryRenderedFeatures(a,E,_);return this._flattenAndSortRenderedFeatures(M)}_queryRenderedFeatures(a,h,_){const E=[],C=!!this.map._showQueryGeometry,M=Bs.createFromScreenPoints(a,_);for(const j in h){const H=zs(M,h[j],this._availableImages,_,C);Object.keys(H).length&&E.push(H)}if(this.placement)for(const j in h){if(!h[j].sourceCache._onlySymbols)continue;const H=Ml(M.screenGeometry,h[j],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(H).length&&E.push(H)}return E}querySourceFeatures(a,h){const _=h&&h.filter;_&&this._validate(Me,"querySourceFeatures.filter",_,null,h);let E=[];const C=this.getOwnSourceCaches(a);for(const M of C)E=E.concat(Uf(M,h));return E}addSourceType(a,h,_){return Xr.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(Xr.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,h,_={}){this._checkLoaded();const E=this.light.getLight();let C=!1;for(const j in a)if(!s.bn(a[j],E[j])){C=!0;break}if(!C)return;const M=this._getTransitionParameters();this.light.setLight(a,h,_),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,h=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=a;const E=a.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const j="terrain-dem-src";this.addSource(j,_.source),_=s.cq(_),_=s.l(_,{source:j})}const C=s.l({},_),M={};if(this.terrain&&E){C.source=this.terrain.get().source;const j=this.terrain?this.getFragmentStyle(this.terrain.scope):null;j&&(M.style=j.serialize())}if(this._validate(ia,"terrain",C,M))return}if(!this.terrain||this.terrain.scope!==this.scope&&!E||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h),this.fire(new s.A("data",{dataType:"style"}))}else{const C=this.terrain,M=C.get();for(const j of Object.keys(s.a5.terrain))!_.hasOwnProperty(j)&&s.a5.terrain[j].default&&(_[j]=s.a5.terrain[j].default);for(const j in a)if(!s.bn(a[j],M[j])){C.set(a,this.options),this.stylesheet.terrain=a;const H=this._getTransitionParameters({duration:0});C.updateTransitions(H),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new vr(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_createSnow(a){const h=this.snow=new zr(a,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_createRain(a){const h=this.rain=new oi(a,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!s.bn(h.get(),a)){h.set(a,this.options),this.stylesheet.fog=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createFog(a);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(a){if(this._checkLoaded(),!a)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!s.bn(h.get(),a)){h.set(a,this.options),this.stylesheet.snow=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createSnow(a);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(a){if(this._checkLoaded(),!a)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!s.bn(h.get(),a)){h.set(a,this.options),this.stylesheet.rain=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createRain(a);this._markersNeedUpdate=!0}_reloadColorTheme(){const a=()=>{for(const E in this._layers)this._layers[E].lut=this._styleColorTheme.lut;for(const E in this._sourceCaches)this._sourceCaches[E].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void a();const _=this._evaluateColorThemeData(h);this._loadColorTheme(_).then(()=>{this.fire(new s.A("colorthemeset")),a()}).catch(E=>{s.w(`Couldn't set color theme: ${E}`)})}setColorTheme(a){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=a,this._reloadColorTheme()}setImportColorTheme(a,h){const _=this.getFragmentStyle(a);_&&(_._styleColorTheme.colorThemeOverride=h,_._reloadColorTheme())}_getTransitionParameters(a){return{now:s.q.now(),transition:s.l(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],h=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?a.push(_):h.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const _=this.terrain=new Dt(a,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const E=this._getTransitionParameters({duration:0});_.updateTransitions(E)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="symbol"&&this._updateLayer(h)}}_validate(a,h,_,E,C={}){if(C&&C.validate===!1)return!1;const M=s.l({},this.serialize());return $t(this,a.call(Zr,s.l({key:h,style:M,value:_,styleSpec:s.a5},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(a){const h=this.getSourceCaches(a);for(const _ of h)_.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){const h=this.getSourceCaches(a);for(const _ of h)_.resume(),_.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(a=>{a.modelManager.reloadModels(a.scope)})}updateSources(a){let h;this.directionalLight&&(h=N(this.directionalLight));for(const _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(a,void 0,void 0,h)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,_,E,C,M,j=!1){let H=!1,G=!1;const Y={},ne={};for(const ee of this._mergedOrder){const he=this._mergedLayers[ee];if(he.type!=="symbol")continue;const we=s.C(he.source,he.scope);let xe=Y[we];if(!xe){const Ce=this.getLayerSourceCache(he);if(!Ce)continue;const je=Ce.getRenderableIds(!0).map($e=>Ce.getTileByID($e));ne[we]=je.slice(),xe=Y[we]=je.sort(($e,We)=>We.tileID.overscaledZ-$e.tileID.overscaledZ||($e.tileID.isLessThan(We.tileID)?-1:1))}const Ee=this.crossTileSymbolIndex.addLayer(he,xe,h.center.lng,h.projection);H=H||Ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),j=j||this._layerOrderChanged||E===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(j||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),h.zoom))&&(this.pauseablePlacement=new ve(h,this._mergedOrder,j,_,E,C,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Y,ne,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),G=!0),H&&this.pauseablePlacement.placement.setStale()),G||H){this._buildingIndex.onNewFrame(h.zoom);for(let ee=0;ee<this._mergedOrder.length;ee++){const he=this._mergedLayers[this._mergedOrder[ee]];if(he.type!=="symbol")continue;const we=this.isLayerClipped(he);this.placement.updateLayerOpacities(he,Y[s.C(he.source,he.scope)],ee,we?M:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,h){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:C})=>C===a.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!h)return _.push(a),this._loadImports([a],!0);const E=_.findIndex(({id:C})=>C===h);return E===-1&&this.fire(new s.z(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,E).concat(a).concat(_.slice(E)),this._loadImports([a],!0,h)}updateImport(a,h){this._checkLoaded();const _=this.stylesheet.imports||[],E=this.getImportIndex(a);return E===-1?this:typeof h=="string"?(this.setImportUrl(a,h),this):(h.url&&h.url!==_[E].url&&this.setImportUrl(a,h.url),s.bn(h.config,_[E].config)||this.setImportConfig(a,h.config,h.data.schema),s.bn(h.data,_[E].data)||this.setImportData(a,h.data),this)}moveImport(a,h){this._checkLoaded();let _=this.stylesheet.imports||[];const E=this.getImportIndex(a);if(E===-1)return this;const C=this.getImportIndex(h);if(C===-1)return this;const M=_[E],j=this.fragments[E];return _=_.filter(({id:H})=>H!==a),this.fragments=this.fragments.filter(({id:H})=>H!==a),this.stylesheet.imports=_.slice(0,C).concat(M).concat(_.slice(C)),this.fragments=this.fragments.slice(0,C).concat(j).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(a,h){this._checkLoaded();const _=this.stylesheet.imports||[],E=this.getImportIndex(a);if(E===-1)return this;_[E].url=h;const C=this.fragments[E];return C.style=this._createFragmentStyle(_[E]),C.style.on("style.import.load",()=>this.mergeAll()),C.style.loadURL(h),this}setImportData(a,h){this._checkLoaded();const _=this.getImportIndex(a),E=this.stylesheet.imports||[];return _===-1?this:h?(this.fragments[_].style.setState(h),this._reloadImports(),this):(delete E[_].data,this.setImportUrl(a,E[_].url))}setImportConfig(a,h,_){this._checkLoaded();const E=this.getImportIndex(a),C=this.stylesheet.imports||[];if(E===-1)return this;h?C[E].config=h:delete C[E].config;const M=this.fragments[E];_&&M.style.stylesheet&&(M.style.stylesheet.schema=_);const j=M.style.stylesheet&&M.style.stylesheet.schema;return M.config=h,M.style.updateConfig(h,j),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const h=this.stylesheet.imports||[],_=this.getImportIndex(a);_!==-1&&(h.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(a){const h=(this.stylesheet.imports||[]).findIndex(_=>_.id===a);return h===-1&&this.fire(new s.z(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),h}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const h in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[h];_&&a.push(_.getSource())}return a}getSource(a,h){const _=this.getSourceCache(a,h);return _&&_.getSource()}getLayerSource(a){const h=this.getLayerSourceCache(a);return h&&h.getSource()}getSourceCache(a,h){const _=s.C(a,h);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(a){const h=s.C(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[a]&&h.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&h.push(this._mergedSymbolSourceCaches[a]),h}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const h in a){const _=a[h];_==="reload"?this.reloadSource(h):_==="clear"&&this.clearSource(h)}}updateLayers(a){const h=this._changes.getUpdatedPaintProperties();for(const _ of h){const E=this.getLayer(_);E&&E.updateTransitions(a)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(a){this.stylesheet.glyphs=a,this.glyphManager.setURL(a,this.scope)}getImages(a,h,_){this.imageManager.getImages(h.images,h.scope,_),this._updateTilesForChangedImages();const E=M=>{if(M){const j=h.images.map(H=>s.I.toString(H));M.setDependencies(h.tileID.key,h.type,j)}},C=s.C(h.source,h.scope);E(this._mergedOtherSourceCaches[C]),E(this._mergedSymbolSourceCaches[C])}rasterizeImages(a,h,_){this.imageManager.rasterizeImages(h,_)}getGlyphs(a,h,_){this.glyphManager.getGlyphs(h.stacks,h.scope,_)}getResource(a,h,_){return s.cz(h,_)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this.getOwnSourceCaches(a);return h.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${a}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,h){if(!this._clipLayerPresent&&a.type!=="fill-extrusion")return!1;const _=a.type==="fill-extrusion"&&a.sourceLayer==="building";if(a.is3D(!!this.terrain)){if(_||h&&h.type==="batched-model"||a.type==="model")return!0}else if(a.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xr.getSourceType=function(y){return Eu[y]},Xr.setSourceType=function(y,a){Eu[y]=a},Xr.registerForPluginStateChange=s.ci;var Sa=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qa=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Zo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,_s="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",to=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ta=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Iu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ol=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Gh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,jd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Um=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const nh=[];Au(Sa,nh),Au(Zo,nh),Au(Qa,nh);const Vd={"_prelude_fog.vertex.glsl":Ta,"_prelude_terrain.vertex.glsl":to,"_prelude_shadow.vertex.glsl":jd,"_prelude_fog.fragment.glsl":Iu,"_prelude_shadow.fragment.glsl":Um,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ol,"_prelude_raster_particle.glsl":Gh},qf={};Jr("",to),Jr(Iu,Ta),Jr(Um,jd),Jr(Ol,""),Jr(Gh,"");const Ux=Jr(Qa,Zo),N_=Sa;var Hm={background:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Jr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Jr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Jr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Jr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Jr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Jr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Jr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Jr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Jr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Jr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Jr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Jr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Jr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Jr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_s),skyboxGradient:Jr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,_s),skyboxCapture:Jr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Jr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Jr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Jr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Jr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Jr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Jr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Au(y,a){const h=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of h)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const E=_.split(" ");for(const C of E)a.includes(C)||a.push(C)}}function Jr(y,a){const h=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let E=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);E&&(E=E.map(G=>{const Y=G.split(" ");return Y[Y.length-1]}),E=[...new Set(E)]);const C={},M=[],j=[];if(y=y.replace(h,(G,Y)=>(j.push(Y),"")),(a=a.replace(h,(G,Y)=>(M.push(Y),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let H=[...nh];Au(y,H),Au(a,H);for(const G of[...M,...j])Vd[G]||console.error(`Undefined include: ${G}`),qf[G]||(qf[G]=[],Au(Vd[G],qf[G])),H=[...H,...qf[G]];return{fragmentSource:y=y.replace(_,(G,Y,ne,ee,he)=>(C[he]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_${he}
in ${ne} ${ee} ${he};
#else
uniform ${ne} ${ee} u_${he};
#endif
`:Y==="initialize"?`
#ifdef HAS_UNIFORM_u_${he}
    ${ne} ${ee} ${he} = u_${he};
#endif
`:Y==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    in ${ne} ${ee} ${he};
#endif
`:Y==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(_,(G,Y,ne,ee,he)=>{const we=ee==="float"?"vec2":ee,xe=he.match(/color/)?"color":we;return Y==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${he}
in ${ne} ${ee} a_${he};
#endif
`:C[he]?Y==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
in ${ne} ${we} a_${he};
out ${ne} ${ee} ${he};
#else
uniform ${ne} ${ee} u_${he};
#endif
`:Y==="initialize"?xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = a_${he};
#else
    ${ne} ${ee} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${he} = unpack_mix_${xe}(a_${he}, u_${he}_t);
#else
    ${ne} ${ee} ${he} = u_${he};
#endif
`:Y==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    in ${ne} ${ee} a_${he};
    out ${ne} ${ee} ${he};
#endif
`:Y==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    ${he} = a_${he};
#endif
`:void 0:Y==="define"?`
#ifndef HAS_UNIFORM_u_${he}
uniform lowp float u_${he}_t;
in ${ne} ${we} a_${he};
#else
uniform ${ne} ${ee} u_${he};
#endif
`:Y==="define-instanced"?xe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${he}0;
in vec4 a_${he}1;
in vec4 a_${he}2;
in vec4 a_${he}3;
#else
uniform ${ne} ${ee} u_${he};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${ne} ${we} a_${he};
#else
uniform ${ne} ${ee} u_${he};
#endif
`:Y==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${he}
    ${ne} ${ee} ${he} = a_${he};
#endif
`:xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${he}
    ${ne} ${ee} ${he} = a_${he};
#else
    ${ne} ${ee} ${he} = u_${he};
#endif
`:`
#ifndef HAS_UNIFORM_u_${he}
    ${ne} ${ee} ${he} = unpack_mix_${xe}(a_${he}, u_${he}_t);
#else
    ${ne} ${ee} ${he} = u_${he};
#endif
`}),staticAttributes:E,usedDefines:H,vertexIncludes:M,fragmentIncludes:j}}class V2{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,_,E,C,M,j,H){this.context=a;let G=this.boundPaintVertexBuffers.length!==E.length;for(let ne=0;!G&&ne<E.length;ne++)this.boundPaintVertexBuffers[ne]!==E[ne]&&(G=!0);let Y=this.boundDynamicVertexBuffers.length!==j.length;for(let ne=0;!Y&&ne<j.length;ne++)this.boundDynamicVertexBuffers[ne]!==j[ne]&&(Y=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||G||Y||this.boundIndexBuffer!==C||this.boundVertexOffset!==M)this.freshBind(h,_,E,C,M,j,H);else{a.bindVertexArrayOES.set(this.vao);for(const ne of j)ne&&(ne.bind(),H&&ne.instanceCount&&ne.setVertexAttribDivisor(a.gl,h,H));C&&C.dynamicDraw&&C.bind()}}freshBind(a,h,_,E,C,M,j){const H=a.numAttributes,G=this.context,Y=G.gl;this.vao&&this.destroy(),this.vao=G.gl.createVertexArray(),G.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=E,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=M,h.enableAttributes(Y,a),h.bind(),h.setVertexAttribPointers(Y,a,C);for(const ne of _)ne.enableAttributes(Y,a),ne.bind(),ne.setVertexAttribPointers(Y,a,C);for(const ne of M)ne&&(ne.enableAttributes(Y,a),ne.bind(),ne.setVertexAttribPointers(Y,a,C),j&&ne.instanceCount&&ne.setVertexAttribDivisor(Y,a,j));E&&E.bind(),G.currentNumAttributes=H}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function U2(y,a){const h=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new s.ac(0,_/h).toLngLat().lat,new s.ac(0,(_+1)/h).toLngLat().lat]}function Gf(y,a,h,_,E,C,M){const j=y.context,H=j.gl,G=h.hillshadeFBO;if(!G)return;y.prepareDrawTile();const Y=y.isTileAffectedByFog(a),ne=y.getOrCreateProgram("hillshade",{overrideFog:Y});j.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,G.colorAttachment.get());const ee=((Ee,Ce,je,$e)=>{const We=je.paint.get("hillshade-shadow-color"),Ze=je.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ye=je.paint.get("hillshade-highlight-color"),Xe=je.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ke=je.paint.get("hillshade-accent-color"),tt=je.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",at=je.paint.get("hillshade-emissive-strength");let At=s.ak(je.paint.get("hillshade-illumination-direction"));if(je.paint.get("hillshade-illumination-anchor")==="viewport")At-=Ee.transform.angle;else if(Ee.style&&Ee.style.enable3dLights()&&Ee.style.directionalLight){const Bt=Ee.style.directionalLight.properties.get("direction"),zt=s.cc(Bt.x,Bt.y,Bt.z);At=s.ak(zt[1])}const xt=!Ee.options.moving;return{u_matrix:$e||Ee.transform.calculateProjMatrix(Ce.tileID.toUnwrapped(),xt),u_image:0,u_latrange:U2(0,Ce.tileID),u_light:[je.paint.get("hillshade-exaggeration"),At],u_shadow:We.toRenderColor(Ze?null:je.lut),u_highlight:Ye.toRenderColor(Xe?null:je.lut),u_emissive_strength:at,u_accent:Ke.toRenderColor(tt?null:je.lut)}})(y,h,_,y.terrain?a.projMatrix:null);y.uploadCommonUniforms(j,ne,a.toUnwrapped());const{tileBoundsBuffer:he,tileBoundsIndexBuffer:we,tileBoundsSegments:xe}=y.getTileBoundsBuffers(h);ne.draw(y,H.TRIANGLES,E,C,M,qn.disabled,ee,_.id,he,we,xe)}function Hx(y,a,h){if(!a.needsDEMTextureUpload)return;const _=y.context,E=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(h.stride);const C=h.getPixels();a.demTexture?a.demTexture.update(C,{premultiply:!1}):a.demTexture=new s.T(_,C,E.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function rM(y,a,h){const _=y.context,E=_.gl;if(!a.dem)return;const C=a.dem;if(_.activeTexture.set(E.TEXTURE1),Hx(y,a,C),!a.demTexture)return;a.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const M=C.dim;_.activeTexture.set(E.TEXTURE0);let j=a.hillshadeFBO;if(!j){const ee=new s.T(_,{width:M,height:M,data:null},E.RGBA8);ee.bind(E.LINEAR,E.CLAMP_TO_EDGE),j=a.hillshadeFBO=_.createFramebuffer(M,M,!0,"renderbuffer"),j.colorAttachment.set(ee.texture)}_.bindFramebuffer.set(j.framebuffer),_.viewport.set([0,0,M,M]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:G,tileBoundsSegments:Y}=y.getMercatorTileBoundsBuffers(),ne=[];y.linearFloatFilteringSupported()&&ne.push("TERRAIN_DEM_FLOAT_FORMAT"),y.getOrCreateProgram("hillshadePrepare",{defines:ne}).draw(y,E.TRIANGLES,gn.disabled,Un.disabled,nr.unblended,qn.disabled,((ee,he)=>{const we=he.stride,xe=s.ad.mat4.create();return s.ad.mat4.ortho(xe,0,s.ai,-s.ai,0,0,1),s.ad.mat4.translate(xe,xe,[0,-s.ai,0]),{u_matrix:xe,u_image:1,u_dimension:[we,we],u_zoom:ee.overscaledZ}})(a.tileID,C),h.id,H,G,Y),a.needsHillshadePrepare=!1}class ys{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class iM extends ys{getDefault(){return s.al.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Wx extends ys{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class $x extends ys{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class qx extends ys{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Gx extends ys{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class H2 extends ys{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class W2 extends ys{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class sM extends ys{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Wm extends ys{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class $m extends ys{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class $2 extends ys{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class lc extends ys{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Yx extends ys{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class O_ extends ys{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class L_ extends ys{getDefault(){return s.al.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Xx extends ys{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class Kx extends ys{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class Zx extends ys{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class F_ extends ys{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Qx=class extends ys{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class Jx extends ys{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class B_ extends ys{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class q2 extends ys{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class G2 extends ys{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Yf extends ys{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class oM extends ys{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class aM extends ys{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class lM extends ys{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class cM extends ys{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class uM extends ys{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class hM extends ys{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class qm extends ys{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class e1 extends qm{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class t1 extends qm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Xf extends qm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Y2 extends t1{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const X2=(y,a,h)=>({u_matrix:y,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:h}),n1=(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:E,u_merc_center:C,u_image0:0,u_frustum_tl:M,u_frustum_tr:j,u_frustum_br:H,u_frustum_bl:G,u_globe_pos:Y,u_globe_radius:ne,u_viewport:ee,u_grid_matrix:xe?Float32Array.from(xe):new Float32Array(9),u_skirt_height:he,u_far_z_cutoff:we});function z_(y,a){return y!=null&&a!=null&&!(!y.hasData()||!a.hasData())&&y.demTexture!=null&&a.demTexture!=null&&y.tileID.key!==a.tileID.key}const Ac=new class{constructor(){this.operations={}}newMorphing(y,a,h,_,E){if(y in this.operations){const C=this.operations[y];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[y]={startTime:_,phase:0,duration:E,from:a,to:h,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const a=this.operations[y];return{from:a.from,to:a.to,phase:a.phase}}update(y){for(const a in this.operations){const h=this.operations[a];for(h.phase=(y-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,y)){delete this.operations[a];break}}}_nextOp(y,a){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=a,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},r1={0:null,1:"TERRAIN_VERTEX_MORPHING"};function rh(y,a,h){if(a===0)return 0;const _=a<1&&h===514?.25/a:1;return 6*Math.pow(1.5,22-y)*Math.max(a,1)*_}function i1(y,a){const h=1<<y.z;return!a&&(y.x===0||y.x===h-1)||y.y===0||y.y===h-1}const Kf=y=>({u_matrix:y});function j_(y,a,h,_,E){if(E>0){const C=s.q.now(),M=(C-y.timeAdded)/E,j=a?(C-a.timeAdded)/E:-1,H=h.getSource(),G=_.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),Y=!a||Math.abs(a.tileID.overscaledZ-G)>Math.abs(y.tileID.overscaledZ-G),ne=Y&&y.refreshedUponExpiration?1:s.ay(Y?M:1-j,0,1);return y.refreshedUponExpiration&&M>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ne}:{opacity:ne,mix:0}}return{opacity:1,mix:0}}class K2 extends Za{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new s.D(s.cj(),null),E=$s("mock-dem",h,_,a.style);super("mock-dem",E,!1),E.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class s1 extends Za{constructor(a){const h=$s("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new s.D(s.cj(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,_){if(a.freezeTileCoverage)return;this.transform=a;const E=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,M)=>{if(C[M.key]="",!this._tiles[M.key]){const j=new qs(M,this._source.tileSize*M.overscaleFactor(),a.tileZoom);j.state="loaded",this._tiles[M.key]=j}return C},{});for(const C in this._tiles)C in E||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(a){const h=this.proxyCachedFBO[a];if(h!==void 0){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class V_ extends s.aH{constructor(a,h,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Z2 extends s.cK{constructor(a,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,E,C]=function(H){const G=new s.b5,Y=new s.aV,ne=131;G.reserve(17161),Y.reserve(33800);const ee=s.ai/128,he=s.ai+ee/2,we=he+ee;for(let Ee=-ee;Ee<we;Ee+=ee)for(let Ce=-ee;Ce<we;Ce+=ee){const je=Ce<0||Ce>he||Ee<0||Ee>he?24575:0,$e=s.ay(Math.round(Ce),0,s.ai),We=s.ay(Math.round(Ee),0,s.ai);G.emplaceBack($e+je,We)}const xe=(Ee,Ce)=>{const je=Ce*ne+Ee;Y.emplaceBack(je+1,je,je+ne),Y.emplaceBack(je+ne,je+ne+1,je+1)};for(let Ee=1;Ee<129;Ee++)for(let Ce=1;Ce<129;Ce++)xe(Ce,Ee);return[0,129].forEach(Ee=>{for(let Ce=0;Ce<130;Ce++)xe(Ce,Ee),xe(Ee,Ce)}),[G,Y,32768]}(),M=a.context;this.gridBuffer=M.createVertexBuffer(_,s.b7.members),this.gridIndexBuffer=M.createIndexBuffer(E),this.gridSegments=s.b8.simpleSegment(0,0,_.length,E.length),this.gridNoSkirtSegments=s.b8.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new s1(h.map),this.orthoMatrix=s.ad.mat4.create(),s.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ai,0,s.ai,0,1);const j=M.gl;this._overlapStencilMode=new Un({func:j.GEQUAL,mask:255},0,255,j.KEEP,j.KEEP,j.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new K2(h.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,h,_){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const E=a.terrain.properties,C=a.terrain.drapeRenderMode===0,M=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const j=a.terrain&&a.terrain.scope,H=E.get("source"),G=C?this._mockSourceCache:a.getSourceCache(H,j);if(!G)return void s.w(`Couldn't find terrain source "${H}".`);if(this.sourceCache=G,this._attenuationRange=a.terrain.getAttenuationRange(),this._exaggeration=M?this.calculateExaggeration(h):E.get("exaggeration"),!h.projection.requiresDraping&&M&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Y=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ne=this.getScaledDemTileSize();this.sourceCache.update(h,ne,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Y(),this._initializing=!0),Y(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(a){if(this._attenuationRange&&a.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(a.zoom);const h=this._previousCameraAltitude,_=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=_;const E=h!=null?_-h:Number.MAX_VALUE;if(Math.abs(E)<2)return this._exaggeration;const C=a.zoom,M=this._style.terrain;if(!this._previousUpdateTimestamp)return M.getExaggeration(C);let j=C-this._previousZoom;const H=this._previousUpdateTimestamp;let G=C;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(C-G)>.5&&(j=.5*(C-G+j)),j*E<0&&(G+=j)),this._evaluationZoom=G;const Y=M.getExaggeration(G),ne=Y===M.getExaggeration(Math.max(0,G-.1));if(ne&&Math.abs(Y-this._exaggeration)<.01)return Y;let ee=Math.min(.1,.00375*(this._updateTimestamp-H));return(ne||Y<.1||Math.abs(j)<1e-4)&&(ee=Math.min(.2,4*ee)),s.ah(this._exaggeration,Y,ee)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=h.getIds().map(H=>{const G=h.getTileByID(H).tileID;return G.projMatrix=_.calculateProjMatrix(G.toUnwrapped()),G});(function(H,G){const Y=G.transform.pointCoordinate(G.transform.getCameraPoint()),ne=new s.P(Y.x,Y.y);H.sort((ee,he)=>{if(he.overscaledZ-ee.overscaledZ)return he.overscaledZ-ee.overscaledZ;const we=new s.P(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),xe=new s.P(he.canonical.x+(1<<he.canonical.z)*he.wrap,he.canonical.y),Ee=ne.mult(1<<ee.canonical.z);return Ee.x-=.5,Ee.y-=.5,Ee.distSqr(we)-Ee.distSqr(xe)})})(E,this.painter);const C=this.proxyToSource||{};this.proxyToSource={},E.forEach(H=>{this.proxyToSource[H.key]={}}),this.terrainTileForTile={};const M=this._style._mergedSourceCaches;for(const H in M){const G=M[H];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,a[H],C),G.usedForTerrain))continue;const Y=a[H];G.getSource().reparseOverscaled&&this._assignTerrainTiles(Y)}this.proxiedCoords[h.id]=E.map(H=>new V_(H,H.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;const j={};this._visibleDemTiles=[];for(const H of this.proxyCoords){const G=this.terrainTileForTile[H.key];if(!G)continue;const Y=G.tileID.key;Y in j||(this._visibleDemTiles.push(G),j[Y]=Y)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const _ in this.terrainTileForTile){const E=this.terrainTileForTile[_],C=E.dem;!C||E.demTexture&&!E.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),Hx(this.painter,E,C))}}_prepareDemTileUniforms(a,h,_,E){if(!h||h.demTexture==null)return!1;const C=a.tileID.canonical,M=Math.pow(2,h.tileID.canonical.z-C.z),j=E||"";return _[`u_dem_tl${j}`]=[C.x*M%1,C.y*M%1],_[`u_dem_scale${j}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0;const h=this._visibleDemTiles.reduce((_,E)=>{if(!E.dem)return _;const C=E.dem.tree.minimums[0];return C>0&&a++,_+C},0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),E=new s.cL({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(E,{premultiply:!1}):C=this._emptyDEMTexture=new s.T(a,E,h.R32F,{premultiply:!1}),C}setupElevationDraw(a,h,_){const E=this.painter.context,C=E.gl,M={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};M.u_exaggeration=this.exaggeration();let j=null,H=null,G=1;if(_&&_.morphing&&this._useVertexMorphing){const he=_.morphing.srcDemTile,we=_.morphing.dstDemTile;G=_.morphing.phase,he&&we&&(this._prepareDemTileUniforms(a,he,M,"_prev")&&(H=he),this._prepareDemTileUniforms(a,we,M)&&(j=we))}const Y=he=>he&&he.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST;let ne=null;var ee;if(this.enabled?H&&j?(ne=j.demTexture,E.activeTexture.set(C.TEXTURE4),H.demTexture.bind(Y(H),C.CLAMP_TO_EDGE),M.u_dem_lerp=G):(j=this.terrainTileForTile[a.tileID.key],ne=this._prepareDemTileUniforms(a,j,M)?j.demTexture:this.emptyDEMTexture):ne=this.emptyDEMTexture,E.activeTexture.set(C.TEXTURE2),ne&&(M.u_dem_size=(ee=ne).size[0]===1?1:ee.size[0]-2,ne.bind(Y(j),C.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,h,M),_&&_.useMeterToDem&&j){const he=(1<<j.tileID.canonical.z)*s.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=he}if(_&&_.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(E,M),this.painter.transform.projection.name==="globe"){const he=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(E,he)}}globeUniformValues(a,h,_){const E=a.projection;return{u_tile_tl_up:E.upVector(h,0,0),u_tile_tr_up:E.upVector(h,s.ai,0),u_tile_br_up:E.upVector(h,s.ai,s.ai),u_tile_bl_up:E.upVector(h,0,s.ai),u_tile_up_scale:_?s.cM(1):E.upVectorScale(h,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const h=this.painter,_=this.painter.context;a.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(E,C,M,j,H){if(E.transform.projection.name==="globe")(function(G,Y,ne,ee,he){const we=G.context,xe=we.gl;let Ee,Ce;const je=G.transform,$e=s.cD(G,we,je),We=(Bt,zt)=>{if(Ce===zt)return;const Jt=[r1[zt],"PROJECTION_GLOBE_VIEW"];$e&&Jt.push("CUSTOM_ANTIALIASING");const yt=G.isTileAffectedByFog(Bt);Ee=G.getOrCreateProgram("globeRaster",{defines:Jt,overrideFog:yt}),Ce=zt},Ze=G.colorModeForRenderPass(),Ye=new gn(xe.LEQUAL,gn.ReadWrite,G.depthRangeFor3D);Ac.update(he);const Xe=s.cE(je),Ke=[s.av(je.center.lng),s.aC(je.center.lat)],tt=G.globeSharedBuffers,at=[je.width*s.q.devicePixelRatio,je.height*s.q.devicePixelRatio],At=Float32Array.from(je.globeMatrix),xt={useDenormalizedUpVectorScale:!0};{const Bt=G.transform,zt=rh(Bt.zoom,Y.exaggeration(),Y.sourceCache._source.tileSize);Ce=-1;const Jt=xe.TRIANGLES;for(const yt of ee){const Ft=ne.getTile(yt),gt=Un.disabled,Lt=Y.prevTerrainTileForTile[yt.key],kt=Y.terrainTileForTile[yt.key];z_(Lt,kt)&&Ac.newMorphing(yt.key,Lt,kt,he,250),we.activeTexture.set(xe.TEXTURE0),Ft.texture&&Ft.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);const Ut=Ac.getMorphValuesForProxy(yt.key),Rt=Ut?1:0;Ut&&s.L(xt,{morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:s.cC(Ut.phase)}});const Wt=s.cF(yt.canonical),dn=s.cG(Wt.getCenter().lat),pn=s.cH(yt.canonical,Wt,dn,Bt.worldSize/Bt._pixelsPerMercatorPixel),xn=s.bc(s.cI(yt.canonical)),kn=n1(Bt.expandedFarZProjMatrix,At,Xe,xn,s.ag(Bt.zoom),Ke,Bt.frustumCorners.TL,Bt.frustumCorners.TR,Bt.frustumCorners.BR,Bt.frustumCorners.BL,Bt.globeCenterInViewSpace,Bt.globeRadius,at,zt,Bt._farZ,pn);if(We(yt,Rt),Ee&&(Y.setupElevationDraw(Ft,Ee,xt),G.uploadCommonUniforms(we,Ee,yt.toUnwrapped()),tt)){const[gr,Qn,dr]=tt.getGridBuffers(dn,zt!==0);Ee.draw(G,Jt,Ye,gt,Ze,qn.backCCW,kn,"globe_raster",gr,Qn,dr)}}}if(tt&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){const Bt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];$e&&Bt.push("CUSTOM_ANTIALIASING"),Ee=G.getOrCreateProgram("globeRaster",{defines:Bt});for(const zt of ee){const{x:Jt,y:yt,z:Ft}=zt.canonical,gt=yt===0,Lt=yt===(1<<Ft)-1,[kt,Ut,Rt,Wt]=tt.getPoleBuffers(Ft,!1);if(Wt&&(gt||Lt)){const dn=ne.getTile(zt);we.activeTexture.set(xe.TEXTURE0),dn.texture&&dn.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);let pn=s.cJ(Ft,Jt,je);const xn=s.bc(s.cI(zt.canonical)),kn=(gr,Qn)=>gr.draw(G,xe.TRIANGLES,Ye,Un.disabled,Ze,qn.disabled,n1(je.expandedFarZProjMatrix,pn,pn,xn,0,Ke,je.frustumCorners.TL,je.frustumCorners.TR,je.frustumCorners.BR,je.frustumCorners.BL,je.globeCenterInViewSpace,je.globeRadius,at,0,je._farZ),"globe_pole_raster",Qn,Rt,Wt);Y.setupElevationDraw(dn,Ee,xt),G.uploadCommonUniforms(we,Ee,zt.toUnwrapped()),gt&&G.renderDefaultNorthPole&&kn(Ee,kt),Lt&&G.renderDefaultSouthPole&&(pn=s.ad.mat4.scale(s.ad.mat4.create(),pn,[1,-1,1]),kn(Ee,Ut))}}}})(E,C,M,j,H);else{const G=E.context,Y=G.gl;let ne,ee;const he=E.shadowRenderer,we=Nl(E,E.longestCutoffRange),xe=Ze=>{if(ee===Ze)return;const Ye=[];Ye.push(r1[Ze]),we.shouldRenderCutoff&&Ye.push("RENDER_CUTOFF"),he&&(Ye.push("RENDER_SHADOWS","DEPTH_TEXTURE"),he.useNormalOffset&&Ye.push("NORMAL_OFFSET")),ne=E.getOrCreateProgram("terrainRaster",{defines:Ye}),ee=Ze},Ee=E.colorModeForRenderPass(),Ce=new gn(Y.LEQUAL,gn.ReadWrite,E.depthRangeFor3D);Ac.update(H);const je=E.transform,$e=rh(je.zoom,C.exaggeration(),C.sourceCache._source.tileSize);let We=[0,0,0];if(he){const Ze=E.style.directionalLight,Ye=E.style.ambientLight;Ze&&Ye&&(We=V(E.style,Ze,Ye))}{ee=-1;const Ze=Y.TRIANGLES,[Ye,Xe]=[C.gridIndexBuffer,C.gridSegments];for(const Ke of j){const tt=M.getTile(Ke),at=Un.disabled,At=C.prevTerrainTileForTile[Ke.key],xt=C.terrainTileForTile[Ke.key];z_(At,xt)&&Ac.newMorphing(Ke.key,At,xt,H,250),G.activeTexture.set(Y.TEXTURE0),tt.texture&&tt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const Bt=Ac.getMorphValuesForProxy(Ke.key),zt=Bt?1:0;let Jt;Bt&&(Jt={morphing:{srcDemTile:Bt.from,dstDemTile:Bt.to,phase:s.cC(Bt.phase)}});const yt=X2(Ke.projMatrix,i1(Ke.canonical,je.renderWorldCopies)?$e/10:$e,We);if(xe(zt),!ne)continue;C.setupElevationDraw(tt,ne,Jt);const Ft=Ke.toUnwrapped();he&&he.setupShadows(Ft,ne),E.uploadCommonUniforms(G,ne,Ft,null,we),ne.draw(E,Ze,Ce,at,Ee,qn.backCCW,yt,"terrain_raster",C.gridBuffer,Ye,Xe)}}}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,E=this.proxySourceCache,C=this.proxiedCoords[E.id],M=this._drapedRenderBatches.shift(),j=h.style.order,H=[];let G=0;for(const Y of C){const ne=E.getTileByID(Y.proxyTileKey),ee=E.proxyCachedFBO[Y.key]?E.proxyCachedFBO[Y.key][a]:void 0,he=ee!==void 0?E.renderCache[ee]:this.pool[G++],we=ee!==void 0;if(ne.texture=he.tex,we&&!he.dirty){H.push(ne.tileID);continue}let xe;_.bindFramebuffer.set(he.fb.framebuffer),this.renderedToTile=!1,he.dirty&&(_.clear({color:s.al.transparent,stencil:0}),he.dirty=!1);for(let Ee=M.start;Ee<=M.end;++Ee){const Ce=h.style._mergedLayers[j[Ee]];if(Ce.isHidden(h.transform.zoom))continue;const je=h.style.getLayerSourceCache(Ce),$e=je?this.proxyToSource[Y.key][je.id]:[Y];if(!$e)continue;const We=$e;_.viewport.set([0,0,he.fb.width,he.fb.height]),xe!==(je?je.id:null)&&(this._setupStencil(he,$e,Ce,je),xe=je?je.id:null),h.renderLayer(h,je,Ce,We)}if(this._drapedRenderBatches.length===0)for(const Ee of this._pendingGroundEffectLayers){const Ce=h.style._mergedLayers[j[Ee]];if(Ce.isHidden(h.transform.zoom))continue;const je=h.style.getLayerSourceCache(Ce),$e=je?this.proxyToSource[Y.key][je.id]:[Y];if(!$e)continue;const We=$e;_.viewport.set([0,0,he.fb.width,he.fb.height]),xe!==(je?je.id:null)&&(this._setupStencil(he,$e,Ce,je),xe=je?je.id:null),h.renderLayer(h,je,Ce,We)}this.renderedToTile?(he.dirty=!0,H.push(ne.tileID)):we||--G,G===5&&(G=0,this.renderToBackBuffer(H))}return this.renderToBackBuffer(H),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),M.end+1}postRender(){}isLayerOrderingCorrect(a){const h=a.order.length;let _=-1,E=h;for(let C=0;C<h;++C)this._style.isLayerDraped(a._mergedLayers[a.order[C]])?_=Math.max(_,C):E=Math.min(E,C);return E>_}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,h,_){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const M=C.tileID,j=1<<M.overscaledZ,{x:H,y:G}=M.canonical,Y=H/j,ne=(H+1)/j,ee=G/j,he=(G+1)/j;return{minx:Y,miny:ee,maxx:ne,maxy:he,t:C.dem.tree.raycastRoot(Y,ee,ne,he,a,h,_),tile:C}});E.sort((C,M)=>(C.t!==null?C.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const C of E){if(C.t==null)return null;const M=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,a,h,_);if(M!=null)return M}return null}_createFBO(){const a=this.painter.context,h=a.gl,_=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const E=new s.T(a,{width:_[0],height:_[1],data:null},h.RGBA8);E.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=a.createFramebuffer(_[0],_[1],!0,null);return C.colorAttachment.set(E.texture),C.depthAttachment=new Y2(a,C.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:C,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const h=this._style._mergedLayers[a],_=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const _ of this._style.getSources())if(_ instanceof Ti){a=!0;break}if(!a)return;const h={};for(let _=0;_<this._style.order.length;++_){const E=this._style._mergedLayers[this._style.order[_]],C=this._style.getLayerSourceCache(E);if(C&&!h[C.id]&&!E.isHidden(this.painter.transform.zoom)&&E.type==="line"&&E.widthExpression()instanceof s.ab){h[C.id]=!0;for(const M of this.proxyCoords){const j=this.proxyToSource[M.key][C.id];if(j)for(const H of j)this._clearRenderCacheForTile(C.id,H)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof Ko){a=!0;break}if(!a)return;const h={};for(let _=0;_<this._style.order.length;++_){const E=this._style._mergedLayers[this._style.order[_]],C=this._style.getLayerSourceCache(E);if(!C||h[C.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="raster")continue;const M=E.paint.get("raster-fade-duration");for(const j of this.proxyCoords){const H=this.proxyToSource[j.key][C.id];if(H)for(const G of H){const Y=j_(C.getTile(G),C.findLoadedParent(G,0),C,this.painter.transform,M);(Y.opacity!==1||Y.mix!==0)&&this._clearRenderCacheForTile(C.id,G)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const a=this._style.order,h=a.length;if(h===0)return;const _=[];this._pendingGroundEffectLayers=[];let E,C=0,M=this._style._mergedLayers[a[C]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++C<h;)M=this._style._mergedLayers[a[C]];for(;C<h;++C){const j=this._style._mergedLayers[a[C]];j.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(j)?E===void 0&&(E=C):(j.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(C),E!==void 0&&(_.push({start:E,end:C-1}),E=void 0)))}if(E!==void 0&&_.push({start:E,end:C-1}),_.length!==0){const j=_[_.length-1];this._pendingGroundEffectLayers.every(H=>H>j.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const M=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let j=0;j<M.length;++j){const H=Object.values(M[j]);h.renderCachePool.push(...H)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,E=this._tilesDirty;for(let M=_.length-1;M>=0;M--){const j=_[M];if(h.getTileByID(j.key),h.proxyCachedFBO[j.key]!==void 0){const H=a[j.key],G=this.proxyToSource[j.key];let Y=0;for(const ne in G){const ee=G[ne],he=H[ne];if(!he||he.length!==ee.length||ee.some((we,xe)=>we!==he[xe]||E[ne]&&E[ne].hasOwnProperty(we.key))){Y=-1;break}++Y}for(const ne in h.proxyCachedFBO[j.key])h.renderCache[h.proxyCachedFBO[j.key][ne]].dirty=Y<0||Y!==Object.values(H).length}}const C=[...this._drapedRenderBatches];C.sort((M,j)=>j.end-j.start-(M.end-M.start));for(const M of C)for(const j of _){if(h.proxyCachedFBO[j.key])continue;let H=h.renderCachePool.pop();H===void 0&&h.renderCache.length<50&&(H=h.renderCache.length,h.renderCache.push(this._createFBO())),H!==void 0&&(h.proxyCachedFBO[j.key]={},h.proxyCachedFBO[j.key][M.start]=H,h.renderCache[H].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,_,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,M=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let j;if(_.isTileClipped())j=h.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);j=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+j>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=j,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):Un.disabled}_renderTileClippingMasks(a,h){const _=this.painter,E=this.painter.context,C=E.gl;_._tileClippingMaskIDs={},E.setColorMode(nr.disabled),E.setDepthMode(gn.disabled);const M=_.getOrCreateProgram("clippingMask");for(const j of a){const H=_._tileClippingMaskIDs[j.key]=--h;M.draw(_,C.TRIANGLES,gn.disabled,new Un({func:C.ALWAYS,mask:0},H,255,C.KEEP,C.KEEP,C.REPLACE),nr.disabled,qn.disabled,Kf(j.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const _=[a.x,a.y,1,1];s.ad.vec4.transformMat4(_,_,h.pixelMatrixInverse),s.ad.vec4.scale(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const E=h._camera.position,C=s.bH(1,h.center.lat),M=[E[0],E[1],E[2]/C,0],j=s.ad.vec3.subtract([],_.slice(0,3),M);s.ad.vec3.normalize(j,j);const H=this.raycast(M,j,this._exaggeration);return H!==null&&H?(s.ad.vec3.scaleAndAdd(M,M,j,H),M[3]=M[2],M[2]*=C,M):null}_setupProxiedCoordsForOrtho(a,h,_){if(a.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(a,h,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const E=this.proxiedCoords[a.id]=[],C=this.proxyCoords;for(let H=0;H<C.length;H++){const G=C[H],Y=this._findTileCoveringTileID(G,a);if(Y){const ne=this._createProxiedId(G,Y,_[G.key]&&_[G.key][a.id]);E.push(ne),this.proxyToSource[G.key][a.id]=[ne]}}let M=!1;const j=new Set;for(let H=0;H<h.length;H++){const G=a.getTile(h[H]);if(!G||!G.hasData())continue;const Y=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(Y&&Y.tileID.canonical.z!==G.tileID.canonical.z){const ne=this.proxyToSource[Y.tileID.key][a.id],ee=this._createProxiedId(Y.tileID,G,_[Y.tileID.key]&&_[Y.tileID.key][a.id]);ne?ne.splice(ne.length-1,0,ee):this.proxyToSource[Y.tileID.key][a.id]=[ee];const he=this.proxyToSource[Y.tileID.key][a.id];j.has(he)||j.add(he),E.push(ee),M=!0}}if(this._sourceTilesOverlap[a.id]=M,M&&this._debugParams.sortTilesHiZFirst)for(const H of j)H.sort((G,Y)=>Y.overscaledZ-G.overscaledZ)}_setupProxiedCoordsForImageSource(a,h,_){if(!a.getSource().loaded())return;const E=this.proxiedCoords[a.id]=[],C=this.proxyCoords,M=a.getSource(),j=M.tileID;if(!j)return;const H=new s.P(j.x,j.y)._div(1<<j.z),G=M.coordinates.map(s.ac.fromLngLat).reduce((ne,ee)=>(ne.min.x=Math.min(ne.min.x,ee.x-H.x),ne.min.y=Math.min(ne.min.y,ee.y-H.y),ne.max.x=Math.max(ne.max.x,ee.x-H.x),ne.max.y=Math.max(ne.max.y,ee.y-H.y),ne),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Y=(ne,ee)=>{const he=ne.wrap+ne.canonical.x/(1<<ne.canonical.z),we=ne.canonical.y/(1<<ne.canonical.z),xe=s.ai/(1<<ne.canonical.z),Ee=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),Ce=ee.canonical.y/(1<<ee.canonical.z);return he+xe<Ee+G.min.x||he>Ee+G.max.x||we+xe<Ce+G.min.y||we>Ce+G.max.y};for(let ne=0;ne<C.length;ne++){const ee=C[ne];for(let he=0;he<h.length;he++){const we=a.getTile(h[he]);if(!we||!we.hasData()||Y(ee,we.tileID))continue;const xe=this._createProxiedId(ee,we,_[ee.key]&&_[ee.key][a.id]),Ee=this.proxyToSource[ee.key][a.id];Ee?Ee.push(xe):this.proxyToSource[ee.key][a.id]=[xe],E.push(xe)}}}_createProxiedId(a,h,_){let E=this.orthoMatrix;if(_){const C=_.find(M=>M.key===h.tileID.key);if(C)return C}if(h.tileID.key!==a.key){const C=a.canonical.z-h.tileID.canonical.z;let M,j,H;E=s.ad.mat4.create();const G=h.tileID.wrap-a.wrap<<a.overscaledZ;C>0?(M=s.ai>>C,j=M*((h.tileID.canonical.x<<C)-a.canonical.x+G),H=M*((h.tileID.canonical.y<<C)-a.canonical.y)):(M=s.ai<<-C,j=s.ai*(h.tileID.canonical.x-(a.canonical.x+G<<-C)),H=s.ai*(h.tileID.canonical.y-(a.canonical.y<<-C))),s.ad.mat4.ortho(E,0,M,0,M,0,1),s.ad.mat4.translate(E,E,[j,H,0])}return new V_(h.tileID,a.key,E)}_findTileCoveringTileID(a,h){let _=h.getTile(a);if(_&&_.hasData())return _;const E=this._findCoveringTileCache[h.id],C=E[a.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||C===null)return _;let M=_?_.tileID:a,j=M.overscaledZ;const H=h.getSource().minzoom,G=[];if(!C){const ne=h.getSource().maxzoom;if(a.canonical.z>=ne){const ee=a.canonical.z-ne;h.getSource().reparseOverscaled?(j=Math.max(a.canonical.z+2,h.transform.tileZoom),M=new s.aH(j,a.wrap,ne,a.canonical.x>>ee,a.canonical.y>>ee)):ee!==0&&(j=ne,M=new s.aH(j,a.wrap,ne,a.canonical.x>>ee,a.canonical.y>>ee))}M.key!==a.key&&(G.push(M.key),_=h.getTile(M))}const Y=ne=>{G.forEach(ee=>{E[ee]=ne}),G.length=0};for(j-=1;j>=H&&(!_||!_.hasData());j--){_&&Y(_.tileID.key);const ne=M.calculateScaledKey(j);if(_=h.getTileByID(ne),_&&_.hasData())break;const ee=E[ne];if(ee===null)break;ee===void 0?G.push(ne):_=h.getTileByID(ee)}return Y(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[h.key]=!0}}function Q2(y,a,h){const _=function(j,H,G){const Y=s.ad.vec3.dot(H,j),ne=s.ad.vec3.dot(G,[.2126,.7152,.0722]),ee=(we,xe,Ee)=>(1-Ee)*we+Ee*xe,he=ee(1-.3*Math.min(ne,1),1,Math.min(Y+1,1));return ee(.92,1,Math.asin(s.ay(H[2],-1,1))/Math.PI+.5)*he}(y,[0,0,1],a),E=[0,0,0];s.ad.vec3.scale(E,h.slice(0,3),_);const C=[0,0,0];s.ad.vec3.scale(C,a.slice(0,3),y[2]);const M=[0,0,0];return s.ad.vec3.add(M,E,C),s.cg(M)}const Gm=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dM=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class J2{static cacheKey(a,h,_,E){let C=`${h}${E?E.cacheKey:""}`;for(const M of _)a.usedDefines.includes(M)&&(C+=`/${M}`);return C}constructor(a,h,_,E,C,M){const j=a.gl;this.program=j.createProgram(),this.configuration=E,this.name=h,this.fixedDefines=[...M];const H=E?E.getBinderAttributes():[],G=(_.staticAttributes||[]).concat(H);let Y=E?E.defines():[];Y=Y.concat(M.map(Ee=>`#define ${Ee}`));const ne=`#version 300 es
`;let ee=ne+Y.concat("precision mediump float;",N_,Ux.fragmentSource).join(`
`);for(const Ee of _.fragmentIncludes)ee+=`
${Vd[Ee]}`;ee+=`
${_.fragmentSource}`;let he=ne+Y.concat("precision highp float;",N_,Ux.vertexSource).join(`
`);for(const Ee of _.vertexIncludes)he+=`
${Vd[Ee]}`;this.forceManualRenderingForInstanceIDShaders=a.forceManualRenderingForInstanceIDShaders&&_.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(he+=`
uniform int u_instanceID;
`),he+=`
${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(he=he.replaceAll("gl_InstanceID","u_instanceID"));const we=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);j.shaderSource(we,ee),j.compileShader(we),j.attachShader(this.program,we);const xe=j.createShader(j.VERTEX_SHADER);if(j.isContextLost())this.failedToCreate=!0;else{j.shaderSource(xe,he),j.compileShader(xe),j.attachShader(this.program,xe),this.attributes={},this.numAttributes=G.length;for(let Ee=0;Ee<this.numAttributes;Ee++)if(G[Ee]){const Ce=G[Ee].startsWith("a_")?G[Ee]:`a_${G[Ee]}`;j.bindAttribLocation(this.program,Ee,Ce),this.attributes[Ce]=Ee}j.linkProgram(this.program),j.deleteShader(xe),j.deleteShader(we),this.fixedUniforms=C(a),this.binderUniforms=E?E.getUniforms(a):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Ee=>({u_instanceID:new s.bN(Ee)}))(a)),(M.includes("TERRAIN")||h.indexOf("symbol")!==-1||h.indexOf("circle")!==-1)&&(this.terrainUniforms=(Ee=>({u_dem:new s.bN(Ee),u_dem_prev:new s.bN(Ee),u_dem_tl:new s.bK(Ee),u_dem_scale:new s.bM(Ee),u_dem_tl_prev:new s.bK(Ee),u_dem_scale_prev:new s.bM(Ee),u_dem_size:new s.bM(Ee),u_dem_lerp:new s.bM(Ee),u_exaggeration:new s.bM(Ee),u_depth:new s.bN(Ee),u_depth_size_inv:new s.bK(Ee),u_depth_range_unpack:new s.bK(Ee),u_occluder_half_size:new s.bM(Ee),u_occlusion_depth_offset:new s.bM(Ee),u_meter_to_dem:new s.bM(Ee),u_label_plane_matrix_inv:new s.bJ(Ee)}))(a)),M.includes("GLOBE")&&(this.globeUniforms=(Ee=>({u_tile_tl_up:new s.bL(Ee),u_tile_tr_up:new s.bL(Ee),u_tile_br_up:new s.bL(Ee),u_tile_bl_up:new s.bL(Ee),u_tile_up_scale:new s.bM(Ee)}))(a)),M.includes("FOG")&&(this.fogUniforms=(Ee=>({u_fog_matrix:new s.bJ(Ee),u_fog_range:new s.bK(Ee),u_fog_color:new s.cb(Ee),u_fog_horizon_blend:new s.bM(Ee),u_fog_vertical_limit:new s.bK(Ee),u_fog_temporal_offset:new s.bM(Ee),u_frustum_tl:new s.bL(Ee),u_frustum_tr:new s.bL(Ee),u_frustum_br:new s.bL(Ee),u_frustum_bl:new s.bL(Ee),u_globe_pos:new s.bL(Ee),u_globe_radius:new s.bM(Ee),u_globe_transition:new s.bM(Ee),u_is_globe:new s.bN(Ee),u_viewport:new s.bK(Ee)}))(a)),M.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Ee=>({u_cutoff_params:new s.cb(Ee)}))(a)),M.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Ee=>({u_lighting_ambient_color:new s.bL(Ee),u_lighting_directional_dir:new s.bL(Ee),u_lighting_directional_color:new s.bL(Ee),u_ground_radiance:new s.bL(Ee)}))(a)),M.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Ee=>({u_light_matrix_0:new s.bJ(Ee),u_light_matrix_1:new s.bJ(Ee),u_fade_range:new s.bK(Ee),u_shadow_normal_offset:new s.bL(Ee),u_shadow_intensity:new s.bM(Ee),u_shadow_texel_size:new s.bM(Ee),u_shadow_map_resolution:new s.bM(Ee),u_shadow_direction:new s.bL(Ee),u_shadow_bias:new s.bL(Ee),u_shadowmap_0:new s.bN(Ee),u_shadowmap_1:new s.bN(Ee)}))(a))}}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const E in h)_[E]&&_[E].set(this.program,E,h[E])}}setGlobeUniformValues(a,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const E in h)_[E]&&_[E].set(this.program,E,h[E])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const E in h)_[E].set(this.program,E,h[E])}}setCutoffUniformValues(a,h){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const E in h)_[E].set(this.program,E,h[E])}}setLightsUniformValues(a,h){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const E in h)_[E].set(this.program,E,h[E])}}setShadowUniformValues(a,h){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;a.program.set(this.program);for(const E in h)_[E].set(this.program,E,h[E])}_drawDebugWireframe(a,h,_,E,C,M,j,H,G,Y){const ne=a.options.wireframe;if(ne.terrain===!1&&ne.layers2D===!1&&ne.layers3D===!1)return;const ee=a.context;if(!(!(!ne.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ne.layers2D||a._terrain&&a._terrain.renderingToTexture||!Gm.includes(this.name))||!(!ne.layers3D||!dM.includes(this.name))))return;const he=ee.gl,we=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,C,ee);if(!we)return;const xe=[...this.fixedDefines];xe.push("DEBUG_WIREFRAME");const Ee=a.getOrCreateProgram(this.name,{config:this.configuration,defines:xe});ee.program.set(Ee.program);const Ce=(We,Ze,Ye)=>{if(Ze[We]&&Ye[We])for(const Xe in Ze[We])Ye[We][Xe]&&Ye[We][Xe].set(Ye.program,Xe,Ze[We][Xe].current)};G&&G.setUniforms(Ee.program,ee,Ee.binderUniforms,j,{zoom:H}),Ce("fixedUniforms",this,Ee),Ce("terrainUniforms",this,Ee),Ce("globeUniforms",this,Ee),Ce("fogUniforms",this,Ee),Ce("lightsUniforms",this,Ee),Ce("shadowUniforms",this,Ee),we.bind(),ee.setColorMode(new nr([he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ZERO,he.ONE],s.al.transparent,[!0,!0,!0,!1])),ee.setDepthMode(new gn(h.func===he.LESS?he.LEQUAL:h.func,gn.ReadOnly,h.range)),ee.setStencilMode(Un.disabled);const je=3*M.primitiveLength*2,$e=3*M.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const We=Y||1;for(let Ze=0;Ze<We;++Ze)Ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ze),he.drawElements(he.LINES,je,he.UNSIGNED_SHORT,$e)}else Y&&Y>1?he.drawElementsInstanced(he.LINES,je,he.UNSIGNED_SHORT,$e,Y):he.drawElements(he.LINES,je,he.UNSIGNED_SHORT,$e);C.bind(),ee.program.set(this.program),ee.setDepthMode(h),ee.setStencilMode(_),ee.setColorMode(E)}checkUniforms(a,h,_){if(this.fixedDefines.includes(h)){for(const E of Object.keys(_))if(!_[E].initialized)throw new Error(`Program '${this.name}', from draw '${a}': uniform ${E} not set but required by ${h} being defined`)}}draw(a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee){const Ce=a.context,je=Ce.gl;if(this.failedToCreate)return;Ce.program.set(this.program),Ce.setDepthMode(_),Ce.setStencilMode(E),Ce.setColorMode(C),Ce.setCullFace(M);for(const Ze of Object.keys(this.fixedUniforms))this.fixedUniforms[Ze].set(this.program,Ze,j[Ze]);we&&we.setUniforms(this.program,Ce,this.binderUniforms,ee,{zoom:he});const $e={[je.POINTS]:1,[je.LINES]:2,[je.TRIANGLES]:3,[je.LINE_STRIP]:1}[h];this.checkUniforms(H,"RENDER_SHADOWS",this.shadowUniforms);const We=Ee&&Ee>0?1:void 0;for(const Ze of ne.get()){const Ye=Ze.vaos||(Ze.vaos={});if((Ye[H]||(Ye[H]=new V2)).bind(Ce,this,G,we?we.getPaintVertexBuffers():[],Y,Ze.vertexOffset,xe||[],We),this.forceManualRenderingForInstanceIDShaders){const Xe=Ee||1;for(let Ke=0;Ke<Xe;++Ke)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ke),Y?je.drawElements(h,Ze.primitiveLength*$e,je.UNSIGNED_SHORT,Ze.primitiveOffset*$e*2):je.drawArrays(h,Ze.vertexOffset,Ze.vertexLength)}else Ee&&Ee>1?je.drawElementsInstanced(h,Ze.primitiveLength*$e,je.UNSIGNED_SHORT,Ze.primitiveOffset*$e*2,Ee):Y?je.drawElements(h,Ze.primitiveLength*$e,je.UNSIGNED_SHORT,Ze.primitiveOffset*$e*2):je.drawArrays(h,Ze.vertexOffset,Ze.vertexLength);h===je.TRIANGLES&&Y&&this._drawDebugWireframe(a,_,E,C,Y,Ze,ee,he,we,Ee)}}}function o1(y,a){const h=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,y.transform.tileZoom)/h,E=_*(a.tileID.canonical.x+a.tileID.wrap*h),C=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.at(a,1,y.transform.tileZoom),u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const U_={terrain:0,flat:1},a1=s.ad.mat4.create(),H_=(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee,Ce)=>{const je=a.style.light,$e=je.properties.get("position"),We=[$e.x,$e.y,$e.z],Ze=s.ad.mat3.create();je.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(Ze,-a.transform.angle),s.ad.vec3.transformMat3(We,We,Ze));const Ye=je.properties.get("color"),Xe=a.transform,Ke={u_matrix:y,u_lightpos:We,u_lightintensity:je.properties.get("intensity"),u_lightcolor:[Ye.r,Ye.g,Ye.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:a1,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:U_[G],u_base_type:U_[Y],u_ao:E,u_edge_radius:C,u_width_scale:M,u_flood_light_color:we,u_vertical_scale:xe,u_flood_light_intensity:Ee,u_ground_shadow_factor:Ce};return Xe.projection.name==="globe"&&(Ke.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],Ke.u_zoom_transition=ne,Ke.u_inv_rot_matrix=he,Ke.u_merc_center=ee,Ke.u_up_dir=Xe.projection.upVector(new s.bT(0,0,0),ee[0]*s.ai,ee[1]*s.ai),Ke.u_height_lift=H),Ke},Zf=(y,a,h,_,E,C)=>({u_matrix:y,u_edge_radius:a,u_width_scale:h,u_vertical_scale:_,u_height_type:U_[E],u_base_type:U_[C]}),l1=(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee)=>{const Ce=H_(y,a,h,_,E,C,M,j,G,Y,ne,ee,he,we,xe,Ee,1,[0,0,0]),je={u_height_factor:-Math.pow(2,j.overscaledZ)/H.tileSize/8};return s.l(Ce,o1(a,H),je)},Qf=(y,a)=>({u_matrix:y,u_emissive_strength:a}),c1=(y,a,h,_)=>s.l(Qf(y,a),o1(h,_)),W_=(y,a,h)=>({u_matrix:y,u_world:h,u_emissive_strength:a}),$_=(y,a,h,_,E)=>s.l(c1(y,a,h,_),{u_world:E}),Ym=(y,a,h,_,E)=>({u_matrix:y,u_camera_pos:[a[0],a[1],a[2]],u_depth_bias:h,u_height_scale:_,u_reset_depth:E}),eE=(y,a,h,_)=>{const E=s.ai/h.tileSize;return{u_matrix:y,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/E,a.pixelsToGLUnits[1]/E]}},tE=(y,a,h=1)=>({u_matrix:y,u_color:a.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),Jf=s.ad.mat4.create(),q_=(y,a,h,_,E,C,M)=>{const j=y.transform,H=j.projection.name==="globe",G=H?s.cO(j.zoom,a.canonical)*j._pixelsPerMercatorPixel:s.at(h,1,C),Y={u_matrix:a.projMatrix,u_extrude_scale:G,u_intensity:M,u_inv_rot_matrix:Jf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(H){Y.u_inv_rot_matrix=_,Y.u_merc_center=E,Y.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],Y.u_zoom_transition=s.ag(j.zoom);const ne=E[0]*s.ai,ee=E[1]*s.ai;Y.u_up_dir=j.projection.upVector(new s.bT(0,0,0),ne,ee)}return Y};function Tn(y,[a,h,_,E],[C,M]){if(C===M)return[0,0,0,0];const j=255*(y-1)/(y*(M-C));return[a*j,h*j,_*j,E*j]}function u1(y,a,[h,_]){return h===_?0:.5/y+(a-h)*(y-1)/(y*(_-h))}const h1=(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee,Ce,je,$e,We)=>({u_matrix:y,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:E,u_tl_parent:C,u_scale_parent:G,u_fade_t:Y.mix,u_opacity:Y.opacity*ne.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ne.paint.get("raster-brightness-min"),u_brightness_high:ne.paint.get("raster-brightness-max"),u_saturation_factor:s.cP(ne.paint.get("raster-saturation")),u_contrast_factor:s.cQ(ne.paint.get("raster-contrast")),u_spin_weights:Yh(ne.paint.get("raster-hue-rotate")),u_perspective_transform:ee,u_raster_elevation:he,u_zoom_transition:M,u_merc_center:j,u_cutoff_params:H,u_colorization_mix:Tn(s.cR,xe,Ce),u_colorization_offset:u1(s.cR,Ee,Ce),u_color_ramp:we,u_texture_offset:[$e/(je+2*$e),je/(je+2*$e)],u_texture_res:[je+2*$e,je+2*$e],u_emissive_strength:We});function Yh(y){y*=Math.PI/180;const a=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const cc=.05,Gn=(y,a,h,_,E,C,M,j,H,G,Y,ne)=>({u_matrix:y,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:E,u_tl_parent:C,u_scale_parent:G,u_fade_t:Y.mix,u_opacity:Y.opacity,u_image0:0,u_image1:1,u_raster_elevation:ne,u_zoom_transition:M,u_merc_center:j,u_cutoff_params:H}),d1=(y,a,h,_,E,C,M,j,H,G)=>({u_particle_texture:y,u_particle_texture_side_len:a,u_tile_offset:h,u_velocity:_,u_color_ramp:C,u_velocity_res:E,u_max_speed:M,u_uv_offset:j,u_data_scale:[255*H[0],255*H[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[cc,cc]}),fM=(y,a,h,_,E,C,M,j,H,G)=>({u_particle_texture:y,u_particle_texture_side_len:a,u_velocity:h,u_velocity_res:_,u_max_speed:E,u_speed_factor:C,u_reset_rate:M,u_rand_seed:Math.random(),u_uv_offset:j,u_data_scale:[255*H[0],255*H[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[cc,cc]}),nE=s.ad.mat4.create(),G_=(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee,Ce,je,$e,We,Ze)=>{const Ye=E.transform,Xe={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:Ye.getCameraToCenterDistance(je),u_rotate_symbol:+h,u_aspect_ratio:Ye.width/Ye.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:M,u_coord_matrix:j,u_is_text:+G,u_elevation_from_sea:H?1:0,u_pitch_with_map:+_,u_texsize:Y,u_texsize_icon:ne,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nE,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:nE,u_up_vector:[0,-1,0],u_color_adj_mat:$e,u_icon_transition:We||0,u_gamma_scale:_?E.transform.getCameraToCenterDistance(je)*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ze||1};return je.name==="globe"&&(Xe.u_tile_id=[he.canonical.x,he.canonical.y,1<<he.canonical.z],Xe.u_zoom_transition=we,Xe.u_inv_rot_matrix=Ee,Xe.u_merc_center=xe,Xe.u_camera_forward=Ye._camera.forward(),Xe.u_ecef_origin=s.cS(Ye.globeMatrix,he.toUnwrapped()),Xe.u_tile_matrix=Float32Array.from(Ye.globeMatrix),Xe.u_up_vector=Ce),Xe},f1=(y,a,h,_)=>({u_matrix:y,u_emissive_strength:a,u_opacity:h,u_color:_}),rE=(y,a,h,_,E,C,M,j,H)=>s.l(function(G,Y,ne,ee,he,we){const{width:xe,height:Ee}=ee.imageManager.getPixelSize(Y),Ce=Math.pow(2,we.tileID.overscaledZ),je=we.tileSize*Math.pow(2,ee.transform.tileZoom)/Ce,$e=je*(we.tileID.canonical.x+we.tileID.wrap*Ce),We=je*we.tileID.canonical.y;return{u_image:0,u_pattern_tl:ne.tl,u_pattern_br:ne.br,u_texsize:[xe,Ee],u_pattern_size:ne.displaySize,u_pattern_units_to_pixels:he?[ee.transform.width,-1*ee.transform.height]:[1/s.at(we,1,ee.transform.tileZoom),1/s.at(we,1,ee.transform.tileZoom)],u_pixel_coord_upper:[$e>>16,We>>16],u_pixel_coord_lower:[65535&$e,65535&We]}}(0,C,M,_,j,H),{u_matrix:y,u_emissive_strength:a,u_opacity:h}),Y_=new Float32Array(s.ad.mat4.identity([])),p1=(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he=[0,0,0],we)=>{const xe=E.style.light,Ee=xe.properties.get("position"),Ce=[-Ee.x,-Ee.y,Ee.z],je=s.ad.mat3.create();xe.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(je,-E.transform.angle),s.ad.vec3.transformMat3(Ce,Ce,je));const $e=Y.alphaMode==="MASK",We=xe.properties.get("color").toRenderColor(null),Ze=ee.paint.get("model-ambient-occlusion-intensity"),Ye=ee.paint.get("model-color").constantOr(s.al.white).toRenderColor(null),Xe=ee.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:y,u_lighting_matrix:a,u_normal_matrix:h,u_node_matrix:_||Y_,u_lightpos:Ce,u_lightintensity:xe.properties.get("intensity"),u_lightcolor:[We.r,We.g,We.b],u_camera_pos:he,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+$e,u_alphaCutoff:Y.alphaCutoff,u_baseColorFactor:[M.r,M.g,M.b,M.a],u_emissiveFactor:[j[0],j[1],j[2],1],u_metallicFactor:H,u_roughnessFactor:G,u_baseColorTexture:Ps.BaseColor,u_metallicRoughnessTexture:Ps.MetallicRoughness,u_normalTexture:Ps.Normal,u_occlusionTexture:Ps.Occlusion,u_emissionTexture:Ps.Emission,u_lutTexture:Ps.LUT,u_color_mix:[Ye.r,Ye.g,Ye.b,Xe],u_aoIntensity:Ze,u_emissive_strength:ne,u_occlusionTextureTransform:we||[0,0,0,0]}},iE=(y,a=Y_,h=Y_)=>({u_matrix:y,u_instance:a,u_node_matrix:h}),m1={fillExtrusion:y=>({u_matrix:new s.bJ(y),u_lightpos:new s.bL(y),u_lightintensity:new s.bM(y),u_lightcolor:new s.bL(y),u_vertical_gradient:new s.bM(y),u_opacity:new s.bM(y),u_edge_radius:new s.bM(y),u_width_scale:new s.bM(y),u_ao:new s.bK(y),u_height_type:new s.bN(y),u_base_type:new s.bN(y),u_tile_id:new s.bL(y),u_zoom_transition:new s.bM(y),u_inv_rot_matrix:new s.bJ(y),u_merc_center:new s.bK(y),u_up_dir:new s.bL(y),u_height_lift:new s.bM(y),u_flood_light_color:new s.bL(y),u_vertical_scale:new s.bM(y),u_flood_light_intensity:new s.bM(y),u_ground_shadow_factor:new s.bL(y)}),fillExtrusionDepth:y=>({u_matrix:new s.bJ(y),u_edge_radius:new s.bM(y),u_width_scale:new s.bM(y),u_vertical_scale:new s.bM(y),u_height_type:new s.bN(y),u_base_type:new s.bN(y)}),fillExtrusionPattern:y=>({u_matrix:new s.bJ(y),u_lightpos:new s.bL(y),u_lightintensity:new s.bM(y),u_lightcolor:new s.bL(y),u_vertical_gradient:new s.bM(y),u_height_factor:new s.bM(y),u_edge_radius:new s.bM(y),u_width_scale:new s.bM(y),u_ao:new s.bK(y),u_height_type:new s.bN(y),u_base_type:new s.bN(y),u_tile_id:new s.bL(y),u_zoom_transition:new s.bM(y),u_inv_rot_matrix:new s.bJ(y),u_merc_center:new s.bK(y),u_up_dir:new s.bL(y),u_height_lift:new s.bM(y),u_image:new s.bN(y),u_texsize:new s.bK(y),u_pixel_coord_upper:new s.bK(y),u_pixel_coord_lower:new s.bK(y),u_tile_units_to_pixels:new s.bM(y),u_opacity:new s.bM(y)}),fillExtrusionGroundEffect:y=>({u_matrix:new s.bJ(y),u_opacity:new s.bM(y),u_ao_pass:new s.bM(y),u_meter_to_tile:new s.bM(y),u_ao:new s.bK(y),u_flood_light_intensity:new s.bM(y),u_flood_light_color:new s.bL(y),u_attenuation:new s.bM(y),u_edge_radius:new s.bM(y),u_fb:new s.bN(y),u_fb_size:new s.bM(y),u_dynamic_offset:new s.bM(y)}),fill:y=>({u_matrix:new s.bJ(y),u_emissive_strength:new s.bM(y)}),fillPattern:y=>({u_matrix:new s.bJ(y),u_emissive_strength:new s.bM(y),u_image:new s.bN(y),u_texsize:new s.bK(y),u_pixel_coord_upper:new s.bK(y),u_pixel_coord_lower:new s.bK(y),u_tile_units_to_pixels:new s.bM(y)}),fillOutline:y=>({u_matrix:new s.bJ(y),u_emissive_strength:new s.bM(y),u_world:new s.bK(y)}),fillOutlinePattern:y=>({u_matrix:new s.bJ(y),u_emissive_strength:new s.bM(y),u_world:new s.bK(y),u_image:new s.bN(y),u_texsize:new s.bK(y),u_pixel_coord_upper:new s.bK(y),u_pixel_coord_lower:new s.bK(y),u_tile_units_to_pixels:new s.bM(y)}),elevatedStructures:y=>({u_matrix:new s.bJ(y)}),elevatedStructuresDepthReconstruct:y=>({u_matrix:new s.bJ(y),u_camera_pos:new s.bL(y),u_depth_bias:new s.bM(y),u_height_scale:new s.bM(y),u_reset_depth:new s.bM(y)}),circle:s.cT,collisionBox:y=>({u_matrix:new s.bJ(y),u_camera_to_center_distance:new s.bM(y),u_extrude_scale:new s.bK(y)}),collisionCircle:y=>({u_matrix:new s.bJ(y),u_inv_matrix:new s.bJ(y),u_camera_to_center_distance:new s.bM(y),u_viewport_size:new s.bK(y)}),debug:y=>({u_color:new s.cA(y),u_matrix:new s.bJ(y),u_overlay:new s.bN(y),u_overlay_scale:new s.bM(y)}),clippingMask:y=>({u_matrix:new s.bJ(y)}),heatmap:y=>({u_extrude_scale:new s.bM(y),u_intensity:new s.bM(y),u_matrix:new s.bJ(y),u_inv_rot_matrix:new s.bJ(y),u_merc_center:new s.bK(y),u_tile_id:new s.bL(y),u_zoom_transition:new s.bM(y),u_up_dir:new s.bL(y)}),heatmapTexture:y=>({u_image:new s.bN(y),u_color_ramp:new s.bN(y),u_opacity:new s.bM(y)}),hillshade:y=>({u_matrix:new s.bJ(y),u_image:new s.bN(y),u_latrange:new s.bK(y),u_light:new s.bK(y),u_shadow:new s.cA(y),u_highlight:new s.cA(y),u_emissive_strength:new s.bM(y),u_accent:new s.cA(y)}),hillshadePrepare:y=>({u_matrix:new s.bJ(y),u_image:new s.bN(y),u_dimension:new s.bK(y),u_zoom:new s.bM(y)}),line:s.cU,linePattern:s.cV,raster:y=>({u_matrix:new s.bJ(y),u_normalize_matrix:new s.bJ(y),u_globe_matrix:new s.bJ(y),u_merc_matrix:new s.bJ(y),u_grid_matrix:new s.cB(y),u_tl_parent:new s.bK(y),u_scale_parent:new s.bM(y),u_fade_t:new s.bM(y),u_opacity:new s.bM(y),u_image0:new s.bN(y),u_image1:new s.bN(y),u_brightness_low:new s.bM(y),u_brightness_high:new s.bM(y),u_saturation_factor:new s.bM(y),u_contrast_factor:new s.bM(y),u_spin_weights:new s.bL(y),u_perspective_transform:new s.bK(y),u_raster_elevation:new s.bM(y),u_zoom_transition:new s.bM(y),u_merc_center:new s.bK(y),u_cutoff_params:new s.cb(y),u_colorization_mix:new s.cb(y),u_colorization_offset:new s.bM(y),u_color_ramp:new s.bN(y),u_texture_offset:new s.bK(y),u_texture_res:new s.bK(y),u_emissive_strength:new s.bM(y)}),rasterParticle:y=>({u_matrix:new s.bJ(y),u_normalize_matrix:new s.bJ(y),u_globe_matrix:new s.bJ(y),u_merc_matrix:new s.bJ(y),u_grid_matrix:new s.cB(y),u_tl_parent:new s.bK(y),u_scale_parent:new s.bM(y),u_fade_t:new s.bM(y),u_opacity:new s.bM(y),u_image0:new s.bN(y),u_image1:new s.bN(y),u_raster_elevation:new s.bM(y),u_zoom_transition:new s.bM(y),u_merc_center:new s.bK(y),u_cutoff_params:new s.cb(y)}),rasterParticleTexture:y=>({u_texture:new s.bN(y),u_opacity:new s.bM(y)}),rasterParticleDraw:y=>({u_particle_texture:new s.bN(y),u_particle_texture_side_len:new s.bM(y),u_tile_offset:new s.bK(y),u_velocity:new s.bN(y),u_color_ramp:new s.bN(y),u_velocity_res:new s.bK(y),u_max_speed:new s.bM(y),u_uv_offset:new s.bK(y),u_data_scale:new s.bK(y),u_data_offset:new s.bM(y),u_particle_pos_scale:new s.bM(y),u_particle_pos_offset:new s.bK(y)}),rasterParticleUpdate:y=>({u_particle_texture:new s.bN(y),u_particle_texture_side_len:new s.bM(y),u_velocity:new s.bN(y),u_velocity_res:new s.bK(y),u_max_speed:new s.bM(y),u_speed_factor:new s.bM(y),u_reset_rate:new s.bM(y),u_rand_seed:new s.bM(y),u_uv_offset:new s.bK(y),u_data_scale:new s.bK(y),u_data_offset:new s.bM(y),u_particle_pos_scale:new s.bM(y),u_particle_pos_offset:new s.bK(y)}),symbol:y=>({u_is_size_zoom_constant:new s.bN(y),u_is_size_feature_constant:new s.bN(y),u_size_t:new s.bM(y),u_size:new s.bM(y),u_camera_to_center_distance:new s.bM(y),u_rotate_symbol:new s.bN(y),u_aspect_ratio:new s.bM(y),u_fade_change:new s.bM(y),u_matrix:new s.bJ(y),u_label_plane_matrix:new s.bJ(y),u_coord_matrix:new s.bJ(y),u_is_text:new s.bN(y),u_elevation_from_sea:new s.bN(y),u_pitch_with_map:new s.bN(y),u_texsize:new s.bK(y),u_texsize_icon:new s.bK(y),u_texture:new s.bN(y),u_texture_icon:new s.bN(y),u_gamma_scale:new s.bM(y),u_device_pixel_ratio:new s.bM(y),u_tile_id:new s.bL(y),u_zoom_transition:new s.bM(y),u_inv_rot_matrix:new s.bJ(y),u_merc_center:new s.bK(y),u_camera_forward:new s.bL(y),u_tile_matrix:new s.bJ(y),u_up_vector:new s.bL(y),u_ecef_origin:new s.bL(y),u_is_halo:new s.bN(y),u_icon_transition:new s.bM(y),u_color_adj_mat:new s.bJ(y),u_scale_factor:new s.bM(y)}),background:y=>({u_matrix:new s.bJ(y),u_emissive_strength:new s.bM(y),u_opacity:new s.bM(y),u_color:new s.cA(y)}),backgroundPattern:y=>({u_matrix:new s.bJ(y),u_emissive_strength:new s.bM(y),u_opacity:new s.bM(y),u_image:new s.bN(y),u_pattern_tl:new s.bK(y),u_pattern_br:new s.bK(y),u_texsize:new s.bK(y),u_pattern_size:new s.bK(y),u_pixel_coord_upper:new s.bK(y),u_pixel_coord_lower:new s.bK(y),u_pattern_units_to_pixels:new s.bK(y)}),terrainRaster:y=>({u_matrix:new s.bJ(y),u_image0:new s.bN(y),u_skirt_height:new s.bM(y),u_ground_shadow_factor:new s.bL(y)}),skybox:y=>({u_matrix:new s.bJ(y),u_sun_direction:new s.bL(y),u_cubemap:new s.bN(y),u_opacity:new s.bM(y),u_temporal_offset:new s.bM(y)}),skyboxGradient:y=>({u_matrix:new s.bJ(y),u_color_ramp:new s.bN(y),u_center_direction:new s.bL(y),u_radius:new s.bM(y),u_opacity:new s.bM(y),u_temporal_offset:new s.bM(y)}),skyboxCapture:y=>({u_matrix_3f:new s.cB(y),u_sun_direction:new s.bL(y),u_sun_intensity:new s.bM(y),u_color_tint_r:new s.cb(y),u_color_tint_m:new s.cb(y),u_luminance:new s.bM(y)}),globeRaster:y=>({u_proj_matrix:new s.bJ(y),u_globe_matrix:new s.bJ(y),u_normalize_matrix:new s.bJ(y),u_merc_matrix:new s.bJ(y),u_zoom_transition:new s.bM(y),u_merc_center:new s.bK(y),u_image0:new s.bN(y),u_grid_matrix:new s.cB(y),u_skirt_height:new s.bM(y),u_far_z_cutoff:new s.bM(y),u_frustum_tl:new s.bL(y),u_frustum_tr:new s.bL(y),u_frustum_br:new s.bL(y),u_frustum_bl:new s.bL(y),u_globe_pos:new s.bL(y),u_globe_radius:new s.bM(y),u_viewport:new s.bK(y)}),globeAtmosphere:y=>({u_frustum_tl:new s.bL(y),u_frustum_tr:new s.bL(y),u_frustum_br:new s.bL(y),u_frustum_bl:new s.bL(y),u_horizon:new s.bM(y),u_transition:new s.bM(y),u_fadeout_range:new s.bM(y),u_color:new s.cb(y),u_high_color:new s.cb(y),u_space_color:new s.cb(y),u_temporal_offset:new s.bM(y),u_horizon_angle:new s.bM(y)}),model:y=>({u_matrix:new s.bJ(y),u_lighting_matrix:new s.bJ(y),u_normal_matrix:new s.bJ(y),u_node_matrix:new s.bJ(y),u_lightpos:new s.bL(y),u_lightintensity:new s.bM(y),u_lightcolor:new s.bL(y),u_camera_pos:new s.bL(y),u_opacity:new s.bM(y),u_baseColorFactor:new s.cb(y),u_emissiveFactor:new s.cb(y),u_metallicFactor:new s.bM(y),u_roughnessFactor:new s.bM(y),u_baseTextureIsAlpha:new s.bN(y),u_alphaMask:new s.bN(y),u_alphaCutoff:new s.bM(y),u_baseColorTexture:new s.bN(y),u_metallicRoughnessTexture:new s.bN(y),u_normalTexture:new s.bN(y),u_occlusionTexture:new s.bN(y),u_emissionTexture:new s.bN(y),u_lutTexture:new s.bN(y),u_color_mix:new s.cb(y),u_aoIntensity:new s.bM(y),u_emissive_strength:new s.bM(y),u_occlusionTextureTransform:new s.cb(y)}),modelDepth:y=>({u_matrix:new s.bJ(y),u_instance:new s.bJ(y),u_node_matrix:new s.bJ(y)}),groundShadow:y=>({u_matrix:new s.bJ(y),u_ground_shadow_factor:new s.bL(y)}),stars:y=>({u_matrix:new s.bJ(y),u_up:new s.bL(y),u_right:new s.bL(y),u_intensity_multiplier:new s.bM(y)}),snowParticle:y=>({u_modelview:new s.bJ(y),u_projection:new s.bJ(y),u_time:new s.bM(y),u_cam_pos:new s.bL(y),u_velocityConeAperture:new s.bM(y),u_velocity:new s.bM(y),u_horizontalOscillationRadius:new s.bM(y),u_horizontalOscillationRate:new s.bM(y),u_boxSize:new s.bM(y),u_billboardSize:new s.bM(y),u_simpleShapeParameters:new s.bK(y),u_screenSize:new s.bK(y),u_thinningCenterPos:new s.bK(y),u_thinningShape:new s.bL(y),u_thinningAffectedRatio:new s.bM(y),u_thinningParticleOffset:new s.bM(y),u_particleColor:new s.cb(y),u_direction:new s.bL(y)}),rainParticle:y=>({u_modelview:new s.bJ(y),u_projection:new s.bJ(y),u_time:new s.bM(y),u_cam_pos:new s.bL(y),u_texScreen:new s.bN(y),u_velocityConeAperture:new s.bM(y),u_velocity:new s.bM(y),u_boxSize:new s.bM(y),u_rainDropletSize:new s.bK(y),u_distortionStrength:new s.bM(y),u_rainDirection:new s.bL(y),u_color:new s.cb(y),u_screenSize:new s.bK(y),u_thinningCenterPos:new s.bK(y),u_thinningShape:new s.bL(y),u_thinningAffectedRatio:new s.bM(y),u_thinningParticleOffset:new s.bM(y),u_shapeDirectionalPower:new s.bM(y),u_shapeNormalPower:new s.bM(y),u_mode:new s.bM(y)}),vignette:y=>({u_vignetteShape:new s.bL(y),u_vignetteColor:new s.cb(y)}),occlusion:y=>({u_matrix:new s.bJ(y),u_anchorPos:new s.bL(y),u_screenSizePx:new s.bK(y),u_occluderSizePx:new s.bK(y),u_color:new s.cb(y)})};class Ru{constructor(a,h,_,E){this.id=Ru.uniqueIdxCounter,Ru.uniqueIdxCounter++,this.context=a;const C=a.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||E||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=Ru.uniqueIdxCounter,Ru.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ru.uniqueIdxCounter=0;const g1={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _1{constructor(a,h,_,E,C,M){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=E,this.instanceCount=M,this.context=a;const j=a.gl;this.buffer=j.createBuffer(),a.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||C||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let _=0;_<this.attributes.length;_++){const E=h.attributes[this.attributes[_].name];E!==void 0&&a.enableVertexAttribArray(E)}}setVertexAttribPointers(a,h,_){for(let E=0;E<this.attributes.length;E++){const C=this.attributes[E],M=h.attributes[C.name];M!==void 0&&a.vertexAttribPointer(M,C.components,a[g1[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(a,h,_){for(let E=0;E<this.attributes.length;E++){const C=h.attributes[this.attributes[E].name];C!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(C,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fl{constructor(a,h,_,E,C){this.context=a,this.width=h,this.height=_;const M=this.framebuffer=a.gl.createFramebuffer();E&&(this.colorAttachment=new e1(a,M)),C&&(this.depthAttachmentType=C,this.depthAttachment=C==="renderbuffer"?new t1(a,M):new Xf(a,M))}destroy(){const a=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&a.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&a.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&a.deleteTexture(h)}a.deleteFramebuffer(this.framebuffer)}}class Xh{constructor(a,h){this.gl=a,this.clearColor=new iM(this),this.clearDepth=new Wx(this),this.clearStencil=new $x(this),this.colorMask=new qx(this),this.depthMask=new Gx(this),this.stencilMask=new H2(this),this.stencilFunc=new W2(this),this.stencilOp=new sM(this),this.stencilTest=new Wm(this),this.depthRange=new $m(this),this.depthTest=new $2(this),this.depthFunc=new lc(this),this.blend=new Yx(this),this.blendFunc=new O_(this),this.blendColor=new L_(this),this.blendEquation=new Xx(this),this.cullFace=new Kx(this),this.cullFaceSide=new Zx(this),this.frontFace=new F_(this),this.program=new Qx(this),this.activeTexture=new Jx(this),this.viewport=new B_(this),this.bindFramebuffer=new q2(this),this.bindRenderbuffer=new G2(this),this.bindTexture=new Yf(this),this.bindVertexBuffer=new oM(this),this.bindElementBuffer=new aM(this),this.bindVertexArrayOES=new lM(this),this.pixelStoreUnpack=new cM(this),this.pixelStoreUnpackPremultiplyAlpha=new uM(this),this.pixelStoreUnpackFlipY=new hM(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h,_){return new Ru(this,a,h,_)}createVertexBuffer(a,h,_,E,C){return new _1(this,a,h,_,E,C)}createRenderbuffer(a,h,_){const E=this.gl,C=E.createRenderbuffer();return this.bindRenderbuffer.set(C),E.renderbufferStorage(E.RENDERBUFFER,a,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(a,h,_,E){return new fl(this,a,h,_,E)}clear({color:a,depth:h,stencil:_,colorMask:E}){const C=this.gl;let M=0;a&&(M|=C.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set(E||[!0,!0,!0,!0])),h!==void 0&&(M|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(M|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),C.clear(M)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){s.bn(a.blendFunction,nr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Xm;function X_(y,a,h,_,E,C,M){const j=y.context,H=j.gl,G=y.transform,Y=y.getOrCreateProgram("collisionBox"),ne=[];let ee=0,he=0;for(let We=0;We<_.length;We++){const Ze=_[We],Ye=a.getTile(Ze),Xe=Ye.getBucket(h);if(!Xe)continue;const Ke=vo(Ze,Xe,G);let tt=Ke;E[0]===0&&E[1]===0||(tt=y.translatePosMatrix(Ke,Ye,E,C));const at=M?Xe.textCollisionBox:Xe.iconCollisionBox,At=Xe.collisionCircleArray;if(At.length>0){const xt=s.ad.mat4.create(),Bt=tt;s.ad.mat4.mul(xt,Xe.placementInvProjMatrix,G.glCoordMatrix),s.ad.mat4.mul(xt,xt,Xe.placementViewportMatrix),ne.push({circleArray:At,circleOffset:he,transform:Bt,invTransform:xt,projection:Xe.getProjection()}),ee+=At.length/4,he=ee}at&&(y.terrain&&y.terrain.setupElevationDraw(Ye,Y),Y.draw(y,H.LINES,gn.disabled,Un.disabled,y.colorModeForRenderPass(),qn.disabled,eE(tt,G,Ye,Xe.getProjection()),h.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,G.zoom,null,[at.collisionVertexBuffer,at.collisionVertexBufferExt]))}if(!M||!ne.length)return;const we=y.getOrCreateProgram("collisionCircle"),xe=new s.cW;xe.resize(4*ee),xe._trim();let Ee=0;for(const We of ne)for(let Ze=0;Ze<We.circleArray.length/4;Ze++){const Ye=4*Ze,Xe=We.circleArray[Ye+0],Ke=We.circleArray[Ye+1],tt=We.circleArray[Ye+2],at=We.circleArray[Ye+3];xe.emplace(Ee++,Xe,Ke,tt,at,0),xe.emplace(Ee++,Xe,Ke,tt,at,1),xe.emplace(Ee++,Xe,Ke,tt,at,2),xe.emplace(Ee++,Xe,Ke,tt,at,3)}(!Xm||Xm.length<2*ee)&&(Xm=function(We){const Ze=2*We,Ye=new s.aV;Ye.resize(Ze),Ye._trim();for(let Xe=0;Xe<Ze;Xe++){const Ke=6*Xe;Ye.uint16[Ke+0]=4*Xe+0,Ye.uint16[Ke+1]=4*Xe+1,Ye.uint16[Ke+2]=4*Xe+2,Ye.uint16[Ke+3]=4*Xe+2,Ye.uint16[Ke+4]=4*Xe+3,Ye.uint16[Ke+5]=4*Xe+0}return Ye}(ee));const Ce=j.createIndexBuffer(Xm,!0),je=j.createVertexBuffer(xe,s.cX.members,!0);for(const We of ne){const Ze={u_matrix:We.transform,u_inv_matrix:We.invTransform,u_camera_to_center_distance:($e=G).getCameraToCenterDistance(We.projection),u_viewport_size:[$e.width,$e.height]};we.draw(y,H.TRIANGLES,gn.disabled,Un.disabled,y.colorModeForRenderPass(),qn.disabled,Ze,h.id,je,Ce,s.b8.simpleSegment(0,2*We.circleOffset,We.circleArray.length,We.circleArray.length/2),null,G.zoom)}var $e;je.destroy(),Ce.destroy()}const ep=s.ad.mat4.create();function K_(y){const a=y._camera.getWorldToCamera(y.worldSize,1),h=s.ad.mat4.multiply([],a,y.globeMatrix);s.ad.mat4.invert(h,h);const _=[0,0,0],E=[0,1,0,0];return s.ad.vec4.transformMat4(E,E,h),_[0]=E[0],_[1]=E[1],_[2]=E[2],s.ad.vec3.normalize(_,_),_}function sE({width:y,height:a,anchor:h,textOffset:_,textScale:E},C){const{horizontalAlign:M,verticalAlign:j}=s.bD(h),H=-(M-.5)*y,G=-(j-.5)*a,Y=s.bC(h,_);return new s.P((H/E+Y[0])*C,(G/E+Y[1])*C)}function Rc(y,a,h,_,E,C,M,j,H,G,Y){const ne=y.text.placedSymbolArray,ee=y.text.dynamicLayoutVertexArray,he=y.icon.dynamicLayoutVertexArray,we={},xe=y.getProjection(),Ee=Lo(j,xe,C),Ce=C.elevation,je=xe.upVectorScale(j.canonical,C.center.lat,C.worldSize).metersToTile;ee.clear();for(let $e=0;$e<ne.length;$e++){const We=ne.get($e),{tileAnchorX:Ze,tileAnchorY:Ye,numGlyphs:Xe}=We,Ke=We.hidden||!We.crossTileID||y.allowVerticalPlacement&&!We.placedOrientation?null:_[We.crossTileID];if(Ke){let tt=0,at=0,At=0;if(Ce){const kt=Ce?Ce.getAtTileOffset(j,Ze,Ye):0,[Ut,Rt,Wt]=xe.upVector(j.canonical,Ze,Ye);tt=kt*Ut*je,at=kt*Rt*je,At=kt*Wt*je}let[xt,Bt,zt,Jt]=oa(We.projectedAnchorX+tt,We.projectedAnchorY+at,We.projectedAnchorZ+At,h?Ee:M);const yt=po(C.getCameraToCenterDistance(xe),Jt);let Ft=E.evaluateSizeForFeature(y.textSizeData,G,We)*yt/s.bw;h&&(Ft*=y.tilePixelRatio/H);const gt=sE(Ke,Ft);h?({x:xt,y:Bt,z:zt}=xe.projectTilePoint(Ze+gt.x,Ye+gt.y,j.canonical),[xt,Bt,zt]=oa(xt+tt,Bt+at,zt+At,M)):(a&&gt._rotate(-C.angle),xt+=gt.x,Bt+=gt.y,zt=0);const Lt=y.allowVerticalPlacement&&We.placedOrientation===s.bq.vertical?Math.PI/2:0;for(let kt=0;kt<Xe;kt++)s.bt(ee,xt,Bt,zt,Lt);Y&&We.associatedIconIndex>=0&&(we[We.associatedIconIndex]={x:xt,y:Bt,z:zt,angle:Lt})}else aa(Xe,ee)}if(Y){he.clear();const $e=y.icon.placedSymbolArray;for(let We=0;We<$e.length;We++){const Ze=$e.get(We),{numGlyphs:Ye}=Ze,Xe=we[We];if(Ze.hidden||!Xe)aa(Ye,he);else{const{x:Ke,y:tt,z:at,angle:At}=Xe;for(let xt=0;xt<Ye;xt++)s.bt(he,Ke,tt,at,At)}}y.icon.dynamicLayoutVertexBuffer.updateData(he)}y.text.dynamicLayoutVertexBuffer.updateData(ee)}function Wi(y,a,h,_,E,C,M={}){const j=h.paint.get("icon-translate"),H=h.paint.get("text-translate"),G=h.paint.get("icon-translate-anchor"),Y=h.paint.get("text-translate-anchor"),ne=h.layout.get("icon-rotation-alignment"),ee=h.layout.get("text-rotation-alignment"),he=h.layout.get("icon-pitch-alignment"),we=h.layout.get("text-pitch-alignment"),xe=h.layout.get("icon-keep-upright"),Ee=h.layout.get("text-keep-upright"),Ce=h.paint.get("icon-color-saturation"),je=h.paint.get("icon-color-contrast"),$e=h.paint.get("icon-color-brightness-min"),We=h.paint.get("icon-color-brightness-max"),Ze=h.layout.get("symbol-elevation-reference")==="sea",Ye=y.context,Xe=Ye.gl,Ke=y.transform,tt=ne==="map",at=ee==="map",At=he==="map",xt=we==="map",Bt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let zt=!1;const Jt=y.depthModeForSublayer(0,gn.ReadOnly),yt=[s.av(Ke.center.lng),s.aC(Ke.center.lat)],Ft=h.layout.get("text-variable-anchor"),gt=Ke.projection.name==="globe",Lt=[],kt=[0,-1,0];for(const Ut of _){const Rt=a.getTile(Ut),Wt=Rt.getBucket(h);if(!Wt||Wt.projection.name==="mercator"&&gt||Wt.fullyClipped)continue;const dn=Wt.projection.name==="globe",pn=dn?s.ag(Ke.zoom):0,xn=Lo(Ut,Wt.getProjection(),Ke),kn=Ke.calculatePixelsToTileUnitsMatrix(Rt),gr=Ft&&Wt.hasTextData(),Qn=Wt.hasIconTextFit()&&gr&&Wt.hasIconData(),dr=Wt.getProjection().createInversionMatrix(Ke,Ut.canonical),sr=Ai=>{Ke.depthOcclusionForSymbolsAndCircles&&(h.hasInitialOcclusionOpacityProperties||y.terrain)&&(Ai.push("DEPTH_D24"),Ai.push("DEPTH_OCCLUSION"))},Kr=()=>{const Ai=tt&&h.layout.get("symbol-placement")!=="point",mi=[];sr(mi);const Vs=Ai||Qn,go=h.paint.get("icon-image-cross-fade").constantOr(0);y.terrainRenderModeElevated()&&At&&mi.push("PITCH_WITH_MAP_TERRAIN"),dn&&(mi.push("PROJECTION_GLOBE_VIEW"),Vs&&mi.push("PROJECTED_POS_ON_VIEWPORT")),go>0&&mi.push("ICON_TRANSITION"),Wt.icon.zOffsetVertexBuffer&&mi.push("Z_OFFSET"),Ce===0&&je===0&&$e===0&&We===1||mi.push("COLOR_ADJUSTMENT"),Wt.sdfIcons&&mi.push("RENDER_SDF");const Mo=Wt.icon.programConfigurations.get(h.id),zo=y.getOrCreateProgram("symbol",{config:Mo,defines:mi}),dc=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],Wa=Wt.iconSizeData,di=s.bp(Wa,Ke.zoom),bs=At||Ke.pitch!==0,bi=sa(xn,Rt.tileID.canonical,At,tt,Ke,Wt.getProjection(),kn),Ui=us(xn,Rt.tileID.canonical,At,tt,Ke,Wt.getProjection(),kn),ua=y.translatePosMatrix(Ui,Rt,j,G,!0),ps=y.translatePosMatrix(xn,Rt,j,G),Po=Vs?ep:bi,Du=tt&&!At&&!Ai;let zl=kt;!gt&&!Ke.mercatorFromTransition||tt||(zl=K_(Ke));const Dc=dn?zl:kt,ml=h.getColorAdjustmentMatrix(Ce,je,$e,We),kc=G_(Wa.kind,di,Du,At,y,ps,Po,ua,Ze,!1,dc,[0,0],!0,Ut,pn,yt,dr,Dc,Wt.getProjection(),ml,go),jl=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,lh=h.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear,ku=Wt.sdfIcons||y.options.rotating||y.options.zooming||lh||bs?Xe.LINEAR:Xe.NEAREST,ch=Wt.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,H1=y.terrain&&At&&Ai?s.ad.mat4.invert(s.ad.mat4.create(),bi):ep;if(Ai&&Wt.icon){const pp=Ke.elevation,p0=pp?pp.getAtTileOffsetFunc(Ut,Ke.center.lat,Ke.worldSize,Wt.getProjection()):null,W1=Ci(xn,Rt.tileID.canonical,At,tt,Ke,Wt.getProjection(),kn);Cc(Wt,xn,y,!1,W1,Ui,At,xe,p0,Ut)}return{program:zo,buffers:Wt.icon,uniformValues:kc,atlasTexture:jl,atlasTextureIcon:null,atlasInterpolation:ku,atlasInterpolationIcon:null,isSDF:Wt.sdfIcons,hasHalo:ch,tile:Rt,labelPlaneMatrixInv:H1}},vi=()=>{const Ai=at&&h.layout.get("symbol-placement")!=="point",mi=[],Vs=Ai||Ft||Qn;y.terrainRenderModeElevated()&&xt&&mi.push("PITCH_WITH_MAP_TERRAIN"),dn&&(mi.push("PROJECTION_GLOBE_VIEW"),Vs&&mi.push("PROJECTED_POS_ON_VIEWPORT")),Wt.text.zOffsetVertexBuffer&&mi.push("Z_OFFSET"),Wt.iconsInText&&mi.push("RENDER_TEXT_AND_SYMBOL"),mi.push("RENDER_SDF"),sr(mi);const go=Wt.text.programConfigurations.get(h.id),Mo=y.getOrCreateProgram("symbol",{config:go,defines:mi});let zo,dc=[0,0],Wa=null;const di=Wt.textSizeData;Wt.iconsInText&&(dc=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],Wa=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,zo=xt||Ke.pitch!==0||y.options.rotating||y.options.zooming||di.kind==="composite"||di.kind==="camera"?Xe.LINEAR:Xe.NEAREST);const bs=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture.size:[0,0],bi=h.layout.get("text-size-scale-range"),Ui=s.ay(y.scaleFactor,bi[0],bi[1]),ua=s.bp(di,Ke.zoom,Ui),ps=sa(xn,Rt.tileID.canonical,xt,at,Ke,Wt.getProjection(),kn),Po=us(xn,Rt.tileID.canonical,xt,at,Ke,Wt.getProjection(),kn),Du=y.translatePosMatrix(Po,Rt,H,Y,!0),zl=y.translatePosMatrix(xn,Rt,H,Y),Dc=Vs?ep:ps,ml=at&&!xt&&!Ai;let kc=kt;!gt&&!Ke.mercatorFromTransition||at||(kc=K_(Ke));const jl=G_(di.kind,ua,ml,xt,y,zl,Dc,Du,Ze,!0,bs,dc,!0,Ut,pn,yt,dr,dn?kc:kt,Wt.getProjection(),null,null,Ui),lh=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture:null,ku=Xe.LINEAR,ch=h.paint.get("text-halo-width").constantOr(1)!==0,H1=y.terrain&&xt&&Ai?s.ad.mat4.invert(s.ad.mat4.create(),ps):ep;if(Ai&&Wt.text){const pp=Ke.elevation,p0=pp?pp.getAtTileOffsetFunc(Ut,Ke.center.lat,Ke.worldSize,Wt.getProjection()):null,W1=Ci(xn,Rt.tileID.canonical,xt,at,Ke,Wt.getProjection(),kn);Cc(Wt,xn,y,!0,W1,Po,xt,Ee,p0,Ut)}return{program:Mo,buffers:Wt.text,uniformValues:jl,atlasTexture:lh,atlasTextureIcon:Wa,atlasInterpolation:ku,atlasInterpolationIcon:zo,isSDF:!0,hasHalo:ch,tile:Rt,labelPlaneMatrixInv:H1}},Zi=Wt.icon.segments.get().length,Br=Wt.text.segments.get().length,vs=Zi&&!M.onlyText?Kr():null,yr=Br&&!M.onlyIcons?vi():null,Nn=h.paint.get("icon-opacity").constantOr(1),ei=h.paint.get("text-opacity").constantOr(1);if(Bt&&Wt.canOverlap){zt=!0;const Ai=Nn&&!M.onlyText?Wt.icon.segments.get():[],mi=ei&&!M.onlyIcons?Wt.text.segments.get():[];for(const Vs of Ai)Lt.push({segments:new s.b8([Vs]),sortKey:Vs.sortKey,state:vs});for(const Vs of mi)Lt.push({segments:new s.b8([Vs]),sortKey:Vs.sortKey,state:yr})}else M.onlyText||Lt.push({segments:Nn?Wt.icon.segments:new s.b8([]),sortKey:0,state:vs}),M.onlyIcons||Lt.push({segments:ei?Wt.text.segments:new s.b8([]),sortKey:0,state:yr})}zt&&Lt.sort((Ut,Rt)=>Ut.sortKey-Rt.sortKey);for(const Ut of Lt){const Rt=Ut.state;if(Rt)if(y.terrain?y.terrain.setupElevationDraw(Rt.tile,Rt.program,{useDepthForOcclusion:Ke.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Rt.labelPlaneMatrixInv}):y.setupDepthForOcclusion(Ke.depthOcclusionForSymbolsAndCircles,Rt.program),Ye.activeTexture.set(Xe.TEXTURE0),Rt.atlasTexture&&Rt.atlasTexture.bind(Rt.atlasInterpolation,Xe.CLAMP_TO_EDGE,!0),Rt.atlasTextureIcon&&(Ye.activeTexture.set(Xe.TEXTURE1),Rt.atlasTextureIcon&&Rt.atlasTextureIcon.bind(Rt.atlasInterpolationIcon,Xe.CLAMP_TO_EDGE,!0)),y.uploadCommonLightUniforms(y.context,Rt.program),Rt.hasHalo){const Wt=Rt.uniformValues;Wt.u_is_halo=1,tp(Rt.buffers,Ut.segments,h,y,Rt.program,Jt,E,C,Wt,2),Wt.u_is_halo=0}else{if(Rt.isSDF){const Wt=Rt.uniformValues;Rt.hasHalo&&(Wt.u_is_halo=1,tp(Rt.buffers,Ut.segments,h,y,Rt.program,Jt,E,C,Wt,1)),Wt.u_is_halo=0}tp(Rt.buffers,Ut.segments,h,y,Rt.program,Jt,E,C,Rt.uniformValues,1)}}}function tp(y,a,h,_,E,C,M,j,H,G){const Y=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.iconTransitioningVertexBuffer,y.globeExtVertexBuffer,y.zOffsetVertexBuffer];E.draw(_,_.context.gl.TRIANGLES,C,M,j,qn.disabled,H,h.id,y.layoutVertexBuffer,y.indexBuffer,a,h.paint,_.transform.zoom,y.programConfigurations.get(h.id),Y,G)}function y1(y,a){const h=1<<y.canonical.z,_=(a.x*h-y.canonical.x-y.wrap*h)*s.ai,E=(a.y*h-y.canonical.y)*s.ai,C=s.d5(a.z,a.y);return s.ad.vec3.fromValues(_,E,C)}function x1(y,a,h,_,E){if(!h.layout||h.layout.get("fill-elevation-reference")==="none")return;const C=y.context.gl,M=new gn(y.context.gl.LEQUAL,gn.ReadWrite,y.depthRangeFor3D),j=new gn(y.context.gl.GREATER,gn.ReadWrite,y.depthRangeFor3D),H=function(he){const we=s.c4(he.pitch);let xe=.01;return he.isOrthographic&&(xe=s.ah(1e-4,xe,s.c9(we>=sn?1:we/sn))),2*xe}(y.transform),G=y.transform.getFreeCameraOptions().position,Y="elevatedStructuresDepthReconstruct",ne=y.getOrCreateProgram(Y,{defines:["DEPTH_RECONSTRUCTION"]}),ee=y.getOrCreateProgram(Y);for(const he of _){const we=a.getTile(he),xe=we.getBucket(h);if(!xe)continue;const Ee=xe.elevatedStructures;if(!Ee)continue;const Ce=xe.elevationBufferData.heightRange,je=y1(he.toUnwrapped(),G),$e=y.translatePosMatrix(he.projMatrix,we,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let We,Ze,Ye,Xe;if(E==="initialize"){if(!Ce||Ce.min>=1||Ee.depthSegments.segments[0].primitiveLength===0)continue;We=Ym($e,je,H,1,0),Ze=M,Ye=Ee.depthSegments,Xe=ne}else if(E==="reset"){if(!Ce||Ce.min>=0||Ee.maskSegments.segments[0].primitiveLength===0)continue;We=Ym($e,je,0,0,1),Ze=j,Ye=Ee.maskSegments,Xe=ne}else if(E==="geometry"){if(Ee.depthSegments.segments[0].primitiveLength===0)continue;We=Ym($e,je,H,1,0),Ze=M,Ye=Ee.depthSegments,Xe=ee}Xe.draw(y,C.TRIANGLES,Ze,Un.disabled,nr.disabled,qn.disabled,We,h.id,Ee.vertexBuffer,Ee.indexBuffer,Ye,h.paint,y.transform.zoom)}}function Z_(y,a,h){const{painter:_,sourceCache:E,layer:C,coords:M,colorMode:j,elevationType:H,terrainEnabled:G,pass:Y}=y,ne=_.context.gl,ee=C.paint.get("fill-pattern");let he=H;H!=="road"||a&&!G||(he="none");const we=he==="road",xe=new gn(_.context.gl.LEQUAL,gn.ReadWrite,_.depthRangeFor3D),Ee=ee&&ee.constantOr(1),Ce=(je,$e)=>{let We,Ze,Ye,Xe,Ke;$e?(Ze=Ee&&!C.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",We=ne.LINES):(Ze=Ee?"fillPattern":"fill",We=ne.TRIANGLES);for(const tt of M){const at=E.getTile(tt);if(Ee&&!at.patternsLoaded())continue;const At=at.getBucket(C);if(!At)continue;const xt=a?At.elevationBufferData:At.bufferData;if(xt.isEmpty())continue;_.prepareDrawTile();const Bt=xt.programConfigurations.get(C.id),zt=_.isTileAffectedByFog(tt),Jt=[],yt=[];we&&(Jt.push("ELEVATED_ROADS"),yt.push(xt.elevatedLayoutVertexBuffer));const Ft=_.getOrCreateProgram(Ze,{config:Bt,overrideFog:zt,defines:Jt});Ee&&(_.context.activeTexture.set(ne.TEXTURE0),at.imageAtlasTexture&&at.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Bt.updatePaintBuffers());const gt=ee.constantOr(null);if(gt&&at.imageAtlas){const Ut=at.imageAtlas,Rt=s.d0.from(gt).getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Wt=Ut.patternPositions.get(Rt);Wt&&Bt.setConstantPatternPositions(Wt)}const Lt=_.translatePosMatrix(tt.projMatrix,at,C.paint.get("fill-translate"),C.paint.get("fill-translate-anchor")),kt=C.paint.get("fill-emissive-strength");if($e){Xe=xt.lineIndexBuffer,Ke=xt.lineSegments;const Ut=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[ne.drawingBufferWidth,ne.drawingBufferHeight];Ye=Ze==="fillOutlinePattern"&&Ee?$_(Lt,kt,_,at,Ut):W_(Lt,kt,Ut)}else Xe=xt.indexBuffer,Ke=xt.triangleSegments,Ye=Ee?c1(Lt,kt,_,at):Qf(Lt,kt);_.uploadCommonUniforms(_.context,Ft,tt.toUnwrapped()),Ft.draw(_,We,he!=="none"?xe:je,h||_.stencilModeForClipping(tt),j,qn.disabled,Ye,C.id,xt.layoutVertexBuffer,Xe,Ke,C.paint,_.transform.zoom,Bt,yt)}};_.renderPass===Y&&Ce(_.depthModeForSublayer(1,_.renderPass==="opaque"?gn.ReadWrite:gn.ReadOnly),!1),he==="none"&&_.renderPass==="translucent"&&C.paint.get("fill-antialias")&&Ce(_.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,gn.ReadOnly),!0)}function Km(y,a,h,_,E,C,M,j){h.resetLayerRenderingStats(y);const H=y.context,G=H.gl,Y=y.transform,ne=h.paint.get("fill-extrusion-pattern"),ee=ne.constantOr(1),he=h.paint.get("fill-extrusion-opacity"),we=y.style.enable3dLights(),xe=h.paint.get(we&&!ee?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ee=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),xe],Ce=h.layout.get("fill-extrusion-edge-radius"),je=Ce>0&&!h.paint.get("fill-extrusion-rounded-roof"),$e=je?0:Ce,We=Y.projection.name==="globe"?s.d6():0,Ze=Y.projection.name==="globe",Ye=Ze?s.ag(Y.zoom):0,Xe=[s.av(Y.center.lng),s.aC(Y.center.lat)],Ke=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",tt=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ke?null:h.lut).toArray01().slice(0,3),at=h.paint.get("fill-extrusion-flood-light-intensity"),At=h.paint.get("fill-extrusion-vertical-scale"),xt=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Bt=h.paint.get("fill-extrusion-height-alignment"),zt=h.paint.get("fill-extrusion-base-alignment"),Jt=Nl(y,h.paint.get("fill-extrusion-cutoff-fade-range")),yt=[];let Ft;Ze&&yt.push("PROJECTION_GLOBE_VIEW"),Ee[0]>0&&yt.push("FAUX_AO"),je&&yt.push("ZERO_ROOF_RADIUS"),j&&yt.push("HAS_CENTROID"),at>0&&yt.push("FLOOD_LIGHT"),Jt.shouldRenderCutoff&&yt.push("RENDER_CUTOFF"),xt&&yt.push("RENDER_WALL_MODE");const gt=y.renderPass==="shadow",Lt=y.shadowRenderer,kt=gt&&!!Lt;y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0);let Ut=[0,0,0];if(Lt){const dn=y.style.directionalLight,pn=y.style.ambientLight;dn&&pn&&(Ut=V(y.style,dn,pn)),gt||(yt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Lt.useNormalOffset&&yt.push("NORMAL_OFFSET")),Ft=yt.concat(["SHADOWS_SINGLE_CASCADE"])}const Rt=kt?"fillExtrusionDepth":ee?"fillExtrusionPattern":"fillExtrusion",Wt=h.getLayerRenderingStats();for(const dn of _){const pn=a.getTile(dn),xn=pn.getBucket(h);if(!xn||xn.projection.name!==Y.projection.name)continue;let kn=!1;Lt&&(kn=Lt.getMaxCascadeForTile(dn.toUnwrapped())===0);const gr=y.isTileAffectedByFog(dn),Qn=xn.programConfigurations.get(h.id),dr=y.getOrCreateProgram(Rt,{config:Qn,defines:kn?Ft:yt,overrideFog:gr});if(y.terrain&&y.terrain.setupElevationDraw(pn,dr,{useMeterToDem:!0}),!xn.centroidVertexBuffer){const yr=dr.attributes.a_centroid_pos;yr!==void 0&&G.vertexAttrib2f(yr,0,0)}!gt&&Lt&&Lt.setupShadows(pn.tileID.toUnwrapped(),dr,"vector-tile",pn.tileID.overscaledZ),ee&&(y.context.activeTexture.set(G.TEXTURE0),pn.imageAtlasTexture&&pn.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Qn.updatePaintBuffers());const sr=ne.constantOr(null);if(sr&&pn.imageAtlas){const yr=pn.imageAtlas,Nn=s.d0.from(sr).getPrimary().scaleSelf(s.q.devicePixelRatio),ei=yr.patternPositions.get(Nn.toString());ei&&Qn.setConstantPatternPositions(ei)}const Kr=h.paint.get("fill-extrusion-vertical-gradient"),vi=1/xn.tileToMeter;let Zi;if(gt&&Lt){if(sp(pn.tileID,xn,y))continue;const yr=Lt.calculateShadowPassMatrixFromTile(pn.tileID.toUnwrapped());Zi=Zf(yr,$e,vi,At,Bt,zt)}else{const yr=y.translatePosMatrix(dn.expandedProjMatrix,pn,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Nn=Y.projection.createInversionMatrix(Y,dn.canonical);Zi=ee?l1(yr,y,Kr,he,Ee,$e,vi,dn,pn,We,Bt,zt,Ye,Xe,Nn,tt,At):H_(yr,y,Kr,he,Ee,$e,vi,dn,We,Bt,zt,Ye,Xe,Nn,tt,At,at,Ut)}y.uploadCommonUniforms(H,dr,dn.toUnwrapped(),null,Jt);let Br=xn.segments;if(Y.projection.name==="mercator"&&!gt&&(Br=xn.getVisibleSegments(pn.tileID,y.terrain,y.transform.getFrustum(0)),!Br.get().length))continue;if(Wt)if(gt)for(const yr of Br.get())Wt.numRenderedVerticesInShadowPass+=yr.primitiveLength;else for(const yr of Br.get())Wt.numRenderedVerticesInTransparentPass+=yr.primitiveLength;const vs=[];(y.terrain||j)&&vs.push(xn.centroidVertexBuffer),Ze&&vs.push(xn.layoutVertexExtBuffer),xt&&vs.push(xn.wallVertexBuffer),dr.draw(y,H.gl.TRIANGLES,E,C,M,qn.backCCW,Zi,h.id,xn.layoutVertexBuffer,xn.indexBuffer,Br,h.paint,y.transform.zoom,Qn,vs)}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1)}function np(y,a,h,_,E,C,M,j,H,G,Y,ne,ee,he,we,xe,Ee,Ce,je){const $e=y.context,We=$e.gl,Ze=y.transform,Ye=y.transform.zoom,Xe=[],Ke=Nl(y,h.paint.get("fill-extrusion-cutoff-fade-range"));G==="clear"?(Xe.push("CLEAR_SUBPASS"),je&&(Xe.push("CLEAR_FROM_TEXTURE"),$e.activeTexture.set(We.TEXTURE0),je.bind(We.LINEAR,We.CLAMP_TO_EDGE))):G==="sdf"&&Xe.push("SDF_SUBPASS"),Ee&&Xe.push("HAS_CENTROID"),Ke.shouldRenderCutoff&&Xe.push("RENDER_CUTOFF");const tt=h.layout.get("fill-extrusion-edge-radius"),at=(At,xt,Bt,zt,Jt)=>{const yt=xt.programConfigurations.get(h.id),Ft=y.isTileAffectedByFog(At),gt=y.getOrCreateProgram("fillExtrusionGroundEffect",{config:yt,defines:Xe,overrideFog:Ft}),Lt=((Ut,Rt,Wt,dn,pn,xn,kn,gr,Qn,dr,sr)=>({u_matrix:Rt,u_opacity:Wt,u_ao_pass:dn?1:0,u_meter_to_tile:pn,u_ao:xn,u_flood_light_intensity:kn,u_flood_light_color:gr,u_attenuation:Qn,u_edge_radius:dr,u_fb:0,u_fb_size:sr,u_dynamic_offset:1}))(0,zt,Y,H,Jt,[ne,ee*Jt],he,we,xe,Ye>=17?0:tt*Jt,je?je.size[0]:0),kt=[];Ee&&kt.push(xt.hiddenByLandmarkVertexBuffer),y.uploadCommonUniforms($e,gt,At.toUnwrapped(),null,Ke),gt.draw(y,$e.gl.TRIANGLES,E,C,M,j,Lt,h.id,xt.vertexBuffer,xt.indexBuffer,Bt,h.paint,Ye,yt,kt)};for(const At of _){const xt=a.getTile(At),Bt=xt.getBucket(h);if(!Bt||Bt.projection.name!==Ze.projection.name||!Bt.groundEffect||Bt.groundEffect&&!Bt.groundEffect.hasData())continue;const zt=Bt.groundEffect,Jt=1/Bt.tileToMeter;{const yt=y.translatePosMatrix(At.projMatrix,xt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ft=zt.getDefaultSegment();at(At,zt,Ft,yt,Jt)}if(Ce)for(let yt=0;yt<4;yt++){const Ft=s.d7[yt](At),gt=a.getTile(Ft);if(!gt)continue;const Lt=gt.getBucket(h);if(!Lt||Lt.projection.name!==Ze.projection.name||!Lt.groundEffect||Lt.groundEffect&&!Lt.groundEffect.hasData())continue;const kt=Lt.groundEffect;let Ut,Rt;yt===0?(Ut=[-s.ai,0,0],Rt=1):yt===1?(Ut=[s.ai,0,0],Rt=0):yt===2?(Ut=[0,-s.ai,0],Rt=3):(Ut=[0,s.ai,0],Rt=2);const Wt=kt.regionSegments[Rt];if(!Wt)continue;const dn=new Float32Array(16);s.ad.mat4.translate(dn,At.projMatrix,Ut),at(At,kt,Wt,y.translatePosMatrix(dn,xt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Jt)}}}function rp(y,a,h,_,E,C,M){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const j=C?C.findDEMTileFor(h):null;if(!(j&&j.dem||M))return;C&&j&&j.dem&&_.selfDEMTileTimestamp!==j.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=j.dem._timestamp);const H=Ce=>new s.P(Math.ceil((Ce+s.da)*s.db),0),G=Ce=>{const je=a.getSource().minzoom,$e=Ze=>{const Ye=a.getTileByID(Ze);if(Ye&&Ye.hasData())return Ye.getBucket(E)},We=[0,-1,1];for(const Ze of We){if(Ce.overscaledZ+Ze<je)continue;const Ye=$e(Ce.calculateScaledKey(Ce.overscaledZ+Ze));if(Ye)return Ye}},Y=[0,0,0],ne=(Ce,je)=>(Y[0]=Math.min(Ce.min.y,je.min.y),Y[1]=Math.max(Ce.max.y,je.max.y),Y[2]=s.ai-je.min.x>Ce.max.x?je.min.x-s.ai:Ce.max.x,Y),ee=(Ce,je)=>(Y[0]=Math.min(Ce.min.x,je.min.x),Y[1]=Math.max(Ce.max.x,je.max.x),Y[2]=s.ai-je.min.y>Ce.max.y?je.min.y-s.ai:Ce.max.y,Y),he=[(Ce,je)=>ne(Ce,je),(Ce,je)=>ne(je,Ce),(Ce,je)=>ee(Ce,je),(Ce,je)=>ee(je,Ce)],we=(Ce,je,$e,We,Ze,Ye,Xe)=>{if(!C)return 0;const Ke=[[Ye?$e:Ce,Ye?Ce:$e,0],[Ye?$e:je,Ye?je:$e,0]],tt=Xe<0?s.ai+Xe:Xe,at=[Ye?tt:(Ce+je)/2,Ye?(Ce+je)/2:tt,0];return $e===0&&Xe<0||$e!==0&&Xe>0?C.getForTilePoints(Ze,[at],!0,We):Ke.push(at),C.getForTilePoints(h,Ke,!0,j),Math.max(Ke[0][2],Ke[1][2],at[2])/C.exaggeration()};for(let Ce=0;Ce<4;Ce++){const je=_.borderFeatureIndices[Ce];if(je.length===0)continue;const $e=s.d7[Ce](h),We=G($e);if(!(We&&We instanceof s.d8))continue;const Ze=C?C.findDEMTileFor($e):null;if(!(Ze&&Ze.dem||M)||(C&&Ze&&Ze.dem&&_.borderDEMTileTimestamp[Ce]!==Ze.dem._timestamp&&(_.borderDoneWithNeighborZ[Ce]=-1,_.borderDEMTileTimestamp[Ce]=Ze.dem._timestamp),_.borderDoneWithNeighborZ[Ce]===We.canonical.z))continue;We.centroidVertexArray.length===0&&We.createCentroidsBuffer();const Ye=(Ce<2?1:5)-Ce,Xe=We.borderDoneWithNeighborZ[Ye]!==_.canonical.z,Ke=We.borderFeatureIndices[Ye];let tt=0;if(_.canonical.z!==We.canonical.z){for(const at of je)_.showCentroid(_.featuresOnBorder[at]);if(Xe)for(const at of Ke)We.showCentroid(We.featuresOnBorder[at]);_.borderDoneWithNeighborZ[Ce]=We.canonical.z,We.borderDoneWithNeighborZ[Ye]=_.canonical.z}for(const at of je){const At=_.featuresOnBorder[at],xt=_.centroidData[At.centroidDataIndex],Bt=At.borders[Ce];let zt;for(;tt<Ke.length;){zt=We.featuresOnBorder[Ke[tt]];const Jt=zt.borders[Ye];if(Jt[1]>Bt[0]+3||Jt[0]>Bt[0]-3)break;We.showCentroid(zt),tt++}if(zt&&tt<Ke.length){const Jt=tt;let yt=0;for(;!(zt.borders[Ye][0]>Bt[1]-3)&&(yt++,++tt!==Ke.length);)zt=We.featuresOnBorder[Ke[tt]];zt=We.featuresOnBorder[Ke[Jt]];let Ft=!1;if(yt>=1){const kt=zt.borders[Ye];Math.abs(Bt[0]-kt[0])<3&&Math.abs(Bt[1]-kt[1])<3&&(yt=1,Ft=!0,tt=Jt+1)}else if(yt===0){_.showCentroid(At);continue}const gt=We.centroidData[zt.centroidDataIndex];M&&Ft&&(((xe=xt).flags|(Ee=gt).flags)&s.d9?(xe.flags|=s.d9,Ee.flags|=s.d9):(xe.flags&=~s.d9,Ee.flags&=~s.d9));const Lt=At.intersectsCount()>1||zt.intersectsCount()>1;if(yt>1)tt=Jt,xt.centroidXY=gt.centroidXY=new s.P(0,0);else if(Ze&&Ze.dem&&!Lt){const kt=he[Ce](xt,gt),Ut=Ce%2?s.ai-1:0,Rt=we(kt[0],Math.min(s.ai-1,kt[1]),Ut,Ze,$e,Ce<2,kt[2]);xt.centroidXY=gt.centroidXY=H(Rt)}else Lt?xt.centroidXY=gt.centroidXY=new s.P(0,0):(xt.centroidXY=_.encodeBorderCentroid(At),gt.centroidXY=We.encodeBorderCentroid(zt));_.writeCentroidToBuffer(xt),We.writeCentroidToBuffer(gt)}else _.showCentroid(At)}_.borderDoneWithNeighborZ[Ce]=We.canonical.z,We.borderDoneWithNeighborZ[Ye]=_.canonical.z}var xe,Ee;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(y)}const ip=[1,0,0],on=[0,1,0],Sn=[0,0,1];function sp(y,a,h){const _=h.transform,E=h.shadowRenderer;if(!E)return!0;const C=y.toUnwrapped(),M=_.tileSize*E._cascades[h.currentShadowCascade].scale;let j=a.maxHeight;if(_.elevation){const xe=_.elevation.getMinMaxForTile(y);xe&&(j+=xe.max)}const H=[...E.shadowDirection];H[2]=-H[2];const G=E.computeSimplifiedTileShadowVolume(C,j,M,H);if(!G)return!1;const Y=[ip,on,Sn,H,[H[0],0,H[2]],[0,H[1],H[2]]],ne=_.projection.name==="globe",ee=_.scaleZoom(M),he=s.bR.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,ee,!ne),we=E.getCurrentCascadeFrustum();return he.intersectsPrecise(G.vertices,G.planes,Y)===0||we.intersectsPrecise(G.vertices,G.planes,Y)===0}function Ds(y){return[y[0]*s.dc,y[1]*s.dc,y[2]*s.dc,0]}function St(y,a,h,_,E,C,M,j,H){const G=_.getSource(),Y=h.globeSharedBuffers;if(!Y)return;let ne,ee,he;if(a&&(ne=_.getTile(a)),G instanceof s.aK?(ee=G.texture,he=s.cJ(0,0,h.transform)):ne&&a&&(ee=ne.texture,he=s.cJ(a.canonical.z,a.canonical.x,h.transform)),!ee||!he)return;y||(he=s.ad.mat4.scale(s.ad.mat4.create(),he,[1,-1,1]));const we=h.context,xe=we.gl,Ee=E.paint.get("raster-resampling")==="nearest"?xe.NEAREST:xe.LINEAR,Ce=h.colorModeForDrapableLayerRenderPass(C),je=M.defines;je.push("GLOBE_POLES");const $e=new gn(xe.LEQUAL,gn.ReadWrite,h.depthRangeFor3D),We=Float32Array.from(h.transform.expandedFarZProjMatrix),Ze=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),we.activeTexture.set(xe.TEXTURE0),ee.bind(Ee,xe.CLAMP_TO_EDGE),we.activeTexture.set(xe.TEXTURE1),ee.bind(Ee,xe.CLAMP_TO_EDGE),"useMipmap"in ee&&we.extTextureFilterAnisotropic&&h.transform.pitch>20&&xe.texParameterf(xe.TEXTURE_2D,we.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,we.extTextureFilterAnisotropicMax);const[Ye,Xe,Ke,tt]=a?Y.getPoleBuffers(a.canonical.z,!1):Y.getPoleBuffers(0,!0),at=E.paint.get("raster-elevation");let At;y?(At=Ye,h.renderDefaultNorthPole=at!==0):(At=Xe,h.renderDefaultSouthPole=at!==0);const xt=Ds(M.mix),Bt=((Jt,yt,Ft,gt,Lt,kt,Ut,Rt,Wt,dn,pn,xn,kn)=>h1(Jt,yt,Ft,new Float32Array(16),new Float32Array(9),[0,0],gt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},kt,[0,0],Rt,2,dn,pn,xn,1,0,kn))(We,Ze,he,s.ag(h.transform.zoom),0,E,0,at,0,xt,M.offset,M.range,C),zt=h.getOrCreateProgram("raster",{defines:je});h.uploadCommonUniforms(we,zt,null),zt.draw(h,xe.TRIANGLES,$e,H,Ce,j,Bt,E.id,At,Ke,tt)}function oE(y){const a=y._nearZ,h=y.projection.farthestPixelDistance(y),_=h-a,E=.2*y.height,C=a+E;return[a,h,(C-E-a)/_,(C-a)/_]}function Q_(y,a,h,_){if(y)return a instanceof xa&&y instanceof mr?a.getTextureDescriptor(y,h,!0):{texture:y.texture,mix:Ds(_.mix),offset:_.offset,buffer:0,tileSize:1}}var v1=s.dd([{name:"a_index",type:"Int16",components:1}]);class b1{constructor(a,h,_,E){const C={width:_[0],height:_[1],data:null},M=a.gl;this.targetColorTexture=new s.T(a,C,M.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(a,C,M.RGBA8,{useMipmap:!1}),this.context=a,this.updateParticleTexture(h,E),this.lastInvalidatedAt=0}updateParticleTexture(a,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,E=h.width*h.height;this.particleTexture0=new s.T(this.context,h,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,h,_.RGBA8,{premultiply:!1,useMipmap:!1});const C=new s.de;C.reserve(E);for(let M=0;M<E;M++)C.emplaceBack(M);this.particleIndexBuffer=this.context.createVertexBuffer(C,v1.members,!0),this.particleSegment=s.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function aE(y,a,h){if(!y)return null;const _=a.getTextureDescriptor(y,h,!0);if(!_)return null;let{texture:E,mix:C,offset:M,tileSize:j,buffer:H,format:G}=_;if(!E||!G)return null;let Y=!1;return G==="uint32"&&(Y=!0,C[3]=0,C=Tn(s.df,C,[0,h.paint.get("raster-particle-max-speed")]),M=u1(s.df,M,[0,h.paint.get("raster-particle-max-speed")])),{texture:E,textureOffset:[H/(j+2*H),j/(j+2*H)],tileSize:j,scalarData:Y,scale:C,offset:M,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function lE(y){const a=y._nearZ,h=y.projection.farthestPixelDistance(y),_=h-a,E=.2*y.height,C=a+E;return[a,h,(C-E-a)/_,(C-a)/_]}const op=new s.al(1,0,0,1),pM=new s.al(0,1,0,1),mM=new s.al(0,0,1,1),cE=new s.al(1,0,1,1),J_=new s.al(0,1,1,1);function Kh(y,a,h,_,E,C,M){const j=y.context,H=y.transform,G=j.gl,Y=H.projection.name==="globe",ne=Y?["PROJECTION_GLOBE_VIEW"]:[];let ee=s.ad.mat4.clone(h.projMatrix);if(Y&&s.ag(H.zoom)>0){const xt=s.bb(h.canonical,H),Bt=s.dg(xt);ee=s.ad.mat4.multiply(new Float32Array(16),H.globeMatrix,Bt),s.ad.mat4.multiply(ee,H.projMatrix,ee)}const he=s.ad.mat4.create();he[12]+=2*E/(s.q.devicePixelRatio*H.width),he[13]+=2*C/(s.q.devicePixelRatio*H.height),s.ad.mat4.multiply(ee,he,ee);const we=y.getOrCreateProgram("debug",{defines:ne}),xe=a.getTileByID(h.key);y.terrain&&y.terrain.setupElevationDraw(xe,we);const Ee=gn.disabled,Ce=Un.disabled,je=y.colorModeForRenderPass(),$e="$debug";j.activeTexture.set(G.TEXTURE0),y.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Y?xe._makeGlobeTileDebugBuffers(y.context,H):xe._makeDebugTileBoundsBuffers(y.context,H.projection);const We=xe._tileDebugBuffer||y.debugBuffer,Ze=xe._tileDebugIndexBuffer||y.debugIndexBuffer,Ye=xe._tileDebugSegments||y.debugSegments;if(we.draw(y,G.LINE_STRIP,Ee,Ce,je,qn.disabled,tE(ee,_),$e,We,Ze,Ye,null,null,null,[xe._globeTileDebugBorderBuffer]),M){const xt=xe.latestRawTileData,Bt=Math.floor((xt&&xt.byteLength||0)/1024);let zt=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(zt+=` => ${h.overscaledZ}`),zt+=` ${xe.state}`,zt+=` ${Bt}kb`,function(Jt,yt){Jt.initDebugOverlayCanvas();const Ft=Jt.debugOverlayCanvas,gt=Jt.context.gl,Lt=Jt.debugOverlayCanvas.getContext("2d");Lt.clearRect(0,0,Ft.width,Ft.height),Lt.shadowColor="white",Lt.shadowBlur=2,Lt.lineWidth=1.5,Lt.strokeStyle="white",Lt.textBaseline="top",Lt.font="bold 36px Open Sans, sans-serif",Lt.fillText(yt,5,5),Lt.strokeText(yt,5,5),Jt.debugOverlayTexture.update(Ft),Jt.debugOverlayTexture.bind(gt.LINEAR,gt.CLAMP_TO_EDGE)}(y,zt)}const Xe=a.getTile(h).tileSize,Ke=512/Math.min(Xe,512)*(h.overscaledZ/H.zoom)*.5,tt=xe._tileDebugTextBuffer||y.debugBuffer,at=xe._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,At=xe._tileDebugTextSegments||y.debugSegments;we.draw(y,G.TRIANGLES,Ee,Ce,nr.alphaBlended,qn.disabled,tE(ee,s.al.transparent,Ke),$e,tt,at,At,null,null,null,[xe._globeTileDebugTextBuffer])}function w1(y,a,h,_){Ud(y,0,a+h/2,y.transform.width,h,_)}function E1(y,a,h,_){Ud(y,a-h/2,0,h,y.transform.height,_)}function Ud(y,a,h,_,E,C){const M=y.context,j=M.gl;j.enable(j.SCISSOR_TEST),j.scissor(a*s.q.devicePixelRatio,h*s.q.devicePixelRatio,_*s.q.devicePixelRatio,E*s.q.devicePixelRatio),M.clear({color:C}),j.disable(j.SCISSOR_TEST)}const e0=s.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ap}=e0;function ih(y,a,h,_){y.emplaceBack(a,h,_)}class uE{constructor(a){this.vertexArray=new s.dh,this.indices=new s.aV,ih(this.vertexArray,-1,-1,1),ih(this.vertexArray,1,-1,1),ih(this.vertexArray,-1,1,1),ih(this.vertexArray,1,1,1),ih(this.vertexArray,-1,-1,-1),ih(this.vertexArray,1,-1,-1),ih(this.vertexArray,-1,1,-1),ih(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,ap),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=s.b8.simpleSegment(0,0,36,12)}}function Qo(y,a,h,_,E,C){const M=y.context.gl,j=a.paint.get("sky-atmosphere-color"),H=a.paint.get("sky-atmosphere-halo-color"),G=a.paint.get("sky-atmosphere-sun-intensity"),Y=((ne,ee,he,we,xe)=>({u_matrix_3f:ne,u_sun_direction:ee,u_sun_intensity:he,u_color_tint_r:[we.r,we.g,we.b,we.a],u_color_tint_m:[xe.r,xe.g,xe.b,xe.a],u_luminance:5e-5}))(s.ad.mat3.fromMat4(s.ad.mat3.create(),_),E,G,j,H);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+C,a.skyboxTexture,0),h.draw(y,M.TRIANGLES,gn.disabled,Un.disabled,nr.unblended,qn.frontCW,Y,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const gM=s.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Zm{constructor(a){const h=new s.di;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new s.aV;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,gM.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=s.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const rs=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class yi{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class hE{constructor(a){this.colorModeAlphaBlendedWriteRGB=new nr([1,ji,1,ji],s.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new nr([1,0,1,0],s.al.transparent,[!1,!1,!1,!0]),this.params=new yi,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){const h=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Zm(h);const _=this.params.sizeRange,E=this.params.intensityRange,C=function(Y){const ne=s.dl(30),ee=[];for(let he=0;he<Y;++he){const we=2*Math.PI*ne(),xe=Math.acos(1-2*ne())-.5*Math.PI;ee.push(s.ad.vec3.fromValues(Math.cos(xe)*Math.cos(we),Math.cos(xe)*Math.sin(we),Math.sin(xe)))}return ee}(this.params.starsCount),M=s.dl(300),j=new s.dj,H=new s.aV;let G=0;for(let Y=0;Y<C.length;++Y){const ne=s.ad.vec3.scale([],C[Y],200),ee=Math.max(0,1+.01*_*(1*M()-.5)),he=Math.max(0,1+.01*E*(1*M()-.5));j.emplaceBack(ne[0],ne[1],ne[2],-1,-1,ee,he),j.emplaceBack(ne[0],ne[1],ne[2],1,-1,ee,he),j.emplaceBack(ne[0],ne[1],ne[2],1,1,ee,he),j.emplaceBack(ne[0],ne[1],ne[2],-1,1,ee,he),H.emplaceBack(G+0,G+1,G+2),H.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=h.createVertexBuffer(j,rs.members),this.starsIdx=h.createIndexBuffer(H),this.starsSegments=s.b8.simpleSegment(0,0,j.length,H.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,h){const _=a.context,E=_.gl,C=a.transform,M=new gn(E.LEQUAL,gn.ReadOnly,[0,1]),j=s.ag(C.zoom),H=a.style.getLut(h.scope),G=h.properties.get("color-use-theme")==="none",Y=h.properties.get("color").toRenderColor(G?null:H).toArray01(),ne=h.properties.get("high-color-use-theme")==="none",ee=h.properties.get("high-color").toRenderColor(ne?null:H).toArray01(),he=h.properties.get("space-color-use-theme")==="none",we=h.properties.get("space-color").toRenderColor(he?null:H).toArray01PremultipliedAlpha(),xe=5e-4,Ee=s.dk(h.properties.get("horizon-blend"),0,1,xe,.25),Ce=s.cD(a,_,C)&&Ee===xe?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,je=a.frameCounter/1e3%1,$e=s.ad.vec3.length(C.globeCenterInViewSpace),We=Math.sqrt(Math.pow($e,2)-Math.pow(Ce,2)),Ze=Math.acos(We/$e),Ye=Xe=>{const Ke=C.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Xe&&Ke.push("ALPHA_PASS");const tt=a.getOrCreateProgram("globeAtmosphere",{defines:Ke}),at=((xt,Bt,zt,Jt,yt,Ft,gt,Lt,kt,Ut,Rt,Wt)=>({u_frustum_tl:xt,u_frustum_tr:Bt,u_frustum_br:zt,u_frustum_bl:Jt,u_horizon:yt,u_transition:Ft,u_fadeout_range:gt,u_color:Lt,u_high_color:kt,u_space_color:Ut,u_temporal_offset:Rt,u_horizon_angle:Wt}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,j,Ee,Y,ee,we,je,Ze);a.uploadCommonUniforms(_,tt);const At=this.atmosphereBuffer;At&&tt.draw(a,E.TRIANGLES,M,Un.disabled,Xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qn.backCW,at,Xe?"atmosphere_glow_alpha":"atmosphere_glow",At.vertexBuffer,At.indexBuffer,At.segments)};Ye(!1),Ye(!0)}drawStars(a,h){const _=s.ay(h.properties.get("star-intensity"),0,1);if(_===0)return;const E=a.context,C=E.gl,M=a.transform,j=a.getOrCreateProgram("stars"),H=s.ad.quat.identity([]);s.ad.quat.rotateX(H,H,-M._pitch),s.ad.quat.rotateZ(H,H,-M.angle),s.ad.quat.rotateX(H,H,s.ak(M._center.lat)),s.ad.quat.rotateY(H,H,-s.ak(M._center.lng));const G=s.ad.mat4.fromQuat(new Float32Array(16),H),Y=s.ad.mat4.multiply([],M.starsProjMatrix,G),ne=s.ad.mat3.fromMat4([],G),ee=s.ad.mat3.invert([],ne),he=[0,1,0];s.ad.vec3.transformMat3(he,he,ee),s.ad.vec3.scale(he,he,this.params.sizeMultiplier);const we=[1,0,0];s.ad.vec3.transformMat3(we,we,ee),s.ad.vec3.scale(we,we,this.params.sizeMultiplier);const xe=(Ee=he,Ce=we,je=_,{u_matrix:Float32Array.from(Y),u_up:Ee,u_right:Ce,u_intensity_multiplier:je});var Ee,Ce,je;a.uploadCommonUniforms(E,j),this.starsVx&&this.starsIdx&&j.draw(a,C.TRIANGLES,gn.disabled,Un.disabled,this.colorModeAlphaBlendedWriteRGB,qn.disabled,xe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function sh(y,a){const h=[...y],_=a.cameraWorldSizeForFog/a.worldSize,E=s.ad.mat4.identity([]);return s.ad.mat4.scale(E,E,[_,_,1]),s.ad.mat4.multiply(h,E,h),s.ad.mat4.multiply(h,a.worldToFogMatrix,h),h}function lp(y,a,h,_,E){const C=h.material,M=_.context,{baseColorTexture:j,metallicRoughnessTexture:H}=C.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:Y,emissionTexture:ne}=C;function ee(we,xe,Ee){if(we&&(y.push(xe),M.activeTexture.set(M.gl.TEXTURE0+Ee),we.gfxTexture)){const{minFilter:Ce,magFilter:je,wrapS:$e,wrapT:We}=we.sampler;we.gfxTexture.bindExtraParam(Ce,je,$e,We)}}ee(j,"HAS_TEXTURE_u_baseColorTexture",Ps.BaseColor),ee(H,"HAS_TEXTURE_u_metallicRoughnessTexture",Ps.MetallicRoughness),ee(G,"HAS_TEXTURE_u_normalTexture",Ps.Normal),ee(Y,"HAS_TEXTURE_u_occlusionTexture",Ps.Occlusion),ee(ne,"HAS_TEXTURE_u_emissionTexture",Ps.Emission),E&&(E.texture||(E.texture=new s.dn(_.context,E.image,[E.image.height,E.image.height,E.image.height],M.gl.RGBA8)),M.activeTexture.set(M.gl.TEXTURE0+Ps.LUT),E.texture&&E.texture.bind(M.gl.LINEAR,M.gl.CLAMP_TO_EDGE),y.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(y.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(h.texcoordBuffer)),h.colorBuffer&&(y.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(h.colorBuffer)),h.normalBuffer&&(y.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(h.normalBuffer)),h.pbrBuffer&&(y.push("HAS_ATTRIBUTE_a_pbr"),y.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(h.pbrBuffer)),C.alphaMode!=="OPAQUE"&&C.alphaMode!=="MASK"||y.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||y.push("DIFFUSE_SHADED");const he=_.shadowRenderer;he&&(y.push("RENDER_SHADOWS","DEPTH_TEXTURE"),he.useNormalOffset&&y.push("NORMAL_OFFSET"))}function oh(y,a,h,_,E,C){const M=h.paint.get("model-opacity").constantOr(1),j=a.context,H=new gn(a.context.gl.LEQUAL,gn.ReadWrite,a.depthRangeFor3D),G=a.transform,Y=y.mesh,ne=Y.material,ee=ne.pbrMetallicRoughness,he=a.style.fog;let we;we=a.transform.projection.zAxisUnit==="pixels"?[...y.nodeModelMatrix]:s.ad.mat4.multiply([],_.zScaleMatrix,y.nodeModelMatrix),s.ad.mat4.multiply(we,_.negCameraPosMatrix,we);const xe=s.ad.mat4.invert([],we);s.ad.mat4.transpose(xe,xe);const Ee=h.paint.get("model-color-use-theme").constantOr("default")==="none",Ce=h.paint.get("model-emissive-strength").constantOr(0),je=p1(new Float32Array(y.worldViewProjection),new Float32Array(we),new Float32Array(xe),null,a,M,ee.baseColorFactor.toRenderColor(null),ne.emissiveFactor,ee.metallicFactor,ee.roughnessFactor,ne,Ce,h),$e={defines:[]},We=[],Ze=a.shadowRenderer;Ze&&(Ze.useNormalOffset=!1),lp($e.defines,We,Y,a,Ee?null:h.lut);let Ye=null;if(he){const tt=sh(y.nodeModelMatrix,a.transform);if(Ye=new Float32Array(tt),G.projection.name!=="globe"){const at=Y.aabb.min,At=Y.aabb.max,[xt,Bt]=he.getOpacityForBounds(tt,at[0],at[1],At[0],At[1]);$e.overrideFog=xt>=hn||Bt>=hn}}const Xe=Nl(a,h.paint.get("model-cutoff-fade-range"));Xe.shouldRenderCutoff&&$e.defines.push("RENDER_CUTOFF");const Ke=a.getOrCreateProgram("model",$e);a.uploadCommonUniforms(j,Ke,null,Ye,Xe),a.renderPass!=="shadow"&&Ze&&Ze.setupShadowsFromMatrix(y.nodeModelMatrix,Ke),Ke.draw(a,j.gl.TRIANGLES,H,E,C,Y.material.doubleSided?qn.disabled:qn.backCCW,je,h.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,h.paint,a.transform.zoom,void 0,We)}function Hd(y,a,h,_,E,C,M){let j;j=y.projection.name==="globe"?s.dp(h,y):[...h],s.ad.mat4.multiply(j,j,a.matrix);const H=s.ad.mat4.multiply([],_,j);if(a.meshes)for(const G of a.meshes){if(G.material.alphaMode!=="BLEND"){M.push({mesh:G,depth:0,modelIndex:E,worldViewProjection:H,nodeModelMatrix:j});continue}const Y=s.ad.vec3.transformMat4([],G.centroid,H);!y.isOrthographic&&Y[2]<=0||C.push({mesh:G,depth:Y[2],modelIndex:E,worldViewProjection:H,nodeModelMatrix:j})}if(a.children)for(const G of a.children)Hd(y,G,h,_,E,C,M)}function Qm(y,a,h,_){const E=h.shadowRenderer;if(!E)return;const C=E.getShadowPassDepthMode(),M=E.getShadowPassColorMode(),j=E.calculateShadowPassMatrixFromMatrix(a),H=iE(j);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,C,Un.disabled,M,qn.backCCW,H,_.id,y.vertexBuffer,y.indexBuffer,y.segments,_.paint,h.transform.zoom,void 0,void 0)}function S1(y,a,h){const _=a.updateZoomBasedPaintProperties(),E=function(C,M,j){let H,G,Y,ne=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&ne>0){const ee=C.terrain,he=ee.findDEMTileFor(j);he&&he.dem?H=s.dr.create(ee,j,he):ne=0}if(ne===0&&(M.terrainElevationMin=0,M.terrainElevationMax=0),ne===M.validForExaggeration&&(ne===0||H&&H._demTile&&H._demTile.tileID===M.validForDEMTile.id&&H._dem._timestamp===M.validForDEMTile.timestamp))return!1;for(const ee in M.instancesPerModel){const he=M.instancesPerModel[ee];for(let we=0;we<he.instancedDataArray.length;++we){const xe=(H?ne*H.getElevationAt(0|he.instancedDataArray.float32[16*we],0|he.instancedDataArray.float32[16*we+1],!0,!0):0)+he.instancesEvaluatedElevation[we];he.instancedDataArray.float32[16*we+6]=xe,G=G?Math.min(M.terrainElevationMin,xe):xe,Y=Y?Math.max(M.terrainElevationMax,xe):xe}}return M.terrainElevationMin=G||0,M.terrainElevationMax=Y||0,M.validForExaggeration=ne,M.validForDEMTile=H&&H._demTile?{id:H._demTile.tileID,timestamp:H._dem._timestamp}:{id:void 0,timestamp:0},!0}(y,a,h);(_||E)&&(a.uploaded=!1,a.upload(y.context))}const Mc={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.ce([0,0,0],[s.ai,s.ai,0])};function T1(y,a){const h=1<<y.canonical.z,_=a.getFreeCameraOptions().position,E=a.elevation,C=y.canonical.x/h,M=(y.canonical.x+1)/h,j=y.canonical.y/h,H=(y.canonical.y+1)/h;let G=a._centerAltitude;if(E){const he=E.getMinMaxForTile(y);he&&he.max>G&&(G=he.max)}const Y=s.ay(_.x,C,M)-_.x,ne=s.ay(_.y,j,H)-_.y,ee=s.bH(G,a.center.lat)-_.z;return a._zoomFromMercatorZ(Math.sqrt(Y*Y+ne*ne+ee*ee))}function Jc(y,a,h,_,E,C,M){const j=y.context,H=y.renderPass==="shadow",G=y.shadowRenderer,Y=H&&G?G.getShadowPassDepthMode():new gn(j.gl.LEQUAL,gn.ReadWrite,y.depthRangeFor3D),ne=y.isTileAffectedByFog(C);if(h.meshes)for(const ee of h.meshes){const he=["MODEL_POSITION_ON_GPU"],we=[];let xe,Ee,Ce;_.instancedDataArray.length>20&&he.push("INSTANCED_ARRAYS");const je=Nl(y,a.paint.get("model-cutoff-fade-range"));if(je.shouldRenderCutoff&&he.push("RENDER_CUTOFF"),H&&G)xe=y.getOrCreateProgram("modelDepth",{defines:he}),Ee=iE(M.shadowTileMatrix,M.shadowTileMatrix,Float32Array.from(h.matrix)),Ce=G.getShadowPassColorMode();else{lp(he,we,ee,y,a.paint.get("model-color-use-theme").constantOr("default")==="none"?null:a.lut),xe=y.getOrCreateProgram("model",{defines:he,overrideFog:ne});const We=ee.material,Ze=We.pbrMetallicRoughness,Ye=a.paint.get("model-opacity").constantOr(1),Xe=a.paint.get("model-emissive-strength").constantOr(0);Ee=p1(C.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,y,Ye,Ze.baseColorFactor.toRenderColor(null),We.emissiveFactor,Ze.metallicFactor,Ze.roughnessFactor,We,Xe,a,E),G&&(M.shadowUniformsInitialized?xe.setShadowUniformValues(j,G.getShadowUniformValues()):(G.setupShadows(C.toUnwrapped(),xe,"model-tile",C.overscaledZ),M.shadowUniformsInitialized=!0)),Ce=je.shouldRenderCutoff||Ye<1||We.alphaMode!=="OPAQUE"?nr.alphaBlended:nr.unblended}y.uploadCommonUniforms(j,xe,C.toUnwrapped(),null,je);const $e=ee.material.doubleSided?qn.disabled:qn.backCCW;if(_.instancedDataArray.length>20)we.push(_.instancedDataBuffer),xe.draw(y,j.gl.TRIANGLES,Y,Un.disabled,Ce,$e,Ee,a.id,ee.vertexBuffer,ee.indexBuffer,ee.segments,a.paint,y.transform.zoom,void 0,we,_.instancedDataArray.length);else{const We=H?"u_instance":"u_normal_matrix";for(let Ze=0;Ze<_.instancedDataArray.length;++Ze)Ee[We]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Ze,16),xe.draw(y,j.gl.TRIANGLES,Y,Un.disabled,Ce,$e,Ee,a.id,ee.vertexBuffer,ee.indexBuffer,ee.segments,a.paint,y.transform.zoom,void 0,we)}}if(h.children)for(const ee of h.children)Jc(y,a,ee,_,E,C,M)}const Zh=[1,-1,1];function t0(y,a,h,_){if(!h.modelManager)return!0;const E=h.modelManager;if(!h.shadowRenderer)return!0;const C=h.shadowRenderer,M=a.aabb;let j=!0,H=y.maxHeight;if(H===0){let Y=0;for(const ne in y.instancesPerModel){const ee=E.getModel(ne,_);ee?Y=Math.max(Y,Math.max(Math.max(ee.aabb.max[0],ee.aabb.max[1]),ee.aabb.max[2])):j=!1}H=y.maxScale*Y*1.41+y.maxVerticalOffset,j&&(y.maxHeight=H)}M.max[2]=H,M.min[2]+=y.terrainElevationMin,M.max[2]+=y.terrainElevationMax,s.ad.vec3.transformMat4(M.min,M.min,a.tileMatrix),s.ad.vec3.transformMat4(M.max,M.max,a.tileMatrix);const G=M.intersects(C.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(y.isInsideFirstShadowMapFrustum=G===2),G===0}function n0(y,a){const h=y.uniformValues.u_cutoff_params[0],_=y.uniformValues.u_cutoff_params[1],E=y.uniformValues.u_cutoff_params[2],C=y.uniformValues.u_cutoff_params[3];return _===h||C===E?1:s.ay(((a-h)/(_-h)-E)/(C-E),0,1)}function C1(y,a,h,_){if(a.pitch<20)return 1;const E=a.getWorldToCameraMatrix();s.ad.mat4.multiply(E,E,y);const C=s.ad.vec4.fromValues(h.min[0],h.min[1],h.min[2],1);let M=s.ad.vec4.transformMat4(s.ad.vec4.create(),C,E),j=M,H=M;C[1]=h.max[1],M=s.ad.vec4.transformMat4(s.ad.vec4.create(),C,E),j=M[1]<j[1]?M:j,H=M[1]>H[1]?M:H,C[0]=h.max[0],M=s.ad.vec4.transformMat4(s.ad.vec4.create(),C,E),j=M[1]<j[1]?M:j,H=M[1]>H[1]?M:H,C[1]=h.min[1],M=s.ad.vec4.transformMat4(s.ad.vec4.create(),C,E),j=M[1]<j[1]?M:j,H=M[1]>H[1]?M:H;const G=s.ay(_[0],0,1),Y=100*a.pixelsPerMeter*s.ay(_[1],0,1),ne=s.ay(_[2],0,1),ee=s.ad.vec4.lerp(s.ad.vec4.create(),j,H,G),he=Math.tan(.5*a.fovX),we=-ee[2]*he;if(Y===0)return ee[1]<-Math.abs(we)?ne:1;const xe=(-Math.abs(we)-ee[1])/Y,Ee=(je,$e,We)=>(1-We)*je+We*$e,Ce=s.ay(Ee(1,ne,xe),ne,1);return Ee(1,Ce,s.ay((a.pitch-20)/20,0,1))}class I1{}class Wd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,h,_){{const ne=this._storage.get(h.id);if(ne)return ne.lastUsedFrameIdx=a,ne.buf}const E=_.gl,C=E.getBufferParameter(E.ELEMENT_ARRAY_BUFFER,E.BUFFER_SIZE),M=new ArrayBuffer(C),j=new Int16Array(M);E.getBufferSubData(E.ELEMENT_ARRAY_BUFFER,0,new Int16Array(M));const H=new s.dt;for(let ne=0;ne<C/2;ne+=3){const ee=j[ne],he=j[ne+1],we=j[ne+2];H.emplaceBack(ee,he),H.emplaceBack(he,we),H.emplaceBack(we,ee)}const G=_.bindVertexArrayOES.current,Y=new I1;return Y.buf=new Ru(_,H),Y.lastUsedFrameIdx=a,this._storage.set(h.id,Y),_.bindVertexArrayOES.set(G),Y.buf}update(a){for(const[h,_]of this._storage)a-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(h))}destroy(){for(const[a,h]of this._storage)h.buf.destroy(),this._storage.delete(a)}}class A1{constructor(a){this.occluderSize=30,this.depthOffset=-1e-4,a.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Qh=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class R1{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Jm{constructor(a,h){this.revealStart=11,this.revealRange=2,a.registerParameter(this,[...h,"Reveal"],"revealStart",{min:0,max:17,step:.05}),a.registerParameter(this,[...h,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const M1=s.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class P1{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(a,h){const _=a.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const M=new s.du,j=new s.aV;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(1,1),M.emplaceBack(-1,1),j.emplaceBack(0,1,2),j.emplaceBack(0,2,3),this.vignetteVx=a.context.createVertexBuffer(M,M1.members),this.vignetteIdx=a.context.createIndexBuffer(j)}const E=s.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){a.uploadCommonUniforms(a.context,_);const M={u_vignetteShape:(C={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:C.vignetteColor};_.draw(a,a.context.gl.TRIANGLES,gn.disabled,Un.disabled,nr.alphaBlended,qn.disabled,M,"vignette",this.vignetteVx,this.vignetteIdx,E)}var C}}class la{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(a,h){const _=a.getFreeCameraOptions().position,E=_.toAltitude(),C=_.toLngLat(),M=s.ak(C.lng),j=s.ak(C.lat),H=a.pixelsPerMeter/h,G=M*s.dv,Y=s.dv*Math.log(Math.tan(Math.PI/4+j/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const ne=-this._offsetYPrev+Y,ee=-this._elevationPrev+E;this._accumulatedOffsetX+=(-this._offsetXPrev+G)*H,this._accumulatedOffsetY+=ne*H,this._accumulatedElevation+=ee*H,this._offsetXPrev=G,this._offsetYPrev=Y,this._elevationPrev=E}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function r0(y,a){return[-(y[0]-Math.floor(y[0]/a)*a),-(y[1]-Math.floor(y[1]/a)*a),-(y[2]-Math.floor(y[2]/a)*a)]}function i0(y){const a=s.dl(1323123451230),h=[];for(let _=0;_<y;++_){const E=2*a()-1,C=2*a()-1,M=2*a()-1;h.push(s.ad.vec3.fromValues(E,C,M))}return h}function Ll(y,a,h,_,E){const C=s.ay((E-h)/(_-h),0,1);return(1-C)*y+C*a}class s0{constructor(a){this._movement=new la,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new P1,this._ppmScaleFactor=a}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(a,h){const _=a.transform;this._movement.update(_,this._ppmScaleFactor);const E=_.starsProjMatrix,C=s.ad.quat.identity([]);s.ad.quat.rotateX(C,C,s.ak(90)-_._pitch),s.ad.quat.rotateZ(C,C,-_.angle);const M=s.ad.mat4.fromQuat(new Float32Array(16),C),j=s.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),H=s.ad.mat4.transpose([],j),G=s.ad.mat4.multiply([],H,M),Y=Date.now()/1e3;return this._accumulatedTimeFromStart+=(Y-this._prevTime)*h,this._prevTime=Y,{projectionMatrix:E,modelviewMatrix:G}}}class D1 extends s0{constructor(a){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Jm(a.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(a){const h=a.context;if(!this.particlesVx){const _=i0(this.particlesCount),E=new s.dw,C=new s.aV;let M=0;const j=s.dl(1323123451230);for(let H=0;H<_.length;++H){const G=_[H],Y=[2*j()-1,j(),j(),j()];E.emplaceBack(G[0],G[1],G[2],-1,-1,...Y),E.emplaceBack(G[0],G[1],G[2],1,-1,...Y),E.emplaceBack(G[0],G[1],G[2],1,1,...Y),E.emplaceBack(G[0],G[1],G[2],-1,1,...Y),C.emplaceBack(M+0,M+1,M+2),C.emplaceBack(M+0,M+2,M+3),M+=4}this.particlesVx=h.createVertexBuffer(E,Qh.members),this.particlesIdx=h.createIndexBuffer(C)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=a.transform.zoom;if(h.revealStart>_)return;const E=Ll(0,1,h.revealStart,h.revealStart+h.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const C=structuredClone(this._params);let M=[-C.direction.x,C.direction.y,-100];s.ad.vec3.normalize(M,M);const j=structuredClone(this._vignetteParams);j.strength*=E,C.overrideStyleParameters||(C.intensity=a.style.rain.state.density,C.timeFactor=a.style.rain.state.intensity,C.color=structuredClone(a.style.rain.state.color),M=structuredClone(a.style.rain.state.direction),C.screenThinning.intensity=a.style.rain.state.centerThinning,C.dropletSizeX=a.style.rain.state.dropletSize[0],C.dropletSizeYScale=a.style.rain.state.dropletSize[1]/a.style.rain.state.dropletSize[0],C.distortionStrength=100*a.style.rain.state.distortionStrength,j.strength=1,j.color=structuredClone(a.style.rain.state.vignetteColor));const H=this.updateOnRender(a,C.timeFactor),G=a.context,Y=G.gl,ne=a.transform;this.screenTexture&&this.screenTexture.size[0]===a.width&&this.screenTexture.size[1]===a.height||(this.screenTexture=new s.T(G,{width:a.width,height:a.height,data:null},Y.RGBA8)),C.distortionStrength>0&&(G.activeTexture.set(Y.TEXTURE0),this.screenTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Y.copyTexSubImage2D(Y.TEXTURE_2D,0,0,0,0,0,a.width,a.height));const ee=a.getOrCreateProgram("rainParticle");a.uploadCommonUniforms(G,ee),G.activeTexture.set(Y.TEXTURE0),this.screenTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const he=[C.color.r,C.color.g,C.color.b,C.color.a],we=(xe,Ee)=>{const Ce=r0(this._movement.getPosition(),xe),je=C.dropletSizeX,$e=C.dropletSizeX*C.dropletSizeYScale,We=a.width/2,Ze=a.height/2,Ye=Ll(0,C.screenThinning.start,0,1,C.screenThinning.intensity),Xe=Ll(.001,C.screenThinning.range,0,1,C.screenThinning.intensity),Ke=Ll(0,C.screenThinning.particleOffset,0,1,C.screenThinning.intensity),tt=(at={modelview:H.modelviewMatrix,projection:H.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Ce,velocityConeAperture:C.velocityConeAperture,velocity:C.velocity,boxSize:xe,rainDropletSize:[je,$e],distortionStrength:C.distortionStrength,rainDirection:M,color:he,screenSize:[ne.width,ne.height],thinningCenterPos:[We,Ze],thinningShape:[Ye,Xe,Math.pow(10,C.screenThinning.fadePower)],thinningAffectedRatio:C.screenThinning.affectedRatio,thinningParticleOffset:Ke,shapeDirectionalPower:C.shapeDirPower,shapeNormalPower:C.shapeNormalPower,mode:Ee?0:1},{u_modelview:Float32Array.from(at.modelview),u_projection:Float32Array.from(at.projection),u_time:at.time,u_cam_pos:at.camPos,u_texScreen:0,u_velocityConeAperture:at.velocityConeAperture,u_velocity:at.velocity,u_boxSize:at.boxSize,u_rainDropletSize:at.rainDropletSize,u_distortionStrength:at.distortionStrength,u_rainDirection:at.rainDirection,u_color:at.color,u_screenSize:at.screenSize,u_thinningCenterPos:at.thinningCenterPos,u_thinningShape:at.thinningShape,u_thinningAffectedRatio:at.thinningAffectedRatio,u_thinningParticleOffset:at.thinningParticleOffset,u_shapeDirectionalPower:at.shapeDirectionalPower,u_shapeNormalPower:at.shapeNormalPower,u_mode:at.mode});var at;const At=Math.round(C.intensity*this.particlesCount),xt=s.b8.simpleSegment(0,0,4*At,2*At);ee.draw(a,Y.TRIANGLES,gn.disabled,Un.disabled,nr.alphaBlended,qn.disabled,tt,"rain_particles",this.particlesVx,this.particlesIdx,xt)};C.distortionStrength>0&&we(C.boxSize,!0),we(C.boxSize,!1),this._vignette.draw(a,j)}}const k1=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class cp extends s0{constructor(a){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Jm(a.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(a){const h=a.context;if(!this.particlesVx){const _=i0(this.particlesCount),E=new s.dx,C=new s.aV;let M=0;const j=s.dl(1323123451230);for(let H=0;H<_.length;++H){const G=_[H],Y=j(),ne=j(),ee=j(),he=[H/_.length,Y,ne,ee],we=[j(),j()];E.emplaceBack(G[0],G[1],G[2],-1,-1,...he,...we),E.emplaceBack(G[0],G[1],G[2],1,-1,...he,...we),E.emplaceBack(G[0],G[1],G[2],1,1,...he,...we),E.emplaceBack(G[0],G[1],G[2],-1,1,...he,...we),C.emplaceBack(M+0,M+1,M+2),C.emplaceBack(M+0,M+2,M+3),M+=4}this.particlesVx=h.createVertexBuffer(E,k1.members),this.particlesIdx=h.createIndexBuffer(C)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.snow)return;const h=structuredClone(this._params);let _=[-h.direction.x,h.direction.y,-100];s.ad.vec3.normalize(_,_);const E=structuredClone(this._vignetteParams),C=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},M=a.transform.zoom;if(C.revealStart>M)return;const j=Ll(0,1,C.revealStart,C.revealStart+C.revealRange,M);E.strength*=j,h.overrideStyleParameters||(h.intensity=a.style.snow.state.density,h.timeFactor=a.style.snow.state.intensity,h.color=structuredClone(a.style.snow.state.color),_=structuredClone(a.style.snow.state.direction),h.screenThinning.intensity=a.style.snow.state.centerThinning,h.billboardSize=2.79*a.style.snow.state.flakeSize,E.strength=1,E.color=structuredClone(a.style.snow.state.vignetteColor));const H=this.updateOnRender(a,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const G=a.context,Y=G.gl,ne=a.transform,ee=a.getOrCreateProgram("snowParticle");a.uploadCommonUniforms(G,ee),((he,we,xe)=>{const Ee=r0(this._movement.getPosition(),he),Ce=ne.width/2,je=ne.height/2,$e=Ll(0,xe.screenThinning.start,0,1,xe.screenThinning.intensity),We=Ll(.001,xe.screenThinning.range,0,1,xe.screenThinning.intensity),Ze=Ll(0,xe.screenThinning.particleOffset,0,1,xe.screenThinning.intensity),Ye=(Xe={modelview:H.modelviewMatrix,projection:H.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Ee,velocityConeAperture:xe.velocityConeAperture,velocity:xe.velocity,horizontalOscillationRadius:xe.horizontalOscillationRadius,horizontalOscillationRate:xe.horizontalOscillationRate,boxSize:he,billboardSize:1*xe.billboardSize,simpleShapeParameters:[xe.shapeFadeStart,xe.shapeFadePower],screenSize:[ne.width,ne.height],thinningCenterPos:[Ce,je],thinningShape:[$e,We,Math.pow(10,xe.screenThinning.fadePower)],thinningAffectedRatio:xe.screenThinning.affectedRatio,thinningParticleOffset:Ze,color:[xe.color.r,xe.color.g,xe.color.b,xe.color.a],direction:_},{u_modelview:Float32Array.from(Xe.modelview),u_projection:Float32Array.from(Xe.projection),u_time:Xe.time,u_cam_pos:Xe.camPos,u_velocityConeAperture:Xe.velocityConeAperture,u_velocity:Xe.velocity,u_horizontalOscillationRadius:Xe.horizontalOscillationRadius,u_horizontalOscillationRate:Xe.horizontalOscillationRate,u_boxSize:Xe.boxSize,u_billboardSize:Xe.billboardSize,u_simpleShapeParameters:Xe.simpleShapeParameters,u_screenSize:Xe.screenSize,u_thinningCenterPos:Xe.thinningCenterPos,u_thinningShape:Xe.thinningShape,u_thinningAffectedRatio:Xe.thinningAffectedRatio,u_thinningParticleOffset:Xe.thinningParticleOffset,u_particleColor:Xe.color,u_direction:Xe.direction});var Xe;const Ke=Math.round(xe.intensity*this.particlesCount),tt=s.b8.simpleSegment(0,0,4*Ke,2*Ke);this.particlesVx&&this.particlesIdx&&ee.draw(a,Y.TRIANGLES,gn.disabled,Un.disabled,nr.alphaBlended,qn.disabled,Ye,"snow_particles",this.particlesVx,this.particlesIdx,tt)})(h.boxSize,0,h),this._vignette.draw(a,E)}}const eg={symbol:function(y,a,h,_,E){if(y.renderPass!=="translucent")return;const C=Un.disabled,M=y.colorModeForRenderPass(),j=h.layout.get("text-variable-anchor"),H=h.layout.get("text-size-scale-range"),G=s.ay(y.scaleFactor,H[0],H[1]);j&&function(ee,he,we,xe,Ee,Ce,je,$e){const We=he.transform,Ze=Ee==="map",Ye=Ce==="map";for(const Xe of ee){const Ke=xe.getTile(Xe),tt=Ke.getBucket(we);if(!tt||!tt.text||!tt.text.segments.get().length)continue;const at=s.bp(tt.textSizeData,We.zoom,$e),At=Lo(Xe,tt.getProjection(),We),xt=We.calculatePixelsToTileUnitsMatrix(Ke),Bt=sa(At,Ke.tileID.canonical,Ye,Ze,We,tt.getProjection(),xt),zt=tt.hasIconTextFit()&&tt.hasIconData();if(at){const Jt=Math.pow(2,We.zoom-Ke.tileID.overscaledZ);Rc(tt,Ze,Ye,je,s.cY,We,Bt,Xe,Jt,at,zt)}}}(_,y,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),E,G);const Y=h.paint.get("icon-opacity").constantOr(1)!==0,ne=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(Y||ne)?Wi(y,a,h,_,C,M):(Y&&Wi(y,a,h,_,C,M,{onlyIcons:!0}),ne&&Wi(y,a,h,_,C,M,{onlyText:!0})),a.map.showCollisionBoxes&&(X_(y,a,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),X_(y,a,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(y,a,h,_){if(y.renderPass!=="translucent")return;const E=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),M=h.paint.get("circle-stroke-opacity"),j=h.layout.get("circle-sort-key").constantOr(1)!==void 0,H=h.paint.get("circle-emissive-strength");if(E.constantOr(1)===0&&(C.constantOr(1)===0||M.constantOr(1)===0))return;const G=y.context,Y=G.gl,ne=y.transform,ee=y.depthModeForSublayer(0,gn.ReadOnly),he=Un.disabled,we=y.colorModeForDrapableLayerRenderPass(H),xe=ne.projection.name==="globe",Ee=[s.av(ne.center.lng),s.aC(ne.center.lat)],Ce=[];for(let $e=0;$e<_.length;$e++){const We=_[$e],Ze=a.getTile(We),Ye=Ze.getBucket(h);if(!Ye||Ye.projection.name!==ne.projection.name)continue;const Xe=Ye.programConfigurations.get(h.id),Ke=s.cZ(h),tt=y.isTileAffectedByFog(We);xe&&Ke.push("PROJECTION_GLOBE_VIEW"),Ke.push("DEPTH_D24"),y.terrain&&ne.depthOcclusionForSymbolsAndCircles&&Ke.push("DEPTH_OCCLUSION");const at=y.getOrCreateProgram("circle",{config:Xe,defines:Ke,overrideFog:tt}),At=Ye.layoutVertexBuffer,xt=Ye.globeExtVertexBuffer,Bt=Ye.indexBuffer,zt=ne.projection.createInversionMatrix(ne,We.canonical),Jt={programConfiguration:Xe,program:at,layoutVertexBuffer:At,globeExtVertexBuffer:xt,indexBuffer:Bt,uniformValues:s.c_(y,We,Ze,zt,Ee,h),tile:Ze};if(j){const yt=Ye.segments.get();for(const Ft of yt)Ce.push({segments:new s.b8([Ft]),sortKey:Ft.sortKey,state:Jt})}else Ce.push({segments:Ye.segments,sortKey:0,state:Jt})}j&&Ce.sort(($e,We)=>$e.sortKey-We.sortKey);const je={useDepthForOcclusion:ne.depthOcclusionForSymbolsAndCircles};for(const $e of Ce){const{programConfiguration:We,program:Ze,layoutVertexBuffer:Ye,globeExtVertexBuffer:Xe,indexBuffer:Ke,uniformValues:tt,tile:at}=$e.state,At=$e.segments;y.terrain&&y.terrain.setupElevationDraw(at,Ze,je),y.uploadCommonUniforms(G,Ze,at.tileID.toUnwrapped()),Ze.draw(y,Y.TRIANGLES,ee,he,we,qn.disabled,tt,h.id,Ye,Ke,At,h.paint,ne.zoom,We,[Xe])}},heatmap:function(y,a,h,_){if(h.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const E=y.context,C=E.gl,M=Un.disabled,j=new nr([C.ONE,C.ONE,C.ONE,C.ONE],s.al.transparent,[!0,!0,!0,!0]);(function(he,we,xe,Ee){const Ce=he.gl,je=we.width*Ee,$e=we.height*Ee;he.activeTexture.set(Ce.TEXTURE1),he.viewport.set([0,0,je,$e]);let We=xe.heatmapFbo;if(!We||We&&(We.width!==je||We.height!==$e)){We&&We.destroy();const Ze=Ce.createTexture();Ce.bindTexture(Ce.TEXTURE_2D,Ze),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_S,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_T,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MIN_FILTER,Ce.LINEAR),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MAG_FILTER,Ce.LINEAR),We=xe.heatmapFbo=he.createFramebuffer(je,$e,!0,null),function(Ye,Xe,Ke,tt,at,At){const xt=Ye.gl;xt.texImage2D(xt.TEXTURE_2D,0,Ye.extRenderToTextureHalfFloat?xt.RGBA16F:xt.RGBA,at,At,0,xt.RGBA,Ye.extRenderToTextureHalfFloat?xt.HALF_FLOAT:xt.UNSIGNED_BYTE,null),tt.colorAttachment.set(Ke)}(he,0,Ze,We,je,$e)}else Ce.bindTexture(Ce.TEXTURE_2D,We.colorAttachment.get()),he.bindFramebuffer.set(We.framebuffer)})(E,y,h,y.transform.projection.name==="globe"?.5:.25),E.clear({color:s.al.transparent});const H=y.transform,G=H.projection.name==="globe",Y=G?["PROJECTION_GLOBE_VIEW"]:[],ne=G?qn.frontCCW:qn.disabled,ee=[s.av(H.center.lng),s.aC(H.center.lat)];for(let he=0;he<_.length;he++){const we=_[he];if(a.hasRenderableParent(we))continue;const xe=a.getTile(we),Ee=xe.getBucket(h);if(!Ee||Ee.projection.name!==H.projection.name)continue;const Ce=y.isTileAffectedByFog(we),je=Ee.programConfigurations.get(h.id),$e=y.getOrCreateProgram("heatmap",{config:je,defines:Y,overrideFog:Ce}),{zoom:We}=y.transform;y.terrain&&y.terrain.setupElevationDraw(xe,$e),y.uploadCommonUniforms(E,$e,we.toUnwrapped());const Ze=H.projection.createInversionMatrix(H,we.canonical);$e.draw(y,C.TRIANGLES,gn.disabled,M,j,ne,q_(y,we,xe,Ze,ee,We,h.paint.get("heatmap-intensity")),h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,y.transform.zoom,je,G?[Ee.globeExtVertexBuffer]:null)}E.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(E,C){const M=E.context,j=M.gl,H=C.heatmapFbo;if(!H)return;M.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,H.colorAttachment.get()),M.activeTexture.set(j.TEXTURE1);let G=C.colorRampTexture;G||(G=C.colorRampTexture=new s.T(M,C.colorRamp,j.RGBA8)),G.bind(j.LINEAR,j.CLAMP_TO_EDGE),E.getOrCreateProgram("heatmapTexture").draw(E,j.TRIANGLES,gn.disabled,Un.disabled,E.colorModeForRenderPass(),qn.disabled,((Y,ne,ee,he)=>({u_image:0,u_color_ramp:1,u_opacity:ne.paint.get("heatmap-opacity")}))(0,C),C.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,C.paint,E.transform.zoom)}(y,h))},line:function(y,a,h,_){if(y.renderPass!=="translucent")return;const E=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(E.constantOr(1)===0||C.constantOr(1)===0)return;const M=h.paint.get("line-emissive-strength"),j=h.paint.get("line-occlusion-opacity"),H=h.layout.get("line-elevation-reference"),G=h.layout.get("line-width-unit")==="meters",Y=H==="sea",ne=y.context,ee=ne.gl;if(h.hasElevatedBuckets&&y.transform.projection.name==="globe")return;const he=h.layout.get("line-cross-slope"),we=he!==void 0,xe=he<1,Ee=y.colorModeForDrapableLayerRenderPass(M),Ce=y.terrain&&y.terrain.renderingToTexture,je=Ce?1:s.q.devicePixelRatio,$e=h.paint.get("line-dasharray"),We=$e.constantOr(1),Ze=h.layout.get("line-cap"),Ye=$e.constantOr(null),Xe=Ze.constantOr(null),Ke=h.paint.get("line-pattern"),tt=Ke.constantOr(1),at=Ke.constantOr(null),At=h.paint.get("line-opacity").constantOr(1);let xt=!tt&&At!==1||y.depthOcclusion&&j>0&&j<1;const Bt=h.paint.get("line-gradient"),zt=tt?"linePattern":"line",Jt=s.c$(h);let yt;if(Ce&&y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(xt=!1),j!==0&&y.depthOcclusion){const gt=h.paint._values["line-opacity"];gt&&gt.value&&gt.value.kind==="constant"?yt=gt.value:s.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}C.value.kind!=="constant"&&C.value.isLineProgressConstant===!1&&Jt.push("VARIABLE_LINE_WIDTH");const Ft=(gt,Lt,kt,Ut,Rt,Wt)=>{for(const dn of gt){const pn=a.getTile(dn);if(tt&&!pn.patternsLoaded())continue;const xn=pn.getBucket(h);if(!xn||xn.hasZOffset&&!Rt||!xn.hasZOffset&&Rt)continue;y.prepareDrawTile();const kn=xn.programConfigurations.get(h.id),gr=y.isTileAffectedByFog(dn),Qn=y.getOrCreateProgram(zt,{config:kn,defines:Lt,overrideFog:gr,overrideRtt:!Rt&&void 0});if(at&&pn.imageAtlas){const yr=s.d0.from(at).getPrimary().scaleSelf(je).toString(),Nn=pn.imageAtlas.patternPositions.get(yr);Nn&&kn.setConstantPatternPositions(Nn)}if(!tt&&Ye&&Xe&&pn.lineAtlas){const yr=pn.lineAtlas.getDash(Ye,Xe);yr&&kn.setConstantPatternPositions(yr)}let[dr,sr]=h.paint.get("line-trim-offset");(Xe==="round"||Xe==="square")&&dr!==sr&&(dr===0&&(dr-=1),sr===1&&(sr+=1));const Kr=Ce?dn.projMatrix:null,vi=G?1/xn.tileToMeter/s.at(pn,1,y.transform.zoom):1,Zi=G?1/xn.tileToMeter/s.at(pn,1,Math.floor(y.transform.zoom)):1,Br=tt?s.d1(y,pn,h,Kr,je,vi,Zi,[dr,sr]):s.d2(y,pn,h,Kr,xn.lineClipsArray.length,je,vi,Zi,[dr,sr]);if(Bt){const yr=xn.gradients[h.id];let Nn=yr.texture;if(h.gradientVersion!==yr.version){let ei=256;if(h.stepInterpolant){const Ai=a.getSource().maxzoom,mi=dn.canonical.z===Ai?Math.ceil(1<<y.transform.maxZoom-dn.canonical.z):1;ei=s.ay(s.d3(xn.maxLineLength/s.ai*1024*mi),256,ne.maxTextureSize)}yr.gradient=s.d4({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ei,image:yr.gradient||void 0,clips:xn.lineClipsArray}),yr.texture?yr.texture.update(yr.gradient):yr.texture=new s.T(ne,yr.gradient,ee.RGBA8),yr.version=h.gradientVersion,Nn=yr.texture}ne.activeTexture.set(ee.TEXTURE1),Nn.bind(h.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}We&&(ne.activeTexture.set(ee.TEXTURE0),pn.lineAtlasTexture&&pn.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),kn.updatePaintBuffers()),tt&&(ne.activeTexture.set(ee.TEXTURE0),pn.imageAtlasTexture&&pn.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),kn.updatePaintBuffers()),Rt&&!Y&&y.terrain.setupElevationDraw(pn,Qn),y.uploadCommonUniforms(ne,Qn,dn.toUnwrapped());const vs=yr=>{yt!=null&&(yt.value=At*j),Qn.draw(y,ee.TRIANGLES,kt,yr,Ee,qn.disabled,Br,h.id,xn.layoutVertexBuffer,xn.indexBuffer,xn.segments,h.paint,y.transform.zoom,kn,[xn.layoutVertexBuffer2,xn.patternVertexBuffer,xn.zOffsetVertexBuffer]),yt!=null&&(yt.value=At)};if(xt&&!Rt){const yr=y.stencilModeForClipping(dn).ref;yr===0&&Ce&&ne.clear({stencil:0});const Nn={func:ee.EQUAL,mask:255};Br.u_alpha_discard_threshold=.8,vs(new Un(Nn,yr,255,ee.KEEP,ee.KEEP,ee.INVERT)),Br.u_alpha_discard_threshold=0,vs(new Un(Nn,yr,255,ee.KEEP,ee.KEEP,ee.KEEP))}else Br.u_alpha_discard_threshold=xt&&Rt&&Wt?.8:0,vs(Rt?Ut:y.stencilModeForClipping(dn))}};if(h.hasNonElevatedBuckets){const gt=!Ce&&y.terrain;j!==0&&gt?s.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):gt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):Ft(_,Jt,y.depthModeForSublayer(0,gn.ReadOnly),Un.disabled,!1,!0)}if(h.hasElevatedBuckets){Jt.push("ELEVATED"),we&&Jt.push(xe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Y&&Jt.push("ELEVATION_REFERENCE_SEA");const gt=xt?y.stencilModeFor3D():Un.disabled,Lt=new gn(y.depthOcclusion?ee.GREATER:ee.LEQUAL,gn.ReadOnly,y.depthRangeFor3D);y.forceTerrainMode=!0,Ft(_,Jt,Lt,gt,!0,!0),xt&&Ft(_,Jt,Lt,gt,!0,!1),y.forceTerrainMode=!1}xt&&(y.resetStencilClippingMasks(),Ce&&ne.clear({stencil:0})),j===0||y.depthOcclusion||Ce||y.layersWithOcclusionOpacity.push(y.currentLayer)},fill:function(y,a,h,_){const E=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const M=h.paint.get("fill-emissive-strength"),j=y.colorModeForDrapableLayerRenderPass(M),H=h.paint.get("fill-pattern"),G=y.opaquePassEnabledForLayer()&&!H.constantOr(1)&&E.constantOr(s.al.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";let Y="none";h.layout.get("fill-elevation-reference")!=="none"?Y="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(Y="offset");const ne=!(!y.terrain||!y.terrain.enabled),ee={painter:y,sourceCache:a,layer:h,coords:_,colorMode:j,elevationType:Y,terrainEnabled:ne,pass:G};if(Y!=="offset"){if(Z_(ee,!1),Y==="road"){const he=!ne&&y.renderPass==="translucent";he&&x1(y,a,h,_,"geometry"),Z_(ee,!0,Un.disabled),he&&function(we){const{painter:xe,sourceCache:Ee,layer:Ce,coords:je,colorMode:$e}=we,We=xe.context.gl,Ze=new gn(xe.context.gl.LEQUAL,gn.ReadOnly,xe.depthRangeFor3D);for(const Ye of je){const Xe=Ee.getTile(Ye),Ke=Xe.getBucket(Ce);if(!Ke)continue;const tt=Ke.elevatedStructures;if(!tt||!tt.renderableSegments||tt.renderableSegments.segments[0].primitiveLength===0)continue;xe.prepareDrawTile();const at=Ke.bufferData.programConfigurations.get(Ce.id),At=xe.isTileAffectedByFog(Ye),xt=xe.getOrCreateProgram("elevatedStructures",{config:at,overrideFog:At,defines:["NORMAL_OFFSET"]}),Bt={u_matrix:xe.translatePosMatrix(Ye.projMatrix,Xe,Ce.paint.get("fill-translate"),Ce.paint.get("fill-translate-anchor"))};xe.uploadCommonUniforms(xe.context,xt,Ye.toUnwrapped()),xt.draw(xe,We.TRIANGLES,Ze,Un.disabled,$e,qn.backCCW,Bt,Ce.id,tt.vertexBuffer,tt.indexBuffer,tt.renderableSegments,Ce.paint,xe.transform.zoom,at,[tt.vertexBufferNormal])}}(ee)}}else Z_(ee,!1,y.stencilModeFor3D())},"fill-extrusion":function(y,a,h,_){const E=h.paint.get("fill-extrusion-opacity"),C=y.context,M=C.gl,j=y.terrain,H=j&&j.renderingToTexture;if(E===0)return;const G=y.conflationActive&&y.style.isLayerClipped(h,a.getSource()),Y=y.style.order.indexOf(h.fqid);if(G&&function(ne,ee,he,we,xe){for(const Ee of we){const Ce=ee.getTile(Ee).getBucket(he);Ce&&(Ce.updateReplacement(Ee,ne.replacementSource,xe),Ce.uploadCentroid(ne.context))}}(y,a,h,_,Y),j||G)for(const ne of _){const ee=a.getTile(ne).getBucket(h);ee&&rp(y.context,a,ne,ee,h,j,G)}if(y.renderPass==="shadow"&&y.shadowRenderer){const ne=y.shadowRenderer;if(j&&E<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const ee=ne.getShadowPassDepthMode(),he=ne.getShadowPassColorMode();Km(y,a,h,_,ee,Un.disabled,he,G)}else if(y.renderPass==="translucent"){const ne=!h.paint.get("fill-extrusion-pattern").constantOr(1),ee=h.paint.get("fill-extrusion-color").constantOr(s.al.white);if(!H&&ee.a!==0){const he=new gn(y.context.gl.LEQUAL,gn.ReadWrite,y.depthRangeFor3D);E===1&&ne?Km(y,a,h,_,he,Un.disabled,nr.unblended,G):(Km(y,a,h,_,he,Un.disabled,nr.disabled,G),Km(y,a,h,_,he,y.stencilModeFor3D(),y.colorModeForRenderPass(),G),y.resetStencilClippingMasks())}if(y.style.enable3dLights()&&ne&&(!j&&y.transform.projection.name!=="globe"||H)){const he=h.paint.get("fill-extrusion-opacity"),we=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),xe=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Ee=h.paint.get("fill-extrusion-flood-light-intensity"),Ce=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",je=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ce?null:h.lut).toArray01().slice(0,3),$e=we>0&&xe>0,We=Ee>0,Ze=(Xe,Ke,tt)=>(1-tt)*Xe+tt*Ke,Ye=Xe=>{const Ke=y.depthModeForSublayer(1,gn.ReadOnly,M.LEQUAL,!0),tt=h.paint.get(Xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),at=Ze(.1,3,tt),At=y._showOverdrawInspector;if(!At){const xt=new Un({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),Bt=new nr([M.ONE,M.ONE,M.ONE,M.ONE],s.al.transparent,[!1,!1,!1,!0],M.MIN);np(y,a,h,_,Ke,xt,Bt,qn.disabled,Xe,"sdf",he,we,xe,Ee,je,at,G,!1)}{const xt=At?Un.disabled:new Un({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),Bt=At?y.colorModeForRenderPass():new nr([M.ONE_MINUS_DST_ALPHA,M.DST_ALPHA,M.ONE,M.ONE],s.al.transparent,[!0,!0,!0,!0]);np(y,a,h,_,Ke,xt,Bt,qn.disabled,Xe,"color",he,we,xe,Ee,je,at,G,!1)}};if(H){const Xe=(Ke,tt,at)=>{const At=y.depthModeForSublayer(1,gn.ReadOnly,M.LEQUAL,!1),xt=h.paint.get(Ke?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Bt=Ze(.1,3,xt);{const zt=new nr([M.ONE,M.ONE,M.ONE,M.ONE],s.al.transparent,[!1,!1,!1,!0]);np(y,a,h,_,At,Un.disabled,zt,qn.disabled,Ke,"clear",he,we,xe,Ee,je,Bt,G,tt)}{const zt=new Un({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),Jt=new nr([M.ONE,M.ONE,M.ONE,M.ONE],s.al.transparent,[!1,!1,!1,!0],M.MIN);np(y,a,h,_,At,zt,Jt,qn.disabled,Ke,"sdf",he,we,xe,Ee,je,Bt,G,tt)}{const zt=Ke?M.ZERO:M.ONE_MINUS_DST_ALPHA,Jt=new Un({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),yt=new nr([zt,M.DST_ALPHA,M.ONE_MINUS_DST_ALPHA,M.ZERO],s.al.transparent,[!0,!0,!0,!0]);np(y,a,h,_,At,Jt,yt,qn.disabled,Ke,"color",he,we,xe,Ee,je,Bt,G,tt)}{const zt=new nr([M.ONE,M.ONE,M.ONE,Ke?M.ZERO:M.ONE],s.al.transparent,[!1,!1,!1,!0],Ke?M.FUNC_ADD:M.MAX);np(y,a,h,_,At,Un.disabled,zt,qn.disabled,Ke,"clear",he,we,xe,Ee,je,Bt,G,tt,at)}};if($e||We){let Ke;if(y.prepareDrawTile(),j){const tt=j.drapeBufferSize[0],at=j.drapeBufferSize[1];Ke=j.framebufferCopyTexture,Ke&&(!Ke||Ke.size[0]===tt&&Ke.size[1]===at)||(Ke&&Ke.destroy(),Ke=j.framebufferCopyTexture=new s.T(C,new s.r({width:tt,height:at}),M.RGBA8)),Ke.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexSubImage2D(M.TEXTURE_2D,0,0,0,0,0,tt,at)}$e&&Xe(!0,!1,Ke),We&&Xe(!1,!0,Ke)}}else $e&&Ye(!0),We&&Ye(!1),($e||We)&&y.resetStencilClippingMasks()}}},hillshade:function(y,a,h,_){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent"||y.style.disableElevatedTerrain)return;const E=y.context,C=y.terrain&&y.terrain.renderingToTexture,[M,j]=y.renderPass!=="translucent"||C?[{},_]:y.stencilConfigForOverlap(_);for(const H of j){const G=a.getTile(H);if(G.needsHillshadePrepare&&y.renderPass==="offscreen")rM(y,G,h);else if(y.renderPass==="translucent"){const Y=y.depthModeForSublayer(0,gn.ReadOnly),ne=h.paint.get("hillshade-emissive-strength"),ee=y.colorModeForDrapableLayerRenderPass(ne),he=C&&y.terrain?y.terrain.stencilModeForRTTOverlap(H):M[H.overscaledZ];Gf(y,H,G,h,Y,he,ee)}}E.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,a,h,_,E,C){if(y.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const M=y.transform.projection.name==="globe",j=h.paint.get("raster-elevation")!==0,H=j&&M;if(y.renderElevatedRasterBackface&&!H)return;const G=y.context,Y=G.gl,ne=a.getSource(),ee=function(Ye,Xe,Ke,tt){const at=Xe.paint.get("raster-color"),At=Ye.type==="raster-array",xt=[],Bt=Xe.paint.get("raster-resampling"),zt=Xe.paint.get("raster-color-mix");let Jt=Xe.paint.get("raster-color-range");const yt=[zt[0],zt[1],zt[2],0],Ft=zt[3];let gt=Bt==="nearest"?tt.NEAREST:tt.LINEAR;if(At&&(xt.push("RASTER_ARRAY"),at||xt.push("RASTER_COLOR"),Bt==="linear"&&xt.push("RASTER_ARRAY_LINEAR"),gt=tt.NEAREST,!Jt&&Ye.rasterLayers)){const Lt=Ye.rasterLayers.find(({id:kt})=>kt===Xe.sourceLayer);Lt&&Lt.fields&&Lt.fields.range&&(Jt=Lt.fields.range)}if(Jt=Jt||[0,1],at){xt.push("RASTER_COLOR"),Ke.activeTexture.set(tt.TEXTURE2),Xe.updateColorRamp(Jt);let Lt=Xe.colorRampTexture;Lt||(Lt=Xe.colorRampTexture=new s.T(Ke,Xe.colorRamp,tt.RGBA8)),Lt.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}return{mix:yt,range:Jt,offset:Ft,defines:xt,resampling:gt}}(ne,h,G,Y);if(ne instanceof s.aK&&!_.length&&!M)return;const he=h.paint.get("raster-emissive-strength"),we=y.colorModeForDrapableLayerRenderPass(he),xe=y.terrain&&y.terrain.renderingToTexture,Ee=!y.options.moving,Ce=h.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR;if(ne instanceof s.aK&&!_.length&&(ne.onNorthPole||ne.onSouthPole)){const Ye=j?y.stencilModeFor3D():Un.disabled;return void St(!!ne.onNorthPole,null,y,a,h,he,ee,qn.disabled,Ye)}if(!_.length)return;const[je,$e]=ne instanceof s.aK||xe?[{},_]:y.stencilConfigForOverlap(_),We=$e[$e.length-1].overscaledZ;H&&ee.defines.push("PROJECTION_GLOBE_VIEW"),j&&ee.defines.push("RENDER_CUTOFF");const Ze=(Ye,Xe,Ke)=>{for(const tt of Ye){const at=tt.toUnwrapped(),At=a.getTile(tt);if(xe&&(!At||!At.hasData()))continue;G.activeTexture.set(Y.TEXTURE0);const xt=Q_(At,ne,h,ee);if(!xt||!xt.texture)continue;const{texture:Bt,mix:zt,offset:Jt,tileSize:yt,buffer:Ft}=xt;let gt,Lt;xe?(gt=gn.disabled,Lt=tt.projMatrix):j?(gt=new gn(Y.LEQUAL,gn.ReadWrite,y.depthRangeFor3D),Lt=M?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(at,Ee)):(gt=y.depthModeForSublayer(tt.overscaledZ-We,h.paint.get("raster-opacity")===1?gn.ReadWrite:gn.ReadOnly,Y.LESS),Lt=y.transform.calculateProjMatrix(at,Ee));const kt=y.terrain&&xe?y.terrain.stencilModeForRTTOverlap(tt):je[tt.overscaledZ],Ut=C?0:h.paint.get("raster-fade-duration");At.registerFadeDuration(Ut);const Rt=a.findLoadedParent(tt,0),Wt=j_(At,Rt,a,y.transform,Ut);let dn,pn;y.terrain&&y.terrain.prepareDrawTile(),G.activeTexture.set(Y.TEXTURE0),Bt.bind(Ce,Y.CLAMP_TO_EDGE),G.activeTexture.set(Y.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(Ce,Y.CLAMP_TO_EDGE),dn=Math.pow(2,Rt.tileID.overscaledZ-At.tileID.overscaledZ),pn=[At.tileID.canonical.x*dn%1,At.tileID.canonical.y*dn%1]):Bt.bind(Ce,Y.CLAMP_TO_EDGE),"useMipmap"in Bt&&G.extTextureFilterAnisotropic&&y.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const xn=y.transform;let kn;const gr=j?oE(xn):[0,0,0,0];let Qn,dr,sr,Kr,vi,Zi=0;if(H&&ne instanceof s.aK&&ne.coordinates.length>3)Qn=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0)))),dr=Float32Array.from(xn.globeMatrix),sr=Float32Array.from(s.cE(xn)),Kr=[s.av(xn.center.lng),s.aC(xn.center.lat)],kn=ne.elevatedGlobePerspectiveTransform,vi=ne.elevatedGlobeGridMatrix||new Float32Array(9);else if(H){const Nn=s.cF(tt.canonical);Zi=s.cG(Nn.getCenter().lat),Qn=Float32Array.from(s.bc(s.cI(tt.canonical))),dr=Float32Array.from(xn.globeMatrix),sr=Float32Array.from(s.cE(xn)),Kr=[s.av(xn.center.lng),s.aC(xn.center.lat)],kn=[0,0],vi=Float32Array.from(s.cH(tt.canonical,Nn,Zi,xn.worldSize/xn._pixelsPerMercatorPixel))}else kn=ne instanceof s.aK?ne.perspectiveTransform:[0,0],Qn=new Float32Array(16),dr=new Float32Array(9),sr=new Float32Array(16),Kr=[0,0],vi=new Float32Array(9);const Br=h1(Lt,Qn,dr,sr,vi,pn||[0,0],s.ag(y.transform.zoom),Kr,gr,dn||1,Wt,h,kn,j?h.paint.get("raster-elevation"):0,2,zt,Jt,ee.range,yt,Ft,he),vs=y.isTileAffectedByFog(tt),yr=y.getOrCreateProgram("raster",{defines:ee.defines,overrideFog:vs});if(y.uploadCommonUniforms(G,yr,at),ne instanceof s.aK){const Nn=ne.elevatedGlobeVertexBuffer,ei=ne.elevatedGlobeIndexBuffer;if(xe||!M)ne.boundsBuffer&&ne.boundsSegments&&yr.draw(y,Y.TRIANGLES,gt,Un.disabled,we,qn.disabled,Br,h.id,ne.boundsBuffer,y.quadTriangleIndexBuffer,ne.boundsSegments);else if(Nn&&ei){const Ai=xn.zoom<=s.c6?ne.elevatedGlobeSegments:ne.getSegmentsForLongitude(xn.center.lng);Ai&&yr.draw(y,Y.TRIANGLES,gt,Un.disabled,we,Xe,Br,h.id,Nn,ei,Ai)}}else if(H){gt=new gn(Y.LEQUAL,gn.ReadOnly,y.depthRangeFor3D);const Nn=y.globeSharedBuffers;if(Nn){const[ei,Ai,mi]=Nn.getGridBuffers(Zi,!1);yr.draw(y,Y.TRIANGLES,gt,Ke||kt,y.colorModeForRenderPass(),Xe,Br,h.id,ei,Ai,mi)}}else{const{tileBoundsBuffer:Nn,tileBoundsIndexBuffer:ei,tileBoundsSegments:Ai}=y.getTileBoundsBuffers(At);yr.draw(y,Y.TRIANGLES,gt,kt,we,qn.disabled,Br,h.id,Nn,ei,Ai)}}if(!(ne instanceof s.aK)&&H)for(const tt of Ye){const at=tt.canonical.y===(1<<tt.canonical.z)-1;tt.canonical.y===0&&St(!0,tt,y,a,h,he,ee,Xe,Ke||Un.disabled),at&&St(!1,tt,y,a,h,he,ee,Xe===qn.frontCW?qn.backCW:qn.frontCW,Ke||Un.disabled)}};H?Ze($e,y.renderElevatedRasterBackface?qn.backCW:qn.frontCW,y.stencilModeFor3D()):Ze($e,qn.disabled,void 0),y.resetStencilClippingMasks()},"raster-particle":function(y,a,h,_,E,C){y.renderPass==="offscreen"&&function(M,j,H,G){if(!G.length)return;const Y=M.context,ne=Y.gl,ee=j.getSource();if(!(ee instanceof xa))return;const he=Math.ceil(Math.sqrt(H.paint.get("raster-particle-count")));let we=H.particlePositionRGBAImage;if(!we||we.width!==he){const $e=function(We){const Ze=We*We,Ye=new Uint8Array(4*Ze),Xe=function(tt){return tt|=0,tt=Math.imul(2747636419^tt,2654435769),tt=Math.imul(tt^tt>>>16,2654435769),((tt=Math.imul(tt^tt>>>16,2654435769))>>>0)/4294967296},Ke=1/1.1;for(let tt=0;tt<Ze;tt++){const at=Ke*(Xe(2*tt+0)+cc),At=Ke*(Xe(2*tt+1)+cc),xt=255*at%1,Bt=255*At%1,zt=xt,Jt=At-Bt/255,yt=Bt;Ye[4*tt+0]=255*(at-xt/255),Ye[4*tt+1]=255*zt,Ye[4*tt+2]=255*Jt,Ye[4*tt+3]=255*yt}return Ye}(he);we=H.particlePositionRGBAImage=new s.r({width:he,height:he},$e)}let xe=H.particleFramebuffer;xe?xe.width!==he&&(xe.destroy(),xe=H.particleFramebuffer=Y.createFramebuffer(he,he,!0,null)):xe=H.particleFramebuffer=Y.createFramebuffer(he,he,!0,null);const Ee=[];for(const $e of G){const We=j.getTile($e);if(!(We instanceof mr))continue;const Ze=aE(We,ee,H);if(!Ze)continue;const Ye=[We.tileSize,We.tileSize];let Xe=H.tileFramebuffer;Xe||(Xe=H.tileFramebuffer=Y.createFramebuffer(Ye[0],Ye[1],!0,null));let Ke=We.rasterParticleState;Ke||(Ke=We.rasterParticleState=new b1(Y,$e,Ye,we));const tt=Ke.update(H.lastInvalidatedAt);Ke.particleTextureDimension!==he&&Ke.updateParticleTexture($e,we);const at=Ke.targetColorTexture;Ke.targetColorTexture=Ke.backgroundColorTexture,Ke.backgroundColorTexture=at;const At=Ke.particleTexture0;Ke.particleTexture0=Ke.particleTexture1,Ke.particleTexture1=At,Ee.push([$e,Ze,Ke,tt])}if(Ee.length===0)return;const Ce=s.q.now(),je=H.previousDrawTimestamp?.001*(Ce-H.previousDrawTimestamp):.0167;if(H.previousDrawTimestamp=Ce,H.hasColorMap()){Y.activeTexture.set(ne.TEXTURE0+2);let $e=H.colorRampTexture;$e||($e=H.colorRampTexture=new s.T(Y,H.colorRamp,ne.RGBA8)),$e.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}Y.bindFramebuffer.set(H.tileFramebuffer.framebuffer),function($e,We,Ze){const Ye=$e.context,Xe=Ye.gl,Ke=We.tileFramebuffer;Ye.activeTexture.set(Xe.TEXTURE0);const tt={u_texture:0,u_opacity:1.05*(At=We.paint.get("raster-particle-fade-opacity-factor"))/(At+.05)},at=$e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var At;for(const xt of Ze){const[,,Bt,zt]=xt;Ke.colorAttachment.set(Bt.targetColorTexture.texture),Ye.viewport.set([0,0,Ke.width,Ke.height]),Ye.clear({color:s.al.transparent}),zt&&(Bt.backgroundColorTexture.bind(Xe.NEAREST,Xe.CLAMP_TO_EDGE),at.draw($e,Xe.TRIANGLES,gn.disabled,Un.disabled,nr.alphaBlended,qn.disabled,tt,We.id,$e.viewportBuffer,$e.quadTriangleIndexBuffer,$e.viewportSegments))}}(M,H,Ee),function($e,We,Ze,Ye){const Xe=$e.context,Ke=Xe.gl,tt=Ze.tileFramebuffer,at=$e.transform.projection.name==="globe",At=Ze.paint.get("raster-particle-max-speed");for(const xt of Ye){const[Bt,zt,Jt]=xt;Xe.activeTexture.set(Ke.TEXTURE0+0),zt.texture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE),tt.colorAttachment.set(Jt.targetColorTexture.texture);const yt=$e.getOrCreateProgram("rasterParticleDraw",{defines:zt.defines,overrideFog:!1});Xe.activeTexture.set(Ke.TEXTURE0+1);const Ft=zt.scalarData?[]:[0,1,2,3].map(kt=>s.d7[kt](Bt));Ft.push(Bt);const gt=Bt.canonical.x,Lt=Bt.canonical.y;for(const kt of Ft){const Ut=We.getTile(at?kt.wrapped():kt);if(!Ut)continue;const Rt=Ut.rasterParticleState;if(!Rt)continue;const Wt=kt.canonical.x+(1<<kt.canonical.z)*(kt.wrap-Bt.wrap),dn=kt.canonical.y;Rt.particleTexture0.bind(Ke.NEAREST,Ke.CLAMP_TO_EDGE);const pn=d1(1,Rt.particleTexture0.size[0],[Wt-gt,dn-Lt],0,zt.texture.size,2,At,zt.textureOffset,zt.scale,zt.offset);yt.draw($e,Ke.POINTS,gn.disabled,Un.disabled,nr.alphaBlended,qn.disabled,pn,Ze.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}}(M,j,H,Ee),Y.bindFramebuffer.set(H.particleFramebuffer.framebuffer),function($e,We,Ze,Ye){const Xe=$e.context,Ke=Xe.gl,tt=We.paint.get("raster-particle-max-speed"),at=Ye*We.paint.get("raster-particle-speed-factor")*.15,At=function(Bt){return Math.pow(Bt,6)}(.01+1*We.paint.get("raster-particle-reset-rate-factor")),xt=We.particleFramebuffer;Xe.viewport.set([0,0,xt.width,xt.height]);for(const Bt of Ze){const[,zt,Jt]=Bt;Xe.activeTexture.set(Ke.TEXTURE0+0),zt.texture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE),Xe.activeTexture.set(Ke.TEXTURE0+1);const yt=Jt.particleTexture0;yt.bind(Ke.NEAREST,Ke.CLAMP_TO_EDGE);const Ft=fM(1,yt.size[0],0,zt.texture.size,tt,at,At,zt.textureOffset,zt.scale,zt.offset);xt.colorAttachment.set(Jt.particleTexture1.texture),Xe.clear({color:s.al.transparent}),$e.getOrCreateProgram("rasterParticleUpdate",{defines:zt.defines}).draw($e,Ke.TRIANGLES,gn.disabled,Un.disabled,nr.unblended,qn.disabled,Ft,We.id,$e.viewportBuffer,$e.quadTriangleIndexBuffer,$e.viewportSegments)}}(M,H,Ee,je)}(y,a,h,_),y.renderPass==="translucent"&&(function(M,j,H,G,Y){const ne=M.context,ee=ne.gl,he=j.getSource().tileSize,we=5*(1-s.ae(s.bY,s.bY+1,M.transform.zoom))*he+H.paint.get("raster-particle-elevation"),xe=!M.options.moving,Ee=M.transform.projection.name==="globe";if(!G.length)return;const[Ce,je]=M.stencilConfigForOverlap(G),$e=[];Ee&&$e.push("PROJECTION_GLOBE_VIEW");const We=M.stencilModeFor3D();for(const Ze of je){const Ye=Ze.toUnwrapped(),Xe=j.getTile(Ze);if(!Xe.rasterParticleState)continue;const Ke=Xe.rasterParticleState,tt=100;Xe.registerFadeDuration(tt);const at=j.findLoadedParent(Ze,0),At=j_(Xe,at,j,M.transform,tt);let xt,Bt;M.terrain&&M.terrain.prepareDrawTile(),ne.activeTexture.set(ee.TEXTURE0),Ke.targetColorTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ne.activeTexture.set(ee.TEXTURE1),at&&at.rasterParticleState?(at.rasterParticleState.targetColorTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),xt=Math.pow(2,at.tileID.overscaledZ-Xe.tileID.overscaledZ),Bt=[Xe.tileID.canonical.x*xt%1,Xe.tileID.canonical.y*xt%1]):Ke.targetColorTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const zt=Ee?Float32Array.from(M.transform.expandedFarZProjMatrix):M.transform.calculateProjMatrix(Ye,xe),Jt=M.transform,yt=lE(Jt),Ft=s.cF(Ze.canonical),gt=s.cG(Ft.getCenter().lat);let Lt,kt,Ut,Rt,Wt;Ee?(Lt=Float32Array.from(s.bc(s.cI(Ze.canonical))),kt=Float32Array.from(Jt.globeMatrix),Ut=Float32Array.from(s.cE(Jt)),Rt=[s.av(Jt.center.lng),s.aC(Jt.center.lat)],Wt=Float32Array.from(s.cH(Ze.canonical,Ft,gt,Jt.worldSize/Jt._pixelsPerMercatorPixel))):(Lt=new Float32Array(16),kt=new Float32Array(9),Ut=new Float32Array(16),Rt=[0,0],Wt=new Float32Array(9));const dn=Gn(zt,Lt,kt,Ut,Wt,Bt||[0,0],s.ag(M.transform.zoom),Rt,yt,xt||1,At,we),pn=M.isTileAffectedByFog(Ze),xn=M.getOrCreateProgram("rasterParticle",{defines:$e,overrideFog:pn});if(M.uploadCommonUniforms(ne,xn,Ye),Ee){const kn=new gn(ee.LEQUAL,gn.ReadOnly,M.depthRangeFor3D),gr=0,Qn=M.globeSharedBuffers;if(Qn){const[dr,sr,Kr]=Qn.getGridBuffers(gt,gr!==0);xn.draw(M,ee.TRIANGLES,kn,We,nr.alphaBlended,M.renderElevatedRasterBackface?qn.frontCCW:qn.backCCW,dn,H.id,dr,sr,Kr)}}else{const kn=M.depthModeForSublayer(0,gn.ReadOnly),gr=Ce[Ze.overscaledZ],{tileBoundsBuffer:Qn,tileBoundsIndexBuffer:dr,tileBoundsSegments:sr}=M.getTileBoundsBuffers(Xe);xn.draw(M,ee.TRIANGLES,kn,gr,nr.alphaBlended,qn.disabled,dn,H.id,Qn,dr,sr)}}M.resetStencilClippingMasks()}(y,a,h,_),y.style.map.triggerRepaint())},background:function(y,a,h,_){const E=h.paint.get("background-color"),C=h.paint.get("background-color-use-theme").constantOr("default")==="none",M=h.paint.get("background-opacity"),j=h.paint.get("background-emissive-strength"),H=h.paint.get("background-pitch-alignment")==="viewport";if(M===0)return;const G=y.context,Y=G.gl,ne=y.transform,ee=ne.tileSize,he=h.paint.get("background-pattern");let we;if(he!==void 0&&(he===null||(we=y.imageManager.getPattern(s.I.from(he.toString()),h.scope,y.style.getLut(h.scope)),!we)))return;const xe=!he&&E.a===1&&M===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==xe)return;const Ee=Un.disabled,Ce=y.depthModeForSublayer(0,xe==="opaque"?gn.ReadWrite:gn.ReadOnly),je=y.colorModeForDrapableLayerRenderPass(j),$e=he?"backgroundPattern":"background";let We,Ze=_;if(Ze||(We=y.getBackgroundTiles(),Ze=Object.values(We).map(Ye=>Ye.tileID)),he&&(G.activeTexture.set(Y.TEXTURE0),y.imageManager.bind(y.context,h.scope)),H){const Ye=y.getOrCreateProgram($e,{overrideFog:!1,overrideRtt:!0}),Xe=new Float32Array(s.ad.mat4.identity([])),Ke=new s.aH(0,0,0,0,0),tt=he?rE(Xe,j,M,y,0,h.scope,we,H,{tileID:Ke,tileSize:ee}):f1(Xe,j,M,E.toRenderColor(C?null:h.lut));Ye.draw(y,Y.TRIANGLES,Ce,Ee,je,qn.disabled,tt,h.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments)}else for(const Ye of Ze){const Xe=y.isTileAffectedByFog(Ye),Ke=y.getOrCreateProgram($e,{overrideFog:Xe}),tt=Ye.toUnwrapped(),at=_?Ye.projMatrix:y.transform.calculateProjMatrix(tt);y.prepareDrawTile();const At=a?a.getTile(Ye):We?We[Ye.key]:new qs(Ye,ee,ne.zoom,y),xt=he?rE(at,j,M,y,0,h.scope,we,H,{tileID:Ye,tileSize:ee}):f1(at,j,M,E.toRenderColor(C?null:h.lut));y.uploadCommonUniforms(G,Ke,tt);const{tileBoundsBuffer:Bt,tileBoundsIndexBuffer:zt,tileBoundsSegments:Jt}=y.getTileBoundsBuffers(At);Ke.draw(y,Y.TRIANGLES,Ce,Ee,je,qn.disabled,xt,h.id,Bt,zt,Jt)}},sky:function(y,a,h){const _=y._atmosphere?s.ag(y.transform.zoom):1,E=h.paint.get("sky-opacity")*_;if(E===0)return;const C=y.context,M=h.paint.get("sky-type"),j=new gn(C.gl.LEQUAL,gn.ReadOnly,[0,1]),H=y.frameCounter/1e3%1;M==="atmosphere"?y.renderPass==="offscreen"?h.needsSkyboxCapture(y)&&(function(G,Y,ne,ee){const he=G.context,we=he.gl;let xe=Y.skyboxFbo;if(!xe){xe=Y.skyboxFbo=he.createFramebuffer(32,32,!0,null),Y.skyboxGeometry=new uE(he),Y.skyboxTexture=he.gl.createTexture(),we.bindTexture(we.TEXTURE_CUBE_MAP,Y.skyboxTexture),we.texParameteri(we.TEXTURE_CUBE_MAP,we.TEXTURE_WRAP_S,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_CUBE_MAP,we.TEXTURE_WRAP_T,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_CUBE_MAP,we.TEXTURE_MIN_FILTER,we.LINEAR),we.texParameteri(we.TEXTURE_CUBE_MAP,we.TEXTURE_MAG_FILTER,we.LINEAR);for(let $e=0;$e<6;++$e)we.texImage2D(we.TEXTURE_CUBE_MAP_POSITIVE_X+$e,0,we.RGBA,32,32,0,we.RGBA,we.UNSIGNED_BYTE,null)}he.bindFramebuffer.set(xe.framebuffer),he.viewport.set([0,0,32,32]);const Ee=Y.getCenter(G,!0),Ce=G.getOrCreateProgram("skyboxCapture"),je=new Float64Array(16);s.ad.mat4.identity(je),s.ad.mat4.rotateY(je,je,.5*-Math.PI),Qo(G,Y,Ce,je,Ee,0),s.ad.mat4.identity(je),s.ad.mat4.rotateY(je,je,.5*Math.PI),Qo(G,Y,Ce,je,Ee,1),s.ad.mat4.identity(je),s.ad.mat4.rotateX(je,je,.5*-Math.PI),Qo(G,Y,Ce,je,Ee,2),s.ad.mat4.identity(je),s.ad.mat4.rotateX(je,je,.5*Math.PI),Qo(G,Y,Ce,je,Ee,3),s.ad.mat4.identity(je),Qo(G,Y,Ce,je,Ee,4),s.ad.mat4.identity(je),s.ad.mat4.rotateY(je,je,Math.PI),Qo(G,Y,Ce,je,Ee,5),he.viewport.set([0,0,G.width,G.height])}(y,h),h.markSkyboxValid(y)):y.renderPass==="sky"&&function(G,Y,ne,ee,he){const we=G.context,xe=we.gl,Ee=G.transform,Ce=G.getOrCreateProgram("skybox");we.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_CUBE_MAP,Y.skyboxTexture);const je=(($e,We,Ze,Ye,Xe)=>({u_matrix:$e,u_sun_direction:We,u_cubemap:0,u_opacity:Ye,u_temporal_offset:Xe}))(Ee.skyboxMatrix,Y.getCenter(G,!1),0,ee,he);G.uploadCommonUniforms(we,Ce),Ce.draw(G,xe.TRIANGLES,ne,Un.disabled,G.colorModeForRenderPass(),qn.backCW,je,"skybox",Y.skyboxGeometry.vertexBuffer,Y.skyboxGeometry.indexBuffer,Y.skyboxGeometry.segment)}(y,h,j,E,H):M==="gradient"&&y.renderPass==="sky"&&function(G,Y,ne,ee,he){const we=G.context,xe=we.gl,Ee=G.transform,Ce=G.getOrCreateProgram("skyboxGradient");Y.skyboxGeometry||(Y.skyboxGeometry=new uE(we)),we.activeTexture.set(xe.TEXTURE0);let je=Y.colorRampTexture;je||(je=Y.colorRampTexture=new s.T(we,Y.colorRamp,xe.RGBA8)),je.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);const $e=((We,Ze,Ye,Xe,Ke)=>({u_matrix:We,u_color_ramp:0,u_center_direction:Ze,u_radius:s.ak(Ye),u_opacity:Xe,u_temporal_offset:Ke}))(Ee.skyboxMatrix,Y.getCenter(G,!1),Y.paint.get("sky-gradient-radius"),ee,he);G.uploadCommonUniforms(we,Ce),Ce.draw(G,xe.TRIANGLES,ne,Un.disabled,G.colorModeForRenderPass(),qn.backCW,$e,"skyboxGradient",Y.skyboxGeometry.vertexBuffer,Y.skyboxGeometry.indexBuffer,Y.skyboxGeometry.segment)}(y,h,j,E,H)},debug:function(y,a,h,_,E,C){for(let M=0;M<h.length;M++)if(E){const G=new s.al(_.r*.8,_.g*.8,_.b*.8,1);Kh(y,a,h[M],_,-1,-1,C),Kh(y,a,h[M],_,-1,1,C),Kh(y,a,h[M],_,1,1,C),Kh(y,a,h[M],_,1,-1,C),Kh(y,a,h[M],G,0,0,C)}else Kh(y,a,h[M],_,0,0,C)},custom:function(y,a,h,_){const E=y.context,C=h.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&h.isDraped(a)){if(y.renderPass==="offscreen"){const M=C.prerender;if(M){if(y.setCustomLayerDefaults(),E.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const j=y.transform.pointMerc;M.call(C,E.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),s.ag(y.transform.zoom),[j.x,j.y],y.transform.pixelsPerMeterRatio)}else M.call(C,E.gl,y.transform.customLayerMatrix());E.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const j=C.renderToTile;if(j){const H=_[0].canonical,G=new s.ac(H.x+_[0].wrap*(1<<H.z),H.y,H.z);E.setDepthMode(gn.disabled),E.setStencilMode(Un.disabled),E.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),j.call(C,E.gl,G),E.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),E.setColorMode(y.colorModeForRenderPass()),E.setStencilMode(Un.disabled);const M=C.renderingMode==="3d"?new gn(y.context.gl.LEQUAL,gn.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,gn.ReadOnly);if(E.setDepthMode(M),y.transform.projection.name==="globe"){const j=y.transform.pointMerc;C.render(E.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),s.ag(y.transform.zoom),[j.x,j.y],y.transform.pixelsPerMeterRatio)}else C.render(E.gl,y.transform.customLayerMatrix());E.setDirty(),y.setBaseState(),E.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(y,a,h,_){if(y.renderPass==="opaque")return;const E=h.paint.get("model-opacity").constantOr(1);if(E===0)return;const C=h.paint.get("model-cast-shadows");if(y.renderPass==="shadow"&&(!C||y.terrain&&E<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const M=y.shadowRenderer,j=h.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,j||(M.enabled=!1));const H=()=>{M&&(M.useNormalOffset=!0,j||(M.enabled=!0))},G=a.getSource();if(y.renderPass==="light-beam"&&G.type!=="batched-model")return;if(G.type==="vector"||G.type==="geojson")return function(Ce,je,$e,We,Ze){const Ye=Ce.transform;if(Ye.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${Ye.projection.name} projection is not yet implemented`);const Xe=Ye.getFreeCameraOptions().position;if(!Ce.modelManager)return;const Ke=Ce.modelManager;$e.modelManager=Ke;const tt=Ce.shadowRenderer;if(!$e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const at=$e._unevaluatedLayout._values["model-id"],At=Object.assign({},$e.layout.get("model-id").parameters),xt=Ce.style.order.indexOf($e.fqid);for(const Bt of We){const zt=je.getTile(Bt).getBucket($e);if(!zt||zt.projection.name!==Ye.projection.name)continue;const Jt=zt.getModelUris();Jt&&!zt.modelsRequested&&(Ke.addModelsFromBucket(Jt,Ze),zt.modelsRequested=!0);const yt=T1(Bt,Ye);At.zoom=yt;const Ft=at.possiblyEvaluate(At);if(S1(Ce,zt,Bt),Mc.shadowUniformsInitialized=!1,Mc.useSingleShadowCascade=!!tt&&tt.getMaxCascadeForTile(Bt.toUnwrapped())===0,Ce.renderPass==="shadow"&&tt){if(Ce.currentShadowCascade===1&&zt.isInsideFirstShadowMapFrustum)continue;const kt=Ye.calculatePosMatrix(Bt.toUnwrapped(),Ye.worldSize);if(Mc.tileMatrix.set(kt),Mc.shadowTileMatrix=Float32Array.from(tt.calculateShadowPassMatrixFromMatrix(kt)),Mc.aabb.min.fill(0),Mc.aabb.max[0]=Mc.aabb.max[1]=s.ai,Mc.aabb.max[2]=0,t0(zt,Mc,Ce,$e.scope))continue}const gt=1<<Bt.canonical.z,Lt=[((Xe.x-Bt.wrap)*gt-Bt.canonical.x)*s.ai,(Xe.y*gt-Bt.canonical.y)*s.ai,Xe.z*gt*s.ai];Ce.conflationActive&&Object.keys(zt.instancesPerModel).length>0&&Ce.style.isLayerClipped($e,je.getSource())&&zt.updateReplacement(Bt,Ce.replacementSource,xt,Ze)&&(zt.uploaded=!1,zt.upload(Ce.context));for(let kt in zt.instancesPerModel){const Ut=zt.instancesPerModel[kt];Ut.features.length>0&&(kt=Ft.evaluate(Ut.features[0].feature,{}));const Rt=Ke.getModel(kt,Ze);if(Rt&&Rt.uploaded)for(const Wt of Rt.nodes)Jc(Ce,$e,Wt,Ut,Lt,Bt,Mc)}}}(y,a,h,_,G.type==="vector"?h.scope:""),void H();if(!G.loaded())return;if(G.type==="batched-model")return function(Ce,je,$e,We){$e.resetLayerRenderingStats(Ce);const Ze=Ce.context,Ye=Ce.transform,Xe=Ce.style.fog,Ke=Ce.shadowRenderer;if(Ye.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${Ye.projection.name} projection is not yet implemented`);const tt=Ce.transform.getFreeCameraOptions().position,at=s.ad.vec3.scale([],[tt.x,tt.y,tt.z],Ce.transform.worldSize),At=s.ad.vec3.negate([],at),xt=s.ad.mat4.identity([]),Bt=s.dm(Ye.center.lat,Ye.zoom),zt=s.ad.mat4.fromScaling([],[1,1,1/Bt]);s.ad.mat4.translate(xt,xt,At);const Jt=$e.paint.get("model-opacity").constantOr(1),yt=new gn(Ze.gl.LEQUAL,gn.ReadWrite,Ce.depthRangeFor3D),Ft=new gn(Ze.gl.LEQUAL,gn.ReadOnly,Ce.depthRangeFor3D),gt=new s.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Lt=Ce.renderPass==="shadow",kt=Lt&&Ke?Ke.getCurrentCascadeFrustum():Ye.getFrustum(Ye.scaleZoom(Ye.worldSize)),Ut=$e.paint.get("model-front-cutoff"),Rt=Ut[2]<1,Wt=Nl(Ce,$e.paint.get("model-cutoff-fade-range")),dn=$e.getLayerRenderingStats();(function(pn,xn,kn,gr){const Qn=pn.terrain?pn.terrain.exaggeration():0,dr=pn.transform.zoom;for(const sr of gr){const Kr=xn.getTile(sr).getBucket(kn);Kr&&(Kr.setFilter(kn.filter),pn.conflationActive&&Kr.updateReplacement(sr,pn.replacementSource),Kr.evaluateScale(pn,kn),pn.terrain&&Qn>0&&Kr.elevationUpdate(pn.terrain,Qn,sr,kn.source),Kr.needsReEvaluation(pn,dr,kn)&&Kr.evaluate(kn))}})(Ce,je,$e,We),function(){let pn,xn,kn;Rt?(pn=We.length-1,xn=-1,kn=-1):(pn=0,xn=We.length,kn=1);const gr=new Float64Array(16),Qn=s.ad.vec3.create(),dr=new s.P(0,0);for(let sr=pn;sr!==xn;sr+=kn){const Kr=We[sr],vi=je.getTile(Kr).getBucket($e);if(!vi||!vi.uploaded)continue;let Zi=!1;Ke&&(Zi=Ke.getMaxCascadeForTile(Kr.toUnwrapped())===0);const Br=Ye.calculatePosMatrix(Kr.toUnwrapped(),Ye.worldSize),vs=vi.modelTraits;!Lt&&Rt&&(s.ad.mat4.invert(gr,Br),s.ad.vec3.transformMat4(Qn,at,gr),dr.x=Qn[0],dr.y=Qn[1]);const yr=[];vi.setFilter($e.filter);for(const Nn of vi.getNodesInfo()){if(Nn.hiddenByReplacement||!Nn.node.meshes)continue;const ei=Nn.node;let Ai=0;Ce.terrain&&ei.elevation&&(Ai=ei.elevation*Ce.terrain.exaggeration());const mi=(()=>{const Ui=Nn.aabb;return gt.min=[...Ui.min],gt.max=[...Ui.max],gt.min[2]+=Ai,gt.max[2]+=Ai,s.ad.vec3.transformMat4(gt.min,gt.min,Br),s.ad.vec3.transformMat4(gt.max,gt.max,Br),gt})(),Vs=Nn.evaluatedScale;if(Vs[0]<=1&&Vs[1]<=1&&Vs[2]<=1&&mi.intersects(kt)===0)continue;if(!Lt&&Rt){const Ui=.16666666666666666;Nn.cameraCollisionOpacity=at[0]>mi.min[0]&&at[0]<mi.max[0]&&at[1]>mi.min[1]&&at[1]<mi.max[1]&&at[2]*Bt<mi.max[2]&&ei.footprint&&s.bA(dr,ei.footprint)?Math.max(Nn.cameraCollisionOpacity-Ui,0):Math.min(1,Nn.cameraCollisionOpacity+Ui)}const go=[...Br],Mo=ei.anchor?ei.anchor[0]:0,zo=ei.anchor?ei.anchor[1]:0;s.ad.mat4.translate(go,go,[Mo*(Vs[0]-1),zo*(Vs[1]-1),Ai]),s.ad.vec3.exactEquals(Vs,s.dq)||s.ad.mat4.scale(go,go,Vs);const dc=s.ad.mat4.multiply([],go,ei.matrix),Wa=s.ad.mat4.multiply([],Ye.expandedFarZProjMatrix,dc),di=s.ad.mat4.multiply([],Ye.expandedFarZProjMatrix,go),bs=s.ad.vec4.transformMat4([],[Mo,zo,Ai,1],Wa)[2];ei.hidden=!1;let bi=Jt;Lt||(Rt&&(bi*=Nn.cameraCollisionOpacity,bi*=C1(go,Ye,Nn.aabb,Ut)),bi*=n0(Wt,bs)),bi!==0?yr.push({nodeInfo:Nn,depth:bs,opacity:bi,wvpForNode:Wa,wvpForTile:di,nodeModelMatrix:dc,tileModelMatrix:go}):ei.hidden=!0}Lt||yr.sort((Nn,ei)=>!Rt||Nn.opacity===1&&ei.opacity===1?Nn.depth<ei.depth?-1:1:Nn.opacity===1?-1:ei.opacity===1?1:Nn.depth>ei.depth?-1:1);for(const Nn of yr){const ei=Nn.nodeInfo,Ai=ei.node;let mi=s.ad.mat4.multiply([],zt,Nn.tileModelMatrix);s.ad.mat4.multiply(mi,xt,mi);const Vs=s.ad.mat4.invert([],mi);s.ad.mat4.transpose(Vs,Vs),s.ad.mat4.scale(Vs,Vs,Zh),mi=s.ad.mat4.multiply(mi,mi,Ai.matrix);const go=Ce.renderPass==="light-beam",Mo=$e.paint.get("model-color-use-theme").constantOr("default")==="none",zo=vs&s.ds.HasMapboxMeshFeatures,dc=zo?0:ei.evaluatedRMEA[0][2];for(let Wa=0;Wa<Ai.meshes.length;++Wa){const di=Ai.meshes[Wa],bs=Wa===Ai.lightMeshIndex;let bi=Nn.wvpForNode;if(bs){if(!go&&!Ce.terrain&&Ce.shadowRenderer){Ce.currentLayer<Ce.firstLightBeamLayer&&(Ce.firstLightBeamLayer=Ce.currentLayer);continue}bi=Nn.wvpForTile}else if(go)continue;const Ui={defines:[]},ua=[];if(!Lt&&Ke&&(Ke.useNormalOffset=!!di.normalBuffer),lp(Ui.defines,ua,di,Ce,Mo?null:$e.lut),zo||Ui.defines.push("DIFFUSE_SHADED"),Zi&&Ui.defines.push("SHADOWS_SINGLE_CASCADE"),dn&&(Lt?dn.numRenderedVerticesInShadowPass+=di.vertexArray.length:dn.numRenderedVerticesInTransparentPass+=di.vertexArray.length),Lt){Qm(di,Nn.nodeModelMatrix,Ce,$e);continue}let ps=null;if(Xe){const kc=sh(Nn.nodeModelMatrix,Ce.transform);if(ps=new Float32Array(kc),Ye.projection.name!=="globe"){const jl=di.aabb.min,lh=di.aabb.max,[ku,ch]=Xe.getOpacityForBounds(kc,jl[0],jl[1],lh[0],lh[1]);Ui.overrideFog=ku>=hn||ch>=hn}}const Po=di.material;let Du;Po.occlusionTexture&&Po.occlusionTexture.offsetScale&&(Du=Po.occlusionTexture.offsetScale,Ui.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const zl=Ce.getOrCreateProgram("model",Ui);!Lt&&Ke&&Ke.setupShadowsFromMatrix(Nn.tileModelMatrix,zl,Ke.useNormalOffset),Ce.uploadCommonUniforms(Ze,zl,null,ps);const Dc=Po.pbrMetallicRoughness;Dc.metallicFactor=.9,Dc.roughnessFactor=.5;const ml=p1(new Float32Array(bi),new Float32Array(mi),new Float32Array(Vs),new Float32Array(Ai.matrix),Ce,Nn.opacity,Dc.baseColorFactor.toRenderColor(null),Po.emissiveFactor,Dc.metallicFactor,Dc.roughnessFactor,Po,dc,$e,[0,0,0],Du);!bs&&(ei.hasTranslucentParts||Nn.opacity<1)&&zl.draw(Ce,Ze.gl.TRIANGLES,yt,Un.disabled,nr.disabled,qn.backCCW,ml,$e.id,di.vertexBuffer,di.indexBuffer,di.segments,$e.paint,Ce.transform.zoom,void 0,ua),zl.draw(Ce,Ze.gl.TRIANGLES,bs?Ft:yt,Un.disabled,bs||Nn.opacity<1||ei.hasTranslucentParts?nr.alphaBlended:nr.unblended,qn.backCCW,ml,$e.id,di.vertexBuffer,di.indexBuffer,di.segments,$e.paint,Ce.transform.zoom,void 0,ua)}}}}()}(y,a,h,_),void H();if(G.type!=="model")return;const Y=G.getModels(),ne=[],ee=y.transform.getFreeCameraOptions().position,he=s.ad.vec3.scale([],[ee.x,ee.y,ee.z],y.transform.worldSize);s.ad.vec3.negate(he,he);const we=[],xe=[];let Ee=0;for(const Ce of Y){const je=h.paint.get("model-rotation").constantOr(null),$e=h.paint.get("model-scale").constantOr(null),We=h.paint.get("model-translation").constantOr(null);Ce.computeModelMatrix(y,je,$e,We,!0,!0,!1);const Ze=s.ad.mat4.identity([]),Ye=s.dm(Ce.position.lat,y.transform.zoom),Xe=s.ad.mat4.fromScaling([],[1,1,1/Ye]);s.ad.mat4.translate(Ze,Ze,he),ne.push({zScaleMatrix:Xe,negCameraPosMatrix:Ze});for(const Ke of Ce.nodes)Hd(y.transform,Ke,Ce.matrix,y.transform.expandedFarZProjMatrix,Ee,we,xe);Ee++}if(we.sort((Ce,je)=>je.depth-Ce.depth),y.renderPass!=="shadow"){if(E===1)for(const Ce of xe)oh(Ce,y,h,ne[Ce.modelIndex],Un.disabled,y.colorModeForRenderPass());else{for(const Ce of xe)oh(Ce,y,h,ne[Ce.modelIndex],Un.disabled,nr.disabled);for(const Ce of xe)oh(Ce,y,h,ne[Ce.modelIndex],y.stencilModeFor3D(),y.colorModeForRenderPass());y.resetStencilClippingMasks()}for(const Ce of we)oh(Ce,y,h,ne[Ce.modelIndex],Un.disabled,y.colorModeForRenderPass());H()}else{for(const Ce of xe)Qm(Ce.mesh,Ce.nodeModelMatrix,y,h);for(const Ce of we)Qm(Ce.mesh,Ce.nodeModelMatrix,y,h);H()}}},o0={line:function(y,a,h){if(y.hasElevatedBuckets=!1,y.hasNonElevatedBuckets=!1,y._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||y._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(a){const _=a.getVisibleCoordinates();for(const E of _){const C=a.getTile(E).getBucket(y);if(C&&(C.hasZOffset?y.hasElevatedBuckets=!0:y.hasNonElevatedBuckets=!0,y.hasElevatedBuckets&&y.hasNonElevatedBuckets))break}}}else y.hasNonElevatedBuckets=!0},model:function(y,a,h){const _=a.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,_.type==="vector"?y.scope:""));if(_.type==="batched-model"||_.type!=="model")return;const E=_.getModels();for(const C of E)C.upload(h.context)},raster:function(y,a,h){const _=a.getSource();if(!(_ instanceof xa&&_.loaded()))return;const E=y.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!E)return;const C=y.paint.get("raster-array-band")||_.getInitialBand(E);if(C==null)return;const M=a.getIds().map(j=>a.getTileByID(j));for(const j of M)j.updateNeeded(E,C)&&_.prepareTile(j,E,C)},"raster-particle":function(y,a,h){const _=a.getSource();if(!(_ instanceof xa&&_.loaded()))return;const E=y.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!E)return;const C=y.paint.get("raster-particle-array-band")||_.getInitialBand(E);if(C==null)return;const M=a.getIds().map(j=>a.getTileByID(j));for(const j of M)j.updateNeeded(E,C)&&_.prepareTile(j,E,C)}},a0={fill:x1};class l0{constructor(a,h,_,E,C){this.context=new Xh(a,h),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=C,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const M=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const H of M)this._debugParams.enabledLayers[H]=!0;C.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),C.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),C.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),C.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const H of M)C.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],H);this.occlusionParams=new A1(C),this.setup(),this.numSublayers=Za.maxUnderzooming+Za.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new S(this),this._wireframeDebugCache=new Wd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const j=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,j,a.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=E}updateTerrain(a,h){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Z2(this,a));const E=this._terrain;this.transform.elevation=_?E:null,E.update(a,this.transform,h),this.transform.elevation&&!E.enabled&&(this.transform.elevation=null)}_updateFog(a){const h=a.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,E]=h.getFovAdjustedRange(this.transform._fov);if(_>E)return void(this.transform.fogCullDistSq=null);const C=_+.78*(E-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new Z2(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,h){if(this.width=a*s.q.devicePixelRatio,this.height=h*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const a=this.context,h=new s.b5;h.emplaceBack(0,0),h.emplaceBack(s.ai,0),h.emplaceBack(0,s.ai),h.emplaceBack(s.ai,s.ai),this.tileExtentBuffer=a.createVertexBuffer(h,s.b7.members),this.tileExtentSegments=s.b8.simpleSegment(0,0,4,2);const _=new s.b5;_.emplaceBack(0,0),_.emplaceBack(s.ai,0),_.emplaceBack(0,s.ai),_.emplaceBack(s.ai,s.ai),this.debugBuffer=a.createVertexBuffer(_,s.b7.members),this.debugSegments=s.b8.simpleSegment(0,0,4,5);const E=new s.b5;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(E,s.b7.members),this.viewportSegments=s.b8.simpleSegment(0,0,4,2);const C=new s.aU;C.emplaceBack(0,0,0,0),C.emplaceBack(s.ai,0,s.ai,0),C.emplaceBack(0,s.ai,0,s.ai),C.emplaceBack(s.ai,s.ai,s.ai,s.ai),this.mercatorBoundsBuffer=a.createVertexBuffer(C,s.ba.members),this.mercatorBoundsSegments=s.b8.simpleSegment(0,0,4,2);const M=new s.aV;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(M);const j=new s.b6;for(const G of[0,1,3,2,0])j.emplaceBack(G);this.debugIndexBuffer=a.createIndexBuffer(j),this.emptyTexture=new s.T(a,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA8),this.identityMat=s.ad.mat4.create();const H=this.context.gl;this.stencilClearMode=new Un({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,gn.disabled,this.stencilClearMode,nr.disabled,qn.disabled,Kf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,_){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let j=!1;for(const H of _)if(this._tileClippingMaskIDs[H.key]===void 0){j=!0;break}if(!j)return}this.currentStencilSource=h.id;const E=this.context,C=E.gl;this.nextStencilID+_.length>256&&this.clearStencil(),E.setColorMode(nr.disabled),E.setDepthMode(gn.disabled);const M=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of _){const H=h.getTile(j),G=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ne,tileBoundsSegments:ee}=this.getTileBoundsBuffers(H);M.draw(this,C.TRIANGLES,gn.disabled,new Un({func:C.ALWAYS,mask:0},G,255,C.KEEP,C.KEEP,C.REPLACE),nr.disabled,qn.disabled,Kf(j.projMatrix),"$clipping",Y,ne,ee)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new Un({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new Un({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,_=a.sort((M,j)=>j.overscaledZ-M.overscaledZ),E=_[_.length-1].overscaledZ,C=_[0].overscaledZ-E+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const M={};for(let j=0;j<C;j++)M[j+E]=new Un({func:h.GEQUAL,mask:255},j+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[M,_]}return[{[E]:Un.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new nr([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new s.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?nr.unblended:nr.alphaBlended}colorModeForDrapableLayerRenderPass(a){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new nr([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new s.al(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,h,_,E=!1){if(this.depthOcclusion)return new gn(this.context.gl.GREATER,gn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!E)return gn.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new gn(_||this.context.gl.LEQUAL,h,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const a=this.context.gl,h=Math.ceil(this.width),_=Math.ceil(this.height),E=this.context.bindFramebuffer.get(),C=a.getParameter(a.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&_!==0&&(this.depthFBO=new fl(this.context,h,_,!1,"texture"),this.depthTexture=new s.T(this.context,{width:h,height:_,data:null},a.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(E),a.bindTexture(a.TEXTURE_2D,C),this.depthFBO&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),a.blitFramebuffer(0,0,h,_,0,0,h,_,a.DEPTH_BUFFER_BIT,a.NEAREST),a.bindFramebuffer(a.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,h)=>a+h/this._fpsHistory.length,0))}render(a,h){const _=s.q.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=h;const E=this.style._mergedLayers,C=!(!this.terrain||!this.terrain.enabled),M=()=>this.style._getOrder(C).filter(yt=>{const Ft=E[yt];return!(Ft.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ft.type]});let j=M(),H=!1,G=!1;for(const yt of j){const Ft=E[yt];Ft.type==="circle"&&(H=!0),Ft.type==="symbol"&&(Ft.hasInitialOcclusionOpacityProperties?G=!0:H=!0)}let Y=j.map(yt=>E[yt]);const ne=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let ee=0,he=!1;for(const yt in ne){const Ft=ne[yt];Ft.used&&(Ft.prepare(this.context),Ft.getSource().usedInConflation&&++ee)}let we=!1;for(const yt of Y)yt.isHidden(this.transform.zoom)||(yt.type==="clip"&&(we=!0),this.prepareLayer(yt));const xe={},Ee={},Ce={},je={},$e={};for(const yt in ne){const Ft=ne[yt];xe[yt]=Ft.getVisibleCoordinates(),Ee[yt]=xe[yt].slice().reverse(),Ce[yt]=Ft.getVisibleCoordinates(!0).reverse(),je[yt]=Ft.getShadowCasterCoordinates(),$e[yt]=Ft.sortCoordinatesByDistance(xe[yt])}const We=yt=>{const Ft=this.style.getLayerSourceCache(yt);return Ft&&Ft.used?Ft.getSource():null};if(ee||we||this._clippingActiveLastFrame){const yt=[],Ft=[];let gt=0;for(const Lt of Y)this.isSourceForClippingOrConflation(Lt,We(Lt))&&(yt.push(Lt),Ft.push(gt)),gt++;if(yt&&(we||yt.length>1)||this._clippingActiveLastFrame){we=!1;const Lt=[];for(let kt=0;kt<yt.length;kt++){const Ut=yt[kt],Rt=Ft[kt],Wt=this.style.getLayerSourceCache(Ut);if(!Wt||!Wt.used||!Wt.getSource().usedInConflation&&Ut.type!=="clip")continue;let dn=s.dA,pn=s.by.None;const xn=[];let kn=!0;if(Ut.type==="clip"){dn=Rt;for(const gr of Ut.layout.get("clip-layer-types"))pn|=gr==="model"?s.by.Model:gr==="symbol"?s.by.Symbol:s.by.FillExtrusion;for(const gr of Ut.layout.get("clip-layer-scope"))xn.push(gr);Ut.isHidden(this.transform.zoom)?kn=!1:we=!0}kn&&Lt.push({layer:Ut.fqid,cache:Wt,order:dn,clipMask:pn,clipScope:xn})}this.replacementSource.setSources(Lt),he=!0}}this._clippingActiveLastFrame=we,he||this.replacementSource.clear(),this.conflationActive=he,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let yt=0;yt<Y.length;yt++){const Ft=Y[yt],gt=Ft.cutoffRange();if(this.longestCutoffRange=Math.max(gt,this.longestCutoffRange),gt>0){const Lt=We(Ft);Lt&&(this.minCutoffZoom=Math.max(Lt.minzoom,this.minCutoffZoom)),Ft.minzoom&&(this.minCutoffZoom=Math.max(Ft.minzoom,this.minCutoffZoom))}Ft.is3D(C)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=yt),this._lastOcclusionLayer=yt)}const Ze=this.style&&this.style.fog;Ze?(this._fogVisible=Ze.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ze.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Ce),this.opaquePassCutoff=0,j=M(),Y=j.map(yt=>E[yt]));const Ye=this._shadowRenderer;if(Ye){Ye.updateShadowParameters(this.transform,this.style.directionalLight);for(const yt in ne)for(const Ft of xe[yt]){let gt={min:0,max:0};this.terrain&&(gt=this.terrain.getMinMaxForTile(Ft)||gt),Ye.addShadowReceiver(Ft.toUnwrapped(),gt.min,gt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new hE(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ke=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Xe&&!this._snow&&(this._snow=new cp(this)),!Xe&&this._snow&&(this._snow.destroy(),delete this._snow),Ke&&!this._rain&&(this._rain=new D1(this)),!Ke&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!jn.has(this.context.gl))return;this.renderPass="offscreen";for(const yt of Y){const Ft=a.getLayerSourceCache(yt);if(!yt.hasOffscreenPass()||yt.isHidden(this.transform.zoom))continue;const gt=Ft?Ee[Ft.id]:void 0;(yt.type==="custom"||yt.type==="raster"||yt.type==="raster-particle"||yt.isSky()||gt&&gt.length)&&this.renderLayer(this,Ft,yt,gt)}this.depthRangeFor3D=[0,1-(Y.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,je)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const tt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),at=(()=>{if(h.showOverdrawInspector)return s.al.black;const yt=this.style.fog;if(yt&&this.transform.projection.supportsFog){const Ft=this.style.getLut(yt.scope);if(!tt){const gt=yt.properties.get("color-use-theme")==="none",Lt=yt.properties.get("color").toRenderColor(gt?null:Ft).toArray01();return new s.al(...Lt)}if(tt){const gt=yt.properties.get("space-color-use-theme")==="none",Lt=yt.properties.get("space-color").toRenderColor(gt?null:Ft).toArray01();return new s.al(...Lt)}}return s.al.transparent})();if(this.context.clear({color:at,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&tt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=j.length-1;this.currentLayer>=0;this.currentLayer--){const yt=Y[this.currentLayer],Ft=a.getLayerSourceCache(yt);if(yt.isSky())continue;const gt=Ft?(yt.is3D(C)?$e:Ee)[Ft.id]:void 0;this._renderTileClippingMasks(yt,Ft,gt),this.renderLayer(this,Ft,yt,gt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&tt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const yt=Y[this.currentLayer],Ft=a.getLayerSourceCache(yt);yt.isSky()&&this.renderLayer(this,Ft,yt,Ft?Ee[Ft.id]:void 0)}function At(yt,Ft){let gt;return Ft&&(gt=(yt.type==="symbol"?Ce:yt.is3D(C)?$e:Ee)[Ft.id]),gt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<j.length;){const yt=Y[this.currentLayer];if(yt.type==="raster"||yt.type==="raster-particle"){const Ft=a.getLayerSourceCache(yt);this.renderLayer(this,Ft,yt,At(yt,Ft))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let xt=0;Ye&&(xt=Ye.getShadowCastingLayerCount());let Bt=!1,zt=-1;for(let yt=0;yt<j.length;++yt){const Ft=Y[yt];Ft.isHidden(this.transform.zoom)||Ft.is3D(C)&&(zt=yt)}G&&zt===-1&&(H=!0);let Jt=!1;for(;this.currentLayer<j.length;){const yt=Y[this.currentLayer],Ft=a.getLayerSourceCache(yt);if(yt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(yt)){if(yt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Jt&&yt.is3D(C)&&!C){const gt=this.currentLayer,Lt=kt=>{for(this.currentLayer=0;this.currentLayer<Y.length;this.currentLayer++){const Ut=Y[this.currentLayer];if(a0[Ut.type]){const Rt=this.style.getLayerSourceCache(Ut);a0[Ut.type](this,Rt,Ut,At(Ut,Rt),kt)}}};Lt("initialize"),Lt("reset"),this.currentLayer=gt,Jt=!0}if(H&&!Bt&&this.terrain&&!this.transform.isOrthographic&&(Bt=!0,this.blitDepth()),G&&zt!==-1&&this.currentLayer===zt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(yt,Ft,Ft?xe[Ft.id]:void 0),this.renderLayer(this,Ft,yt,At(yt,Ft)),!this.terrain&&Ye&&xt>0&&yt.hasShadowPass()&&--xt==0&&(Ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const gt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=gt;this.currentLayer++){const Lt=Y[this.currentLayer];if(!Lt.hasLightBeamPass())continue;const kt=a.getLayerSourceCache(Lt);this.renderLayer(this,kt,Lt,kt?Ee[kt.id]:void 0)}this.currentLayer=gt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const gt=this.currentLayer;this.depthOcclusion=!0;for(const Lt of this.layersWithOcclusionOpacity){this.currentLayer=Lt;const kt=Y[this.currentLayer],Ut=a.getLayerSourceCache(kt),Rt=Ut?Ee[Ut.id]:void 0;this.terrain||this._renderTileClippingMasks(kt,Ut,Ut?xe[Ut.id]:void 0),this.renderLayer(this,Ut,kt,Rt)}this.depthOcclusion=!1,this.currentLayer=gt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let yt=null;Y.forEach(Ft=>{const gt=a.getLayerSourceCache(Ft);gt&&!Ft.isHidden(this.transform.zoom)&&gt.getVisibleCoordinates().length&&(!yt||yt.getSource().maxzoom<gt.getSource().maxzoom)&&(yt=gt)}),yt&&this.options.showTileBoundaries&&eg.debug(this,yt,yt.getVisibleCoordinates(),s.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&eg.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(yt){const Ft=yt.transform.padding;w1(yt,yt.transform.height-(Ft.top||0),3,op),w1(yt,Ft.bottom||0,3,pM),E1(yt,Ft.left||0,3,mM),E1(yt,yt.transform.width-(Ft.right||0),3,cE);const gt=yt.transform.centerPoint;(function(Lt,kt,Ut,Rt){Ud(Lt,kt-1,Ut-10,2,20,Rt),Ud(Lt,kt-10,Ut-1,20,2,Rt)})(yt,gt.x,yt.transform.height-gt.y,J_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),he||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:h}=this.transform.projection,_=!h||!h.includes(a.type);if(o0[a.type]&&(_||this.terrain&&a.type==="custom")){const E=this.style.getLayerSourceCache(a);o0[a.type](a,E,this)}this.gpuTimingEnd()}renderLayer(a,h,_,E){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||E&&E.length)&&(this.id=_.id,this.gpuTimingStart(_),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(_.type)&&(!a.terrain||_.type!=="custom")||_.type==="clip"||eg[_.type](a,h,_,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,_=this.context.gl;let E=this.gpuTimers[a.id];E||(E=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:_.createQuery()}),E.calls++,_.beginQuery(h.TIME_ELAPSED_EXT,E.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=this.context.gl,_=h.createQuery();this.deferredRenderGpuTimeQueries.push(_),h.beginQuery(a.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const _ in a){const E=a[_],C=this.context.extTimerQuery,M=C.getQueryParameter(E.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(E.query),h[_]=M}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let _=0;for(const E of a)_+=h.getQueryParameter(E,h.QUERY_RESULT)/1e6,h.deleteQuery(E);return _}translatePosMatrix(a,h,_,E,C){if(!_[0]&&!_[1])return a;const M=C?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(M){const G=Math.sin(M),Y=Math.cos(M);_=[_[0]*Y-_[1]*G,_[0]*G+_[1]*Y]}const j=[C?_[0]:s.at(h,_[0],this.transform.zoom),C?_[1]:s.at(h,_[1],this.transform.zoom),0],H=new Float32Array(16);return s.ad.mat4.translate(H,a,j),H}saveTileTexture(a){const h=a.size[0],_=this._tileTextures[h];_?_.push(a):this._tileTextures[h]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,h,_){const E=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,C=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):E||C.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||C.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&C.push("GLOBE"),!this._fogVisible||E||h!==void 0&&!h||C.push("FOG","FOG_DITHERING"),E&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(a,h){this.cache=this.cache||{};const _=h&&h.defines||[],E=h&&h.config,C=this.currentGlobalDefines(a,h&&h.overrideFog,h&&h.overrideRtt).concat(_),M=J2.cacheKey(Hm[a],a,C,E);return this.cache[M]||(this.cache[M]=new J2(this.context,a,Hm[a],E,m1[a],C)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,h){if(this.style.enable3dLights()){const _=this.style.directionalLight,E=this.style.ambientLight;if(_&&E){const C=((M,j,H)=>{const G=M.properties.get("direction"),Y=M.properties.get("color-use-theme")==="none",ne=M.properties.get("color").toRenderColor(Y?null:H.getLut(M.scope)).toArray01(),ee=M.properties.get("intensity"),he=j.properties.get("color-use-theme")==="none",we=j.properties.get("color").toRenderColor(he?null:H.getLut(j.scope)).toArray01(),xe=j.properties.get("intensity"),Ee=[G.x,G.y,G.z],Ce=s.cN(we,xe),je=s.cN(ne,ee);return{u_lighting_ambient_color:Ce,u_lighting_directional_dir:Ee,u_lighting_directional_color:je,u_ground_radiance:Q2(Ee,je,Ce)}})(_,E,this.style);h.setLightsUniformValues(a,C)}}}uploadCommonUniforms(a,h,_,E,C){if(this.uploadCommonLightUniforms(a,h),this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const j=M.getOpacity(this.transform.pitch),H=((G,Y,ne,ee,he,we,xe,Ee,Ce,je,$e,We)=>{const Ze=G.transform,Ye=Y.properties.get("color-use-theme")==="none",Xe=Y.properties.get("color").toRenderColor(Ye?null:G.style.getLut(Y.scope)).toArray01();Xe[3]=ee;const Ke=G.frameCounter/1e3%1,[tt,at]=Y.properties.get("vertical-range");return{u_fog_matrix:ne?Ze.calculateFogTileMatrix(ne):We||G.identityMat,u_fog_range:Y.getFovAdjustedRange(Ze._fov),u_fog_color:Xe,u_fog_horizon_blend:Y.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(tt,at),at],u_fog_temporal_offset:Ke,u_frustum_tl:he,u_frustum_tr:we,u_frustum_br:xe,u_frustum_bl:Ee,u_globe_pos:Ce,u_globe_radius:je,u_viewport:$e,u_globe_transition:s.ag(Ze.zoom),u_is_globe:+(Ze.projection.name==="globe")}})(this,M,_,j,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],E);h.setFogUniformValues(a,H)}C&&h.setCutoffUniformValues(a,C.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const E of _)h[E.key]=a[E.key]||new qs(E,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,h){return!(!a.is3D(!(!this.terrain||!this.terrain.enabled))||a.type!=="clip"&&(a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerPresent||a.sourceLayer!=="building")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[a.key];return h||(this._cachedTileFogOpacities[a.key]=h=this.style.fog.getOpacityForTile(a)),h[0]>=hn||h[1]>=hn}setupDepthForOcclusion(a,h,_){const E=this.context,C=E.gl,M=!!_;var j;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),E.activeTexture.set(C.TEXTURE3),a&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((j=this.depthRangeFor3D)[1]-j[0]),-1-2*j[0]/(j[1]-j[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),E.activeTexture.set(C.TEXTURE0),M||h.setTerrainUniformValues(E,_)}}function c0(y,a){let h=!1,_=null;const E=()=>{_=null,h&&(y(),_=setTimeout(E,a),h=!1)};return()=>(h=!0,_||E(),_)}class N1{constructor(a){this._hashName=a&&encodeURIComponent(a),s.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=c0(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const h=O1(a);if(this._hashName){const _=this._hashName;let E=!1;const C=location.hash.slice(1).split("&").map(M=>{const j=M.split("=")[0];return j===_?(E=!0,`${j}=${h}`):M}).filter(M=>M);return E||C.push(`${_}=${h}`),`#${C.join("&")}`}return`#${h}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function O1(y,a){const h=y.getCenter(),_=Math.round(100*y.getZoom())/100,E=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,E),M=Math.round(h.lng*C)/C,j=Math.round(h.lat*C)/C,H=y.getBearing(),G=y.getPitch();let Y=a?`/${M}/${j}/${_}`:`${_}/${j}/${M}`;return(H||G)&&(Y+="/"+Math.round(10*H)/10),G&&(Y+=`/${Math.round(G)}`),Y}const tg={linearity:.3,easing:s.dB(0,0,.3,1)},dE=s.l({deceleration:2500,maxSpeed:1400},tg),fE=s.l({deceleration:20,maxSpeed:1400},tg),pE=s.l({deceleration:1e3,maxSpeed:360},tg),mE=s.l({deceleration:1e3,maxSpeed:90},tg);class gE{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=s.q.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(h.pan.mag()){const C=rg(h.pan.mag(),_,s.l({},dE,a||{}));E.offset=h.pan.mult(C.amount/h.pan.mag()),E.center=this._map.transform.center,ng(E,C)}if(h.zoom){const C=rg(h.zoom,_,fE);E.zoom=this._map.transform.zoom+C.amount,ng(E,C)}if(h.bearing){const C=rg(h.bearing,_,pE);E.bearing=this._map.transform.bearing+s.ay(C.amount,-179,179),ng(E,C)}if(h.pitch){const C=rg(h.pitch,_,mE);E.pitch=this._map.transform.pitch+C.amount,ng(E,C)}if(E.zoom||E.bearing){const C=h.pinchAround===void 0?h.around:h.pinchAround;E.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function ng(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function rg(y,a,h){const{maxSpeed:_,linearity:E,deceleration:C}=h,M=s.ay(y*E/(a/1e3),-_,_),j=Math.abs(M)/(C*E);return{easing:h.easing,duration:1e3*j,amount:M*(j/2)}}class Fl extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_,E={}){const C=fe(h.getCanvasContainer(),_),M=h.unproject(C);super(a,s.l({point:C,lngLat:M,originalEvent:_},E)),this._defaultPrevented=!1,this.target=h}}class ig extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){const E=a==="touchend"?_.changedTouches:_.touches,C=ye(h.getCanvasContainer(),E),M=C.map(H=>h.unproject(H)),j=C.reduce((H,G,Y,ne)=>H.add(G.div(ne.length)),new s.P(0,0));super(a,{points:C,point:j,lngLats:M,lngLat:h.unproject(j),originalEvent:_}),this._defaultPrevented=!1}}class _E extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class yE{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new _E(this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Fl(a.type,this._map,a))}mouseup(a){this._map.fire(new Fl(a.type,this._map,a))}preclick(a){const h=s.l({},a);h.type="preclick",this._map.fire(new Fl(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Fl(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Fl(a.type,this._map,a))}mouseover(a){this._map.fire(new Fl(a.type,this._map,a))}mouseout(a){this._map.fire(new Fl(a.type,this._map,a))}touchstart(a){return this._firePreventable(new ig(a.type,this._map,a))}touchmove(a){this._map.fire(new ig(a.type,this._map,a))}touchend(a){this._map.fire(new ig(a.type,this._map,a))}touchcancel(a){this._map.fire(new ig(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _M{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Fl(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Fl(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yM{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(_e(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const _=h,E=this._startPos,C=this._lastPos;if(!E||!C||C.equals(_)||!this._box&&_.dist(E)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const M=Math.min(E.x,_.x),j=Math.max(E.x,_.x),H=Math.min(E.y,_.y),G=Math.max(E.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${H}px)`,this._box.style.width=j-M+"px",this._box.style.height=G-H+"px")})}mouseupWindow(a,h){if(!this._active)return;const _=this._startPos,E=h;if(_&&a.button===0){if(this.reset(),re(),_.x!==E.x||_.y!==E.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:a})),{cameraAnimation:C=>C.fitScreenCoordinates(_,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),De(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new s.A(a,{originalEvent:h}))}}function xs(y,a){const h={};for(let _=0;_<y.length;_++)h[y[_].identifier]=a[_];return h}class xE{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(E){const C=new s.P(0,0);for(const M of E)C._add(M);return C.div(E.length)}(h),this.touches=xs(_,h)))}touchmove(a,h,_){if(this.aborted||!this.centroid)return;const E=xs(_,h);for(const C in this.touches){const M=E[C];(!M||M.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(a,h,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class L1{constructor(a){this.singleTap=new xE(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,_){this.singleTap.touchstart(a,h,_)}touchmove(a,h,_){this.singleTap.touchmove(a,h,_)}touchend(a,h,_){const E=this.singleTap.touchend(a,h,_);if(E){const C=a.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(E)<30;if(C&&M||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class xM{constructor(){this._zoomIn=new L1({numTouches:1,numTaps:2}),this._zoomOut=new L1({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,_){this._zoomIn.touchstart(a,h,_),this._zoomOut.touchstart(a,h,_)}touchmove(a,h,_){this._zoomIn.touchmove(a,h,_),this._zoomOut.touchmove(a,h,_)}touchend(a,h,_){const E=this._zoomIn.touchend(a,h,_),C=this._zoomOut.touchend(a,h,_);return E?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:a})}):C?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(C)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const sg={0:1,2:2},F1={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class og{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const _=ue(a);this._correctButton(a,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(a,h){const _=this._lastPoint;if(_){if(a.preventDefault(),this._eventButton!=null&&function(E,C){const M=sg[C];return E.buttons===void 0||(E.buttons&M)!==M}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}}mouseupWindow(a){this._lastPoint&&ue(a)===this._eventButton&&(this._moved&&re(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class u0 extends og{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return h===0&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class Mu extends og{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?F1[a.pitchRotateKey]:void 0}_correctButton(a,h){return this._pitchRotateKey?h===0&&a[this._pitchRotateKey]:h===0&&a.ctrlKey||h===2}_move(a,h){const _=.8*(h.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class ag extends og{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?F1[a.pitchRotateKey]:void 0}_correctButton(a,h){return this._pitchRotateKey?h===0&&a[this._pitchRotateKey]:h===0&&a.ctrlKey||h===2}_move(a,h){const _=-.5*(h.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class ao{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),s.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(a,h,_){return this._calculateTransform(a,h,_)}touchmove(a,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!s.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,_)}}touchend(a,h,_){this._calculateTransform(a,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,_){_.length>0&&(this._active=!0);const E=xs(_,h),C=new s.P(0,0),M=new s.P(0,0);let j=0;for(const G in E){const Y=E[G],ne=this._touches[G];ne&&(C._add(Y),M._add(Y.sub(ne)),j++,E[G]=Y)}if(this._touches=E,j<this._minTouches||!M.mag())return;const H=M.div(j);return this._sum._add(H),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(j),panDelta:H}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Pc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,_){return{}}touchstart(a,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,_){const E=this._firstTwoTouches;if(!E)return;a.preventDefault();const[C,M]=E,j=up(_,h,C),H=up(_,h,M);if(!j||!H)return;const G=this._aroundCenter?null:j.add(H).div(2);return this._move([j,H],G,a)}touchend(a,h,_){if(!this._firstTwoTouches)return;const[E,C]=this._firstTwoTouches,M=up(_,h,E),j=up(_,h,C);M&&j||(this._active&&re(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function up(y,a,h){for(let _=0;_<y.length;_++)if(y[_].identifier===h)return a[_]}function lg(y,a){return Math.log(y/a)/Math.LN2}class vE extends Pc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(lg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lg(this._distance,_),pinchAround:h}}}function bE(y,a){return 180*y.angleWith(a)/Math.PI}class cg extends Pc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bE(this._vector,_),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const E=bE(a,_);return Math.abs(E)<h}}function B1(y){return Math.abs(y.y)>Math.abs(y.x)}class vM extends Pc{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,B1(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,_){const E=this._lastPoints;if(!E)return;const C=a[0].sub(E[0]),M=a[1].sub(E[1]);return this._map._cooperativeGestures&&!s.dC()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,M,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(C.y+M.y)/2*-.5})}gestureBeginsVertically(a,h,_){if(this._valid!==void 0)return this._valid;const E=a.mag()>=2,C=h.mag()>=2;if(!E&&!C)return;if(!E||!C)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const M=a.y>0==h.y>0;return B1(a)&&B1(h)&&M}}const z1={panStep:100,bearingStep:15,pitchStep:10};class j1{constructor(){const a=z1;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,_=0,E=0,C=0,M=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),C=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),C=1);break;case 38:a.shiftKey?E=1:(a.preventDefault(),M=-1);break;case 40:a.shiftKey?E=-1:(a.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(_=0,E=0),{cameraAnimation:j=>{const H=j.getZoom();j.easeTo({duration:300,easeId:"keyboardHandler",easing:ug,zoom:h?Math.round(H)+h*(a.shiftKey?2:1):H,bearing:j.getBearing()+_*this._bearingStep,pitch:j.getPitch()+E*this._pitchStep,offset:[-C*this._panStep,-M*this._panStep],center:j.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ug(y){return y*(2-y)}const $d=4.000244140625,ah=1/450;class eu{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ah,s.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||s.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=s.q.now(),E=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%$d==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(E*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=fe(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>$d?this._wheelZoomRate:this._defaultZoomRate;let Y=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&Y!==0&&(Y=1/Y);const ne=h(),ee=Math.pow(2,ne),he=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):ee;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(he*Y))),this._type==="wheel"&&(this._startZoom=ne,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:h(),E=this._startZoom,C=this._easing;let M,j=!1;if(this._type==="wheel"&&E&&C){const G=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),Y=C(G);M=s.ah(E,_,Y),G<1?this._frameId||(this._frameId=!0):j=!0}else M=_,j=!0;this._active=!0,j&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let H=M-h();return H*this._lastDelta<0&&(H=0),{noInertia:!0,needsRenderFrame:!j,zoomDelta:H,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=s.dD;if(this._prevEase){const _=this._prevEase,E=(s.q.now()-_.start)/_.duration,C=_.easing(E+.01)-_.easing(E),M=.27/Math.sqrt(C*C+1e-4)*.01,j=Math.sqrt(.0729-M*M);h=s.dB(M,j,.25,1)}return this._prevEase={start:s.q.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Jh{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ed{constructor(){this._tap=new L1({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,h,_))}touchmove(a,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const E=h[0],C=E.y-this._swipePoint.y;return this._swipePoint=E,a.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(a,h,_)}touchend(a,h,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(a,h,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bM{constructor(a,h,_){this._el=a,this._mousePan=h,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wM{constructor(a,h,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class EM{constructor(a,h,_,E){this._el=a,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const h0=y=>y.zoom||y.drag||y.pitch||y.rotate;class wE extends s.A{}class Ja{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const _=s.ad.vec3.sub([],h,a);this.radius=s.ad.vec3.length(_[2]<0?s.ad.vec3.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){s.ad.vec3.div(a,a,this.constants),s.ad.vec3.normalize(a,a),s.ad.vec3.mul(a,a,this.constants);const h=s.ad.vec3.scale([],a,this.radius);if(h[2]>0){const _=s.ad.vec3.scale([],[0,0,1],s.ad.vec3.dot(h,[0,0,1])),E=s.ad.vec3.scale([],s.ad.vec3.normalize([],[h[0],h[1],0]),this.radius),C=s.ad.vec3.add([],h,s.ad.vec3.scale([],s.ad.vec3.sub([],s.ad.vec3.add([],E,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function hp(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class EE{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gE(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ja,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),s.aQ(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[E,C,M]of this._listeners){const j=E===document?this.handleWindowEvent:this.handleEvent;E.addEventListener(C,j,M)}}destroy(){for(const[a,h,_]of this._listeners){const E=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(h,E,_)}}_addDefaultHandlers(a){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new yE(h,a));const E=h.boxZoom=new yM(h,a);this._add("boxZoom",E);const C=new xM,M=new qd;h.doubleClickZoom=new Jh(M,C),this._add("tapZoom",C),this._add("clickZoom",M);const j=new ed;this._add("tapDragZoom",j);const H=h.touchPitch=new vM(h);this._add("touchPitch",H);const G=new Mu(a),Y=new ag(a);h.dragRotate=new wM(a,G,Y),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);const ne=new u0(a),ee=new ao(h,a);h.dragPan=new bM(_,ne,ee),this._add("mousePan",ne),this._add("touchPan",ee,["touchZoom","touchRotate"]);const he=new cg,we=new vE;h.touchZoomRotate=new EM(_,we,he,j),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),this._add("blockableMapEvent",new _M(h));const xe=h.scrollZoom=new eu(h,this);this._add("scrollZoom",xe,["mousePan"]);const Ee=h.keyboard=new j1;this._add("keyboard",Ee);for(const Ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Ce]&&h[Ce].enable(a[Ce])}_add(a,h,_){this._handlers.push({handlerName:a,handler:h,allowed:_}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!h0(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,h,_){for(const E in a)if(E!==_&&(!h||h.indexOf(E)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const _ of a)this._el.contains(_.target)&&h.push(_);return h}handleEvent(a,h){this._updatingCamera=!0;const _=a.type==="renderFrame",E=_?void 0:a,C={needsRenderFrame:!1},M={},j={},H=a.touches?this._getMapTouches(a.touches):void 0,G=H?ye(this._el,H):_?void 0:fe(this._el,a);for(const{handlerName:ee,handler:he,allowed:we}of this._handlers){if(!he.isEnabled())continue;let xe;this._blockedByActive(j,we,ee)?he.reset():he[h||a.type]&&(xe=he[h||a.type](a,G,H),this.mergeHandlerResult(C,M,xe,ee,E),xe&&xe.needsRenderFrame&&this._triggerRenderFrame()),(xe||he.isActive())&&(j[ee]=he)}const Y={};for(const ee in this._previousActiveHandlers)j[ee]||(Y[ee]=E);this._previousActiveHandlers=j,(Object.keys(Y).length||hp(C))&&(this._changes.push([C,M,Y]),this._triggerRenderFrame()),(Object.keys(j).length||hp(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ne}=C;ne&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ne(this._map))}mergeHandlerResult(a,h,_,E,C){if(!_)return;s.l(a,_);const M={handlerName:E,originalEvent:_.originalEvent||C};_.zoomDelta!==void 0&&(h.zoom=M),_.panDelta!==void 0&&(h.drag=M),_.pitchDelta!==void 0&&(h.pitch=M),_.bearingDelta!==void 0&&(h.rotate=M)}_applyChanges(){const a={},h={},_={};for(const[E,C,M]of this._changes)E.panDelta&&(a.panDelta=(a.panDelta||new s.P(0,0))._add(E.panDelta)),E.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(a.around=E.around),E.aroundCoord!==void 0&&(a.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(a.pinchAround=E.pinchAround),E.noInertia&&(a.noInertia=E.noInertia),s.l(h,C),s.l(_,M);this._updateMapTransform(a,h,_),this._changes=[]}_updateMapTransform(a,h,_){const E=this._map,C=E.transform,M=je=>[je.x,je.y,je.z];if((je=>{const $e=this._eventsInProgress.drag;return $e&&!this._handlersById[$e.handlerName].isActive()})()&&!hp(a)){const je=C.zoom;C.cameraElevationReference="sea",this._originalZoom!=null&&C._orthographicProjectionAtLowPitch&&C.projection.name!=="globe"&&C.pitch===0?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),je!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&E._stop(!0),!hp(a))return void this._fireEvents(h,_,!0);let{panDelta:j,zoomDelta:H,bearingDelta:G,pitchDelta:Y,around:ne,aroundCoord:ee,pinchAround:he}=a;C._isCameraConstrained&&(H>0&&(H=0),C._isCameraConstrained=!1),he!==void 0&&(ne=he),(H||(je=>h[je]&&!this._eventsInProgress[je])("drag"))&&ne&&(this._dragOrigin=M(C.pointCoordinate3D(ne)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",E._stop(!0),ne=ne||E.transform.centerPoint,G&&(C.bearing+=G),Y&&(C.pitch+=Y),C._updateCameraState();const we=[0,0,0];if(j)if(C.projection.name==="mercator"){const je=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ne).dir),$e=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(ne.sub(j)).dir);we[0]=$e[0]-je[0],we[1]=$e[1]-je[1]}else{const je=C.pointCoordinate(ne);if(C.projection.name==="globe"){j=j.rotate(-C.angle);const $e=C._pixelsPerMercatorPixel/C.worldSize;we[0]=-j.x*s.dE(s.aT(je.y))*$e,we[1]=-j.y*s.dE(C.center.lat)*$e}else{const $e=C.pointCoordinate(ne.sub(j));je&&$e&&(we[0]=$e.x-je.x,we[1]=$e.y-je.y)}}const xe=C.zoom,Ee=[0,0,0];if(H){const je=M(ee||C.pointCoordinate3D(ne)),$e={dir:s.ad.vec3.normalize([],s.ad.vec3.sub([],je,C._camera.position))};if($e.dir[2]<0){const We=C.zoomDeltaToMovement(je,H);s.ad.vec3.scale(Ee,$e.dir,We)}}const Ce=s.ad.vec3.add(we,we,Ee);C._translateCameraConstrained(Ce),H&&Math.abs(C.zoom-xe)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,_,!0)}_fireEvents(a,h,_){const E=h0(this._eventsInProgress),C=h0(a),M={};for(const Y in a){const{originalEvent:ne}=a[Y];this._eventsInProgress[Y]||(M[`${Y}start`]=ne),this._eventsInProgress[Y]=a[Y]}!E&&C&&this._fireEvent("movestart",C.originalEvent);for(const Y in M)this._fireEvent(Y,M[Y]);C&&this._fireEvent("move",C.originalEvent);for(const Y in a){const{originalEvent:ne}=a[Y];this._fireEvent(Y,ne)}const j={};let H;for(const Y in this._eventsInProgress){const{handlerName:ne,originalEvent:ee}=this._eventsInProgress[Y];this._handlersById[ne].isActive()||(delete this._eventsInProgress[Y],H=h[ne]||ee,j[`${Y}end`]=H)}for(const Y in j)this._fireEvent(Y,j[Y]);const G=h0(this._eventsInProgress);if(_&&(E||C)&&!G){this._updatingCamera=!0;const Y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=ee=>ee!==0&&-this._bearingSnap<ee&&ee<this._bearingSnap;Y?(ne(Y.bearing||this._map.getBearing())&&(Y.bearing=0),this._map.easeTo(Y,{originalEvent:H})):(this._map.fire(new s.A("moveend",{originalEvent:H})),ne(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new s.A(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new wE("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const SE="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class dp extends s.E{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,s.aQ(["_renderFrameCallback"],this)}getCenter(){return new s.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,_){return a=s.P.convert(a).mult(-1),this.panTo(this.transform.center,s.l({offset:a},h),_)}panTo(a,h,_){return this.easeTo(s.l({center:a},h),_)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,_){return this.easeTo(s.l({zoom:a},h),_)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,_){return this.easeTo(s.l({bearing:a},h),_)}resetNorth(a,h){return this.rotateTo(0,s.l({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){a=s.aB.convert(a);const _=h&&h.bearing||0,E=h&&h.pitch||0,C=a.getNorthWest(),M=a.getSouthEast();return this._cameraForBounds(this.transform,C,M,_,E,h)}_extendPadding(a){const h={top:0,right:0,bottom:0,left:0};return a==null?s.l({},h,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:s.l({},h,a)}_extendCameraOptions(a){return(a=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,h){const _=h.max[0]-h.min[0],E=h.max[1]-h.min[1];return _/E>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):E/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,h,_,E,C,M){const j=a.clone(),H=this._extendCameraOptions(M);j.bearing=E,j.pitch=C;const G=s.bO.convert(h),Y=s.bO.convert(_),ne=.5*(G.lat+Y.lat),ee=.5*(G.lng+Y.lng),he=s.dF(ne,ee),we=s.ad.vec3.normalize([],he),xe=s.ad.vec3.normalize([],s.ad.vec3.cross([],we,[0,1,0])),Ee=s.ad.vec3.cross([],xe,we),Ce=[xe[0],xe[1],xe[2],0,Ee[0],Ee[1],Ee[2],0,we[0],we[1],we[2],0,0,0,0,1],je=[he,s.dF(G.lat,G.lng),s.dF(Y.lat,G.lng),s.dF(Y.lat,Y.lng),s.dF(G.lat,Y.lng),s.dF(ne,G.lng),s.dF(ne,Y.lng),s.dF(G.lat,ee),s.dF(Y.lat,ee)];let $e=s.ce.fromPoints(je.map(kt=>[s.ad.vec3.dot(xe,kt),s.ad.vec3.dot(Ee,kt),s.ad.vec3.dot(we,kt)]));const We=s.ad.vec3.transformMat4([],$e.center,Ce);s.ad.vec3.squaredLength(We)===0&&s.ad.vec3.set(We,0,0,1),s.ad.vec3.normalize(We,We),s.ad.vec3.scale(We,We,s.az),j.center=s.dG(We);const Ze=j.getWorldToCameraMatrix(),Ye=s.ad.mat4.invert(new Float64Array(16),Ze);$e=s.ce.applyTransform($e,s.ad.mat4.multiply([],Ze,Ce));const Xe=this._extendAABB($e,j,H,E);if(!Xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");$e=Xe,s.ad.vec3.transformMat4(We,We,Ze);const Ke=.5*($e.max[2]-$e.min[2]),tt=this._minimumAABBFrustumDistance(j,$e),at=s.ad.vec3.scale([],[0,0,1],Ke),At=s.ad.vec3.add(at,We,at),xt=tt+(j.pitch===0?0:s.ad.vec3.distance(We,At)),Bt=j.globeCenterInViewSpace,zt=s.ad.vec3.sub([],We,[Bt[0],Bt[1],Bt[2]]);s.ad.vec3.normalize(zt,zt),s.ad.vec3.scale(zt,zt,xt);const Jt=s.ad.vec3.add([],We,zt);s.ad.vec3.transformMat4(Jt,Jt,Ye);const yt=s.dv/s.az,Ft=s.ad.vec3.length(Jt),gt=s.bH(Math.max(Ft*yt-s.dv,Number.EPSILON),0),Lt=Math.min(j.zoomFromMercatorZAdjusted(gt),H.maxZoom);return Lt>.5*(s.c6+s.bY)?(j.setProjection({name:"mercator"}),j.zoom=Lt,this._cameraForBounds(j,h,_,E,C,M)):{center:j.center,zoom:Lt,bearing:E,pitch:C}}_extendAABB(a,h,_,E){const C=.5*((_.padding.left||0)+(_.padding.right||0)),M=.5*((_.padding.top||0)+(_.padding.bottom||0)),j=M,H=C,G=C,Y=M,ne=h.width-(H+G),ee=h.height-(j+Y),he=s.ad.vec3.sub([],a.max,a.min),we=Math.min(ne/he[0],ee/he[1]),xe=Math.min(h.scaleZoom(h.scale*we),_.maxZoom);if(isNaN(xe))return null;const Ee=h.scale/h.zoomScale(xe),Ce=new s.ce([a.min[0]-H*Ee,a.min[1]-Y*Ee,a.min[2]],[a.max[0]+G*Ee,a.max[1]+j*Ee,a.max[2]]),je=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new s.P(_.offset.x,_.offset.y):s.P.convert(_.offset)).rotate(-s.ak(E));return Ce.center[0]-=je.x*Ee,Ce.center[1]+=je.y*Ee,Ce}queryTerrainElevation(a,h){const _=this.transform.elevation;return _?(h=s.l({},{exaggerated:!0},h),_.getAtPoint(s.ac.fromLngLat(a),null,h.exaggerated)):null}_cameraForBounds(a,h,_,E,C,M){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,h,_,E,C,M);const j=a.clone(),H=this._extendCameraOptions(M);j.bearing=E,j.pitch=C;const G=s.bO.convert(h),Y=s.bO.convert(_),ne=new s.bO(G.lng,Y.lat),ee=new s.bO(Y.lng,G.lat),he=j.project(G),we=j.project(Y),xe=this.queryTerrainElevation(G),Ee=this.queryTerrainElevation(Y),Ce=this.queryTerrainElevation(ne),je=this.queryTerrainElevation(ee),$e=[[he.x,he.y,Math.min(xe||0,Ee||0,Ce||0,je||0)],[we.x,we.y,Math.max(xe||0,Ee||0,Ce||0,je||0)]];let We=s.ce.fromPoints($e);const Ze=j.getWorldToCameraMatrix(),Ye=s.ad.mat4.invert(new Float64Array(16),Ze);We=s.ce.applyTransform(We,Ze);const Xe=this._extendAABB(We,j,H,E);if(!Xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");We=Xe;const Ke=.5*s.ad.vec3.sub([],We.max,We.min)[2],tt=this._minimumAABBFrustumDistance(j,We),at=[0,0,1,0];s.ad.vec4.transformMat4(at,at,Ze),s.ad.vec4.normalize(at,at);const At=s.ad.vec3.scale([],at,tt+Ke),xt=s.ad.vec3.add([],We.center,At);s.ad.vec3.transformMat4(We.center,We.center,Ye),s.ad.vec3.transformMat4(xt,xt,Ye);const Bt=j.unproject(new s.P(We.center[0],We.center[1])),zt=s.dH(j.projection,Bt),Jt=Math.pow(2,zt),yt=Math.min(j._zoomFromMercatorZ(xt[2]*j.pixelsPerMeter*Jt/j.worldSize),H.maxZoom);return j.mercatorFromTransition&&yt<.5*(s.c6+s.bY)?(j.setProjection({name:"globe"}),j.zoom=yt,this._cameraForBounds(j,h,_,E,C,M)):{center:Bt,zoom:yt,bearing:E,pitch:C}}fitBounds(a,h,_){const E=this.cameraForBounds(a,h);return this._fitInternal(E,h,_)}fitScreenCoordinates(a,h,_,E,C){const M=s.P.convert(a),j=s.P.convert(h),H=new s.P(Math.min(M.x,j.x),Math.min(M.y,j.y)),G=new s.P(Math.max(M.x,j.x),Math.max(M.y,j.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,j))return this;const Y=this.transform.pointLocation3D(H),ne=this.transform.pointLocation3D(G),ee=this.transform.pointLocation3D(new s.P(H.x,G.y)),he=this.transform.pointLocation3D(new s.P(G.x,H.y)),we=[Math.min(Y.lng,ne.lng,ee.lng,he.lng),Math.min(Y.lat,ne.lat,ee.lat,he.lat)],xe=[Math.max(Y.lng,ne.lng,ee.lng,he.lng),Math.max(Y.lat,ne.lat,ee.lat,he.lat)],Ee=E&&E.pitch?E.pitch:this.getPitch(),Ce=this._cameraForBounds(this.transform,we,xe,_,Ee,E);return this._fitInternal(Ce,E,C)}_fitInternal(a,h,_){return a?(h=s.l(a,h)).linear?this.easeTo(h,_):this.flyTo(h,_):this}jumpTo(a,h){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let E=!1,C=!1,M=!1;"zoom"in a&&_.zoom!==+a.zoom&&(E=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=s.bO.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(C=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(M=!0,_.pitch=+a.pitch);const j=typeof a.padding=="number"?this._extendPadding(a.padding):a.padding;if(a.padding!=null&&!_.isPaddingEqual(j))if(a.retainPadding===!1){const H=_.clone();H.padding=j,_.setLocationAtPoint(_.center,H.centerPoint)}else _.padding=j;return a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new s.A("movestart",h)).fire(new s.A("move",h)),E&&this.fire(new s.A("zoomstart",h)).fire(new s.A("zoom",h)).fire(new s.A("zoomend",h)),C&&this.fire(new s.A("rotatestart",h)).fire(new s.A("rotate",h)).fire(new s.A("rotateend",h)),M&&this.fire(new s.A("pitchstart",h)).fire(new s.A("pitch",h)).fire(new s.A("pitchend",h)),this.fire(new s.A("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(SE),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return s.w(SE),this;this.stop();const E=_.zoom,C=_.pitch,M=_.bearing;_.setFreeCameraOptions(a);const j=E!==_.zoom,H=C!==_.pitch,G=M!==_.bearing;return this.fire(new s.A("movestart",h)).fire(new s.A("move",h)),j&&this.fire(new s.A("zoomstart",h)).fire(new s.A("zoom",h)).fire(new s.A("zoomend",h)),G&&this.fire(new s.A("rotatestart",h)).fire(new s.A("rotate",h)).fire(new s.A("rotateend",h)),H&&this.fire(new s.A("pitchstart",h)).fire(new s.A("pitch",h)).fire(new s.A("pitchend",h)),this.fire(new s.A("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),((a=s.l({offset:[0,0],duration:500,easing:s.dD},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const _=this.transform,E=this.getZoom(),C=this.getBearing(),M=this.getPitch(),j=this.getPadding(),H="zoom"in a?+a.zoom:E,G="bearing"in a?this._normalizeBearing(a.bearing,C):C,Y="pitch"in a?+a.pitch:M,ne=this._extendPadding(a.padding),ee=s.P.convert(a.offset);let he,we,xe;if(_.projection.name==="globe"){const at=s.ac.fromLngLat(_.center),At=ee.rotate(-_.angle);at.x+=At.x/_.worldSize,at.y+=At.y/_.worldSize;const xt=at.toLngLat(),Bt=s.bO.convert(a.center||xt);this._normalizeCenter(Bt),he=_.centerPoint.add(At),we=new s.P(at.x,at.y).mult(_.worldSize),xe=new s.P(s.av(Bt.lng),s.aC(Bt.lat)).mult(_.worldSize).sub(we)}else{he=_.centerPoint.add(ee);const at=_.pointLocation(he),At=s.bO.convert(a.center||at);this._normalizeCenter(At),we=_.project(at),xe=_.project(At).sub(we)}const Ee=_.zoomScale(H-E);let Ce,je;a.around&&(Ce=s.bO.convert(a.around),je=_.locationPoint(Ce));const $e=this._zooming||H!==E,We=this._rotating||C!==G,Ze=this._pitching||Y!==M,Ye=!_.isPaddingEqual(ne),Xe=a.retainPadding===!1?_.clone():_,Ke=at=>At=>{if($e&&(at.zoom=s.ah(E,H,At)),We&&(at.bearing=s.ah(C,G,At)),Ze&&(at.pitch=s.ah(M,Y,At)),Ye&&(Xe.interpolatePadding(j,ne,At),he=Xe.centerPoint.add(ee)),Ce)at.setLocationAtPoint(Ce,je);else{const xt=at.zoomScale(at.zoom-E),Bt=H>E?Math.min(2,Ee):Math.max(.5,Ee),zt=Math.pow(Bt,1-At),Jt=at.unproject(we.add(xe.mult(At*zt)).mult(xt));at.setLocationAtPoint(at.renderWorldCopies?Jt.wrap():Jt,he)}return a.preloadOnly||this._fireMoveEvents(h),at};if(a.preloadOnly){const at=this._emulate(Ke,a.duration,_);return this._preloadTiles(at),this}const tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=$e,this._rotating=We,this._pitching=Ze,this._padding=Ye,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,tt),this._ease(Ke(_),at=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(h,at)},a),this}_prepareEase(a,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||_.moving||this.fire(new s.A("movestart",a)),this._zooming&&!_.zooming&&this.fire(new s.A("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new s.A("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new s.A("pitchstart",a))}_fireMoveEvents(a){this.fire(new s.A("move",a)),this._zooming&&this.fire(new s.A("zoom",a)),this._rotating&&this.fire(new s.A("rotate",a)),this._pitching&&this.fire(new s.A("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,E=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new s.A("zoomend",a)),E&&this.fire(new s.A("rotateend",a)),C&&this.fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a))}flyTo(a,h){if(this._prefersReducedMotion(a)){const kt=s.aA(a,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(kt,h)}this.stop(),a=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dD},a);const _=this.transform,E=this.getZoom(),C=this.getBearing(),M=this.getPitch(),j=this.getPadding(),H="zoom"in a?s.ay(+a.zoom,_.minZoom,_.maxZoom):E,G="bearing"in a?this._normalizeBearing(a.bearing,C):C,Y="pitch"in a?+a.pitch:M,ne=this._extendPadding(a.padding),ee=_.zoomScale(H-E),he=s.P.convert(a.offset);let we=_.centerPoint.add(he);const xe=_.pointLocation(we),Ee=s.bO.convert(a.center||xe);this._normalizeCenter(Ee);const Ce=_.project(xe),je=_.project(Ee).sub(Ce);let $e=a.curve;const We=Math.max(_.width,_.height),Ze=We/ee,Ye=je.mag();if("minZoom"in a){const kt=s.ay(Math.min(a.minZoom,E,H),_.minZoom,_.maxZoom),Ut=We/_.zoomScale(kt-E);$e=Math.sqrt(Ut/Ye*2)}const Xe=$e*$e;function Ke(kt){const Ut=(Ze*Ze-We*We+(kt?-1:1)*Xe*Xe*Ye*Ye)/(2*(kt?Ze:We)*Xe*Ye);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function tt(kt){return(Math.exp(kt)-Math.exp(-kt))/2}function at(kt){return(Math.exp(kt)+Math.exp(-kt))/2}const At=Ke(0);let xt=function(kt){return at(At)/at(At+$e*kt)},Bt=function(kt){return We*((at(At)*(tt(Ut=At+$e*kt)/at(Ut))-tt(At))/Xe)/Ye;var Ut},zt=(Ke(1)-At)/$e;if(Math.abs(Ye)<1e-6||!isFinite(zt)){if(Math.abs(We-Ze)<1e-6)return this.easeTo(a,h);const kt=Ze<We?-1:1;zt=Math.abs(Math.log(Ze/We))/$e,Bt=function(){return 0},xt=function(Ut){return Math.exp(kt*$e*Ut)}}a.duration="duration"in a?+a.duration:1e3*zt/("screenSpeed"in a?+a.screenSpeed/$e:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Jt=C!==G,yt=Y!==M,Ft=!_.isPaddingEqual(ne),gt=a.retainPadding===!1?_.clone():_,Lt=kt=>Ut=>{const Rt=Ut*zt,Wt=1/xt(Rt);kt.zoom=Ut===1?H:E+kt.scaleZoom(Wt),Jt&&(kt.bearing=s.ah(C,G,Ut)),yt&&(kt.pitch=s.ah(M,Y,Ut)),Ft&&(gt.interpolatePadding(j,ne,Ut),we=gt.centerPoint.add(he));const dn=Ut===1?Ee:kt.unproject(Ce.add(je.mult(Bt(Rt))).mult(Wt));return kt.setLocationAtPoint(kt.renderWorldCopies?dn.wrap():dn,we),kt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),kt};if(a.preloadOnly){const kt=this._emulate(Lt,a.duration,_);return this._preloadTiles(kt),this}return this._zooming=!0,this._rotating=Jt,this._pitching=yt,this._padding=Ft,this._prepareEase(h,!1),this._ease(Lt(_),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,h,_){_.animate===!1||_.duration===0?(a(1),h()):(this._easeStart=s.q.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=s.bF(a,-180,180);const _=Math.abs(a-h);return Math.abs(a-360-h)<_&&(a-=360),Math.abs(a+360-h)<_&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const _=a.lng-h.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,h,_){const E=Math.ceil(15*h/1e3),C=[],M=a(_.clone());for(let j=0;j<=E;j++){const H=M(j/E);C.push(H.clone())}return C}_preloadTiles(a,h){}}class d0{constructor(a={}){this.options=a,s.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact,_=a._getUIString("AttributionControl.ToggleAttribution");this._map=a,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const E=Z("span","mapboxgl-ctrl-icon",this._compactButton);return E.setAttribute("aria-hidden","true"),E.setAttribute("title",_),this._innerContainer=Z("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(a){const _=h.reduce((E,C,M)=>(C.value&&(E+=`${C.key}=${C.value}${M<h.length-1?"&":""}`),E),"?");a.href=`${s.e.FEEDBACK_URL}/${_}#${O1(this._map,!0)}`,a.rel="noopener nofollow"}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const h=this._map.style._mergedSourceCaches;for(const E in h){const C=h[E];if(C.used){const M=C.getSource();M.attribution&&a.indexOf(M.attribution)<0&&a.push(M.attribution)}}a.sort((E,C)=>E.length-C.length),a=a.filter((E,C)=>{for(let M=C+1;M<a.length;M++)if(a[M].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class uc{constructor(){s.aQ(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Z("div","mapboxgl-ctrl");const h=Z("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const h in a){const _=a[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class hc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const E of _)if(E.id===a)return void(E.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class fp{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=s.cC((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,_){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+_}}const Gd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Yd extends s.A{constructor(a,h,_,E){const{point:C,lngLat:M,originalEvent:j,target:H}=a;super(a.type,{point:C,lngLat:M,originalEvent:j,target:H}),this.preventDefault=()=>{a.preventDefault()},this.id=h,this.interaction=_,this.feature=E}}class V1{constructor(a){this.map=a,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(a,h){if(this.typeById.has(a))throw new Error(`Interaction id "${a}" already exists.`);const _=h.filter;let E=h.type;_&&this.filters.set(a,s.a_(_)),E==="mouseover"&&(E="mouseenter"),E==="mouseout"&&(E="mouseleave");const C=this.interactionsByType.get(E)||new Map;E==="mouseenter"||E==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(a,h)):C.size===0&&this.map.on(E,this.handleType),C.size===0&&this.interactionsByType.set(E,C),C.set(a,h),this.typeById.set(a,E)}get(a){const h=this.typeById.get(a);if(!h)return;const _=this.interactionsByType.get(h);return _?_.get(a):void 0}remove(a){const h=this.typeById.get(a);if(!h)return;this.typeById.delete(a),this.filters.delete(a);const _=this.interactionsByType.get(h);_&&(_.delete(a),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(a),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):_.size===0&&this.map.off(h,this.handleType))}queryTargets(a,h){const _=[];for(const[E,C]of h)C.target&&_.push({targetId:E,target:C.target,filter:this.filters.get(E)});return this.map.style.queryRenderedTargets(a,_,this.map.transform)}handleMove(a){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(a.point,Array.from(this.delegatedInteractions).reverse());h.length&&(a.type="mouseenter",this.handleType(a,h));const _=new Map;for(const[E,{feature:C}]of this.prevHoveredFeatures)this.hoveredFeatures.has(E)||_.set(C.id,C);_.size&&(a.type="mouseleave",this.handleType(a,Array.from(_.values())))}handleOut(a){const h=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);h.length&&(a.type="mouseleave",this.handleType(a,h)),this.hoveredFeatures.clear()}handleType(a,h){const _=Array.from(this.interactionsByType.get(a.type)).reverse(),E=!!h;h=h||this.queryTargets(a.point,_);const C=a.type==="mouseenter";let M=!1;const j=new Set;for(const H of h){for(const[G,Y]of _){if(!Y.target)continue;const ne=H.variants?H.variants[G]:null;if(ne){for(const ee of ne){if(Su(ee,H,j,G))continue;const he=new s.cx(H,ee),we=Ka(ee,H,G);E&&(he.state=this.map.getFeatureState(he));const xe=C?this.prevHoveredFeatures.get(we):null,Ee=new Yd(a,G,Y,he),Ce=xe?xe.stop:Y.handler(Ee);if(C&&this.hoveredFeatures.set(we,{feature:H,stop:Ce}),Ce!==!1){M=!0;break}}if(M)break}}if(M)break}if(!M)for(const[H,G]of _){const{handler:Y,target:ne}=G;if(!ne&&Y(new Yd(a,H,G,null))!==!1)break}}}function xi(y,a){if(Array.isArray(y)&&Array.isArray(a)){const h=new Set(y),_=new Set(a);return h.size===_.size&&y.every(E=>_.has(E))}return s.bn(y,a)}const td={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},SM={showCompass:!0,showZoom:!0,visualizePitch:!1};class TM{constructor(a,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Mu({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new ag({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),s.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),_e()}move(a,h){const _=this.map,E=this.mouseRotate.mousemoveWindow(a,h),C=E&&E.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const M=this.mousePitch.mousemoveWindow(a,h),j=M&&M.pitchDelta;j&&_.setPitch(_.getPitch()+j)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){De(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(s.l({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),fe(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,fe(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ye(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=ye(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function f0(y,a,h){if(y=new s.bO(y.lng,y.lat),a){const _=new s.bO(y.lng-360,y.lat),E=new s.bO(y.lng+360,y.lat),C=360*Math.ceil(Math.abs(y.lng-h.center.lng)/360),M=h.locationPoint3D(y).distSqr(a),j=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint3D(_).distSqr(a)<M&&(j||Math.abs(_.lng-h.center.lng)<C)?y=_:h.locationPoint3D(E).distSqr(a)<M&&(j||Math.abs(E.lng-h.center.lng)<C)&&(y=E)}for(;Math.abs(y.lng-h.center.lng)>180;){const _=h.locationPoint3D(y);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y}const Pu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ca={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Ia extends s.E{constructor(a,h){super(),(a instanceof HTMLElement||h)&&(a=s.l({element:a},h)),s.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:_="center",color:E="#3FB1CE",scale:C=1,draggable:M=!1,clickTolerance:j=0,rotation:H=Ca.rotation,rotationAlignment:G=Ca.rotationAlignment,pitchAlignment:Y=Ca.pitchAlignment,occludedOpacity:ne=Ca.occludedOpacity,altitude:ee=Ca.altitude}=a||{};this._anchor=_,this._color=E,this._scale=C,this._draggable=M,this._clickTolerance=j,this._rotation=H,this._rotationAlignment=G,this._pitchAlignment=Y,this._occludedOpacity=ne,this._altitude=ee,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),a&&a.element?(this._element=a.element,this._offset=s.P.convert(a&&a.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(a&&a.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",xe=>{xe.preventDefault()}),this._element.addEventListener("mousedown",xe=>{xe.preventDefault()});const he=this._element.classList;for(const xe in Pu)he.remove(`mapboxgl-marker-anchor-${xe}`);he.add(`mapboxgl-marker-anchor-${this._anchor}`);const we=a&&a.className?a.className.trim().split(/\s+/):[];he.add(...we),this._popup=null}_createDefaultMarker(){const a=Z("div"),h=oe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},a);if(this._altitude===0){const _=oe("radialGradient",{id:"shadowGradient"},oe("defs",{},h));oe("stop",{offset:"10%","stop-opacity":.4},_),oe("stop",{offset:"100%","stop-opacity":.05},_),oe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return oe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),oe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),oe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),a}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.bO.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(a){return a===this._altitude||(this._defaultMarker&&(this._altitude===0&&a!==0||this._altitude!==0&&a===0)&&(this._element=this._createDefaultMarker()),this._altitude=a||Ca.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,a._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,_=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,h=this._pos;if(!a||!h)return!1;const _=a.unproject(h,this._altitude),E=a.getFreeCameraOptions();if(!E.position)return!1;const C=E.position.toLngLat();return C.distanceTo(_)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(h,this._altitude);let E;a._showingGlobe()&&s.dK(a.transform,this._lngLat)?E=0:(E=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Pu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const a=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!a||_!=="map")return"";if(!h._showingGlobe()){const H=h.getPitch();return H?`rotateX(${H}deg)`:""}const E=s.c4(s.dL(h.transform,this._lngLat)),C=a.sub(s.dM(h.transform)),M=Math.abs(C.x)+Math.abs(C.y);if(M===0)return"";const j=E/M;return`rotateX(${-C.y*j}deg) rotateY(${C.x*j}deg)`}_calculateZTransform(){const a=this._pos,h=this._map;if(!h||!a)return"";let _=0;const E=this.getRotationAlignment();if(E==="map")if(h._showingGlobe()){const C=h.project(new s.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),M=h.project(new s.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(C);_=s.c4(Math.atan2(M.y,M.x))-90}else _=-h.getBearing();else if(E==="horizon"){const C=s.ae(4,6,h.getZoom()),M=s.dM(h.transform);M.y+=C*h.transform.height;const j=a.sub(M),H=s.c4(Math.atan2(j.y,j.x));_=(H>90?H-270:H+90)*(1-C)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=f0(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=s.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const h=this._map;if(!h)return;const _=this._pointerdownPos,E=this._positionDelta;if(_&&E){if(!this._isDragging){const C=this._clickTolerance||h._clickTolerance;if(a.point.dist(_)<C)return;this._isDragging=!0}this._pos=a.point.sub(E),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map,_=this._pos;h&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||Ca.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||Ca.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||Ca.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||Ca.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ca={maxWidth:100,unit:"metric"},U1={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},pl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},TE=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nd(y=new s.P(0,0),a="bottom"){if(typeof y=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(a){case"top":return new s.P(0,y);case"top-left":return new s.P(h,h);case"top-right":return new s.P(-h,h);case"bottom":return new s.P(0,-y);case"bottom-left":return new s.P(h,-h);case"bottom-right":return new s.P(-h,-h);case"left":return new s.P(y,0);case"right":return new s.P(-y,0)}return new s.P(0,0)}return y instanceof s.P||Array.isArray(y)?s.P.convert(y):s.P.convert(y[a]||[0,0])}return{version:v,supported:Q.supported,setRTLTextPlugin:s.dN,getRTLTextPluginStatus:s.dO,Map:class extends dp{constructor(y){A.mark(w.create);const a=y;if((y=s.l({},td,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&s.dI(window)&&(y.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Vi(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies,null,null),y),this._repaint=!!y.repaint,this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new hc,this._domRenderTaskQueue=new hc,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aW(),this._locale=s.l({},Gd,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._tessellationStep=y.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=y.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=y.scaleFactor,this._requestManager=new ft(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,this._contextCreateOptions=y.contextCreateOptions?Object.assign({},y.contextCreateOptions):{},typeof y.container=="string"){const h=document.getElementById(y.container);if(!h)throw new Error(`Container '${y.container.toString()}' not found.`);this._container=h}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),this._spriteFormat=y.spriteFormat,s.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new R1),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new EE(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,(y.style||!y.testMode)&&this.setStyle(y.style||s.e.DEFAULT_STYLE,{config:y.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this.indoor=new Ge(this),y.hash&&(this._hash=new N1(typeof y.hash=="string"&&y.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch});const h=y.bounds;h&&(this.resize(),this.fitBounds(h,s.l({},y.fitBoundsOptions,{duration:0})))}this.resize(),y.attributionControl&&this.addControl(new d0({customAttribution:y.customAttribution})),this._logoControl=new uc,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new s.A(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new s.A(`${h.dataType}dataloading`,h))}),this._interactions=new V1(this)}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new s.A("movestart",y)).fire(new s.A("move",y)),this.fire(new s.A("resize",y)),a&&this.fire(new s.A("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(s.aB.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(y){return this._scaleFactor=y,this.painter.scaleFactor=y,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(a=>a.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?navigator.language:Array.isArray(y)?y.length===0?void 0:y.map(a=>a==="auto"?navigator.language:a):y}setLanguage(y){const a=this._parseLanguage(y);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,a=y.projection.name;let h;a==="globe"&&y.zoom>=s.bY?(y.setMercatorFromTransition(),h=!0):a==="mercator"&&y.zoom<s.bY&&(y.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,a){return this._updateProjection(y||a||{name:"mercator"})}_updateProjection(y){let a;return a=y.name==="globe"&&this.transform.zoom>=s.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(y,a){return this.transform.locationPoint3D(s.bO.convert(y),a)}unproject(y,a){return this.transform.pointLocation3D(s.P.convert(y),a)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,a,h){const _=E=>{let C=[];if(Array.isArray(a)){const M=a.filter(j=>this.getLayer(j));C=M.length?this.queryRenderedFeatures(E,{layers:M}):[]}else C=this.queryRenderedFeatures(E,{target:a});return C};if(y==="mouseenter"||y==="mouseover"){let E=!1;return{listener:h,targets:a,delegates:{mousemove:M=>{const j=_(M.point);j.length?E||(E=!0,h.call(this,new Fl(y,this,M.originalEvent,{features:j}))):E=!1},mouseout:()=>{E=!1}}}}if(y==="mouseleave"||y==="mouseout"){let E=!1;return{listener:h,targets:a,delegates:{mousemove:j=>{_(j.point).length?E=!0:E&&(E=!1,h.call(this,new Fl(y,this,j.originalEvent)))},mouseout:j=>{E&&(E=!1,h.call(this,new Fl(y,this,j.originalEvent)))}}}}{const E=C=>{const M=_(C.point);M.length&&(C.features=M,h.call(this,C),delete C.features)};return{listener:h,targets:a,delegates:{[y]:E}}}}on(y,a,h){if(typeof a=="function"||h===void 0)return super.on(y,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._createDelegatedListener(y,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(_);for(const E in _.delegates)this.on(E,_.delegates[E]);return this}once(y,a,h){if(typeof a=="function"||h===void 0)return super.once(y,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._createDelegatedListener(y,a,h);for(const E in _.delegates)this.once(E,_.delegates[E]);return this}off(y,a,h){if(typeof a=="function"||h===void 0)return super.off(y,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._delegatedListeners?this._delegatedListeners[y]:void 0;return _&&(E=>{for(let C=0;C<E.length;C++){const M=E[C];if(M.listener===h&&xi(M.targets,a)){for(const j in M.delegates)this.off(j,M.delegates[j]);return E.splice(C,1),this}}})(_),this}queryRenderedFeatures(y,a){if(!this.style)return[];if(y===void 0||y instanceof s.P||Array.isArray(y)||a!==void 0||(a=y,y=void 0),y=y||[[0,0],[this.transform.width,this.transform.height]],!a){const C=this.style.queryRenderedFeatures(y,void 0,this.transform),M=this.style.queryRenderedFeatureset(y,void 0,this.transform);return C.concat(M)}let h=!0;if(a.target&&(h=this._isTargetValid(a.target),h&&!a.layers))return this.style.queryRenderedFeatureset(y,a,this.transform);let _=!0;if(a.layers&&Array.isArray(a.layers)){for(const C of a.layers)if(!this._isValidId(C)){_=!1;break}if(_&&!a.target)return this.style.queryRenderedFeatures(y,a,this.transform)}let E=[];return _&&(E=E.concat(this.style.queryRenderedFeatures(y,a,this.transform))),h&&(E=E.concat(this.style.queryRenderedFeatureset(y,a,this.transform))),E}querySourceFeatures(y,a){return!y||typeof y=="string"&&!this._isValidId(y)?[]:this.style.querySourceFeatures(y,a)}isPointOnSurface(y){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&s.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(y))}addInteraction(y,a){return this._interactions.add(y,a),this}removeInteraction(y){return this._interactions.remove(y),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this}setStyle(y,a){return a=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&y&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(y,(h,_)=>{h?(s.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(y,a)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(y,a))}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y){const h=s.l({},a);a&&a.config&&(h.initialConfig=a.config,delete h.config),this.style=new Xr(this,h).load(y),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(y){return y==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.cs(y)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${y}".`))),!1)}_isTargetValid(y){return"featuresetId"in y?this._isValidId("importId"in y?y.importId:y.featuresetId):"layerId"in y&&this._isValidId(y.layerId)}_areTargetsValid(y){if(Array.isArray(y)){for(const a of y)if(!this._isValidId(a))return!1;return!0}return this._isTargetValid(y)}addSource(y,a){return this._isValidId(y)?(this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)):this}isSourceLoaded(y){return!!this._isValidId(y)&&!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(y,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(y,a,h)}removeSource(y){return this._isValidId(y)?(this.style.removeSource(y),this._updateTerrain(),this._update(!0)):this}getSource(y){return this._isValidId(y)?this.style.getOwnSource(y):null}addImage(y,a,{pixelRatio:h=1,sdf:_=!1,stretchX:E,stretchY:C,content:M}={}){this._lazyInitEmptyStyle();const j=s.I.from(y);if(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:H,height:G,data:Y}=s.q.getImageData(a);this.style.addImage(j,this.style.scope,{data:new s.r({width:H,height:G},Y),pixelRatio:h,stretchX:E,stretchY:C,content:M,sdf:_,version:0,usvg:!1})}else if(a.width===void 0||a.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:H,height:G}=a,Y=a;this.style.addImage(j,this.style.scope,{data:new s.r({width:H,height:G},new Uint8Array(Y.data)),pixelRatio:h,stretchX:E,stretchY:C,content:M,sdf:_,usvg:!1,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,y)}}updateImage(y,a){this._lazyInitEmptyStyle();const h=s.I.from(y),_=this.style.getImage(h,this.style.scope);if(!_)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const E=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?s.q.getImageData(a):a,{width:C,height:M,data:j}=E;if(C===void 0||M===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(C!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||M!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${C}, ${M})
                must be that same as the previous version of the image
                (${_.data.width}, ${_.data.height})`)));const H=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);let G=!1;_.usvg?(_.data=new s.r({width:C,height:M},new Uint8Array(j)),_.usvg=!1,_.icon=void 0,G=!0):_.data.replace(j,H),this.style.updateImage(h,this.style.scope,_,G)}hasImage(y){return y?!!this.style&&!!this.style.getImage(s.I.from(y),this.style.scope):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(s.I.from(y),this.style.scope)}loadImage(y,a){s.o(this._requestManager.transformRequest(y,s.R.Image),(h,_)=>{a(h,_ instanceof HTMLImageElement?s.q.getImageData(_):_)})}listImages(){return this.style.listImages().map(y=>y.name)}addModel(y,a){this._lazyInitEmptyStyle(),this.style.addModel(y,a)}hasModel(y){return y?this.style.hasModel(y):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(y){this.style.removeModel(y)}listModels(){return this.style.listModels()}addLayer(y,a){return this._isValidId(y.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)):this}getSlot(y){const a=this.getLayer(y);return a&&a.slot||null}setSlot(y,a){return this.style.setSlot(y,a),this.style.mergeLayers(),this._update(!0)}addImport(y,a){return this.style.addImport(y,a),this}updateImport(y,a){return typeof a!="string"&&a.id!==y?(this.removeImport(y),this.addImport(a)):(this.style.updateImport(y,a),this._update(!0))}removeImport(y){return this.style.removeImport(y),this}moveImport(y,a){return this.style.moveImport(y,a),this._update(!0)}moveLayer(y,a){return this._isValidId(y)?(this.style.moveLayer(y,a),this._update(!0)):this}removeLayer(y){return this._isValidId(y)?(this.style.removeLayer(y),this._update(!0)):this}getLayer(y){if(!this._isValidId(y))return null;const a=this.style.getOwnLayer(y);return a?a.type==="custom"?a.implementation:a.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(y,a,h){return this._isValidId(y)?(this.style.setLayerZoomRange(y,a,h),this._update(!0)):this}setFilter(y,a,h={}){return this._isValidId(y)?(this.style.setFilter(y,a,h),this._update(!0)):this}getFilter(y){return this._isValidId(y)?this.style.getFilter(y):null}setPaintProperty(y,a,h,_={}){return this._isValidId(y)?(this.style.setPaintProperty(y,a,h,_),this._update(!0)):this}getPaintProperty(y,a){return this._isValidId(y)?this.style.getPaintProperty(y,a):null}setLayoutProperty(y,a,h,_={}){return this._isValidId(y)?(this.style.setLayoutProperty(y,a,h,_),this._update(!0)):this}getLayoutProperty(y,a){return this._isValidId(y)?this.style.getLayoutProperty(y,a):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(y){return this.style.setGlyphsUrl(y),this._update(!0)}getSchema(y){return this.style.getSchema(y)}setSchema(y,a){return this.style.setSchema(y,a),this._update(!0)}getConfig(y){return this.style.getConfig(y)}setConfig(y,a){return this.style.setConfig(y,a),this._update(!0)}getConfigProperty(y,a){return this.style.getConfigProperty(y,a)}setConfigProperty(y,a,h){return this.style.setConfigProperty(y,a,h),this._update(!0)}getFeaturesetDescriptors(y){return this.style.getFeaturesetDescriptors(y)}setLights(y){if(this._lazyInitEmptyStyle(),y&&y.length===1&&y[0].type==="flat"){const a=y[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(y),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const y=this.style.getLights()||[];return y.length===0&&y.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),y}setLight(y,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:y}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(y){return this._lazyInitEmptyStyle(),this.style.setSnow(y),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(y){return this._lazyInitEmptyStyle(),this.style.setRain(y),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(y){return this._lazyInitEmptyStyle(),this.style.setColorTheme(y),this._update(!0)}setImportColorTheme(y,a){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(y,a),this._update(!0)}setCamera(y){return this.style.setCamera(y),this._triggerCameraUpdate(y)}_triggerCameraUpdate(y){return this._update(this.transform.setOrthographicProjectionAtLowPitch(y["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bO.convert(y),this.transform):0}setFeatureState(y,a){return y.source&&!this._isValidId(y.source)?this:(this.style.setFeatureState(y,a),this._update())}removeFeatureState(y,a){return y.source&&!this._isValidId(y.source)?this:(this.style.removeFeatureState(y,a),this._update())}getFeatureState(y){return y.source&&!this._isValidId(y.source)?null:this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,_,E,C=this._container;for(;C&&(!_||!E);){const M=window.getComputedStyle(C).transform;M&&M!=="none"&&(h=M.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(_=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(E=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(y/_):y,this._containerHeight=E?Math.abs(a/E):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Z("div","mapboxgl-canvas-container",y);this._canvas=Z("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Z("div","mapboxgl-control-container",y),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(E=>{_[E]=Z("div",`mapboxgl-ctrl-${E}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a){const h=s.q.devicePixelRatio||1;this._canvas.width=h*Math.ceil(y),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const a=this._markers.indexOf(y);a!==-1&&this._markers.splice(a,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const a=this._popups.indexOf(y);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const y=s.l({},Q.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",y);a?(rr(a,!0),this.painter=new l0(a,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(a)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let a;this.fire(new s.A("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,_=s.q.now(),E=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=E.createQuery(),E.beginQuery(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,Y=this.transform.pitch,ne=s.q.now(),ee=new s.aa(G,{now:ne,fadeDuration:C,pitch:Y,transition:this.style.transition});this.style.update(ee)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(_);const j=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),j&&(this._placementDirty=j.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,A.mark(w.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const G=s.q.now()-_;E.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const Y=E.getQueryParameter(a,E.QUERY_RESULT)/1e6;E.deleteQuery(a),this.fire(new s.A("gpu-timing-frame",{cpuTime:G,gpuTime:Y}))},50)}if(this.listens("gpu-timing-layer")){const G=this.painter.collectGpuTimers();setTimeout(()=>{const Y=this.painter.queryGpuTimers(G);this.fire(new s.A("gpu-timing-layer",{layerTimes:Y}))},50)}if(this.listens("gpu-timing-deferred-render")){const G=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Y=this.painter.queryGpuTimeDeferredRender(G);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:Y}))},50)}const H=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(H||this._repaint)this.triggerRepaint();else{const G=this.idle();if(G&&(M=this._updateAverageElevation(_,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Y=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:Y})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||H||(this._fullyLoaded=!0,A.mark(w.fullLoad),this._performanceMetricsCollection&&ur(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const a of this._markers)y&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!y||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(y,a=!1){const h=E=>(this.transform.averageElevation=E,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(a||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const E=this.transform.averageElevation;let C=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=y;const M=Math.abs(E-C);if(M>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(C),h(C);this._averageElevation.easeTo(C,y,300)}else if(M>1e-4)return this._averageElevation.jumpTo(C),h(C)}return!!this._averageElevation.isEasing(y)&&h(this._averageElevation.getValue(y))}_authenticate(){Pe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===ze||y.status===401)){const a=this.painter.context.gl;rr(a,!1),this._logoControl instanceof uc&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),On(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&En(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function E(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const M=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,M),M}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(E(y),a.canvasCopies.map(E),a.timeStamps)}_canvasPixelComparison(y,a,h){let _=h[1]-h[0];const E=y.length/4;for(let C=0;C<a.length;C++){const M=a[C];let j=0;for(let H=0;H<M.length;H+=4)M[H]===y[H]&&M[H+1]===y[H+1]&&M[H+2]===y[H+2]&&M[H+3]===y[H+3]&&(j+=1);_+=(h[C+2]-h[C+1])*(1-j/E)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),jn.delete(this.painter.context.gl),br.remove(),Xt.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=s.q.frame(a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(y){const a=this.style?this.style.getSourceCaches():[];return s.bl(a,(h,_)=>h._preloadTiles(y,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(y){this._showParseStatus!==y&&(this._showParseStatus=y,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(y){this._showLayers2DWireframe!==y&&(this._showLayers2DWireframe=y,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(y){this._showLayers3DWireframe!==y&&(this._showLayers3DWireframe=y,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,this._tp.refreshUI(),y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,this._tp.refreshUI(),y&&this._update())}_setCacheLimits(y,a){s.dJ(y,a)}get version(){return v}},NavigationControl:class{constructor(y={}){this.options=s.l({},SM,y),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(s.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=Z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const a=y.getZoom(),h=a===y.getMaxZoom(),_=a===y.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new TM(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,a){const h=Z("button",y,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(y,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);y.setAttribute("aria-label",h),y.firstElementChild&&y.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends s.E{constructor(y={}){super();const a=navigator.geolocation;this.options=s.l({geolocation:a},Bl,y),s.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=c0(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const a=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,y(h)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>a(h.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),h=y.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",y)),this._finish()}}_updateCamera(y){const a=new s.bO(y.coords.longitude,y.coords.latitude),h=y.coords.accuracy,_=this._map.getBearing(),E=s.l({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),E,{geolocateSource:!0})}_updateMarker(y){if(y){const a=new s.bO(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,a=s.bH(1,y._center.lat)*y.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Z("button","mapboxgl-ctrl-geolocate",this._container),Z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z("div","mapboxgl-user-location"),this._dotElement.appendChild(Z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ia({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ia({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:d0,ScaleControl:class{constructor(y={}){this.options=s.l({},ca,y),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,_=a._containerWidth/2-y/2,E=a.unproject([_,h]),C=a.unproject([_+y,h]),M=E.distanceTo(C);if(this.options.unit==="imperial"){const j=3.2808*M;j>5280?this._setScale(y,j/5280,"mile"):this._setScale(y,j,"foot")}else this.options.unit==="nautical"?this._setScale(y,M/1852,"nautical-mile"):M>=1e3?this._setScale(y,M/1e3,"kilometer"):this._setScale(y,M,"meter")}_setScale(y,a,h){this._map._requestDomTask(()=>{const _=function(C){const M=Math.pow(10,`${Math.floor(C)}`.length-1);let j=C/M;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:function(H){const G=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*G)/G}(j),M*j}(a),E=_/a;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${U1[h]}`,this._container.style.width=y*E+"px"})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y={}){this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:s.w("Full screen control 'container' must be a DOM element.")),s.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=Z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(y){super(),this.options=s.l(Object.create(pl),y),this._altitude=this.options.altitude,s.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=s.bO.convert(y),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(y){return this._altitude=y,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const a=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=y;_=h.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Z("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(y),this.options.closeButton){const h=this._closeButton=Z("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let a;return this._classList.delete(y)?a=!1:(this._classList.add(y),a=!0),this._updateClassList(),a}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,_=this._pos;if(!a||!h||!_)return"bottom";const E=h.offsetWidth,C=h.offsetHeight,M=_.x<E/2,j=_.x>a.transform.width-E/2;if(_.y+y<C)return M?"top-left":j?"top-right":"top";if(_.y>a.transform.height-C){if(M)return"bottom-left";if(j)return"bottom-right"}return M?"left":j?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),y.className=a.join(" ")}_update(y){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Z("div","mapboxgl-popup",a.getContainer()),this._tip=Z("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=f0(this._lngLat,this._pos,a.transform)),!this._trackPointer||y){const E=this._pos=this._trackPointer&&y instanceof s.P?y:a.project(this._lngLat,this._altitude),C=nd(this.options.offset),M=this._anchor=this._getAnchor(C.y),j=nd(this.options.offset,M),H=E.add(j).round();a._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${Pu[M]} translate(${H.x}px,${H.y}px)`)})}if(!this._marker&&a._showingGlobe()){const E=s.dK(a.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(TE);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:Ia,Style:Xr,LngLat:s.bO,LngLatBounds:s.aB,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:$f,Evented:s.E,config:s.e,prewarm:s.dP,clearPrewarmedResources:s.dQ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(y){s.e.ACCESS_TOKEN=y},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(y){s.e.API_URL=y},get workerCount(){return s.dR.workerCount},set workerCount(y){s.dR.workerCount=y},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){s.e.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){s.dS(y)},get workerUrl(){return s.dT.workerUrl},set workerUrl(y){s.dT.workerUrl=y},get workerClass(){return s.dT.workerClass},set workerClass(y){s.dT.workerClass=y},get workerParams(){return s.dT.workerParams},set workerParams(y){s.dT.workerParams=y},get dracoUrl(){return s.dU()},set dracoUrl(y){s.dV(y)},get meshoptUrl(){return s.dW()},set meshoptUrl(y){s.dX(y)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var u=i;return u})})(_te);var TOe=_te.exports;const KN=$I(TOe);var $H={};const qH="@firebase/database",GH="1.0.14";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xte="";function COe(t){xte=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IOe{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),sl(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:uw(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AOe{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Od(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vte=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new IOe(e)}}catch{}return new AOe},Gg=vte("localStorage"),ROe=vte("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry=new uA("@firebase/database"),MOe=function(){let t=1;return function(){return t++}}(),bte=function(t){const e=Tce(t),n=new bce;n.update(e);const r=n.digest();return fL.encodeByteArray(r)},O2=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=O2.apply(null,r):typeof r=="object"?e+=sl(r):e+=r,e+=" "}return e};let Ub=null,YH=!0;const POe=function(t,e){tr(!0,"Can't turn on custom loggers persistently."),Ry.logLevel=ss.VERBOSE,Ub=Ry.log.bind(Ry)},bl=function(...t){if(YH===!0&&(YH=!1,Ub===null&&ROe.get("logging_enabled")===!0&&POe()),Ub){const e=O2.apply(null,t);Ub(e)}},L2=function(t){return function(...e){bl(t,...e)}},ZN=function(...t){const e="FIREBASE INTERNAL ERROR: "+O2(...t);Ry.error(e)},Bf=function(...t){const e=`FIREBASE FATAL ERROR: ${O2(...t)}`;throw Ry.error(e),new Error(e)},Xc=function(...t){const e="FIREBASE WARNING: "+O2(...t);Ry.warn(e)},DOe=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Xc("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},qR=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},kOe=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},lx="[MIN_NAME]",y_="[MAX_NAME]",D_=function(t,e){if(t===e)return 0;if(t===lx||e===y_)return-1;if(e===lx||t===y_)return 1;{const n=XH(t),r=XH(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},NOe=function(t,e){return t===e?0:t<e?-1:1},qv=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+sl(e))},WF=function(t){if(typeof t!="object"||t===null)return sl(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=sl(e[r]),n+=":",n+=WF(t[e[r]]);return n+="}",n},wte=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function ic(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Ete=function(t){tr(!qR(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let i,l,u,s,v;t===0?(l=0,u=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(s=Math.min(Math.floor(Math.log(t)/Math.LN2),r),l=s+r,u=Math.round(t*Math.pow(2,n-s)-Math.pow(2,n))):(l=0,u=Math.round(t/Math.pow(2,1-r-n))));const w=[];for(v=n;v;v-=1)w.push(u%2?1:0),u=Math.floor(u/2);for(v=e;v;v-=1)w.push(l%2?1:0),l=Math.floor(l/2);w.push(i?1:0),w.reverse();const A=w.join("");let F="";for(v=0;v<64;v+=8){let W=parseInt(A.substr(v,8),2).toString(16);W.length===1&&(W="0"+W),F=F+W}return F.toLowerCase()},OOe=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},LOe=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function FOe(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const BOe=new RegExp("^-?(0*)\\d{1,10}$"),zOe=-2147483648,jOe=2147483647,XH=function(t){if(BOe.test(t)){const e=Number(t);if(e>=zOe&&e<=jOe)return e}return null},zx=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Xc("Exception was thrown by user callback.",n),e},Math.floor(0))}},VOe=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Hb=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UOe{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,Bc(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Xc(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HOe{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(bl("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Xc(e)}}class lC{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}lC.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $F="5",Ste="v",Tte="s",Cte="r",Ite="f",Ate=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Rte="ls",Mte="p",QN="ac",Pte="websocket",Dte="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kte{constructor(e,n,r,i,l=!1,u="",s=!1,v=!1,w=null){this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=l,this.persistenceKey=u,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=v,this.emulatorOptions=w,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Gg.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Gg.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function WOe(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Nte(t,e,n){tr(typeof e=="string","typeof type must == string"),tr(typeof n=="object","typeof params must == object");let r;if(e===Pte)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Dte)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);WOe(t)&&(n.ns=t.namespace);const i=[];return ic(n,(l,u)=>{i.push(l+"="+u)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Oe{constructor(){this.counters_={}}incrementCounter(e,n=1){Od(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return nce(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v3={},b3={};function qF(t){const e=t.toString();return v3[e]||(v3[e]=new $Oe),v3[e]}function qOe(t,e){const n=t.toString();return b3[n]||(b3[n]=e()),b3[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GOe{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&zx(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KH="start",YOe="close",XOe="pLPCommand",KOe="pRTLPCB",Ote="id",Lte="pw",Fte="ser",ZOe="cb",QOe="seg",JOe="ts",eLe="d",tLe="dframe",Bte=1870,zte=30,nLe=Bte-zte,rLe=25e3,iLe=3e4;class hy{constructor(e,n,r,i,l,u,s){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=l,this.transportSessionId=u,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=L2(e),this.stats_=qF(n),this.urlFn=v=>(this.appCheckToken&&(v[QN]=this.appCheckToken),Nte(n,Dte,v))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new GOe(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(iLe)),kOe(()=>{if(this.isClosed_)return;this.scriptTagHolder=new GF((...l)=>{const[u,s,v,w,A]=l;if(this.incrementIncomingBytes_(l),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,u===KH)this.id=s,this.password=v;else if(u===YOe)s?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(s,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+u)},(...l)=>{const[u,s]=l;this.incrementIncomingBytes_(l),this.myPacketOrderer.handleResponse(u,s)},()=>{this.onClosed_()},this.urlFn);const r={};r[KH]="t",r[Fte]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[ZOe]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Ste]=$F,this.transportSessionId&&(r[Tte]=this.transportSessionId),this.lastSessionId&&(r[Rte]=this.lastSessionId),this.applicationId&&(r[Mte]=this.applicationId),this.appCheckToken&&(r[QN]=this.appCheckToken),typeof location<"u"&&location.hostname&&Ate.test(location.hostname)&&(r[Cte]=Ite);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){hy.forceAllow_=!0}static forceDisallow(){hy.forceDisallow_=!0}static isAvailable(){return hy.forceAllow_?!0:!hy.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!OOe()&&!LOe()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=sl(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=iG(n),i=wte(r,nLe);for(let l=0;l<i.length;l++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[l]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[tLe]="t",r[Ote]=e,r[Lte]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=sl(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class GF{constructor(e,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=MOe(),window[XOe+this.uniqueCallbackIdentifier]=e,window[KOe+this.uniqueCallbackIdentifier]=n,this.myIFrame=GF.createIFrame_();let l="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(l='<script>document.domain="'+document.domain+'";<\/script>');const u="<html><body>"+l+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(u),this.myIFrame.doc.close()}catch(s){bl("frame writing exception"),s.stack&&bl(s.stack),bl(s)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||bl("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Ote]=this.myID,e[Lte]=this.myPW,e[Fte]=this.currentSerial;let n=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+zte+r.length<=Bte;){const u=this.pendingSegs.shift();r=r+"&"+QOe+i+"="+u.seg+"&"+JOe+i+"="+u.ts+"&"+eLe+i+"="+u.d,i++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(r,Math.floor(rLe)),l=()=>{clearTimeout(i),r()};this.addTag(e,l)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{bl("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sLe=16384,oLe=45e3;let DI=null;typeof MozWebSocket<"u"?DI=MozWebSocket:typeof WebSocket<"u"&&(DI=WebSocket);class Th{constructor(e,n,r,i,l,u,s){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=l,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=L2(this.connId),this.stats_=qF(n),this.connURL=Th.connectionURL_(n,u,s,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,i,l){const u={};return u[Ste]=$F,typeof location<"u"&&location.hostname&&Ate.test(location.hostname)&&(u[Cte]=Ite),n&&(u[Tte]=n),r&&(u[Rte]=r),i&&(u[QN]=i),l&&(u[Mte]=l),Nte(e,Pte,u)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Gg.set("previous_websocket_failure",!0);try{let r;dce(),this.mySock=new DI(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Th.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&DI!==null&&!Th.forceDisallow_}static previouslyFailed(){return Gg.isInMemoryStorage||Gg.get("previous_websocket_failure")===!0}markConnectionHealthy(){Gg.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=uw(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(tr(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=sl(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=wte(n,sLe);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(oLe))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Th.responsesRequiredToBeHealthy=2;Th.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{static get ALL_TRANSPORTS(){return[hy,Th]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Th&&Th.isAvailable();let r=n&&!Th.previouslyFailed();if(e.webSocketOnly&&(n||Xc("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Th];else{const i=this.transports_=[];for(const l of jw.ALL_TRANSPORTS)l&&l.isAvailable()&&i.push(l);jw.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}jw.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aLe=6e4,lLe=5e3,cLe=10*1024,uLe=100*1024,w3="t",ZH="d",hLe="s",QH="r",dLe="e",JH="o",eW="a",tW="n",nW="p",fLe="h";class pLe{constructor(e,n,r,i,l,u,s,v,w,A){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=l,this.onMessage_=u,this.onReady_=s,this.onDisconnect_=v,this.onKill_=w,this.lastSessionId=A,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=L2("c:"+this.id+":"),this.transportManager_=new jw(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Hb(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>uLe?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>cLe?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(w3 in e){const n=e[w3];n===eW?this.upgradeIfSecondaryHealthy_():n===QH?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===JH&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=qv("t",e),r=qv("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:nW,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:eW,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:tW,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=qv("t",e),r=qv("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=qv(w3,e);if(ZH in e){const r=e[ZH];if(n===fLe){const i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===tW){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===hLe?this.onConnectionShutdown_(r):n===QH?this.onReset_(r):n===dLe?ZN("Server Error: "+r):n===JH?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ZN("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),$F!==r&&Xc("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Hb(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(aLe))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Hb(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(lLe))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:nW,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Gg.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jte{put(e,n,r,i){}merge(e,n,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vte{constructor(e){this.allowedEvents_=e,this.listeners_={},tr(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const i=this.getInitialEvent(e);i&&n.apply(r,i)}off(e,n,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let l=0;l<i.length;l++)if(i[l].callback===n&&(!r||r===i[l].context)){i.splice(l,1);return}}validateEventType_(e){tr(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kI extends Vte{static getInstance(){return new kI}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!mL()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return tr(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rW=32,iW=768;class Qs{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Ls(){return new Qs("")}function Yi(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Rm(t){return t.pieces_.length-t.pieceNum_}function uo(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Qs(t.pieces_,e)}function YF(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function mLe(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Vw(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Ute(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Qs(e,0)}function ma(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof Qs)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new Qs(n,0)}function Qi(t){return t.pieceNum_>=t.pieces_.length}function Hc(t,e){const n=Yi(t),r=Yi(e);if(n===null)return e;if(n===r)return Hc(uo(t),uo(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function gLe(t,e){const n=Vw(t,0),r=Vw(e,0);for(let i=0;i<n.length&&i<r.length;i++){const l=D_(n[i],r[i]);if(l!==0)return l}return n.length===r.length?0:n.length<r.length?-1:1}function XF(t,e){if(Rm(t)!==Rm(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Hu(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Rm(t)>Rm(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class _Le{constructor(e,n){this.errorPrefix_=n,this.parts_=Vw(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=cA(this.parts_[r]);Hte(this)}}function yLe(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=cA(e),Hte(t)}function xLe(t){const e=t.parts_.pop();t.byteLength_-=cA(e),t.parts_.length>0&&(t.byteLength_-=1)}function Hte(t){if(t.byteLength_>iW)throw new Error(t.errorPrefix_+"has a key path longer than "+iW+" bytes ("+t.byteLength_+").");if(t.parts_.length>rW)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+rW+") or object contains a cycle "+Fg(t))}function Fg(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KF extends Vte{static getInstance(){return new KF}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return tr(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv=1e3,vLe=60*5*1e3,sW=30*1e3,bLe=1.3,wLe=3e4,ELe="server_kill",oW=3;class wf extends jte{constructor(e,n,r,i,l,u,s,v){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=l,this.authTokenProvider_=u,this.appCheckTokenProvider_=s,this.authOverride_=v,this.id=wf.nextPersistentConnectionId_++,this.log_=L2("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Gv,this.maxReconnectDelay_=vLe,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,v)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");KF.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&kI.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const i=++this.requestNumber_,l={r:i,a:e,b:n};this.log_(sl(l)),tr(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(l),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const n=new cf,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:u=>{const s=u.d;u.s==="ok"?n.resolve(s):n.reject(s)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const l=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(l),n.promise}listen(e,n,r,i){this.initConnection_();const l=e._queryIdentifier,u=e._path.toString();this.log_("Listen called for "+u+" "+l),this.listens.has(u)||this.listens.set(u,new Map),tr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),tr(!this.listens.get(u).has(l),"listen() called twice for same path/queryId.");const s={onComplete:i,hashFn:n,query:e,tag:r};this.listens.get(u).set(l,s),this.connected_&&this.sendListen_(s)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const l={p:r},u="q";e.tag&&(l.q=n._queryObject,l.t=e.tag),l.h=e.hashFn(),this.sendRequest(u,l,s=>{const v=s.d,w=s.s;wf.warnOnListenWarnings_(v,n),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",s),w!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(w,v))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Od(e,"w")){const r=Vy(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',l=n._path.toString();Xc(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${l} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||vce(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=sW)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=xce(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,i=>{const l=i.s,u=i.d||"error";this.authToken_===e&&(l==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(l,u))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),tr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,n)}sendUnlisten_(e,n,r,i){this.log_("Unlisten on "+e+" for "+n);const l={p:e},u="n";i&&(l.q=r,l.t=i),this.sendRequest(u,l)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,i){const l={p:n,d:r};this.log_("onDisconnect "+e,l),this.sendRequest(e,l,u=>{i&&setTimeout(()=>{i(u.s,u.d)},Math.floor(0))})}put(e,n,r,i){this.putInternal("p",e,n,r,i)}merge(e,n,r,i){this.putInternal("m",e,n,r,i)}putInternal(e,n,r,i,l){this.initConnection_();const u={p:n,d:r};l!==void 0&&(u.h=l),this.outstandingPuts_.push({action:e,request:u,onComplete:i}),this.outstandingPutCount_++;const s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,l=>{this.log_(n+" response",l),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(l.s,l.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const l=r.d;this.log_("reportStats","Error sending stats: "+l)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+sl(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):ZN("Unrecognized action received from server: "+sl(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){tr(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Gv,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Gv,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>wLe&&(this.reconnectDelay_=Gv),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*bLe)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+wf.nextConnectionId_++,l=this.lastSessionId;let u=!1,s=null;const v=function(){s?s.close():(u=!0,r())},w=function(F){tr(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(F)};this.realtime_={close:v,sendRequest:w};const A=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[F,W]=await Promise.all([this.authTokenProvider_.getToken(A),this.appCheckTokenProvider_.getToken(A)]);u?bl("getToken() completed but was canceled"):(bl("getToken() completed. Creating connection."),this.authToken_=F&&F.accessToken,this.appCheckToken_=W&&W.token,s=new pLe(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,K=>{Xc(K+" ("+this.repoInfo_.toString()+")"),this.interrupt(ELe)},l))}catch(F){this.log_("Failed to get token: "+F),u||(this.repoInfo_.nodeAdmin&&Xc(F),v())}}}interrupt(e){bl("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){bl("Resuming connection for reason: "+e),delete this.interruptReasons_[e],OC(this.interruptReasons_)&&(this.reconnectDelay_=Gv,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(l=>WF(l)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const r=new Qs(e).toString();let i;if(this.listens.has(r)){const l=this.listens.get(r);i=l.get(n),l.delete(n),l.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,n){bl("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=oW&&(this.reconnectDelay_=sW,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){bl("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=oW&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+xte.replace(/\./g,"-")]=1,mL()?e["framework.cordova"]=1:uG()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=kI.getInstance().currentlyOnline();return OC(this.interruptReasons_)&&e}}wf.nextPersistentConnectionId_=0;wf.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new Ji(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new Ji(lx,e),i=new Ji(lx,n);return this.compare(r,i)!==0}minPost(){return Ji.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xT;class Wte extends GR{static get __EMPTY_NODE(){return xT}static set __EMPTY_NODE(e){xT=e}compare(e,n){return D_(e.name,n.name)}isDefinedOn(e){throw gx("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return Ji.MIN}maxPost(){return new Ji(y_,xT)}makePost(e,n){return tr(typeof e=="string","KeyIndex indexValue must always be a string."),new Ji(e,xT)}toString(){return".key"}}const My=new Wte;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vT{constructor(e,n,r,i,l=null){this.isReverse_=i,this.resultGenerator_=l,this.nodeStack_=[];let u=1;for(;!e.isEmpty();)if(e=e,u=n?r(e.key,n):1,i&&(u*=-1),u<0)this.isReverse_?e=e.left:e=e.right;else if(u===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class il{constructor(e,n,r,i,l){this.key=e,this.value=n,this.color=r??il.RED,this.left=i??Wc.EMPTY_NODE,this.right=l??Wc.EMPTY_NODE}copy(e,n,r,i,l){return new il(e??this.key,n??this.value,r??this.color,i??this.left,l??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const l=r(e,i.key);return l<0?i=i.copy(null,null,null,i.left.insert(e,n,r),null):l===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Wc.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,i;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Wc.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,il.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,il.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}il.RED=!0;il.BLACK=!1;class SLe{copy(e,n,r,i,l){return this}insert(e,n,r){return new il(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Wc{constructor(e,n=Wc.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Wc(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,il.BLACK,null,null))}remove(e){return new Wc(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,il.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,i=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new vT(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new vT(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new vT(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new vT(this.root_,null,this.comparator_,!0,e)}}Wc.EMPTY_NODE=new SLe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TLe(t,e){return D_(t.name,e.name)}function ZF(t,e){return D_(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let JN;function CLe(t){JN=t}const $te=function(t){return typeof t=="number"?"number:"+Ete(t):"string:"+t},qte=function(t){if(t.isLeafNode()){const e=t.val();tr(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Od(e,".sv"),"Priority must be a string or number.")}else tr(t===JN||t.isEmpty(),"priority of unexpected type.");tr(t===JN||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aW;class tl{static set __childrenNodeConstructor(e){aW=e}static get __childrenNodeConstructor(){return aW}constructor(e,n=tl.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,tr(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),qte(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new tl(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:tl.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Qi(e)?this:Yi(e)===".priority"?this.priorityNode_:tl.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:tl.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=Yi(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(tr(r!==".priority"||Rm(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,tl.__childrenNodeConstructor.EMPTY_NODE.updateChild(uo(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+$te(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Ete(this.value_):e+=this.value_,this.lazyHash_=bte(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===tl.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof tl.__childrenNodeConstructor?-1:(tr(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,i=tl.VALUE_TYPE_ORDER.indexOf(n),l=tl.VALUE_TYPE_ORDER.indexOf(r);return tr(i>=0,"Unknown leaf type: "+n),tr(l>=0,"Unknown leaf type: "+r),i===l?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:l-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}tl.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gte,Yte;function ILe(t){Gte=t}function ALe(t){Yte=t}class RLe extends GR{compare(e,n){const r=e.node.getPriority(),i=n.node.getPriority(),l=r.compareTo(i);return l===0?D_(e.name,n.name):l}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return Ji.MIN}maxPost(){return new Ji(y_,new tl("[PRIORITY-POST]",Yte))}makePost(e,n){const r=Gte(e);return new Ji(n,new tl("[PRIORITY-POST]",r))}toString(){return".priority"}}const $o=new RLe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MLe=Math.log(2);class PLe{constructor(e){const n=l=>parseInt(Math.log(l)/MLe,10),r=l=>parseInt(Array(l+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const NI=function(t,e,n,r){t.sort(e);const i=function(v,w){const A=w-v;let F,W;if(A===0)return null;if(A===1)return F=t[v],W=n?n(F):F,new il(W,F.node,il.BLACK,null,null);{const K=parseInt(A/2,10)+v,Q=i(v,K),Z=i(K+1,w);return F=t[K],W=n?n(F):F,new il(W,F.node,il.BLACK,Q,Z)}},l=function(v){let w=null,A=null,F=t.length;const W=function(Q,Z){const oe=F-Q,ae=F;F-=Q;const me=i(oe+1,ae),pe=t[oe],_e=n?n(pe):pe;K(new il(_e,pe.node,Z,null,me))},K=function(Q){w?(w.left=Q,w=Q):(A=Q,w=Q)};for(let Q=0;Q<v.count;++Q){const Z=v.nextBitIsOne(),oe=Math.pow(2,v.count-(Q+1));Z?W(oe,il.BLACK):(W(oe,il.BLACK),W(oe,il.RED))}return A},u=new PLe(t.length),s=l(u);return new Wc(r||e,s)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let E3;const W0={};class mf{static get Default(){return tr(W0&&$o,"ChildrenNode.ts has not been loaded"),E3=E3||new mf({".priority":W0},{".priority":$o}),E3}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Vy(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Wc?n:null}hasIndex(e){return Od(this.indexSet_,e.toString())}addIndex(e,n){tr(e!==My,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const l=n.getIterator(Ji.Wrap);let u=l.getNext();for(;u;)i=i||e.isDefinedOn(u.node),r.push(u),u=l.getNext();let s;i?s=NI(r,e.getCompare()):s=W0;const v=e.toString(),w=Object.assign({},this.indexSet_);w[v]=e;const A=Object.assign({},this.indexes_);return A[v]=s,new mf(A,w)}addToIndexes(e,n){const r=LC(this.indexes_,(i,l)=>{const u=Vy(this.indexSet_,l);if(tr(u,"Missing index implementation for "+l),i===W0)if(u.isDefinedOn(e.node)){const s=[],v=n.getIterator(Ji.Wrap);let w=v.getNext();for(;w;)w.name!==e.name&&s.push(w),w=v.getNext();return s.push(e),NI(s,u.getCompare())}else return W0;else{const s=n.get(e.name);let v=i;return s&&(v=v.remove(new Ji(e.name,s))),v.insert(e,e.node)}});return new mf(r,this.indexSet_)}removeFromIndexes(e,n){const r=LC(this.indexes_,i=>{if(i===W0)return i;{const l=n.get(e.name);return l?i.remove(new Ji(e.name,l)):i}});return new mf(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yv;class wi{static get EMPTY_NODE(){return Yv||(Yv=new wi(new Wc(ZF),null,mf.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&qte(this.priorityNode_),this.children_.isEmpty()&&tr(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Yv}updatePriority(e){return this.children_.isEmpty()?this:new wi(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Yv:n}}getChild(e){const n=Yi(e);return n===null?this:this.getImmediateChild(n).getChild(uo(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(tr(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new Ji(e,n);let i,l;n.isEmpty()?(i=this.children_.remove(e),l=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),l=this.indexMap_.addToIndexes(r,this.children_));const u=i.isEmpty()?Yv:this.priorityNode_;return new wi(i,u,l)}}updateChild(e,n){const r=Yi(e);if(r===null)return n;{tr(Yi(e)!==".priority"||Rm(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(uo(e),n);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,i=0,l=!0;if(this.forEachChild($o,(u,s)=>{n[u]=s.val(e),r++,l&&wi.INTEGER_REGEXP_.test(u)?i=Math.max(i,Number(u)):l=!1}),!e&&l&&i<2*r){const u=[];for(const s in n)u[s]=n[s];return u}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+$te(this.getPriority().val())+":"),this.forEachChild($o,(n,r)=>{const i=r.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":bte(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const i=this.resolveIndex_(r);if(i){const l=i.getPredecessorKey(new Ji(e,n));return l?l.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new Ji(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new Ji(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ji.Wrap);let l=i.peek();for(;l!=null&&n.compare(l,e)<0;)i.getNext(),l=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ji.Wrap);let l=i.peek();for(;l!=null&&n.compare(l,e)>0;)i.getNext(),l=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===F2?-1:0}withIndex(e){if(e===My||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new wi(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===My||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator($o),i=n.getIterator($o);let l=r.getNext(),u=i.getNext();for(;l&&u;){if(l.name!==u.name||!l.node.equals(u.node))return!1;l=r.getNext(),u=i.getNext()}return l===null&&u===null}else return!1;else return!1}}resolveIndex_(e){return e===My?null:this.indexMap_.get(e.toString())}}wi.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class DLe extends wi{constructor(){super(new Wc(ZF),wi.EMPTY_NODE,mf.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return wi.EMPTY_NODE}isEmpty(){return!1}}const F2=new DLe;Object.defineProperties(Ji,{MIN:{value:new Ji(lx,wi.EMPTY_NODE)},MAX:{value:new Ji(y_,F2)}});Wte.__EMPTY_NODE=wi.EMPTY_NODE;tl.__childrenNodeConstructor=wi;CLe(F2);ALe(F2);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kLe=!0;function ka(t,e=null){if(t===null)return wi.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),tr(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new tl(n,ka(e))}if(!(t instanceof Array)&&kLe){const n=[];let r=!1;if(ic(t,(u,s)=>{if(u.substring(0,1)!=="."){const v=ka(s);v.isEmpty()||(r=r||!v.getPriority().isEmpty(),n.push(new Ji(u,v)))}}),n.length===0)return wi.EMPTY_NODE;const l=NI(n,TLe,u=>u.name,ZF);if(r){const u=NI(n,$o.getCompare());return new wi(l,ka(e),new mf({".priority":u},{".priority":$o}))}else return new wi(l,ka(e),mf.Default)}else{let n=wi.EMPTY_NODE;return ic(t,(r,i)=>{if(Od(t,r)&&r.substring(0,1)!=="."){const l=ka(i);(l.isLeafNode()||!l.isEmpty())&&(n=n.updateImmediateChild(r,l))}}),n.updatePriority(ka(e))}}ILe(ka);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NLe extends GR{constructor(e){super(),this.indexPath_=e,tr(!Qi(e)&&Yi(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),i=this.extractChild(n.node),l=r.compareTo(i);return l===0?D_(e.name,n.name):l}makePost(e,n){const r=ka(e),i=wi.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ji(n,i)}maxPost(){const e=wi.EMPTY_NODE.updateChild(this.indexPath_,F2);return new Ji(y_,e)}toString(){return Vw(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OLe extends GR{compare(e,n){const r=e.node.compareTo(n.node);return r===0?D_(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return Ji.MIN}maxPost(){return Ji.MAX}makePost(e,n){const r=ka(e);return new Ji(n,r)}toString(){return".value"}}const LLe=new OLe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xte(t){return{type:"value",snapshotNode:t}}function cx(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Uw(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Hw(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function FLe(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF{constructor(e){this.index_=e}updateChild(e,n,r,i,l,u){tr(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const s=e.getImmediateChild(n);return s.getChild(i).equals(r.getChild(i))&&s.isEmpty()===r.isEmpty()||(u!=null&&(r.isEmpty()?e.hasChild(n)?u.trackChildChange(Uw(n,s)):tr(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?u.trackChildChange(cx(n,r)):u.trackChildChange(Hw(n,r,s))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild($o,(i,l)=>{n.hasChild(i)||r.trackChildChange(Uw(i,l))}),n.isLeafNode()||n.forEachChild($o,(i,l)=>{if(e.hasChild(i)){const u=e.getImmediateChild(i);u.equals(l)||r.trackChildChange(Hw(i,l,u))}else r.trackChildChange(cx(i,l))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?wi.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ww{constructor(e){this.indexedFilter_=new QF(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ww.getStartPost_(e),this.endPost_=Ww.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,i,l,u){return this.matches(new Ji(n,r))||(r=wi.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,i,l,u)}updateFullNode(e,n,r){n.isLeafNode()&&(n=wi.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(wi.EMPTY_NODE);const l=this;return n.forEachChild($o,(u,s)=>{l.matches(new Ji(u,s))||(i=i.updateImmediateChild(u,wi.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BLe{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Ww(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,i,l,u){return this.rangedFilter_.matches(new Ji(n,r))||(r=wi.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,i,l,u):this.fullLimitUpdateChild_(e,n,r,l,u)}updateFullNode(e,n,r){let i;if(n.isLeafNode()||n.isEmpty())i=wi.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=wi.EMPTY_NODE.withIndex(this.index_);let l;this.reverse_?l=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):l=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let u=0;for(;l.hasNext()&&u<this.limit_;){const s=l.getNext();if(this.withinDirectionalStart(s))if(this.withinDirectionalEnd(s))i=i.updateImmediateChild(s.name,s.node),u++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(wi.EMPTY_NODE);let l;this.reverse_?l=i.getReverseIterator(this.index_):l=i.getIterator(this.index_);let u=0;for(;l.hasNext();){const s=l.getNext();u<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?u++:i=i.updateImmediateChild(s.name,wi.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,i,l){let u;if(this.reverse_){const F=this.index_.getCompare();u=(W,K)=>F(K,W)}else u=this.index_.getCompare();const s=e;tr(s.numChildren()===this.limit_,"");const v=new Ji(n,r),w=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),A=this.rangedFilter_.matches(v);if(s.hasChild(n)){const F=s.getImmediateChild(n);let W=i.getChildAfterChild(this.index_,w,this.reverse_);for(;W!=null&&(W.name===n||s.hasChild(W.name));)W=i.getChildAfterChild(this.index_,W,this.reverse_);const K=W==null?1:u(W,v);if(A&&!r.isEmpty()&&K>=0)return l?.trackChildChange(Hw(n,r,F)),s.updateImmediateChild(n,r);{l?.trackChildChange(Uw(n,F));const Z=s.updateImmediateChild(n,wi.EMPTY_NODE);return W!=null&&this.rangedFilter_.matches(W)?(l?.trackChildChange(cx(W.name,W.node)),Z.updateImmediateChild(W.name,W.node)):Z}}else return r.isEmpty()?e:A&&u(w,v)>=0?(l!=null&&(l.trackChildChange(Uw(w.name,w.node)),l.trackChildChange(cx(n,r))),s.updateImmediateChild(n,r).updateImmediateChild(w.name,wi.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$o}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return tr(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return tr(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:lx}hasEnd(){return this.endSet_}getIndexEndValue(){return tr(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return tr(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:y_}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return tr(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===$o}copy(){const e=new JF;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zLe(t){return t.loadsAllData()?new QF(t.getIndex()):t.hasLimit()?new BLe(t):new Ww(t)}function lW(t){const e={};if(t.isDefault())return e;let n;if(t.index_===$o?n="$priority":t.index_===LLe?n="$value":t.index_===My?n="$key":(tr(t.index_ instanceof NLe,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=sl(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=sl(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+sl(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=sl(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+sl(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function cW(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==$o&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OI extends jte{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(tr(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=L2("p:rest:"),this.listens_={}}listen(e,n,r,i){const l=e._path.toString();this.log_("Listen called for "+l+" "+e._queryIdentifier);const u=OI.getListenId_(e,r),s={};this.listens_[u]=s;const v=lW(e._queryParams);this.restRequest_(l+".json",v,(w,A)=>{let F=A;if(w===404&&(F=null,w=null),w===null&&this.onDataUpdate_(l,F,!1,r),Vy(this.listens_,u)===s){let W;w?w===401?W="permission_denied":W="rest_error:"+w:W="ok",i(W,null)}})}unlisten(e,n){const r=OI.getListenId_(e,n);delete this.listens_[r]}get(e){const n=lW(e._queryParams),r=e._path.toString(),i=new cf;return this.restRequest_(r+".json",n,(l,u)=>{let s=u;l===404&&(s=null,l=null),l===null?(this.onDataUpdate_(r,s,!1,null),i.resolve(s)):i.reject(new Error(s))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,l])=>{i&&i.accessToken&&(n.auth=i.accessToken),l&&l.token&&(n.ac=l.token);const u=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+_x(n);this.log_("Sending REST request for "+u);const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(r&&s.readyState===4){this.log_("REST Response for "+u+" received. status:",s.status,"response:",s.responseText);let v=null;if(s.status>=200&&s.status<300){try{v=uw(s.responseText)}catch{Xc("Failed to parse JSON response for "+u+": "+s.responseText)}r(null,v)}else s.status!==401&&s.status!==404&&Xc("Got unsuccessful REST response for "+u+" Status: "+s.status),r(s.status);r=null}},s.open("GET",u,!0),s.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jLe{constructor(){this.rootNode_=wi.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LI(){return{value:null,children:new Map}}function jx(t,e,n){if(Qi(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=Yi(e);t.children.has(r)||t.children.set(r,LI());const i=t.children.get(r);e=uo(e),jx(i,e,n)}}function eO(t,e){if(Qi(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild($o,(r,i)=>{jx(t,new Qs(r),i)}),eO(t,e)}}else if(t.children.size>0){const n=Yi(e);return e=uo(e),t.children.has(n)&&eO(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function tO(t,e,n){t.value!==null?n(e,t.value):VLe(t,(r,i)=>{const l=new Qs(e.toString()+"/"+r);tO(i,l,n)})}function VLe(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ULe{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&ic(this.last_,(r,i)=>{n[r]=n[r]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uW=10*1e3,HLe=30*1e3,WLe=5*60*1e3;class $Le{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new ULe(e);const r=uW+(HLe-uW)*Math.random();Hb(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;ic(e,(i,l)=>{l>0&&Od(this.statsToReport_,i)&&(n[i]=l,r=!0)}),r&&this.server_.reportStats(n),Hb(this.reportStats_.bind(this),Math.floor(Math.random()*2*WLe))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rh;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Rh||(Rh={}));function Kte(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function e5(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function t5(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=Rh.ACK_USER_WRITE,this.source=Kte()}operationForChild(e){if(Qi(this.path)){if(this.affectedTree.value!=null)return tr(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Qs(e));return new FI(Ls(),n,this.revert)}}else return tr(Yi(this.path)===e,"operationForChild called for unrelated child."),new FI(uo(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,n){this.source=e,this.path=n,this.type=Rh.LISTEN_COMPLETE}operationForChild(e){return Qi(this.path)?new $w(this.source,Ls()):new $w(this.source,uo(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=Rh.OVERWRITE}operationForChild(e){return Qi(this.path)?new x_(this.source,Ls(),this.snap.getImmediateChild(e)):new x_(this.source,uo(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=Rh.MERGE}operationForChild(e){if(Qi(this.path)){const n=this.children.subtree(new Qs(e));return n.isEmpty()?null:n.value?new x_(this.source,Ls(),n.value):new qw(this.source,Ls(),n)}else return tr(Yi(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new qw(this.source,uo(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Qi(e))return this.isFullyInitialized()&&!this.filtered_;const n=Yi(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qLe{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function GLe(t,e,n,r){const i=[],l=[];return e.forEach(u=>{u.type==="child_changed"&&t.index_.indexedValueChanged(u.oldSnap,u.snapshotNode)&&l.push(FLe(u.childName,u.snapshotNode))}),Xv(t,i,"child_removed",e,r,n),Xv(t,i,"child_added",e,r,n),Xv(t,i,"child_moved",l,r,n),Xv(t,i,"child_changed",e,r,n),Xv(t,i,"value",e,r,n),i}function Xv(t,e,n,r,i,l){const u=r.filter(s=>s.type===n);u.sort((s,v)=>XLe(t,s,v)),u.forEach(s=>{const v=YLe(t,s,l);i.forEach(w=>{w.respondsTo(s.type)&&e.push(w.createEvent(v,t.query_))})})}function YLe(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function XLe(t,e,n){if(e.childName==null||n.childName==null)throw gx("Should only compare child_ events.");const r=new Ji(e.childName,e.snapshotNode),i=new Ji(n.childName,n.snapshotNode);return t.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YR(t,e){return{eventCache:t,serverCache:e}}function Wb(t,e,n,r){return YR(new v_(e,n,r),t.serverCache)}function Zte(t,e,n,r){return YR(t.eventCache,new v_(e,n,r))}function nO(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function b_(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S3;const KLe=()=>(S3||(S3=new Wc(NOe)),S3);class Io{static fromObject(e){let n=new Io(null);return ic(e,(r,i)=>{n=n.set(new Qs(r),i)}),n}constructor(e,n=KLe()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Ls(),value:this.value};if(Qi(e))return null;{const r=Yi(e),i=this.children.get(r);if(i!==null){const l=i.findRootMostMatchingPathAndValue(uo(e),n);return l!=null?{path:ma(new Qs(r),l.path),value:l.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Qi(e))return this;{const n=Yi(e),r=this.children.get(n);return r!==null?r.subtree(uo(e)):new Io(null)}}set(e,n){if(Qi(e))return new Io(n,this.children);{const r=Yi(e),l=(this.children.get(r)||new Io(null)).set(uo(e),n),u=this.children.insert(r,l);return new Io(this.value,u)}}remove(e){if(Qi(e))return this.children.isEmpty()?new Io(null):new Io(null,this.children);{const n=Yi(e),r=this.children.get(n);if(r){const i=r.remove(uo(e));let l;return i.isEmpty()?l=this.children.remove(n):l=this.children.insert(n,i),this.value===null&&l.isEmpty()?new Io(null):new Io(this.value,l)}else return this}}get(e){if(Qi(e))return this.value;{const n=Yi(e),r=this.children.get(n);return r?r.get(uo(e)):null}}setTree(e,n){if(Qi(e))return n;{const r=Yi(e),l=(this.children.get(r)||new Io(null)).setTree(uo(e),n);let u;return l.isEmpty()?u=this.children.remove(r):u=this.children.insert(r,l),new Io(this.value,u)}}fold(e){return this.fold_(Ls(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((i,l)=>{r[i]=l.fold_(ma(e,i),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,Ls(),n)}findOnPath_(e,n,r){const i=this.value?r(n,this.value):!1;if(i)return i;if(Qi(e))return null;{const l=Yi(e),u=this.children.get(l);return u?u.findOnPath_(uo(e),ma(n,l),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Ls(),n)}foreachOnPath_(e,n,r){if(Qi(e))return this;{this.value&&r(n,this.value);const i=Yi(e),l=this.children.get(i);return l?l.foreachOnPath_(uo(e),ma(n,i),r):new Io(null)}}foreach(e){this.foreach_(Ls(),e)}foreach_(e,n){this.children.inorderTraversal((r,i)=>{i.foreach_(ma(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(e){this.writeTree_=e}static empty(){return new Nh(new Io(null))}}function $b(t,e,n){if(Qi(e))return new Nh(new Io(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let l=r.value;const u=Hc(i,e);return l=l.updateChild(u,n),new Nh(t.writeTree_.set(i,l))}else{const i=new Io(n),l=t.writeTree_.setTree(e,i);return new Nh(l)}}}function hW(t,e,n){let r=t;return ic(n,(i,l)=>{r=$b(r,ma(e,i),l)}),r}function dW(t,e){if(Qi(e))return Nh.empty();{const n=t.writeTree_.setTree(e,new Io(null));return new Nh(n)}}function rO(t,e){return k_(t,e)!=null}function k_(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Hc(n.path,e)):null}function fW(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild($o,(r,i)=>{e.push(new Ji(r,i))}):t.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new Ji(r,i.value))}),e}function hm(t,e){if(Qi(e))return t;{const n=k_(t,e);return n!=null?new Nh(new Io(n)):new Nh(t.writeTree_.subtree(e))}}function iO(t){return t.writeTree_.isEmpty()}function ux(t,e){return Qte(Ls(),t.writeTree_,e)}function Qte(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((i,l)=>{i===".priority"?(tr(l.value!==null,"Priority writes must always be leaf nodes"),r=l.value):n=Qte(ma(t,i),l,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(ma(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n5(t,e){return nne(e,t)}function ZLe(t,e,n,r,i){tr(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=$b(t.visibleWrites,e,n)),t.lastWriteId=r}function QLe(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function JLe(t,e){const n=t.allWrites.findIndex(s=>s.writeId===e);tr(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,l=!1,u=t.allWrites.length-1;for(;i&&u>=0;){const s=t.allWrites[u];s.visible&&(u>=n&&e4e(s,r.path)?i=!1:Hu(r.path,s.path)&&(l=!0)),u--}if(i){if(l)return t4e(t),!0;if(r.snap)t.visibleWrites=dW(t.visibleWrites,r.path);else{const s=r.children;ic(s,v=>{t.visibleWrites=dW(t.visibleWrites,ma(r.path,v))})}return!0}else return!1}function e4e(t,e){if(t.snap)return Hu(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Hu(ma(t.path,n),e))return!0;return!1}function t4e(t){t.visibleWrites=Jte(t.allWrites,n4e,Ls()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function n4e(t){return t.visible}function Jte(t,e,n){let r=Nh.empty();for(let i=0;i<t.length;++i){const l=t[i];if(e(l)){const u=l.path;let s;if(l.snap)Hu(n,u)?(s=Hc(n,u),r=$b(r,s,l.snap)):Hu(u,n)&&(s=Hc(u,n),r=$b(r,Ls(),l.snap.getChild(s)));else if(l.children){if(Hu(n,u))s=Hc(n,u),r=hW(r,s,l.children);else if(Hu(u,n))if(s=Hc(u,n),Qi(s))r=hW(r,Ls(),l.children);else{const v=Vy(l.children,Yi(s));if(v){const w=v.getChild(uo(s));r=$b(r,Ls(),w)}}}else throw gx("WriteRecord should have .snap or .children")}}return r}function ene(t,e,n,r,i){if(!r&&!i){const l=k_(t.visibleWrites,e);if(l!=null)return l;{const u=hm(t.visibleWrites,e);if(iO(u))return n;if(n==null&&!rO(u,Ls()))return null;{const s=n||wi.EMPTY_NODE;return ux(u,s)}}}else{const l=hm(t.visibleWrites,e);if(!i&&iO(l))return n;if(!i&&n==null&&!rO(l,Ls()))return null;{const u=function(w){return(w.visible||i)&&(!r||!~r.indexOf(w.writeId))&&(Hu(w.path,e)||Hu(e,w.path))},s=Jte(t.allWrites,u,e),v=n||wi.EMPTY_NODE;return ux(s,v)}}}function r4e(t,e,n){let r=wi.EMPTY_NODE;const i=k_(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild($o,(l,u)=>{r=r.updateImmediateChild(l,u)}),r;if(n){const l=hm(t.visibleWrites,e);return n.forEachChild($o,(u,s)=>{const v=ux(hm(l,new Qs(u)),s);r=r.updateImmediateChild(u,v)}),fW(l).forEach(u=>{r=r.updateImmediateChild(u.name,u.node)}),r}else{const l=hm(t.visibleWrites,e);return fW(l).forEach(u=>{r=r.updateImmediateChild(u.name,u.node)}),r}}function i4e(t,e,n,r,i){tr(r||i,"Either existingEventSnap or existingServerSnap must exist");const l=ma(e,n);if(rO(t.visibleWrites,l))return null;{const u=hm(t.visibleWrites,l);return iO(u)?i.getChild(n):ux(u,i.getChild(n))}}function s4e(t,e,n,r){const i=ma(e,n),l=k_(t.visibleWrites,i);if(l!=null)return l;if(r.isCompleteForChild(n)){const u=hm(t.visibleWrites,i);return ux(u,r.getNode().getImmediateChild(n))}else return null}function o4e(t,e){return k_(t.visibleWrites,e)}function a4e(t,e,n,r,i,l,u){let s;const v=hm(t.visibleWrites,e),w=k_(v,Ls());if(w!=null)s=w;else if(n!=null)s=ux(v,n);else return[];if(s=s.withIndex(u),!s.isEmpty()&&!s.isLeafNode()){const A=[],F=u.getCompare(),W=l?s.getReverseIteratorFrom(r,u):s.getIteratorFrom(r,u);let K=W.getNext();for(;K&&A.length<i;)F(K,r)!==0&&A.push(K),K=W.getNext();return A}else return[]}function l4e(){return{visibleWrites:Nh.empty(),allWrites:[],lastWriteId:-1}}function BI(t,e,n,r){return ene(t.writeTree,t.treePath,e,n,r)}function r5(t,e){return r4e(t.writeTree,t.treePath,e)}function pW(t,e,n,r){return i4e(t.writeTree,t.treePath,e,n,r)}function zI(t,e){return o4e(t.writeTree,ma(t.treePath,e))}function c4e(t,e,n,r,i,l){return a4e(t.writeTree,t.treePath,e,n,r,i,l)}function i5(t,e,n){return s4e(t.writeTree,t.treePath,e,n)}function tne(t,e){return nne(ma(t.treePath,e),t.writeTree)}function nne(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4e{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;tr(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),tr(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const l=i.type;if(n==="child_added"&&l==="child_removed")this.changeMap.set(r,Hw(r,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&l==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&l==="child_changed")this.changeMap.set(r,Uw(r,i.oldSnap));else if(n==="child_changed"&&l==="child_added")this.changeMap.set(r,cx(r,e.snapshotNode));else if(n==="child_changed"&&l==="child_changed")this.changeMap.set(r,Hw(r,e.snapshotNode,i.oldSnap));else throw gx("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4e{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const rne=new h4e;class s5{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new v_(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return i5(this.writes_,e,r)}}getChildAfterChild(e,n,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:b_(this.viewCache_),l=c4e(this.writes_,i,n,1,r,e);return l.length===0?null:l[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d4e(t){return{filter:t}}function f4e(t,e){tr(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),tr(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function p4e(t,e,n,r,i){const l=new u4e;let u,s;if(n.type===Rh.OVERWRITE){const w=n;w.source.fromUser?u=sO(t,e,w.path,w.snap,r,i,l):(tr(w.source.fromServer,"Unknown source."),s=w.source.tagged||e.serverCache.isFiltered()&&!Qi(w.path),u=jI(t,e,w.path,w.snap,r,i,s,l))}else if(n.type===Rh.MERGE){const w=n;w.source.fromUser?u=g4e(t,e,w.path,w.children,r,i,l):(tr(w.source.fromServer,"Unknown source."),s=w.source.tagged||e.serverCache.isFiltered(),u=oO(t,e,w.path,w.children,r,i,s,l))}else if(n.type===Rh.ACK_USER_WRITE){const w=n;w.revert?u=x4e(t,e,w.path,r,i,l):u=_4e(t,e,w.path,w.affectedTree,r,i,l)}else if(n.type===Rh.LISTEN_COMPLETE)u=y4e(t,e,n.path,r,l);else throw gx("Unknown operation type: "+n.type);const v=l.getChanges();return m4e(e,u,v),{viewCache:u,changes:v}}function m4e(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),l=nO(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(l)||!r.getNode().getPriority().equals(l.getPriority()))&&n.push(Xte(nO(e)))}}function ine(t,e,n,r,i,l){const u=e.eventCache;if(zI(r,n)!=null)return e;{let s,v;if(Qi(n))if(tr(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const w=b_(e),A=w instanceof wi?w:wi.EMPTY_NODE,F=r5(r,A);s=t.filter.updateFullNode(e.eventCache.getNode(),F,l)}else{const w=BI(r,b_(e));s=t.filter.updateFullNode(e.eventCache.getNode(),w,l)}else{const w=Yi(n);if(w===".priority"){tr(Rm(n)===1,"Can't have a priority with additional path components");const A=u.getNode();v=e.serverCache.getNode();const F=pW(r,n,A,v);F!=null?s=t.filter.updatePriority(A,F):s=u.getNode()}else{const A=uo(n);let F;if(u.isCompleteForChild(w)){v=e.serverCache.getNode();const W=pW(r,n,u.getNode(),v);W!=null?F=u.getNode().getImmediateChild(w).updateChild(A,W):F=u.getNode().getImmediateChild(w)}else F=i5(r,w,e.serverCache);F!=null?s=t.filter.updateChild(u.getNode(),w,F,A,i,l):s=u.getNode()}}return Wb(e,s,u.isFullyInitialized()||Qi(n),t.filter.filtersNodes())}}function jI(t,e,n,r,i,l,u,s){const v=e.serverCache;let w;const A=u?t.filter:t.filter.getIndexedFilter();if(Qi(n))w=A.updateFullNode(v.getNode(),r,null);else if(A.filtersNodes()&&!v.isFiltered()){const K=v.getNode().updateChild(n,r);w=A.updateFullNode(v.getNode(),K,null)}else{const K=Yi(n);if(!v.isCompleteForPath(n)&&Rm(n)>1)return e;const Q=uo(n),oe=v.getNode().getImmediateChild(K).updateChild(Q,r);K===".priority"?w=A.updatePriority(v.getNode(),oe):w=A.updateChild(v.getNode(),K,oe,Q,rne,null)}const F=Zte(e,w,v.isFullyInitialized()||Qi(n),A.filtersNodes()),W=new s5(i,F,l);return ine(t,F,n,i,W,s)}function sO(t,e,n,r,i,l,u){const s=e.eventCache;let v,w;const A=new s5(i,e,l);if(Qi(n))w=t.filter.updateFullNode(e.eventCache.getNode(),r,u),v=Wb(e,w,!0,t.filter.filtersNodes());else{const F=Yi(n);if(F===".priority")w=t.filter.updatePriority(e.eventCache.getNode(),r),v=Wb(e,w,s.isFullyInitialized(),s.isFiltered());else{const W=uo(n),K=s.getNode().getImmediateChild(F);let Q;if(Qi(W))Q=r;else{const Z=A.getCompleteChild(F);Z!=null?YF(W)===".priority"&&Z.getChild(Ute(W)).isEmpty()?Q=Z:Q=Z.updateChild(W,r):Q=wi.EMPTY_NODE}if(K.equals(Q))v=e;else{const Z=t.filter.updateChild(s.getNode(),F,Q,W,A,u);v=Wb(e,Z,s.isFullyInitialized(),t.filter.filtersNodes())}}}return v}function mW(t,e){return t.eventCache.isCompleteForChild(e)}function g4e(t,e,n,r,i,l,u){let s=e;return r.foreach((v,w)=>{const A=ma(n,v);mW(e,Yi(A))&&(s=sO(t,s,A,w,i,l,u))}),r.foreach((v,w)=>{const A=ma(n,v);mW(e,Yi(A))||(s=sO(t,s,A,w,i,l,u))}),s}function gW(t,e,n){return n.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function oO(t,e,n,r,i,l,u,s){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let v=e,w;Qi(n)?w=r:w=new Io(null).setTree(n,r);const A=e.serverCache.getNode();return w.children.inorderTraversal((F,W)=>{if(A.hasChild(F)){const K=e.serverCache.getNode().getImmediateChild(F),Q=gW(t,K,W);v=jI(t,v,new Qs(F),Q,i,l,u,s)}}),w.children.inorderTraversal((F,W)=>{const K=!e.serverCache.isCompleteForChild(F)&&W.value===null;if(!A.hasChild(F)&&!K){const Q=e.serverCache.getNode().getImmediateChild(F),Z=gW(t,Q,W);v=jI(t,v,new Qs(F),Z,i,l,u,s)}}),v}function _4e(t,e,n,r,i,l,u){if(zI(i,n)!=null)return e;const s=e.serverCache.isFiltered(),v=e.serverCache;if(r.value!=null){if(Qi(n)&&v.isFullyInitialized()||v.isCompleteForPath(n))return jI(t,e,n,v.getNode().getChild(n),i,l,s,u);if(Qi(n)){let w=new Io(null);return v.getNode().forEachChild(My,(A,F)=>{w=w.set(new Qs(A),F)}),oO(t,e,n,w,i,l,s,u)}else return e}else{let w=new Io(null);return r.foreach((A,F)=>{const W=ma(n,A);v.isCompleteForPath(W)&&(w=w.set(A,v.getNode().getChild(W)))}),oO(t,e,n,w,i,l,s,u)}}function y4e(t,e,n,r,i){const l=e.serverCache,u=Zte(e,l.getNode(),l.isFullyInitialized()||Qi(n),l.isFiltered());return ine(t,u,n,r,rne,i)}function x4e(t,e,n,r,i,l){let u;if(zI(r,n)!=null)return e;{const s=new s5(r,e,i),v=e.eventCache.getNode();let w;if(Qi(n)||Yi(n)===".priority"){let A;if(e.serverCache.isFullyInitialized())A=BI(r,b_(e));else{const F=e.serverCache.getNode();tr(F instanceof wi,"serverChildren would be complete if leaf node"),A=r5(r,F)}A=A,w=t.filter.updateFullNode(v,A,l)}else{const A=Yi(n);let F=i5(r,A,e.serverCache);F==null&&e.serverCache.isCompleteForChild(A)&&(F=v.getImmediateChild(A)),F!=null?w=t.filter.updateChild(v,A,F,uo(n),s,l):e.eventCache.getNode().hasChild(A)?w=t.filter.updateChild(v,A,wi.EMPTY_NODE,uo(n),s,l):w=v,w.isEmpty()&&e.serverCache.isFullyInitialized()&&(u=BI(r,b_(e)),u.isLeafNode()&&(w=t.filter.updateFullNode(w,u,l)))}return u=e.serverCache.isFullyInitialized()||zI(r,Ls())!=null,Wb(e,w,u,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new QF(r.getIndex()),l=zLe(r);this.processor_=d4e(l);const u=n.serverCache,s=n.eventCache,v=i.updateFullNode(wi.EMPTY_NODE,u.getNode(),null),w=l.updateFullNode(wi.EMPTY_NODE,s.getNode(),null),A=new v_(v,u.isFullyInitialized(),i.filtersNodes()),F=new v_(w,s.isFullyInitialized(),l.filtersNodes());this.viewCache_=YR(F,A),this.eventGenerator_=new qLe(this.query_)}get query(){return this.query_}}function b4e(t){return t.viewCache_.serverCache.getNode()}function w4e(t,e){const n=b_(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Qi(e)&&!n.getImmediateChild(Yi(e)).isEmpty())?n.getChild(e):null}function _W(t){return t.eventRegistrations_.length===0}function E4e(t,e){t.eventRegistrations_.push(e)}function yW(t,e,n){const r=[];if(n){tr(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(l=>{const u=l.createCancelEvent(n,i);u&&r.push(u)})}if(e){let i=[];for(let l=0;l<t.eventRegistrations_.length;++l){const u=t.eventRegistrations_[l];if(!u.matches(e))i.push(u);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(l+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return r}function xW(t,e,n,r){e.type===Rh.MERGE&&e.source.queryId!==null&&(tr(b_(t.viewCache_),"We should always have a full cache before handling merges"),tr(nO(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,l=p4e(t.processor_,i,e,n,r);return f4e(t.processor_,l.viewCache),tr(l.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=l.viewCache,sne(t,l.changes,l.viewCache.eventCache.getNode(),null)}function S4e(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild($o,(l,u)=>{r.push(cx(l,u))}),n.isFullyInitialized()&&r.push(Xte(n.getNode())),sne(t,r,n.getNode(),e)}function sne(t,e,n,r){const i=r?[r]:t.eventRegistrations_;return GLe(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let VI;class T4e{constructor(){this.views=new Map}}function C4e(t){tr(!VI,"__referenceConstructor has already been defined"),VI=t}function I4e(){return tr(VI,"Reference.ts has not been loaded"),VI}function A4e(t){return t.views.size===0}function o5(t,e,n,r){const i=e.source.queryId;if(i!==null){const l=t.views.get(i);return tr(l!=null,"SyncTree gave us an op for an invalid query."),xW(l,e,n,r)}else{let l=[];for(const u of t.views.values())l=l.concat(xW(u,e,n,r));return l}}function R4e(t,e,n,r,i){const l=e._queryIdentifier,u=t.views.get(l);if(!u){let s=BI(n,i?r:null),v=!1;s?v=!0:r instanceof wi?(s=r5(n,r),v=!1):(s=wi.EMPTY_NODE,v=!1);const w=YR(new v_(s,v,!1),new v_(r,i,!1));return new v4e(e,w)}return u}function M4e(t,e,n,r,i,l){const u=R4e(t,e,r,i,l);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,u),E4e(u,n),S4e(u,n)}function P4e(t,e,n,r){const i=e._queryIdentifier,l=[];let u=[];const s=Mm(t);if(i==="default")for(const[v,w]of t.views.entries())u=u.concat(yW(w,n,r)),_W(w)&&(t.views.delete(v),w.query._queryParams.loadsAllData()||l.push(w.query));else{const v=t.views.get(i);v&&(u=u.concat(yW(v,n,r)),_W(v)&&(t.views.delete(i),v.query._queryParams.loadsAllData()||l.push(v.query)))}return s&&!Mm(t)&&l.push(new(I4e())(e._repo,e._path)),{removed:l,events:u}}function one(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Py(t,e){let n=null;for(const r of t.views.values())n=n||w4e(r,e);return n}function ane(t,e){if(e._queryParams.loadsAllData())return XR(t);{const r=e._queryIdentifier;return t.views.get(r)}}function lne(t,e){return ane(t,e)!=null}function Mm(t){return XR(t)!=null}function XR(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let UI;function D4e(t){tr(!UI,"__referenceConstructor has already been defined"),UI=t}function k4e(){return tr(UI,"Reference.ts has not been loaded"),UI}let N4e=1;class vW{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Io(null),this.pendingWriteTree_=l4e(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function cne(t,e,n,r,i){return ZLe(t.pendingWriteTree_,e,n,r,i),i?B2(t,new x_(Kte(),e,n)):[]}function Yg(t,e,n=!1){const r=QLe(t.pendingWriteTree_,e);if(JLe(t.pendingWriteTree_,e)){let l=new Io(null);return r.snap!=null?l=l.set(Ls(),!0):ic(r.children,u=>{l=l.set(new Qs(u),!0)}),B2(t,new FI(r.path,l,n))}else return[]}function KR(t,e,n){return B2(t,new x_(e5(),e,n))}function O4e(t,e,n){const r=Io.fromObject(n);return B2(t,new qw(e5(),e,r))}function L4e(t,e){return B2(t,new $w(e5(),e))}function F4e(t,e,n){const r=l5(t,n);if(r){const i=c5(r),l=i.path,u=i.queryId,s=Hc(l,e),v=new $w(t5(u),s);return u5(t,l,v)}else return[]}function aO(t,e,n,r,i=!1){const l=e._path,u=t.syncPointTree_.get(l);let s=[];if(u&&(e._queryIdentifier==="default"||lne(u,e))){const v=P4e(u,e,n,r);A4e(u)&&(t.syncPointTree_=t.syncPointTree_.remove(l));const w=v.removed;if(s=v.events,!i){const A=w.findIndex(W=>W._queryParams.loadsAllData())!==-1,F=t.syncPointTree_.findOnPath(l,(W,K)=>Mm(K));if(A&&!F){const W=t.syncPointTree_.subtree(l);if(!W.isEmpty()){const K=j4e(W);for(let Q=0;Q<K.length;++Q){const Z=K[Q],oe=Z.query,ae=dne(t,Z);t.listenProvider_.startListening(qb(oe),HI(t,oe),ae.hashFn,ae.onComplete)}}}!F&&w.length>0&&!r&&(A?t.listenProvider_.stopListening(qb(e),null):w.forEach(W=>{const K=t.queryToTagMap.get(ZR(W));t.listenProvider_.stopListening(qb(W),K)}))}V4e(t,w)}return s}function B4e(t,e,n,r){const i=l5(t,r);if(i!=null){const l=c5(i),u=l.path,s=l.queryId,v=Hc(u,e),w=new x_(t5(s),v,n);return u5(t,u,w)}else return[]}function z4e(t,e,n,r){const i=l5(t,r);if(i){const l=c5(i),u=l.path,s=l.queryId,v=Hc(u,e),w=Io.fromObject(n),A=new qw(t5(s),v,w);return u5(t,u,A)}else return[]}function bW(t,e,n,r=!1){const i=e._path;let l=null,u=!1;t.syncPointTree_.foreachOnPath(i,(W,K)=>{const Q=Hc(W,i);l=l||Py(K,Q),u=u||Mm(K)});let s=t.syncPointTree_.get(i);s?(u=u||Mm(s),l=l||Py(s,Ls())):(s=new T4e,t.syncPointTree_=t.syncPointTree_.set(i,s));let v;l!=null?v=!0:(v=!1,l=wi.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((K,Q)=>{const Z=Py(Q,Ls());Z&&(l=l.updateImmediateChild(K,Z))}));const w=lne(s,e);if(!w&&!e._queryParams.loadsAllData()){const W=ZR(e);tr(!t.queryToTagMap.has(W),"View does not exist, but we have a tag");const K=U4e();t.queryToTagMap.set(W,K),t.tagToQueryMap.set(K,W)}const A=n5(t.pendingWriteTree_,i);let F=M4e(s,e,n,A,l,v);if(!w&&!u&&!r){const W=ane(s,e);F=F.concat(H4e(t,e,W))}return F}function a5(t,e,n){const i=t.pendingWriteTree_,l=t.syncPointTree_.findOnPath(e,(u,s)=>{const v=Hc(u,e),w=Py(s,v);if(w)return w});return ene(i,e,l,n,!0)}function B2(t,e){return une(e,t.syncPointTree_,null,n5(t.pendingWriteTree_,Ls()))}function une(t,e,n,r){if(Qi(t.path))return hne(t,e,n,r);{const i=e.get(Ls());n==null&&i!=null&&(n=Py(i,Ls()));let l=[];const u=Yi(t.path),s=t.operationForChild(u),v=e.children.get(u);if(v&&s){const w=n?n.getImmediateChild(u):null,A=tne(r,u);l=l.concat(une(s,v,w,A))}return i&&(l=l.concat(o5(i,t,r,n))),l}}function hne(t,e,n,r){const i=e.get(Ls());n==null&&i!=null&&(n=Py(i,Ls()));let l=[];return e.children.inorderTraversal((u,s)=>{const v=n?n.getImmediateChild(u):null,w=tne(r,u),A=t.operationForChild(u);A&&(l=l.concat(hne(A,s,v,w)))}),i&&(l=l.concat(o5(i,t,r,n))),l}function dne(t,e){const n=e.query,r=HI(t,n);return{hashFn:()=>(b4e(e)||wi.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?F4e(t,n._path,r):L4e(t,n._path);{const l=FOe(i,n);return aO(t,n,null,l)}}}}function HI(t,e){const n=ZR(e);return t.queryToTagMap.get(n)}function ZR(t){return t._path.toString()+"$"+t._queryIdentifier}function l5(t,e){return t.tagToQueryMap.get(e)}function c5(t){const e=t.indexOf("$");return tr(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Qs(t.substr(0,e))}}function u5(t,e,n){const r=t.syncPointTree_.get(e);tr(r,"Missing sync point for query tag that we're tracking");const i=n5(t.pendingWriteTree_,e);return o5(r,n,i,null)}function j4e(t){return t.fold((e,n,r)=>{if(n&&Mm(n))return[XR(n)];{let i=[];return n&&(i=one(n)),ic(r,(l,u)=>{i=i.concat(u)}),i}})}function qb(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(k4e())(t._repo,t._path):t}function V4e(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const i=ZR(r),l=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(l)}}}function U4e(){return N4e++}function H4e(t,e,n){const r=e._path,i=HI(t,e),l=dne(t,n),u=t.listenProvider_.startListening(qb(e),i,l.hashFn,l.onComplete),s=t.syncPointTree_.subtree(r);if(i)tr(!Mm(s.value),"If we're adding a query, it shouldn't be shadowed");else{const v=s.fold((w,A,F)=>{if(!Qi(w)&&A&&Mm(A))return[XR(A).query];{let W=[];return A&&(W=W.concat(one(A).map(K=>K.query))),ic(F,(K,Q)=>{W=W.concat(Q)}),W}});for(let w=0;w<v.length;++w){const A=v[w];t.listenProvider_.stopListening(qb(A),HI(t,A))}}return u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new h5(n)}node(){return this.node_}}class d5{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=ma(this.path_,e);return new d5(this.syncTree_,n)}node(){return a5(this.syncTree_,this.path_)}}const W4e=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},wW=function(t,e,n){if(!t||typeof t!="object")return t;if(tr(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return $4e(t[".sv"],e,n);if(typeof t[".sv"]=="object")return q4e(t[".sv"],e);tr(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},$4e=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:tr(!1,"Unexpected server value: "+t)}},q4e=function(t,e,n){t.hasOwnProperty("increment")||tr(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&tr(!1,"Unexpected increment value: "+r);const i=e.node();if(tr(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const u=i.getValue();return typeof u!="number"?r:u+r},G4e=function(t,e,n,r){return f5(e,new d5(n,t),r)},fne=function(t,e,n){return f5(t,new h5(e),n)};function f5(t,e,n){const r=t.getPriority().val(),i=wW(r,e.getImmediateChild(".priority"),n);let l;if(t.isLeafNode()){const u=t,s=wW(u.getValue(),e,n);return s!==u.getValue()||i!==u.getPriority().val()?new tl(s,ka(i)):t}else{const u=t;return l=u,i!==u.getPriority().val()&&(l=l.updatePriority(new tl(i))),u.forEachChild($o,(s,v)=>{const w=f5(v,e.getImmediateChild(s),n);w!==v&&(l=l.updateImmediateChild(s,w))}),l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function m5(t,e){let n=e instanceof Qs?e:new Qs(e),r=t,i=Yi(n);for(;i!==null;){const l=Vy(r.node.children,i)||{children:{},childCount:0};r=new p5(i,r,l),n=uo(n),i=Yi(n)}return r}function Vx(t){return t.node.value}function pne(t,e){t.node.value=e,lO(t)}function mne(t){return t.node.childCount>0}function Y4e(t){return Vx(t)===void 0&&!mne(t)}function QR(t,e){ic(t.node.children,(n,r)=>{e(new p5(n,t,r))})}function gne(t,e,n,r){n&&e(t),QR(t,i=>{gne(i,e,!0)})}function X4e(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function z2(t){return new Qs(t.parent===null?t.name:z2(t.parent)+"/"+t.name)}function lO(t){t.parent!==null&&K4e(t.parent,t.name,t)}function K4e(t,e,n){const r=Y4e(n),i=Od(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,lO(t)):!r&&!i&&(t.node.children[e]=n.node,t.node.childCount++,lO(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z4e=/[\[\].#$\/\u0000-\u001F\u007F]/,Q4e=/[\[\].#$\u0000-\u001F\u007F]/,T3=10*1024*1024,g5=function(t){return typeof t=="string"&&t.length!==0&&!Z4e.test(t)},_ne=function(t){return typeof t=="string"&&t.length!==0&&!Q4e.test(t)},J4e=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),_ne(t)},yne=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!qR(t)||t&&typeof t=="object"&&Od(t,".sv")},cO=function(t,e,n,r){JR(Uy(t,"value"),e,n)},JR=function(t,e,n){const r=n instanceof Qs?new _Le(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Fg(r));if(typeof e=="function")throw new Error(t+"contains a function "+Fg(r)+" with contents = "+e.toString());if(qR(e))throw new Error(t+"contains "+e.toString()+" "+Fg(r));if(typeof e=="string"&&e.length>T3/3&&cA(e)>T3)throw new Error(t+"contains a string greater than "+T3+" utf8 bytes "+Fg(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,l=!1;if(ic(e,(u,s)=>{if(u===".value")i=!0;else if(u!==".priority"&&u!==".sv"&&(l=!0,!g5(u)))throw new Error(t+" contains an invalid key ("+u+") "+Fg(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);yLe(r,u),JR(t,s,r),xLe(r)}),i&&l)throw new Error(t+' contains ".value" child '+Fg(r)+" in addition to actual children.")}},eFe=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const l=Vw(r);for(let u=0;u<l.length;u++)if(!(l[u]===".priority"&&u===l.length-1)){if(!g5(l[u]))throw new Error(t+"contains an invalid key ("+l[u]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(gLe);let i=null;for(n=0;n<e.length;n++){if(r=e[n],i!==null&&Hu(i,r))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},tFe=function(t,e,n,r){const i=Uy(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const l=[];ic(e,(u,s)=>{const v=new Qs(u);if(JR(i,s,ma(n,v)),YF(v)===".priority"&&!yne(s))throw new Error(i+"contains an invalid value for '"+v.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");l.push(v)}),eFe(i,l)},nFe=function(t,e,n){if(qR(e))throw new Error(Uy(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!yne(e))throw new Error(Uy(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},xne=function(t,e,n,r){if(!_ne(n))throw new Error(Uy(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},rFe=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),xne(t,e,n)},_b=function(t,e){if(Yi(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},iFe=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!g5(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!J4e(n))throw new Error(Uy(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sFe{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function _5(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],l=i.getPath();n!==null&&!XF(l,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:l}),n.events.push(i)}n&&t.eventLists_.push(n)}function vne(t,e,n){_5(t,n),bne(t,r=>XF(r,e))}function zf(t,e,n){_5(t,n),bne(t,r=>Hu(r,e)||Hu(e,r))}function bne(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){const l=i.path;e(l)?(oFe(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function oFe(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Ub&&bl("event: "+n.toString()),zx(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aFe="repo_interrupt",lFe=25;class cFe{constructor(e,n,r,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new sFe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=LI(),this.transactionQueueTree_=new p5,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function uFe(t,e,n){if(t.stats_=qF(t.repoInfo_),t.forceRestClient_||VOe())t.server_=new OI(t.repoInfo_,(r,i,l,u)=>{EW(t,r,i,l,u)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>SW(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{sl(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new wf(t.repoInfo_,e,(r,i,l,u)=>{EW(t,r,i,l,u)},r=>{SW(t,r)},r=>{dFe(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=qOe(t.repoInfo_,()=>new $Le(t.stats_,t.server_)),t.infoData_=new jLe,t.infoSyncTree_=new vW({startListening:(r,i,l,u)=>{let s=[];const v=t.infoData_.getNode(r._path);return v.isEmpty()||(s=KR(t.infoSyncTree_,r._path,v),setTimeout(()=>{u("ok")},0)),s},stopListening:()=>{}}),x5(t,"connected",!1),t.serverSyncTree_=new vW({startListening:(r,i,l,u)=>(t.server_.listen(r,l,i,(s,v)=>{const w=u(s,v);zf(t.eventQueue_,r._path,w)}),[]),stopListening:(r,i)=>{t.server_.unlisten(r,i)}})}function hFe(t){const n=t.infoData_.getNode(new Qs(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function y5(t){return W4e({timestamp:hFe(t)})}function EW(t,e,n,r,i){t.dataUpdateCount++;const l=new Qs(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let u=[];if(i)if(r){const v=LC(n,w=>ka(w));u=z4e(t.serverSyncTree_,l,v,i)}else{const v=ka(n);u=B4e(t.serverSyncTree_,l,v,i)}else if(r){const v=LC(n,w=>ka(w));u=O4e(t.serverSyncTree_,l,v)}else{const v=ka(n);u=KR(t.serverSyncTree_,l,v)}let s=l;u.length>0&&(s=eM(t,l)),zf(t.eventQueue_,s,u)}function SW(t,e){x5(t,"connected",e),e===!1&&pFe(t)}function dFe(t,e){ic(e,(n,r)=>{x5(t,n,r)})}function x5(t,e,n){const r=new Qs("/.info/"+e),i=ka(n);t.infoData_.updateSnapshot(r,i);const l=KR(t.infoSyncTree_,r,i);zf(t.eventQueue_,r,l)}function wne(t){return t.nextWriteId_++}function fFe(t,e,n,r,i){v5(t,"set",{path:e.toString(),value:n,priority:r});const l=y5(t),u=ka(n,r),s=a5(t.serverSyncTree_,e),v=fne(u,s,l),w=wne(t),A=cne(t.serverSyncTree_,e,v,w,!0);_5(t.eventQueue_,A),t.server_.put(e.toString(),u.val(!0),(W,K)=>{const Q=W==="ok";Q||Xc("set at "+e+" failed: "+W);const Z=Yg(t.serverSyncTree_,w,!Q);zf(t.eventQueue_,e,Z),hx(t,i,W,K)});const F=Ine(t,e);eM(t,F),zf(t.eventQueue_,F,[])}function pFe(t){v5(t,"onDisconnectEvents");const e=y5(t),n=LI();tO(t.onDisconnect_,Ls(),(i,l)=>{const u=G4e(i,l,t.serverSyncTree_,e);jx(n,i,u)});let r=[];tO(n,Ls(),(i,l)=>{r=r.concat(KR(t.serverSyncTree_,i,l));const u=Ine(t,i);eM(t,u)}),t.onDisconnect_=LI(),zf(t.eventQueue_,Ls(),r)}function mFe(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&eO(t.onDisconnect_,e),hx(t,n,r,i)})}function TW(t,e,n,r){const i=ka(n);t.server_.onDisconnectPut(e.toString(),i.val(!0),(l,u)=>{l==="ok"&&jx(t.onDisconnect_,e,i),hx(t,r,l,u)})}function gFe(t,e,n,r,i){const l=ka(n,r);t.server_.onDisconnectPut(e.toString(),l.val(!0),(u,s)=>{u==="ok"&&jx(t.onDisconnect_,e,l),hx(t,i,u,s)})}function _Fe(t,e,n,r){if(OC(n)){bl("onDisconnect().update() called with empty data.  Don't do anything."),hx(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(i,l)=>{i==="ok"&&ic(n,(u,s)=>{const v=ka(s);jx(t.onDisconnect_,ma(e,u),v)}),hx(t,r,i,l)})}function yFe(t,e,n){let r;Yi(e._path)===".info"?r=bW(t.infoSyncTree_,e,n):r=bW(t.serverSyncTree_,e,n),vne(t.eventQueue_,e._path,r)}function CW(t,e,n){let r;Yi(e._path)===".info"?r=aO(t.infoSyncTree_,e,n):r=aO(t.serverSyncTree_,e,n),vne(t.eventQueue_,e._path,r)}function xFe(t){t.persistentConnection_&&t.persistentConnection_.interrupt(aFe)}function v5(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),bl(n,...e)}function hx(t,e,n,r){e&&zx(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let l=i;r&&(l+=": "+r);const u=new Error(l);u.code=i,e(u)}})}function Ene(t,e,n){return a5(t.serverSyncTree_,e,n)||wi.EMPTY_NODE}function b5(t,e=t.transactionQueueTree_){if(e||tM(t,e),Vx(e)){const n=Tne(t,e);tr(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&vFe(t,z2(e),n)}else mne(e)&&QR(e,n=>{b5(t,n)})}function vFe(t,e,n){const r=n.map(w=>w.currentWriteId),i=Ene(t,e,r);let l=i;const u=i.hash();for(let w=0;w<n.length;w++){const A=n[w];tr(A.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),A.status=1,A.retryCount++;const F=Hc(e,A.path);l=l.updateChild(F,A.currentOutputSnapshotRaw)}const s=l.val(!0),v=e;t.server_.put(v.toString(),s,w=>{v5(t,"transaction put response",{path:v.toString(),status:w});let A=[];if(w==="ok"){const F=[];for(let W=0;W<n.length;W++)n[W].status=2,A=A.concat(Yg(t.serverSyncTree_,n[W].currentWriteId)),n[W].onComplete&&F.push(()=>n[W].onComplete(null,!0,n[W].currentOutputSnapshotResolved)),n[W].unwatcher();tM(t,m5(t.transactionQueueTree_,e)),b5(t,t.transactionQueueTree_),zf(t.eventQueue_,e,A);for(let W=0;W<F.length;W++)zx(F[W])}else{if(w==="datastale")for(let F=0;F<n.length;F++)n[F].status===3?n[F].status=4:n[F].status=0;else{Xc("transaction at "+v.toString()+" failed: "+w);for(let F=0;F<n.length;F++)n[F].status=4,n[F].abortReason=w}eM(t,e)}},u)}function eM(t,e){const n=Sne(t,e),r=z2(n),i=Tne(t,n);return bFe(t,i,r),r}function bFe(t,e,n){if(e.length===0)return;const r=[];let i=[];const u=e.filter(s=>s.status===0).map(s=>s.currentWriteId);for(let s=0;s<e.length;s++){const v=e[s],w=Hc(n,v.path);let A=!1,F;if(tr(w!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),v.status===4)A=!0,F=v.abortReason,i=i.concat(Yg(t.serverSyncTree_,v.currentWriteId,!0));else if(v.status===0)if(v.retryCount>=lFe)A=!0,F="maxretry",i=i.concat(Yg(t.serverSyncTree_,v.currentWriteId,!0));else{const W=Ene(t,v.path,u);v.currentInputSnapshot=W;const K=e[s].update(W.val());if(K!==void 0){JR("transaction failed: Data returned ",K,v.path);let Q=ka(K);typeof K=="object"&&K!=null&&Od(K,".priority")||(Q=Q.updatePriority(W.getPriority()));const oe=v.currentWriteId,ae=y5(t),me=fne(Q,W,ae);v.currentOutputSnapshotRaw=Q,v.currentOutputSnapshotResolved=me,v.currentWriteId=wne(t),u.splice(u.indexOf(oe),1),i=i.concat(cne(t.serverSyncTree_,v.path,me,v.currentWriteId,v.applyLocally)),i=i.concat(Yg(t.serverSyncTree_,oe,!0))}else A=!0,F="nodata",i=i.concat(Yg(t.serverSyncTree_,v.currentWriteId,!0))}zf(t.eventQueue_,n,i),i=[],A&&(e[s].status=2,function(W){setTimeout(W,Math.floor(0))}(e[s].unwatcher),e[s].onComplete&&(F==="nodata"?r.push(()=>e[s].onComplete(null,!1,e[s].currentInputSnapshot)):r.push(()=>e[s].onComplete(new Error(F),!1,null))))}tM(t,t.transactionQueueTree_);for(let s=0;s<r.length;s++)zx(r[s]);b5(t,t.transactionQueueTree_)}function Sne(t,e){let n,r=t.transactionQueueTree_;for(n=Yi(e);n!==null&&Vx(r)===void 0;)r=m5(r,n),e=uo(e),n=Yi(e);return r}function Tne(t,e){const n=[];return Cne(t,e,n),n.sort((r,i)=>r.order-i.order),n}function Cne(t,e,n){const r=Vx(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);QR(e,i=>{Cne(t,i,n)})}function tM(t,e){const n=Vx(e);if(n){let r=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[r]=n[i],r++);n.length=r,pne(e,n.length>0?n:void 0)}QR(e,r=>{tM(t,r)})}function Ine(t,e){const n=z2(Sne(t,e)),r=m5(t.transactionQueueTree_,e);return X4e(r,i=>{C3(t,i)}),C3(t,r),gne(r,i=>{C3(t,i)}),n}function C3(t,e){const n=Vx(e);if(n){const r=[];let i=[],l=-1;for(let u=0;u<n.length;u++)n[u].status===3||(n[u].status===1?(tr(l===u-1,"All SENT items should be at beginning of queue."),l=u,n[u].status=3,n[u].abortReason="set"):(tr(n[u].status===0,"Unexpected transaction status in abort"),n[u].unwatcher(),i=i.concat(Yg(t.serverSyncTree_,n[u].currentWriteId,!0)),n[u].onComplete&&r.push(n[u].onComplete.bind(null,new Error("set"),!1,null))));l===-1?pne(e,void 0):n.length=l+1,zf(t.eventQueue_,z2(e),i);for(let u=0;u<r.length;u++)zx(r[u])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wFe(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function EFe(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Xc(`Invalid query segment '${n}' in query '${t}'`)}return e}const IW=function(t,e){const n=SFe(t),r=n.namespace;n.domain==="firebase.com"&&Bf(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&Bf("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||DOe();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new kte(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new Qs(n.pathString)}},SFe=function(t){let e="",n="",r="",i="",l="",u=!0,s="https",v=443;if(typeof t=="string"){let w=t.indexOf("//");w>=0&&(s=t.substring(0,w-1),t=t.substring(w+2));let A=t.indexOf("/");A===-1&&(A=t.length);let F=t.indexOf("?");F===-1&&(F=t.length),e=t.substring(0,Math.min(A,F)),A<F&&(i=wFe(t.substring(A,F)));const W=EFe(t.substring(Math.min(t.length,F)));w=e.indexOf(":"),w>=0?(u=s==="https"||s==="wss",v=parseInt(e.substring(w+1),10)):w=e.length;const K=e.slice(0,w);if(K.toLowerCase()==="localhost")n="localhost";else if(K.split(".").length<=2)n=K;else{const Q=e.indexOf(".");r=e.substring(0,Q).toLowerCase(),n=e.substring(Q+1),l=r}"ns"in W&&(l=W.ns)}return{host:e,port:v,domain:n,subdomain:r,secure:u,scheme:s,pathString:i,namespace:l}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TFe{constructor(e,n,r,i){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+sl(this.snapshot.exportVal())}}class CFe{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IFe{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return tr(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AFe{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new cf;return mFe(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){_b("OnDisconnect.remove",this._path);const e=new cf;return TW(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){_b("OnDisconnect.set",this._path),cO("OnDisconnect.set",e,this._path);const n=new cf;return TW(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){_b("OnDisconnect.setWithPriority",this._path),cO("OnDisconnect.setWithPriority",e,this._path),nFe("OnDisconnect.setWithPriority",n);const r=new cf;return gFe(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){_b("OnDisconnect.update",this._path),tFe("OnDisconnect.update",e,this._path);const n=new cf;return _Fe(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e,n,r,i){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=i}get key(){return Qi(this._path)?null:YF(this._path)}get ref(){return new Vm(this._repo,this._path)}get _queryIdentifier(){const e=cW(this._queryParams),n=WF(e);return n==="{}"?"default":n}get _queryObject(){return cW(this._queryParams)}isEqual(e){if(e=no(e),!(e instanceof w5))return!1;const n=this._repo===e._repo,r=XF(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+mLe(this._path)}}class Vm extends w5{constructor(e,n){super(e,n,new JF,!1)}get parent(){const e=Ute(this._path);return e===null?null:new Vm(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class WI{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Qs(e),r=uO(this.ref,e);return new WI(this._node.getChild(n),r,$o)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new WI(i,uO(this.ref,r),$o)))}hasChild(e){const n=new Qs(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function E5(t,e){return t=no(t),t._checkNotDeleted("ref"),e!==void 0?uO(t._root,e):t._root}function uO(t,e){return t=no(t),Yi(t._path)===null?rFe("child","path",e):xne("child","path",e),new Vm(t._repo,ma(t._path,e))}function RFe(t){return t=no(t),new AFe(t._repo,t._path)}function MFe(t,e){t=no(t),_b("set",t._path),cO("set",e,t._path);const n=new cf;return fFe(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}class S5{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new TFe("value",this,new WI(e.snapshotNode,new Vm(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new CFe(this,e,n):null}matches(e){return e instanceof S5?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function PFe(t,e,n,r,i){let l;if(typeof r=="object"&&(l=void 0,i=r),typeof r=="function"&&(l=r),i&&i.onlyOnce){const v=n,w=(A,F)=>{CW(t._repo,t,s),v(A,F)};w.userCallback=n.userCallback,w.context=n.context,n=w}const u=new IFe(n,l||void 0),s=new S5(u);return yFe(t._repo,t,s),()=>CW(t._repo,t,s)}function Ane(t,e,n,r){return PFe(t,"value",e,n,r)}C4e(Vm);D4e(Vm);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DFe="FIREBASE_DATABASE_EMULATOR_HOST",hO={};let kFe=!1;function NFe(t,e,n,r){t.repoInfo_=new kte(e,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function OFe(t,e,n,r,i){let l=r||t.options.databaseURL;l===void 0&&(t.options.projectId||Bf("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),bl("Using default host for project ",t.options.projectId),l=`${t.options.projectId}-default-rtdb.firebaseio.com`);let u=IW(l,i),s=u.repoInfo,v;typeof process<"u"&&$H&&(v=$H[DFe]),v?(l=`http://${v}?ns=${s.namespace}`,u=IW(l,i),s=u.repoInfo):u.repoInfo.secure;const w=new HOe(t.name,t.options,e);iFe("Invalid Firebase Database URL",u),Qi(u.path)||Bf("Database URL must point to the root of a Firebase Database (not including a child path).");const A=FFe(s,t,w,new UOe(t,n));return new BFe(A,t)}function LFe(t,e){const n=hO[e];(!n||n[t.key]!==t)&&Bf(`Database ${e}(${t.repoInfo_}) has already been deleted.`),xFe(t),delete n[t.key]}function FFe(t,e,n,r){let i=hO[e.name];i||(i={},hO[e.name]=i);let l=i[t.toURLString()];return l&&Bf("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new cFe(t,kFe,n,r),i[t.toURLString()]=l,l}class BFe{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(uFe(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Vm(this._repo,Ls())),this._rootInternal}_delete(){return this._rootInternal!==null&&(LFe(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Bf("Cannot call "+e+" on a deleted database.")}}function T5(t=t2(),e){const n=e2(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=pL("database");r&&zFe(n,...r)}return n}function zFe(t,e,n,r={}){t=no(t),t._checkNotDeleted("useEmulator");const i=`${e}:${n}`,l=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&mm(r,l.repoInfo_.emulatorOptions))return;Bf("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let u;if(l.repoInfo_.nodeAdmin)r.mockUserToken&&Bf('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),u=new lC(lC.OWNER);else if(r.mockUserToken){const s=typeof r.mockUserToken=="string"?r.mockUserToken:cG(r.mockUserToken,t.app.options.projectId);u=new lC(s)}NFe(l,i,r,u)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jFe(t){COe(S_),gm(new If("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),l=e.getProvider("app-check-internal");return OFe(r,i,l,n)},"PUBLIC").setMultipleInstances(!0)),$u(qH,GH,t),$u(qH,GH,"esm2017")}wf.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};wf.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};jFe();const VFe=T5(f2),Xg=new Map,UFe=async(t,e)=>{try{const n=E5(VFe,`locations/${t}`);await MFe(n,{...e,lastUpdated:Date.now()}),RFe(n).remove()}catch(n){throw console.error("Error updating location:",n),n}},HFe=t=>{if(!navigator.geolocation)throw new Error("Geolocation is not supported by your browser");if(Xg.has(t))return Xg.get(t).cleanup;const e=navigator.geolocation.watchPosition(r=>{const i={latitude:r.coords.latitude,longitude:r.coords.longitude,timestamp:r.timestamp,accuracy:r.coords.accuracy};UFe(t,i)},r=>{let i="Error getting location: ";switch(r.code){case r.PERMISSION_DENIED:i+="Location permission denied. Please enable location access in your browser settings.";break;case r.POSITION_UNAVAILABLE:i+="Location information unavailable. Please check your device settings.";break;case r.TIMEOUT:i+="Location request timed out. Please try again.";break;default:i+="Unknown error occurred."}console.error(i)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}),n=()=>{navigator.geolocation.clearWatch(e),Xg.delete(t)};return Xg.set(t,{watchId:e,cleanup:n}),n},WFe=t=>{Xg.has(t)&&Xg.get(t).cleanup()},$Fe=t=>Xg.has(t),dO=async()=>{if(!navigator.permissions)return!1;try{return(await navigator.permissions.query({name:"geolocation"})).state==="granted"}catch(t){return console.error("Error checking location permission:",t),!1}},qFe=T5(f2),AW="pk.eyJ1IjoicGhpbG9rZW1hIiwiYSI6ImNtYTl4bmJ4cjF2emMydXNpY3V6cDY0NzQifQ.GYEdUGiIJnl1-UEmK-NhXg";console.log("Mapbox token loaded:",AW),KN.accessToken=AW;const Rne=({userId:t,isAdmin:e=!1})=>{const n=se.useRef(null),r=se.useRef(null),i=se.useRef(null),[l,u]=se.useState(null),[s,v]=se.useState(null),[w,A]=se.useState(!0);return se.useEffect(()=>{(async()=>{try{await dO()||v("Location permission is required for tracking. Please enable location access in your browser settings.")}catch{v("Unable to check location permissions. Please ensure your browser supports location services.")}finally{A(!1)}})()},[]),se.useEffect(()=>{if(console.log("MapboxTracker useEffect - initializing map"),!!n.current){if(r.current){console.log("Map already initialized, skipping.");return}try{return r.current=new KN.Map({container:n.current,style:"mapbox://styles/mapbox/streets-v12",center:[-74.5,40],zoom:9}),r.current.on("error",F=>{console.error("Map style error:",F),r.current?.setStyle("mapbox://styles/mapbox/light-v11")}),i.current=new KN.Marker().setLngLat([-74.5,40]).addTo(r.current),()=>{console.log("MapboxTracker cleanup - removing map"),r.current&&(r.current.remove(),r.current=null)}}catch(F){v(`Failed to initialize map: ${F instanceof Error?F.message:"Unknown error"}`),console.error("Map initialization error:",F)}}},[]),se.useEffect(()=>{if(s)return;const F=E5(qFe,`locations/${t}`),W=Ane(F,K=>{const Q=K.val();if(Q){const{latitude:Z,longitude:oe}=Q;u({lat:Z,lng:oe}),i.current&&r.current&&(i.current.setLngLat([oe,Z]),e||r.current.flyTo({center:[oe,Z],zoom:15}))}},K=>{console.error("Error fetching location:",K),v("Failed to load location data. Please try again.")});return()=>W()},[t,e,s]),w?R.jsx("div",{className:"w-full h-[400px] rounded-lg overflow-hidden shadow-lg bg-gray-100 flex items-center justify-center",children:R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mx-auto"}),R.jsx("p",{className:"mt-2 text-gray-600",children:"Checking location permissions..."})]})}):s?R.jsx("div",{className:"w-full h-[400px] rounded-lg overflow-hidden shadow-lg bg-gray-100 flex items-center justify-center",children:R.jsxs("div",{className:"text-center p-4",children:[R.jsx("p",{className:"text-red-500 font-medium",children:s}),R.jsx("p",{className:"text-sm text-gray-600 mt-2",children:s.includes("permission")?"Please enable location access in your browser settings and refresh the page.":"Please check your configuration and try again."})]})}):R.jsxs("div",{className:"w-full h-[400px] rounded-lg overflow-hidden shadow-lg",children:[R.jsx("div",{ref:n,className:"w-full h-full"}),l&&R.jsxs("div",{className:"absolute bottom-4 left-4 bg-white p-2 rounded-lg shadow-md",children:[R.jsx("p",{className:"text-sm font-medium",children:"Current Location:"}),R.jsxs("p",{className:"text-xs text-gray-600",children:[l.lat.toFixed(6),", ",l.lng.toFixed(6)]})]})]})},GFe=()=>{const e=Jq().deliveryId,[n,r]=se.useState(null),[i,l]=se.useState(null),[u,s]=se.useState(!0);return se.useEffect(()=>{if(!e){l("No delivery ID provided"),s(!1);return}const v=T5(f2),w=E5(v,`deliveries/${e}`),A=Ane(w,F=>{const W=F.val();W?(r({id:e,...W}),l(null)):l("Delivery not found"),s(!1)},F=>{console.error("Error fetching delivery:",F),l("Failed to load delivery details"),s(!1)});return()=>A()},[e]),u?R.jsx("div",{className:"flex items-center justify-center h-screen",children:R.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):i?R.jsx("div",{className:"flex items-center justify-center h-screen",children:R.jsxs("div",{className:"text-center",children:[R.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),R.jsx("p",{className:"text-gray-600",children:i})]})}):n?R.jsx("div",{className:"container mx-auto px-4 py-8",children:R.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[R.jsxs("div",{className:"flex justify-between items-center mb-6",children:[R.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Delivery Tracking"}),R.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${n.status==="completed"?"bg-green-100 text-green-800":n.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:n.status.replace("_"," ").toUpperCase()})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Delivery Details"}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-gray-500",children:"Delivery ID"}),R.jsx("p",{className:"font-medium",children:n.id})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-gray-500",children:"Assigned To"}),R.jsx("p",{className:"font-medium",children:n.assignedTo})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-gray-500",children:"Created At"}),R.jsx("p",{className:"font-medium",children:new Date(n.createdAt).toLocaleString()})]}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm text-gray-500",children:"Last Updated"}),R.jsx("p",{className:"font-medium",children:new Date(n.updatedAt).toLocaleString()})]})]}),R.jsx("h2",{className:"text-lg font-semibold mt-6 mb-4",children:"Items"}),R.jsx("div",{className:"space-y-2",children:n.items.map(v=>R.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[R.jsx("span",{className:"font-medium",children:v.name}),R.jsxs("span",{className:"text-gray-600",children:["x",v.quantity]})]},v.id))})]}),R.jsxs("div",{children:[R.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Live Location"}),n.assignedTo&&R.jsx(Rne,{userId:n.assignedTo,isAdmin:!0})]})]})]})}):R.jsx("div",{className:"flex items-center justify-center h-screen",children:R.jsxs("div",{className:"text-center",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Delivery Not Found"}),R.jsx("p",{className:"text-gray-600",children:"The requested delivery could not be found."})]})})},YFe=()=>{const{user:t}=Yo(),[e,n]=se.useState(!1),[r,i]=se.useState(null);return se.useEffect(()=>{t&&n($Fe(t.uid))},[t]),{isTracking:e,error:r,startTracking:()=>{if(!t){i("User must be logged in to track location");return}try{const s=HFe(t.uid);return n(!0),i(null),()=>{s(),n(!1)}}catch(s){i(s instanceof Error?s.message:"Failed to start location tracking"),n(!1)}},stopTracking:()=>{t&&(WFe(t.uid),n(!1))}}},XFe=({className:t=""})=>{const{isTracking:e,error:n,startTracking:r,stopTracking:i}=YFe(),[l,u]=se.useState(null),[s,v]=se.useState(!0);se.useEffect(()=>{(async()=>{try{await dO()||u("Location permission is required for tracking. Please enable location access in your browser settings.")}catch{u("Unable to check location permissions. Please ensure your browser supports location services.")}finally{v(!1)}})()},[]);const w=async()=>{try{if(!await dO()){u("Location permission is required for tracking. Please enable location access in your browser settings.");return}r(),u(null)}catch{u("Failed to start location tracking. Please try again.")}};return s?R.jsx("div",{className:`flex flex-col gap-4 ${t}`,children:R.jsxs("div",{className:"flex items-center justify-center",children:[R.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-primary"}),R.jsx("span",{className:"ml-2 text-gray-600",children:"Checking location permissions..."})]})}):R.jsxs("div",{className:`flex flex-col gap-4 ${t}`,children:[R.jsxs("div",{className:"flex items-center gap-4",children:[R.jsx("button",{onClick:e?i:w,className:`px-4 py-2 rounded-lg font-medium transition-colors ${e?"bg-red-500 hover:bg-red-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,disabled:!!l,children:e?"Stop Tracking":"Start Tracking"}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:`w-3 h-3 rounded-full ${e?"bg-green-500":"bg-gray-300"}`}),R.jsx("span",{className:"text-sm text-gray-600",children:e?"Location tracking active":"Location tracking inactive"})]})]}),(n||l)&&R.jsx("div",{className:"p-3 bg-red-100 text-red-700 rounded-lg text-sm",children:n||l})]})},KFe=()=>{const{user:t}=Yo();return t?R.jsxs("div",{className:"container mx-auto px-4 py-8",children:[R.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Location Tracking"}),R.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[R.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Tracking Controls"}),R.jsx(XFe,{})]}),R.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[R.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Your Current Location"}),R.jsx(Rne,{userId:t.uid,isAdmin:!1})]})]}):R.jsx("div",{className:"container mx-auto px-4 py-8",children:R.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg",children:"Please log in to access location tracking."})})};var C5="ToastProvider",[I5,ZFe,QFe]=b4("Toast"),[Mne,eBe]=M_("Toast",[QFe]),[JFe,nM]=Mne(C5),Pne=t=>{const{__scopeToast:e,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:l=50,children:u}=t,[s,v]=se.useState(null),[w,A]=se.useState(0),F=se.useRef(!1),W=se.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${C5}\`. Expected non-empty \`string\`.`),R.jsx(I5.Provider,{scope:e,children:R.jsx(JFe,{scope:e,label:n,duration:r,swipeDirection:i,swipeThreshold:l,toastCount:w,viewport:s,onViewportChange:v,onToastAdd:se.useCallback(()=>A(K=>K+1),[]),onToastRemove:se.useCallback(()=>A(K=>K-1),[]),isFocusedToastEscapeKeyDownRef:F,isClosePausedRef:W,children:u})})};Pne.displayName=C5;var Dne="ToastViewport",e5e=["F8"],fO="toast.viewportPause",pO="toast.viewportResume",kne=se.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:r=e5e,label:i="Notifications ({hotkey})",...l}=t,u=nM(Dne,n),s=ZFe(n),v=se.useRef(null),w=se.useRef(null),A=se.useRef(null),F=se.useRef(null),W=No(e,F,u.onViewportChange),K=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),Q=u.toastCount>0;se.useEffect(()=>{const oe=ae=>{r.length!==0&&r.every(pe=>ae[pe]||ae.code===pe)&&F.current?.focus()};return document.addEventListener("keydown",oe),()=>document.removeEventListener("keydown",oe)},[r]),se.useEffect(()=>{const oe=v.current,ae=F.current;if(Q&&oe&&ae){const me=()=>{if(!u.isClosePausedRef.current){const Ae=new CustomEvent(fO);ae.dispatchEvent(Ae),u.isClosePausedRef.current=!0}},pe=()=>{if(u.isClosePausedRef.current){const Ae=new CustomEvent(pO);ae.dispatchEvent(Ae),u.isClosePausedRef.current=!1}},_e=Ae=>{!oe.contains(Ae.relatedTarget)&&pe()},De=()=>{oe.contains(document.activeElement)||pe()};return oe.addEventListener("focusin",me),oe.addEventListener("focusout",_e),oe.addEventListener("pointermove",me),oe.addEventListener("pointerleave",De),window.addEventListener("blur",me),window.addEventListener("focus",pe),()=>{oe.removeEventListener("focusin",me),oe.removeEventListener("focusout",_e),oe.removeEventListener("pointermove",me),oe.removeEventListener("pointerleave",De),window.removeEventListener("blur",me),window.removeEventListener("focus",pe)}}},[Q,u.isClosePausedRef]);const Z=se.useCallback(({tabbingDirection:oe})=>{const me=s().map(pe=>{const _e=pe.ref.current,De=[_e,...f5e(_e)];return oe==="forwards"?De:De.reverse()});return(oe==="forwards"?me.reverse():me).flat()},[s]);return se.useEffect(()=>{const oe=F.current;if(oe){const ae=me=>{const pe=me.altKey||me.ctrlKey||me.metaKey;if(me.key==="Tab"&&!pe){const De=document.activeElement,Ae=me.shiftKey;if(me.target===oe&&Ae){w.current?.focus();return}const ye=Z({tabbingDirection:Ae?"backwards":"forwards"}),ue=ye.findIndex(Ie=>Ie===De);I3(ye.slice(ue+1))?me.preventDefault():Ae?w.current?.focus():A.current?.focus()}};return oe.addEventListener("keydown",ae),()=>oe.removeEventListener("keydown",ae)}},[s,Z]),R.jsxs(x1e,{ref:v,role:"region","aria-label":i.replace("{hotkey}",K),tabIndex:-1,style:{pointerEvents:Q?void 0:"none"},children:[Q&&R.jsx(mO,{ref:w,onFocusFromOutsideViewport:()=>{const oe=Z({tabbingDirection:"forwards"});I3(oe)}}),R.jsx(I5.Slot,{scope:n,children:R.jsx(Xi.ol,{tabIndex:-1,...l,ref:W})}),Q&&R.jsx(mO,{ref:A,onFocusFromOutsideViewport:()=>{const oe=Z({tabbingDirection:"backwards"});I3(oe)}})]})});kne.displayName=Dne;var Nne="ToastFocusProxy",mO=se.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=t,l=nM(Nne,n);return R.jsx(L4,{"aria-hidden":!0,tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:u=>{const s=u.relatedTarget;!l.viewport?.contains(s)&&r()}})});mO.displayName=Nne;var j2="Toast",t5e="toast.swipeStart",n5e="toast.swipeMove",r5e="toast.swipeCancel",i5e="toast.swipeEnd",One=se.forwardRef((t,e)=>{const{forceMount:n,open:r,defaultOpen:i,onOpenChange:l,...u}=t,[s,v]=tx({prop:r,defaultProp:i??!0,onChange:l,caller:j2});return R.jsx(Ix,{present:n||s,children:R.jsx(a5e,{open:s,...u,ref:e,onClose:()=>v(!1),onPause:Yu(t.onPause),onResume:Yu(t.onResume),onSwipeStart:Di(t.onSwipeStart,w=>{w.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Di(t.onSwipeMove,w=>{const{x:A,y:F}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","move"),w.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${A}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${F}px`)}),onSwipeCancel:Di(t.onSwipeCancel,w=>{w.currentTarget.setAttribute("data-swipe","cancel"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Di(t.onSwipeEnd,w=>{const{x:A,y:F}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","end"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${A}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${F}px`),v(!1)})})})});One.displayName=j2;var[s5e,o5e]=Mne(j2,{onClose(){}}),a5e=se.forwardRef((t,e)=>{const{__scopeToast:n,type:r="foreground",duration:i,open:l,onClose:u,onEscapeKeyDown:s,onPause:v,onResume:w,onSwipeStart:A,onSwipeMove:F,onSwipeCancel:W,onSwipeEnd:K,...Q}=t,Z=nM(j2,n),[oe,ae]=se.useState(null),me=No(e,ft=>ae(ft)),pe=se.useRef(null),_e=se.useRef(null),De=i||Z.duration,Ae=se.useRef(0),re=se.useRef(De),fe=se.useRef(0),{onToastAdd:ye,onToastRemove:ue}=Z,Ie=Yu(()=>{oe?.contains(document.activeElement)&&Z.viewport?.focus(),u()}),Oe=se.useCallback(ft=>{!ft||ft===1/0||(window.clearTimeout(fe.current),Ae.current=new Date().getTime(),fe.current=window.setTimeout(Ie,ft))},[Ie]);se.useEffect(()=>{const ft=Z.viewport;if(ft){const He=()=>{Oe(re.current),w?.()},bt=()=>{const Nt=new Date().getTime()-Ae.current;re.current=re.current-Nt,window.clearTimeout(fe.current),v?.()};return ft.addEventListener(fO,bt),ft.addEventListener(pO,He),()=>{ft.removeEventListener(fO,bt),ft.removeEventListener(pO,He)}}},[Z.viewport,De,v,w,Oe]),se.useEffect(()=>{l&&!Z.isClosePausedRef.current&&Oe(De)},[l,De,Z.isClosePausedRef,Oe]),se.useEffect(()=>(ye(),()=>ue()),[ye,ue]);const ze=se.useMemo(()=>oe?Une(oe):null,[oe]);return Z.viewport?R.jsxs(R.Fragment,{children:[ze&&R.jsx(l5e,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:ze}),R.jsx(s5e,{scope:n,onClose:Ie,children:Nm.createPortal(R.jsx(I5.ItemSlot,{scope:n,children:R.jsx(y1e,{asChild:!0,onEscapeKeyDown:Di(s,()=>{Z.isFocusedToastEscapeKeyDownRef.current||Ie(),Z.isFocusedToastEscapeKeyDownRef.current=!1}),children:R.jsx(Xi.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":l?"open":"closed","data-swipe-direction":Z.swipeDirection,...Q,ref:me,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Di(t.onKeyDown,ft=>{ft.key==="Escape"&&(s?.(ft.nativeEvent),ft.nativeEvent.defaultPrevented||(Z.isFocusedToastEscapeKeyDownRef.current=!0,Ie()))}),onPointerDown:Di(t.onPointerDown,ft=>{ft.button===0&&(pe.current={x:ft.clientX,y:ft.clientY})}),onPointerMove:Di(t.onPointerMove,ft=>{if(!pe.current)return;const He=ft.clientX-pe.current.x,bt=ft.clientY-pe.current.y,Nt=!!_e.current,wt=["left","right"].includes(Z.swipeDirection),it=["left","up"].includes(Z.swipeDirection)?Math.min:Math.max,nn=wt?it(0,He):0,In=wt?0:it(0,bt),wn=ft.pointerType==="touch"?10:2,Xt={x:nn,y:In},On={originalEvent:ft,delta:Xt};Nt?(_e.current=Xt,bT(n5e,F,On,{discrete:!1})):RW(Xt,Z.swipeDirection,wn)?(_e.current=Xt,bT(t5e,A,On,{discrete:!1}),ft.target.setPointerCapture(ft.pointerId)):(Math.abs(He)>wn||Math.abs(bt)>wn)&&(pe.current=null)}),onPointerUp:Di(t.onPointerUp,ft=>{const He=_e.current,bt=ft.target;if(bt.hasPointerCapture(ft.pointerId)&&bt.releasePointerCapture(ft.pointerId),_e.current=null,pe.current=null,He){const Nt=ft.currentTarget,wt={originalEvent:ft,delta:He};RW(He,Z.swipeDirection,Z.swipeThreshold)?bT(i5e,K,wt,{discrete:!0}):bT(r5e,W,wt,{discrete:!0}),Nt.addEventListener("click",it=>it.preventDefault(),{once:!0})}})})})}),Z.viewport)})]}):null}),l5e=t=>{const{__scopeToast:e,children:n,...r}=t,i=nM(j2,e),[l,u]=se.useState(!1),[s,v]=se.useState(!1);return h5e(()=>u(!0)),se.useEffect(()=>{const w=window.setTimeout(()=>v(!0),1e3);return()=>window.clearTimeout(w)},[]),s?null:R.jsx($A,{asChild:!0,children:R.jsx(L4,{...r,children:l&&R.jsxs(R.Fragment,{children:[i.label," ",n]})})})},c5e="ToastTitle",Lne=se.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return R.jsx(Xi.div,{...r,ref:e})});Lne.displayName=c5e;var u5e="ToastDescription",Fne=se.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return R.jsx(Xi.div,{...r,ref:e})});Fne.displayName=u5e;var Bne="ToastAction",zne=se.forwardRef((t,e)=>{const{altText:n,...r}=t;return n.trim()?R.jsx(Vne,{altText:n,asChild:!0,children:R.jsx(A5,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${Bne}\`. Expected non-empty \`string\`.`),null)});zne.displayName=Bne;var jne="ToastClose",A5=se.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t,i=o5e(jne,n);return R.jsx(Vne,{asChild:!0,children:R.jsx(Xi.button,{type:"button",...r,ref:e,onClick:Di(t.onClick,i.onClose)})})});A5.displayName=jne;var Vne=se.forwardRef((t,e)=>{const{__scopeToast:n,altText:r,...i}=t;return R.jsx(Xi.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function Une(t){const e=[];return Array.from(t.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),d5e(r)){const i=r.ariaHidden||r.hidden||r.style.display==="none",l=r.dataset.radixToastAnnounceExclude==="";if(!i)if(l){const u=r.dataset.radixToastAnnounceAlt;u&&e.push(u)}else e.push(...Une(r))}}),e}function bT(t,e,n,{discrete:r}){const i=n.originalEvent.currentTarget,l=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?OK(i,l):i.dispatchEvent(l)}var RW=(t,e,n=0)=>{const r=Math.abs(t.x),i=Math.abs(t.y),l=r>i;return e==="left"||e==="right"?l&&r>n:!l&&i>n};function h5e(t=()=>{}){const e=Yu(t);Rl(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[e])}function d5e(t){return t.nodeType===t.ELEMENT_NODE}function f5e(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function I3(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var p5e=Pne,Hne=kne,Wne=One,$ne=Lne,qne=Fne,Gne=zne,Yne=A5;const m5e=p5e,Xne=se.forwardRef(({className:t,...e},n)=>R.jsx(Hne,{ref:n,className:Fs("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));Xne.displayName=Hne.displayName;const g5e=T4("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-4 pr-6 text-sm shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[100%] data-[swipe=move]:translate-x-0 data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=open]:fade-in-90 data-[state=closed]:animate-out data-[state=closed]:fade-out-80",{variants:{variant:{default:"bg-background border bg-white/95 dark:bg-gray-900/95",destructive:"group destructive bg-destructive text-destructive-foreground border-destructive/50 dark:bg-destructive dark:text-destructive-foreground dark:border-destructive bg-opacity-95 dark:bg-opacity-95"}},defaultVariants:{variant:"default"}}),Kne=se.forwardRef(({className:t,variant:e,...n},r)=>R.jsx(Wne,{ref:r,className:Fs(g5e({variant:e}),t),...n}));Kne.displayName=Wne.displayName;const _5e=se.forwardRef(({className:t,...e},n)=>R.jsx(Gne,{ref:n,className:Fs("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...e}));_5e.displayName=Gne.displayName;const Zne=se.forwardRef(({className:t,...e},n)=>R.jsx(Yne,{ref:n,className:Fs("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:R.jsx(v4,{className:"h-4 w-4"})}));Zne.displayName=Yne.displayName;const Qne=se.forwardRef(({className:t,...e},n)=>R.jsx($ne,{ref:n,className:Fs("text-sm font-semibold text-gray-100",t),...e}));Qne.displayName=$ne.displayName;const Jne=se.forwardRef(({className:t,...e},n)=>R.jsx(qne,{ref:n,className:Fs("text-sm opacity-90 text-gray-200",t),...e}));Jne.displayName=qne.displayName;function y5e(){const{toasts:t}=wc();return R.jsxs(m5e,{children:[t.map(function({id:e,title:n,description:r,action:i,...l}){return R.jsxs(Kne,{...l,children:[R.jsxs("div",{className:"grid gap-1",children:[n&&R.jsx(Qne,{children:n}),r&&R.jsx(Jne,{children:r})]}),i,R.jsx(Zne,{})]},e)}),R.jsx(Xne,{})]})}class x5e extends se.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("Uncaught error:",e,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:R.jsxs("div",{className:"max-w-md w-full space-y-8 p-8 bg-white rounded-lg shadow-lg",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Something went wrong"}),R.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:this.state.error?.message||"An unexpected error occurred"})]}),R.jsx("div",{className:"mt-8 space-y-6",children:R.jsx("button",{onClick:()=>window.location.reload(),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Refresh Page"})})]})}):this.props.children}}const v5e=new Gge,b5e=()=>R.jsx(x5e,{children:R.jsx(Kge,{client:v5e,children:R.jsx(N0e,{children:R.jsx(L0e,{children:R.jsx(z0e,{children:R.jsx(B0e,{children:R.jsxs(j0e,{children:[R.jsx(y5e,{}),R.jsx(qye,{children:R.jsxs(Qle,{children:[R.jsx(Uo,{path:"/",children:R.jsx(awe,{})}),R.jsx(Uo,{path:"/about",children:R.jsx(OEe,{})}),R.jsx(Uo,{path:"/auth",children:R.jsx(pm,{to:"/login"})}),R.jsx(Uo,{path:"/login",children:R.jsx(EU,{component:QU})}),R.jsx(Uo,{path:"/register",children:R.jsx(EU,{component:QU})}),R.jsx(Uo,{path:"/home",children:R.jsx(_l,{component:owe,requiredRoles:["admin","staff","donor","beneficiary","volunteer"]})}),R.jsx(Uo,{path:"/dashboard",children:R.jsx(_l,{component:lwe,requiredRoles:["admin","staff","volunteer","beneficiary","donor"]})}),R.jsx(Uo,{path:"/admin-dashboard",children:R.jsx(_l,{component:RAe,requiredRoles:["admin"]})}),R.jsx(Uo,{path:"/inventory",children:R.jsx(_l,{component:CEe,requiredRoles:["admin","staff","volunteer"]})}),R.jsx(Uo,{path:"/donations",children:R.jsx(_l,{component:AEe,requiredRoles:["admin","staff","donor"]})}),R.jsx(Uo,{path:"/distribution",children:R.jsx(_l,{component:bAe,requiredRoles:["admin","staff","volunteer"]})}),R.jsx(Uo,{path:"/deliveries",children:R.jsx(_l,{component:SOe,requiredRoles:["volunteer"]})}),R.jsx(Uo,{path:"/delivery/:deliveryId/track",children:R.jsx(_l,{component:GFe,requiredRoles:["admin","staff","beneficiary"]})}),R.jsx(Uo,{path:"/staff/location",children:R.jsx(_l,{component:KFe,requiredRoles:["staff","volunteer"]})}),R.jsx(Uo,{path:"/beneficiaries",children:R.jsx(_l,{component:REe,requiredRoles:["admin","staff","beneficiary"]})}),R.jsx(Uo,{path:"/analytics",children:R.jsx(_l,{component:xAe,requiredRoles:["admin","staff"]})}),R.jsx(Uo,{path:"/feedback",children:R.jsx(_l,{component:wAe,requiredRoles:["admin","staff","donor","beneficiary","volunteer"]})}),R.jsx(Uo,{path:"/profile",children:R.jsx(_l,{component:PEe,requiredRoles:["admin","staff","donor","beneficiary","volunteer"]})}),R.jsx(Uo,{path:"/request/new",children:R.jsx(_l,{component:l3,requiredRoles:["admin","staff","beneficiary"]})}),R.jsx(Uo,{path:"/request/:id",children:R.jsx(_l,{component:l3,requiredRoles:["admin","staff","beneficiary"]})}),R.jsx(Uo,{path:"/request",children:R.jsx(_l,{component:l3,requiredRoles:["admin","staff","beneficiary"]})}),R.jsx(Uo,{path:"/settings",children:R.jsx(_l,{component:NEe,requiredRoles:["admin"]})}),R.jsx(Uo,{children:R.jsx(pm,{to:"/home"})})]})})]})})})})})})});A3.createRoot(document.getElementById("root")).render(R.jsx(fa.StrictMode,{children:R.jsx(b5e,{})}));export{R as j};
//# sourceMappingURL=index-BBBwsIX-.js.map
